var mc=Object.defineProperty,fc=Object.defineProperties;var Ec=Object.getOwnPropertyDescriptors;var cr=Object.getOwnPropertySymbols;var gc=Object.prototype.hasOwnProperty,yc=Object.prototype.propertyIsEnumerable;var qt=(i,l,$)=>l in i?mc(i,l,{enumerable:!0,configurable:!0,writable:!0,value:$}):i[l]=$,F=(i,l)=>{for(var $ in l||(l={}))gc.call(l,$)&&qt(i,$,l[$]);if(cr)for(var $ of cr(l))yc.call(l,$)&&qt(i,$,l[$]);return i},Ke=(i,l)=>fc(i,Ec(l));var c=(i,l,$)=>(qt(i,typeof l!="symbol"?l+"":l,$),$);(function(i,l){typeof exports=="object"&&typeof module!="undefined"?l(exports,require("three"),require("three/examples/jsm/libs/stats.module"),require("three/examples/jsm/postprocessing/EffectComposer"),require("three/examples/jsm/postprocessing/RenderPass"),require("three/examples/jsm/controls/TransformControls"),require("three/examples/jsm/loaders/OBJLoader"),require("three/examples/jsm/loaders/MTLLoader"),require("three/examples/jsm/loaders/RGBELoader"),require("three/examples/jsm/loaders/GLTFLoader"),require("three/examples/jsm/loaders/DRACOLoader"),require("three/examples/jsm/loaders/KTX2Loader.js"),require("three/examples/jsm/libs/meshopt_decoder.module.js"),require("uuid"),require("three/examples/jsm/renderers/CSS3DRenderer"),require("@tweenjs/tween.js"),require("three/examples/jsm/postprocessing/SMAAPass"),require("three/examples/jsm/postprocessing/UnrealBloomPass"),require("three/examples/jsm/postprocessing/Pass"),require("three/examples/jsm/shaders/LuminosityHighPassShader"),require("keyboardjs"),require("three-csg-ts"),require("three/src/lights/LightShadow")):typeof define=="function"&&define.amd?define(["exports","three","three/examples/jsm/libs/stats.module","three/examples/jsm/postprocessing/EffectComposer","three/examples/jsm/postprocessing/RenderPass","three/examples/jsm/controls/TransformControls","three/examples/jsm/loaders/OBJLoader","three/examples/jsm/loaders/MTLLoader","three/examples/jsm/loaders/RGBELoader","three/examples/jsm/loaders/GLTFLoader","three/examples/jsm/loaders/DRACOLoader","three/examples/jsm/loaders/KTX2Loader.js","three/examples/jsm/libs/meshopt_decoder.module.js","uuid","three/examples/jsm/renderers/CSS3DRenderer","@tweenjs/tween.js","three/examples/jsm/postprocessing/SMAAPass","three/examples/jsm/postprocessing/UnrealBloomPass","three/examples/jsm/postprocessing/Pass","three/examples/jsm/shaders/LuminosityHighPassShader","keyboardjs","three-csg-ts","three/src/lights/LightShadow"],l):(i=typeof globalThis!="undefined"?globalThis:i||self,l(i.Vis={},i.three,i.Stats,i.EffectComposer,i.RenderPass,i.TransformControls,i.OBJLoader,i.MTLLoader,i.RGBELoader,i.GLTFLoader,i.DRACOLoader,i.KTX2Loader_js,i.meshopt_decoder_module_js,i.uuid,i.CSS3DRenderer,i.tween_js,i.SMAAPass,i.UnrealBloomPass,i.Pass,i.LuminosityHighPassShader,i.keyboardjs,i.threeCsgTs,i.LightShadow))})(this,function(i,l,$,Mt,St,lr,ur,dr,hr,pr,mr,fr,Er,J,me,N,gr,yr,en,tn,Tr,Ot,Mr){"use strict";function nn(n){return n&&typeof n=="object"&&"default"in n?n:{default:n}}var Sr=nn($),Je=nn(Tr);class Z{constructor(){c(this,"listeners",new Map)}addEventListener(e,t){const r=this.listeners;r.has(e)||r.set(e,new Set),r.get(e).add(t)}hasEventListener(e,t){const r=this.listeners;return r.has(e)?r.get(e).has(t):!1}removeEventListener(e,t){const r=this.listeners;!r.has(e)||!r.get(e).has(t)||r.get(e).delete(t)}dispatchEvent(e){var o;const t=e.type,r=this.listeners;if(r.has(t))try{(o=r.get(t))==null||o.forEach(s=>{s.call(this,e)})}catch(s){console.error(s)}}clear(){this.listeners=new Map}useful(){return Boolean([...this.listeners.keys()].length)}once(e,t){const r=function(o){t.call(this,o),this.removeEventListener(e,r)};this.addEventListener(e,r)}}class rn extends Z{constructor(e=0){super();c(this,"clock",new l.Clock);c(this,"animationFrame",-1);c(this,"fps",0);c(this,"timer",null);c(this,"playFun",()=>{});c(this,"render",()=>{this.dispatchEvent({type:"render",delta:this.clock.getDelta(),total:this.clock.getElapsedTime()})});c(this,"play",()=>{if(this.hasRendering()){console.warn("render manager is rendering.");return}this.dispatchEvent({type:"play"}),this.playFun()});c(this,"stop",()=>{this.animationFrame!==-1&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=-1),this.timer&&(clearTimeout(this.timer),this.timer=null),this.dispatchEvent({type:"stop"})});c(this,"hasRendering",()=>Boolean(this.animationFrame!==-1||this.timer));c(this,"hasVaildRender",()=>this.useful());this.setFPS(e)}setFPS(e){return this.animationFrame!==-1&&cancelAnimationFrame(this.animationFrame),this.timer&&clearTimeout(this.timer),this.fps=e,e<=0?(this.fps=0,this.playFun=()=>{this.render(),this.animationFrame=requestAnimationFrame(this.playFun)}):this.playFun=()=>{this.timer=setTimeout(()=>{this.playFun()},e),this.render()},this.playFun(),this}dispose(){this.hasRendering()&&this.stop(),this.clear()}}const Or=function(){return this.renderManager?(console.warn("has installed render manager plugin."),!1):(this.renderManager=new rn,this.render=function(){return this.renderManager.render(),this},this.play=function(){return this.renderManager.play(),this},this.stop=function(){return this.renderManager.stop(),this},this.addEventListener("dispose",()=>{this.renderManager.dispose()}),!0)};class on extends Z{constructor(e,t){super();c(this,"object");c(this,"domElement");c(this,"enabled",!0);c(this,"target",new l.Vector3);c(this,"minDistance",0);c(this,"maxDistance",1/0);c(this,"minZoom",0);c(this,"maxZoom",1/0);c(this,"minPolarAngle",0);c(this,"maxPolarAngle",Math.PI);c(this,"minAzimuthAngle",-1/0);c(this,"maxAzimuthAngle",1/0);c(this,"enableDamping",!1);c(this,"dampingFactor",.05);c(this,"enableZoom",!0);c(this,"zoomSpeed",1);c(this,"enableRotate",!0);c(this,"rotateSpeed",1);c(this,"enablePan",!0);c(this,"panSpeed",1);c(this,"screenSpacePanning",!0);c(this,"keyPanSpeed",7);c(this,"autoRotate",!1);c(this,"autoRotateSpeed",2);c(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"});c(this,"mouseButtons",{LEFT:null,MIDDLE:l.MOUSE.DOLLY,RIGHT:l.MOUSE.ROTATE});c(this,"touches",{ONE:l.TOUCH.ROTATE,TWO:l.TOUCH.DOLLY_PAN});c(this,"target0");c(this,"position0");c(this,"zoom0");c(this,"_domElementKeyEvents",null);c(this,"spherical");c(this,"reset");c(this,"update");c(this,"onContextMenu");c(this,"onPointerDown");c(this,"onPointerCancel");c(this,"onMouseWheel");c(this,"onPointerMove");c(this,"onPointerUp");c(this,"onKeyDown");this.object=e||new l.PerspectiveCamera,this.domElement=t||document.createElement("div"),this.domElement.style.touchAction="none",this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.update=(()=>{const p=new l.Vector3,M=new l.Quaternion().setFromUnitVectors(this.object.up,new l.Vector3(0,1,0)),Y=M.clone().invert(),V=new l.Vector3,Ce=new l.Quaternion,be=2*Math.PI;return()=>{const ar=this.object.position;p.copy(ar).sub(this.target),p.applyQuaternion(M),a.setFromVector3(p),this.autoRotate&&o===r.NONE&&w(f()),this.enableDamping?(a.theta+=u.theta*this.dampingFactor,a.phi+=u.phi*this.dampingFactor):(a.theta+=u.theta,a.phi+=u.phi);let he=this.minAzimuthAngle,pe=this.maxAzimuthAngle;return isFinite(he)&&isFinite(pe)&&(he<-Math.PI?he+=be:he>Math.PI&&(he-=be),pe<-Math.PI?pe+=be:pe>Math.PI&&(pe-=be),he<=pe?a.theta=Math.max(he,Math.min(pe,a.theta)):a.theta=a.theta>(he+pe)/2?Math.max(he,a.theta):Math.min(pe,a.theta)),a.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,a.phi)),a.makeSafe(),a.radius*=d,a.radius=Math.max(this.minDistance,Math.min(this.maxDistance,a.radius)),this.enableDamping===!0?this.target.addScaledVector(h,this.dampingFactor):this.target.add(h),p.setFromSpherical(a),p.applyQuaternion(Y),ar.copy(this.target).add(p),this.object.lookAt(this.target),this.enableDamping===!0?(u.theta*=1-this.dampingFactor,u.phi*=1-this.dampingFactor,h.multiplyScalar(1-this.dampingFactor)):(u.set(0,0,0),h.set(0,0,0)),d=1,m||V.distanceToSquared(this.object.position)>s||8*(1-Ce.dot(this.object.quaternion))>s?(this.dispatchEvent({type:"change"}),V.copy(this.object.position),Ce.copy(this.object.quaternion),m=!1,!0):!1}})();const r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let o=r.NONE;const s=1e-6,a=new l.Spherical,u=new l.Spherical;let d=1;const h=new l.Vector3;let m=!1;const E=new l.Vector2,T=new l.Vector2,O=new l.Vector2,S=new l.Vector2,v=new l.Vector2,C=new l.Vector2,y=new l.Vector2,R=new l.Vector2,I=new l.Vector2,L=[],H={},f=()=>2*Math.PI/60/60*this.autoRotateSpeed,k=()=>Math.pow(.95,this.zoomSpeed),w=p=>{u.theta-=p},P=p=>{u.phi-=p},Qn=function(){const p=new l.Vector3;return function(Y,V){p.setFromMatrixColumn(V,0),p.multiplyScalar(-Y),h.add(p)}}(),Xn=(()=>{const p=new l.Vector3;return(M,Y)=>{this.screenSpacePanning===!0?p.setFromMatrixColumn(Y,1):(p.setFromMatrixColumn(Y,0),p.crossVectors(this.object.up,p)),p.multiplyScalar(M),h.add(p)}})(),Ve=(()=>{const p=new l.Vector3;return(M,Y)=>{const V=this.domElement;if(this.object instanceof l.PerspectiveCamera){const Ce=this.object.position;p.copy(Ce).sub(this.target);let be=p.length();be*=Math.tan(this.object.fov/2*Math.PI/180),Qn(2*M*be/V.clientHeight,this.object.matrix),Xn(2*Y*be/V.clientHeight,this.object.matrix)}else this.object instanceof l.OrthographicCamera?(Qn(M*(this.object.right-this.object.left)/this.object.zoom/V.clientWidth,this.object.matrix),Xn(Y*(this.object.top-this.object.bottom)/this.object.zoom/V.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}})(),Kt=p=>{this.object instanceof l.PerspectiveCamera?d/=p:this.object instanceof l.OrthographicCamera?(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*p)),this.object.updateProjectionMatrix(),m=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)},Kn=p=>{this.object instanceof l.PerspectiveCamera?d*=p:this.object instanceof l.OrthographicCamera?(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/p)),this.object.updateProjectionMatrix(),m=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)};function Jn(p){E.set(p.clientX,p.clientY)}function Ja(p){y.set(p.clientX,p.clientY)}function Zn(p){S.set(p.clientX,p.clientY)}const Za=p=>{T.set(p.clientX,p.clientY),O.subVectors(T,E).multiplyScalar(this.rotateSpeed);const M=this.domElement;w(2*Math.PI*O.x/M.clientHeight),P(2*Math.PI*O.y/M.clientHeight),E.copy(T),this.update()},qa=p=>{R.set(p.clientX,p.clientY),I.subVectors(R,y),I.y>0?Kt(k()):I.y<0&&Kn(k()),y.copy(R),this.update()},ec=p=>{v.set(p.clientX,p.clientY),C.subVectors(v,S).multiplyScalar(this.panSpeed),Ve(C.x,C.y),S.copy(v),this.update()},tc=p=>{p.deltaY<0?Kn(k()):p.deltaY>0&&Kt(k()),this.update()},nc=p=>{let M=!1;switch(p.code){case this.keys.UP:Ve(0,this.keyPanSpeed),M=!0;break;case this.keys.BOTTOM:Ve(0,-this.keyPanSpeed),M=!0;break;case this.keys.LEFT:Ve(this.keyPanSpeed,0),M=!0;break;case this.keys.RIGHT:Ve(-this.keyPanSpeed,0),M=!0;break}M&&(p.preventDefault(),this.update())};function qn(){if(L.length===1)E.set(L[0].pageX,L[0].pageY);else{const p=.5*(L[0].pageX+L[1].pageX),M=.5*(L[0].pageY+L[1].pageY);E.set(p,M)}}function er(){if(L.length===1)S.set(L[0].pageX,L[0].pageY);else{const p=.5*(L[0].pageX+L[1].pageX),M=.5*(L[0].pageY+L[1].pageY);S.set(p,M)}}function tr(){const p=L[0].pageX-L[1].pageX,M=L[0].pageY-L[1].pageY,Y=Math.sqrt(p*p+M*M);y.set(0,Y)}const rc=()=>{this.enableZoom&&tr(),this.enablePan&&er()},ic=()=>{this.enableZoom&&tr(),this.enableRotate&&qn()},nr=p=>{if(L.length==1)T.set(p.pageX,p.pageY);else{const Y=Zt(p),V=.5*(p.pageX+Y.x),Ce=.5*(p.pageY+Y.y);T.set(V,Ce)}O.subVectors(T,E).multiplyScalar(this.rotateSpeed);const M=this.domElement;w(2*Math.PI*O.x/M.clientHeight),P(2*Math.PI*O.y/M.clientHeight),E.copy(T)},rr=p=>{if(L.length===1)v.set(p.pageX,p.pageY);else{const M=Zt(p),Y=.5*(p.pageX+M.x),V=.5*(p.pageY+M.y);v.set(Y,V)}C.subVectors(v,S).multiplyScalar(this.panSpeed),Ve(C.x,C.y),S.copy(v)},ir=p=>{const M=Zt(p),Y=p.pageX-M.x,V=p.pageY-M.y,Ce=Math.sqrt(Y*Y+V*V);R.set(0,Ce),I.set(0,Math.pow(R.y/y.y,this.zoomSpeed)),Kt(I.y),y.copy(R)},oc=p=>{this.enableZoom&&ir(p),this.enablePan&&rr(p)},sc=p=>{this.enableZoom&&ir(p),this.enableRotate&&nr(p)};this.onPointerDown=p=>{this.enabled!==!1&&(L.length===0&&(this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp)),pc(p),p.pointerType==="touch"?uc(p):ac(p))};let Jt=!1;this.onPointerMove=p=>{this.enabled!==!1&&(Jt||(this.domElement.setPointerCapture(p.pointerId),Jt=!0),p.pointerType==="touch"?dc(p):cc(p))},this.onPointerUp=p=>{this.enabled!==!1&&(Jt=!1,p.pointerType==="touch"?hc():lc(p),or(p),L.length===0&&(this.domElement.releasePointerCapture(p.pointerId),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)))},this.onPointerCancel=p=>{or(p)};const ac=p=>{let M;switch(p.button){case 0:M=this.mouseButtons.LEFT;break;case 1:M=this.mouseButtons.MIDDLE;break;case 2:M=this.mouseButtons.RIGHT;break;default:M=-1}switch(M){case l.MOUSE.DOLLY:if(this.enableZoom===!1)return;Ja(p),o=r.DOLLY;break;case l.MOUSE.ROTATE:if(p.ctrlKey||p.metaKey||p.shiftKey){if(this.enablePan===!1)return;Zn(p),o=r.PAN}else{if(this.enableRotate===!1)return;Jn(p),o=r.ROTATE}break;case l.MOUSE.PAN:if(p.ctrlKey||p.metaKey||p.shiftKey){if(this.enableRotate===!1)return;Jn(p),o=r.ROTATE}else{if(this.enablePan===!1)return;Zn(p),o=r.PAN}break;default:o=r.NONE}o!==r.NONE&&this.dispatchEvent({type:"start"})},cc=p=>{if(this.enabled!==!1)switch(o){case r.ROTATE:if(this.enableRotate===!1)return;Za(p);break;case r.DOLLY:if(this.enableZoom===!1)return;qa(p);break;case r.PAN:if(this.enablePan===!1)return;ec(p);break}},lc=p=>{this.dispatchEvent({type:"end"}),o=r.NONE};this.onMouseWheel=p=>{this.enabled===!1||this.enableZoom===!1||o!==r.NONE||(p.preventDefault(),this.dispatchEvent({type:"start"}),tc(p),this.dispatchEvent({type:"end"}))},this.onKeyDown=p=>{this.enabled===!1||this.enablePan===!1||nc(p)};const uc=p=>{switch(sr(p),L.length){case 1:switch(this.touches.ONE){case l.TOUCH.ROTATE:if(this.enableRotate===!1)return;qn(),o=r.TOUCH_ROTATE;break;case l.TOUCH.PAN:if(this.enablePan===!1)return;er(),o=r.TOUCH_PAN;break;default:o=r.NONE}break;case 2:switch(this.touches.TWO){case l.TOUCH.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;rc(),o=r.TOUCH_DOLLY_PAN;break;case l.TOUCH.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;ic(),o=r.TOUCH_DOLLY_ROTATE;break;default:o=r.NONE}break;default:o=r.NONE}o!==r.NONE&&this.dispatchEvent({type:"start"})},dc=p=>{switch(sr(p),o){case r.TOUCH_ROTATE:if(this.enableRotate===!1)return;nr(p),this.update();break;case r.TOUCH_PAN:if(this.enablePan===!1)return;rr(p),this.update();break;case r.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;oc(p),this.update();break;case r.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;sc(p),this.update();break;default:o=r.NONE}},hc=p=>{this.dispatchEvent({type:"end"}),o=r.NONE};this.onContextMenu=p=>{this.enabled!==!1&&p.preventDefault()};function pc(p){L.push(p)}const or=p=>{delete H[p.pointerId];for(let M=0;M<L.length;M++)if(L[M].pointerId==p.pointerId){L.splice(M,1);return}};function sr(p){let M=H[p.pointerId];M===void 0&&(M=new l.Vector2,H[p.pointerId]=M),M.set(p.pageX,p.pageY)}function Zt(p){const M=p.pointerId===L[0].pointerId?L[1]:L[0];return H[M.pointerId]}this.spherical=a,this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),this.domElement.addEventListener("wheel",this.onMouseWheel,{passive:!1}),this.reset=()=>{this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent({type:"change"}),this.update(),o=r.NONE},this.update()}getPolarAngle(){return this.spherical.phi}getAzimuthalAngle(){return this.spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this.onKeyDown),this._domElementKeyEvents=e}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}setCamera(e){this.object=e}setDom(e){this.dispose(),this.domElement=e,this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),this.domElement.addEventListener("wheel",this.onMouseWheel,{passive:!1})}dispose(){this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("pointercancel",this.onPointerCancel),this.domElement.removeEventListener("wheel",this.onMouseWheel),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp),this._domElementKeyEvents!==null&&this._domElementKeyEvents.removeEventListener("keydown",this.onKeyDown)}}i.VIEWPOINT=void 0,function(n){n.DEFAULT="default",n.TOP="top",n.BOTTOM="bottom",n.LEFT="left",n.RIGHT="right",n.FRONT="front",n.BACK="back"}(i.VIEWPOINT||(i.VIEWPOINT={}));const Cr=function(n={}){var o;if(!this.webGLRenderer)return console.error("must install some renderer before BasicViewpoint plugin."),!1;!n.viewpoint&&(n.viewpoint=i.VIEWPOINT.DEFAULT),!n.perspective&&(n.perspective={}),!n.perspective.position&&(n.perspective.position={x:60,y:60,z:60}),!n.perspective.lookAt&&(n.perspective.lookAt={x:0,y:0,z:0}),!n.perspective.up&&(n.perspective.up={x:0,y:1,z:0}),!n.orthograpbic&&(n.orthograpbic={}),!n.orthograpbic.up&&(n.orthograpbic.up={x:0,y:1,z:0});const e=new l.PerspectiveCamera;e.position.set(n.perspective.position.x,n.perspective.position.y,n.perspective.position.z),e.lookAt(n.perspective.lookAt.x,n.perspective.lookAt.y,n.perspective.lookAt.z),e.up.set(n.perspective.up.x,n.perspective.up.y,n.perspective.up.z);const t=n.orthograpbic.distance||1e4,r=new l.OrthographicCamera(-window.innerWidth/8,window.innerWidth/8,-window.innerHeight/8,window.innerHeight/8,0,t);return r.up.set(n.perspective.up.x,n.perspective.up.y,n.perspective.up.z),this.setViewpoint=function(s){return this.dispatchEvent({type:"setViewpoint",viewpoint:s}),this},this.addEventListener("setSize",s=>{const a=s.width,u=s.height,d=a/u;e.aspect=d,e.updateProjectionMatrix(),r.left=-t*d,r.right=t*d,r.top=t,r.bottom=-t,r.zoom=t/u*5,r.updateProjectionMatrix()}),(o=n.orthograpbic.allowRotate)!=null,this.addEventListener("setViewpoint",s=>{const a=s.viewpoint;if(a===i.VIEWPOINT.DEFAULT){this.setCamera(e);return}a===i.VIEWPOINT.TOP?r.position.set(0,t/2,0):a===i.VIEWPOINT.BOTTOM?r.position.set(0,-t/2,0):a===i.VIEWPOINT.RIGHT?r.position.set(t/2,0,0):a===i.VIEWPOINT.LEFT?r.position.set(-t/2,0,0):a===i.VIEWPOINT.FRONT?r.position.set(0,0,t/2):a===i.VIEWPOINT.BACK&&r.position.set(0,0,-t/2),this.setCamera(r)}),this.completeSet.add(()=>{n.viewpoint===i.VIEWPOINT.DEFAULT?this.setCamera(e):this.setCamera(r),this.objectHelperManager&&this.objectHelperManager.addFilteredObject(e,r)}),!0},br=function(n){return this.orbitControls?(console.warn("this has installed orbitControls plugin."),!1):this.renderManager?(this.orbitControls=new on(this.camera,this.dom),this.addEventListener("setCamera",e=>{e.options.orbitControls&&this.orbitControls.setCamera(e.camera)}),this.addEventListener("setDom",e=>{this.orbitControls.setDom(e.dom)}),this.renderManager.addEventListener("render",()=>{this.orbitControls.update()}),this.completeSet.add(()=>{this.setViewpoint&&this.addEventListener("setViewpoint",e=>{const t=e.viewpoint;this.orbitControls.target.set(0,0,0),t===i.VIEWPOINT.DEFAULT?this.orbitControls.enableRotate=!0:t===i.VIEWPOINT.TOP?this.orbitControls.enableRotate=!1:t===i.VIEWPOINT.BOTTOM?this.orbitControls.enableRotate=!1:t===i.VIEWPOINT.RIGHT?this.orbitControls.enableRotate=!1:t===i.VIEWPOINT.LEFT?this.orbitControls.enableRotate=!1:t===i.VIEWPOINT.FRONT?this.orbitControls.enableRotate=!1:t===i.VIEWPOINT.BACK&&(this.orbitControls.enableRotate=!1)})}),!0):(console.warn("this must install renderManager before install orbitControls plugin."),!1)};class Lr{constructor(e){c(this,"REVISION");c(this,"dom");c(this,"addPanel");c(this,"showPanel");c(this,"begin");c(this,"end");c(this,"update");c(this,"domElement");c(this,"setMode");const t=Sr.default();this.REVISION=t.REVISION,this.dom=t.dom,this.domElement=t.domElement,this.begin=t.begin.bind(t),this.end=t.end.bind(t),this.update=t.update.bind(t),this.addPanel=t.addPanel.bind(t),this.showPanel=t.showPanel.bind(t),this.setMode=t.setMode.bind(t);const r=this.domElement;r.style.position="absolute",r.style.top="0",r.style.left="35px",e&&(r.style.top=`${e.top}px`,r.style.left=`${e.left}px`,r.style.right=`${e.right}px`,r.style.bottom=`${e.bottom}px`)}}const vr=function(n){if(this.stats)return console.warn("this has installed stats plugin."),!1;if(!this.renderManager)return console.warn("this must install renderManager before install stats plugin."),!1;const e=new Lr(n);this.stats=e;const t=()=>{this.stats.update()};return this.setStats=function(r){if(r)this.dom.appendChild(this.stats.domElement),this.renderManager.addEventListener("render",t);else try{this.dom.removeChild(this.stats.domElement),this.renderManager.removeEventListener("render",t)}catch{}return this},!0},Pr=function(n={}){if(this.effectComposer)return console.warn("this has installed effect composer plugin."),!1;if(!this.webGLRenderer)return console.error("must install some renderer before this plugin."),!1;let e;if(n.WebGLMultisampleRenderTarget||n.MSAA){const r=this.webGLRenderer,o=r.getPixelRatio(),s=r.getDrawingBufferSize(new l.Vector2);Number(window.__THREE__)>137?e=new Mt.EffectComposer(r,new l.WebGLRenderTarget(s.width*o,s.height*o,{format:n.format||l.RGBAFormat,samples:n.samples||4})):e=new Mt.EffectComposer(r,new l.WebGLMultisampleRenderTarget(s.width*o,s.height*o,{format:n.format||l.RGBAFormat}))}else e=new Mt.EffectComposer(this.webGLRenderer);this.effectComposer=e;let t;return this.scene&&this.camera&&(t=new St.RenderPass(this.scene,this.camera),e.addPass(t)),this.addEventListener("setCamera",r=>{if(!t&&this.scene){t=new St.RenderPass(this.scene,r.camera),e.addPass(t);return}else t&&(t.camera=r.camera)}),this.addEventListener("setScene",r=>{if(!t&&this.camera){t=new St.RenderPass(r.scene,this.camera),e.addPass(t);return}else t&&(t.scene=r.scene)}),this.addEventListener("setSize",r=>{e.setSize(r.width,r.height)}),this.renderManager?(this.renderManager.removeEventListener("render",this.render),this.renderManager.addEventListener("render",r=>{this.effectComposer.render(r.delta)})):this.render=function(){return this.effectComposer.render(),this},!0};class Rr extends Z{constructor(e){super();c(this,"dom");c(this,"mouse");c(this,"canMouseMove");c(this,"mouseEventTimer");c(this,"throttleTime");c(this,"pointerDownHandler");c(this,"pointerMoveHandler");c(this,"pointerUpHandler");c(this,"mouseDownHandler");c(this,"mouseUpHandler");c(this,"clickHandler");c(this,"dblclickHandler");c(this,"contextmenuHandler");this.dom=e.dom,this.mouse=new l.Vector2,this.canMouseMove=!0,this.mouseEventTimer=null,this.throttleTime=e.throttleTime||1e3/60;const t=o=>{const s={mouse:{x:this.mouse.x,y:this.mouse.y}};for(const a in o)s[a]=o[a];return s},r=o=>{this.dispatchEvent(t(o))};this.pointerMoveHandler=o=>{!this.canMouseMove||(this.canMouseMove=!1,this.mouseEventTimer=window.setTimeout(()=>{const s=this.mouse,a=this.dom,u=a.getBoundingClientRect();s.x=(o.clientX-u.left)/a.offsetWidth*2-1,s.y=-((o.clientY-u.top)/a.offsetHeight)*2+1,this.canMouseMove=!0,this.dispatchEvent(t(o))},this.throttleTime))},this.mouseDownHandler=r,this.mouseUpHandler=r,this.pointerDownHandler=r,this.pointerUpHandler=r,this.clickHandler=r,this.dblclickHandler=r,this.contextmenuHandler=r}setDom(e){if(this.dom){const t=this.dom;t.removeEventListener("mousedown",this.mouseDownHandler),t.removeEventListener("mouseup",this.mouseUpHandler),t.removeEventListener("pointerdown",this.pointerDownHandler),t.removeEventListener("pointermove",this.pointerMoveHandler),t.removeEventListener("pointerup",this.pointerUpHandler),t.removeEventListener("click",this.clickHandler),t.removeEventListener("dblclick",this.dblclickHandler),t.removeEventListener("contextmenu",this.contextmenuHandler)}return e.addEventListener("mousedown",this.mouseDownHandler),e.addEventListener("mouseup",this.mouseUpHandler),e.addEventListener("pointerdown",this.pointerDownHandler),e.addEventListener("pointermove",this.pointerMoveHandler),e.addEventListener("pointerup",this.pointerUpHandler),e.addEventListener("click",this.clickHandler),e.addEventListener("dblclick",this.dblclickHandler),e.addEventListener("contextmenu",this.contextmenuHandler),this.dom=e,this}getNormalMouse(){return this.mouse}}const wr=function(n){if(this.pointerManager)return console.warn("this has installed pointerManager plugin."),!1;const e=new Rr(Object.assign(n||{},{dom:this.dom}));return this.addEventListener("setDom",t=>{e.setDom(t.dom)}),this.pointerManager=e,!0};i.EVENTNAME=void 0,function(n){n.POINTERDOWN="pointerdown",n.POINTERUP="pointerup",n.POINTERMOVE="pointermove",n.POINTERENTER="pointerenter",n.POINTERLEAVE="pointerleave",n.CLICK="click",n.DBLCLICK="dblclick",n.CONTEXTMENU="contextmenu"}(i.EVENTNAME||(i.EVENTNAME={}));class Ir extends Z{constructor(e){super();c(this,"raycaster");c(this,"scene");c(this,"camera");c(this,"filter",new Set);c(this,"recursive",!1);c(this,"penetrate",!1);c(this,"propagation",!1);c(this,"delegation",!1);this.raycaster=new l.Raycaster,this.camera=e.camera,this.scene=e.scene,e.recursive&&(this.recursive=e.recursive),e.penetrate&&(this.penetrate=e.penetrate)}setScene(e){return this.scene=e,this}setCamera(e){return this.camera=e,this}addFilterObject(e){return this.filter.add(e),this}removeFilterObject(e){return this.filter.delete(e),this}intersectObject(e){this.raycaster.setFromCamera(e,this.camera);const t=this.filter,r=this.scene.children.filter(o=>!t.has(o));return this.raycaster.intersectObjects(r,this.recursive)}use(e){const t=function(u,d){return Object.assign({},u,d)},r=(u,d)=>{const h=this.intersectObject(u.mouse);if(h.length)if(this.penetrate)for(const m of h)m.object.dispatchEvent(t(u,{type:d,intersection:m}));else{const m=h[0];m.object.dispatchEvent(t(u,{type:d,intersection:m}))}this.dispatchEvent(t(u,{type:d,intersections:h}))},o=["pointerdown","pointerup","mousedown","mouseup","pointermove","click","dblclick","contextmenu"];for(const u of o)e.addEventListener(u,d=>{r(d,u)});const s=new Map;let a=null;return e.addEventListener("pointermove",u=>{const d=this.intersectObject(u.mouse);if(this.penetrate){if(!d.length){s.forEach(h=>{h.object.dispatchEvent(t(u,{type:"pointerleave",intersection:h})),h.object.dispatchEvent(t(u,{type:"mouseleave",intersection:h}))}),s.clear();return}for(const h of d)s.has(h.object)?(h.object.dispatchEvent(t(u,{type:"pointermove",intersection:h})),h.object.dispatchEvent(t(u,{type:"mousemove",intersection:h})),s.delete(h.object)):(h.object.dispatchEvent(t(u,{type:"pointerenter",intersection:h})),h.object.dispatchEvent(t(u,{type:"mouseenter",intersection:h})));for(const h of s.values())h.object.dispatchEvent(t(u,{type:"pointerleave",intersection:h})),h.object.dispatchEvent(t(u,{type:"mouseleave",intersection:h}));s.clear();for(const h of d)s.set(h.object,h)}else{if(!d.length){a&&(a.object.dispatchEvent(t(u,{type:"pointerleave",intersection:a})),a.object.dispatchEvent(t(u,{type:"mouseleave",intersection:a})),a=null);return}const h=d[0];if(!a){h.object.dispatchEvent(t(u,{type:"pointerenter",intersection:h})),h.object.dispatchEvent(t(u,{type:"mouseenter",intersection:h})),a=h;return}if(h.object!==a.object){a.object.dispatchEvent(t(u,{type:"pointerleave",intersection:h})),a.object.dispatchEvent(t(u,{type:"mouseleave",intersection:h})),h.object.dispatchEvent(t(u,{type:"pointerenter",intersection:h})),h.object.dispatchEvent(t(u,{type:"mouseenter",intersection:h})),a=h;return}h.object===a.object&&(h.object.dispatchEvent(t(u,{type:"pointermove",intersection:h})),h.object.dispatchEvent(t(u,{type:"mousemove",intersection:h})))}this.dispatchEvent(t(u,{type:"pointermove",intersections:d})),this.dispatchEvent(t(u,{type:"mousemove",intersections:d}))}),this}}const Nr=function(n){if(this.eventManager)return console.warn("engine has installed eventManager plugin."),!1;if(!this.pointerManager)return console.error("must install pointerManager before this plugin."),!1;const e=new Ir(Object.assign({scene:this.scene,camera:this.camera},n));return e.use(this.pointerManager),this.eventManager=e,this.addEventListener("setCamera",t=>{this.eventManager.setCamera(t.camera)}),this.addEventListener("setScene",t=>{this.eventManager.setScene(t.scene)}),!0};var Ze;(function(n){n.OBJECTCHANGED="objectChanged"})(Ze||(Ze={}));class sn extends lr.TransformControls{constructor(e,t){!e&&(e=new l.PerspectiveCamera),!t&&(t=document.body);super(e,t);c(this,"target");c(this,"transObjectSet");this.domElement.removeEventListener("pointerdown",this._onPointerDown),this._onPointerDown=d=>{var h;!this.enabled||!((h=this.object)==null?void 0:h.parent)||(this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(d)),this.pointerDown(this._getPointer(d)))},this.domElement.addEventListener("pointerdown",this._onPointerDown),this.target=new l.Object3D,this.transObjectSet=new Set;let r="";const o=this.target,s=this.transObjectSet,a={x:0,y:0,z:0},u=new WeakMap;this.addEventListener("mouseDown",d=>{r=d.target.mode,r==="translate"&&(r="position"),r==="rotate"&&(r="rotation"),a.x=o[r].x,a.y=o[r].y,a.z=o[r].z,s.forEach(h=>{u.set(h,h.matrixAutoUpdate),h.matrixAutoUpdate=!1})}),this.addEventListener("objectChange",d=>{const h=o[r].x-a.x,m=o[r].y-a.y,E=o[r].z-a.z;a.x=o[r].x,a.y=o[r].y,a.z=o[r].z,s.forEach(T=>{T[r].x+=h,T[r].y+=m,T[r].z+=E,T.updateMatrix(),T.updateMatrixWorld()}),this.dispatchEvent({type:Ze.OBJECTCHANGED,transObjectSet:s,mode:r,target:o})}),this.addEventListener("mouseUp",d=>{s.forEach(h=>{h.matrixAutoUpdate=u.get(h),u.delete(h)})})}setDom(e){return this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),e.addEventListener("pointerdown",this._onPointerDown),e.addEventListener("pointermove",this._onPointerHover),e.addEventListener("pointerup",this._onPointerUp),this.domElement=e,this}setCamera(e){return this.camera=e,this}getTarget(){return this.target}getTransObjectSet(){return this.transObjectSet}setAttach(...e){if(this.transObjectSet.clear(),!e.length||!e[0])return this.detach(),this;this.attach(this.target);const t=this.target;if(e.length===1){const a=e[0];return a.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.updateMatrix(),t.updateMatrixWorld(),this.transObjectSet.add(a),this}const r=[],o=[],s=[];return e.forEach(a=>{r.push(a.matrixWorld.elements[12]),o.push(a.matrixWorld.elements[13]),s.push(a.matrixWorld.elements[14])}),t.rotation.set(0,0,0),t.scale.set(0,0,0),t.position.x=(Math.max(...r)-Math.min(...r))/2+Math.min(...r),t.position.y=(Math.max(...o)-Math.min(...o))/2+Math.min(...o),t.position.z=(Math.max(...s)-Math.min(...s))/2+Math.min(...s),t.updateMatrix(),t.updateMatrixWorld(),e.forEach(a=>{this.transObjectSet.add(a)}),this}}const Gr=function(n){if(this.transformControls)return console.warn("this has installed transformControls plugin."),!1;if(!this.pointerManager)return console.warn("this must install pointerManager before install transformControls plugin."),!1;if(!this.eventManager)return console.warn("this must install eventManager before install transformControls plugin."),!1;const e=new sn(this.camera,this.dom);return e.detach(),this.transformControls=e,this.scene.add(this.transformControls),this.scene.add(this.transformControls.target),this.transformControls.addEventListener("mouseDown",()=>{this.transing=!0}),this.setTransformControls=function(t){return t?this.scene.add(this.transformControls):this.scene.remove(this.transformControls),this},this.addEventListener("setCamera",t=>{t.options.transformControls&&e.setCamera(t.camera)}),this.addEventListener("setDom",t=>{e.setDom(t.dom)}),this.addEventListener("setScene",t=>{const r=t.scene;r.add(this.transformControls.target),r.add(this.transformControls)}),this.selectionBox?this.addEventListener("selected",t=>{e.setAttach(...t.objects)}):this.eventManager.addEventListener("click",t=>{if(this.transing){this.transing=!1;return}if(t.button===0){const o=t.intersections.map(s=>s.object)[0]||null;o?e.setAttach(o):e.detach()}}),this.eventManager.addFilterObject(e),this.completeSet.add(()=>{if(this.IS_ENGINESUPPORT){const t=s=>{const a=this.compilerManager.getObjectSymbol(s);return a?this.dataSupportManager.getConfigBySymbol(a):null};let r=null,o;e.addEventListener(Ze.OBJECTCHANGED,s=>{const a=s;a.transObjectSet.forEach(u=>{r=t(u),o=a.mode,r&&(r[o].x=u[o].x,r[o].y=u[o].y,r[o].z=u[o].z)})})}}),!0},Ar=function(n={}){if(this.webGLRenderer)return console.warn("this has installed webglRenderer plugin."),!1;this.webGLRenderer=new l.WebGLRenderer(n);const e=this.webGLRenderer.domElement;return e.style.position="absolute",e.style.top="0",e.style.left="0",e.classList.add("vis-webgl"),this.getScreenshot=async function(t={}){const r={width:this.dom.offsetWidth,height:this.dom.offsetHeight};!t.width&&(t.width=this.dom.offsetWidth),!t.height&&(t.height=this.dom.offsetHeight),!t.mine&&(t.mine="image/png");let o=!1;this.renderManager.hasRendering()&&(this.renderManager.stop(),o=!0);let s="";const a=this.webGLRenderer.getContext(),d=a.getParameter(a.MAX_RENDERBUFFER_SIZE)/4;if(t.width>d||t.height>d){const h=[],m=Math.ceil(t.width/d),E=Math.ceil(t.height/d),T=t.width/m,O=t.height/E,S=document.createElement("canvas");S.setAttribute("width",t.width.toString()),S.setAttribute("height",t.height.toString());const v=S.getContext("2d");if(!v)return console.warn("can not support canvas 2d;"),s;this.setSize(T,O);for(let y=0;y<m;y+=1)for(let R=0;R<E;R+=1)h.push({x:T*y,y:O*R});const C=[];h.forEach(y=>{this.camera.setViewOffset(t.width,t.height,y.x,y.y,T,O),this.renderManager.render();const R=this.webGLRenderer.domElement.toDataURL(t.mine);C.push(new Promise((I,L)=>{const H=new Image;H.src=R,H.onload=()=>{v.drawImage(H,y.x,y.y,T,O),I(null)}}))}),this.setSize(r.width,r.height),await Promise.all(C).catch(y=>{console.warn(y)}),s=S.toDataURL(t.mine),this.camera.clearViewOffset()}else this.setSize(t.width,t.height),this.renderManager.render(),s=this.webGLRenderer.domElement.toDataURL(t.mine),this.setSize(r.width,r.height);return o&&this.renderManager.play(),s},this.addEventListener("setDom",t=>{t.dom.appendChild(this.webGLRenderer.domElement)}),this.addEventListener("setSize",t=>{this.webGLRenderer.setSize(t.width,t.height,!0)}),this.addEventListener("dispose",()=>{this.webGLRenderer.dispose()}),this.renderManager?(this.renderManager.removeEventListener("render",this.render),this.renderManager.addEventListener("render",t=>{this.webGLRenderer.render(this.scene,this.camera)})):this.render=function(){return this.webGLRenderer.render(this.scene,this.camera),this},!0},ke=class extends l.Loader{constructor(e){super(e)}load(e,t,r,o){this.path!==void 0&&(e=this.path+e),this.manager.itemStart(e),e=this.manager.resolveURL(e);const s=l.Cache.get(e);if(s!==void 0)return setTimeout(()=>{t&&t(s),this.manager.itemEnd(e)},0),s;const a=document.createElement("video");return a.preload=ke.preload,a.autoplay=ke.autoplay,a.loop=ke.loop,a.muted=ke.muted,a.src=e,a.style.position="fixed",a.style.top="0",a.style.left="0",a.style.zIndex="-1",document.body.appendChild(a),a.oncanplay=()=>{l.Cache.add(e,a),this.manager.itemEnd(e),t&&t(a)},a.onerror=u=>{this.manager.itemEnd(e),o&&o(u)},a}};let Le=ke;c(Le,"autoplay",!0),c(Le,"preload","auto"),c(Le,"muted",!0),c(Le,"loop",!0);var W;(function(n){n.BEFORELOAD="beforeLoad",n.LOADING="loading",n.DETAILLOADING="detailLoading",n.DETAILLOADED="detailLoaded",n.LOADED="loaded"})(W||(W={}));class an extends Z{constructor(e){super();c(this,"resourceMap");c(this,"loaderMap");c(this,"urlList",[]);c(this,"loadTotal");c(this,"loadSuccess");c(this,"loadError");c(this,"isError");c(this,"isLoading");c(this,"isLoaded");c(this,"loadDetailMap");c(this,"path","");this.resourceMap=new Map,this.loadTotal=0,this.loadSuccess=0,this.loadError=0,this.isError=!1,this.isLoading=!1,this.isLoaded=!1,this.loadDetailMap={};const t=new l.ImageLoader,r=new Le,o=new pr.GLTFLoader;o.setDRACOLoader(new mr.DRACOLoader),o.setKTX2Loader(new fr.KTX2Loader),o.setMeshoptDecoder(Er.MeshoptDecoder),this.loaderMap={jpg:t,png:t,jpeg:t,obj:new ur.OBJLoader,mtl:new dr.MTLLoader,mp4:r,webm:r,ogg:r,hdr:new hr.RGBELoader,gltf:o,glb:o},e&&(this.loaderMap=Object.assign(this.loaderMap,e.loaderExtends))}loaded(){return this.dispatchEvent({type:W.LOADED,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError,resourceMap:this.resourceMap}),this}checkLoaded(){return this.loadTotal===this.loadSuccess+this.loadError&&(this.isError=!0,this.isLoaded=!0,this.isLoading=!1,this.loaded()),this}setPath(e){return this.path=e,this}setRequestHeader(e){return Object.values(this.loaderMap).forEach(t=>{t.setRequestHeader(e)}),this}setResponseType(e){return Object.values(this.loaderMap).forEach(t=>{t.setResponseType&&t.setResponseType(e)}),this}getLoader(e){return this.loaderMap[e]?this.loaderMap[e]:null}load(e){var s;if(this.reset(),this.isLoading=!0,this.dispatchEvent({type:W.BEFORELOAD,urlList:[...e]}),e.length<=0)return this.checkLoaded(),console.warn("url list is empty."),this;this.loadTotal+=e.length;const t=this.resourceMap,r=this.loaderMap,o=this.loadDetailMap;for(const a of e){let u,d;typeof a=="string"?(u=a,d=((s=u.split(".").pop())==null?void 0:s.toLocaleLowerCase())||""):(u=a.url,d=a.ext.toLocaleLowerCase(),d.startsWith(".")&&(d=d.slice(1)));const h={url:u,progress:0,error:!1,message:u};if(o[u]=h,t.has(u)){h.progress=1,this.loadSuccess+=1,this.dispatchEvent({type:W.DETAILLOADED,detail:h}),this.dispatchEvent({type:W.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded();continue}if(!d){h.message=`url: ${u} \u5730\u5740\u6709\u8BEF\uFF0C\u65E0\u6CD5\u83B7\u53D6\u6587\u4EF6\u683C\u5F0F\u3002`,console.warn(h.message),h.error=!0,this.isError=!0,this.loadError+=1,this.dispatchEvent({type:W.DETAILLOADED,detail:h}),this.dispatchEvent({type:W.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError});continue}const m=r[d];if(!m){h.message=`url: ${u} \u4E0D\u652F\u6301\u6B64\u6587\u4EF6\u683C\u5F0F\u52A0\u8F7D\u3002`,console.warn(h.message),h.error=!0,this.isError=!0,this.loadError+=1,this.dispatchEvent({type:W.DETAILLOADED,detail:h}),this.dispatchEvent({type:W.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError});continue}const E=u.replace(/\\/g,"/").split("/"),T=E.pop(),O=this.path+E.join("/")+"/";m.setPath(O).loadAsync(T,S=>{h.progress=Number((S.loaded/S.total).toFixed(2)),this.dispatchEvent({type:W.DETAILLOADING,detail:h})}).then(S=>{h.progress=1,this.loadSuccess+=1,this.resourceMap.set(u,S),this.urlList.push(a),this.dispatchEvent({type:W.DETAILLOADED,detail:h}),this.dispatchEvent({type:W.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded()}).catch(S=>{h.error=!0,h.message=JSON.stringify(S),this.loadError+=1,this.dispatchEvent({type:W.DETAILLOADED,detail:h}),this.dispatchEvent({type:W.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded()})}return this}reset(){return this.loadTotal=0,this.loadSuccess=0,this.loadError=0,this.isError=!1,this.isLoading=!1,this.isLoaded=!1,this.loadDetailMap={},this}register(e,t){return this.loaderMap[e]=t,this}hasLoaded(e){return this.resourceMap.has(e)}getResource(e){return this.resourceMap.get(e)}getLoadDetailMap(){return this.loadDetailMap}setLoadDetailMap(e){return this.loadDetailMap=e,this}remove(e){}toJSON(){return JSON.stringify(this.urlList)}exportConfig(){return JSON.parse(JSON.stringify(this.urlList))}dispose(){return this.resourceMap.clear(),this}}const Dr=function(n){if(this.loaderManager)return console.warn("engine has installed loaderManager plugin."),!1;const e=new an(n);return this.loaderManager=e,this.loadResources=(t,r)=>{if(this.resourceManager){const o=s=>{r(void 0,s),this.resourceManager.removeEventListener("mapped",o)};try{this.resourceManager.addEventListener("mapped",o)}catch(s){r(s)}}else{const o=s=>{r(void 0,s),this.loaderManager.removeEventListener("loaded",o)};try{this.loaderManager.addEventListener("loaded",o)}catch(s){r(s)}}return this.loaderManager.load(t),this},this.loadResourcesAsync=t=>new Promise((r,o)=>{if(this.resourceManager){const s=a=>{r(a),this.resourceManager.removeEventListener("mapped",s)};try{this.resourceManager.addEventListener("mapped",s)}catch(a){o(a)}}else{const s=a=>{r(a),this.loaderManager.removeEventListener("loaded",s)};try{this.loaderManager.addEventListener("loaded",s)}catch(a){o(a)}}this.loaderManager.load(t)}),!0};i.CONFIGTYPE=void 0,function(n){n.BOXGEOMETRY="BoxGeometry",n.SPHEREGEOMETRY="SphereGeometry",n.LOADGEOMETRY="LoadGeometry",n.PLANEGEOMETRY="PlaneGeometry",n.CIRCLEGEOMETRY="CircleGeometry",n.CONEGEOMETRY="ConeGeometry",n.CYLINDERGEOMETRY="CylinderGeometry",n.DODECAHEDRONGEOMETRY="DodecahedronGeometry",n.TORUSGEOMETRY="TorusGeometry",n.RINGGEOMETRY="RingGeometry",n.EDGESGEOMETRY="EdgesGeometry",n.LINECURVEGEOMETRY="LineCurveGeometry",n.SPLINECURVEGEOMETRY="SplineCurveGeometry",n.CUBICBEZIERCURVEGEOMETRY="CubicBezierCurveGeometry",n.QUADRATICBEZIERCURVEGEOMETRY="QuadraticBezierCurveGeometry",n.CUSTOMGEOMETRY="CustomGeometry",n.LINETUBEGEOMETRY="LineTubeGeometry",n.SPLINETUBEGEOMETRY="SplineTubeGeometry",n.LINESHAPEGEOMETRY="LineShapeGeometry",n.OBJECT3D="Object3D",n.MESH="Mesh",n.LINE="Line",n.POINTS="Points",n.SPRITE="Sprite",n.GROUP="Group",n.CSS3DOBJECT="CSS3DObject",n.CSS3DSPRITE="CSS3DSprite",n.CSS3DPLANE="CSS3DPlane",n.IMAGETEXTURE="ImageTexture",n.CUBETEXTURE="CubeTexture",n.CANVASTEXTURE="CanvasTexture",n.VIDEOTEXTURE="VideoTexture",n.LOADTEXTURE="LoadTexture",n.MESHBASICMATERIAL="MeshBasicMaterial",n.MESHSTANDARDMATERIAL="MeshStandardMaterial",n.MESHPHONGMATERIAL="MeshPhongMaterial",n.SPRITEMATERIAL="SpriteMaterial",n.LINEBASICMATERIAL="LineBasicMaterial",n.POINTSMATERIAL="PointsMaterial",n.SHADERMATERIAL="ShaderMaterial",n.MESHPHYSICALMATERIAL="MeshPhysicalMaterial",n.AMBIENTLIGHT="AmbientLight",n.SPOTLIGHT="SpotLight",n.POINTLIGHT="PointLight",n.DIRECTIONALLIGHT="DirectionalLight",n.HEMISPHERELIGHT="HemisphereLight",n.PERSPECTIVECAMERA="PerspectiveCamera",n.ORTHOGRAPHICCAMERA="OrthographicCamera",n.WEBGLRENDERER="WebGLRenderer",n.CSS3DRENDERER="CSS3DRenderer",n.SCENE="Scene",n.TRNASFORMCONTROLS="TransformControls",n.ORBITCONTROLS="OrbitControls",n.SMAAPASS="SMAAPass",n.UNREALBLOOMPASS="UnrealBloomPass",n.SELECTIVEBLOOMPASS="SelectiveBloomPass",n.SCRIPTANIMATION="ScriptAnimation",n.KEYFRAMEANIMATION="KeyframeAnimation"}(i.CONFIGTYPE||(i.CONFIGTYPE={})),i.MODULETYPE=void 0,function(n){n.OBJECT3D="Object3D",n.CAMERA="camera",n.LIGHT="light",n.GEOMETRY="geometry",n.TEXTURE="texture",n.MATERIAL="material",n.RENDERER="renderer",n.SCENE="scene",n.SPRITE="sprite",n.CONTROLS="controls",n.LINE="line",n.MESH="mesh",n.POINTS="points",n.GROUP="group",n.CSS3D="css3D",n.PASS="pass",n.ANIMATION="animation"}(i.MODULETYPE||(i.MODULETYPE={})),i.OBJECTMODULE=void 0,function(n){n[n.CAMERA=i.MODULETYPE.CAMERA]="CAMERA",n[n.LIGHT=i.MODULETYPE.LIGHT]="LIGHT",n[n.SCENE=i.MODULETYPE.SCENE]="SCENE",n[n.SPRITE=i.MODULETYPE.SPRITE]="SPRITE",n[n.LINE=i.MODULETYPE.LINE]="LINE",n[n.MESH=i.MODULETYPE.MESH]="MESH",n[n.POINTS=i.MODULETYPE.POINTS]="POINTS",n[n.GROUP=i.MODULETYPE.GROUP]="GROUP",n[n.CSS3D=i.MODULETYPE.CSS3D]="CSS3D",n[n.OBJECT3D=i.MODULETYPE.OBJECT3D]="OBJECT3D"}(i.OBJECTMODULE||(i.OBJECTMODULE={}));const Ur={[i.CONFIGTYPE.IMAGETEXTURE]:i.MODULETYPE.TEXTURE,[i.CONFIGTYPE.CUBETEXTURE]:i.MODULETYPE.TEXTURE,[i.CONFIGTYPE.CANVASTEXTURE]:i.MODULETYPE.TEXTURE,[i.CONFIGTYPE.VIDEOTEXTURE]:i.MODULETYPE.TEXTURE,[i.CONFIGTYPE.MESHBASICMATERIAL]:i.MODULETYPE.MATERIAL,[i.CONFIGTYPE.MESHSTANDARDMATERIAL]:i.MODULETYPE.MATERIAL,[i.CONFIGTYPE.MESHPHONGMATERIAL]:i.MODULETYPE.MATERIAL,[i.CONFIGTYPE.SPRITEMATERIAL]:i.MODULETYPE.MATERIAL,[i.CONFIGTYPE.LINEBASICMATERIAL]:i.MODULETYPE.MATERIAL,[i.CONFIGTYPE.POINTSMATERIAL]:i.MODULETYPE.MATERIAL,[i.CONFIGTYPE.SHADERMATERIAL]:i.MODULETYPE.MATERIAL,[i.CONFIGTYPE.AMBIENTLIGHT]:i.MODULETYPE.LIGHT,[i.CONFIGTYPE.SPOTLIGHT]:i.MODULETYPE.LIGHT,[i.CONFIGTYPE.POINTLIGHT]:i.MODULETYPE.LIGHT,[i.CONFIGTYPE.DIRECTIONALLIGHT]:i.MODULETYPE.LIGHT,[i.CONFIGTYPE.BOXGEOMETRY]:i.MODULETYPE.GEOMETRY,[i.CONFIGTYPE.SPHEREGEOMETRY]:i.MODULETYPE.GEOMETRY,[i.CONFIGTYPE.LOADGEOMETRY]:i.MODULETYPE.GEOMETRY,[i.CONFIGTYPE.CUSTOMGEOMETRY]:i.MODULETYPE.GEOMETRY,[i.CONFIGTYPE.PLANEGEOMETRY]:i.MODULETYPE.GEOMETRY,[i.CONFIGTYPE.CIRCLEGEOMETRY]:i.MODULETYPE.GEOMETRY,[i.CONFIGTYPE.CONEGEOMETRY]:i.MODULETYPE.GEOMETRY,[i.CONFIGTYPE.CIRCLEGEOMETRY]:i.MODULETYPE.GEOMETRY,[i.CONFIGTYPE.EDGESGEOMETRY]:i.MODULETYPE.GEOMETRY,[i.CONFIGTYPE.CYLINDERGEOMETRY]:i.MODULETYPE.GEOMETRY,[i.CONFIGTYPE.LINECURVEGEOMETRY]:i.MODULETYPE.GEOMETRY,[i.CONFIGTYPE.SPLINECURVEGEOMETRY]:i.MODULETYPE.GEOMETRY,[i.CONFIGTYPE.CUBICBEZIERCURVEGEOMETRY]:i.MODULETYPE.GEOMETRY,[i.CONFIGTYPE.QUADRATICBEZIERCURVEGEOMETRY]:i.MODULETYPE.GEOMETRY,[i.CONFIGTYPE.LINETUBEGEOMETRY]:i.MODULETYPE.GEOMETRY,[i.CONFIGTYPE.SPLINETUBEGEOMETRY]:i.MODULETYPE.GEOMETRY,[i.CONFIGTYPE.TORUSGEOMETRY]:i.MODULETYPE.GEOMETRY,[i.CONFIGTYPE.RINGGEOMETRY]:i.MODULETYPE.GEOMETRY,[i.CONFIGTYPE.LINESHAPEGEOMETRY]:i.MODULETYPE.GEOMETRY,[i.CONFIGTYPE.SPRITE]:i.MODULETYPE.SPRITE,[i.CONFIGTYPE.LINE]:i.MODULETYPE.LINE,[i.CONFIGTYPE.MESH]:i.MODULETYPE.MESH,[i.CONFIGTYPE.POINTS]:i.MODULETYPE.POINTS,[i.CONFIGTYPE.GROUP]:i.MODULETYPE.GROUP,[i.CONFIGTYPE.CSS3DOBJECT]:i.MODULETYPE.CSS3D,[i.CONFIGTYPE.CSS3DSPRITE]:i.MODULETYPE.CSS3D,[i.CONFIGTYPE.CSS3DPLANE]:i.MODULETYPE.CSS3D,[i.CONFIGTYPE.PERSPECTIVECAMERA]:i.MODULETYPE.CAMERA,[i.CONFIGTYPE.ORTHOGRAPHICCAMERA]:i.MODULETYPE.CAMERA,[i.CONFIGTYPE.WEBGLRENDERER]:i.MODULETYPE.RENDERER,[i.CONFIGTYPE.SCENE]:i.MODULETYPE.SCENE,[i.CONFIGTYPE.TRNASFORMCONTROLS]:i.MODULETYPE.CONTROLS,[i.CONFIGTYPE.ORBITCONTROLS]:i.MODULETYPE.CONTROLS,[i.CONFIGTYPE.SMAAPASS]:i.MODULETYPE.PASS,[i.CONFIGTYPE.UNREALBLOOMPASS]:i.MODULETYPE.PASS,[i.CONFIGTYPE.SCRIPTANIMATION]:i.MODULETYPE.ANIMATION,[i.CONFIGTYPE.KEYFRAMEANIMATION]:i.MODULETYPE.ANIMATION},ve=n=>{const e=t=>n.toLocaleLowerCase().includes(t.toLocaleLowerCase());for(const t of Object.values(i.MODULETYPE))if(e(t))return t;return null},ae=()=>({vid:"",name:"",type:i.CONFIGTYPE.OBJECT3D,castShadow:!0,receiveShadow:!0,lookAt:"",visible:!0,matrixAutoUpdate:!0,renderOrder:0,position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},up:{x:0,y:1,z:0},parent:"",children:[],pointerdown:[],pointermove:[],pointerup:[],pointerenter:[],pointerleave:[],click:[],dblclick:[],contextmenu:[]}),qe=function(){return Object.assign(ae(),{type:"Light",color:"rgb(255, 255, 255)",intensity:1})},Fr=function(){return Object.assign(ae(),{type:i.CONFIGTYPE.AMBIENTLIGHT,color:"rgb(255, 255, 255)",intensity:1})},Yr=function(){return Object.assign(qe(),{type:i.CONFIGTYPE.POINTLIGHT,distance:30,decay:.01})},jr=function(){return Object.assign(qe(),{type:i.CONFIGTYPE.SPOTLIGHT,distance:30,angle:Math.PI/180*45,penumbra:.01,decay:.01})},Br=function(){return Object.assign(qe(),{type:i.CONFIGTYPE.DIRECTIONALLIGHT,shadow:{mapSize:{width:512,height:512},camera:{near:.5,far:500}}})},xr=function(){return Object.assign(qe(),{type:i.CONFIGTYPE.HEMISPHERELIGHT,color:"rgb(255, 255, 255)",groundColor:"rgb(0, 0, 0)"})},_=function(){return{vid:"",type:"Geometry",position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},groups:[]}},Hr=function(){return Object.assign(_(),{type:i.CONFIGTYPE.BOXGEOMETRY,width:5,height:5,depth:5,widthSegments:1,heightSegments:1,depthSegments:1})},zr=function(){return Object.assign(_(),{type:i.CONFIGTYPE.SPHEREGEOMETRY,radius:3,widthSegments:32,heightSegments:32,phiStart:0,phiLength:Math.PI*2,thetaStart:0,thetaLength:Math.PI})},kr=function(){return Object.assign(_(),{type:i.CONFIGTYPE.PLANEGEOMETRY,width:5,height:5,widthSegments:1,heightSegments:1})},Vr=function(){return Object.assign(_(),{type:i.CONFIGTYPE.CIRCLEGEOMETRY,radius:3,segments:8,thetaStart:0,thetaLength:Math.PI*2})},$r=function(){return Object.assign(_(),{type:i.CONFIGTYPE.CONEGEOMETRY,radius:3,height:5,radialSegments:8,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:Math.PI*2})},Wr=function(){return Object.assign(_(),{type:i.CONFIGTYPE.TORUSGEOMETRY,radius:3,tube:.4,radialSegments:8,tubularSegments:6,arc:Math.PI*2})},_r=function(){return Object.assign(_(),{type:i.CONFIGTYPE.RINGGEOMETRY,innerRadius:2,outerRadius:3,thetaSegments:8,phiSegments:8,thetaStart:0,thetaLength:Math.PI*2})},Qr=function(){return Object.assign(_(),{type:i.CONFIGTYPE.LOADGEOMETRY,url:""})},Xr=function(){return Object.assign(_(),{type:i.CONFIGTYPE.CUSTOMGEOMETRY,attribute:{position:[],color:[],index:[],normal:[],uv:[],uv2:[]}})},Kr=function(){return Object.assign(_(),{type:i.CONFIGTYPE.CYLINDERGEOMETRY,radiusTop:3,radiusBottom:3,height:5,radialSegments:8,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:Math.PI*2})},Jr=function(){return Object.assign(_(),{type:"",radius:3,detail:0})},Zr=function(){return Object.assign(_(),{type:i.CONFIGTYPE.LOADGEOMETRY,url:"",thresholdAngle:1})},et=function(){return Object.assign(_(),{path:[],divisions:36,space:!0})},qr=function(){return Object.assign(et(),{type:i.CONFIGTYPE.LINECURVEGEOMETRY})},ei=function(){return Object.assign(et(),{type:i.CONFIGTYPE.SPLINECURVEGEOMETRY})},ti=function(){return Object.assign(et(),{type:i.CONFIGTYPE.CUBICBEZIERCURVEGEOMETRY})},ni=function(){return Object.assign(et(),{type:i.CONFIGTYPE.QUADRATICBEZIERCURVEGEOMETRY})},cn=function(){return Object.assign(_(),{type:"TubeGeometry",path:[],tubularSegments:64,radius:1,radialSegments:8,closed:!1})},ri=function(){return Object.assign(cn(),{type:i.CONFIGTYPE.LINETUBEGEOMETRY})},ii=function(){return Object.assign(cn(),{type:i.CONFIGTYPE.SPLINETUBEGEOMETRY})},oi=function(){return Object.assign(_(),{path:[],curveSegments:12})},si=function(){return Object.assign(oi(),{type:i.CONFIGTYPE.LINESHAPEGEOMETRY})},$e=function(){return{vid:"",type:"Texture",name:"",mapping:l.UVMapping,wrapS:l.ClampToEdgeWrapping,wrapT:l.ClampToEdgeWrapping,magFilter:l.LinearFilter,minFilter:l.LinearMipmapLinearFilter,anisotropy:1,format:l.RGBAFormat,flipY:!0,offset:{x:0,y:0},repeat:{x:1,y:1},rotation:0,center:{x:0,y:0},matrixAutoUpdate:!0,encoding:l.LinearEncoding,needsUpdate:!1}},ai=function(){return Object.assign($e(),{type:i.CONFIGTYPE.IMAGETEXTURE,url:""})},ci=function(){return Object.assign($e(),{type:i.CONFIGTYPE.VIDEOTEXTURE,url:"",minFilter:l.LinearFilter})},li=function(){return Object.assign($e(),{type:i.CONFIGTYPE.CUBETEXTURE,cube:{nx:"",ny:"",nz:"",px:"",py:"",pz:""},mapping:l.CubeReflectionMapping,flipY:!1})},ui=function(){return Object.assign($e(),{type:i.CONFIGTYPE.CANVASTEXTURE,url:"",needsUpdate:!1})},di=function(){return Object.assign($e(),{type:i.CONFIGTYPE.LOADTEXTURE,url:""})},Pe=function(){return{vid:"",type:"Material",alphaTest:0,colorWrite:!0,depthTest:!0,depthWrite:!0,fog:!0,name:"",needsUpdate:!1,opacity:1,dithering:!1,shadowSide:null,side:l.FrontSide,toneMapped:!0,transparent:!1,visible:!0,blendDst:l.OneMinusSrcAlphaFactor,blendDstAlpha:null,blendEquation:l.AddEquation,blendEquationAlpha:null,blending:l.NormalBlending,blendSrc:l.SrcAlphaFactor,blendSrcAlpha:null,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0}},hi=function(){return Object.assign(Pe(),{type:i.CONFIGTYPE.MESHBASICMATERIAL,color:"rgb(255, 255, 255)",combine:l.MultiplyOperation,aoMapIntensity:1,fog:!0,lightMapIntensity:1,reflectivity:1,refractionRatio:.98,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",wireframeLinewidth:1,map:"",envMap:"",alphaMap:"",aoMap:"",lightMap:"",specularMap:""})},ln=function(){return Object.assign(Pe(),{type:i.CONFIGTYPE.MESHSTANDARDMATERIAL,aoMapIntensity:1,bumpScale:1,color:"rgb(255, 255, 255)",displacementScale:1,displacementBias:0,emissive:"rgb(0, 0, 0)",emissiveIntensity:1,envMapIntensity:1,flatShading:!1,lightMapIntensity:1,metalness:0,normalMapType:l.TangentSpaceNormalMap,refractionRatio:.98,roughness:1,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",roughnessMap:"",normalMap:"",metalnessMap:"",map:"",lightMap:"",envMap:"",emissiveMap:"",displacementMap:"",bumpMap:"",alphaMap:"",aoMap:""})},pi=function(){return Object.assign(ln(),{type:i.CONFIGTYPE.MESHPHYSICALMATERIAL,attenuationColor:"rgb(255, 255, 255)",attenuationDistance:0,clearcoat:0,clearcoatNormalScale:{x:1,y:1},clearcoatRoughness:0,ior:1.5,reflectivity:.5,sheen:0,sheenRoughness:1,sheenColor:"rgb(255, 255, 255)",specularIntensity:0,specularColor:"rgb(255, 255, 255)",thickness:0,transmission:0,clearcoatMap:"",clearcoatNormalMap:"",clearcoatRoughnessMap:"",sheenRoughnessMap:"",sheenColorMap:"",specularIntensityMap:"",specularColorMap:"",thicknessMap:"",transmissionMap:""})},mi=function(){return Object.assign(Pe(),{type:i.CONFIGTYPE.MESHPHONGMATERIAL,aoMapIntensity:1,bumpScale:1,color:"rgb(255, 255, 255)",displacementScale:1,displacementBias:0,emissive:"rgb(0, 0, 0)",emissiveIntensity:1,envMapIntensity:1,flatShading:!1,lightMapIntensity:1,normalMapType:l.TangentSpaceNormalMap,refractionRatio:.98,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",specular:"rgb(17, 17, 17)",shininess:30,combine:l.MultiplyOperation,normalMap:"",map:"",lightMap:"",envMap:"",emissiveMap:"",displacementMap:"",bumpMap:"",alphaMap:"",aoMap:"",specularMap:""})},fi=function(){return Object.assign(Pe(),{type:i.CONFIGTYPE.SPRITEMATERIAL,color:"rgb(255, 255, 255)",rotation:0,map:"",alphaMap:"",sizeAttenuation:!0})},Ei=function(){return Object.assign(Pe(),{type:i.CONFIGTYPE.LINEBASICMATERIAL,color:"rgb(255, 255, 255)",linecap:"round",linejoin:"round",linewidth:1})},gi=function(){return Object.assign(Pe(),{type:i.CONFIGTYPE.POINTSMATERIAL,map:"",alphaMap:"",color:"rgb(255, 255, 255)",sizeAttenuation:!0,size:1})},yi=function(){return Object.assign(Pe(),{type:i.CONFIGTYPE.SHADERMATERIAL,shader:"defaultShader",uniforms:{}})},Ti=function(){return Object.assign(ae(),{type:i.CONFIGTYPE.PERSPECTIVECAMERA,adaptiveWindow:!1,fov:45,aspect:1920/1080,near:5,far:50})},Mi=function(){return Object.assign(ae(),{type:i.CONFIGTYPE.ORTHOGRAPHICCAMERA,adaptiveWindow:!1,left:-window.innerWidth,right:window.innerWidth,top:window.innerHeight,bottom:-window.innerHeight,near:5,far:50,zoom:1})},un=function(){return{vid:"",type:"Renderer",size:null}},Si=function(){return Object.assign(un(),{vid:i.CONFIGTYPE.WEBGLRENDERER,type:i.CONFIGTYPE.WEBGLRENDERER,clearColor:"rgba(0, 0, 0, 0)",outputEncoding:l.LinearEncoding,physicallyCorrectLights:!1,shadowMap:{enabled:!1,autoUpdate:!0,needsUpdate:!1,type:l.PCFShadowMap},toneMapping:l.NoToneMapping,toneMappingExposure:1,pixelRatio:window.devicePixelRatio,adaptiveCamera:!1,viewport:null,scissor:null})},Oi=function(){return Object.assign(un(),{vid:i.CONFIGTYPE.CSS3DRENDERER,type:i.CONFIGTYPE.CSS3DRENDERER})},Ci=function(){return Object.assign(ae(),{vid:i.CONFIGTYPE.SCENE,type:i.CONFIGTYPE.SCENE,background:"",environment:"",fog:{type:"",color:"rgb(150, 150, 150)",near:1,far:200,density:.003}})},bi=function(){return{vid:i.CONFIGTYPE.TRNASFORMCONTROLS,type:i.CONFIGTYPE.TRNASFORMCONTROLS,axis:"XYZ",enabled:!0,mode:"translate",snapAllow:!1,rotationSnap:Math.PI/180*10,translationSnap:5,scaleSnap:.1,showX:!0,showY:!0,showZ:!0,size:1,space:"world"}},Li=function(){return{vid:i.CONFIGTYPE.ORBITCONTROLS,type:i.CONFIGTYPE.ORBITCONTROLS,autoRotate:!1,autoRotateSpeed:2,enableDamping:!1,dampingFactor:.05,enabled:!0,enablePan:!0,enableRotate:!0,enableZoom:!0,maxAzimuthAngle:1/0,maxDistance:1/0,maxPolarAngle:Math.PI,maxZoom:1/0,minAzimuthAngle:-1/0,minDistance:0,minPolarAngle:0,minZoom:0,panSpeed:1,rotateSpeed:1,zoomSpeed:1,screenSpacePanning:!0,target:null}},tt=function(){return Object.assign(ae(),{material:"",geometry:""})},vi=function(){return Object.assign(tt(),{type:"Sprite",material:"",center:{x:.5,y:.5}})},Pi=function(){return Object.assign(tt(),{type:i.CONFIGTYPE.MESH,geometry:"",material:""})},Ri=function(){return Object.assign(tt(),{type:i.CONFIGTYPE.POINTS,geometry:"",material:""})},wi=function(){return Object.assign(tt(),{type:i.CONFIGTYPE.LINE,geometry:"",material:""})},Ii=function(){return Object.assign(ae(),{type:i.CONFIGTYPE.GROUP,children:[]})},Ct=function(){return{vid:"",type:"Pass"}},Ni=function(){return Object.assign(Ct(),{type:i.CONFIGTYPE.SMAAPASS})},Gi=function(){return Object.assign(Ct(),{type:i.CONFIGTYPE.UNREALBLOOMPASS,strength:1.5,threshold:0,radius:0})},Ai=function(){return Object.assign(Ct(),{type:i.CONFIGTYPE.SELECTIVEBLOOMPASS,strength:1,threshold:0,radius:0,renderScene:"",renderCamera:"",selectedObjects:[]})},dn=function(){return{vid:"",type:"",name:"",target:"",attribute:"",play:!0}},Di=function(){return Object.assign(dn(),{type:i.CONFIGTYPE.SCRIPTANIMATION,script:{name:""}})},Ui=function(){return Object.assign(dn(),{type:i.CONFIGTYPE.KEYFRAMEANIMATION,script:{name:""}})},bt=function(){return Object.assign(ae(),{type:i.CONFIGTYPE.CSS3DOBJECT,element:"",width:50,height:50})},Fi=function(){return Object.assign(bt(),{type:i.CONFIGTYPE.CSS3DPLANE})},Yi=function(){return Object.assign(bt(),{type:i.CONFIGTYPE.CSS3DSPRITE,rotation2D:0})},j={[i.CONFIGTYPE.IMAGETEXTURE]:ai,[i.CONFIGTYPE.CUBETEXTURE]:li,[i.CONFIGTYPE.CANVASTEXTURE]:ui,[i.CONFIGTYPE.VIDEOTEXTURE]:ci,[i.CONFIGTYPE.LOADTEXTURE]:di,[i.CONFIGTYPE.MESHBASICMATERIAL]:hi,[i.CONFIGTYPE.MESHSTANDARDMATERIAL]:ln,[i.CONFIGTYPE.MESHPHONGMATERIAL]:mi,[i.CONFIGTYPE.SPRITEMATERIAL]:fi,[i.CONFIGTYPE.LINEBASICMATERIAL]:Ei,[i.CONFIGTYPE.POINTSMATERIAL]:gi,[i.CONFIGTYPE.SHADERMATERIAL]:yi,[i.CONFIGTYPE.MESHPHYSICALMATERIAL]:pi,[i.CONFIGTYPE.AMBIENTLIGHT]:Fr,[i.CONFIGTYPE.SPOTLIGHT]:jr,[i.CONFIGTYPE.POINTLIGHT]:Yr,[i.CONFIGTYPE.DIRECTIONALLIGHT]:Br,[i.CONFIGTYPE.HEMISPHERELIGHT]:xr,[i.CONFIGTYPE.BOXGEOMETRY]:Hr,[i.CONFIGTYPE.SPHEREGEOMETRY]:zr,[i.CONFIGTYPE.LOADGEOMETRY]:Qr,[i.CONFIGTYPE.CUSTOMGEOMETRY]:Xr,[i.CONFIGTYPE.PLANEGEOMETRY]:kr,[i.CONFIGTYPE.CIRCLEGEOMETRY]:Vr,[i.CONFIGTYPE.CONEGEOMETRY]:$r,[i.CONFIGTYPE.CYLINDERGEOMETRY]:Kr,[i.CONFIGTYPE.EDGESGEOMETRY]:Zr,[i.CONFIGTYPE.LINECURVEGEOMETRY]:qr,[i.CONFIGTYPE.SPLINECURVEGEOMETRY]:ei,[i.CONFIGTYPE.CUBICBEZIERCURVEGEOMETRY]:ti,[i.CONFIGTYPE.QUADRATICBEZIERCURVEGEOMETRY]:ni,[i.CONFIGTYPE.DODECAHEDRONGEOMETRY]:Jr,[i.CONFIGTYPE.SPLINETUBEGEOMETRY]:ii,[i.CONFIGTYPE.LINETUBEGEOMETRY]:ri,[i.CONFIGTYPE.TORUSGEOMETRY]:Wr,[i.CONFIGTYPE.RINGGEOMETRY]:_r,[i.CONFIGTYPE.LINESHAPEGEOMETRY]:si,[i.CONFIGTYPE.OBJECT3D]:ae,[i.CONFIGTYPE.SPRITE]:vi,[i.CONFIGTYPE.LINE]:wi,[i.CONFIGTYPE.MESH]:Pi,[i.CONFIGTYPE.POINTS]:Ri,[i.CONFIGTYPE.GROUP]:Ii,[i.CONFIGTYPE.CSS3DOBJECT]:bt,[i.CONFIGTYPE.CSS3DSPRITE]:Yi,[i.CONFIGTYPE.CSS3DPLANE]:Fi,[i.CONFIGTYPE.PERSPECTIVECAMERA]:Ti,[i.CONFIGTYPE.ORTHOGRAPHICCAMERA]:Mi,[i.CONFIGTYPE.WEBGLRENDERER]:Si,[i.CONFIGTYPE.CSS3DRENDERER]:Oi,[i.CONFIGTYPE.SCENE]:Ci,[i.CONFIGTYPE.TRNASFORMCONTROLS]:bi,[i.CONFIGTYPE.ORBITCONTROLS]:Li,[i.CONFIGTYPE.SMAAPASS]:Ni,[i.CONFIGTYPE.UNREALBLOOMPASS]:Gi,[i.CONFIGTYPE.SELECTIVEBLOOMPASS]:Ai,[i.CONFIGTYPE.SCRIPTANIMATION]:Di,[i.CONFIGTYPE.KEYFRAMEANIMATION]:Ui};class Re{}class Lt extends Re{constructor(){super(...arguments);c(this,"selector",(e,t,r)=>t instanceof HTMLImageElement&&r.get(Lt)||null)}parse({url:e,resource:t,configMap:r,resourceMap:o}){const s=j[i.CONFIGTYPE.IMAGETEXTURE]();s.url=e,o.set(e,t),r.set(e,s)}}class vt extends Re{constructor(){super(...arguments);c(this,"selector",(e,t,r)=>t instanceof HTMLCanvasElement&&r.get(vt)||null)}parse({url:e,resource:t,configMap:r,resourceMap:o}){const s=j[i.CONFIGTYPE.CANVASTEXTURE]();s.url=e,o.set(e,t),r.set(e,s)}}class Pt extends Re{constructor(){super(...arguments);c(this,"selector",(e,t,r)=>t instanceof HTMLVideoElement&&r.get(Pt)||null)}parse({url:e,resource:t,configMap:r,resourceMap:o}){const s=j[i.CONFIGTYPE.VIDEOTEXTURE]();s.url=e,o.set(e,t),r.set(e,s)}}function hn(n,e){return n in e}function ji(n,e){return Object.values(n).includes(e)}function Bi(n){return e=>{const t=(r,o)=>{for(const s in o){if(r[s]===void 0){console.warn(` config can not set key: ${s}`);continue}typeof o[s]=="object"&&o[s]!==null&&!Array.isArray(o[s])?t(r[s],o[s]):r[s]=o[s]}};return e&&t(n,e),n}}function z(n,e,t,r){const o=(s,a,u)=>{for(const d in s)if(a[d]!==void 0&&!(u&&u[d])){if(typeof s[d]=="object"&&typeof s[d]!==null){u&&typeof u[d]=="object"&&typeof u[d]!==null?o(s[d],a[d],u[d]):o(s[d],a[d]);continue}a[d]=s[d]}};o(n,e,t),r&&r()}var xi=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",isValidKey:hn,isValidEnum:ji,generateConfigFunction:Bi,syncObject:z});class nt extends Re{constructor(){super(...arguments);c(this,"selector",(e,t,r)=>t.isObject3D&&r.get(nt)||null)}parse(e){this.parseObject3D(e)}parseColor(e){return`rgb(${Math.round(255*e.r)}, ${Math.round(255*e.g)}, ${Math.round(255*e.b)})`}attributeEnhance(e){const t={};for(const r in e)r.startsWith("_")?t[r.slice(1)]=e[r]:t[r]=e[r];return t}parseTexture({url:e,resource:t,configMap:r,resourceMap:o}){o.set(e,t);const s=j[i.CONFIGTYPE.LOADTEXTURE]();r.set(e,s),s.vid=J.v4(),s.url=e,z(t,s,{type:!0,vid:!0,url:!0})}parseMaterial({url:e,resource:t,configMap:r,resourceMap:o}){if(o.set(e,t),!j[t.type]){console.warn("can not found support config in vis for this resource",t);return}const s=j[t.type]();r.set(e,s),s.vid=J.v4(),z(this.attributeEnhance(t),s,{type:!0,vid:!0});for(const a in t)if(!!t[a]){if(t[a].isColor)s[a]=this.parseColor(t[a]);else if(a.toLocaleLowerCase().endsWith("map")&&t[a]){const u=`${e}.${a}`;this.parseTexture({url:u,resource:t[a],configMap:r,resourceMap:o}),s[a]=r.get(u).vid}}}parseGeometry({url:e,resource:t,configMap:r,resourceMap:o}){o.set(e,t),t.computeBoundingBox();const s=t.boundingBox,a=s.getCenter(new l.Vector3),u=j[i.CONFIGTYPE.LOADGEOMETRY]();u.vid=J.v4(),u.url=e,u.position.x=a.x/(s.max.x-s.min.x)*2,u.position.y=a.y/(s.max.y-s.min.y)*2,u.position.z=a.z/(s.max.z-s.min.z)*2,r.set(e,u)}parseObject3D({url:e,resource:t,configMap:r,resourceMap:o}){if(o.set(e,t),!j[t.type]){console.warn("can not found support config in vis for this resource",t);return}const s=j[t.type]();if(s.vid=J.v4(),z(t,s,{type:!0,vid:!0,children:!0,geometry:!0,material:!0,parent:!0,lookAt:!0}),s.rotation.x=t.rotation.x,s.rotation.y=t.rotation.y,s.rotation.z=t.rotation.z,r.set(e,s),t.material)if(Array.isArray(t.material))s.material=[],t.material.forEach((a,u,d)=>{const h=`${e}.material.${u}`;this.parseMaterial({url:h,resource:a,configMap:r,resourceMap:o}),s.material.push(r.get(h).vid)});else{const a=`${e}.material`;this.parseMaterial({url:a,resource:t.material,configMap:r,resourceMap:o}),s.material=r.get(a).vid}if(t.geometry){const a=`${e}.geometry`;this.parseGeometry({url:a,resource:t.geometry,configMap:r,resourceMap:o}),s.geometry=r.get(a).vid}t.children&&t.children.length&&t.children.forEach((a,u,d)=>{const h=`${e}.children.${u}`;this.parseObject3D({url:h,resource:a,configMap:r,resourceMap:o}),s.children.push(r.get(h).vid)})}}class Rt extends Re{constructor(){super(...arguments);c(this,"selector",(e,t,r)=>t instanceof HTMLElement&&r.get(Rt)||null)}parse({url:e,resource:t,configMap:r,resourceMap:o}){const s=j[i.CONFIGTYPE.CSS3DPLANE]();s.element=e,o.set(e,t),r.set(e,s)}}class wt extends Re{constructor(){super(...arguments);c(this,"selector",(e,t,r)=>t instanceof l.Texture&&r.get(wt)||null)}parse({url:e,resource:t,configMap:r,resourceMap:o}){const s=j[i.CONFIGTYPE.LOADTEXTURE]();s.url=e,o.set(e,t),r.set(e,s)}}class It extends Re{constructor(){super();c(this,"object3DParser",new nt);c(this,"selector",(e,t,r)=>t.parser&&t.animations&&t.scene&&t.scenes&&r.get(It)||null)}parse({url:e,resource:t,configMap:r,resourceMap:o}){this.object3DParser.parse({url:`${e}.scene`,resource:t.scene,configMap:r,resourceMap:o})}}i.RESOURCEEVENTTYPE=void 0,function(n){n.MAPPED="mapped"}(i.RESOURCEEVENTTYPE||(i.RESOURCEEVENTTYPE={}));class pn extends Z{constructor(e={}){super();c(this,"structureMap",new Map);c(this,"configMap",new Map);c(this,"resourceMap",new Map);c(this,"paserMap",new Map);this.addParser(new Lt).addParser(new vt).addParser(new Pt).addParser(new nt).addParser(new Rt).addParser(new wt).addParser(new It);const t=new Map;for(const r in e)t.has(r)&&console.warn(`resourceManager construct params rescource already exist: ${r}, that will be cover.`),t.set(r,e[r]);this.mappingResource(t)}addParser(e){return this.paserMap.has(e.constructor)?this:(this.paserMap.set(e.constructor,e),this)}mappingResource(e,t){const r=this.configMap,o=this.resourceMap,s=[...this.paserMap.values()],a={};for(const[u,d]of e.entries()){if((t==null?void 0:t.parser)&&t.parser[u]){t.parser[u].parse({url:u,resource:d,configMap:r,resourceMap:o});continue}if((t==null?void 0:t.selector)&&t.selector[u]){const m=t.selector[u](u,d,this.paserMap);if(!m){console.warn("resource manager hanlder can not found this resource parser: ",d,t.selector[u]);continue}m.parse({url:u,resource:d,configMap:r,resourceMap:o}),a[u]=this.getResourceConfig(u);continue}let h=null;for(const m of s)if(h=m.selector(u,d,this.paserMap),h)break;if(!h){console.warn("resouce manager can not found some handler to parser this resource:",d);continue}h.parse({url:u,resource:d,configMap:r,resourceMap:o}),a[u]=this.getResourceConfig(u)}return this.dispatchEvent({type:"mapped",structureMap:this.structureMap,configMap:r,resourceMap:o,resourceConfig:a}),this}getResourceConfig(e){const t=this.configMap,r={};return[...t.keys()].filter(o=>o.startsWith(e)).some(o=>{const s=t.get(o);if(!s)console.error(`unknow error: can not found config by url: ${o}`);else{const a=ve(s.type);a?(!r[a]&&(r[a]={}),r[a][s.vid]=s):console.error(`unknow error: can not found module by type: ${s.type}`,s)}}),r}hasResource(e){return this.resourceMap.has(e)}remove(e){const t=this.configMap,r=this.resourceMap;return[...t.keys()].filter(o=>o.startsWith(e)).forEach(o=>{t.delete(o);const s=r.get(o);s.dispose&&s.dispose(),r.delete(o)}),this}dispose(){this.resourceMap.forEach((e,t)=>{e.dispose&&e.dispose()}),this.resourceMap.clear(),this.configMap.clear()}}const Hi=function(n){if(this.resourceManager)return console.warn("engine has installed resourceManager plugin."),!1;const e=new pn(n.resources);return this.resourceManager=e,this.loaderManager&&this.loaderManager.addEventListener("loaded",t=>{this.resourceManager.mappingResource(t.resourceMap)}),this.registerResources=t=>{const r=new Map;return Object.keys(t).forEach(o=>{r.set(o,t[o])}),this.resourceManager.mappingResource(r),this},this.addEventListener("dispose",()=>{this.resourceManager.dispose()}),!0},Fe=(n,e)=>e===1/0?"Infinity":e===-1/0?"-Infinity":e,Nt=(n,e)=>e==="Infinity"?1/0:e==="-Infinity"?-1/0:e,We=n=>JSON.parse(JSON.stringify(n,Fe),Nt);var rt={stringify:Fe,parse:Nt,clone:We},zi=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",stringify:Fe,parse:Nt,clone:We,default:rt});const K=class extends Z{constructor(e){super();c(this,"ignoreAttribute");this.ignoreAttribute=e||{}}static proxyGetter(e,t,r){return Reflect.get(e,t,r)}static proxySetter(e,t,r,o,s,a){if(typeof t=="symbol")return Reflect.set(e,t,r,o);K.cacheArray(r);let u;if(e[t]===void 0){if(typeof r=="object"&&r!==null&&!K.proxyWeakSet.has(r)&&!s.ignoreAttribute[t]){const d=a.concat([t]);r=s.proxyExtends(r,d)}u=Reflect.set(e,t,r),s.broadcast({operate:"add",path:a.concat([]),key:t,value:r})}else{if(typeof r=="object"&&r!==null&&!K.proxyWeakSet.has(r)&&!s.ignoreAttribute[t]){const d=a.concat([t]);r=s.proxyExtends(r,d)}if(u=Reflect.set(e,t,r),Array.isArray(e)&&t==="length"){const d=e[Symbol.for(K.arraySymobl)],h=d.length-e.length;if(h>0){let m=0,E=0;for(const T of d){if(!e.includes(T)&&(s.broadcast({operate:"delete",path:a.concat([]),key:E.toString(),value:T}),m+=1,m===h))break;E+=1}}return e[Symbol.for(this.arraySymobl)]=e.concat([]),u}s.broadcast({operate:"set",path:a.concat([]),key:t,value:r})}return u}static proxyDeleter(e,t,r,o){const s=e[t],a=Reflect.deleteProperty(e,t);return Array.isArray(e)||typeof t=="symbol"||r.broadcast({operate:"delete",path:o.concat([]),key:t,value:s}),a}setIgnore(e){this.ignoreAttribute=Object.assign(this.ignoreAttribute,e)}proxyExtends(e,t=[],r=!0){if(K.proxyWeakSet.has(e)||typeof e!="object")return e;const o={get:K.proxyGetter,set:(a,u,d,h)=>K.proxySetter(a,u,d,h,this,t),deleteProperty:(a,u)=>K.proxyDeleter(a,u,this,t)};if(typeof e=="object"&&e!==null)for(const a in e){const u=t.concat([a]);let d=this.ignoreAttribute,h=!1;for(const m of r?u.slice(1):u){if(d[m]===!0){h=!0;break}d[m]&&(d=d[m])}h||hn(a,e)&&typeof e[a]=="object"&&e[a]!==null&&(K.cacheArray(e[a]),e[a]=this.proxyExtends(e[a],u))}const s=new Proxy(e,o);return K.proxyWeakSet.add(s),s}broadcast({operate:e,path:t,key:r,value:o}){return{__poto__:!0,length:!0}[r]?this:(this.dispatchEvent({type:"broadcast",notice:{operate:e,path:t,key:r,value:o}}),this)}};let we=K;c(we,"proxyWeakSet",new WeakSet),c(we,"arraySymobl","vis.array"),c(we,"cacheArray",function(e){Array.isArray(e)&&!e[Symbol.for(K.arraySymobl)]&&(e[Symbol.for(K.arraySymobl)]=e.concat([]))});class mn{constructor(){c(this,"rule");c(this,"memberSet");this.rule=function(){},this.memberSet=new Set}apply(e){return this.memberSet.add(e),this}cancel(e){return this.memberSet.delete(e),this}setRule(e){return this.rule=e,this}translate(e){const t=this.rule;return this.memberSet.forEach(r=>{t(e,r)}),this}}class re{constructor(e,t,r){c(this,"data");c(this,"broadcast");c(this,"translater");this.translater=new mn().setRule(e),this.broadcast=new we(r),this.data=this.broadcast.proxyExtends(t),this.broadcast.addEventListener("broadcast",o=>{this.translater.translate(o.notice)})}getData(){return this.data}setData(e){return this.data=e,this}proxyData(e){return this.data=this.broadcast.proxyExtends(e),this.data}existSymbol(e){return Boolean(this.data[e])}addConfig(e){return this.data[e.vid]=e,this}getConfig(e){return this.data[e]}removeConfig(e){const t=this.data;t[e]!==void 0&&delete t[e]}addCompiler(e){return e.setTarget(this.data),e.compileAll(),this.translater.apply(e),this}toJSON(e=!0){return e?JSON.stringify(this.exportConfig(),Fe):JSON.stringify(this.data,Fe)}exportConfig(e=!0){if(e){const t=this.data,r={},o={},s=(a,u,d={})=>{for(const h in a){if(["vid","type"].includes(h)){d[h]=a[h];continue}if(typeof a[h]=="object"&&a[h]!==null){if(Array.isArray(a[h])){if(!a[h].length)continue;d[h]=a[h].map(m=>typeof m=="object"&&m!==null?We(m):m);continue}d[h]={},u[h]?(s(a[h],u[h],d[h]),Object.keys(d[h]).length===0&&delete d[h]):d[h]=We(a[h])}else u[h]!==a[h]&&(d[h]=a[h])}};for(const a of Object.values(t)){if(!o[a.type]){if(!j[a.type]){console.error(`can not font some config with: ${a.type}`);continue}o[a.type]=j[a.type]()}r[a.vid]={},s(a,o[a.type],r[a.vid])}return r}else return We(this.data)}load(e){const t=this.data,r={},o=(s,a)=>{for(const u in a)typeof s[u]=="object"&&s[u]!==null&&typeof a[u]=="object"&&a[u]!==null?o(s[u],a[u]):s[u]===void 0&&(s[u]=a[u])};for(const s in e){const a=e[s];if(!r[a.type]){if(!j[a.type]){console.error(`can not font some config with: ${a.type}`);continue}r[a.type]=j[a.type]()}o(a,r[a.type]),t[s]=a}return this}remove(e){const t=this.data;for(const r in e)t[r]!==void 0&&delete t[r];return this}getModule(){return this.MODULE}}const ce=(n,e,t=J.validate)=>{const{operate:r,key:o,path:s,value:a}=n;let u=o;const d=[].concat(s);if(s.length&&(u=d.shift()),!t(u)){console.warn(`${e.MODULE} Rule: vid is illeage: ${u}`);return}if(r==="add"&&!d.length){e.add(a);return}if(n.operate==="delete"&&!d.length){e.remove(a);return}if(n.operate==="set"&&!d.length&&o===u){e.cover(a);return}e.compile(u,{operate:r,key:o,path:d,value:a})},ki=function(n,e){ce(n,e)};class fn extends re{constructor(e,t){!e&&(e={});super(ki,e,t);c(this,"MODULE",i.MODULETYPE.TEXTURE)}}const Vi=function(n,e){ce(n,e)};class En extends re{constructor(e,t){!e&&(e={});super(Vi,e,t);c(this,"MODULE",i.MODULETYPE.MATERIAL)}}class Ye extends re{constructor(e,t,r){!t&&(t=Object.create(Object.prototype));super(e,t,r);c(this,"MODULE",i.MODULETYPE.GROUP)}}const le=function(n,e){n.key!=="parent"&&ce(n,e)},$i=function(n,e){le(n,e)};class gn extends Ye{constructor(e,t){!e&&(e={});super($i,e,t);c(this,"MODULE",i.MODULETYPE.LIGHT)}}const Wi=function(n,e){ce(n,e)};class yn extends re{constructor(e,t){!e&&(e={});super(Wi,e,t);c(this,"MODULE",i.MODULETYPE.GEOMETRY)}}const _i=function(n,e){le(n,e)};class Tn extends Ye{constructor(e,t){!e&&(e={});super(_i,e,t);c(this,"MODULE",i.MODULETYPE.CAMERA)}}const Qi=function(n,e){ce(n,e,t=>J.validate(t)||[i.CONFIGTYPE.WEBGLRENDERER,i.CONFIGTYPE.CSS3DRENDERER].includes(t))};class Mn extends re{constructor(e,t){!e&&(e={});super(Qi,e,t);c(this,"MODULE",i.MODULETYPE.RENDERER)}}const Xi=function(n,e){ce(n,e,t=>J.validate(t)||[i.CONFIGTYPE.SCENE].includes(t))};class Sn extends Ye{constructor(e,t){!e&&(e={});super(Xi,e,t);c(this,"MODULE",i.MODULETYPE.SCENE)}}const Ki=function(n,e){ce(n,e,t=>J.validate(t)||[i.CONFIGTYPE.TRNASFORMCONTROLS,i.CONFIGTYPE.ORBITCONTROLS].includes(t))};class On extends re{constructor(e,t){!e&&(e={});super(Ki,e,t);c(this,"MODULE",i.MODULETYPE.CONTROLS)}}class it extends re{constructor(e,t,r){!t&&(t=Object.create(Object.prototype));super(e,t,r);c(this,"MODULE",i.MODULETYPE.MESH)}}const Ji=function(n,e){n.key!=="geometry"&&le(n,e)};class Cn extends it{constructor(e,t){!e&&(e={});super(Ji,e,t);c(this,"MODULE",i.MODULETYPE.SPRITE)}}const Zi=function(n,e){le(n,e)};class bn extends it{constructor(e,t){!e&&(e={});super(Zi,e,t);c(this,"MODULE",i.MODULETYPE.LINE)}}const qi=function(n,e){le(n,e)};class Ln extends it{constructor(e,t){!e&&(e={});super(qi,e,t);c(this,"MODULE",i.MODULETYPE.MESH)}}const eo=function(n,e){le(n,e)};class vn extends it{constructor(e,t){!e&&(e={});super(eo,e,t);c(this,"MODULE",i.MODULETYPE.POINTS)}}const to=function(n,e){le(n,e)};class Pn extends Ye{constructor(e,t){!e&&(e={});super(to,e,t);c(this,"MODULE",i.MODULETYPE.GROUP)}}const no=function(n,e){ce(n,e)};class Rn extends re{constructor(e,t){!e&&(e={});super(no,e,t);c(this,"MODULE",i.MODULETYPE.PASS)}}const ro=function(n,e){n.key==="name"&&n.path.length===1||ce(n,e)};class wn extends re{constructor(e,t){!e&&(e={});super(ro,e,t);c(this,"MODULE",i.MODULETYPE.ANIMATION)}}const io=function(n,e){le(n,e)};class In extends Ye{constructor(e,t){!e&&(e={});super(io,e,t);c(this,"MODULE",i.MODULETYPE.CSS3D)}}const oo=function(n,e){le(n,e)};class Nn extends Ye{constructor(e,t){!e&&(e={});super(oo,e,t);c(this,"MODULE",i.MODULETYPE.OBJECT3D)}}class Gn{constructor(e){c(this,"object3DDataSupport",new Nn);c(this,"cameraDataSupport",new Tn);c(this,"lightDataSupport",new gn);c(this,"geometryDataSupport",new yn);c(this,"textureDataSupport",new fn);c(this,"materialDataSupport",new En);c(this,"rendererDataSupport",new Mn);c(this,"sceneDataSupport",new Sn);c(this,"controlsDataSupport",new On);c(this,"spriteDataSupport",new Cn);c(this,"lineDataSupport",new bn);c(this,"meshDataSupport",new Ln);c(this,"pointsDataSupport",new vn);c(this,"groupDataSupport",new Pn);c(this,"css3DDataSupport",new In);c(this,"passDataSupport",new Rn);c(this,"animationDataSupport",new wn);c(this,"dataSupportMap");e&&Object.keys(e).forEach(r=>{this[r]!==void 0&&(this[r]=e[r])});const t=new Map;Object.keys(this).forEach(r=>{const o=this[r];o instanceof re&&t.set(o.MODULE,o)}),this.dataSupportMap=t}getDataSupport(e){return this.dataSupportMap.has(e)?this.dataSupportMap.get(e):(console.warn(`can not found this type in dataSupportManager: ${e}`),null)}getSupportData(e){return this.dataSupportMap.has(e)?this.dataSupportMap.get(e).getData():(console.warn(`can not found this type in dataSupportManager: ${e}`),null)}setSupportData(e,t){return this.dataSupportMap.has(e)?this.dataSupportMap.get(e).setData(t):console.warn(`can not found this type in dataSupportManager: ${e}`),this}getConfigBySymbol(e){const t=this.dataSupportMap.values();for(const r of t){const o=r.getConfig(e);if(o)return o}return null}removeConfigBySymbol(...e){const t=this.dataSupportMap.values();for(const r of e)for(const o of t)if(o.existSymbol(r)){o.removeConfig(r);break}return this}getModuleBySymbol(e){const t=this.dataSupportMap.values();for(const r of t)if(r.existSymbol(e))return r.MODULE;return null}applyConfig(...e){for(const t of e){const r=ve(t.type);r?this.dataSupportMap.get(r).addConfig(t):console.warn(`dataSupportManager can not found this config module: ${t.type}`)}return this}reactiveConfig(e){const t=ve(e.type);return t?this.dataSupportMap.get(t).addConfig(e).getConfig(e.vid):(console.warn(`dataSupportManager can not found this config module: ${e.type}`),e)}load(e){return this.dataSupportMap.forEach((r,o)=>{e[o]&&r.load(e[o])}),this}remove(e){return this.dataSupportMap.forEach((r,o)=>{e[o]&&r.remove(e[o])}),this}toJSON(e={},t=!0){return JSON.stringify(this.exportConfig(e,t),Fe)}exportConfig(e={},t=!0){return this.dataSupportMap.forEach((o,s)=>{e[s]=o.exportConfig(t)}),e}}const so={name:"uvPulseShader",uniforms:{time:{value:0},width:{value:.5},color:{value:{r:1,g:0,b:0}},center:{value:{x:.5,y:.5}}},vertexShader:`
    varying vec2 vUv;

    void main () {

      vUv = uv;

      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }`,fragmentShader:`
    uniform float width;
    uniform float time;
    uniform vec3 color;
    uniform vec2 center;

    varying vec2 vUv;

    void main () {
      // \u6839\u636EuTime\u6C42\u51FA\u767E\u5206\u6BD4
      float deg = mod(degrees(time), 360.0);
      if (deg > 0.0 && deg < 180.0) {
        discard;
      }

      float percent = cos(time);
      float distancePercent = distance(center, vUv);

      // \u4ECE\u5916\u5411\u91CC
      if (distancePercent > 0.5) {
        discard;
      }

      if (distancePercent < percent) {
        discard;
      }

      if (distancePercent - percent > width) {
        discard;
      }

      float opacity =  (width - (distancePercent - percent)) / width;

      // float opacity = distancePercent;
      gl_FragColor = vec4(color, opacity);
    }`},ao={name:"fragCoordTestingShader",uniforms:{resolution:{value:{x:1920,y:1080}}},vertexShader:`
  void main () {
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }`,fragmentShader:`
    uniform vec2 resolution;

    void main () {
      vec2 st = gl_FragCoord.xy / resolution;
      gl_FragColor = vec4(st.x,st.y,0.0,1.0);
    }`},co={name:"colorMixShader",uniforms:{colorA:{value:{r:1,g:0,b:0}},colorB:{value:{r:0,g:1,b:0}},percent:{value:.5}},vertexShader:`
  void main () {
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }`,fragmentShader:`
    uniform vec3 colorA;
    uniform vec3 colorB;
    uniform float percent;

    void main () {
      gl_FragColor = vec4(mix(colorA, colorB, percent), 1.0);
    }`},lo={name:"BloomShader",uniforms:{brightness:{value:.8},extend:{value:5},specular:{value:.9},outFade:{value:2},inFade:{value:.3},color:{value:{r:1,g:1,b:1}}},vertexShader:`
  uniform float extend;

  varying vec3 vNormal;
  varying vec3 vView;

  void main () {

    vec3 extendPosition = position + normalize(position) * extend;

    vNormal = normalize(position);
    vView = normalize(cameraPosition - (modelMatrix * vec4(extendPosition , 1.0 )).xyz);

    gl_Position = projectionMatrix * modelViewMatrix * vec4(extendPosition , 1.0 );
  }`,fragmentShader:`
    uniform vec3 color;
    uniform float brightness;
    uniform float specular;
    uniform float outFade;
    uniform float inFade;

    varying vec3 vNormal;
    varying vec3 vView;
    
    void main () {

      float present = smoothstep(0.0, 1.0, dot(vView, vNormal));

      if (present >= specular) {
        present = pow(smoothstep(1.0, specular, present), inFade);
      } else {
        present = pow(smoothstep(0.0, specular, present), outFade);
      }

      gl_FragColor = vec4(color, present * brightness);
    }`},de=class{static getShader(e){return de.library.has(e)?de.cloneShader(de.library.get(e)):(console.warn(`con not found shader in shader library: ${e}`),null)}static generateConfig(e){if(!de.library.has(e))return console.warn(`con not found shader in shader library: ${e}`),{};const t=de.library.get(e),r={shader:e,uniforms:{}};return t.uniforms&&(r.uniforms=JSON.parse(JSON.stringify(t.uniforms))),r}static cloneShader(e){const t={name:e.name};return e.vertexShader&&(t.vertexShader=e.vertexShader),e.fragmentShader&&(t.fragmentShader=e.fragmentShader),e.uniforms&&(t.uniforms=JSON.parse(JSON.stringify(e.uniforms))),t}};let q=de;c(q,"library",new Map),c(q,"reigster",function(e){de.library.has(e.name)&&console.warn(`shader library has exist shader: ${e.name} that will be cover.`),de.library.set(e.name,e)});const uo={name:"defaultShader"};q.reigster(uo),q.reigster(so),q.reigster(ao),q.reigster(co),q.reigster(lo);const B=function(n,e,t=!0,r=!0){if(!j[n])return console.error(`type: ${n} can not be found in configList.`),{vid:"",type:n};const o=(a,u)=>{for(const d in u){if(a[d]===void 0){!t&&(a[d]=u[d]),t&&r&&console.warn(`'${n}' config can not set key: ${d}`);continue}typeof u[d]=="object"&&u[d]!==null&&!Array.isArray(u[d])?(a[d]===null&&(a[d]=F({},u[d])),o(a[d],u[d])):a[d]=u[d]}},s=j[n]();if([i.CONFIGTYPE.SHADERMATERIAL].includes(n)){const a=q.generateConfig((e==null?void 0:e.shader)||"defaultShader"),u=t;t=!1,o(s,a),t=u}if([i.CONFIGTYPE.SCRIPTANIMATION,i.CONFIGTYPE.KEYFRAMEANIMATION].includes(n)&&(t=!1),s.vid===""&&(s.vid=J.v4()),e&&o(s,e),B.autoInject&&B.injectEngine){const a=B.injectEngine,u=a.reactiveConfig(s);if(B.injectScene&&ve(s.type)in i.OBJECTMODULE&&s.type!==i.CONFIGTYPE.SCENE){let d=null;typeof B.injectScene=="boolean"?d=a.getObjectConfig(a.scene):typeof B.injectScene=="string"&&(d=a.getConfigBySymbol(B.injectScene)),d?d.children.push(s.vid):console.warn("current engine scene can not found it config",a,a.scene)}return u}return s};B.autoInject=!0,B.injectScene=!1,B.injectEngine=null;const ho=function(n){if(this.dataSupportManager)return console.warn("engine has installed dataSupportManager plugin."),!1;const e=new Gn(n);return this.dataSupportManager=e,this.applyConfig=function(...t){return this.dataSupportManager.applyConfig(...t),this},this.reactiveConfig=function(t){return this.dataSupportManager.reactiveConfig(t)},this.getConfigBySymbol=function(t){return this.dataSupportManager.getConfigBySymbol(t)},this.removeConfigBySymbol=function(...t){return this.dataSupportManager.removeConfigBySymbol(...t),this},this.toJSON=function(){if(this.loaderManager){const t={assets:JSON.parse(this.loaderManager.toJSON())};return this.dataSupportManager.toJSON(t)}return this.dataSupportManager.toJSON()},this.exportConfig=function(){let t={};return this.loaderManager&&(t={assets:this.loaderManager.exportConfig()}),this.dataSupportManager.exportConfig(t)},this.completeSet.add(()=>{const t=this.dataSupportManager.getDataSupport(i.MODULETYPE.RENDERER).getData();t.WebGLRenderer||(t.WebGLRenderer=B(i.CONFIGTYPE.WEBGLRENDERER));const r=this.dataSupportManager.getDataSupport(i.MODULETYPE.CONTROLS).getData();this.transformControls&&(r[i.CONFIGTYPE.TRNASFORMCONTROLS]||(r[i.CONFIGTYPE.TRNASFORMCONTROLS]=B(i.CONFIGTYPE.TRNASFORMCONTROLS))),this.orbitControls&&(r[i.CONFIGTYPE.ORBITCONTROLS]||(r[i.CONFIGTYPE.ORBITCONTROLS]=B(i.CONFIGTYPE.ORBITCONTROLS)))}),!0},ne=class{constructor(){c(this,"target",{});c(this,"map",new Map);c(this,"weakMap",new WeakMap);c(this,"engine");c(this,"cacheCompile")}getMap(){return this.map}useEngine(e){return this.engine=e,this}setTarget(e){return this.target=e,this}add(e){if(!ne.processors.has(e.type))return console.warn(`${this.MODULE} compiler can not support this type: ${e.type}`),null;const r=ne.processors.get(e.type).create(e,this.engine);return this.map.set(e.vid,r),this.weakMap.set(r,e.vid),r}remove(e){const t=e.vid;if(!this.map.has(t))return console.warn(`${this.MODULE} compiler can not found this vid object: ${t}.`),this;if(!ne.processors.has(e.type))return console.warn(`${this.MODULE} compiler can not support this type: ${e.type}`),this;const r=this.map.get(t);return ne.processors.get(e.type).dispose(r),this.map.delete(t),this.weakMap.delete(r),this}cover(e){const t=e.vid;return this.map.has(t)?(Promise.resolve().then(()=>{z(e,e,{vid:!0,type:!0})}),this):(console.warn(`${this.MODULE} compiler can not found this vid object: ${t}.`),this)}compile(e,t){const r=this.cacheCompile;let o,s,a;if(r&&r.vid===e)o=r.target,s=r.config,a=r.processor;else{if(!this.map.has(e))return console.warn(`${this.MODULE} compiler set function: can not found object which vid is: '${e}'`),this;if(!this.target[e])return console.warn(`${this.MODULE} compiler set function: can not found config which vid is: '${e}'`),this;if(o=this.map.get(e),s=this.target[e],!ne.processors.has(s.type))return console.warn(`PassCompiler can not support this type: ${s.type}`),this;a=ne.processors.get(s.type),this.cacheCompile={target:o,config:s,processor:a,vid:e}}return a.process(F({config:s,target:o,engine:this.engine,processor:a,compiler:this},t)),this}compileAll(){const e=this.target;for(const t of Object.values(e))this.add(t);return this}dispose(){this.cacheCompile&&(this.cacheCompile=void 0);for(const e of Object.values(this.target)){if(!this.map.has(e.vid)){console.warn(`${this.MODULE} compiler set function: can not found object which vid is: '${e.vid}'`);continue}const t=this.map.get(e.vid);if(!ne.processors.has(e.type)){console.warn(`${this.MODULE}  can not support this type: ${e.type}`);continue}ne.processors.get(e.type).dispose(t)}return this.map.clear(),this.target={},this}getObjectSymbol(e){return this.weakMap.get(e)||null}getObjectBySymbol(e){return this.map.get(e)||null}};let g=ne;c(g,"processors",new Map),c(g,"processor",function(e){ne.processors.set(e.configType,e)});const Ie="vis.scriptAni";class po{constructor(e){c(this,"configType");c(this,"commands");c(this,"create");c(this,"dispose");this.configType=e.configType,this.commands=e.commands,this.create=e.create,this.dispose=e.dispose}process(e){if(!this.commands||!this.commands[e.operate]){this[e.operate](e);return}let t=this.commands[e.operate];for(const r of[].concat(e.path,e.key))if(!t[r]&&!t.$reg){this[e.operate](e);return}else if(t[r])if(typeof t[r]=="function"){t[r](e);return}else t=t[r];else if(t.$reg){for(const o of t.$reg)if(o.reg.test(r)){o.handler(e);return}}this[e.operate](e)}add(e){let t=e.target;const r=e.path;for(const o of r)if(typeof t[o]!==void 0)t=t[o];else{console.warn("processor can not exec default add operate.",e);return}t[e.key]=e.value}set(e){let t=e.target;const r=e.path;for(const o of r)if(typeof t[o]!==void 0)t=t[o];else{console.warn("processor can not exec default set operate.",e);return}t[e.key]=e.value}delete(e){let t=e.target;const r=e.path;for(const o of r)if(typeof t[o]!==void 0)t=t[o];else{console.warn("processor can not exec default delete operate.",e);return}delete t[e.key]}}const b=n=>new po(n),ot=function(){},mo={name:"linearTime",multiply:1},fo=function(n,e,t,r){return e[t]===void 0?(console.warn(`object not exist attribute: ${t}`,e),o=>{}):typeof e[t]!="number"?(console.warn("object attribute is not typeof number.",e,t),o=>{}):o=>{e[t]+=o.delta*r.multiply}},Eo={name:"sinWave",wavelength:1,offset:0,amplitude:1,speed:1},go=function(n,e,t,r){if(e[t]===void 0)return console.warn(`object not exist attribute: ${t}`,e),s=>{};if(typeof e[t]!="number")return console.warn("object attribute is not typeof number.",e,t),s=>{};const o=e[t];return s=>{e[t]=o+r.amplitude*Math.sin(s.total*r.speed/r.wavelength)+r.offset}},ie=class{static generateConfig(e,t){if(!ie.configLibrary.has(e))return console.warn(`event library can not found config by name: ${e}`),{name:""};const r=(s,a)=>{for(const u in a)s[u]!==void 0&&(typeof a[u]=="object"&&a[u]!==null&&!Array.isArray(a[u])?r(s[u],a[u]):s[u]=a[u])},o=JSON.parse(JSON.stringify(ie.configLibrary.get(e)));return r(o,t),o}static generateScript(e,t,r,o){return ie.generatorLibrary.has(o.name)?ie.generatorLibrary.get(o.name)(e,t,r,o):(console.error(`event library can not found generator by name: ${o.name}`),()=>{})}static has(e){return ie.configLibrary.has(e)}};let fe=ie;c(fe,"configLibrary",new Map),c(fe,"generatorLibrary",new Map),c(fe,"register",function(e,t){ie.configLibrary.has(e.name)&&console.warn(`EventLibrary has already exist this event generator: ${e.name}, that will be cover.`),ie.configLibrary.set(e.name,JSON.parse(JSON.stringify(e))),ie.generatorLibrary.set(e.name,t)}),fe.register(mo,fo),fe.register(Eo,go);const An=function(n,e){let t=e.compilerManager.getObjectBySymbol(n.target);if(!t)return console.warn(`can not found object in enigne: ${n.target}`),()=>{};const r=n.attribute.split(".");r.shift();const o=r.pop();for(const s of r){if(t[s]===void 0)return console.warn(`animaton processor: target object can not found key: ${s}`,t),()=>{};t=t[s]}return fe.generateScript(e,t,o,n.script)};var yo=b({configType:i.CONFIGTYPE.SCRIPTANIMATION,commands:{set:{play({target:n,engine:e,value:t}){t?e.renderManager.addEventListener("render",n):e.renderManager.removeEventListener("render",n)},$reg:[{reg:new RegExp(".*"),handler({config:n,engine:e}){const t=n[Symbol.for(Ie)];e.renderManager.removeEventListener("render",t);const r=An(n,e);n[Symbol.for(Ie)]=r,n.play&&e.renderManager.addEventListener("render",t)}}]}},create(n,e){const t=An(n,e);return n.play&&e.renderManager.addEventListener("render",t),n[Symbol.for(Ie)]=t,t},dispose(){}});class To extends g{constructor(){super();c(this,"MODULE",i.MODULETYPE.ANIMATION)}restoreAttribute(e){if(!e.target||!e.attribute)return this;let t=this.engine.getObjectBySymbol(e.target),r=this.engine.getConfigBySymbol(e.target);(!t||!r)&&console.warn("AnimationCompiler: can not found object target or config in engine",e.vid);const o=e.attribute.split(".");o.shift();const s=o.pop();for(const a of o)if(t[a]&&r[a])t=t[a],r=r[a];else return console.warn("AnimationCompiler: object and config attribute are not sync"),this;return t[s]=r[s],this}cover(e){super.cover(e);const t=this.map.get(e.vid);return e[Symbol.for(Ie)]=t,this}remove(e){return this.engine.removeEventListener("render",e[Symbol.for(Ie)]),this.restoreAttribute(e),delete e[Symbol.for(Ie)],super.remove(e),this}compile(e,t){const r=this.target[e];this.restoreAttribute(r),super.compile(e,t);const o=this.map.get(e),s=r[Symbol.for(Ie)];return this.map.set(r.vid,s),this.weakMap.delete(o),this.weakMap.set(s,e),this}}g.processor(yo);class Ee extends g{constructor(){super()}}const Mo={name:"openWindow",params:{url:""}},So=function(n,e){return()=>{window.open(e.params.url)}},Oo={name:"visibleObject",params:{target:"",visible:!0,delay:0}},Co=function(n,e){const t=e.params,r=n.getObjectBySymbol(t.target);return r?()=>{setTimeout(()=>{r.visible=t.visible},t.delay)}:(console.warn(`basic event visibleObject: can not found vid object: ${t.target}`),()=>{})},bo={name:"addClass",params:{target:"",className:"",delay:0}},Lo=function(n,e){const t=e.params,r=[];if(t.target==="all")n.scene.traverse(o=>{o instanceof me.CSS3DObject&&r.push(o)});else if(Array.isArray(t.target))t.target.forEach(o=>{const s=n.getObjectBySymbol(o);s?r.push(s):console.warn(`basic event AddClass: can not found vid object: ${t.target}`)});else{const o=n.getObjectBySymbol(t.target);if(!o)return console.warn(`basic event AddClass: can not found vid object: ${t.target}`),()=>{};if(!(o instanceof me.CSS3DObject))return console.warn("basic event AddClass: object is not a CSS3DObject."),()=>{};r.push(o)}return r.length?()=>{setTimeout(()=>{r.forEach(o=>{o.element.classList.add(t.className)})},t.delay)}:(console.warn(`basic event AddClass: can not found vid object: ${t.target}`),()=>{})},vo={name:"changeScene",params:{scene:"Scene",delay:0}},Po=function(n,e){const t=e.params;return()=>{setTimeout(()=>{n.setScene(t.scene)},t.delay)}},Ro={name:"changeCamera",params:{camera:"",delay:0}},wo=function(n,e){const t=e.params;return()=>{setTimeout(()=>{n.setCamera(t.camera)},t.delay)}},Io={name:"switchAnimate",params:{target:"",toggle:"auto",delay:0}},No=function(n,e){const t=e.params,r=n.getConfigBySymbol(t.target);return r?()=>{setTimeout(()=>{if(t.toggle==="auto"){r.play!=r.play;return}if(t.toggle==="off"){r.play=!1;return}if(t.toggle==="on"){r.play=!0;return}},t.delay)}:(console.warn(`basic event switchAnimate: can not found vid config: ${t.target}`),()=>{})};i.TIMINGFUNCTION=void 0,function(n){n.ELN="ELN",n.EQI="EQI",n.EQO="EQO",n.EASING_LINEAR_NONE="EASING_LINEAR_NONE",n.EASING_QUARTIC_IN="EASING_QUARTIC_IN",n.EASING_QUARTIC_OUT="EASING_QUARTIC_OUT",n.EASING_QUARTIC_INOUT="EASING_QUARTIC_INOUT",n.EASING_QUADRATIC_IN="EASING_QUADRATIC_IN",n.EASING_QUADRATIC_OUT="EASING_QUADRATIC_OUT",n.EASING_QUADRATIC_INOUT="EASING_QUADRATIC_INOUT"}(i.TIMINGFUNCTION||(i.TIMINGFUNCTION={}));const U={ELN:N.Easing.Linear.None,EQI:N.Easing.Quartic.In,EQO:N.Easing.Quartic.Out,EASING_LINEAR_NONE:N.Easing.Linear.None,EASING_QUARTIC_IN:N.Easing.Quartic.In,EASING_QUARTIC_OUT:N.Easing.Quartic.Out,EASING_QUARTIC_INOUT:N.Easing.Quartic.InOut,EASING_QUADRATIC_IN:N.Easing.Quadratic.In,EASING_QUADRATIC_OUT:N.Easing.Quadratic.Out,EASING_QUADRATIC_INOUT:N.Easing.Quadratic.InOut},Go={name:"moveTo",params:{target:"",position:{x:0,y:0,z:0},delay:0,duration:1e3,timingFunction:i.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},Ao=function(n,e){const t=e.params,o=n.compilerManager.getObjectBySymbol(t.target);if(!o)return console.warn(`real time animation moveTO: can not found vid object: ${t.target}`),()=>{};const s=n.renderManager,a=n.dataSupportManager.getConfigBySymbol(t.target);if(!a)return console.warn(`can not found object config: ${t.target}`),()=>{};let u=!1;return()=>{if(u)return;u=!0;const d=new N.Tween(o.position).to(t.position).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start(),h=m=>{d.update()};s.addEventListener("render",h),d.onComplete(()=>{s.removeEventListener("render",h),a.position.x=t.position.x,a.position.y=t.position.y,a.position.z=t.position.z,u=!1})}},Do={name:"rotationTo",params:{target:"",rotation:{x:0,y:0,z:0},delay:0,duration:1e3,timingFunction:i.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},Uo=function(n,e){const t=e.params,o=n.compilerManager.getObjectBySymbol(t.target);if(!o)return console.warn(`real time animation moveTO: can not found vid object: ${t.target}`),()=>{};const s=n.renderManager,a=n.dataSupportManager.getConfigBySymbol(t.target);if(!a)return console.warn(`can not found object config: ${t.target}`),()=>{};let u=!1;return()=>{if(u)return;u=!0;const d=new N.Tween(o.rotation).to(t.rotation).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start(),h=m=>{d.update()};s.addEventListener("render",h),d.onComplete(()=>{s.removeEventListener("render",h),a.rotation.x=t.rotation.x,a.rotation.y=t.rotation.y,a.rotation.z=t.rotation.z,u=!1})}},Fo={name:"upTo",params:{target:"",up:{x:0,y:1,z:0},delay:0,duration:1e3,timingFunction:i.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},Yo=function(n,e){const t=e.params,o=n.compilerManager.getObjectBySymbol(t.target);if(!o)return console.warn(`real time animation upTo: can not found vid object: ${t.target}`),()=>{};const s=n.renderManager,a=n.dataSupportManager.getConfigBySymbol(t.target);if(!a)return console.warn(`can not found object config: ${t.target}`),()=>{};let u=!1;return()=>{if(u)return;u=!0;const d=new N.Tween(o.up).to(t.up).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start(),h=m=>{d.update()};s.addEventListener("render",h),d.onComplete(()=>{s.removeEventListener("render",h),a.up.x=t.up.x,a.up.y=t.up.y,a.up.z=t.up.z,u=!1})}},jo={name:"moveFromTo",params:{target:"",from:{x:0,y:0,z:0},to:{x:10,y:10,z:10},delay:0,duration:1e3,timingFunction:i.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},Bo=function(n,e){const t=e.params,o=n.compilerManager.getObjectBySymbol(t.target);if(!o)return console.warn(`real time animation moveTO: can not found vid object: ${t.target}`),()=>{};const s=n.renderManager,a=n.dataSupportManager.getConfigBySymbol(t.target);if(!a)return console.warn(`can not found object config: ${t.target}`),()=>{};let u=!1;return()=>{if(u)return;u=!0,o.position.set(t.from.x,t.from.y,t.from.z),o.updateMatrix(),o.updateMatrixWorld();const d=new N.Tween(o.position).to(t.to).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start(),h=m=>{d.update()};s.addEventListener("render",h),d.onComplete(()=>{s.removeEventListener("render",h),a.position.x=t.to.x,a.position.y=t.to.y,a.position.z=t.to.z,u=!1})}},xo={name:"moveSpacing",params:{target:"",spacing:{x:10,y:10,z:10},delay:0,duration:1e3,timingFunction:i.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},Ho=function(n,e){const t=e.params,r=n.getObjectBySymbol(t.target);if(!r)return console.warn(`can not found vid object: ${t.target}`),()=>{};if(!(r instanceof l.Object3D))return console.warn(`object is not instanceof Object3D: ${t.target}`),()=>{};const o=n.renderManager,s=n.getConfigBySymbol(t.target);let a=!1;return()=>{if(a)return;a=!0;const u={x:r.position.x+t.spacing.x,y:r.position.y+t.spacing.y,z:r.position.z+t.spacing.z},d=new N.Tween(r.position).to(u).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start(),h=m=>{d.update()};o.addEventListener("render",h),d.onComplete(()=>{o.removeEventListener("render",h),s.position.x=u.x,s.position.y=u.y,s.position.z=u.z,a=!1})}},zo={name:"moveToObject",params:{target:"",to:"",offset:{x:0,y:0,z:0},delay:0,duration:1e3,timingFunction:i.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},ko=function(n,e){const t=e.params,r=n.compilerManager,o=r.getObjectBySymbol(t.target),s=r.getObjectBySymbol(t.to);if(!o)return console.warn(`real time animation MoveToObject: can not found vid object: ${t.target}`),()=>{};if(!s)return console.warn(`real time animation MoveToObject: can not found vid object: ${t.target}`),()=>{};const a=n.renderManager,u=n.dataSupportManager.getConfigBySymbol(t.target);if(!u)return console.warn(`can not found object config: ${t.target}`),()=>{};let d=!1;return()=>{if(d)return;d=!0;const h={x:s.position.x+t.offset.x,y:s.position.y+t.offset.y,z:s.position.z+t.offset.z},m=new N.Tween(o.position).to(h).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start(),E=T=>{m.update()};a.addEventListener("render",E),m.onComplete(()=>{a.removeEventListener("render",E),u.position.x=h.x,u.position.y=h.y,u.position.z=h.z,d=!1})}},Vo={name:"vector3To",params:{target:"",attribute:".position",props:{x:"x",y:"y",z:"z"},delay:0,duration:500,to:{},timingFunction:i.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},$o=function(n,e){var E,T,O;const t=e.params,r=n.compilerManager.getObjectBySymbol(t.target);if(!r)return console.warn(`real time animation vector3To: can not found vid object: ${t.target}`),()=>{};const o=n.renderManager;let s=n.dataSupportManager.getConfigBySymbol(t.target);if(!s)return console.warn(`real time animation vector3To: can not found object config: ${t.target}`),()=>{};const a=t.attribute.split(".");a.shift();let u=r;for(const S of a){if(u[S]===void 0)return console.error(`real time animation vector3To: object can not support key: ${S}`,r),()=>{};u=u[S],s=s[S]}const d=t.props;if(!(d.x in u)||!(d.y in u)||!(d.z in u))return console.error("real time animation vector3To: object can not support props:",u,d),()=>{};if(!(d.x in s)||!(d.y in s)||!(d.z in s))return console.error("real time animation vector3To: config can not support props:",s,d),()=>{};const h={x:(E=t.to.x)!=null?E:u[d.x],y:(T=t.to.y)!=null?T:u[d.y],z:(O=t.to.z)!=null?O:u[d.z]};let m=!1;return()=>{if(m)return;m=!0;const S=new N.Tween(u).to(h).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start(),v=C=>{S.update()};o.addEventListener("render",v),S.onComplete(()=>{o.removeEventListener("render",v),s[d.x]=h.x,s[d.y]=h.y,s[d.z]=h.z,m=!1})}},Wo={name:"focusObject",params:{target:"",camera:"",space:"world",offset:{x:0,y:0,z:20},delay:0,duration:1e3,timingFunction:i.TIMINGFUNCTION.EASING_QUADRATIC_INOUT,back:!0}},_o=function(n,e){const t=e.params,r=n.getObjectBySymbol(t.target),o=n.orbitControls.target;if(!r)return console.warn(`real time animation focusObject: can not found vid object: ${t.target}`),()=>{};if(!(r instanceof l.Object3D))return console.warn(`real time animation focusObject: vid object is not a class of THREE.Object3D: ${t.target}`),()=>{};let s=!1;const a=new l.Euler;return()=>{if(s)return;s=!0;let u=n.camera;t.camera&&(u=n.getObjectBySymbol(t.camera),u||(u=n.camera,console.warn(`real time animation focusObject: can not found camera config: ${t.camera}`)));const d=n.getObjectConfig(u),h=n.orbitControls&&n.orbitControls.object===u;d||console.warn("engine current camera can not found config.");const m=n.renderManager;let E={x:r.matrixWorld.elements[12]+t.offset.x,y:r.matrixWorld.elements[13]+t.offset.y,z:r.matrixWorld.elements[14]+t.offset.z};const T={x:u.position.x,y:u.position.y,z:u.position.z};if(t.space==="local"){const I=new l.Vector3(t.offset.x,t.offset.y,t.offset.z).applyEuler(a.setFromRotationMatrix(r.matrixWorld));E={x:r.matrixWorld.elements[12]+I.x,y:r.matrixWorld.elements[13]+I.y,z:r.matrixWorld.elements[14]+I.z}}const O=new N.Tween(u.position).to(E).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start();let S;const v={x:u.up.x,y:u.up.y,z:u.up.z};if(t.space==="local"){const I=new l.Vector3(0,1,0).applyEuler(a.setFromRotationMatrix(r.matrixWorld));S=new N.Tween(u.up).to({x:I.x,y:I.y,z:I.z}).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start()}let C;const y={x:o.x,y:o.y,z:o.z};h&&(C=new N.Tween(o).to({x:r.matrixWorld.elements[12],y:r.matrixWorld.elements[13],z:r.matrixWorld.elements[14]}).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start());let R;h&&t.space==="local"?R=I=>{O.update(),S.update(),C.update()}:h?R=I=>{O.update(),C.update()}:t.space==="local"?R=I=>{O.update(),S.update()}:R=I=>{O.update()},m.addEventListener("render",R),O.onComplete(()=>{if(m.removeEventListener("render",R),d&&(d.position.x=E.x,d.position.y=E.y,d.position.z=E.z),s=!1,t.back){const I=()=>{const L=new N.Tween(u.position).to(T).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start();let H;t.space==="local"&&(H=new N.Tween(u.up).to(v).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start());let f;h&&(f=new N.Tween(o).to(y).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start());const k=w=>{L.update(),H&&H.update(),f&&f.update()};L.onComplete(()=>{m.removeEventListener("render",k)}),m.addEventListener("render",k),document.removeEventListener("dblclick",I)};document.addEventListener("dblclick",I)}})}},Qo={name:"fadeObject",params:{target:"",direction:"out",delay:0,duration:300,timingFunction:i.TIMINGFUNCTION.EASING_QUADRATIC_INOUT,visible:!0}},Xo=function(n,e){const t=e.params,r=n.getObjectBySymbol(t.target);if(!r)return console.warn(`real time animation fadeObject: can not found vid object: ${t.target}`),()=>{};const o=n.getObjectConfig(r);if(!o.material)return console.warn(`real time animation fadeObject: target can not support fade: ${t.target}`),()=>{};const s=[],a=[],u=Array.isArray(o.material)?[].concat(o.material):[o.material];for(const h of u){const m=n.getObjectBySymbol(h),E=n.getConfigBySymbol(h);if(!(m instanceof l.Material)){console.error(`real time animation fadeObject: object config material is not instanceof Material: ${h}`);continue}if(!E){console.error(`real time animation fadeObject: object config material can not found config: ${h}`);continue}s.push(m),a.push(E)}let d=!1;return()=>{if(d)return;d=!0;const h=n.renderManager;o.visible=!0,s.forEach((m,E,T)=>{m.visible=!0,m.transparent=!0,m.opacity=t.direction==="in"?0:1,m.needsUpdate=!0;const O=new N.Tween(m).to({opacity:t.direction==="in"?1:0}).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start(),S=v=>{O.update()};h.addEventListener("render",S),O.onComplete(()=>{h.removeEventListener("render",S),t.direction==="out"&&t.visible?(a[E].visible=!1,o.visible=!1):t.direction==="in"&&t.visible&&(a[E].visible=!0,o.visible=!0),a[E].opacity=t.direction==="in"?1:0,d=!1})})}},Ko={name:"showToCamera",params:{target:"",offset:{x:0,y:0,z:-30},delay:0,duration:1e3,timingFunction:i.TIMINGFUNCTION.EASING_QUADRATIC_INOUT,back:!0}},Jo=function(n,e){const t=e.params,r=n.getObjectBySymbol(t.target),o=n.getConfigBySymbol(t.target),s=n.camera;if(!r)return console.warn(`real time animation showToCamera: can not found vid object: ${t.target}`),()=>{};if(!r)return console.warn(`real time animation showToCamera: can not found vid config: ${t.target}`),()=>{};if(!(r instanceof l.Object3D))return console.warn(`real time animation showToCamera: vid object is not a class of THREE.Object3D: ${t.target}`),()=>{};const a=new l.Matrix4,u=new l.Euler,d=new l.Vector3;let h=!1;return()=>{if(h)return;h=!0;const m=n.renderManager;d.set(t.offset.x,t.offset.y,t.offset.z).applyEuler(s.rotation),d.set(s.position.x+d.x,s.position.y+d.y,s.position.z+d.z),a.lookAt(s.position,d,s.up),u.setFromRotationMatrix(a);const E={x:r.position.x,y:r.position.y,z:r.position.z},T={x:r.rotation.x,y:r.rotation.y,z:r.rotation.z},O=new N.Tween(r.position).to({x:d.x,y:d.y,z:d.z}).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start(),S=new N.Tween(r.rotation).to({x:u.x,y:u.y,z:u.z}).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start(),v=C=>{O.update(),S.update()};m.addEventListener("render",v),O.onComplete(()=>{if(m.removeEventListener("render",v),o.position.x=d.x,o.position.y=d.y,o.position.z=d.z,o.rotation.x=u.x,o.rotation.y=u.y,o.rotation.z=u.z,h=!1,t.back){const C=()=>{const y=new N.Tween(r.position).to(E).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start(),R=new N.Tween(r.rotation).to(T).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start(),I=L=>{y.update(),R.update()};y.onComplete(()=>{m.removeEventListener("render",I),o.position.x=E.x,o.position.y=E.y,o.position.z=E.z,o.rotation.x=T.x,o.rotation.y=T.y,o.rotation.z=T.z}),m.addEventListener("render",I),document.removeEventListener("dblclick",C)};document.addEventListener("dblclick",C)}})}},Zo={name:"colorChange",params:{target:"",attribute:"color",color:"rgb(255, 255, 255)",delay:0,duration:500,timingFunction:i.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},qo=function(n,e){const t=e.params,r=n.getObjectBySymbol(t.target);if(!r)return console.warn(`real time animation ColorChange: can not found vid material: ${t.target}`),()=>{};if(!r[t.attribute]||!(r[t.attribute]instanceof l.Color))return console.warn(`real time animation ColorChange: material attribute is illeage: ${t.attribute}`),()=>{};const o=n.getConfigBySymbol(t.target);if(!o)return console.warn(`real time animation ColorChange: can not found material config: ${t.target}`),()=>{};const s=new l.Color(t.color),a=n.renderManager;let u=!1;return()=>{if(u)return;u=!0;const d=new N.Tween(r[t.attribute]).to({r:s.r,g:s.g,b:s.b}).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start(),h=m=>{d.update()};a.addEventListener("render",h),d.onComplete(()=>{a.removeEventListener("render",h),o[t.attribute]=t.color,u=!1})}},es={name:"orbitTargetMove",params:{target:"",offset:{x:0,y:0,z:0},delay:0,duration:1e3,timingFunction:i.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},ts=function(n,e){const t=e.params;if(n.compilerManager,!n.orbitControls)return console.warn("real time animation orbitTargetMove: engine can not install orbitControls."),()=>{};const r=n.renderManager;let o=!1;return()=>{if(o)return;o=!0;let s=t.offset;if(t.target){const d=n.getObjectBySymbol(t.target);d?s={x:d.matrixWorld.elements[12]+s.x,y:d.matrixWorld.elements[13]+s.y,z:d.matrixWorld.elements[14]+s.z}:console.warn(`real time animation orbitTargetMove: can not found vid object: ${t.target}`)}const a=new N.Tween(n.orbitControls.target).to(s).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start(),u=d=>{a.update()};r.addEventListener("render",u),a.onComplete(()=>{r.removeEventListener("render",u),o=!1})}},oe=class{static generateConfig(e,t){if(!oe.configLibrary.has(e))return console.warn(`event library can not found config by name: ${e}`),{name:""};const r=(s,a)=>{for(const u in a)typeof a[u]=="object"&&a[u]!==null&&!Array.isArray(a[u])?r(s[u],a[u]):s[u]=a[u]},o=JSON.parse(JSON.stringify(oe.configLibrary.get(e)));return r(o,t),o}static generateEvent(e,t){return oe.generatorLibrary.has(e.name)?oe.generatorLibrary.get(e.name)(t,e):(console.error(`event library can not found generator by name: ${e.name}`),()=>{})}static has(e){return oe.configLibrary.has(e)}};let A=oe;c(A,"configLibrary",new Map),c(A,"generatorLibrary",new Map),c(A,"register",function(e,t){oe.configLibrary.has(e.name)&&console.warn(`EventLibrary has already exist this event generator: ${e.name}, that will be cover.`),oe.configLibrary.set(e.name,JSON.parse(JSON.stringify(e))),oe.generatorLibrary.set(e.name,t)}),A.register(Mo,So),A.register(Oo,Co),A.register(bo,Lo),A.register(vo,Po),A.register(Ro,wo),A.register(Io,No),A.register(Go,Ao),A.register(Do,Uo),A.register(Fo,Yo),A.register(jo,Bo),A.register(xo,Ho),A.register(zo,ko),A.register(Vo,$o),A.register(Wo,_o),A.register(Qo,Xo),A.register(Ko,Jo),A.register(Zo,qo),A.register(es,ts);const Dn=new WeakMap,Un=function({target:n,config:e,value:t,engine:r}){if(e.vid===t){console.warn("can not set object lookAt itself.");return}let o=Dn.get(n);if(o||(o={lookAtTarget:null,updateMatrixWorldFun:null},Dn.set(n,o)),!t){if(!o.updateMatrixWorldFun)return;n.updateMatrixWorld=o.updateMatrixWorldFun,o.lookAtTarget=null,o.updateMatrixWorldFun=null;return}const s=r.compilerManager.getObject3D(t);if(!s){console.warn(`lookAt handler can not found this vid mapping object: '${t}'`);return}const a=n.updateMatrixWorld;o.updateMatrixWorldFun=a,o.lookAtTarget=s.position,n.updateMatrixWorld=u=>{a.call(n,u),n.lookAt(o.lookAtTarget)}},_e="vis.event",ue=function({target:n,path:e,value:t,engine:r}){const o=e[0];if(!A.has(t.name)){console.warn(`EventLibrary: can not support this event: ${t.name}`);return}const s=A.generateEvent(t,r),a=Symbol.for(_e);t[a]=s,n.addEventListener(o,s)},ge=function({target:n,path:e,value:t}){const r=e[0],o=t[Symbol.for(_e)];if(!o){console.warn("event remove can not fun found event in config",t);return}n.removeEventListener(r,o),delete t[Symbol.for(_e)]},ye=function({target:n,config:e,path:t,engine:r}){const o=t[0],s=e[t[0]][t[1]],a=s[Symbol.for(_e)];if(!a){console.warn("event remove can not fun found event in config",s);return}n.removeEventListener(o,a);const u=A.generateEvent(s,r);s[Symbol.for(_e)]=u,n.addEventListener(o,u)},Gt=function({target:n,config:e,value:t,engine:r}){const o=r.getConfigBySymbol(t);if(!o){console.warn(` can not foud object config in engine: ${t}`);return}if(o.parent&&o.parent!==e.vid){const a=r.getConfigBySymbol(o.parent);if(!a){console.warn(` can not foud object parent config in engine: ${o.parent}`);return}a.children.splice(a.children.indexOf(t),1)}o.parent=e.vid;const s=r.compilerManager.getObject3D(t);if(!s){console.warn(`can not found this vid in engine: ${t}.`);return}n.add(s)},ns=function({target:n,config:e,value:t,engine:r}){const o=r.compilerManager.getObject3D(t);if(!o){console.warn(`can not found this vid in engine: ${t}.`);return}n.remove(o);const s=r.getConfigBySymbol(t);if(!s){console.warn(`can not found this vid in engine: ${t}.`);return}s.parent=""},te=function(n,e,t,r){return Promise.resolve().then(()=>{!t.lookAt&&Un({target:n,config:e,engine:r,value:e.lookAt}),e.children.forEach(s=>{Gt({target:n,config:e,value:s,engine:r})});for(const s of Object.values(i.EVENTNAME))e[s].forEach((a,u)=>{ue({target:n,path:[s,u.toString()],value:a,engine:r})})}),z(e,n,F({vid:!0,type:!0,lookAt:!0,parent:!0,children:!0,pointerdown:!0,pointermove:!0,pointerup:!0,pointerenter:!0,pointerleave:!0,click:!0,dblclick:!0,contextmenu:!0},t)),n},Q=function(n){n._listener={}},D={add:{pointerdown:ue,pointerup:ue,pointermove:ue,pointerenter:ue,pointerleave:ue,click:ue,dblclick:ue,contextmenu:ue,children:Gt},set:{lookAt:Un,pointerdown:ye,pointerup:ye,pointermove:ye,pointerenter:ye,pointerleave:ye,click:ye,dblclick:ye,contextmenu:ye,parent:ot,children:{$reg:[{reg:new RegExp(".*"),handler:Gt}]}},delete:{pointerdown:ge,pointerup:ge,pointermove:ge,pointerenter:ge,pointerleave:ge,click:ge,dblclick:ge,contextmenu:ge,children:ns}};b({configType:i.CONFIGTYPE.OBJECT3D,commands:D,create(n,e){return te(new l.Object3D,n,{},e)},dispose:Q});const ee=new WeakMap;var rs=b({configType:i.CONFIGTYPE.PERSPECTIVECAMERA,commands:{add:F({scale(){}},D.add),set:Ke(F({scale(){},adaptiveWindow({target:n,value:e,engine:t}){if(e){if(!ee.has(e)){const r=o=>{n.aspect=o.width/o.height,n.updateProjectionMatrix()};ee.set(n,r),t.addEventListener("setSize",r),r({type:"setSize",width:t.dom.offsetWidth,height:t.dom.offsetHeight})}}else{const r=ee.get(n);r&&(t.removeEventListener("setSize",r),ee.delete(n))}}},D.set),{$reg:[{reg:new RegExp("fov|aspect|near|far"),handler({target:n,key:e,value:t}){n[e]=t,n.updateProjectionMatrix()}}]}),delete:F({scale(){}},D.delete)},create(n,e){const t=new l.PerspectiveCamera;if(te(t,n,{scale:!0,adaptiveWindow:!0},e),t.updateProjectionMatrix(),n.adaptiveWindow){const r=o=>{t.aspect=o.width/o.height,t.updateProjectionMatrix()};ee.set(t,r),e.addEventListener("setSize",r),r({type:"setSize",width:e.dom.offsetWidth,height:e.dom.offsetHeight})}return t},dispose(n){ee.delete(n),Q(n)}}),is=b({configType:i.CONFIGTYPE.ORTHOGRAPHICCAMERA,commands:{add:F({scale(){}},D.add),set:Ke(F({scale(){},adaptiveWindow({target:n,value:e,engine:t}){if(e){if(!ee.has(e)){const r=o=>{const s=o.width,a=o.height;n.left=-s,n.right=s,n.top=a,n.bottom=-a,n.updateProjectionMatrix()};ee.set(n,r),t.addEventListener("setSize",r),r({type:"setSize",width:t.dom.offsetWidth,height:t.dom.offsetHeight})}}else{const r=ee.get(n);r&&(t.removeEventListener("setSize",r),ee.delete(n))}}},D.set),{$reg:[{reg:new RegExp("left|right|top|bottom|near|far|zoom"),handler({target:n,key:e,value:t}){n[e]=t,n.updateProjectionMatrix()}}]}),delete:F({scale(){}},D.delete)},create(n,e){const t=new l.OrthographicCamera(-50,50,50,-50);if(te(t,n,{scale:!0,adaptiveWindow:!0},e),t.updateProjectionMatrix(),n.adaptiveWindow){const r=o=>{const s=o.width,a=o.height;t.left=-s,t.right=s,t.top=a,t.bottom=-a,t.updateProjectionMatrix()};ee.set(t,r),e.addEventListener("setSize",r),r({type:"setSize",width:e.dom.offsetWidth,height:e.dom.offsetHeight})}return t},dispose(n){ee.delete(n),Q(n)}});class os extends Ee{constructor(){super();c(this,"MODULE",i.MODULETYPE.CAMERA)}}g.processor(rs),g.processor(is);var ss=b({configType:i.CONFIGTYPE.ORBITCONTROLS,commands:{set:{target({target:n,config:e,path:t,key:r,value:o}){const s=e.target;if(!e.type){e.target=new l.Vector3(0,0,0);return}typeof e.target=="string"||(t.length>1?n.target[r]=o:n.target=new l.Vector3(s.x,s.y,s.z))}}},create(n,e){let t;return e.orbitControls?t=e.orbitControls:(t=new on,t.setCamera(e.camera),t.setDom(e.dom)),n.target&&(typeof n.target=="string"||(t.target=new l.Vector3(n.target.x,n.target.y,n.target.z))),z(n,t,{target:!0}),t},dispose(n){n.dispose()}}),as=b({configType:i.CONFIGTYPE.TRNASFORMCONTROLS,commands:{set:{snapAllow({target:n,config:e,value:t}){t?(n.translationSnap=e.translationSnap,n.rotationSnap=e.rotationSnap,n.scaleSnap=e.scaleSnap):(n.translationSnap=null,n.rotationSnap=null,n.scaleSnap=null)},translationSnap({target:n,config:e,value:t}){e.snapAllow&&(n.translationSnap=t)},rotationSnap({target:n,config:e,value:t}){e.snapAllow&&(n.rotationSnap=t)},scaleSnap({target:n,config:e,value:t}){e.snapAllow&&(n.scaleSnap=t)}}},create(n,e){let t;return e.transformControls?t=e.transformControls:(t=new sn,t.setCamera(e.camera),e.dom&&t.setDom(e.dom)),n.snapAllow&&(t.translationSnap=n.translationSnap,t.rotationSnap=n.rotationSnap,t.scaleSnap=n.scaleSnap),t},dispose(n){n.dispose()}});class cs extends g{constructor(){super();c(this,"MODULE",i.MODULETYPE.CONTROLS)}useEngine(e){return e.transformControls&&(this.map.set(i.CONFIGTYPE.TRNASFORMCONTROLS,e.transformControls),this.weakMap.set(e.transformControls,i.CONFIGTYPE.TRNASFORMCONTROLS)),e.orbitControls&&(this.map.set(i.CONFIGTYPE.ORBITCONTROLS,e.orbitControls),this.weakMap.set(e.orbitControls,i.CONFIGTYPE.ORBITCONTROLS)),super.useEngine(e)}}g.processor(ss),g.processor(as);const je=function(n,e){const t=e.resourceManager.resourceMap;if(!t.has(n))return console.warn(`css3D compiler: can not found resource element: ${n}`),document.createElement("div");const r=t.get(n);return r instanceof HTMLElement?r:(console.warn("css3D compiler can not suport render this resource type.",r.constructor,n),document.createElement("div"))};var ls=b({configType:i.CONFIGTYPE.CSS3DOBJECT,commands:{add:D.add,set:F({element({target:n,value:e,engine:t}){n.element=je(e,t)}},D.set),delete:D.delete},create(n,e){return te(new me.CSS3DObject(je(n.element,e)),n,{element:!0},e)},dispose:Q});class us extends me.CSS3DObject{constructor(e=document.createElement("div")){const t=document.createElement("div"),r=50,o=50;t.style.width=`${r}px`,t.style.height=`${o}px`,t.appendChild(e);super(t);c(this,"geometry");c(this,"_width");c(this,"_height");this.geometry=new l.PlaneBufferGeometry(r,o),this.geometry.computeBoundingBox(),this._width=r,this._height=o}get width(){return this._width}set width(e){this.geometry.dispose(),this.geometry=new l.PlaneBufferGeometry(e,this._height),this.geometry.computeBoundingBox(),this.element.style.width=`${e}px`,this._width=e}get height(){return this._height}set height(e){this.geometry.dispose(),this.geometry=new l.PlaneBufferGeometry(this._width,e),this.geometry.computeBoundingBox(),this.element.style.height=`${e}px`,this._height=e}}class Fn extends us{constructor(e=document.createElement("div")){super(e);c(this,"cacheBox",new l.Box3);this.type="CSS3DPlane",this.element.classList.add("vis-css3d","vis-css3d-plane")}raycast(e,t){const r=this.cacheBox.copy(this.geometry.boundingBox);r.applyMatrix4(this.matrixWorld),e.ray.intersectsBox(r)&&t.push({distance:e.ray.origin.distanceTo(this.position),object:this,point:this.position})}}var ds=b({configType:i.CONFIGTYPE.CSS3DPLANE,commands:{add:D.add,set:F({element({target:n,value:e,engine:t}){n.element.innerHTML="",n.element.appendChild(je(e,t))}},D.set),delete:D.delete},create(n,e){return te(new Fn(je(n.element,e)),n,{element:!0},e)},dispose:Q});class hs extends me.CSS3DSprite{constructor(e=document.createElement("div")){const t=document.createElement("div"),r=50,o=50;t.style.width=`${r}px`,t.style.height=`${o}px`,t.appendChild(e),e.classList.add("vis-css3d","vis-css3d-sprite");super(t);c(this,"geometry");c(this,"_width");c(this,"_height");c(this,"cacheBox",new l.Box3);c(this,"cachePosition",new l.Vector3);c(this,"cacheQuaternion",new l.Quaternion);c(this,"cacheScale",new l.Vector3);c(this,"cacheMatrix4",new l.Matrix4);c(this,"rotateMatrix4",new l.Matrix4);this.geometry=new l.PlaneBufferGeometry(r,o),this.geometry.computeBoundingBox(),this._width=r,this._height=o,this.type="CSS3DSprite"}get width(){return this._width}set width(e){this.geometry.dispose(),this.geometry=new l.PlaneBufferGeometry(e,this._height),this.geometry.computeBoundingBox(),this.element.style.width=`${e}px`,this._width=e}get height(){return this._height}set height(e){this.geometry.dispose(),this.geometry=new l.PlaneBufferGeometry(this._width,e),this.geometry.computeBoundingBox(),this.element.style.height=`${e}px`,this._height=e}raycast(e,t){const r=this.cacheBox.copy(this.geometry.boundingBox);this.matrixWorld.decompose(this.cachePosition,this.cacheQuaternion,this.cacheScale);const o=this.rotateMatrix4.lookAt(this.position,e.camera.position,this.up);this.cacheQuaternion.setFromRotationMatrix(o),this.cacheMatrix4.compose(this.cachePosition,this.cacheQuaternion,this.cacheScale),r.applyMatrix4(this.cacheMatrix4),e.ray.intersectsBox(r)&&t.push({distance:e.ray.origin.distanceTo(this.position),object:this,point:this.position})}}var ps=b({configType:i.CONFIGTYPE.CSS3DSPRITE,commands:{add:D.add,set:F({element({target:n,value:e,engine:t}){n.element.innerHTML="",n.element.appendChild(je(e,t))}},D.set),delete:D.delete},create(n,e){return te(new hs(je(n.element,e)),n,{element:!0},e)},dispose:Q});class ms extends Ee{constructor(){super();c(this,"MODULE",i.MODULETYPE.CSS3D)}}g.processor(ds),g.processor(ls),g.processor(ps);class Be extends l.BufferGeometry{constructor(e=[],t=36,r=!0){super();c(this,"parameters");this.type="CurveGeometry",this.parameters={path:e.map(o=>o.clone()),space:r,divisions:t}}}class fs extends Be{constructor(e=[],t=36,r=!0){super(e,t,r);this.type="QuadraticBezierCurveGeometry";const o=new l.CurvePath;if(e.length<3){console.warn("QuadraticBezierCurveGeometry path length at least 3.");return}const s=3+(e.length-3)-(e.length-3)%2;for(let u=1;u<s;u+=2)o.add(new l.QuadraticBezierCurve3(e[u-1],e[u],e[u+1]));const a=o.curves.reduce((u,d)=>u+=d.arcLengthDivisions,0);if(t>a){const u=Math.ceil((t-a)/o.curves.length);o.curves.forEach(d=>{d.arcLengthDivisions=d.arcLengthDivisions*(u+1),d.updateArcLengths()})}this.setFromPoints(r?o.getSpacedPoints(t):o.getPoints(t))}}class Es extends Be{constructor(e=[],t=36,r=!0){super(e,t,r);this.type="CubicBezierCurveGeometry";const o=new l.CurvePath;if(e.length<4){console.warn("CubicBezierCurveGeometry path length at least 4.");return}const s=4+(e.length-4)-(e.length-4)%3;for(let u=2;u<s;u+=3)o.add(new l.CubicBezierCurve3(e[u-2],e[u-1],e[u],e[u+1]));const a=o.curves.reduce((u,d)=>u+=d.arcLengthDivisions,0);if(t>a){const u=Math.ceil((t-a)/o.curves.length);o.curves.forEach(d=>{d.arcLengthDivisions=d.arcLengthDivisions*(u+1),d.updateArcLengths()})}this.setFromPoints(r?o.getSpacedPoints(t):o.getPoints(t))}}class gs extends Be{constructor(e=[],t=36,r=!0){super(e,t,r);if(this.type="LineCurveGeometry",!e.length){console.warn("LineCurveGeometry path length at least 1.");return}const o=new l.CurvePath;for(let a=1;a<e.length;a+=1)o.add(new l.LineCurve3(e[a-1],e[a]));const s=o.curves.reduce((a,u)=>a+=u.arcLengthDivisions,0);if(t>s){const a=Math.ceil((t-s)/o.curves.length);o.curves.forEach(u=>{u.arcLengthDivisions=u.arcLengthDivisions*(a+1),u.updateArcLengths()})}this.setFromPoints(r?o.getSpacedPoints(t):o.getPoints(t))}}class ys extends Be{constructor(e=[],t=36,r=!0){super(e,t,r);if(this.type="SplineCurveGeometry",!e.length){console.warn("SplineCurveGeometry path length at least 1.");return}const o=new l.CatmullRomCurve3(e);this.setFromPoints(r?o.getSpacedPoints(t):o.getPoints(t))}}class Ts extends l.TubeGeometry{constructor(e=[],t=64,r=1,o=8,s=!1){if(!e.length){console.warn("LineTubeGeometry path length at least 1.");return}const a=new l.CurvePath;for(let u=1;u<e.length;u+=1)a.add(new l.LineCurve3(e[u-1],e[u]));super(a,t,r,o,s);this.type="LineTubeGeometry"}}class Ms extends l.TubeGeometry{constructor(e=[],t=64,r=1,o=8,s=!1){if(!e.length){console.warn("SplineTubeGeometry path length at least 1.");return}const a=new l.CatmullRomCurve3(e);super(a,t,r,o,s);this.type="SplineTubeGeometry"}}class Ss extends l.ShapeBufferGeometry{constructor(e=[new l.Vector2(0,0)],t=12){const r=new l.Shape,o=e[0];if(o){r.moveTo(o.x,o.y);for(let s=1;s<e.length;s+=1)r.lineTo(e[s].x,e[s].y)}super(r,t);this.type="LineShapeGeometry"}}const Os=function(n,e){!(n instanceof Be)&&!(n instanceof l.TubeGeometry)&&!(n instanceof l.ShapeGeometry)&&n.center(),n.computeBoundingBox();const t=n.boundingBox,r=e.position,o=e.rotation,s=e.scale,a=new l.Quaternion().setFromEuler(new l.Euler(o.x,o.y,o.z,"XYZ"));return n.applyQuaternion(a),n.scale(s.x,s.y,s.z),!(n instanceof Be)&&!(n instanceof l.TubeGeometry)&&!(n instanceof l.ShapeGeometry)&&n.center(),n.computeBoundingBox(),n.translate((t.max.x-t.min.x)/2*r.x,(t.max.y-t.min.y)/2*r.y,(t.max.z-t.min.z)/2*r.z),n},At={reg:new RegExp(".*"),handler({config:n,target:e,processor:t,engine:r}){const o=t.create(n,r);e.copy(o),e.dispatchEvent({type:"update"}),e.uuid=o.uuid,o.dispose()}},st={add:{groups({target:n,value:e}){n.addGroup(e.start,e.count,e.materialIndex)},$reg:[At]},set:{groups(n){const{path:e,target:t,config:r}=n;if(e[1]!==void 0){t.groups.splice(Number(n.path[1]),1);const o=r.groups[e[1]];t.addGroup(o.start,o.count,o.materialIndex)}else console.warn("geometry processor can not set group",n)},$reg:[At]},delete:{groups({target:n,key:e}){n.groups.splice(Number(e),1)},$reg:[At]}},at=function(n,e){n.clearGroups();for(const t of e.groups)n.addGroup(t.start,t.count,t.materialIndex);return Os(n,e)},x=new Map;x.set(i.CONFIGTYPE.BOXGEOMETRY,n=>new l.BoxBufferGeometry(n.width,n.height,n.depth,n.widthSegments,n.heightSegments,n.depthSegments)),x.set(i.CONFIGTYPE.SPHEREGEOMETRY,n=>new l.SphereBufferGeometry(n.radius,n.widthSegments,n.heightSegments,n.phiStart,n.phiLength,n.thetaStart,n.thetaLength)),x.set(i.CONFIGTYPE.PLANEGEOMETRY,n=>new l.PlaneBufferGeometry(n.width,n.height,n.widthSegments,n.heightSegments)),x.set(i.CONFIGTYPE.CIRCLEGEOMETRY,n=>new l.CircleBufferGeometry(n.radius,n.segments,n.thetaStart,n.thetaLength)),x.set(i.CONFIGTYPE.CONEGEOMETRY,n=>new l.ConeBufferGeometry(n.radius,n.height,n.radialSegments,n.heightSegments,n.openEnded,n.thetaStart,n.thetaLength)),x.set(i.CONFIGTYPE.CYLINDERGEOMETRY,n=>new l.CylinderBufferGeometry(n.radiusTop,n.radiusBottom,n.height,n.radialSegments,n.heightSegments,n.openEnded,n.thetaStart,n.thetaLength)),x.set(i.CONFIGTYPE.LINECURVEGEOMETRY,n=>new gs(n.path.map(e=>new l.Vector3(e.x,e.y,e.z)),n.divisions,n.space)),x.set(i.CONFIGTYPE.SPLINECURVEGEOMETRY,n=>new ys(n.path.map(e=>new l.Vector3(e.x,e.y,e.z)),n.divisions,n.space)),x.set(i.CONFIGTYPE.CUBICBEZIERCURVEGEOMETRY,n=>new Es(n.path.map(e=>new l.Vector3(e.x,e.y,e.z)),n.divisions,n.space)),x.set(i.CONFIGTYPE.QUADRATICBEZIERCURVEGEOMETRY,n=>new fs(n.path.map(e=>new l.Vector3(e.x,e.y,e.z)),n.divisions,n.space)),x.set(i.CONFIGTYPE.LINETUBEGEOMETRY,n=>new Ts(n.path.map(e=>new l.Vector3(e.x,e.y,e.z)),n.tubularSegments,n.radius,n.radialSegments,n.closed)),x.set(i.CONFIGTYPE.SPLINETUBEGEOMETRY,n=>new Ms(n.path.map(e=>new l.Vector3(e.x,e.y,e.z)),n.tubularSegments,n.radius,n.radialSegments,n.closed)),x.set(i.CONFIGTYPE.TORUSGEOMETRY,n=>new l.TorusGeometry(n.radius,n.tube,n.radialSegments,n.tubularSegments,n.arc)),x.set(i.CONFIGTYPE.RINGGEOMETRY,n=>new l.RingBufferGeometry(n.innerRadius,n.outerRadius,n.thetaSegments,n.phiSegments,n.thetaStart,n.thetaLength)),x.set(i.CONFIGTYPE.LINESHAPEGEOMETRY,n=>new Ss(n.path.map(e=>new l.Vector2(e.x,e.y)),n.curveSegments));const Cs=function(n){return x.has(n.type)?at(x.get(n.type)(n),n):(console.error(`parametric geometry can not support this type config: ${n.type}`),new l.BufferGeometry)},bs=function(n){n.dispose()},Ls=function(n){return b({configType:n,commands:st,create:Cs,dispose:bs})},vs=[i.CONFIGTYPE.BOXGEOMETRY,i.CONFIGTYPE.SPHEREGEOMETRY,i.CONFIGTYPE.PLANEGEOMETRY,i.CONFIGTYPE.CIRCLEGEOMETRY,i.CONFIGTYPE.CONEGEOMETRY,i.CONFIGTYPE.CYLINDERGEOMETRY,i.CONFIGTYPE.LINECURVEGEOMETRY,i.CONFIGTYPE.SPLINECURVEGEOMETRY,i.CONFIGTYPE.CUBICBEZIERCURVEGEOMETRY,i.CONFIGTYPE.QUADRATICBEZIERCURVEGEOMETRY,i.CONFIGTYPE.LINETUBEGEOMETRY,i.CONFIGTYPE.SPLINETUBEGEOMETRY,i.CONFIGTYPE.TORUSGEOMETRY,i.CONFIGTYPE.RINGGEOMETRY,i.CONFIGTYPE.LINESHAPEGEOMETRY].map(n=>Ls(n));class Ps extends l.BufferGeometry{constructor(e){super();c(this,"type","LoadBufferGeometry");e&&this.copy(e)}}var Rs=b({configType:i.CONFIGTYPE.LOADGEOMETRY,commands:st,create(n,e){const t=e.resourceManager.resourceMap.get(n.url);return!t&&!(t instanceof l.BufferGeometry)?(console.error(`engine rescoure can not found url: ${n.url}`),new l.BoxBufferGeometry(5,5,5)):at(new Ps(t),n)},dispose(n){n.dispose()}});const ws=function(n){const e=new l.BufferGeometry;return n.position.length&&e.setAttribute("position",new l.Float32BufferAttribute(n.position,3)),n.color.length&&e.setAttribute("color",new l.Float32BufferAttribute(n.color,3)),n.normal.length&&e.setAttribute("normal",new l.Float32BufferAttribute(n.normal,3)),n.uv.length&&e.setAttribute("uv",new l.Float32BufferAttribute(n.uv,2)),n.uv2.length&&e.setAttribute("uv2",new l.Float32BufferAttribute(n.uv2,2)),n.index.length&&e.setIndex(n.index),e};var Is=b({configType:i.CONFIGTYPE.CUSTOMGEOMETRY,commands:st,create(n){return at(ws(n.attribute),n)},dispose(n){n.dispose()}}),Ns=b({configType:i.CONFIGTYPE.EDGESGEOMETRY,commands:st,create(n,e){const t=e.compilerManager.getObjectBySymbol(n.url);return!t||!(t instanceof l.BufferGeometry)?(console.error(`engine rescoure can not found url: ${n.url}`),new l.EdgesGeometry(new l.BoxBufferGeometry(5,5,5))):at(new l.EdgesGeometry(t),n)},dispose(n){n.dispose()}});class Gs extends g{constructor(){super();c(this,"MODULE",i.MODULETYPE.GEOMETRY)}}vs.forEach(n=>{g.processor(n)}),g.processor(Rs),g.processor(Is),g.processor(Ns);var As=b({configType:i.CONFIGTYPE.GROUP,commands:D,create(n,e){return te(new l.Group,n,{},e)},dispose:Q});class Ds extends Ee{constructor(){super();c(this,"MODULE",i.MODULETYPE.GROUP)}}g.processor(As);const Us=function({target:n,value:e}){n.color.copy(new l.Color(e))},ct=function(n,e,t,r){return n.color.copy(new l.Color(e.color)),te(n,e,F({color:!0,scale:!0,rotation:!0,lookAt:!0},t),r)},lt=Object.assign({},D,{set:{color:Us,scale:ot,rotation:ot,lookAt:ot}});var Fs=b({configType:i.CONFIGTYPE.AMBIENTLIGHT,commands:lt,create(n,e){return ct(new l.AmbientLight,n,{},e)},dispose:Q}),Ys=b({configType:i.CONFIGTYPE.DIRECTIONALLIGHT,commands:lt,create(n,e){return ct(new l.DirectionalLight,n,{},e)},dispose:Q}),js=b({configType:i.CONFIGTYPE.POINTLIGHT,commands:lt,create(n,e){return ct(new l.PointLight,n,{},e)},dispose:Q}),Bs=b({configType:i.CONFIGTYPE.SPOTLIGHT,commands:lt,create(n,e){return ct(new l.SpotLight,n,{},e)},dispose:Q});class xs extends Ee{constructor(){super();c(this,"MODULE",i.MODULETYPE.LIGHT)}}g.processor(Fs),g.processor(Ys),g.processor(js),g.processor(Bs);class ut extends Ee{constructor(){super()}}const dt=new l.ShaderMaterial({fragmentShader:`
  void main () {
    gl_FragColor = vec4(0.5, 0.5, 0.5, 1.0);
  }
  `}),Yn=new l.BoxBufferGeometry(10,10,10),Hs=function({target:n,value:e,engine:t}){const r=t.compilerManager.getGeometry(e);if(!r){console.warn(`can not found geometry by vid in engine: ${e}`),n.geometry=Yn;return}n.geometry=r},Dt=function({target:n,config:e,engine:t}){let r;typeof e.material=="string"?r=t.compilerManager.getMaterial(e.material)||dt:r=e.material.map(o=>t.compilerManager.getMaterial(o)||dt),n.material=r},ht=function(n,e,t,r){if(!t.geometry){let o=r.getObjectBySymbol(e.geometry);o instanceof l.BufferGeometry||(console.warn(`geometry vid in engine is not instance of BufferGeometry: ${e.geometry}`,o),o=Yn),n.geometry.dispose(),n.geometry=o}if(!t.material){let o;typeof e.material=="string"?o=r.compilerManager.getMaterial(e.material)||dt:o=e.material.map(s=>r.compilerManager.getMaterial(s)||dt),n.material=o}return te(n,e,F({geometry:!0,material:!0},t),r)},pt=function(n){Q(n)},xe={add:F({material:Dt},D.add),set:F({geometry:Hs,material:Dt},D.set),delete:F({material:Dt},D.delete)};var zs=b({configType:i.CONFIGTYPE.LINE,commands:xe,create(n,e){return ht(new l.Line,n,{},e)},dispose:pt});class ks extends ut{constructor(){super();c(this,"MODULE",i.MODULETYPE.LINE)}}g.processor(zs);const Te={reg:new RegExp("transparent|sizeAttenuation"),handler({target:n,key:e,value:t}){n[e]=t,n.needsUpdate=!0}},Ne={reg:new RegExp("map$","i"),handler({target:n,key:e,value:t,engine:r}){const o=r.compilerManager.getObjectBySymbol(t);o instanceof l.Texture||console.warn(`this url resource is not instance of Texture: ${e}`,t,o),n[e]=o,n.needsUpdate=!0}},X=function({target:n,key:e,value:t}){n[e].copy(new l.Color(t))},Ge=function(n,e,t){const r={};for(const o of Object.keys(e))if(o.toLocaleLowerCase().endsWith("map")&&e[o]){const s=t.compilerManager.getObjectBySymbol(e[o]);if(!(s instanceof l.Texture)){console.warn(`this url resource is not instance of Texture: ${o}`,e[o],s);continue}n[o]=s,r[o]=!0}else n[o]instanceof l.Color&&(n[o]=new l.Color(e[o]),r[o]=!0);return z(e,n,r),n.needsUpdate=!0,n},Me=function(n){n.dispose()};var jn=b({configType:i.CONFIGTYPE.LINEBASICMATERIAL,commands:{set:{color:X,$reg:[Ne,Te]}},create:function(n,e){return Ge(new l.LineBasicMaterial,n,e)},dispose:Me}),Vs=b({configType:i.CONFIGTYPE.MESHBASICMATERIAL,commands:{set:{color:X,$reg:[Ne,Te]}},create:function(n,e){return Ge(new l.MeshBasicMaterial,n,e)},dispose:Me}),$s=b({configType:i.CONFIGTYPE.MESHPHONGMATERIAL,commands:{set:{color:X,emissive:X,specular:X,$reg:[Ne,Te]}},create:function(n,e){return Ge(new l.MeshPhongMaterial,n,e)},dispose:Me}),Ws=b({configType:i.CONFIGTYPE.MESHPHYSICALMATERIAL,commands:{set:{color:X,emissive:X,specularColor:X,sheenColor:X,attenuationColor:X,$reg:[Ne,Te]}},create:function(n,e){return Ge(new l.MeshPhysicalMaterial,n,e)},dispose:Me}),_s=b({configType:i.CONFIGTYPE.MESHSTANDARDMATERIAL,commands:{set:{color:X,emissive:X,$reg:[Ne,Te]}},create:function(n,e){return Ge(new l.MeshStandardMaterial,n,e)},dispose:Me}),Qs=b({configType:i.CONFIGTYPE.POINTSMATERIAL,commands:{set:{color:X,$reg:[Ne,Te]}},create:function(n,e){return Ge(new l.PointsMaterial,n,e)},dispose:Me}),Xs=b({configType:i.CONFIGTYPE.SHADERMATERIAL,commands:{set:{shader({target:n,value:e}){const t=q.getShader(e);(t==null?void 0:t.vertexShader)&&(n.vertexShader=t.vertexShader),(t==null?void 0:t.fragmentShader)&&(n.fragmentShader=t.fragmentShader),(t==null?void 0:t.uniforms)&&(n.uniforms=t.uniforms),(t==null?void 0:t.defines)&&(n.defines=t.defines),n.needsUpdate=!0},$reg:[Te]}},create:function(n,e){const t=new l.ShaderMaterial,r=q.getShader(n.shader);return(r==null?void 0:r.vertexShader)&&(t.vertexShader=r.vertexShader),(r==null?void 0:r.fragmentShader)&&(t.fragmentShader=r.fragmentShader),(r==null?void 0:r.uniforms)&&(t.uniforms=r.uniforms),(r==null?void 0:r.defines)&&(t.defines=r.defines),z(n,t,{type:!0,shader:!0}),t.needsUpdate=!0,t},dispose:Me}),Ks=b({configType:i.CONFIGTYPE.SPRITEMATERIAL,commands:{set:{color:X,$reg:[Ne,Te]}},create:function(n,e){return Ge(new l.SpriteMaterial,n,e)},dispose:Me});class Js extends g{constructor(){super();c(this,"MODULE",i.MODULETYPE.MATERIAL)}}g.processor(Vs),g.processor(_s),g.processor($s),g.processor(jn),g.processor(Qs),g.processor(Ks),g.processor(jn),g.processor(Xs),g.processor(Ws);var Zs=b({configType:i.CONFIGTYPE.MESH,commands:xe,create(n,e){return ht(new l.Mesh,n,{},e)},dispose:pt});class qs extends ut{constructor(){super();c(this,"MODULE",i.MODULETYPE.MESH)}}g.processor(Zs);var ea=b({configType:i.CONFIGTYPE.OBJECT3D,commands:D,create(n,e){return te(new l.Object3D,n,{},e)},dispose:Q});class ta extends Ee{constructor(){super();c(this,"MODULE",i.MODULETYPE.OBJECT3D)}}g.processor(ea);var na=b({configType:i.CONFIGTYPE.SMAAPASS,create(n,e){const t=window.devicePixelRatio;return new gr.SMAAPass(e.dom?e.dom.offsetWidth*t:window.innerWidth*t,e.dom?e.dom.offsetHeight*t:window.innerWidth*t)},dispose(n){}}),ra=b({configType:i.CONFIGTYPE.UNREALBLOOMPASS,create(n,e){const t=window.devicePixelRatio;return new yr.UnrealBloomPass(new l.Vector2(e.dom?e.dom.offsetWidth*t:window.innerWidth*t,e.dom?e.dom.offsetHeight*t:window.innerWidth*t),n.strength,n.radius,n.threshold)},dispose(n){n.dispose()}});const gt=class extends en.Pass{constructor(e=new l.Vector2(256,256),t=1,r=0,o=0,s=new l.Scene,a=new l.PerspectiveCamera,u){super();c(this,"resolution");c(this,"strength");c(this,"radius");c(this,"threshold");c(this,"selectedObjects",[]);c(this,"renderScene");c(this,"renderCamera");c(this,"clearColor",new l.Color(0,0,0));c(this,"renderTargetsHorizontal",[]);c(this,"renderTargetsVertical",[]);c(this,"nMips",5);c(this,"selectRenderTarget");c(this,"renderTargetBright");c(this,"highPassUniforms");c(this,"materialHighPassFilter");c(this,"separableBlurMaterials",[]);c(this,"compositeMaterial");c(this,"bloomTintColors");c(this,"mixMaterial");c(this,"enabled",!0);c(this,"needsSwap",!1);c(this,"_oldClearColor",new l.Color);c(this,"oldClearAlpha",1);c(this,"basic",new l.MeshBasicMaterial);c(this,"fsQuad",new en.FullScreenQuad);c(this,"materialCache",new Map);c(this,"sceneBackgroundCache",null);c(this,"overrideBackground",new l.Color("black"));c(this,"overrideMeshMaterial",new l.MeshBasicMaterial({color:"black"}));c(this,"overrideLineMaterial",new l.LineBasicMaterial({color:"black"}));c(this,"overridePointsMaterial",new l.PointsMaterial({color:"black"}));c(this,"overrideSpriteMaterial",new l.SpriteMaterial({color:"black"}));this.resolution=e,this.strength=t,this.radius=r,this.threshold=o,this.renderScene=s,this.renderCamera=a,this.selectedObjects=u;let d=Math.round(this.resolution.x/2),h=Math.round(this.resolution.y/2);this.selectRenderTarget=new l.WebGLRenderTarget(d,h),this.selectRenderTarget.texture.name="UnrealBloomPass.selected",this.selectRenderTarget.texture.generateMipmaps=!1,this.renderTargetBright=new l.WebGLRenderTarget(d,h),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let O=0;O<this.nMips;O++){const S=new l.WebGLRenderTarget(d,h);S.texture.name="UnrealBloomPass.h"+O,S.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(S);const v=new l.WebGLRenderTarget(d,h);v.texture.name="UnrealBloomPass.v"+O,v.texture.generateMipmaps=!1,this.renderTargetsVertical.push(v),d=Math.round(d/2),h=Math.round(h/2)}tn.LuminosityHighPassShader===void 0&&console.error("THREE.UnrealBloomPass relies on LuminosityHighPassShader");const m=tn.LuminosityHighPassShader;this.highPassUniforms=l.UniformsUtils.clone(m.uniforms),this.highPassUniforms.luminosityThreshold.value=o,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new l.ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,defines:{}});const E=[3,5,7,9,11];d=Math.round(this.resolution.x/2),h=Math.round(this.resolution.y/2);for(let O=0;O<this.nMips;O++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(E[O])),this.separableBlurMaterials[O].uniforms.texSize.value=new l.Vector2(d,h),d=Math.round(d/2),h=Math.round(h/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;const T=[1,.8,.6,.4,.2];this.compositeMaterial.uniforms.bloomFactors.value=T,this.bloomTintColors=[new l.Vector3(1,1,1),new l.Vector3(1,1,1),new l.Vector3(1,1,1),new l.Vector3(1,1,1),new l.Vector3(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,this.mixMaterial=this.getMixMaterial()}dispose(){for(let e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose()}setSize(e,t){let r=Math.round(e/2),o=Math.round(t/2);this.selectRenderTarget.setSize(r,o),this.renderTargetBright.setSize(r,o);for(let s=0;s<this.nMips;s++)this.renderTargetsHorizontal[s].setSize(r,o),this.renderTargetsVertical[s].setSize(r,o),this.separableBlurMaterials[s].uniforms.texSize.value=new l.Vector2(r,o),r=Math.round(r/2),o=Math.round(o/2)}render(e,t,r,o,s){if(!this.selectedObjects.length){this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=r.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e));return}e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const a=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),s&&e.state.buffers.stencil.setTest(!1);const u=new Map;for(const m of this.selectedObjects)u.set(m,!0);const d=this.materialCache;this.renderScene.background&&(this.sceneBackgroundCache=this.renderScene.background,this.renderScene.background=this.overrideBackground),this.renderScene.traverse(m=>{!u.has(m)&&!m.isLight&&m.visible&&(d.set(m,m.material),m instanceof l.Mesh?m.material=this.overrideMeshMaterial:m instanceof l.Line?m.material=this.overrideLineMaterial:m instanceof l.Points?m.material=this.overridePointsMaterial:m instanceof l.Sprite&&(m.material=this.overrideSpriteMaterial))}),e.setRenderTarget(this.selectRenderTarget),e.clear(),e.render(this.renderScene,this.renderCamera),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=this.selectRenderTarget.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=this.selectRenderTarget.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);let h=this.renderTargetBright;for(let m=0;m<this.nMips;m++)this.fsQuad.material=this.separableBlurMaterials[m],this.separableBlurMaterials[m].uniforms.colorTexture.value=h.texture,this.separableBlurMaterials[m].uniforms.direction.value=gt.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[m]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[m].uniforms.colorTexture.value=this.renderTargetsHorizontal[m].texture,this.separableBlurMaterials[m].uniforms.direction.value=gt.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[m]),e.clear(),this.fsQuad.render(e),h=this.renderTargetsVertical[m];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.mixMaterial,this.mixMaterial.uniforms.bloom.value=this.renderTargetsHorizontal[0].texture,this.mixMaterial.uniforms.origin.value=r.texture,s&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(r),this.fsQuad.render(e)),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=a;for(const m of d.entries())m[0].material=m[1];d.clear(),this.sceneBackgroundCache&&(this.renderScene.background=this.sceneBackgroundCache,this.sceneBackgroundCache=null)}getMixMaterial(){return new l.ShaderMaterial({blending:l.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0,uniforms:{bloom:{value:null},origin:{value:null}},vertexShader:`
    
        varying vec2 vUv;
    
        void main() {
    
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
    
        }`,fragmentShader:`
        uniform sampler2D bloom;
        uniform sampler2D origin;
    
        varying vec2 vUv;
    
        void main() {
          vec3 bloomColor = texture2D(bloom, vUv).rgb;
          vec3 originColor = texture2D(origin, vUv).rgb;
          gl_FragColor = vec4(originColor + bloomColor, 1.0);
        }`})}getSeperableBlurMaterial(e){return new l.ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new l.Vector2(.5,.5)},direction:{value:new l.Vector2(.5,.5)}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 texSize;
				uniform vec2 direction;

				float gaussianPdf(in float x, in float sigma) {
					return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;
				}
				void main() {
					vec2 invSize = 1.0 / texSize;
					float fSigma = float(SIGMA);
					float weightSum = gaussianPdf(0.0, fSigma);
					vec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;
					for( int i = 1; i < KERNEL_RADIUS; i ++ ) {
						float x = float(i);
						float w = gaussianPdf(x, fSigma);
						vec2 uvOffset = direction * invSize * x;
						vec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;
						vec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;
						diffuseSum += (sample1 + sample2) * w;
						weightSum += 2.0 * w;
					}
					gl_FragColor = vec4(diffuseSum/weightSum, 1.0);
				}`})}getCompositeMaterial(e){return new l.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;
				uniform sampler2D blurTexture1;
				uniform sampler2D blurTexture2;
				uniform sampler2D blurTexture3;
				uniform sampler2D blurTexture4;
				uniform sampler2D blurTexture5;
				uniform float bloomStrength;
				uniform float bloomRadius;
				uniform float bloomFactors[NUM_MIPS];
				uniform vec3 bloomTintColors[NUM_MIPS];

				float lerpBloomFactor(const in float factor) {
					float mirrorFactor = 1.2 - factor;
					return mix(factor, mirrorFactor, bloomRadius);
				}

				void main() {
					gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +
						lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +
						lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +
						lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +
						lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );
				}`})}};let Qe=gt;c(Qe,"BlurDirectionX",new l.Vector2(1,0)),c(Qe,"BlurDirectionY",new l.Vector2(0,1));var ia=b({configType:i.CONFIGTYPE.SELECTIVEBLOOMPASS,commands:{add:{selectedObjects({target:n,engine:e,value:t}){const r=e.compilerManager.getObject3D(t);r?n.selectedObjects.push(r):console.warn(`selectiveBloomPassProcessor: can not found vid in engine: ${t}`)}},set:{renderScene({target:n,engine:e,value:t}){const r=e.compilerManager.getObject3D(t);r instanceof l.Scene&&(n.renderScene=r)},renderCamera({target:n,engine:e,value:t}){const r=e.compilerManager.getObject3D(t);r instanceof l.Camera&&(n.renderCamera=r)},selectedObjects({target:n,config:e,engine:t}){const r=e.selectedObjects.map(o=>{const s=t.compilerManager.getObject3D(o);if(s)return s;console.warn(`selectiveBloomPassProcessor: can not found vid in engine: ${o}`)}).filter(o=>o);n.selectedObjects=r}},delete:{selectedObjects({target:n,engine:e,value:t}){const r=e.compilerManager.getObject3D(t);r?n.selectedObjects.includes(r)&&n.selectedObjects.splice(n.selectedObjects.indexOf(r),1):console.warn(`selectiveBloomPassProcessor: can not found vid in engine: ${t}`)}}},create(n,e){const t=[];for(const s of n.selectedObjects){const a=e.compilerManager.getObject3D(s);a&&t.push(a)}const r=window.devicePixelRatio;return new Qe(new l.Vector2(e.dom?e.dom.offsetWidth*r:window.innerWidth*r,e.dom?e.dom.offsetHeight*r:window.innerWidth*r),n.strength,n.radius,n.threshold,n.renderScene&&e.compilerManager.getObject3D(n.renderScene)||void 0,n.renderCamera&&e.compilerManager.getObject3D(n.renderCamera)||void 0,t)},dispose(n){n.dispose()}});class oa extends g{constructor(){super();c(this,"MODULE",i.MODULETYPE.PASS);c(this,"composer")}useEngine(e){return super.useEngine(e),e.effectComposer?(this.composer=e.effectComposer,this):(console.warn("engine need install effectComposer plugin that can use pass compiler."),this)}add(e){const t=super.add(e);return t&&this.composer.addPass(t),t}remove(e){if(!this.map.has(e.vid))return console.warn(`PassCompiler can not found this vid pass: ${e.vid}.`),this;const t=this.map.get(e.vid);return this.composer.removePass(t),super.remove(e),this}}g.processor(na),g.processor(ra),g.processor(ia);var sa=b({configType:i.CONFIGTYPE.POINTS,commands:xe,create(n,e){return ht(new l.Points,n,{},e)},dispose:pt});class aa extends ut{constructor(){super();c(this,"MODULE",i.MODULETYPE.POINTS)}}g.processor(sa);var ca=b({configType:i.CONFIGTYPE.WEBGLRENDERER,commands:{set:{size({target:n,config:e}){e.size?n.setSize(e.size.x,e.size.y):n.setSize(n.domElement.offsetWidth,n.domElement.offsetHeight)},clearColor({target:n,value:e}){const t=Number(e.slice(0,-1).split(",").pop().trim());n.setClearColor(e,t),n.clear()},viewport({target:n,config:e}){const t=e.viewport;if(t)n.setViewport(t.x,t.y,t.width,t.height);else{const r=n.domElement;n.setViewport(0,0,r.offsetWidth,r.offsetHeight)}},scissor({target:n,config:e}){const t=e.scissor;if(t)n.setScissorTest(!0),n.setScissor(t.x,t.y,t.width,t.height);else{n.setScissorTest(!1);const r=n.domElement;n.setScissor(0,0,r.offsetWidth,r.offsetHeight)}},pixelRatio({target:n,value:e}){n.setPixelRatio(e),n.clear()}}},create(n,e){let t;if(e.webGLRenderer?t=e.webGLRenderer:t=new l.WebGLRenderer,n.size&&t.setSize(n.size.x,n.size.y),n.clearColor){const r=Number(n.clearColor.slice(0,-1).split(",").pop().trim());t.setClearColor(n.clearColor,r)}if(n.viewport){const r=n.viewport;t.setViewport(r.x,r.y,r.width,r.height)}if(n.scissor){const r=n.scissor;t.setScissorTest(!0),t.setScissor(r.x,r.y,r.width,r.height)}return n.pixelRatio&&t.setPixelRatio(n.pixelRatio),z(n,t,{size:!0,clearColor:!0,viewport:!0,scissor:!0,pixelRatio:!0}),t},dispose(n){n.clear(),n.dispose()}}),la=b({configType:i.CONFIGTYPE.CSS3DRENDERER,commands:{set:{size({target:n,config:e}){e.size?n.setSize(e.size.x,e.size.y):n.setSize(n.domElement.offsetWidth,n.domElement.offsetHeight)}}},create(n,e){let t;return e.css3DRenderer?t=e.css3DRenderer:t=new me.CSS3DRenderer,n.size&&t.setSize(n.size.x,n.size.y),z(n,t,{size:!0}),t},dispose(n){}});class ua extends g{constructor(){super();c(this,"MODULE",i.MODULETYPE.RENDERER)}useEngine(e){return e.webGLRenderer&&this.map.set(i.CONFIGTYPE.WEBGLRENDERER,e.webGLRenderer),e.css3DRenderer&&this.map.set(i.CONFIGTYPE.CSS3DRENDERER,e.css3DRenderer),super.useEngine(e)}}g.processor(ca),g.processor(la);const Bn=function(n,e,t){if(!e){n.background=null;return}if(J.validate(e)){const r=t.compilerManager.getTexture(e);r?n.background=r:console.warn(`engine can not found this vid texture : '${e}'`)}else n.background=new l.Color(e)},xn=function(n,e,t){if(!e){n.environment=null;return}if(J.validate(e)){const r=t.compilerManager.getTexture(e);r?n.environment=r:console.warn(`engine can not found this vid texture : '${e}'`)}else console.warn(`scene environment is illeage: ${e}`)};var da=b({configType:i.CONFIGTYPE.SCENE,commands:{add:D.add,set:Ke(F({},D.set),{lookAt(){},fog({target:n,config:e,key:t,value:r}){const o=e.fog;o.type?o.type==="Fog"?!n.fog||!(n.fog instanceof l.Fog)?n.fog=new l.Fog(o.color,o.near,o.far):t==="color"?n.fog.color.copy(new l.Color(o.color)):n.fog[t]&&(n.fog[t]=r):o.type==="FogExp2"&&(!n.fog||!(n.fog instanceof l.FogExp2)?n.fog=new l.FogExp2(o.color,o.density):t==="color"?n.fog.color.copy(new l.Color(o.color)):n.fog[t]&&(n.fog[t]=r)):n.fog=null},background({target:n,value:e,engine:t}){Bn(n,e,t)},environment({target:n,value:e,engine:t}){xn(n,e,t)}}),delete:D.delete},create(n,e){const t=new l.Scene;if(Bn(t,n.background,e),xn(t,n.environment,e),n.fog.type){const r=n.fog;r.type==="Fog"?t.fog=new l.Fog(r.color,r.near,r.far):r.type==="FogExp2"?t.fog=new l.FogExp2(r.color,r.density):console.warn(`scene processor can not support this type fog:'${n.type}'`)}return te(t,n,{lookAt:!0,background:!0,environment:!0,fog:!0},e)},dispose:Q});class ha extends Ee{constructor(){super();c(this,"MODULE",i.MODULETYPE.SCENE)}}g.processor(da);const Hn=new l.SpriteMaterial({color:"rgb(123, 123, 123)"});var pa=b({configType:i.CONFIGTYPE.SPRITE,commands:{add:xe.add,set:Ke(F({lookAt(){}},xe.set),{material({target:n,engine:e,value:t}){const r=e.compilerManager.getMaterial(t);r&&r instanceof l.SpriteMaterial?n.material=r:n.material=Hn}}),delete:xe.add},create(n,e){const t=new l.Sprite,r=e.compilerManager.getMaterial(n.material);return r&&r instanceof l.SpriteMaterial?t.material=r:t.material=Hn,ht(t,n,{geometry:!0,material:!0,lookAt:!0},e)},dispose:pt});class ma extends ut{constructor(){super();c(this,"MODULE",i.MODULETYPE.SPRITE)}}g.processor(pa);class fa extends l.Texture{constructor(e,t,r,o,s,a,u,d,h,m){super(e,t,r,o,s,a,u,d,h,m)}}const mt={reg:new RegExp("wrapS|wrapT|format|encoding|anisotropy|magFilter|minFilter|mapping"),handler({target:n,key:e,value:t}){n[e]=t,n.needsUpdate=!0}};var Ea=b({configType:i.CONFIGTYPE.IMAGETEXTURE,commands:{set:{url({target:n,value:e,engine:t}){n.image=t.compilerManager.textureCompiler.getResource(e,HTMLImageElement),n.needsUpdate=!0},$reg:[mt]}},create(n,e){const t=new fa;return n.url&&(t.image=e.compilerManager.textureCompiler.getResource(n.url,HTMLImageElement)),z(n,t,{type:!0,url:!0}),t.needsUpdate=!0,t},dispose(n){n.dispose()}}),ga=b({configType:i.CONFIGTYPE.CANVASTEXTURE,commands:{set:{url({target:n,value:e,engine:t}){n.image=t.compilerManager.textureCompiler.getResource(e,HTMLCanvasElement),n.needsUpdate=!0},$reg:[mt]}},create(n,e){const t=new l.CanvasTexture(e.compilerManager.textureCompiler.getResource(n.url,HTMLCanvasElement));return z(n,t,{type:!0,url:!0}),t.needsUpdate=!0,t},dispose(n){n.dispose()}});const Ae=[HTMLImageElement,HTMLVideoElement,HTMLCanvasElement],He=function({target:n,index:e,value:t,engine:r}){n.images[e]=r.compilerManager.textureCompiler.getResource(t,Ae),n.needsUpdate=!0};var ya=b({configType:i.CONFIGTYPE.CUBETEXTURE,commands:{set:{cube:{px({target:n,value:e,engine:t}){He({target:n,value:e,engine:t,index:0})},nx({target:n,value:e,engine:t}){He({target:n,value:e,engine:t,index:1})},py({target:n,value:e,engine:t}){He({target:n,value:e,engine:t,index:2})},ny({target:n,value:e,engine:t}){He({target:n,value:e,engine:t,index:3})},pz({target:n,value:e,engine:t}){He({target:n,value:e,engine:t,index:4})},nz({target:n,value:e,engine:t}){He({target:n,value:e,engine:t,index:5})}}}},create(n,e){const t=new l.CubeTexture,r=n.cube,o=e.compilerManager.textureCompiler,s=[o.getResource(r.px,Ae),o.getResource(r.nx,Ae),o.getResource(r.py,Ae),o.getResource(r.ny,Ae),o.getResource(r.pz,Ae),o.getResource(r.nz,Ae)];return t.image=s,z(n,t,{type:!0,cube:!0}),t.needsUpdate=!0,t},dispose(n){n.dispose()}});class Ta extends l.Texture{constructor(e,t,r,o,s,a,u,d,h){super(e,t,r,o,s,a,u,d,h);c(this,"isVideoTexture",!0);this.format=u!==void 0?u:l.RGBFormat,this.minFilter=a!==void 0?a:l.LinearFilter,this.magFilter=s!==void 0?s:l.LinearFilter,this.generateMipmaps=!1}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image,t="requestVideoFrameCallback"in e;t?this.needsUpdate=!0:t===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}var Ma=b({configType:i.CONFIGTYPE.VIDEOTEXTURE,commands:{set:{url({target:n,value:e,engine:t}){n.image=t.compilerManager.textureCompiler.getResource(e,HTMLVideoElement),n.needsUpdate=!0},$reg:[mt]}},create(n,e){const t=new Ta(document.createElement("video"));return n.url&&(t.image=e.compilerManager.textureCompiler.getResource(n.url,HTMLVideoElement)),z(n,t,{type:!0,url:!0}),t.needsUpdate=!0,t},dispose(n){n.dispose()}});class ze{constructor(e){c(this,"canvas");this.canvas=document.createElement("canvas");const t=window.devicePixelRatio;this.canvas.width=((e==null?void 0:e.width)||512)*t,this.canvas.height=((e==null?void 0:e.height)||512)*t,this.canvas.style.backgroundColor=(e==null?void 0:e.bgColor)||"rgb(255, 255, 255)";const r=this.canvas.getContext("2d");r&&r.scale(window.devicePixelRatio,window.devicePixelRatio)}get(){return this.canvas}getDom(){return this.canvas}clear(e=0,t=0,r,o){!r&&(r=this.canvas.width),!o&&(o=this.canvas.height);const s=this.canvas.getContext("2d");return s?(s.clearRect(e,t,r,o),this):(console.warn("you browser can not support canvas 2d"),this)}draw(e){const t=this.canvas.getContext("2d");return t?(e(t),this):(console.warn("you browser can not support canvas 2d"),this)}preview(e){const t=this.canvas;return t.style.position="fixed",t.style.top=(e==null?void 0:e.top)||"5%",t.style.left=(e==null?void 0:e.left)||"5%",t.style.right=(e==null?void 0:e.right)||"unset",t.style.bottom=(e==null?void 0:e.bottom)||"unset",(e==null?void 0:e.scale)&&(t.style.transform=`scale(${e.scale})`),document.body.appendChild(this.canvas),this}}class zn extends l.Texture{constructor(e){super();Object.keys(e).forEach(t=>{this[t]=e[t]}),this.copy(e)}}var Sa=b({configType:i.CONFIGTYPE.LOADTEXTURE,commands:{set:{url({}){},$reg:[mt]}},create(n,e){let t;const r=e.compilerManager.textureCompiler.getResource(n.url,l.Texture);if(r instanceof l.Texture)t=new zn(r);else{const o=new l.Texture(r);t=new zn(o)}return z(n,t,{type:!0,url:!0}),t.needsUpdate=!0,t},dispose(n){n.dispose()}});const Xe=class extends g{constructor(){super();c(this,"MODULE",i.MODULETYPE.TEXTURE)}getResource(e,t){const r=this.engine.resourceManager.resourceMap;if(!r.has(e))return console.warn(`engine resourceManager can not found this url: ${e}`),Xe.replaceImage;const o=r.get(e);if(Array.isArray(t)){for(const s of t)if(o instanceof s)return o;return console.warn(`this url mapping resource is not a texture image class: ${e}`,o),Xe.replaceImage}else return o instanceof t?o:(console.warn(`this url mapping resource is not a texture image class: ${e}`,o),Xe.replaceImage)}};let Ut=Xe;c(Ut,"replaceImage",new ze({width:512,height:512}).draw(e=>{e.translate(256,256),e.font="72px",e.fillStyle="white",e.fillText("\u6682\u65E0\u56FE\u7247",0,0)}).getDom()),g.processor(Ea),g.processor(ga),g.processor(ya),g.processor(Ma),g.processor(Sa);class Oa{constructor(e){c(this,"object3DCompiler",new ta);c(this,"cameraCompiler",new os);c(this,"lightCompiler",new xs);c(this,"geometryCompiler",new Gs);c(this,"textureCompiler",new Ut);c(this,"materialCompiler",new Js);c(this,"rendererCompiler",new ua);c(this,"sceneCompiler",new ha);c(this,"controlsCompiler",new cs);c(this,"spriteCompiler",new ma);c(this,"lineCompiler",new ks);c(this,"meshCompiler",new qs);c(this,"pointsCompiler",new aa);c(this,"groupCompiler",new Ds);c(this,"css3DCompiler",new ms);c(this,"passCompiler",new oa);c(this,"animationCompiler",new To);c(this,"compilerMap");e&&Object.keys(e).forEach(r=>{this[r]=e[r]});const t=new Map;Object.keys(this).forEach(r=>{const o=this[r];o instanceof g&&t.set(o.MODULE,o)}),this.compilerMap=t}support(e){this.compilerMap.forEach(r=>{r.useEngine(e)});const t=e.dataSupportManager;return t.textureDataSupport.addCompiler(this.textureCompiler),t.materialDataSupport.addCompiler(this.materialCompiler),t.geometryDataSupport.addCompiler(this.geometryCompiler),t.rendererDataSupport.addCompiler(this.rendererCompiler),t.controlsDataSupport.addCompiler(this.controlsCompiler),t.passDataSupport.addCompiler(this.passCompiler),t.object3DDataSupport.addCompiler(this.object3DCompiler),t.cameraDataSupport.addCompiler(this.cameraCompiler),t.lightDataSupport.addCompiler(this.lightCompiler),t.spriteDataSupport.addCompiler(this.spriteCompiler),t.lineDataSupport.addCompiler(this.lineCompiler),t.meshDataSupport.addCompiler(this.meshCompiler),t.pointsDataSupport.addCompiler(this.pointsCompiler),t.css3DDataSupport.addCompiler(this.css3DCompiler),t.groupDataSupport.addCompiler(this.groupCompiler),t.sceneDataSupport.addCompiler(this.sceneCompiler),t.animationDataSupport.addCompiler(this.animationCompiler),this}getObjectSymbol(e){for(const t of this.compilerMap.values()){const r=t.getObjectSymbol(e);if(r)return r}return null}getObjectBySymbol(e){for(const t of this.compilerMap.values()){const r=t.getObjectBySymbol(e);if(r)return r}return null}getObject3D(e){for(const t of this.compilerMap.values())if(t instanceof Ee&&t.map.has(e))return t.map.get(e);return null}getGeometry(e){return this.geometryCompiler.map.get(e)||null}getMaterial(e){return this.materialCompiler.map.get(e)||null}getTexture(e){return this.textureCompiler.map.get(e)||null}dispose(){for(const e of this.compilerMap.values())e.dispose();return this.compilerMap.clear(),this}}const Ca=function(n){if(this.compilerManager)return console.warn("engine has installed compilerManager plugin."),!1;if(!this.dataSupportManager)return console.warn("must install dataSupportManager before compilerManager plugin."),!1;if(!this.renderManager)return console.warn("must install renderManager before compilerManager plugin."),!1;const e=new Oa;return this.compilerManager=e,this.getObjectSymbol=function(t){return this.compilerManager.getObjectSymbol(t)},this.getObjectBySymbol=function(t){return this.compilerManager.getObjectBySymbol(t)},this.addEventListener("dispose",()=>{this.compilerManager.dispose()}),this.completeSet.add(()=>{this.compilerManager.support(this)}),!0};class kn extends Z{constructor(){super();c(this,"map",new Map)}generateSymbol(e){return Array.isArray(e)?e.join(" + "):e.shortcutKey.join(" + ")}watch(e){return e?Je.default.watch(void 0,e):Je.default.watch(),this}register(e){const t=this.generateSymbol(e);return this.map.has(t)?(console.warn(`KeyboardManager: shortcutKey already exist: ${t}. desp: ${this.map.get(t).desp}`),this):(Je.default.bind(t,e.keydown||null,e.keyup),this.map.set(t,e),this)}update(e){const t=this.generateSymbol(e);return this.map.has(t)?(this.cancel(e.shortcutKey),this.register(e),this):(console.warn("KeyboardManager: shortcutKey unregister then exec register function"),this.register(e),this)}cancel(e){const t=this.generateSymbol(e);if(this.map.has(t)){const r=this.map.get(t);Je.default.unbind(t,r.keydown||null,r.keyup),this.map.delete(t)}return this}checkRepeat(e){const t=this.generateSymbol(e);return this.map.has(t)}getDocs(){const e=[];return this.map.forEach(t=>{e.push({shortcutKey:[].concat(t.shortcutKey),desp:t.desp})}),e}}const ba=function(n){if(this.keyboardManager)return console.warn("engine has installed keyboardManager plugin."),!1;const e=new kn;return this.keyboardManager=e,this.completeSet.add(()=>{if(this.transformControls){let t;this.IS_ENGINESUPPORT?(t=this.dataSupportManager.controlsDataSupport.getData()[i.CONFIGTYPE.TRNASFORMCONTROLS],e.register({shortcutKey:["shift"],desp:"\u53D8\u6362\u63A7\u5236\u5668\u9501\u5B9A\u6B65\u5E45",keyup:r=>{r==null||r.preventDefault(),t.snapAllow=!1},keydown:r=>{r==null||r.preventDefault(),r==null||r.preventRepeat(),t.snapAllow=!0}})):(t=this.transformControls,e.register({shortcutKey:["shift"],desp:"\u53D8\u6362\u63A7\u5236\u5668\u9501\u5B9A\u6B65\u5E45",keyup:r=>{r==null||r.preventDefault(),t.translationSnap=null,t.rotationSnap=null,t.scaleSnap=null},keydown:r=>{r==null||r.preventDefault(),r==null||r.preventRepeat(),t.translationSnap=5,t.rotationSnap=Math.PI/180*10,t.scaleSnap=.1}})),e.register({shortcutKey:["r"],desp:"\u53D8\u6362\u63A7\u5236\u5668\u6A21\u5F0F\uFF1A\u65CB\u8F6C",keyup:r=>{r==null||r.preventDefault(),t.mode="rotate"}}).register({shortcutKey:["t"],desp:"\u53D8\u6362\u63A7\u5236\u5668\u6A21\u5F0F\uFF1A\u79FB\u52A8",keyup:r=>{r==null||r.preventDefault(),t.mode="translate"}}).register({shortcutKey:["e"],desp:"\u53D8\u6362\u63A7\u5236\u5668\u6A21\u5F0F\uFF1A\u7F29\u653E",keyup:r=>{r==null||r.preventDefault(),t.mode="scale"}}).register({shortcutKey:["x"],desp:"\u53D8\u6362\u63A7\u5236\u5668\u5207\u6362\u8F74\uFF1Ax",keyup:r=>{r==null||r.preventDefault(),t.showX=!t.showX}}).register({shortcutKey:["y"],desp:"\u53D8\u6362\u63A7\u5236\u5668\u5207\u6362\u8F74\uFF1Ay",keyup:r=>{r==null||r.preventDefault(),!(r==null?void 0:r.ctrlKey)&&(t.showY=!t.showY)}}).register({shortcutKey:["z"],desp:"\u53D8\u6362\u63A7\u5236\u5668\u5207\u6362\u8F74\uFF1Az",keyup:r=>{r==null||r.preventDefault(),!(r==null?void 0:r.ctrlKey)&&(t.showZ=!t.showZ)}}).register({shortcutKey:["space"],desp:"\u53D8\u6362\u63A7\u5236\u5668\u5207\u6362\u53D8\u6362\u7A7A\u95F4",keyup:r=>{r==null||r.preventDefault(),t.space=t.space==="local"?"world":"local"}})}}),!0},La=function(n={}){if(!this.scene)return console.error("must install some scene plugin before BasicViewpoint plugin."),!1;const e=new l.AxesHelper(n.length||500);return e.matrixAutoUpdate=!1,e.raycast=()=>{},this.scene.add(e),this.setAxesHelper=function(t){return t.show?this.scene.add(e):this.scene.remove(e),this},this.addEventListener("setScene",t=>{t.scene.add(e)}),!0},va=function(n={}){if(!this.scene)return console.error("must install some scene before BasicViewpoint plugin."),!1;const e=new l.GridHelper(n.range||500,n.spacing||50,n.axesColor||"rgb(130, 130, 130)",n.cellColor||"rgb(70, 70, 70)");if(n.opacity!==1){const t=e.material;t.transparent=!0,t.opacity=n.opacity||.5,t.needsUpdate=!0}return e.matrixAutoUpdate=!1,e.raycast=()=>{},this.scene.add(e),this.setGridHelper=function(t){return t.show?this.scene.add(e):this.scene.remove(e),this},this.addEventListener("setScene",t=>{t.scene.add(e)}),this.completeSet.add(()=>{this.setViewpoint&&this.addEventListener("setViewpoint",t=>{const r=t.viewpoint;r===i.VIEWPOINT.DEFAULT||r===i.VIEWPOINT.TOP||r===i.VIEWPOINT.BOTTOM?e.rotation.set(0,0,0):r===i.VIEWPOINT.RIGHT||r===i.VIEWPOINT.LEFT?e.rotation.set(0,0,Math.PI/2):(r===i.VIEWPOINT.FRONT||r===i.VIEWPOINT.BACK)&&e.rotation.set(Math.PI/2,0,0),e.updateMatrix(),e.updateMatrixWorld()})}),!0};i.DISPLAYMODE=void 0,function(n){n.GEOMETRY="geometry",n.MATERIAL="material",n.LIGHT="light",n.ENV="env"}(i.DISPLAYMODE||(i.DISPLAYMODE={}));const Pa=function(n={}){if(!this.webGLRenderer)return console.error("must install some renderer before DisplayModel plugin."),!1;if(!this.scene)return console.error("must install some scene before DisplayModel plugin."),!1;!n.overrideColor&&(n.overrideColor="rgb(250, 250, 250)"),!n.defaultAmbientLightSetting&&(n.defaultAmbientLightSetting={}),!n.defaultAmbientLightSetting.color&&(n.defaultAmbientLightSetting.color="rgb(255, 255, 255)"),!n.defaultAmbientLightSetting.intensity&&(n.defaultAmbientLightSetting.intensity=.5);const e=new l.AmbientLight(n.defaultAmbientLightSetting.color,n.defaultAmbientLightSetting.intensity);e.matrixAutoUpdate=!1,!n.defaultDirectionalLightSetting&&(n.defaultDirectionalLightSetting={}),!n.defaultDirectionalLightSetting.color&&(n.defaultDirectionalLightSetting.color="rgb(255, 255, 255)"),!n.defaultDirectionalLightSetting.intensity&&(n.defaultDirectionalLightSetting.intensity=.5),!n.defaultDirectionalLightSetting.position&&(n.defaultDirectionalLightSetting.position={x:-100,y:100,z:100});const t=new l.DirectionalLight(n.defaultDirectionalLightSetting.color,n.defaultDirectionalLightSetting.intensity);t.castShadow=!1,t.position.set(n.defaultDirectionalLightSetting.position.x,n.defaultDirectionalLightSetting.position.y,n.defaultDirectionalLightSetting.position.z),t.updateMatrix(),t.updateMatrixWorld(),t.matrixAutoUpdate=!1,!n.mode&&(n.mode=i.DISPLAYMODE.ENV),this.displayMode=n.mode;const r=new l.MeshLambertMaterial({color:n.overrideColor}),o=new l.LineBasicMaterial({color:n.overrideColor}),s=new l.PointsMaterial({color:n.overrideColor,size:5,sizeAttenuation:!1}),a=new l.SpriteMaterial({color:n.overrideColor}),u=new WeakMap,d=new Set,h=new Set,m=new Set,E=new Set,T=new Set;let O,S;const v={Object3D:!0,Group:!0};this.scene.addEventListener("afterAdd",f=>{const k=this.displayMode,w=f.objects;for(const P of w)if(!v[P.type])if(P instanceof l.Mesh&&P.type==="Mesh")h.add(P),k===i.DISPLAYMODE.GEOMETRY&&(u.set(P,P.material),P.material=r);else if(P instanceof l.Line&&P.type.includes("Line"))m.add(P),k===i.DISPLAYMODE.GEOMETRY&&(u.set(P,P.material),P.material=o);else if(P instanceof l.Light&&P.type.includes("Light")){if(P===e||P===t)continue;d.has(P)||d.add(P),k!==i.DISPLAYMODE.ENV&&k!==i.DISPLAYMODE.LIGHT&&this.scene.remove(P)}else P instanceof l.Points&&P.type==="Points"?(E.add(P),k===i.DISPLAYMODE.GEOMETRY&&(u.set(P,P.material),P.material=s)):P instanceof l.Sprite&&P.type==="Sprite"&&(T.add(P),k===i.DISPLAYMODE.GEOMETRY&&(u.set(P,P.material),P.material=a))}),this.scene.addEventListener("afterRemove",f=>{const k=f.objects;for(const w of k)if(!v[w.type])if(w instanceof l.Mesh&&w.type==="Mesh")h.delete(w),u.has(w)&&u.delete(w);else if(w instanceof l.Line&&w.type.includes("Line"))m.delete(w),u.has(w)&&u.delete(w);else if(w instanceof l.Light&&w.type.includes("Light")){if(w===e||w===t)continue;d.delete(w)}else w instanceof l.Points&&w.type==="Points"?(E.delete(w),u.has(w)&&u.delete(w)):w instanceof l.Sprite&&w.type==="Sprite"&&(T.delete(w),u.has(w)&&u.delete(w))});const C=()=>{for(const f of h)f.material!==r&&(u.set(f,f.material),f.material=r);for(const f of m)f.material!==o&&(u.set(f,f.material),f.material=o);for(const f of E)f.material!==s&&(u.set(f,f.material),f.material=s);for(const f of T)f.material!==a&&(u.set(f,f.material),f.material=a)},y=()=>{h.forEach(f=>{u.has(f)&&(f.material=u.get(f),u.delete(f))}),m.forEach(f=>{u.has(f)&&(f.material=u.get(f),u.delete(f))}),E.forEach(f=>{u.has(f)&&(f.material=u.get(f),u.delete(f))}),T.forEach(f=>{u.has(f)&&(f.material=u.get(f),u.delete(f))})},R=()=>{d.forEach(f=>{f.visible=!1}),this.scene.add(e),this.scene.add(t)},I=()=>{d.forEach(f=>{f.visible=!0}),this.scene.remove(e),this.scene.remove(t)},L=()=>{this.scene.background instanceof l.Texture&&(O=this.scene.background,this.scene.background=null),this.scene.environment instanceof l.Texture&&(S=this.scene.environment,this.scene.environment=null)},H=()=>{O&&(this.scene.background=O,O=void 0),S&&(this.scene.environment=S,S=void 0)};return this.setDisplayMode=function(f){return this.displayMode=f||i.DISPLAYMODE.ENV,f===i.DISPLAYMODE.GEOMETRY?(C(),L(),R()):f===i.DISPLAYMODE.MATERIAL?(y(),L(),R()):f===i.DISPLAYMODE.LIGHT?(y(),L(),I()):f===i.DISPLAYMODE.ENV?(y(),H(),I()):console.warn(`displayMode plugin can not set this mode: ${f}`),this},this.completeSet.add(()=>{this.objectHelperManager&&this.objectHelperManager.addFilteredObject(t)}),!0},Se=()=>new l.LineBasicMaterial({color:"rgb(255, 255, 255)"});class Ft extends l.LineSegments{constructor(e){super();c(this,"shape");c(this,"target");c(this,"type","CameraHelper");c(this,"cachaData");const t=new l.BufferGeometry,r=[0,0,0,-1,1,-1,0,0,0,-1,1,1,0,0,0,-1,-1,-1,0,0,0,-1,-1,1,-1,-1,1,-1,-1,-1,-1,-1,-1,-1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,-1,1,0,0,0,0,1,1,0,0,0,0,1,-1,0,0,0,0,-1,-1,0,0,0,0,-1,1,0,1,1,0,1,-1,0,1,-1,0,-1,-1,0,-1,-1,0,-1,1,0,-1,1,0,1,1,0,-1,1,2,-1,1,0,1,-1,2,1,-1,0,-1,-1,2,-1,-1,0,1,1,2,1,1,2,1,1,2,-1,1,2,-1,1,2,-1,-1,2,-1,-1,2,1,-1,2,1,-1,2,1,1];t.setAttribute("position",new l.Float32BufferAttribute(r,3)),t.rotateY(-90*Math.PI/180),t.computeBoundingBox();const o=new l.CameraHelper(e);o.matrix=new l.Matrix4,o.matrixAutoUpdate=!0,o.raycast=()=>{},this.add(o),this.shape=o,this.geometry=t,this.material=Se(),this.target=e,this.matrixAutoUpdate=!1,this.matrix=e.matrix,e instanceof l.PerspectiveCamera?this.cachaData={fov:e.fov,aspect:e.aspect,near:e.near,far:e.far}:e instanceof l.OrthographicCamera?this.cachaData={left:e.left,right:e.right,top:e.top,bottom:e.bottom,near:e.near,far:e.far}:this.cachaData={},this.onBeforeRender=()=>{let s=!1;const a=this.cachaData;Object.keys(a).forEach(u=>{a[u]!==e[u]&&(a[u]=e[u],s=!0)}),s&&this.shape.update()}}raycast(e,t){const r=this.matrixWorld,o=this.geometry.boundingBox.clone();if(o.applyMatrix4(r),e.ray.intersectsBox(o)){const s=this.target;t.push({distance:e.ray.origin.distanceTo(s.position),object:s,point:s.position})}}}class Vn extends l.LineSegments{constructor(e){super();c(this,"sphere");c(this,"target");c(this,"shape");c(this,"type","VisDirectionalLightHelper");c(this,"cacheColor");c(this,"cacheVector3");this.geometry=new l.BufferGeometry;const t=[-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,0,0,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,-.707,0,-.707,.707,0,.707,.707,0,-.707,-.707,0,.707];this.geometry.setAttribute("position",new l.Float32BufferAttribute(t,3)),this.material=Se(),this.geometry.boundingSphere;const r=new l.Color().copy(e.color).multiplyScalar(e.intensity),o=new l.PlaneBufferGeometry(20,20);o.dispose();const s=new l.LineSegments(new l.EdgesGeometry(o),new l.LineBasicMaterial({color:r}));s.raycast=()=>{},this.shape=s,this.target=e,this.sphere=new l.Sphere(new l.Vector3(0,0,0),1),this.cacheColor=e.color.getHex(),this.cacheVector3=new l.Vector3,this.add(this.shape),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.onBeforeRender=()=>{const a=this.target,u=this.shape;a.color.getHex()!==this.cacheColor&&(u.material.color.copy(a.color).multiplyScalar(a.intensity),this.cacheColor=a.color.getHex()),u.lookAt(a.target.position)}}raycast(e,t){const r=this.target,o=r.matrixWorld,s=this.sphere;s.set(this.cacheVector3.set(0,0,0),1),s.applyMatrix4(o),e.ray.intersectsSphere(s)&&t.push({distance:e.ray.origin.distanceTo(r.position),object:r,point:r.position})}}class $n extends l.LineSegments{constructor(e){super();c(this,"sphere");c(this,"target");c(this,"shape");c(this,"type","VisPointLightHelper");c(this,"cacheColor");c(this,"cacheDistance");c(this,"cacheVector3");this.geometry=new l.BufferGeometry;const t=[-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,0,0,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,-.707,0,-.707,.707,0,.707,.707,0,-.707,-.707,0,.707];this.geometry.setAttribute("position",new l.Float32BufferAttribute(t,3)),this.material=Se(),this.geometry.boundingSphere;const r=new l.Color().copy(e.color).multiplyScalar(e.intensity),o=new l.Mesh(new l.OctahedronBufferGeometry(e.distance,0),new l.MeshBasicMaterial({color:r,wireframe:!0}));o.raycast=()=>{},o.matrixAutoUpdate=!1,this.shape=o,this.target=e,this.sphere=new l.Sphere(new l.Vector3(0,0,0),1),this.cacheColor=e.color.getHex(),this.cacheDistance=e.distance,this.cacheVector3=new l.Vector3,this.add(this.shape),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.onBeforeRender=()=>{const s=this.target,a=this.shape;s.distance!==this.cacheDistance&&(a.geometry.dispose(),a.geometry=new l.OctahedronBufferGeometry(s.distance,0),this.cacheDistance=s.distance),s.color.getHex()!==this.cacheColor&&(a.material.color.copy(s.color).multiplyScalar(s.intensity),this.cacheColor=s.color.getHex())}}raycast(e,t){const r=this.target,o=r.matrixWorld,s=this.sphere;s.set(this.cacheVector3.set(0,0,0),1),s.applyMatrix4(o),e.ray.intersectsSphere(s)&&t.push({distance:e.ray.origin.distanceTo(r.position),object:r,point:r.position})}}class Wn extends l.LineSegments{constructor(e){super();c(this,"sphere");c(this,"target");c(this,"shape");c(this,"type","VisSpotLightHelper");c(this,"cacheVector3");c(this,"cacheColor");c(this,"cacheAngle");c(this,"cacheDistance");this.geometry=new l.BufferGeometry;const t=[-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,0,0,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,-.707,0,-.707,.707,0,.707,.707,0,-.707,-.707,0,.707];this.geometry.setAttribute("position",new l.Float32BufferAttribute(t,3)),this.material=Se(),this.geometry.boundingSphere;const r=new l.BufferGeometry,o=[0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let h=0,m=1,E=32;h<E;h++,m++){const T=h/E*Math.PI*2,O=m/E*Math.PI*2;o.push(Math.cos(T),Math.sin(T),1,Math.cos(O),Math.sin(O),1)}r.setAttribute("position",new l.Float32BufferAttribute(o,3));const s=Se(),a=new l.LineSegments(r,s);a.material.color.copy(e.color).multiplyScalar(e.intensity);const u=e.distance?e.distance:1e3,d=u*Math.tan(e.angle);a.scale.set(d,d,u),a.raycast=()=>{},this.add(a),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.target=e,this.shape=a,this.sphere=new l.Sphere(new l.Vector3(0,0,0),1),this.cacheColor=e.color.getHex(),this.cacheDistance=e.distance,this.cacheAngle=e.angle,this.cacheVector3=new l.Vector3,this.onBeforeRender=()=>{const h=this.target,m=this.shape;let E=!1;if(h.distance!==this.cacheDistance&&(this.cacheDistance=h.distance,m.scale.z=h.distance,E=!0),h.angle!==this.cacheAngle&&(this.cacheAngle=h.angle,E=!0),E){const T=h.distance*Math.tan(h.angle);m.scale.set(T,T,h.distance)}h.color.getHex()!==this.cacheColor&&(m.material.color.copy(h.color).multiplyScalar(h.intensity),this.cacheColor=h.color.getHex()),m.lookAt(h.target.position)}}raycast(e,t){const r=this.target,o=r.matrixWorld,s=this.sphere;s.set(this.cacheVector3.set(0,0,0),1),s.applyMatrix4(o),e.ray.intersectsSphere(s)&&t.push({distance:e.ray.origin.distanceTo(r.position),object:r,point:r.position})}}class Ra extends l.LineSegments{constructor(e){super();c(this,"target");c(this,"type","VisCSS3DHelper");const r=e.element.getBoundingClientRect(),o=r.width,s=r.height;this.geometry=new l.EdgesGeometry(new l.PlaneBufferGeometry(o,s)),this.geometry.computeBoundingBox(),this.material=Se(),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.target=e}raycast(e,t){const r=this.target,o=r.matrixWorld,s=this.geometry.boundingBox.clone();s.applyMatrix4(o),e.ray.intersectsBox(s)&&t.push({distance:e.ray.origin.distanceTo(r.position),object:r,point:r.position})}}class _n extends l.LineSegments{constructor(e){super();c(this,"target");c(this,"type","VisCSS3DPlaneHelper");c(this,"observer");this.geometry=new l.EdgesGeometry(new l.PlaneBufferGeometry(e.width,e.height)),this.geometry.computeBoundingBox(),this.material=Se(),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.target=e;const t=new MutationObserver(()=>{this.geometry.dispose(),this.geometry=new l.EdgesGeometry(new l.PlaneBufferGeometry(e.width,e.height)),this.geometry.computeBoundingBox()});t.observe(e.element,{attributeFilter:["style"]}),this.observer=t}dispose(){this.observer.disconnect()}}const $t=class extends l.Sprite{constructor(e){super();c(this,"target");c(this,"type","VisGroupHelper");this.target=e,this.geometry.computeBoundingBox(),this.material=new l.SpriteMaterial({map:$t.colorTexture}),this.material.depthTest=!1,this.material.depthWrite=!1,this.scale.set(5,5,5);const t=this.updateMatrixWorld.bind(this);this.updateMatrixWorld=r=>{const o=this.position,s=this.target.position;o.x=s.x,o.y=s.y,o.z=s.z,t(r)}}raycast(e,t){const r=this.matrixWorld,o=this.geometry.boundingBox.clone();if(o.applyMatrix4(r),e.ray.intersectsBox(o)){const s=this.target;t.push({distance:e.ray.origin.distanceTo(s.position),object:s,point:s.position})}}};let ft=$t;c(ft,"colorTexture",new l.CanvasTexture(new ze({width:512,height:512}).draw(e=>{e.beginPath(),e.fillStyle="rgba(0, 0, 0, 0)",e.fillRect(0,0,512,512),e.closePath(),e.translate(256,200),e.beginPath(),e.fillStyle="yellow",e.fillRect(-200,0,400,200),e.closePath(),e.beginPath(),e.fillStyle="yellow",e.fillRect(-200,-70,200,70),e.closePath()}).get()));const Wt=class extends l.Points{constructor(e){super();c(this,"target");c(this,"cachaGeometryUUid");c(this,"type","VisLineHelper");this.target=e,this.geometry.dispose(),this.geometry.copy(e.geometry),this.cachaGeometryUUid=e.geometry.uuid,this.material=new l.PointsMaterial({color:"rgb(255, 255, 255)",alphaMap:Wt.alphaTexture,transparent:!0,size:5,sizeAttenuation:!1}),this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.matrix=e.matrix,this.matrixWorld=e.matrixWorld,this.renderOrder=-1,this.raycast=()=>{},this.onBeforeRender=()=>{const t=this.target;t.geometry.uuid!==this.cachaGeometryUUid&&(this.geometry.dispose(),this.geometry=t.geometry.clone(),this.cachaGeometryUUid=t.geometry.uuid)}}};let Yt=Wt;c(Yt,"alphaTexture",new l.CanvasTexture(new ze({width:512,height:512,bgColor:"rgb(0, 0, 0)"}).draw(e=>{e.beginPath(),e.fillStyle="rgb(255, 255, 255)",e.arc(256,256,200,0,Math.PI*2),e.fill(),e.closePath()}).getDom()));class wa extends l.LineSegments{constructor(e){super();c(this,"target");c(this,"type","VisMeshHelper");c(this,"cachaGeometryUUid");const t=1;this.target=e,this.geometry=new l.EdgesGeometry(e.geometry,t),this.cachaGeometryUUid=e.geometry.uuid,this.material=Se(),this.raycast=()=>{},this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.matrix=e.matrix,this.matrixWorld=e.matrixWorld,this.onBeforeRender=()=>{const r=this.target;r.geometry.uuid!==this.cachaGeometryUUid&&(this.geometry.dispose(),this.geometry=new l.EdgesGeometry(r.geometry,t),this.cachaGeometryUUid=r.geometry.uuid)}}}const _t=class extends l.Points{constructor(e){super();c(this,"target");c(this,"type","VisPointsHelper");this.target=e,this.geometry.dispose(),this.geometry.copy(e.geometry),this.material.dispose(),this.material=new l.PointsMaterial({color:"rgb(255, 255, 255)",alphaMap:_t.alphaTexture,transparent:!0});const t=Array.isArray(e.material)?e.material[0]:e.material;t instanceof l.PointsMaterial&&(this.material.size=t.size,this.material.sizeAttenuation=t.sizeAttenuation),this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.matrix=e.matrix,this.matrixWorld=e.matrixWorld,this.raycast=()=>{}}};let jt=_t;c(jt,"alphaTexture",new l.CanvasTexture(new ze({width:512,height:512,bgColor:"rgb(0, 0, 0)"}).draw(e=>{e.beginPath(),e.strokeStyle="rgb(255, 255, 255)",e.lineWidth=4,e.strokeRect(0,0,512,512),e.closePath()}).get()));const Qt=class extends l.Sprite{constructor(e){super();c(this,"target");c(this,"type","VisSpriteHelper");this.target=e,this.material.dispose(),this.material=new l.SpriteMaterial({color:"rgb(255, 255, 255)",alphaMap:Qt.alphaTexture,transparent:!0,depthWrite:!1}),this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.matrix=e.matrix,this.matrixWorld=e.matrixWorld,this.raycast=()=>{}}};let Bt=Qt;c(Bt,"alphaTexture",new l.CanvasTexture(new ze({width:512,height:512,bgColor:"rgb(0, 0, 0)"}).draw(e=>{e.beginPath(),e.strokeStyle="rgb(255, 255, 255)",e.lineWidth=4,e.strokeRect(0,0,512,512),e.closePath()}).get()));class Ia extends Z{constructor(e={}){super();c(this,"helperGenerator",{[i.CONFIGTYPE.POINTLIGHT]:$n,[i.CONFIGTYPE.SPOTLIGHT]:Wn,[i.CONFIGTYPE.DIRECTIONALLIGHT]:Vn,[i.CONFIGTYPE.PERSPECTIVECAMERA]:Ft,[i.CONFIGTYPE.ORTHOGRAPHICCAMERA]:Ft,[i.CONFIGTYPE.MESH]:wa,[i.CONFIGTYPE.GROUP]:ft,[i.CONFIGTYPE.SPRITE]:Bt,[i.CONFIGTYPE.POINTS]:jt,[i.CONFIGTYPE.LINE]:Yt,[i.CONFIGTYPE.CSS3DOBJECT]:Ra,[i.CONFIGTYPE.CSS3DPLANE]:_n,[i.CONFIGTYPE.CSS3DSPRITE]:_n});c(this,"helperFilter",{AmbientLight:!0,Object3D:!0,TransformControls:!0,Scene:!0});c(this,"objectFilter",new Set);c(this,"objectHelperMap",new Map);e.helperGenerator&&(this.helperGenerator=Object.assign(this.helperGenerator,e.helperGenerator)),e.helperFilter&&(this.helperFilter=Object.assign(this.helperFilter,e.helperFilter)),e.objectFilter&&(this.objectFilter=new Set(e.objectFilter.concat(Array.from(this.objectFilter))))}addFilteredObject(...e){for(const t of e)this.objectFilter.add(t);return this}addObjectHelper(e){if(this.objectFilter.has(e)||this.objectHelperMap.has(e)||this.helperFilter[e.type]||e.type.toLocaleLowerCase().includes("helper"))return null;if(!this.helperGenerator[e.type])return console.warn(`object helper can not support this type object: '${e.type}'`),null;const t=new this.helperGenerator[e.type](e);return this.objectHelperMap.set(e,t),t}disposeObjectHelper(e){if(this.objectFilter.has(e)||this.helperFilter[e.type]||e.type.toLocaleLowerCase().includes("helper"))return null;if(!this.objectHelperMap.has(e))return console.warn("object helper manager can not found this object`s helper: ",e),null;const t=this.objectHelperMap.get(e);return t.geometry&&t.geometry.dispose(),t.material&&(t.material instanceof l.Material?t.material.dispose():t.material.forEach(r=>{r.dispose()})),this.objectHelperMap.delete(e),t}}const Na=function(n={}){if(!this.scene)return console.error("must install some scene plugin before ObjectHelper plugin."),!1;n.interact===void 0&&(n.interact=!0),n.interact&&(this.eventManager||(console.warn("must install eventManager plugin that can use interact function."),n.interact=!1));const e=new Ia,t=new Map,r=new Map,o=new Map,s=e.objectHelperMap;this.objectHelperManager=e,!n.activeColor&&(n.activeColor="rgb(230, 20, 240)"),!n.hoverColor&&(n.hoverColor="rgb(255, 158, 240)"),!n.defaultColor&&(n.defaultColor="rgb(255, 255, 255)"),!n.selectedColor&&(n.selectedColor=n.activeColor);const a=new l.Color(n.defaultColor).getHex(),u=new l.Color(n.activeColor).getHex(),d=new l.Color(n.hoverColor).getHex(),h=new l.Color(n.selectedColor).getHex(),m=new WeakSet,E=v=>{const C=v.objects;for(const y of C){const R=e.addObjectHelper(y);if(!!R&&(R.material.color.setHex(a),this.scene.add(R),n.interact)){const I=()=>{var f;((f=this.transformControls)==null?void 0:f.dragging)||this.selectionBox&&this.selectionBox.has(y)||R.material.color.setHex(d)},L=()=>{var f;((f=this.transformControls)==null?void 0:f.dragging)||this.selectionBox&&this.selectionBox.has(y)||R.material.color.setHex(a)},H=()=>{var f;((f=this.transformControls)==null?void 0:f.dragging)||this.selectionBox&&this.selectionBox.has(y)||R.material.color.setHex(u)};y.addEventListener("pointerenter",I),y.addEventListener("pointerleave",L),y.addEventListener("click",H),t.set(y,I),r.set(y,L),o.set(y,H)}}},T=v=>{const C=v.objects;for(const y of C){const R=e.disposeObjectHelper(y);!R||(this.scene.remove(R),n.interact&&(y.removeEventListener("pointerenter",t.get(y)),y.removeEventListener("pointerleave",r.get(y)),y.removeEventListener("click",o.get(y)),t.delete(y),r.delete(y),o.delete(y)))}},O=v=>{m.has(v)||(v.traverse(C=>{const y=e.addObjectHelper(C);y&&v.add(y)}),m.add(v))};this.scene.addEventListener("afterAdd",E),this.scene.addEventListener("afterRemove",T),this.setObjectHelper=function(v){return v.show?this.scene.traverse(C=>{s.has(C)&&this.scene.add(s.get(C))}):this.scene.traverse(C=>{s.has(C)&&this.scene.remove(s.get(C))}),this},this.addEventListener("setScene",v=>{const C=v.scene;!m.has(C)&&O(C),C.hasEventListener("afterAdd",E)||C.addEventListener("afterAdd",E),C.hasEventListener("afterRemove",T)||C.addEventListener("afterRemove",T)});const S=new Set;return this.completeSet.add(()=>{this.selectionBox&&this.addEventListener("selected",v=>{S.forEach(C=>{C.material.color.setHex(a)}),S.clear();for(const C of v.objects)if(s.has(C)){const y=s.get(C);y.material.color.setHex(h),S.add(y)}})}),!0},Ga=function(n={}){if(this.selectionBox)return console.warn("engine has installed selection plugin."),!1;if(!this.eventManager)return console.warn("must install eventManager plugin before Selection plugin."),!1;this.selectionBox=new Set;const e=()=>{const t=[];this.IS_ENGINESUPPORT&&this.selectionBox.forEach(r=>{const o=this.compilerManager.getObjectSymbol(r);o?t.push(o):console.warn("selection plugin can not font vid in compilerManager.",r)}),this.dispatchEvent({type:"selected",objects:[...this.selectionBox],objectSymbols:t})};return this.setSelectionBox=function(t){this.selectionBox.clear();for(const r of t.objects)this.selectionBox.add(r);return e(),this},this.eventManager.addEventListener("click",t=>{var o,s,a;if(this.transing){this.transing=!1;return}const r=t.intersections;if(t.ctrlKey||this.selectionBox.clear(),this.eventManager.penetrate)for(const u of r){if(t.ctrlKey&&((o=this.selectionBox)==null?void 0:o.has(u.object))){this.selectionBox.delete(u.object);continue}this.selectionBox.add(u.object)}else if(r.length){const u=r[0].object;if(t.ctrlKey&&((s=this.selectionBox)==null?void 0:s.has(u))){this.selectionBox.delete(u);return}(a=this.selectionBox)==null||a.add(u)}e()}),!0},Aa=function(n={}){if(this.css3DRenderer)return console.warn("this has installed css3DRenderer plugin."),!1;this.css3DRenderer=new me.CSS3DRenderer;const e=this.css3DRenderer.domElement;if(e.classList.add("vis-css3D"),e.style.position="absolute",e.style.top="0",e.style.left="0",this.addEventListener("setDom",t=>{t.dom.appendChild(this.css3DRenderer.domElement)}),this.addEventListener("setSize",t=>{this.css3DRenderer.setSize(t.width,t.height)}),this.addEventListener("setScene",t=>{t.oldScene.traverse(o=>{o instanceof me.CSS3DObject&&(o.element.style.display="none")})}),this.renderManager)this.renderManager.removeEventListener("render",this.render),this.renderManager.addEventListener("render",t=>{this.css3DRenderer.render(this.scene,this.camera)});else if(this.webGLRenderer){const t=this.render.bind(this);this.render=function(){return t(),this.webGLRenderer.render(this.scene,this.camera),this}}else this.render=function(){return this.webGLRenderer.render(this.scene,this.camera),this};return!0};i.ENGINEPLUGIN=void 0,function(n){n.WEBGLRENDERER="WebGLRenderer",n.CSS3DRENDERER="CSS3DRenderer",n.SCENE="Scene",n.MODELINGSCENE="ModelingScene",n.RENDERMANAGER="RenderManager",n.ORBITCONTROLS="OrbitControls",n.STATS="Stats",n.EFFECTCOMPOSER="EffectComposer",n.POINTERMANAGER="PointerManager",n.EVENTMANAGER="EventManager",n.TRANSFORMCONTROLS="TransformControls",n.LOADERMANAGER="LoaderManager",n.RESOURCEMANAGER="ResourceManager",n.DATASUPPORTMANAGER="DataSupportManager",n.COMPILERMANAGER="CompilerManager",n.KEYBOARDMANAGER="KeyboardManager",n.AXESHELPER="AxesHelper",n.GRIDHELPER="GridHelper",n.VIEWPOINT="Viewpoint",n.DISPLAYMODE="DisplayMode",n.OBJECTHELPER="ObjectHelper",n.SELECTION="Selection"}(i.ENGINEPLUGIN||(i.ENGINEPLUGIN={}));const Oe=class extends Z{constructor(){super();c(this,"completeSet");c(this,"camera",new l.PerspectiveCamera);c(this,"scene",new l.Scene);c(this,"IS_ENGINESUPPORT",!1);c(this,"dom");c(this,"webGLRenderer");c(this,"css3DRenderer");c(this,"orbitControls");c(this,"transformControls");c(this,"effectComposer");c(this,"renderManager");c(this,"pointerManager");c(this,"eventManager");c(this,"loaderManager");c(this,"resourceManager");c(this,"dataSupportManager");c(this,"compilerManager");c(this,"keyboardManager");c(this,"objectHelperManager");c(this,"transing");c(this,"stats");c(this,"displayMode");c(this,"selectionBox");c(this,"getScreenshot");c(this,"setStats");c(this,"setTransformControls");c(this,"setViewpoint");c(this,"setDisplayMode");c(this,"setAxesHelper");c(this,"setGridHelper");c(this,"setObjectHelper");c(this,"setSelectionBox");c(this,"loadResources");c(this,"loadResourcesAsync");c(this,"registerResources");c(this,"toJSON");c(this,"exportConfig");c(this,"applyConfig");c(this,"reactiveConfig");c(this,"getConfigBySymbol");c(this,"removeConfigBySymbol");c(this,"getObjectSymbol");c(this,"getObjectBySymbol");c(this,"play");c(this,"stop");c(this,"render");this.completeSet=new Set,this.render=function(){return console.warn("can not install some plugin"),this},this.camera.position.set(50,50,50),this.addEventListener("setSize",e=>{this.camera.aspect=e.width/e.height,this.camera.updateProjectionMatrix()})}optimizeMemory(){Object.keys(this).forEach(e=>{this[e]===void 0&&delete this[e]})}install(e,t){return Oe.pluginHandler.has(e)?Oe.pluginHandler.get(e).call(this,t):console.error(`engine can not support ${e} plugin.`),this}complete(){return this.completeSet.forEach(e=>{e(this)}),this.completeSet.clear(),this}dispose(){return this.dispatchEvent({type:"dispose"}),this}setDom(e){return this.dom=e,this.dispatchEvent({type:"setDom",dom:e}),this}setSize(e,t){var r,o;return e&&e<=0||t&&t<=0?(console.warn(`you must be input width and height bigger then zero, width: ${e}, height: ${t}`),this):(!e&&(e=((r=this.dom)==null?void 0:r.offsetWidth)||window.innerWidth),!t&&(t=((o=this.dom)==null?void 0:o.offsetHeight)||window.innerHeight),this.dispatchEvent({type:"setSize",width:e,height:t}),this)}setCamera(e,t){if(typeof e=="object"&&e instanceof l.Camera)this.camera=e,this.dispatchEvent({type:"setCamera",camera:e,options:Object.assign({orbitControls:!0,transformControls:!0},t||{})});else if(this.IS_ENGINESUPPORT){const r=this.compilerManager.getObjectBySymbol(e);r?(this.camera=r,this.dispatchEvent({type:"setCamera",camera:r,options:Object.assign({orbitControls:!0,transformControls:!0},t||{})})):console.warn(`can not found camera in compilerManager: ${e}`)}else console.warn("engine is not a Engine support but use symbol to found camera.");return this}setScene(e){if(typeof e=="object"&&e instanceof l.Scene)this.dispatchEvent({type:"setScene",scene:e,oldScene:this.scene}),this.scene=e;else if(this.IS_ENGINESUPPORT){const t=this.compilerManager.getObjectBySymbol(e);t?(this.dispatchEvent({type:"setScene",scene:t,oldScene:this.scene}),this.scene=t):console.warn(`can not found scene in compilerManager: ${e}`)}else console.warn("engine is not a Engine support but use symbol to found scene.");return this}};let G=Oe;c(G,"pluginHandler",new Map),c(G,"register",function(e,t){return Oe.pluginHandler&&Oe.pluginHandler.set(e,t),Oe}),c(G,"dispose",function(){Oe.pluginHandler=void 0}),G.register(i.ENGINEPLUGIN.WEBGLRENDERER,Ar),G.register(i.ENGINEPLUGIN.CSS3DRENDERER,Aa),G.register(i.ENGINEPLUGIN.EFFECTCOMPOSER,Pr),G.register(i.ENGINEPLUGIN.RENDERMANAGER,Or),G.register(i.ENGINEPLUGIN.POINTERMANAGER,wr),G.register(i.ENGINEPLUGIN.EVENTMANAGER,Nr),G.register(i.ENGINEPLUGIN.LOADERMANAGER,Dr),G.register(i.ENGINEPLUGIN.RESOURCEMANAGER,Hi),G.register(i.ENGINEPLUGIN.DATASUPPORTMANAGER,ho),G.register(i.ENGINEPLUGIN.COMPILERMANAGER,Ca),G.register(i.ENGINEPLUGIN.KEYBOARDMANAGER,ba),G.register(i.ENGINEPLUGIN.ORBITCONTROLS,br),G.register(i.ENGINEPLUGIN.TRANSFORMCONTROLS,Gr),G.register(i.ENGINEPLUGIN.AXESHELPER,La),G.register(i.ENGINEPLUGIN.GRIDHELPER,va),G.register(i.ENGINEPLUGIN.OBJECTHELPER,Na),G.register(i.ENGINEPLUGIN.DISPLAYMODE,Pa),G.register(i.ENGINEPLUGIN.VIEWPOINT,Cr),G.register(i.ENGINEPLUGIN.STATS,vr),G.register(i.ENGINEPLUGIN.SELECTION,Ga);class Da extends G{constructor(){super();this.install(i.ENGINEPLUGIN.WEBGLRENDERER,{antialias:!0,alpha:!0}).install(i.ENGINEPLUGIN.RENDERMANAGER).install(i.ENGINEPLUGIN.EFFECTCOMPOSER,{WebGLMultisampleRenderTarget:!0}).install(i.ENGINEPLUGIN.ORBITCONTROLS).install(i.ENGINEPLUGIN.POINTERMANAGER).install(i.ENGINEPLUGIN.EVENTMANAGER).complete()}}class Ua extends G{constructor(){super();this.install(i.ENGINEPLUGIN.RENDERMANAGER).install(i.ENGINEPLUGIN.WEBGLRENDERER,{antialias:!0,alpha:!0}).install(i.ENGINEPLUGIN.POINTERMANAGER).install(i.ENGINEPLUGIN.EVENTMANAGER).install(i.ENGINEPLUGIN.EFFECTCOMPOSER,{WebGLMultisampleRenderTarget:!0}).install(i.ENGINEPLUGIN.SELECTION).install(i.ENGINEPLUGIN.AXESHELPER).install(i.ENGINEPLUGIN.GRIDHELPER).install(i.ENGINEPLUGIN.OBJECTHELPER).install(i.ENGINEPLUGIN.VIEWPOINT).install(i.ENGINEPLUGIN.DISPLAYMODE).install(i.ENGINEPLUGIN.STATS).install(i.ENGINEPLUGIN.ORBITCONTROLS).install(i.ENGINEPLUGIN.KEYBOARDMANAGER).install(i.ENGINEPLUGIN.TRANSFORMCONTROLS).complete()}}class Fa{constructor(){c(this,"supportData");c(this,"supportDataType")}create(e){return e?(this.supportData={},this.supportDataType=e,this):(console.warn("you must give a module type in create params"),this)}add(e){return!this.supportData||!this.supportDataType?(console.warn("you must call 'create' method before the 'add' method"),this):e.type?ve(e.type)!==this.supportDataType?(console.warn(`current generator create config which module is in: ${this.supportDataType}, but you provide type is '${e.type}'`),this):(this.supportData[e.vid]=B(e.type,e),this):(console.warn("config can not found attribute 'type'"),this)}get(){return this.supportDataType=void 0,this.supportData?this.supportData:{}}}const xt=new l.PointLight("rgb(255, 255, 255)",.5,200,1);xt.position.set(-30,5,20),xt.castShadow=!0;const Et=new l.Mesh(new l.BoxBufferGeometry(80,2,80),new l.MeshStandardMaterial({color:"rgb(255, 255, 255)"}));Et.position.set(0,-11,0),Et.receiveShadow=!0,Et.castShadow=!0;const se=class{constructor(e){c(this,"material");c(this,"dom");c(this,"renderer");c(this,"scene");c(this,"camera");c(this,"object");const t=new l.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0});t.setPixelRatio(window.devicePixelRatio),t.setClearColor("rgb(150, 150, 150)"),t.shadowMap.enabled=!0,t.shadowMap.type=l.PCFSoftShadowMap;const r=new l.Scene,o=new l.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,500);o.position.set(0,0,35),o.up.x=0,o.up.y=1,o.up.z=0,o.lookAt(new l.Vector3(0,0,0)),r.add(se.ambientLight),r.add(se.pointLight),r.add(se.plane),this.scene=r,this.renderer=t,this.camera=o,this.object=new l.Object3D,(e==null?void 0:e.material)&&this.setMaterial(e.material),(e==null?void 0:e.dom)&&this.setDom(e.dom)}setMaterial(e){if(this.scene.remove(this.object),this.material=e,e.type.includes("Mesh"))this.object=new l.Mesh(se.geometry,e);else if(e.type.includes("Line"))this.object=new l.Line(se.geometry,e);else if(e.type.includes("Ponits"))this.object=new l.Points(se.geometry,e);else if(e.type.includes("Sprite"))this.object=new l.Sprite(e);else return console.warn(`material displayer can not support this type material: '${e.type}'`),this;return this.object.castShadow=!0,this.object.receiveShadow=!0,this.scene.add(this.object),this}setDom(e){return this.dom=e,this.setSize(),e.appendChild(this.renderer.domElement),this}setSize(e,t){if(e&&t)this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t,!0);else{if(!this.dom)return console.warn("material displayer must set dom before setSize with empty parameters"),this;const r=this.dom;this.camera.aspect=r.offsetWidth/r.offsetHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(r.offsetWidth,r.offsetHeight,!0)}return this}render(){this.renderer.render(this.scene,this.camera)}getDataURL(e){return this.renderer.domElement.toDataURL(e||"image/png")}dispose(){this.renderer.dispose()}};let De=se;c(De,"ambientLight",new l.AmbientLight("rgb(255, 255, 255)",.7)),c(De,"pointLight",xt),c(De,"geometry",new l.SphereBufferGeometry(10,12,12)),c(De,"plane",Et),c(De,"dispose",()=>{se.geometry.dispose(),se.plane.geometry.dispose()});const Xt=class{constructor(e){c(this,"dom");c(this,"texture");c(this,"renderer");c(this,"scene");c(this,"camera");const t=new l.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0});t.setPixelRatio(window.devicePixelRatio),t.setClearColor("rgb(150, 150, 150)"),t.shadowMap.enabled=!0,t.shadowMap.type=l.PCFSoftShadowMap;const r=new l.Scene,o=new l.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,500);o.position.set(0,0,35),o.up.x=0,o.up.y=1,o.up.z=0,o.lookAt(new l.Vector3(0,0,0)),r.add(Xt.ambientLight),this.scene=r,this.renderer=t,this.camera=o,(e==null?void 0:e.texture)&&this.setTexture(e.texture),(e==null?void 0:e.dom)&&this.setDom(e.dom)}setTexture(e){return this.scene.background=e,this}setDom(e){return this.dom=e,this.setSize(),e.appendChild(this.renderer.domElement),this}setSize(e,t){if(e&&t)this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t,!0);else{if(!this.dom)return console.warn("texture displayer must set dom before setSize with empty parameters"),this;const r=this.dom;this.camera.aspect=r.offsetWidth/r.offsetHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(r.offsetWidth,r.offsetHeight,!0)}return this}render(){this.renderer.render(this.scene,this.camera)}getDataURL(e){return this.renderer.domElement.toDataURL(e||"image/png")}dispose(){this.renderer.dispose()}};let Ht=Xt;c(Ht,"ambientLight",new l.AmbientLight("rgb(255, 255, 255)",1));class zt extends G{constructor(e={},t={}){super();c(this,"IS_ENGINESUPPORT",!0);this.install(i.ENGINEPLUGIN.LOADERMANAGER).install(i.ENGINEPLUGIN.RESOURCEMANAGER,{resources:t}).install(i.ENGINEPLUGIN.POINTERMANAGER).install(i.ENGINEPLUGIN.EVENTMANAGER).install(i.ENGINEPLUGIN.RENDERMANAGER).install(i.ENGINEPLUGIN.DATASUPPORTMANAGER,e).install(i.ENGINEPLUGIN.COMPILERMANAGER)}loadLifeCycle(e){const t=this.dataSupportManager;e.texture&&t.load({texture:e.texture}),e.material&&t.load({material:e.material}),delete e.texture,delete e.material,t.load(e)}removeLifeCycle(e){const t=this.dataSupportManager,r=e[i.MODULETYPE.TEXTURE]||{},o=e[i.MODULETYPE.MATERIAL]||{},s=e.assets||[];delete e.texture,delete e.material,delete e.assets,t.remove(e),t.remove({[i.MODULETYPE.MATERIAL]:o}),t.remove({[i.MODULETYPE.TEXTURE]:r});const a=this.resourceManager,u=this.loaderManager;s.forEach(d=>{a.remove(d),u.remove(d)})}loadConfig(e,t){const r=this.renderManager.hasRendering();if(r&&this.renderManager.stop(),e.assets&&e.assets.length){const o=s=>{delete e.assets,this.loadLifeCycle(e),this.resourceManager.removeEventListener("mapped",o),t&&t(s),r?this.renderManager.play():this.renderManager.render()};this.resourceManager.addEventListener("mapped",o),this.loaderManager.reset().load(e.assets)}else this.loadLifeCycle(e),t&&t(),r?this.renderManager.play():this.renderManager.render();return this}loadConfigAsync(e){return new Promise((t,r)=>{const o=this.renderManager.hasRendering();if(o&&this.renderManager.stop(),e.assets&&e.assets.length){const s=a=>{delete e.assets,this.loadLifeCycle(e),this.resourceManager.removeEventListener("mapped",s),o?this.renderManager.play():this.renderManager.render(),t(a)};this.resourceManager.addEventListener("mapped",s),this.loaderManager.reset().load(e.assets)}else this.loadLifeCycle(e),o?this.renderManager.play():this.renderManager.render(),t(void 0)})}removeConfig(e){this.removeLifeCycle(e)}getObjectConfig(e){const t=this.getObjectSymbol(e);return t?this.getConfigBySymbol(t):null}use(e){e.init(this)}}class Ya extends zt{constructor(e){super(e);c(this,"IS_ENGINESUPPORT",!0);this.install(i.ENGINEPLUGIN.WEBGLRENDERER,{antialias:!0,alpha:!0}).install(i.ENGINEPLUGIN.EFFECTCOMPOSER,{WebGLMultisampleRenderTarget:!0}).install(i.ENGINEPLUGIN.SELECTION).install(i.ENGINEPLUGIN.AXESHELPER).install(i.ENGINEPLUGIN.GRIDHELPER).install(i.ENGINEPLUGIN.OBJECTHELPER).install(i.ENGINEPLUGIN.VIEWPOINT).install(i.ENGINEPLUGIN.DISPLAYMODE).install(i.ENGINEPLUGIN.STATS).install(i.ENGINEPLUGIN.ORBITCONTROLS).install(i.ENGINEPLUGIN.KEYBOARDMANAGER).install(i.ENGINEPLUGIN.TRANSFORMCONTROLS).complete()}}class ja extends zt{constructor(e){super(e);this.install(i.ENGINEPLUGIN.WEBGLRENDERER,{antialias:!0,alpha:!0}).install(i.ENGINEPLUGIN.EFFECTCOMPOSER,{WebGLMultisampleRenderTarget:!0}).install(i.ENGINEPLUGIN.ORBITCONTROLS).complete()}}class Ba{constructor(e){c(this,"visible",!0);e.visible&&(this.visible=e.visible)}}class xa extends Ba{constructor(e){super(e);c(this,"source");c(this,"target");c(this,"mode");c(this,"cacheSourceMatrix");c(this,"cacheTargetMatrix");c(this,"cacheSoruceGeometryUuid");c(this,"cacheTargetGeometryUuid");c(this,"originalGeometry");c(this,"modifiedGeometry");this.source=e.source,this.target=e.target,this.mode=e.mode||"subtract",this.cacheSourceMatrix=this.source.matrix.clone(),this.cacheTargetMatrix=this.target.matrix.clone(),this.cacheSoruceGeometryUuid=this.source.geometry.uuid,this.cacheTargetGeometryUuid=this.target.geometry.uuid,this.originalGeometry=this.source.geometry,this.modifiedGeometry=new l.BufferGeometry,this.modify(),this.source.geometry=this.modifiedGeometry}async modify(){const e=this.source,t={geometry:this.originalGeometry,matrix:this.source.matrix},r=Ot.CSG.fromMesh(t),o=Ot.CSG.fromMesh(this.target),s=Ot.CSG.toGeometry(r[this.mode](o),e.matrix);this.modifiedGeometry.copy(s),this.modifiedGeometry.uuid=s.uuid}render(){if(this.visible){if(!this.cacheSourceMatrix.equals(this.source.matrix)){this.modify(),this.cacheSourceMatrix.copy(this.source.matrix);return}if(!this.cacheTargetMatrix.equals(this.target.matrix)){this.modify(),this.cacheTargetMatrix.copy(this.target.matrix);return}if(this.originalGeometry.uuid!==this.cacheSoruceGeometryUuid){this.modify(),this.cacheSoruceGeometryUuid=this.originalGeometry.uuid;return}if(this.target.geometry.uuid!==this.cacheTargetGeometryUuid){this.modify(),this.cacheTargetGeometryUuid=this.target.geometry.uuid;return}}else this.modifiedGeometry.copy(this.originalGeometry)}apply(){this.originalGeometry.copy(this.modifiedGeometry),this.originalGeometry.uuid=this.modifiedGeometry.uuid,this.source.geometry=this.originalGeometry}dispose(){this.source.geometry=this.originalGeometry,this.modifiedGeometry.dispose()}}class Ha{next(){console.warn(`this action can not set next function: ${this.constructor.name}`)}prev(){console.warn(`this action can not set prev function: ${this.constructor.name}`)}}class za{constructor(e){c(this,"actionList",[]);c(this,"index",-1);c(this,"step",50);this.step=e||50}do(e){this.actionList[this.index][e]()}apply(e,t=!1){const r=this.actionList;this.index===r.length-1&&r.length>=this.step?(r.shift(),this.index=this.actionList.length-1):this.index!==-1?r.splice(this.index+1,r.length-1):this.index===-1&&(this.actionList=[]),this.actionList.push(e),t?this.redo():this.index+=1}redo(){if(this.index+=1,this.index>this.actionList.length-1){this.index=this.actionList.length-1;return}this.do("next")}undo(){this.index<0||(this.do("prev"),this.index-=1)}clear(){this.actionList=[]}}var ka={clone:(n,e={})=>{let t=JSON.stringify(n,rt.stringify);const r={},o=Object.keys(n).filter(a=>a!=="assets");for(const a of o)for(const u of Object.keys(n[a])){const d=J.v4();t=t.replace(new RegExp(u,"g"),d),e.detail&&(r[u]=d)}const s=JSON.parse(t,rt.parse);if(e.fillName)if(typeof e.fillName=="function")for(const a of o)for(const u of Object.keys(s[a])){const d=s[a][u];d.name||(d.name=e.fillName(d))}else for(const a of o)for(const u of Object.keys(s[a])){const d=s[a][u];d.name||(d.name=`${d.type}-${u.slice(-2)}`)}return e.detail?{config:s,detail:r}:s},handler:(n,e,t={clone:!0,assets:!1})=>{const r=t.clone?rt.clone(n):n,o=t.assets?Object.keys(r):Object.keys(r).filter(s=>s!=="assets");for(const s of o){const a=r[s];for(const u of Object.keys(a))a[u]=e(a[u])}return r}};class Va{constructor(){c(this,"dep",{});c(this,"target",{})}createSign(e){return e.path.length?`${e.path.join(".")}.${e.key}`:e.key}walk(e,t){e.includes(".")?e.split("."):this.target[e]=t}setTarget(e){this.target=e}collect(e,t,r){const o=a=>{if(a.notice.operate==="get"){const u=this.createSign(a.notice);this.dep[u]||(this.dep[u]=new Set),this.dep[u].add(e)}};t.addEventListener("broadcast",o);const s=r();return t.removeEventListener("broadcast",o),s}notify(e){const t=this.createSign(e);this.dep[t]&&this.dep[t].forEach(r=>{})}}class $a extends we{constructor(){super();c(this,"deps",new Set);this.addEventListener("broadcast",e=>{e.notice.operate!=="get"&&this.deps.forEach(t=>{t.notify(e.notice)})})}addDep(e){this.deps.add(e)}}const yt=class{constructor(e){c(this,"run");c(this,"token",Symbol("VIS.RENDER.UPDATE"));this.run=e,yt.map.set(this.token,this)}};let Ue=yt;c(Ue,"map",new Map),c(Ue,"get",function(e){return yt.map.get(e)});const Wa=function(n){return new Ue(n)},_a=function(n,e){const t=r=>{for(const o in r)typeof r[o]=="object"&&r[o]!==null&&!(r[o]instanceof Ue)?t(r[o]):r[o]instanceof Ue&&(r[o]=r[o].token)};return t(e),B(n,e,!1,!1)},Tt=class extends Z{constructor(e){super();c(this,"component",function(e){if(Tt.components[e.name]){console.warn(`${e.name} components has exist`);return}Tt.components[e.name]=e});c(this,"observed",{});c(this,"options");c(this,"render",{});c(this,"observer",new $a);c(this,"dependence",new Va);this.options=e}createComputed(){const e=this.options.computed||{};for(const t in e)this.observed[t]=this.dependence.collect(t,this.observer,e[t].bind(this.observed))}createRender(){const e=this.options.render.call(this.observed,_a,()=>{},Wa),t=(r,o)=>{for(const s in r)if(typeof r[s]=="object"&&r[s]!==null)t(r[s],o.concat([s]));else if(typeof r[s]=="symbol"){const a=Ue.get(r[s]);a?r[s]=this.dependence.collect(`${o.join(".")}.${s}`,this.observer,a.run.bind(this.observed)):console.error(`Widget createRender can not found this updater: ${r[s]}`)}};t(e,[]),this.render=e,Object.assign(this.observed,this.render)}createObserver(){const e=this.options,t=Object.assign({},e.computed||{});for(const r in t)t[r]=null;this.observed=this.observer.proxyExtends(Object.assign({},e.input,e.data?e.data():{},t,e.methods||{}),[],!1)}createWatch(){const e=this.options.watch||{};this.observer.addEventListener("broadcast",t=>{const{operate:r,key:o,path:s,value:a}=t.notice;if(r!=="get"){const u=s.length?`${s.join(".")}.${o}`:o;e[u]&&e[u].call(this.observed,a)}})}createMethods(){this.options.methods}async init(e){const t=this.options;t.beforeLoad&&t.beforeLoad(),t.resources&&await e.loadResourcesAsync(Object.values(t.resources)),t.loaded&&t.loaded(),this.createObserver(),this.createComputed(),this.createRender(),this.createWatch(),t.beforeCreate&&t.beforeCreate();const r={};Object.values(this.render).forEach(s=>{const a=ve(s.type);a?r[a]?r[a][s.vid]=s:r[a]={[s.vid]:s}:console.warn(`widget can not support this config type: ${s.type}`)});const o=B(i.CONFIGTYPE.GROUP);Object.keys(r).forEach(s=>{s.toLocaleUpperCase()in i.OBJECTMODULE&&Object.values(r[s]).forEach(a=>{a.parent||o.children.push(a.vid)})}),r[i.MODULETYPE.GROUP]?r[i.MODULETYPE.GROUP][o.vid]=o:r[i.MODULETYPE.GROUP]={[o.vid]:o},e.loadConfig(r),e.getConfigBySymbol(t.parent).children.push(o.vid),t.created&&t.created()}exportConfig(){}loadConfig(){}};let kt=Tt;c(kt,"components",{});const Qa="0.2.4";window.__THREE__||console.error("vis-three dependent on three.js module, pleace run 'npm i three' first."),window.__VIS__?console.warn("Duplicate vis-three frames are introduced"):window.__VIS__=Qa,l.Scene.prototype.add=function(...n){if(!arguments.length)return this;if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}const e=n[0];if(e===this)return console.error("THREE.Object3D.add: object can't be added as a child of itself.",n),this;if(e&&e.isObject3D){if(e.parent!==null){const t=this.children.indexOf(e);t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent({type:"removed"}))}e.parent=this,this.children.push(e),e.dispatchEvent({type:"added"})}else console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",n);return this};const Xa=l.Scene.prototype.add,Ka=l.Scene.prototype.remove;l.Scene.prototype.add=function(...n){return Xa.call(this,...n),this.dispatchEvent({type:"afterAdd",objects:n}),this},l.Scene.prototype.remove=function(...n){return Ka.call(this,...n),this.dispatchEvent({type:"afterRemove",objects:n}),this};const Vt=new Mr.LightShadow(new l.OrthographicCamera(-256,256,256,-256));Vt.autoUpdate=!1,Vt.needsUpdate=!1,l.AmbientLight.prototype.shadow=Vt,i.Action=Ha,i.AniScriptLibrary=fe,i.AnimationDataSupport=wn,i.BooleanModifier=xa,i.CONFIGMODULE=Ur,i.CSS3DDataSupport=In,i.CSS3DPlane=Fn,i.CameraDataSupport=Tn,i.CameraHelper=Ft,i.CanvasGenerator=ze,i.ControlsDataSupport=On,i.DataSupportManager=Gn,i.DirectionalLightHelper=Vn,i.DisplayEngine=Da,i.DisplayEngineSupport=ja,i.Engine=G,i.EngineSupport=zt,i.EventDispatcher=Z,i.EventLibrary=A,i.GeometryDataSupport=yn,i.GroupDataSupport=Pn,i.GroupHelper=ft,i.History=za,i.JSONHandler=zi,i.KeyboardManager=kn,i.LightDataSupport=gn,i.LineDataSupport=bn,i.LoaderManager=an,i.MaterialDataSupport=En,i.MaterialDisplayer=De,i.MeshDataSupport=Ln,i.ModelingEngine=Ua,i.ModelingEngineSupport=Ya,i.Object3DDataSupport=Nn,i.PassDataSupport=Rn,i.PointLightHelper=$n,i.PointsDataSupport=vn,i.ProxyBroadcast=we,i.RenderManager=rn,i.RendererDataSupport=Mn,i.ResourceManager=pn,i.SceneDataSupport=Sn,i.SelectiveBloomPass=Qe,i.ShaderLibrary=q,i.SpotLightHelper=Wn,i.SpriteDataSupport=Cn,i.SupportDataGenerator=Fa,i.Template=ka,i.TextureDataSupport=fn,i.TextureDisplayer=Ht,i.Translater=mn,i.Utils=xi,i.VideoLoader=Le,i.Widget=kt,i.generateConfig=B,i.getModule=ve,Object.defineProperty(i,"__esModule",{value:!0}),i[Symbol.toStringTag]="Module"});
