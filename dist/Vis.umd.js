(function(f,c){typeof exports=="object"&&typeof module!="undefined"?c(exports,require("three"),require("three/examples/jsm/libs/stats.module"),require("three/examples/jsm/postprocessing/EffectComposer"),require("three/examples/jsm/postprocessing/RenderPass"),require("three/examples/jsm/controls/TransformControls"),require("three/examples/jsm/loaders/OBJLoader"),require("three/examples/jsm/loaders/MTLLoader"),require("three/examples/jsm/loaders/RGBELoader"),require("three/examples/jsm/loaders/GLTFLoader"),require("three/examples/jsm/loaders/FBXLoader"),require("three/examples/jsm/loaders/DRACOLoader"),require("three/examples/jsm/loaders/KTX2Loader.js"),require("three/examples/jsm/libs/meshopt_decoder.module.js"),require("uuid"),require("rxjs"),require("three-csg-ts"),require("three/examples/jsm/renderers/CSS3DRenderer"),require("@tweenjs/tween.js"),require("keyboardjs"),require("three/examples/jsm/postprocessing/Pass"),require("three/examples/jsm/shaders/LuminosityHighPassShader"),require("three/examples/jsm/lights/RectAreaLightUniformsLib.js"),require("three/src/lights/LightShadow"),require("three/examples/jsm/postprocessing/SMAAPass"),require("three/examples/jsm/postprocessing/UnrealBloomPass"),require("three/examples/jsm/renderers/CSS2DRenderer")):typeof define=="function"&&define.amd?define(["exports","three","three/examples/jsm/libs/stats.module","three/examples/jsm/postprocessing/EffectComposer","three/examples/jsm/postprocessing/RenderPass","three/examples/jsm/controls/TransformControls","three/examples/jsm/loaders/OBJLoader","three/examples/jsm/loaders/MTLLoader","three/examples/jsm/loaders/RGBELoader","three/examples/jsm/loaders/GLTFLoader","three/examples/jsm/loaders/FBXLoader","three/examples/jsm/loaders/DRACOLoader","three/examples/jsm/loaders/KTX2Loader.js","three/examples/jsm/libs/meshopt_decoder.module.js","uuid","rxjs","three-csg-ts","three/examples/jsm/renderers/CSS3DRenderer","@tweenjs/tween.js","keyboardjs","three/examples/jsm/postprocessing/Pass","three/examples/jsm/shaders/LuminosityHighPassShader","three/examples/jsm/lights/RectAreaLightUniformsLib.js","three/src/lights/LightShadow","three/examples/jsm/postprocessing/SMAAPass","three/examples/jsm/postprocessing/UnrealBloomPass","three/examples/jsm/renderers/CSS2DRenderer"],c):(f=typeof globalThis!="undefined"?globalThis:f||self,c(f.Vis={},f.three,f.Stats,f.EffectComposer,f.RenderPass,f.TransformControls,f.OBJLoader,f.MTLLoader,f.RGBELoader,f.GLTFLoader,f.FBXLoader,f.DRACOLoader,f.KTX2Loader_js,f.meshopt_decoder_module_js,f.uuid,f.rxjs,f.threeCsgTs,f.CSS3DRenderer,f.tween_js,f.keyboardjs,f.Pass,f.LuminosityHighPassShader,f.RectAreaLightUniformsLib_js,f.LightShadow,f.SMAAPass,f.UnrealBloomPass,f.CSS2DRenderer))})(this,function(f,c,De,jt,Bt,Gn,Un,Hn,Nn,zn,Fn,kn,$n,Vn,Z,It,Gt,Se,B,Wn,mr,fr,Yn,_n,Xn,Qn,Ut){"use strict";var Tl=Object.defineProperty;var xl=(f,c,De)=>c in f?Tl(f,c,{enumerable:!0,configurable:!0,writable:!0,value:De}):f[c]=De;var i=(f,c,De)=>(xl(f,typeof c!="symbol"?c+"":c,De),De);function gr(t){return t&&typeof t=="object"&&"default"in t?t:{default:t}}var Kn=gr(De),dt=gr(Wn);class te{constructor(){i(this,"listeners",new Map)}addEventListener(r,e){const n=this.listeners;n.has(r)||n.set(r,new Set),n.get(r).add(e)}hasEventListener(r,e){const n=this.listeners;return n.has(r)?n.get(r).has(e):!1}removeEventListener(r,e){const n=this.listeners;!n.has(r)||!n.get(r).has(e)||n.get(r).delete(e)}dispatchEvent(r){var s;const e=r.type,n=this.listeners;if(n.has(e))try{(s=n.get(e))==null||s.forEach(o=>{o.call(this,r)})}catch(o){console.error(o)}}clear(){this.listeners.clear()}useful(){return Boolean([...this.listeners.keys()].length)}once(r,e){const n=function(s){e.call(this,s),this.removeEventListener(r,n)};this.addEventListener(r,n)}emit(r,e={}){var s;const n=this.listeners;if(n.has(r))try{(s=n.get(r))==null||s.forEach(o=>{o.call(this,e)})}catch(o){console.error(o)}}on(r,e){this.addEventListener(r,e)}has(r,e){return this.hasEventListener(r,e)}off(r,e){if(e)this.removeEventListener(r,e);else{const n=this.listeners;if(!n.has(r))return;n.delete(r)}}}class yr extends te{constructor(e=0){super();i(this,"clock",new c.Clock);i(this,"animationFrame",-1);i(this,"fps",0);i(this,"timer",null);i(this,"playFun",()=>{});i(this,"render",()=>{this.dispatchEvent({type:"render",delta:this.clock.getDelta(),total:this.clock.getElapsedTime()})});i(this,"play",()=>{if(this.hasRendering()){console.warn("render manager is rendering.");return}this.dispatchEvent({type:"play"}),this.playFun()});i(this,"stop",()=>{this.animationFrame!==-1&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=-1),this.timer&&(clearTimeout(this.timer),this.timer=null),this.dispatchEvent({type:"stop"})});i(this,"hasRendering",()=>Boolean(this.animationFrame!==-1||this.timer));i(this,"hasVaildRender",()=>this.useful());this.setFPS(e)}setFPS(e){return this.animationFrame!==-1&&cancelAnimationFrame(this.animationFrame),this.timer&&clearTimeout(this.timer),this.fps=e,e<=0?(this.fps=0,this.playFun=()=>{this.render(),this.animationFrame=requestAnimationFrame(this.playFun)}):this.playFun=()=>{this.timer=setTimeout(()=>{this.playFun()},e),this.render()},this.playFun(),this}dispose(){this.hasRendering()&&this.stop(),this.clear()}}const Jn=function(){return this.renderManager?(console.warn("has installed render manager plugin."),!1):(this.renderManager=new yr,this.render=function(){return this.renderManager.render(),this},this.play=function(){return this.renderManager.play(),this},this.stop=function(){return this.renderManager.stop(),this},this.addEventListener("dispose",()=>{this.renderManager.dispose()}),!0)};class Er extends te{constructor(e,n){super();i(this,"object");i(this,"domElement");i(this,"enabled",!0);i(this,"target",new c.Vector3);i(this,"minDistance",0);i(this,"maxDistance",1/0);i(this,"minZoom",0);i(this,"maxZoom",1/0);i(this,"minPolarAngle",0);i(this,"maxPolarAngle",Math.PI);i(this,"minAzimuthAngle",-1/0);i(this,"maxAzimuthAngle",1/0);i(this,"enableDamping",!1);i(this,"dampingFactor",.05);i(this,"enableZoom",!0);i(this,"zoomSpeed",1);i(this,"enableRotate",!0);i(this,"rotateSpeed",1);i(this,"enablePan",!0);i(this,"panSpeed",1);i(this,"screenSpacePanning",!0);i(this,"keyPanSpeed",7);i(this,"autoRotate",!1);i(this,"autoRotateSpeed",2);i(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"});i(this,"mouseButtons",{LEFT:null,MIDDLE:c.MOUSE.DOLLY,RIGHT:c.MOUSE.ROTATE});i(this,"touches",{ONE:c.TOUCH.ROTATE,TWO:c.TOUCH.DOLLY_PAN});i(this,"target0");i(this,"position0");i(this,"zoom0");i(this,"_domElementKeyEvents",null);i(this,"spherical");i(this,"reset");i(this,"update");i(this,"onContextMenu");i(this,"onPointerDown");i(this,"onPointerCancel");i(this,"onMouseWheel");i(this,"onPointerMove");i(this,"onPointerUp");i(this,"onKeyDown");this.object=e||new c.PerspectiveCamera,this.domElement=n||document.createElement("div"),this.domElement.style.touchAction="none",this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.update=(()=>{const m=new c.Vector3,w=new c.Quaternion().setFromUnitVectors(this.object.up,new c.Vector3(0,1,0)),F=w.clone().invert(),X=new c.Vector3,Oe=new c.Quaternion,Ae=2*Math.PI;return()=>{const In=this.object.position;m.copy(In).sub(this.target),m.applyQuaternion(w),l.setFromVector3(m),this.autoRotate&&o===s.NONE&&P(H()),this.enableDamping?(l.theta+=d.theta*this.dampingFactor,l.phi+=d.phi*this.dampingFactor):(l.theta+=d.theta,l.phi+=d.phi);let ye=this.minAzimuthAngle,Ee=this.maxAzimuthAngle;return isFinite(ye)&&isFinite(Ee)&&(ye<-Math.PI?ye+=Ae:ye>Math.PI&&(ye-=Ae),Ee<-Math.PI?Ee+=Ae:Ee>Math.PI&&(Ee-=Ae),ye<=Ee?l.theta=Math.max(ye,Math.min(Ee,l.theta)):l.theta=l.theta>(ye+Ee)/2?Math.max(ye,l.theta):Math.min(Ee,l.theta)),l.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,l.phi)),l.makeSafe(),l.radius*=p,l.radius=Math.max(this.minDistance,Math.min(this.maxDistance,l.radius)),this.enableDamping===!0?this.target.addScaledVector(h,this.dampingFactor):this.target.add(h),m.setFromSpherical(l),m.applyQuaternion(F),In.copy(this.target).add(m),this.object.lookAt(this.target),this.enableDamping===!0?(d.theta*=1-this.dampingFactor,d.phi*=1-this.dampingFactor,h.multiplyScalar(1-this.dampingFactor)):(d.set(0,0,0),h.set(0,0,0)),p=1,g||X.distanceToSquared(this.object.position)>a||8*(1-Oe.dot(this.object.quaternion))>a?(this.dispatchEvent({type:"change"}),X.copy(this.object.position),Oe.copy(this.object.quaternion),g=!1,!0):!1}})();const s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let o=s.NONE;const a=1e-6,l=new c.Spherical,d=new c.Spherical;let p=1;const h=new c.Vector3;let g=!1;const R=new c.Vector2,M=new c.Vector2,C=new c.Vector2,D=new c.Vector2,L=new c.Vector2,b=new c.Vector2,v=new c.Vector2,A=new c.Vector2,W=new c.Vector2,O=[],E={},H=()=>2*Math.PI/60/60*this.autoRotateSpeed,j=()=>Math.pow(.95,this.zoomSpeed),P=m=>{d.theta-=m},bn=m=>{d.phi-=m},vn=function(){const m=new c.Vector3;return function(F,X){m.setFromMatrixColumn(X,0),m.multiplyScalar(-F),h.add(m)}}(),wn=(()=>{const m=new c.Vector3;return(w,F)=>{this.screenSpacePanning===!0?m.setFromMatrixColumn(F,1):(m.setFromMatrixColumn(F,0),m.crossVectors(this.object.up,m)),m.multiplyScalar(w),h.add(m)}})(),Je=(()=>{const m=new c.Vector3;return(w,F)=>{const X=this.domElement;if(this.object instanceof c.PerspectiveCamera){const Oe=this.object.position;m.copy(Oe).sub(this.target);let Ae=m.length();Ae*=Math.tan(this.object.fov/2*Math.PI/180),vn(2*w*Ae/X.clientHeight,this.object.matrix),wn(2*F*Ae/X.clientHeight,this.object.matrix)}else this.object instanceof c.OrthographicCamera?(vn(w*(this.object.right-this.object.left)/this.object.zoom/X.clientWidth,this.object.matrix),wn(F*(this.object.top-this.object.bottom)/this.object.zoom/X.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}})(),dr=m=>{this.object instanceof c.PerspectiveCamera?p/=m:this.object instanceof c.OrthographicCamera?(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*m)),this.object.updateProjectionMatrix(),g=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)},Cn=m=>{this.object instanceof c.PerspectiveCamera?p*=m:this.object instanceof c.OrthographicCamera?(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/m)),this.object.updateProjectionMatrix(),g=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)};function Rn(m){R.set(m.clientX,m.clientY)}function ll(m){v.set(m.clientX,m.clientY)}function Tn(m){D.set(m.clientX,m.clientY)}const ul=m=>{M.set(m.clientX,m.clientY),C.subVectors(M,R).multiplyScalar(this.rotateSpeed);const w=this.domElement;P(2*Math.PI*C.x/w.clientHeight),bn(2*Math.PI*C.y/w.clientHeight),R.copy(M),this.update()},dl=m=>{A.set(m.clientX,m.clientY),W.subVectors(A,v),W.y>0?dr(j()):W.y<0&&Cn(j()),v.copy(A),this.update()},hl=m=>{L.set(m.clientX,m.clientY),b.subVectors(L,D).multiplyScalar(this.panSpeed),Je(b.x,b.y),D.copy(L),this.update()},pl=m=>{m.deltaY<0?Cn(j()):m.deltaY>0&&dr(j()),this.update()},ml=m=>{let w=!1;switch(m.code){case this.keys.UP:Je(0,this.keyPanSpeed),w=!0;break;case this.keys.BOTTOM:Je(0,-this.keyPanSpeed),w=!0;break;case this.keys.LEFT:Je(this.keyPanSpeed,0),w=!0;break;case this.keys.RIGHT:Je(-this.keyPanSpeed,0),w=!0;break}w&&(m.preventDefault(),this.update())};function xn(){if(O.length===1)R.set(O[0].pageX,O[0].pageY);else{const m=.5*(O[0].pageX+O[1].pageX),w=.5*(O[0].pageY+O[1].pageY);R.set(m,w)}}function Ln(){if(O.length===1)D.set(O[0].pageX,O[0].pageY);else{const m=.5*(O[0].pageX+O[1].pageX),w=.5*(O[0].pageY+O[1].pageY);D.set(m,w)}}function On(){const m=O[0].pageX-O[1].pageX,w=O[0].pageY-O[1].pageY,F=Math.sqrt(m*m+w*w);v.set(0,F)}const fl=()=>{this.enableZoom&&On(),this.enablePan&&Ln()},gl=()=>{this.enableZoom&&On(),this.enableRotate&&xn()},An=m=>{if(O.length==1)M.set(m.pageX,m.pageY);else{const F=pr(m),X=.5*(m.pageX+F.x),Oe=.5*(m.pageY+F.y);M.set(X,Oe)}C.subVectors(M,R).multiplyScalar(this.rotateSpeed);const w=this.domElement;P(2*Math.PI*C.x/w.clientHeight),bn(2*Math.PI*C.y/w.clientHeight),R.copy(M)},Dn=m=>{if(O.length===1)L.set(m.pageX,m.pageY);else{const w=pr(m),F=.5*(m.pageX+w.x),X=.5*(m.pageY+w.y);L.set(F,X)}b.subVectors(L,D).multiplyScalar(this.panSpeed),Je(b.x,b.y),D.copy(L)},Pn=m=>{const w=pr(m),F=m.pageX-w.x,X=m.pageY-w.y,Oe=Math.sqrt(F*F+X*X);A.set(0,Oe),W.set(0,Math.pow(A.y/v.y,this.zoomSpeed)),dr(W.y),v.copy(A)},yl=m=>{this.enableZoom&&Pn(m),this.enablePan&&Dn(m)},El=m=>{this.enableZoom&&Pn(m),this.enableRotate&&An(m)};this.onPointerDown=m=>{this.enabled!==!1&&(O.length===0&&(this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp)),Rl(m),m.pointerType==="touch"?vl(m):Sl(m))};let hr=!1;this.onPointerMove=m=>{this.enabled!==!1&&(hr||(this.domElement.setPointerCapture(m.pointerId),hr=!0),m.pointerType==="touch"?wl(m):Ml(m))},this.onPointerUp=m=>{this.enabled!==!1&&(hr=!1,m.pointerType==="touch"?Cl():bl(m),jn(m),O.length===0&&(this.domElement.releasePointerCapture(m.pointerId),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)))},this.onPointerCancel=m=>{jn(m)};const Sl=m=>{let w;switch(m.button){case 0:w=this.mouseButtons.LEFT;break;case 1:w=this.mouseButtons.MIDDLE;break;case 2:w=this.mouseButtons.RIGHT;break;default:w=-1}switch(w){case c.MOUSE.DOLLY:if(this.enableZoom===!1)return;ll(m),o=s.DOLLY;break;case c.MOUSE.ROTATE:if(m.ctrlKey||m.metaKey||m.shiftKey){if(this.enablePan===!1)return;Tn(m),o=s.PAN}else{if(this.enableRotate===!1)return;Rn(m),o=s.ROTATE}break;case c.MOUSE.PAN:if(m.ctrlKey||m.metaKey||m.shiftKey){if(this.enableRotate===!1)return;Rn(m),o=s.ROTATE}else{if(this.enablePan===!1)return;Tn(m),o=s.PAN}break;default:o=s.NONE}o!==s.NONE&&this.dispatchEvent({type:"start"})},Ml=m=>{if(this.enabled!==!1)switch(o){case s.ROTATE:if(this.enableRotate===!1)return;ul(m);break;case s.DOLLY:if(this.enableZoom===!1)return;dl(m);break;case s.PAN:if(this.enablePan===!1)return;hl(m);break}},bl=m=>{this.dispatchEvent({type:"end"}),o=s.NONE};this.onMouseWheel=m=>{this.enabled===!1||this.enableZoom===!1||o!==s.NONE||(m.preventDefault(),this.dispatchEvent({type:"start"}),pl(m),this.dispatchEvent({type:"end"}))},this.onKeyDown=m=>{this.enabled===!1||this.enablePan===!1||ml(m)};const vl=m=>{switch(Bn(m),O.length){case 1:switch(this.touches.ONE){case c.TOUCH.ROTATE:if(this.enableRotate===!1)return;xn(),o=s.TOUCH_ROTATE;break;case c.TOUCH.PAN:if(this.enablePan===!1)return;Ln(),o=s.TOUCH_PAN;break;default:o=s.NONE}break;case 2:switch(this.touches.TWO){case c.TOUCH.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;fl(),o=s.TOUCH_DOLLY_PAN;break;case c.TOUCH.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;gl(),o=s.TOUCH_DOLLY_ROTATE;break;default:o=s.NONE}break;default:o=s.NONE}o!==s.NONE&&this.dispatchEvent({type:"start"})},wl=m=>{switch(Bn(m),o){case s.TOUCH_ROTATE:if(this.enableRotate===!1)return;An(m),this.update();break;case s.TOUCH_PAN:if(this.enablePan===!1)return;Dn(m),this.update();break;case s.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;yl(m),this.update();break;case s.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;El(m),this.update();break;default:o=s.NONE}},Cl=m=>{this.dispatchEvent({type:"end"}),o=s.NONE};this.onContextMenu=m=>{this.enabled!==!1&&m.preventDefault()};function Rl(m){O.push(m)}const jn=m=>{delete E[m.pointerId];for(let w=0;w<O.length;w++)if(O[w].pointerId==m.pointerId){O.splice(w,1);return}};function Bn(m){let w=E[m.pointerId];w===void 0&&(w=new c.Vector2,E[m.pointerId]=w),w.set(m.pageX,m.pageY)}function pr(m){const w=m.pointerId===O[0].pointerId?O[1]:O[0];return E[w.pointerId]}this.spherical=l,this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),this.domElement.addEventListener("wheel",this.onMouseWheel,{passive:!1}),this.reset=()=>{this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent({type:"change"}),this.update(),o=s.NONE},this.update()}getPolarAngle(){return this.spherical.phi}getAzimuthalAngle(){return this.spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this.onKeyDown),this._domElementKeyEvents=e}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}setCamera(e){this.object=e}setDom(e){this.dispose(),this.domElement=e,this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),this.domElement.addEventListener("wheel",this.onMouseWheel,{passive:!1})}dispose(){this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("pointercancel",this.onPointerCancel),this.domElement.removeEventListener("wheel",this.onMouseWheel),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp),this._domElementKeyEvents!==null&&this._domElementKeyEvents.removeEventListener("keydown",this.onKeyDown)}}var Y=(t=>(t.DEFAULT="default",t.TOP="top",t.BOTTOM="bottom",t.LEFT="left",t.RIGHT="right",t.FRONT="front",t.BACK="back",t))(Y||{});const qn=function(t={}){var s;if(!this.webGLRenderer)return console.error("must install some renderer before BasicViewpoint plugin."),!1;!t.viewpoint&&(t.viewpoint="default"),!t.perspective&&(t.perspective={}),!t.perspective.position&&(t.perspective.position={x:60,y:60,z:60}),!t.perspective.lookAt&&(t.perspective.lookAt={x:0,y:0,z:0}),!t.perspective.up&&(t.perspective.up={x:0,y:1,z:0}),!t.orthograpbic&&(t.orthograpbic={}),!t.orthograpbic.up&&(t.orthograpbic.up={x:0,y:1,z:0});const r=new c.PerspectiveCamera;r.position.set(t.perspective.position.x,t.perspective.position.y,t.perspective.position.z),r.lookAt(t.perspective.lookAt.x,t.perspective.lookAt.y,t.perspective.lookAt.z),r.up.set(t.perspective.up.x,t.perspective.up.y,t.perspective.up.z);const e=t.orthograpbic.distance||1e4,n=new c.OrthographicCamera(-window.innerWidth/8,window.innerWidth/8,-window.innerHeight/8,window.innerHeight/8,0,e);return n.up.set(t.perspective.up.x,t.perspective.up.y,t.perspective.up.z),this.setViewpoint=function(o){return this.dispatchEvent({type:"setViewpoint",viewpoint:o}),this},this.addEventListener("setSize",o=>{const a=o.width,l=o.height,d=a/l;r.aspect=d,r.updateProjectionMatrix(),n.left=-e*d,n.right=e*d,n.top=e,n.bottom=-e,n.zoom=e/l*5,n.updateProjectionMatrix()}),(s=t.orthograpbic.allowRotate)!=null,this.addEventListener("setViewpoint",o=>{const a=o.viewpoint;if(a==="default"){this.setCamera(r);return}a==="top"?n.position.set(0,e/2,0):a==="bottom"?n.position.set(0,-e/2,0):a==="right"?n.position.set(e/2,0,0):a==="left"?n.position.set(-e/2,0,0):a==="front"?n.position.set(0,0,e/2):a==="back"&&n.position.set(0,0,-e/2),this.setCamera(n)}),this.completeSet.add(()=>{t.viewpoint==="default"?this.setCamera(r):this.setCamera(n),this.objectHelperManager&&this.objectHelperManager.addFilteredObject(r,n)}),!0},Zn=function(t){return this.orbitControls?(console.warn("this has installed orbitControls plugin."),!1):this.renderManager?(this.orbitControls=new Er(this.camera,this.dom),this.addEventListener("setCamera",r=>{r.options.orbitControls&&this.orbitControls.setCamera(r.camera)}),this.addEventListener("setDom",r=>{this.orbitControls.setDom(r.dom)}),this.renderManager.addEventListener("render",()=>{this.orbitControls.update()}),this.completeSet.add(()=>{this.setViewpoint&&this.addEventListener("setViewpoint",r=>{const e=r.viewpoint;this.orbitControls.target.set(0,0,0),e===Y.DEFAULT?this.orbitControls.enableRotate=!0:e===Y.TOP?this.orbitControls.enableRotate=!1:e===Y.BOTTOM?this.orbitControls.enableRotate=!1:e===Y.RIGHT?this.orbitControls.enableRotate=!1:e===Y.LEFT?this.orbitControls.enableRotate=!1:e===Y.FRONT?this.orbitControls.enableRotate=!1:e===Y.BACK&&(this.orbitControls.enableRotate=!1)})}),!0):(console.warn("this must install renderManager before install orbitControls plugin."),!1)};class es{constructor(r){i(this,"REVISION");i(this,"dom");i(this,"addPanel");i(this,"showPanel");i(this,"begin");i(this,"end");i(this,"update");i(this,"domElement");i(this,"setMode");const e=Kn.default();this.REVISION=e.REVISION,this.dom=e.dom,this.domElement=e.domElement,this.begin=e.begin.bind(e),this.end=e.end.bind(e),this.update=e.update.bind(e),this.addPanel=e.addPanel.bind(e),this.showPanel=e.showPanel.bind(e),this.setMode=e.setMode.bind(e);const n=this.domElement;n.style.position="absolute",n.style.top="0",n.style.left="35px",r&&(n.style.top=`${r.top}px`,n.style.left=`${r.left}px`,n.style.right=`${r.right}px`,n.style.bottom=`${r.bottom}px`)}}const ts=function(t){if(this.stats)return console.warn("this has installed stats plugin."),!1;if(!this.renderManager)return console.warn("this must install renderManager before install stats plugin."),!1;const r=new es(t);this.stats=r;const e=()=>{this.stats.update()};return this.setStats=function(n){if(n)this.dom.appendChild(this.stats.domElement),this.renderManager.addEventListener("render",e);else try{this.dom.removeChild(this.stats.domElement),this.renderManager.removeEventListener("render",e)}catch{}return this},!0},rs=function(t={}){if(this.effectComposer)return console.warn("this has installed effect composer plugin."),!1;if(!this.webGLRenderer)return console.error("must install some renderer before this plugin."),!1;let r;if(t.WebGLMultisampleRenderTarget||t.MSAA){const n=this.webGLRenderer,s=n.getPixelRatio(),o=n.getDrawingBufferSize(new c.Vector2);Number(window.__THREE__)>137?r=new jt.EffectComposer(n,new c.WebGLRenderTarget(o.width*s,o.height*s,{format:t.format||c.RGBAFormat,samples:t.samples||4})):r=new jt.EffectComposer(n,new c.WebGLMultisampleRenderTarget(o.width*s,o.height*s,{format:t.format||c.RGBAFormat}))}else r=new jt.EffectComposer(this.webGLRenderer);this.effectComposer=r;let e;return this.scene&&this.camera&&(e=new Bt.RenderPass(this.scene,this.camera),r.addPass(e)),this.addEventListener("setCamera",n=>{if(!e&&this.scene){e=new Bt.RenderPass(this.scene,n.camera),r.addPass(e);return}else e&&(e.camera=n.camera)}),this.addEventListener("setScene",n=>{if(!e&&this.camera){e=new Bt.RenderPass(n.scene,this.camera),r.addPass(e);return}else e&&(e.scene=n.scene)}),this.addEventListener("setSize",n=>{r.setSize(n.width,n.height)}),this.renderManager?(this.renderManager.removeEventListener("render",this.render),this.renderManager.addEventListener("render",n=>{this.effectComposer.render(n.delta)})):this.render=function(){return this.effectComposer.render(),this},!0};class ns extends te{constructor(e){super();i(this,"dom");i(this,"mouse");i(this,"canMouseMove");i(this,"mouseEventTimer");i(this,"throttleTime");i(this,"pointerDownHandler");i(this,"pointerMoveHandler");i(this,"pointerUpHandler");i(this,"mouseDownHandler");i(this,"mouseUpHandler");i(this,"clickHandler");i(this,"dblclickHandler");i(this,"contextmenuHandler");this.dom=e.dom,this.mouse=new c.Vector2,this.canMouseMove=!0,this.mouseEventTimer=null,this.throttleTime=e.throttleTime||1e3/60;const n=o=>{const a={mouse:{x:this.mouse.x,y:this.mouse.y}};for(const l in o)a[l]=o[l];return a},s=o=>{this.dispatchEvent(n(o))};this.pointerMoveHandler=o=>{!this.canMouseMove||(this.canMouseMove=!1,this.mouseEventTimer=window.setTimeout(()=>{const a=this.mouse,l=this.dom,d=l.getBoundingClientRect();a.x=(o.clientX-d.left)/l.offsetWidth*2-1,a.y=-((o.clientY-d.top)/l.offsetHeight)*2+1,this.canMouseMove=!0,this.dispatchEvent(n(o))},this.throttleTime))},this.mouseDownHandler=s,this.mouseUpHandler=s,this.pointerDownHandler=s,this.pointerUpHandler=s,this.clickHandler=s,this.dblclickHandler=s,this.contextmenuHandler=s}setDom(e){if(this.dom){const n=this.dom;n.removeEventListener("mousedown",this.mouseDownHandler),n.removeEventListener("mouseup",this.mouseUpHandler),n.removeEventListener("pointerdown",this.pointerDownHandler),n.removeEventListener("pointermove",this.pointerMoveHandler),n.removeEventListener("pointerup",this.pointerUpHandler),n.removeEventListener("click",this.clickHandler),n.removeEventListener("dblclick",this.dblclickHandler),n.removeEventListener("contextmenu",this.contextmenuHandler)}return e.addEventListener("mousedown",this.mouseDownHandler),e.addEventListener("mouseup",this.mouseUpHandler),e.addEventListener("pointerdown",this.pointerDownHandler),e.addEventListener("pointermove",this.pointerMoveHandler),e.addEventListener("pointerup",this.pointerUpHandler),e.addEventListener("click",this.clickHandler),e.addEventListener("dblclick",this.dblclickHandler),e.addEventListener("contextmenu",this.contextmenuHandler),this.dom=e,this}getNormalMouse(){return this.mouse}}const ss=function(t){if(this.pointerManager)return console.warn("this has installed pointerManager plugin."),!1;const r=new ns(Object.assign(t||{},{dom:this.dom}));return this.addEventListener("setDom",e=>{r.setDom(e.dom)}),this.pointerManager=r,!0};var Ht=(t=>(t.POINTERDOWN="pointerdown",t.POINTERUP="pointerup",t.POINTERMOVE="pointermove",t.POINTERENTER="pointerenter",t.POINTERLEAVE="pointerleave",t.CLICK="click",t.DBLCLICK="dblclick",t.CONTEXTMENU="contextmenu",t))(Ht||{});class os extends te{constructor(e){super();i(this,"raycaster");i(this,"scene");i(this,"camera");i(this,"filter",new Set);i(this,"recursive",!1);i(this,"penetrate",!1);i(this,"propagation",!1);i(this,"delegation",!1);this.raycaster=new c.Raycaster,this.camera=e.camera,this.scene=e.scene,e.recursive&&(this.recursive=e.recursive),e.penetrate&&(this.penetrate=e.penetrate)}setScene(e){return this.scene=e,this}setCamera(e){return this.camera=e,this}addFilterObject(e){return this.filter.add(e),this}removeFilterObject(e){return this.filter.delete(e),this}intersectObject(e){this.raycaster.setFromCamera(e,this.camera);const n=this.filter,s=this.scene.children.filter(o=>!n.has(o));return this.raycaster.intersectObjects(s,this.recursive)}use(e){const n=function(d,p){return Object.assign({},d,p)},s=(d,p)=>{const h=this.intersectObject(d.mouse);if(h.length)if(this.penetrate)for(const g of h)g.object.dispatchEvent(n(d,{type:p,intersection:g}));else{const g=h[0];g.object.dispatchEvent(n(d,{type:p,intersection:g}))}this.dispatchEvent(n(d,{type:p,intersections:h}))},o=["pointerdown","pointerup","mousedown","mouseup","pointermove","click","dblclick","contextmenu"];for(const d of o)e.addEventListener(d,p=>{s(p,d)});const a=new Map;let l=null;return e.addEventListener("pointermove",d=>{const p=this.intersectObject(d.mouse);if(this.penetrate){if(!p.length){a.forEach(h=>{h.object.dispatchEvent(n(d,{type:"pointerleave",intersection:h})),h.object.dispatchEvent(n(d,{type:"mouseleave",intersection:h}))}),a.clear();return}for(const h of p)a.has(h.object)?(h.object.dispatchEvent(n(d,{type:"pointermove",intersection:h})),h.object.dispatchEvent(n(d,{type:"mousemove",intersection:h})),a.delete(h.object)):(h.object.dispatchEvent(n(d,{type:"pointerenter",intersection:h})),h.object.dispatchEvent(n(d,{type:"mouseenter",intersection:h})));for(const h of a.values())h.object.dispatchEvent(n(d,{type:"pointerleave",intersection:h})),h.object.dispatchEvent(n(d,{type:"mouseleave",intersection:h}));a.clear();for(const h of p)a.set(h.object,h)}else{if(!p.length){l&&(l.object.dispatchEvent(n(d,{type:"pointerleave",intersection:l})),l.object.dispatchEvent(n(d,{type:"mouseleave",intersection:l})),l=null);return}const h=p[0];if(!l){h.object.dispatchEvent(n(d,{type:"pointerenter",intersection:h})),h.object.dispatchEvent(n(d,{type:"mouseenter",intersection:h})),l=h;return}if(h.object!==l.object){l.object.dispatchEvent(n(d,{type:"pointerleave",intersection:h})),l.object.dispatchEvent(n(d,{type:"mouseleave",intersection:h})),h.object.dispatchEvent(n(d,{type:"pointerenter",intersection:h})),h.object.dispatchEvent(n(d,{type:"mouseenter",intersection:h})),l=h;return}h.object===l.object&&(h.object.dispatchEvent(n(d,{type:"pointermove",intersection:h})),h.object.dispatchEvent(n(d,{type:"mousemove",intersection:h})))}this.dispatchEvent(n(d,{type:"pointermove",intersections:p})),this.dispatchEvent(n(d,{type:"mousemove",intersections:p}))}),this}}const is=function(t){if(this.eventManager)return console.warn("engine has installed eventManager plugin."),!1;if(!this.pointerManager)return console.error("must install pointerManager before this plugin."),!1;const r=new os(Object.assign({scene:this.scene,camera:this.camera},t));return r.use(this.pointerManager),this.eventManager=r,this.addEventListener("setCamera",e=>{this.eventManager.setCamera(e.camera)}),this.addEventListener("setScene",e=>{this.eventManager.setScene(e.scene)}),!0};var Sr=(t=>(t.OBJECTCHANGED="objectChanged",t))(Sr||{});class Mr extends Gn.TransformControls{constructor(e,n){!e&&(e=new c.PerspectiveCamera),!n&&(n=document.body);super(e,n);i(this,"target");i(this,"transObjectSet");this.domElement.removeEventListener("pointerdown",this._onPointerDown),this._onPointerDown=p=>{var h;!this.enabled||!((h=this.object)!=null&&h.parent)||(this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(p)),this.pointerDown(this._getPointer(p)))},this.domElement.addEventListener("pointerdown",this._onPointerDown),this.target=new c.Object3D,this.transObjectSet=new Set;let s="";const o=this.target,a=this.transObjectSet,l={x:0,y:0,z:0},d=new WeakMap;this.addEventListener("mouseDown",p=>{s=p.target.mode,s==="translate"&&(s="position"),s==="rotate"&&(s="rotation"),l.x=o[s].x,l.y=o[s].y,l.z=o[s].z,a.forEach(h=>{d.set(h,h.matrixAutoUpdate),h.matrixAutoUpdate=!1})}),this.addEventListener("objectChange",p=>{const h=o[s].x-l.x,g=o[s].y-l.y,R=o[s].z-l.z;l.x=o[s].x,l.y=o[s].y,l.z=o[s].z,a.forEach(M=>{M[s].x+=h,M[s].y+=g,M[s].z+=R,M.updateMatrix(),M.updateMatrixWorld()}),this.dispatchEvent({type:"objectChanged",transObjectSet:a,mode:s,target:o})}),this.addEventListener("mouseUp",p=>{a.forEach(h=>{h.matrixAutoUpdate=d.get(h),d.delete(h)})})}setDom(e){return this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),e.addEventListener("pointerdown",this._onPointerDown),e.addEventListener("pointermove",this._onPointerHover),e.addEventListener("pointerup",this._onPointerUp),this.domElement=e,this}setCamera(e){return this.camera=e,this}getTarget(){return this.target}getTransObjectSet(){return this.transObjectSet}setAttach(...e){if(this.transObjectSet.clear(),!e.length||!e[0])return this.detach(),this;this.attach(this.target);const n=this.target;if(e.length===1){const l=e[0];return l.matrixWorld.decompose(n.position,n.quaternion,n.scale),n.updateMatrix(),n.updateMatrixWorld(),this.transObjectSet.add(l),this}const s=[],o=[],a=[];return e.forEach(l=>{s.push(l.matrixWorld.elements[12]),o.push(l.matrixWorld.elements[13]),a.push(l.matrixWorld.elements[14])}),n.rotation.set(0,0,0),n.scale.set(0,0,0),n.position.x=(Math.max(...s)-Math.min(...s))/2+Math.min(...s),n.position.y=(Math.max(...o)-Math.min(...o))/2+Math.min(...o),n.position.z=(Math.max(...a)-Math.min(...a))/2+Math.min(...a),n.updateMatrix(),n.updateMatrixWorld(),e.forEach(l=>{this.transObjectSet.add(l)}),this}}const as=function(t){if(this.transformControls)return console.warn("this has installed transformControls plugin."),!1;if(!this.pointerManager)return console.warn("this must install pointerManager before install transformControls plugin."),!1;if(!this.eventManager)return console.warn("this must install eventManager before install transformControls plugin."),!1;const r=new Mr(this.camera,this.dom);return r.detach(),this.transformControls=r,this.scene.add(this.transformControls),this.scene.add(this.transformControls.target),this.transformControls.addEventListener("mouseDown",()=>{this.transing=!0}),this.setTransformControls=function(e){return e?this.scene.add(this.transformControls):this.scene.remove(this.transformControls),this},this.addEventListener("setCamera",e=>{e.options.transformControls&&r.setCamera(e.camera)}),this.addEventListener("setDom",e=>{r.setDom(e.dom)}),this.addEventListener("setScene",e=>{const n=e.scene;n.add(this.transformControls.target),n.add(this.transformControls)}),this.selectionBox?this.addEventListener("selected",e=>{r.setAttach(...e.objects)}):this.eventManager.addEventListener("click",e=>{if(this.transing){this.transing=!1;return}if(e.button===0){const s=e.intersections.map(o=>o.object)[0]||null;s?r.setAttach(s):r.detach()}}),this.eventManager.addFilterObject(r),this.completeSet.add(()=>{if(this.IS_ENGINESUPPORT){const e=o=>{const a=this.compilerManager.getObjectSymbol(o);return a?this.dataSupportManager.getConfigBySymbol(a):null};let n=null,s;r.addEventListener(Sr.OBJECTCHANGED,o=>{const a=o;a.transObjectSet.forEach(l=>{n=e(l),s=a.mode,n&&(n[s].x=l[s].x,n[s].y=l[s].y,n[s].z=l[s].z)})})}}),!0},cs=function(t={}){if(this.webGLRenderer)return console.warn("this has installed webglRenderer plugin."),!1;this.webGLRenderer=new c.WebGLRenderer(t);const r=this.webGLRenderer.domElement;return r.style.position="absolute",r.style.top="0",r.style.left="0",r.classList.add("vis-webgl"),this.getScreenshot=async function(e={}){const n={width:this.dom.offsetWidth,height:this.dom.offsetHeight};!e.width&&(e.width=this.dom.offsetWidth),!e.height&&(e.height=this.dom.offsetHeight),!e.mine&&(e.mine="image/png");let s=!1;this.renderManager.hasRendering()&&(this.renderManager.stop(),s=!0);let o="";const a=this.webGLRenderer.getContext(),d=a.getParameter(a.MAX_RENDERBUFFER_SIZE)/4;if(e.width>d||e.height>d){const p=[],h=Math.ceil(e.width/d),g=Math.ceil(e.height/d),R=e.width/h,M=e.height/g,C=document.createElement("canvas");C.setAttribute("width",e.width.toString()),C.setAttribute("height",e.height.toString());const D=C.getContext("2d");if(!D)return console.warn("can not support canvas 2d;"),o;this.setSize(R,M);for(let b=0;b<h;b+=1)for(let v=0;v<g;v+=1)p.push({x:R*b,y:M*v});const L=[];p.forEach(b=>{this.camera.setViewOffset(e.width,e.height,b.x,b.y,R,M),this.renderManager.render();const v=this.webGLRenderer.domElement.toDataURL(e.mine);L.push(new Promise((A,W)=>{const O=new Image;O.src=v,O.onload=()=>{D.drawImage(O,b.x,b.y,R,M),A(null)}}))}),this.setSize(n.width,n.height),await Promise.all(L).catch(b=>{console.warn(b)}),o=C.toDataURL(e.mine),this.camera.clearViewOffset()}else this.setSize(e.width,e.height),this.renderManager.render(),o=this.webGLRenderer.domElement.toDataURL(e.mine),this.setSize(n.width,n.height);return s&&this.renderManager.play(),o},this.addEventListener("setDom",e=>{e.dom.appendChild(this.webGLRenderer.domElement)}),this.addEventListener("setSize",e=>{this.webGLRenderer.setSize(e.width,e.height,!0)}),this.addEventListener("dispose",()=>{this.webGLRenderer.dispose()}),this.renderManager?(this.renderManager.removeEventListener("render",this.render),this.renderManager.addEventListener("render",e=>{this.webGLRenderer.render(this.scene,this.camera)})):this.render=function(){return this.webGLRenderer.render(this.scene,this.camera),this},!0},Ke=class extends c.Loader{constructor(r){super(r)}load(r,e,n,s){this.path!==void 0&&(r=this.path+r),this.manager.itemStart(r),r=this.manager.resolveURL(r);const o=c.Cache.get(r);if(o!==void 0)return setTimeout(()=>{e&&e(o),this.manager.itemEnd(r)},0),o;const a=document.createElement("video");return a.preload=Ke.preload,a.autoplay=Ke.autoplay,a.loop=Ke.loop,a.muted=Ke.muted,a.src=r,a.style.position="fixed",a.style.top="0",a.style.left="0",a.style.zIndex="-1",document.body.appendChild(a),a.oncanplay=()=>{c.Cache.add(r,a),this.manager.itemEnd(r),e&&e(a)},a.onerror=l=>{this.manager.itemEnd(r),s&&s(l)},a}};let Me=Ke;i(Me,"autoplay",!0),i(Me,"preload","auto"),i(Me,"muted",!0),i(Me,"loop",!0);class br extends te{constructor(e){super();i(this,"resourceMap");i(this,"loaderMap");i(this,"urlList",[]);i(this,"loadTotal");i(this,"loadSuccess");i(this,"loadError");i(this,"isError");i(this,"isLoading");i(this,"isLoaded");i(this,"loadDetailMap");i(this,"path","");this.resourceMap=new Map,this.loadTotal=0,this.loadSuccess=0,this.loadError=0,this.isError=!1,this.isLoading=!1,this.isLoaded=!1,this.loadDetailMap={};const n=new c.ImageLoader,s=new Me,o=new zn.GLTFLoader;o.setDRACOLoader(new kn.DRACOLoader),o.setKTX2Loader(new $n.KTX2Loader),o.setMeshoptDecoder(Vn.MeshoptDecoder),this.loaderMap={jpg:n,png:n,jpeg:n,obj:new Un.OBJLoader,mtl:new Hn.MTLLoader,mp4:s,webm:s,ogg:s,hdr:new Nn.RGBELoader,gltf:o,glb:o,fbx:new Fn.FBXLoader},e&&(this.loaderMap=Object.assign(this.loaderMap,e.loaderExtends))}loaded(){return this.dispatchEvent({type:"loaded",loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError,resourceMap:this.resourceMap}),this}checkLoaded(){return this.loadTotal===this.loadSuccess+this.loadError&&(this.isError=!0,this.isLoaded=!0,this.isLoading=!1,this.loaded()),this}setPath(e){return this.path=e,this}setRequestHeader(e){return Object.values(this.loaderMap).forEach(n=>{n.setRequestHeader(e)}),this}setResponseType(e){return Object.values(this.loaderMap).forEach(n=>{n.setResponseType&&n.setResponseType(e)}),this}getLoader(e){return this.loaderMap[e]?this.loaderMap[e]:null}load(e){var a;if(this.reset(),this.isLoading=!0,this.dispatchEvent({type:"beforeLoad",urlList:[...e]}),e.length<=0)return this.checkLoaded(),console.warn("url list is empty."),this;this.loadTotal+=e.length;const n=this.resourceMap,s=this.loaderMap,o=this.loadDetailMap;for(const l of e){let d,p;typeof l=="string"?(d=l,p=((a=d.split(".").pop())==null?void 0:a.toLocaleLowerCase())||""):(d=l.url,p=l.ext.toLocaleLowerCase(),p.startsWith(".")&&(p=p.slice(1)));const h={url:d,progress:0,error:!1,message:d};if(o[d]=h,n.has(d)){h.progress=1,this.loadSuccess+=1,this.dispatchEvent({type:"detailLoaded",detail:h}),this.dispatchEvent({type:"loading",loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded();continue}if(!p){h.message=`url: ${d} \u5730\u5740\u6709\u8BEF\uFF0C\u65E0\u6CD5\u83B7\u53D6\u6587\u4EF6\u683C\u5F0F\u3002`,console.warn(h.message),h.error=!0,this.isError=!0,this.loadError+=1,this.dispatchEvent({type:"detailLoaded",detail:h}),this.dispatchEvent({type:"loading",loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError});continue}const g=s[p];if(!g){h.message=`url: ${d} \u4E0D\u652F\u6301\u6B64\u6587\u4EF6\u683C\u5F0F\u52A0\u8F7D\u3002`,console.warn(h.message),h.error=!0,this.isError=!0,this.loadError+=1,this.dispatchEvent({type:"detailLoaded",detail:h}),this.dispatchEvent({type:"loading",loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError});continue}const R=d.replace(/\\/g,"/").split("/"),M=R.pop(),C=this.path+R.join("/")+"/";g.setPath(C).loadAsync(M,D=>{h.progress=Number((D.loaded/D.total).toFixed(2)),this.dispatchEvent({type:"detailLoading",detail:h})}).then(D=>{h.progress=1,this.loadSuccess+=1,this.resourceMap.set(d,D),this.urlList.push(l),this.dispatchEvent({type:"detailLoaded",detail:h}),this.dispatchEvent({type:"loading",loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded()}).catch(D=>{h.error=!0,h.message=JSON.stringify(D),this.loadError+=1,this.dispatchEvent({type:"detailLoaded",detail:h}),this.dispatchEvent({type:"loading",loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded()})}return this}reset(){return this.loadTotal=0,this.loadSuccess=0,this.loadError=0,this.isError=!1,this.isLoading=!1,this.isLoaded=!1,this.loadDetailMap={},this}register(e,n){return this.loaderMap[e]=n,this}hasLoaded(e){return this.resourceMap.has(e)}getResource(e){return this.resourceMap.get(e)}getLoadDetailMap(){return this.loadDetailMap}setLoadDetailMap(e){return this.loadDetailMap=e,this}remove(e){}toJSON(){return JSON.stringify(this.urlList)}exportConfig(){return JSON.parse(JSON.stringify(this.urlList))}dispose(){return this.resourceMap.clear(),this}}const ls=function(t){if(this.loaderManager)return console.warn("engine has installed loaderManager plugin."),!1;const r=new br(t);return this.loaderManager=r,this.loadResources=(e,n)=>{if(this.resourceManager){const s=o=>{n(void 0,o),this.resourceManager.removeEventListener("mapped",s)};try{this.resourceManager.addEventListener("mapped",s)}catch(o){n(o)}}else{const s=o=>{n(void 0,o),this.loaderManager.removeEventListener("loaded",s)};try{this.loaderManager.addEventListener("loaded",s)}catch(o){n(o)}}return this.loaderManager.load(e),this},this.loadResourcesAsync=e=>new Promise((n,s)=>{if(this.resourceManager){const o=a=>{n(a),this.resourceManager.removeEventListener("mapped",o)};try{this.resourceManager.addEventListener("mapped",o)}catch(a){s(a)}}else{const o=a=>{n(a),this.loaderManager.removeEventListener("loaded",o)};try{this.loaderManager.addEventListener("loaded",o)}catch(a){s(a)}}this.loaderManager.load(e)}),!0};var u=(t=>(t.BOXGEOMETRY="BoxGeometry",t.SPHEREGEOMETRY="SphereGeometry",t.LOADGEOMETRY="LoadGeometry",t.PLANEGEOMETRY="PlaneGeometry",t.CIRCLEGEOMETRY="CircleGeometry",t.CONEGEOMETRY="ConeGeometry",t.CYLINDERGEOMETRY="CylinderGeometry",t.DODECAHEDRONGEOMETRY="DodecahedronGeometry",t.TORUSGEOMETRY="TorusGeometry",t.RINGGEOMETRY="RingGeometry",t.EDGESGEOMETRY="EdgesGeometry",t.LINECURVEGEOMETRY="LineCurveGeometry",t.SPLINECURVEGEOMETRY="SplineCurveGeometry",t.CUBICBEZIERCURVEGEOMETRY="CubicBezierCurveGeometry",t.QUADRATICBEZIERCURVEGEOMETRY="QuadraticBezierCurveGeometry",t.CUSTOMGEOMETRY="CustomGeometry",t.LINETUBEGEOMETRY="LineTubeGeometry",t.SPLINETUBEGEOMETRY="SplineTubeGeometry",t.LINESHAPEGEOMETRY="LineShapeGeometry",t.OBJECT3D="Object3D",t.MESH="Mesh",t.LINE="Line",t.POINTS="Points",t.SPRITE="Sprite",t.GROUP="Group",t.CSS3DOBJECT="CSS3DObject",t.CSS3DSPRITE="CSS3DSprite",t.CSS3DPLANE="CSS3DPlane",t.CSS2DPLANE="CSS2DPlane",t.IMAGETEXTURE="ImageTexture",t.CUBETEXTURE="CubeTexture",t.CANVASTEXTURE="CanvasTexture",t.VIDEOTEXTURE="VideoTexture",t.LOADTEXTURE="LoadTexture",t.MESHBASICMATERIAL="MeshBasicMaterial",t.MESHSTANDARDMATERIAL="MeshStandardMaterial",t.MESHPHONGMATERIAL="MeshPhongMaterial",t.SPRITEMATERIAL="SpriteMaterial",t.LINEBASICMATERIAL="LineBasicMaterial",t.POINTSMATERIAL="PointsMaterial",t.SHADERMATERIAL="ShaderMaterial",t.MESHPHYSICALMATERIAL="MeshPhysicalMaterial",t.AMBIENTLIGHT="AmbientLight",t.SPOTLIGHT="SpotLight",t.POINTLIGHT="PointLight",t.DIRECTIONALLIGHT="DirectionalLight",t.HEMISPHERELIGHT="HemisphereLight",t.RECTAREALIGHT="RectAreaLight",t.PERSPECTIVECAMERA="PerspectiveCamera",t.ORTHOGRAPHICCAMERA="OrthographicCamera",t.WEBGLRENDERER="WebGLRenderer",t.CSS3DRENDERER="CSS3DRenderer",t.SCENE="Scene",t.TRNASFORMCONTROLS="TransformControls",t.ORBITCONTROLS="OrbitControls",t.SMAAPASS="SMAAPass",t.UNREALBLOOMPASS="UnrealBloomPass",t.SELECTIVEBLOOMPASS="SelectiveBloomPass",t.SCRIPTANIMATION="ScriptAnimation",t.KEYFRAMEANIMATION="KeyframeAnimation",t))(u||{}),y=(t=>(t.OBJECT3D="object3D",t.CAMERA="camera",t.LIGHT="light",t.GEOMETRY="geometry",t.TEXTURE="texture",t.MATERIAL="material",t.RENDERER="renderer",t.SCENE="scene",t.SPRITE="sprite",t.CONTROLS="controls",t.LINE="line",t.MESH="mesh",t.POINTS="points",t.GROUP="group",t.CSS3D="css3D",t.CSS2D="css2D",t.PASS="pass",t.ANIMATION="animation",t))(y||{});const Nt={camera:!0,light:!0,scene:!0,sprite:!0,line:!0,mesh:!0,points:!0,group:!0,css3D:!0,css2D:!0,object3D:!0},us={[u.IMAGETEXTURE]:y.TEXTURE,[u.CUBETEXTURE]:y.TEXTURE,[u.CANVASTEXTURE]:y.TEXTURE,[u.VIDEOTEXTURE]:y.TEXTURE,[u.MESHBASICMATERIAL]:y.MATERIAL,[u.MESHSTANDARDMATERIAL]:y.MATERIAL,[u.MESHPHONGMATERIAL]:y.MATERIAL,[u.SPRITEMATERIAL]:y.MATERIAL,[u.LINEBASICMATERIAL]:y.MATERIAL,[u.POINTSMATERIAL]:y.MATERIAL,[u.SHADERMATERIAL]:y.MATERIAL,[u.AMBIENTLIGHT]:y.LIGHT,[u.SPOTLIGHT]:y.LIGHT,[u.POINTLIGHT]:y.LIGHT,[u.DIRECTIONALLIGHT]:y.LIGHT,[u.BOXGEOMETRY]:y.GEOMETRY,[u.SPHEREGEOMETRY]:y.GEOMETRY,[u.LOADGEOMETRY]:y.GEOMETRY,[u.CUSTOMGEOMETRY]:y.GEOMETRY,[u.PLANEGEOMETRY]:y.GEOMETRY,[u.CIRCLEGEOMETRY]:y.GEOMETRY,[u.CONEGEOMETRY]:y.GEOMETRY,[u.CIRCLEGEOMETRY]:y.GEOMETRY,[u.EDGESGEOMETRY]:y.GEOMETRY,[u.CYLINDERGEOMETRY]:y.GEOMETRY,[u.LINECURVEGEOMETRY]:y.GEOMETRY,[u.SPLINECURVEGEOMETRY]:y.GEOMETRY,[u.CUBICBEZIERCURVEGEOMETRY]:y.GEOMETRY,[u.QUADRATICBEZIERCURVEGEOMETRY]:y.GEOMETRY,[u.LINETUBEGEOMETRY]:y.GEOMETRY,[u.SPLINETUBEGEOMETRY]:y.GEOMETRY,[u.TORUSGEOMETRY]:y.GEOMETRY,[u.RINGGEOMETRY]:y.GEOMETRY,[u.LINESHAPEGEOMETRY]:y.GEOMETRY,[u.SPRITE]:y.SPRITE,[u.LINE]:y.LINE,[u.MESH]:y.MESH,[u.POINTS]:y.POINTS,[u.GROUP]:y.GROUP,[u.CSS3DOBJECT]:y.CSS3D,[u.CSS3DSPRITE]:y.CSS3D,[u.CSS3DPLANE]:y.CSS3D,[u.PERSPECTIVECAMERA]:y.CAMERA,[u.ORTHOGRAPHICCAMERA]:y.CAMERA,[u.WEBGLRENDERER]:y.RENDERER,[u.SCENE]:y.SCENE,[u.TRNASFORMCONTROLS]:y.CONTROLS,[u.ORBITCONTROLS]:y.CONTROLS,[u.SMAAPASS]:y.PASS,[u.UNREALBLOOMPASS]:y.PASS,[u.SCRIPTANIMATION]:y.ANIMATION,[u.KEYFRAMEANIMATION]:y.ANIMATION},Ne=t=>{const r=e=>t.toLocaleLowerCase().includes(e.toLocaleLowerCase());for(const e of Object.values(y))if(r(e))return e;return null},vr=t=>Nt[t],wr=t=>{const r=Ne(t);return r?vr(r):!1},oe=()=>({vid:"",name:"",type:u.OBJECT3D,castShadow:!0,receiveShadow:!0,lookAt:"",visible:!0,matrixAutoUpdate:!0,renderOrder:0,position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},up:{x:0,y:1,z:0},parent:"",children:[],pointerdown:[],pointermove:[],pointerup:[],pointerenter:[],pointerleave:[],click:[],dblclick:[],contextmenu:[]}),qe=function(){return Object.assign(oe(),{type:"Light",color:"rgb(255, 255, 255)",intensity:1})},ds=function(){return Object.assign(oe(),{type:u.AMBIENTLIGHT,color:"rgb(255, 255, 255)",intensity:1})},hs=function(){return Object.assign(qe(),{type:u.POINTLIGHT,distance:30,decay:.01})},ps=function(){return Object.assign(qe(),{type:u.SPOTLIGHT,distance:30,angle:Math.PI/180*45,penumbra:.01,decay:.01})},ms=function(){return Object.assign(qe(),{type:u.DIRECTIONALLIGHT,shadow:{mapSize:{width:512,height:512},camera:{near:.5,far:500}}})},fs=function(){return Object.assign(qe(),{type:u.HEMISPHERELIGHT,color:"rgb(255, 255, 255)",groundColor:"rgb(0, 0, 0)"})},gs=function(){return Object.assign(qe(),{type:u.RECTAREALIGHT,width:10,height:10})},Q=function(){return{vid:"",type:"Geometry",position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},groups:[]}},ys=function(){return Object.assign(Q(),{type:u.BOXGEOMETRY,width:5,height:5,depth:5,widthSegments:1,heightSegments:1,depthSegments:1})},Es=function(){return Object.assign(Q(),{type:u.SPHEREGEOMETRY,radius:3,widthSegments:32,heightSegments:32,phiStart:0,phiLength:Math.PI*2,thetaStart:0,thetaLength:Math.PI})},Ss=function(){return Object.assign(Q(),{type:u.PLANEGEOMETRY,width:5,height:5,widthSegments:1,heightSegments:1})},Ms=function(){return Object.assign(Q(),{type:u.CIRCLEGEOMETRY,radius:3,segments:8,thetaStart:0,thetaLength:Math.PI*2})},bs=function(){return Object.assign(Q(),{type:u.CONEGEOMETRY,radius:3,height:5,radialSegments:8,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:Math.PI*2})},vs=function(){return Object.assign(Q(),{type:u.TORUSGEOMETRY,radius:3,tube:.4,radialSegments:8,tubularSegments:6,arc:Math.PI*2})},ws=function(){return Object.assign(Q(),{type:u.RINGGEOMETRY,innerRadius:2,outerRadius:3,thetaSegments:8,phiSegments:8,thetaStart:0,thetaLength:Math.PI*2})},Cs=function(){return Object.assign(Q(),{type:u.LOADGEOMETRY,url:""})},Rs=function(){return Object.assign(Q(),{type:u.CUSTOMGEOMETRY,attribute:{position:[],color:[],index:[],normal:[],uv:[],uv2:[]}})},Ts=function(){return Object.assign(Q(),{type:u.CYLINDERGEOMETRY,radiusTop:3,radiusBottom:3,height:5,radialSegments:8,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:Math.PI*2})},xs=function(){return Object.assign(Q(),{type:"",radius:3,detail:0})},Ls=function(){return Object.assign(Q(),{type:u.LOADGEOMETRY,url:"",thresholdAngle:1})},ht=function(){return Object.assign(Q(),{path:[],divisions:36,space:!0})},Os=function(){return Object.assign(ht(),{type:u.LINECURVEGEOMETRY})},As=function(){return Object.assign(ht(),{type:u.SPLINECURVEGEOMETRY})},Ds=function(){return Object.assign(ht(),{type:u.CUBICBEZIERCURVEGEOMETRY})},Ps=function(){return Object.assign(ht(),{type:u.QUADRATICBEZIERCURVEGEOMETRY})},Cr=function(){return Object.assign(Q(),{type:"TubeGeometry",path:[],tubularSegments:64,radius:1,radialSegments:8,closed:!1})},js=function(){return Object.assign(Cr(),{type:u.LINETUBEGEOMETRY})},Bs=function(){return Object.assign(Cr(),{type:u.SPLINETUBEGEOMETRY})},Is=function(){return Object.assign(Q(),{path:[],curveSegments:12})},Gs=function(){return Object.assign(Is(),{type:u.LINESHAPEGEOMETRY})},Ze=function(){return{vid:"",type:"Texture",name:"",mapping:c.UVMapping,wrapS:c.ClampToEdgeWrapping,wrapT:c.ClampToEdgeWrapping,magFilter:c.LinearFilter,minFilter:c.LinearMipmapLinearFilter,anisotropy:1,format:c.RGBAFormat,flipY:!0,offset:{x:0,y:0},repeat:{x:1,y:1},rotation:0,center:{x:0,y:0},matrixAutoUpdate:!0,encoding:c.LinearEncoding,needsUpdate:!1}},Us=function(){return Object.assign(Ze(),{type:u.IMAGETEXTURE,url:""})},Hs=function(){return Object.assign(Ze(),{type:u.VIDEOTEXTURE,url:"",minFilter:c.LinearFilter})},Ns=function(){return Object.assign(Ze(),{type:u.CUBETEXTURE,cube:{nx:"",ny:"",nz:"",px:"",py:"",pz:""},mapping:c.CubeReflectionMapping,flipY:!1})},zs=function(){return Object.assign(Ze(),{type:u.CANVASTEXTURE,url:"",needsUpdate:!1})},Fs=function(){return Object.assign(Ze(),{type:u.LOADTEXTURE,url:""})},Pe=function(){return{vid:"",type:"Material",alphaTest:0,colorWrite:!0,depthTest:!0,depthWrite:!0,fog:!0,name:"",needsUpdate:!1,opacity:1,dithering:!1,shadowSide:null,side:c.FrontSide,toneMapped:!0,transparent:!1,visible:!0,blendDst:c.OneMinusSrcAlphaFactor,blendDstAlpha:null,blendEquation:c.AddEquation,blendEquationAlpha:null,blending:c.NormalBlending,blendSrc:c.SrcAlphaFactor,blendSrcAlpha:null,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0}},ks=function(){return Object.assign(Pe(),{type:u.MESHBASICMATERIAL,color:"rgb(255, 255, 255)",combine:c.MultiplyOperation,aoMapIntensity:1,fog:!0,lightMapIntensity:1,reflectivity:1,refractionRatio:.98,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",wireframeLinewidth:1,map:"",envMap:"",alphaMap:"",aoMap:"",lightMap:"",specularMap:""})},Rr=function(){return Object.assign(Pe(),{type:u.MESHSTANDARDMATERIAL,aoMapIntensity:1,bumpScale:1,color:"rgb(255, 255, 255)",displacementScale:1,displacementBias:0,emissive:"rgb(0, 0, 0)",emissiveIntensity:1,envMapIntensity:1,flatShading:!1,lightMapIntensity:1,metalness:0,normalMapType:c.TangentSpaceNormalMap,refractionRatio:.98,roughness:1,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",roughnessMap:"",normalMap:"",metalnessMap:"",map:"",lightMap:"",envMap:"",emissiveMap:"",displacementMap:"",bumpMap:"",alphaMap:"",aoMap:""})},$s=function(){return Object.assign(Rr(),{type:u.MESHPHYSICALMATERIAL,attenuationColor:"rgb(255, 255, 255)",attenuationDistance:0,clearcoat:0,clearcoatNormalScale:{x:1,y:1},clearcoatRoughness:0,ior:1.5,reflectivity:.5,sheen:0,sheenRoughness:1,sheenColor:"rgb(255, 255, 255)",specularIntensity:0,specularColor:"rgb(255, 255, 255)",thickness:0,transmission:0,clearcoatMap:"",clearcoatNormalMap:"",clearcoatRoughnessMap:"",sheenRoughnessMap:"",sheenColorMap:"",specularIntensityMap:"",specularColorMap:"",thicknessMap:"",transmissionMap:""})},Vs=function(){return Object.assign(Pe(),{type:u.MESHPHONGMATERIAL,aoMapIntensity:1,bumpScale:1,color:"rgb(255, 255, 255)",displacementScale:1,displacementBias:0,emissive:"rgb(0, 0, 0)",emissiveIntensity:1,envMapIntensity:1,flatShading:!1,lightMapIntensity:1,normalMapType:c.TangentSpaceNormalMap,refractionRatio:.98,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",specular:"rgb(17, 17, 17)",shininess:30,combine:c.MultiplyOperation,normalMap:"",map:"",lightMap:"",envMap:"",emissiveMap:"",displacementMap:"",bumpMap:"",alphaMap:"",aoMap:"",specularMap:""})},Ws=function(){return Object.assign(Pe(),{type:u.SPRITEMATERIAL,color:"rgb(255, 255, 255)",rotation:0,map:"",alphaMap:"",sizeAttenuation:!0})},Ys=function(){return Object.assign(Pe(),{type:u.LINEBASICMATERIAL,color:"rgb(255, 255, 255)",linecap:"round",linejoin:"round",linewidth:1})},_s=function(){return Object.assign(Pe(),{type:u.POINTSMATERIAL,map:"",alphaMap:"",color:"rgb(255, 255, 255)",sizeAttenuation:!0,size:1})},Xs=function(){return Object.assign(Pe(),{type:u.SHADERMATERIAL,shader:"defaultShader",uniforms:{}})},Qs=function(){return Object.assign(oe(),{type:u.PERSPECTIVECAMERA,adaptiveWindow:!1,fov:45,aspect:1920/1080,near:5,far:50})},Ks=function(){return Object.assign(oe(),{type:u.ORTHOGRAPHICCAMERA,adaptiveWindow:!1,left:-window.innerWidth,right:window.innerWidth,top:window.innerHeight,bottom:-window.innerHeight,near:5,far:50,zoom:1})};u.WEBGLRENDERER+"",u.CSS3DRENDERER+"",u.SCENE+"";const z=function(t){return`DEFUALT-${t}`},Tr=function(){return{vid:"",type:"Renderer",size:null}},Js=function(){return Object.assign(Tr(),{vid:z(u.WEBGLRENDERER),type:u.WEBGLRENDERER,clearColor:"rgba(0, 0, 0, 0)",outputEncoding:c.LinearEncoding,physicallyCorrectLights:!1,shadowMap:{enabled:!1,autoUpdate:!0,needsUpdate:!1,type:c.PCFShadowMap},toneMapping:c.NoToneMapping,toneMappingExposure:1,pixelRatio:window.devicePixelRatio,adaptiveCamera:!1,viewport:null,scissor:null})},qs=function(){return Object.assign(Tr(),{vid:z(u.CSS3DRENDERER),type:u.CSS3DRENDERER})},Zs=function(){return Object.assign(oe(),{vid:z(u.SCENE),type:u.SCENE,background:"",environment:"",fog:{type:"",color:"rgb(150, 150, 150)",near:1,far:200,density:.003}})},eo=function(){return{vid:z(u.TRNASFORMCONTROLS),type:u.TRNASFORMCONTROLS,axis:"XYZ",enabled:!0,mode:"translate",snapAllow:!1,rotationSnap:Math.PI/180*10,translationSnap:5,scaleSnap:.1,showX:!0,showY:!0,showZ:!0,size:1,space:"world"}},to=function(){return{vid:z(u.ORBITCONTROLS),type:u.ORBITCONTROLS,autoRotate:!1,autoRotateSpeed:2,enableDamping:!1,dampingFactor:.05,enabled:!0,enablePan:!0,enableRotate:!0,enableZoom:!0,maxAzimuthAngle:1/0,maxDistance:1/0,maxPolarAngle:Math.PI,maxZoom:1/0,minAzimuthAngle:-1/0,minDistance:0,minPolarAngle:0,minZoom:0,panSpeed:1,rotateSpeed:1,zoomSpeed:1,screenSpacePanning:!0,target:null}},pt=function(){return Object.assign(oe(),{material:"",geometry:""})},ro=function(){return Object.assign(pt(),{type:"Sprite",material:"",center:{x:.5,y:.5}})},no=function(){return Object.assign(pt(),{type:u.MESH,geometry:"",material:""})},so=function(){return Object.assign(pt(),{type:u.POINTS,geometry:"",material:""})},oo=function(){return Object.assign(pt(),{type:u.LINE,geometry:"",material:""})},io=function(){return Object.assign(oe(),{type:u.GROUP,children:[]})},zt=function(){return{vid:"",type:"Pass"}},ao=function(){return Object.assign(zt(),{type:u.SMAAPASS})},co=function(){return Object.assign(zt(),{type:u.UNREALBLOOMPASS,strength:1.5,threshold:0,radius:0})},lo=function(){return Object.assign(zt(),{type:u.SELECTIVEBLOOMPASS,strength:1,threshold:0,radius:0,renderScene:"",renderCamera:"",selectedObjects:[]})},xr=function(){return{vid:"",type:"",name:"",target:"",attribute:"",play:!0}},uo=function(){return Object.assign(xr(),{type:u.SCRIPTANIMATION,script:{name:""}})},ho=function(){return Object.assign(xr(),{type:u.KEYFRAMEANIMATION,script:{name:""}})},Ft=function(){return Object.assign(oe(),{type:u.CSS3DOBJECT,element:"",width:50,height:50})},po=function(){return Object.assign(Ft(),{type:u.CSS3DPLANE})},mo=function(){return Object.assign(Ft(),{type:u.CSS3DSPRITE,rotation2D:0})},fo=function(){return Object.assign(oe(),{type:u.CSS3DOBJECT,element:"",width:50,height:50})},go=function(){return Object.assign(fo(),{type:u.CSS2DPLANE})},k={[u.IMAGETEXTURE]:Us,[u.CUBETEXTURE]:Ns,[u.CANVASTEXTURE]:zs,[u.VIDEOTEXTURE]:Hs,[u.LOADTEXTURE]:Fs,[u.MESHBASICMATERIAL]:ks,[u.MESHSTANDARDMATERIAL]:Rr,[u.MESHPHONGMATERIAL]:Vs,[u.SPRITEMATERIAL]:Ws,[u.LINEBASICMATERIAL]:Ys,[u.POINTSMATERIAL]:_s,[u.SHADERMATERIAL]:Xs,[u.MESHPHYSICALMATERIAL]:$s,[u.AMBIENTLIGHT]:ds,[u.SPOTLIGHT]:ps,[u.POINTLIGHT]:hs,[u.DIRECTIONALLIGHT]:ms,[u.HEMISPHERELIGHT]:fs,[u.RECTAREALIGHT]:gs,[u.BOXGEOMETRY]:ys,[u.SPHEREGEOMETRY]:Es,[u.LOADGEOMETRY]:Cs,[u.CUSTOMGEOMETRY]:Rs,[u.PLANEGEOMETRY]:Ss,[u.CIRCLEGEOMETRY]:Ms,[u.CONEGEOMETRY]:bs,[u.CYLINDERGEOMETRY]:Ts,[u.EDGESGEOMETRY]:Ls,[u.LINECURVEGEOMETRY]:Os,[u.SPLINECURVEGEOMETRY]:As,[u.CUBICBEZIERCURVEGEOMETRY]:Ds,[u.QUADRATICBEZIERCURVEGEOMETRY]:Ps,[u.DODECAHEDRONGEOMETRY]:xs,[u.SPLINETUBEGEOMETRY]:Bs,[u.LINETUBEGEOMETRY]:js,[u.TORUSGEOMETRY]:vs,[u.RINGGEOMETRY]:ws,[u.LINESHAPEGEOMETRY]:Gs,[u.OBJECT3D]:oe,[u.SPRITE]:ro,[u.LINE]:oo,[u.MESH]:no,[u.POINTS]:so,[u.GROUP]:io,[u.CSS3DOBJECT]:Ft,[u.CSS3DSPRITE]:mo,[u.CSS3DPLANE]:po,[u.CSS2DPLANE]:go,[u.PERSPECTIVECAMERA]:Qs,[u.ORTHOGRAPHICCAMERA]:Ks,[u.WEBGLRENDERER]:Js,[u.CSS3DRENDERER]:qs,[u.SCENE]:Zs,[u.TRNASFORMCONTROLS]:eo,[u.ORBITCONTROLS]:to,[u.SMAAPASS]:ao,[u.UNREALBLOOMPASS]:co,[u.SELECTIVEBLOOMPASS]:lo,[u.SCRIPTANIMATION]:uo,[u.KEYFRAMEANIMATION]:ho};class je{}class kt extends je{constructor(){super(...arguments);i(this,"selector",(e,n,s)=>n instanceof HTMLImageElement&&s.get(kt)||null)}parse({url:e,resource:n,configMap:s,resourceMap:o}){const a=k[u.IMAGETEXTURE]();a.url=e,o.set(e,n),s.set(e,a)}}class $t extends je{constructor(){super(...arguments);i(this,"selector",(e,n,s)=>n instanceof HTMLCanvasElement&&s.get($t)||null)}parse({url:e,resource:n,configMap:s,resourceMap:o}){const a=k[u.CANVASTEXTURE]();a.url=e,o.set(e,n),s.set(e,a)}}class Vt extends je{constructor(){super(...arguments);i(this,"selector",(e,n,s)=>n instanceof HTMLVideoElement&&s.get(Vt)||null)}parse({url:e,resource:n,configMap:s,resourceMap:o}){const a=k[u.VIDEOTEXTURE]();a.url=e,o.set(e,n),s.set(e,a)}}function yo(t,r){return t in r}function Eo(t,r){return Object.values(t).includes(r)}function So(t){return r=>{const e=(n,s)=>{for(const o in s){if(n[o]===void 0){console.warn(` config can not set key: ${o}`);continue}typeof s[o]=="object"&&s[o]!==null&&!Array.isArray(s[o])?e(n[o],s[o]):n[o]=s[o]}};return r&&e(t,r),t}}function _(t,r,e,n){const s=(o,a,l)=>{for(const d in o)if(a[d]!==void 0&&!(l&&l[d])){if(typeof o[d]=="object"&&typeof o[d]!==null){l&&typeof l[d]=="object"&&typeof l[d]!==null?s(o[d],a[d],l[d]):s(o[d],a[d]);continue}a[d]=o[d]}};s(t,r,e),n&&n()}const ze=function(t){return typeof t=="object"&&t!==null},et=function(t){return typeof t=="object"&&t!==null&&Array.isArray(t)},be=function(t,r){return t&&r?`${t}.${r}`:t||r},Wt=new WeakMap,mt=function(t){Array.isArray(t)&&!Wt.has(t)&&Wt.set(t,t.concat([]))},Lr=function(t){return Wt.get(t)};class Mo{constructor(r){i(this,"config");this.config=r}pipe(r){return this.config=r(this.config),this}get(){return this.config}}var bo=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",isValidKey:yo,isValidEnum:Eo,generateConfigFunction:So,syncObject:_,isObject:ze,isArray:et,extendPath:be,cacheArray:mt,getCacheArray:Lr,Pipeline:Mo});class tt extends je{constructor(){super(...arguments);i(this,"selector",(e,n,s)=>n.isObject3D&&s.get(tt)||null)}parse(e){this.parseObject3D(e)}parseColor(e){return`rgb(${Math.round(255*e.r)}, ${Math.round(255*e.g)}, ${Math.round(255*e.b)})`}attributeEnhance(e){const n={};for(const s in e)s.startsWith("_")?n[s.slice(1)]=e[s]:n[s]=e[s];return n}parseTexture({url:e,resource:n,configMap:s,resourceMap:o}){o.set(e,n);const a=k[u.LOADTEXTURE]();s.set(e,a),a.vid=Z.v4(),a.url=e,_(n,a,{type:!0,vid:!0,url:!0})}parseMaterial({url:e,resource:n,configMap:s,resourceMap:o}){if(o.set(e,n),!k[n.type]){console.warn("can not found support config in vis for this resource",n);return}const a=k[n.type]();s.set(e,a),a.vid=Z.v4(),_(this.attributeEnhance(n),a,{type:!0,vid:!0});for(const l in n)if(!!n[l]){if(n[l].isColor)a[l]=this.parseColor(n[l]);else if(l.toLocaleLowerCase().endsWith("map")&&n[l]){const d=`${e}.${l}`;this.parseTexture({url:d,resource:n[l],configMap:s,resourceMap:o}),a[l]=s.get(d).vid}}}parseGeometry({url:e,resource:n,configMap:s,resourceMap:o}){o.set(e,n),n.computeBoundingBox();const a=n.boundingBox,l=a.getCenter(new c.Vector3),d=k[u.LOADGEOMETRY]();d.vid=Z.v4(),d.url=e,d.position.x=l.x/(a.max.x-a.min.x)*2,d.position.y=l.y/(a.max.y-a.min.y)*2,d.position.z=l.z/(a.max.z-a.min.z)*2,s.set(e,d)}parseObject3D({url:e,resource:n,configMap:s,resourceMap:o}){if(o.set(e,n),!k[n.type]){console.warn("can not found support config in vis for this resource",n);return}const a=k[n.type]();if(a.vid=Z.v4(),_(n,a,{type:!0,vid:!0,children:!0,geometry:!0,material:!0,parent:!0,lookAt:!0}),a.rotation.x=n.rotation.x,a.rotation.y=n.rotation.y,a.rotation.z=n.rotation.z,s.set(e,a),n.material)if(Array.isArray(n.material))a.material=[],n.material.forEach((l,d,p)=>{const h=`${e}.material.${d}`;this.parseMaterial({url:h,resource:l,configMap:s,resourceMap:o}),a.material.push(s.get(h).vid)});else{const l=`${e}.material`;this.parseMaterial({url:l,resource:n.material,configMap:s,resourceMap:o}),a.material=s.get(l).vid}if(n.geometry){const l=`${e}.geometry`;this.parseGeometry({url:l,resource:n.geometry,configMap:s,resourceMap:o}),a.geometry=s.get(l).vid}n.children&&n.children.length&&n.children.forEach((l,d,p)=>{const h=`${e}.children.${d}`;this.parseObject3D({url:h,resource:l,configMap:s,resourceMap:o}),a.children.push(s.get(h).vid)})}}const vo=new tt;class Yt extends je{constructor(){super(...arguments);i(this,"selector",(e,n,s)=>n instanceof HTMLElement&&s.get(Yt)||null)}parse({url:e,resource:n,configMap:s,resourceMap:o}){const a=k[u.CSS3DPLANE]();a.element=e,o.set(e,n),s.set(e,a)}}class _t extends je{constructor(){super(...arguments);i(this,"selector",(e,n,s)=>n instanceof c.Texture&&s.get(_t)||null)}parse({url:e,resource:n,configMap:s,resourceMap:o}){const a=k[u.LOADTEXTURE]();a.url=e,o.set(e,n),s.set(e,a)}}class Xt extends je{constructor(){super();i(this,"object3DParser",vo);i(this,"selector",(e,n,s)=>n.parser&&n.animations&&n.scene&&n.scenes&&s.get(Xt)||null)}parse({url:e,resource:n,configMap:s,resourceMap:o}){this.object3DParser.parse({url:`${e}.scene`,resource:n.scene,configMap:s,resourceMap:o})}}class wo extends tt{constructor(){super()}}var Or=(t=>(t.MAPPED="mapped",t))(Or||{});class Ar extends te{constructor(e={}){super();i(this,"configMap",new Map);i(this,"resourceMap",new Map);i(this,"paserMap",new Map);this.addParser(new kt).addParser(new $t).addParser(new Vt).addParser(new tt).addParser(new Yt).addParser(new _t).addParser(new Xt).addParser(new wo);const n=new Map;for(const s in e)n.has(s)&&console.warn(`resourceManager construct params rescource already exist: ${s}, that will be cover.`),n.set(s,e[s]);this.mappingResource(n)}addParser(e){return this.paserMap.has(e.constructor)?this:(this.paserMap.set(e.constructor,e),this)}mappingResource(e,n){const s=this.configMap,o=this.resourceMap,a=[...this.paserMap.values()],l={};for(const[d,p]of e.entries()){if((n==null?void 0:n.parser)&&n.parser[d]){n.parser[d].parse({url:d,resource:p,configMap:s,resourceMap:o});continue}if((n==null?void 0:n.selector)&&n.selector[d]){const g=n.selector[d](d,p,this.paserMap);if(!g){console.warn("resource manager hanlder can not found this resource parser: ",p,n.selector[d]);continue}g.parse({url:d,resource:p,configMap:s,resourceMap:o}),l[d]=this.getResourceConfig(d);continue}let h=null;for(const g of a)if(h=g.selector(d,p,this.paserMap),h)break;if(!h){console.warn("resouce manager can not found some handler to parser this resource:",p);continue}h.parse({url:d,resource:p,configMap:s,resourceMap:o}),l[d]=this.getResourceConfig(d)}return this.dispatchEvent({type:"mapped",configMap:s,resourceMap:o,resourceConfig:l}),this}getResourceConfig(e){const n=this.configMap,s={};return[...n.keys()].filter(o=>o.startsWith(e)).forEach(o=>{const a=n.get(o);if(!a)console.error(`unknow error: can not found config by url: ${o}`);else{const l=Ne(a.type);l?(!s[l]&&(s[l]=[]),s[l].push(a)):console.error(`unknow error: can not found module by type: ${a.type}`,a)}}),s}hasResource(e){return this.resourceMap.has(e)}remove(e){const n=this.configMap,s=this.resourceMap;return[...n.keys()].filter(o=>o.startsWith(e)).forEach(o=>{n.delete(o);const a=s.get(o);a.dispose&&a.dispose(),s.delete(o)}),this}dispose(){this.resourceMap.forEach((e,n)=>{e.dispose&&e.dispose()}),this.resourceMap.clear(),this.configMap.clear()}}const Co=function(t){if(this.resourceManager)return console.warn("engine has installed resourceManager plugin."),!1;const r=new Ar(t.resources);return this.resourceManager=r,this.loaderManager&&this.loaderManager.addEventListener("loaded",e=>{this.resourceManager.mappingResource(e.resourceMap)}),this.registerResources=e=>{const n=new Map;return Object.keys(e).forEach(s=>{n.set(s,e[s])}),this.resourceManager.mappingResource(n),this},this.addEventListener("dispose",()=>{this.resourceManager.dispose()}),!0},Fe=(t,r)=>r===1/0?"Infinity":r===-1/0?"-Infinity":r,Qt=(t,r)=>r==="Infinity"?1/0:r==="-Infinity"?-1/0:r,rt=t=>JSON.parse(JSON.stringify(t,Fe),Qt);class Dr{constructor(r){i(this,"config");this.config=r}pipe(r){return this.config=r(this.config),this}get(){return this.config}}var ft={stringify:Fe,parse:Qt,clone:rt,Pipeline:Dr},Ro=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",stringify:Fe,parse:Qt,clone:rt,Pipeline:Dr,default:ft});class Pr{constructor(){i(this,"rule");i(this,"memberSet");this.rule=function(){},this.memberSet=new Set}apply(r){return this.memberSet.add(r),this}cancel(r){return this.memberSet.delete(r),this}setRule(r){return this.rule=r,this}translate(r){const e=this.rule;return this.memberSet.forEach(n=>{e(r,n)}),this}}const gt=new WeakMap,To=function(t,r,e,n,s){const o=Reflect.get(t,r,e);return typeof r!="symbol"&&!n.isIgnore(s)&&(s=be(s,r),n.next({operate:"get",path:s,key:r,value:t[r]})),o},xo=function(t,r,e,n,s,o){if(typeof r=="symbol"||s.isIgnore(o))return Reflect.set(t,r,e,n);if(o=be(o,r),ze(e)&&!gt.has(e)&&(e=Kt(s,e,o)),t[r]===void 0){et(e)&&mt(e);const l=Reflect.set(t,r,e);return s.next({operate:"add",path:o,key:r,value:e}),l}const a=Reflect.set(t,r,e);if(et(t)&&r==="length"){const l=Lr(t);if(!l)return console.error("array value is not be cached:",t),a;const d=l.length-t.length;if(d>0){let p=0,h=0;o=o.slice(0,-r.length);for(const g of l)if(!t.includes(g)&&(s.next({operate:"delete",path:o+h,key:h.toString(),value:g}),p+=1,h+=1,p===d))break}return mt(t),a}return s.next({operate:"set",path:o,key:r,value:e}),a},Lo=function(t,r,e,n){if(typeof r=="symbol"||e.isIgnore(n))return Reflect.deleteProperty(t,r);n=be(n,r);const s=t[r],o=Reflect.deleteProperty(t,r);return et(t)||e.next({operate:"delete",path:n,key:r,value:s}),o},Kt=function(t,r,e=""){if(typeof r!="object"||gt.has(r)||t.isIgnore(e))return r;const n={get:(o,a,l)=>To(o,a,l,t,e),set:(o,a,l,d)=>xo(o,a,l,d,t,e),deleteProperty:(o,a)=>Lo(o,a,t,e)};if(ze(r))for(const o in r){const a=be(e,o);t.isIgnore(a)||ze(r[o])&&(et(r[o])&&mt(r[o]),r[o]=Kt(t,r[o],a))}const s=new Proxy(r,n);return gt.set(s,t),s};class Oo extends It.Subject{constructor(e,n){super();i(this,"ignore",{});i(this,"raw");this.raw=e,n&&(this.ignore=n)}isIgnore(e){let n=this.ignore;for(const s of e.split(".")){if(n[s]===void 0)return!1;if(typeof n[s]=="boolean"&&n[s])return!0;n=n[s]}return!1}setIgnore(e){this.ignore=e}mergeIgnore(e){this.ignore=Object.assign(this.ignore,e)}}const Jt=function(t,r){const e=new Oo(t,r);return Kt(e,t)},qt=function(t){return gt.get(t)},Ao=function(t,r,e){return Reflect.get(t,r,e)},Do=function(t,r,e,n,s){if(typeof r=="symbol")return Reflect.set(t,r,e,n);if(t[r]===void 0){const o=Reflect.set(t,r,e);return s.add(e),s.next({operate:"add",path:r,key:r,value:e}),o}else{const o=Reflect.set(t,r,e);return s.remove(e.vid),s.add(e),s.next({operate:"set",path:r,key:r,value:e}),o}},Po=function(t,r,e){if(typeof r=="symbol")return Reflect.deleteProperty(t,r);const n=t[r],s=Reflect.deleteProperty(t,r);return e.next({operate:"delete",path:r,key:r,value:n}),e.remove(n.vid),s},or=class extends It.Subject{constructor(){super();i(this,"container");i(this,"subscriptions",new Map);this.container=new Proxy(or.generator(),{get:Ao,set:(e,n,s,o)=>Do(e,n,s,o,this),deleteProperty:(e,n)=>Po(e,n,this)})}add(e){const n=qt(e);if(!n){console.error("DataContainer: this config can not Obasrvable",e);return}this.subscriptions.set(n.raw.vid,n.subscribe(s=>{s.operate!=="get"&&this.next({operate:s.operate,path:be(n.raw.vid,s.path),key:s.key,value:s.value})}))}remove(e){this.subscriptions.delete(e)}};let nt=or;i(nt,"generator",()=>({}));class ie{constructor(r,e=[]){i(this,"dataContainer",new nt);i(this,"translater");this.translater=new Pr().setRule(r),this.dataContainer.subscribe(n=>{this.translater.translate(n)});for(const n of e)this.addConfig(n)}getData(){return this.dataContainer.container}existSymbol(r){return Boolean(this.dataContainer.container[r])}addConfig(r){return this.dataContainer.container[r.vid]=r,this}getConfig(r){return this.dataContainer.container[r]}removeConfig(r){const e=this.dataContainer.container;e[r]!==void 0&&delete e[r]}addCompiler(r){return r.setTarget(this.dataContainer.container),r.compileAll(),this.translater.apply(r),this}toJSON(r=!0){return r?JSON.stringify(this.exportConfig(),Fe):JSON.stringify(Object.values(this.dataContainer.container),Fe)}exportConfig(r=!0){if(r){const e=this.dataContainer.container,n=[],s={},o=(a,l,d={})=>{for(const p in a){if(["vid","type"].includes(p)){d[p]=a[p];continue}if(typeof a[p]=="object"&&a[p]!==null){if(Array.isArray(a[p])){if(!a[p].length)continue;d[p]=a[p].map(h=>typeof h=="object"&&h!==null?rt(h):h);continue}d[p]={},l[p]?(o(a[p],l[p],d[p]),Object.keys(d[p]).length===0&&delete d[p]):d[p]=rt(a[p])}else l[p]!==a[p]&&(d[p]=a[p])}};for(const a of Object.values(e)){if(!s[a.type]){if(!k[a.type]){console.error(`can not font some config with: ${a.type}`);continue}s[a.type]=k[a.type]()}const l={};o(a,s[a.type],l),n.push(l)}return n}else return Object.values(rt(this.dataContainer.container))}load(r){const e=this.dataContainer.container,n={},s=(o,a)=>{for(const l in a)typeof o[l]=="object"&&o[l]!==null&&typeof a[l]=="object"&&a[l]!==null?s(o[l],a[l]):o[l]===void 0&&(o[l]=a[l])};for(const o of r){if(!n[o.type]){if(!k[o.type]){console.error(`can not font some config with: ${o.type}`);continue}n[o.type]=k[o.type]()}s(o,n[o.type]),e[o.vid]=o}return this}remove(r){const e=this.dataContainer.container;for(const n of r)e[n.vid]!==void 0&&delete e[n.vid];return this}getModule(){return this.MODULE}}const de=(t,r,e=Z.validate)=>{const{operate:n,key:s,path:o,value:a}=t;let l=s;const d=o.split(".");if(o.length&&(l=d.shift(),d.pop()),!e(l)){console.warn(`${r.MODULE} Rule: vid is illeage: ${l}`);return}if(n==="add"&&!d.length){r.add(a);return}if(t.operate==="delete"&&!d.length){r.remove(a);return}if(t.operate==="set"&&!d.length&&s===l){r.cover(a);return}r.compile(l,{operate:n,key:s,path:d,value:a})},jo=function(t,r){de(t,r)};class jr extends ie{constructor(e=[]){super(jo,e);i(this,"MODULE",y.TEXTURE)}}const Bo=function(t,r){de(t,r)};class Br extends ie{constructor(e=[]){super(Bo,e);i(this,"MODULE",y.MATERIAL)}}class Be extends ie{constructor(e,n=[]){super(e,n);i(this,"MODULE",y.GROUP)}}const ae=function(t,r){t.key!=="parent"&&de(t,r)},Io=function(t,r){ae(t,r)};class Ir extends Be{constructor(e=[]){super(Io,e);i(this,"MODULE",y.LIGHT)}}const Go=function(t,r){de(t,r)};class Gr extends ie{constructor(e=[]){super(Go,e);i(this,"MODULE",y.GEOMETRY)}}const Uo=function(t,r){ae(t,r)};class Ur extends Be{constructor(e=[]){super(Uo,e);i(this,"MODULE",y.CAMERA)}}const Ho=function(t,r){de(t,r,e=>Z.validate(e)||[z(u.WEBGLRENDERER),z(u.CSS3DRENDERER)].includes(e))};class Hr extends ie{constructor(e=[]){super(Ho,e);i(this,"MODULE",y.RENDERER)}}const No=function(t,r){de(t,r,e=>Z.validate(e)||[z(u.SCENE)].includes(e))};class Nr extends Be{constructor(e=[]){super(No,e);i(this,"MODULE",y.SCENE)}}const zo=function(t,r){de(t,r,e=>Z.validate(e)||[z(u.TRNASFORMCONTROLS),z(u.ORBITCONTROLS)].includes(e))};class zr extends ie{constructor(e=[]){super(zo,e);i(this,"MODULE",y.CONTROLS)}}class yt extends ie{constructor(e,n=[]){super(e,n);i(this,"MODULE",y.MESH)}}const Fo=function(t,r){t.key!=="geometry"&&ae(t,r)};class Fr extends yt{constructor(e=[]){super(Fo,e);i(this,"MODULE",y.SPRITE)}}const ko=function(t,r){ae(t,r)};class kr extends yt{constructor(e=[]){super(ko,e);i(this,"MODULE",y.LINE)}}const $o=function(t,r){ae(t,r)};class $r extends yt{constructor(e=[]){super($o,e);i(this,"MODULE",y.MESH)}}const Vo=function(t,r){ae(t,r)};class Vr extends yt{constructor(e=[]){super(Vo,e);i(this,"MODULE",y.POINTS)}}const Wo=function(t,r){ae(t,r)};class Wr extends Be{constructor(e=[]){super(Wo,e);i(this,"MODULE",y.GROUP)}}const Yo=function(t,r){de(t,r)};class Yr extends ie{constructor(e=[]){super(Yo,e);i(this,"MODULE",y.PASS)}}const _o=function(t,r){t.key==="name"&&t.path.length===1||de(t,r)};class _r extends ie{constructor(e=[]){super(_o,e);i(this,"MODULE",y.ANIMATION)}}const Xo=function(t,r){ae(t,r)};class Xr extends Be{constructor(e=[]){super(Xo,e);i(this,"MODULE",y.CSS3D)}}const Qo=function(t,r){ae(t,r)};class Qr extends Be{constructor(e=[]){super(Qo,e);i(this,"MODULE",y.OBJECT3D)}}const Ko=function(t,r){ae(t,r)};class Kr extends Be{constructor(e=[]){super(Ko,e);i(this,"MODULE",y.CSS2D)}}class Jr{constructor(r){i(this,"object3DDataSupport",new Qr);i(this,"cameraDataSupport",new Ur);i(this,"lightDataSupport",new Ir);i(this,"geometryDataSupport",new Gr);i(this,"textureDataSupport",new jr);i(this,"materialDataSupport",new Br);i(this,"rendererDataSupport",new Hr);i(this,"sceneDataSupport",new Nr);i(this,"controlsDataSupport",new zr);i(this,"spriteDataSupport",new Fr);i(this,"lineDataSupport",new kr);i(this,"meshDataSupport",new $r);i(this,"pointsDataSupport",new Vr);i(this,"groupDataSupport",new Wr);i(this,"css3DDataSupport",new Xr);i(this,"css2DDataSupport",new Kr);i(this,"passDataSupport",new Yr);i(this,"animationDataSupport",new _r);i(this,"dataSupportMap");r&&Object.keys(r).forEach(n=>{this[n]!==void 0&&(this[n]=r[n])});const e=new Map;Object.keys(this).forEach(n=>{const s=this[n];s instanceof ie&&e.set(s.MODULE,s)}),this.dataSupportMap=e}getDataSupport(r){return this.dataSupportMap.has(r)?this.dataSupportMap.get(r):(console.warn(`can not found this type in dataSupportManager: ${r}`),null)}getSupportData(r){return this.dataSupportMap.has(r)?this.dataSupportMap.get(r).getData():(console.warn(`can not found this type in dataSupportManager: ${r}`),null)}getConfigBySymbol(r){const e=this.dataSupportMap.values();for(const n of e){const s=n.getConfig(r);if(s)return s}return null}removeConfigBySymbol(...r){const e=this.dataSupportMap.values();for(const n of r)for(const s of e)if(s.existSymbol(n)){s.removeConfig(n);break}return this}getModuleBySymbol(r){const e=this.dataSupportMap.values();for(const n of e)if(n.existSymbol(r))return n.MODULE;return null}applyConfig(...r){for(const e of r){const n=Ne(e.type);n?this.dataSupportMap.get(n).addConfig(e):console.warn(`dataSupportManager can not found this config module: ${e.type}`)}return this}load(r){return this.dataSupportMap.forEach((n,s)=>{r[s]&&n.load(r[s])}),this}remove(r){return this.dataSupportMap.forEach((n,s)=>{r[s]&&n.remove(r[s])}),this}toJSON(r={},e=!0){return JSON.stringify(this.exportConfig(r,e),Fe)}exportConfig(r={},e=!0){return this.dataSupportMap.forEach((s,o)=>{r[o]=s.exportConfig(e)}),r}}const Jo=function(t){if(this.dataSupportManager)return console.warn("engine has installed dataSupportManager plugin."),!1;const r=new Jr(t);return this.dataSupportManager=r,this.applyConfig=function(...e){return this.dataSupportManager.applyConfig(...e),this},this.getConfigBySymbol=function(e){return this.dataSupportManager.getConfigBySymbol(e)},this.removeConfigBySymbol=function(...e){return this.dataSupportManager.removeConfigBySymbol(...e),this},this.toJSON=function(){if(this.loaderManager){const e={assets:JSON.parse(this.loaderManager.toJSON())};return this.dataSupportManager.toJSON(e)}return this.dataSupportManager.toJSON()},this.exportConfig=function(){let e={};return this.loaderManager&&(e={assets:this.loaderManager.exportConfig()}),this.dataSupportManager.exportConfig(e)},!0},se=class{constructor(){i(this,"target",{});i(this,"map",new Map);i(this,"weakMap",new WeakMap);i(this,"engine");i(this,"cacheCompile")}getMap(){return this.map}useEngine(r){return this.engine=r,this}setTarget(r){return this.target=r,this}add(r){if(!se.processors.has(r.type))return console.warn(`${this.MODULE} compiler can not support this type: ${r.type}`),null;const n=se.processors.get(r.type).create(r,this.engine);return this.map.set(r.vid,n),this.weakMap.set(n,r.vid),this.engine.compilerManager.emit(r.vid,{}),n}remove(r){const e=r.vid;if(!this.map.has(e))return console.warn(`${this.MODULE} compiler can not found this vid object: ${e}.`),this;if(!se.processors.has(r.type))return console.warn(`${this.MODULE} compiler can not support this type: ${r.type}`),this;const n=this.map.get(e);return se.processors.get(r.type).dispose(n),this.map.delete(e),this.weakMap.delete(n),this}cover(r){const e=r.vid;return this.map.has(e)?(Promise.resolve().then(()=>{_(r,r,{vid:!0,type:!0})}),this):(console.warn(`${this.MODULE} compiler can not found this vid object: ${e}.`),this)}compile(r,e){const n=this.cacheCompile;let s,o,a;if(n&&n.vid===r)s=n.target,o=n.config,a=n.processor;else{if(!this.map.has(r))return console.warn(`${this.MODULE} compiler set function: can not found object which vid is: '${r}'`),this;if(!this.target[r])return console.warn(`${this.MODULE} compiler set function: can not found config which vid is: '${r}'`),this;if(s=this.map.get(r),o=this.target[r],!se.processors.has(o.type))return console.warn(`PassCompiler can not support this type: ${o.type}`),this;a=se.processors.get(o.type),this.cacheCompile={target:s,config:o,processor:a,vid:r}}return a.process({config:o,target:s,engine:this.engine,processor:a,compiler:this,...e}),this}compileAll(){const r=this.target;for(const e of Object.values(r))this.add(e);return this}dispose(){this.cacheCompile&&(this.cacheCompile=void 0);for(const r of Object.values(this.target)){if(!this.map.has(r.vid)){console.warn(`${this.MODULE} compiler set function: can not found object which vid is: '${r.vid}'`);continue}const e=this.map.get(r.vid);if(!se.processors.has(r.type)){console.warn(`${this.MODULE}  can not support this type: ${r.type}`);continue}se.processors.get(r.type).dispose(e)}return this.map.clear(),this.target={},this}getObjectSymbol(r){return this.weakMap.get(r)||null}getObjectBySymbol(r){return this.map.get(r)||null}};let S=se;i(S,"processors",new Map),i(S,"processor",function(r){se.processors.set(r.configType,r)});const Ie="vis.scriptAni";class qo{constructor(r){i(this,"configType");i(this,"commands");i(this,"create");i(this,"dispose");this.configType=r.configType,this.commands=r.commands,this.create=r.create,this.dispose=r.dispose}process(r){if(!this.commands||!this.commands[r.operate]){this[r.operate](r);return}let e=this.commands[r.operate];for(const n of[].concat(r.path,r.key))if(!e[n]&&!e.$reg){this[r.operate](r);return}else if(e[n])if(typeof e[n]=="function"){e[n](r);return}else e=e[n];else if(e.$reg){for(const s of e.$reg)if(s.reg.test(n)){s.handler(r);return}}this[r.operate](r)}add(r){let e=r.target;const n=r.path;for(const s of n)if(typeof e[s]!==void 0)e=e[s];else{console.warn("processor can not exec default add operate.",r);return}e[r.key]=r.value}set(r){let e=r.target;const n=r.path;for(const s of n)if(typeof e[s]!==void 0)e=e[s];else{console.warn("processor can not exec default set operate.",r);return}e[r.key]=r.value}delete(r){let e=r.target;const n=r.path;for(const s of n)if(typeof e[s]!==void 0)e=e[s];else{console.warn("processor can not exec default delete operate.",r);return}delete e[r.key]}}const T=t=>new qo(t),Et=function(){},Zo={name:"linearTime",multiply:1},ei=function(t,r,e,n){return r[e]===void 0?(console.warn(`object not exist attribute: ${e}`,r),s=>{}):typeof r[e]!="number"?(console.warn("object attribute is not typeof number.",r,e),s=>{}):s=>{r[e]+=s.delta*n.multiply}},ti={name:"sinWave",wavelength:1,offset:0,amplitude:1,speed:1},ri=function(t,r,e,n){if(r[e]===void 0)return console.warn(`object not exist attribute: ${e}`,r),o=>{};if(typeof r[e]!="number")return console.warn("object attribute is not typeof number.",r,e),o=>{};const s=r[e];return o=>{r[e]=s+n.amplitude*Math.sin(o.total*n.speed/n.wavelength)+n.offset}},ce=class{static generateConfig(r,e){if(!ce.configLibrary.has(r))return console.warn(`event library can not found config by name: ${r}`),{name:""};const n=(o,a)=>{for(const l in a)o[l]!==void 0&&(typeof a[l]=="object"&&a[l]!==null&&!Array.isArray(a[l])?n(o[l],a[l]):o[l]=a[l])},s=JSON.parse(JSON.stringify(ce.configLibrary.get(r)));return n(s,e),s}static generateScript(r,e,n,s){return ce.generatorLibrary.has(s.name)?ce.generatorLibrary.get(s.name)(r,e,n,s):(console.error(`event library can not found generator by name: ${s.name}`),()=>{})}static has(r){return ce.configLibrary.has(r)}};let he=ce;i(he,"configLibrary",new Map),i(he,"generatorLibrary",new Map),i(he,"register",function(r,e){ce.configLibrary.has(r.name)&&console.warn(`EventLibrary has already exist this event generator: ${r.name}, that will be cover.`),ce.configLibrary.set(r.name,JSON.parse(JSON.stringify(r))),ce.generatorLibrary.set(r.name,e)}),he.register(Zo,ei),he.register(ti,ri);const qr=function(t,r){let e=r.compilerManager.getObjectBySymbol(t.target);if(!e)return console.warn(`can not found object in enigne: ${t.target}`),()=>{};const n=t.attribute.split(".");n.shift();const s=n.pop();for(const o of n){if(e[o]===void 0)return console.warn(`animaton processor: target object can not found key: ${o}`,e),()=>{};e=e[o]}return he.generateScript(r,e,s,t.script)};var ni=T({configType:u.SCRIPTANIMATION,commands:{set:{play({target:t,engine:r,value:e}){e?r.renderManager.addEventListener("render",t):r.renderManager.removeEventListener("render",t)},$reg:[{reg:new RegExp(".*"),handler({config:t,engine:r}){const e=t[Symbol.for(Ie)];r.renderManager.removeEventListener("render",e);const n=qr(t,r);t[Symbol.for(Ie)]=n,t.play&&r.renderManager.addEventListener("render",e)}}]}},create(t,r){const e=qr(t,r);return t.play&&r.renderManager.addEventListener("render",e),t[Symbol.for(Ie)]=e,e},dispose(){}});class si extends S{constructor(){super();i(this,"MODULE",y.ANIMATION)}restoreAttribute(e){if(!e.target||!e.attribute)return this;let n=this.engine.getObjectBySymbol(e.target),s=this.engine.getConfigBySymbol(e.target);(!n||!s)&&console.warn("AnimationCompiler: can not found object target or config in engine",e.vid);const o=e.attribute.split(".");o.shift();const a=o.pop();for(const l of o)if(n[l]&&s[l])n=n[l],s=s[l];else return console.warn("AnimationCompiler: object and config attribute are not sync"),this;return n[a]=s[a],this}cover(e){super.cover(e);const n=this.map.get(e.vid);return e[Symbol.for(Ie)]=n,this}remove(e){return this.engine.removeEventListener("render",e[Symbol.for(Ie)]),this.restoreAttribute(e),delete e[Symbol.for(Ie)],super.remove(e),this}compile(e,n){const s=this.target[e];this.restoreAttribute(s),super.compile(e,n);const o=this.map.get(e),a=s[Symbol.for(Ie)];return this.map.set(s.vid,a),this.weakMap.delete(o),this.weakMap.set(a,e),this}}S.processor(ni);class pe extends S{constructor(){super()}}const oi={name:"openWindow",params:{url:""}},ii=function(t,r){return()=>{window.open(r.params.url)}},ai={name:"visibleObject",params:{target:"",visible:!0,delay:0}},ci=function(t,r){const e=r.params,n=t.getObjectBySymbol(e.target);return n?()=>{setTimeout(()=>{n.visible=e.visible},e.delay)}:(console.warn(`basic event visibleObject: can not found vid object: ${e.target}`),()=>{})},li={name:"addClass",params:{target:"",className:"",delay:0}},ui=function(t,r){const e=r.params,n=[];if(e.target==="all")t.scene.traverse(s=>{s instanceof Se.CSS3DObject&&n.push(s)});else if(Array.isArray(e.target))e.target.forEach(s=>{const o=t.getObjectBySymbol(s);o?n.push(o):console.warn(`basic event AddClass: can not found vid object: ${e.target}`)});else{const s=t.getObjectBySymbol(e.target);if(!s)return console.warn(`basic event AddClass: can not found vid object: ${e.target}`),()=>{};if(!(s instanceof Se.CSS3DObject))return console.warn("basic event AddClass: object is not a CSS3DObject."),()=>{};n.push(s)}return n.length?()=>{setTimeout(()=>{n.forEach(s=>{s.element.classList.add(e.className)})},e.delay)}:(console.warn(`basic event AddClass: can not found vid object: ${e.target}`),()=>{})},di={name:"changeScene",params:{scene:"Scene",delay:0}},hi=function(t,r){const e=r.params;return()=>{setTimeout(()=>{t.setScene(e.scene)},e.delay)}},pi={name:"changeCamera",params:{camera:"",delay:0}},mi=function(t,r){const e=r.params;return()=>{setTimeout(()=>{t.setCamera(e.camera)},e.delay)}},fi={name:"switchAnimate",params:{target:"",toggle:"auto",delay:0}},gi=function(t,r){const e=r.params,n=t.getConfigBySymbol(e.target);return n?()=>{setTimeout(()=>{if(e.toggle==="auto"){n.play!=n.play;return}if(e.toggle==="off"){n.play=!1;return}if(e.toggle==="on"){n.play=!0;return}},e.delay)}:(console.warn(`basic event switchAnimate: can not found vid config: ${e.target}`),()=>{})};var K=(t=>(t.ELN="ELN",t.EQI="EQI",t.EQO="EQO",t.EASING_LINEAR_NONE="EASING_LINEAR_NONE",t.EASING_QUARTIC_IN="EASING_QUARTIC_IN",t.EASING_QUARTIC_OUT="EASING_QUARTIC_OUT",t.EASING_QUARTIC_INOUT="EASING_QUARTIC_INOUT",t.EASING_QUADRATIC_IN="EASING_QUADRATIC_IN",t.EASING_QUADRATIC_OUT="EASING_QUADRATIC_OUT",t.EASING_QUADRATIC_INOUT="EASING_QUADRATIC_INOUT",t))(K||{});const N={ELN:B.Easing.Linear.None,EQI:B.Easing.Quartic.In,EQO:B.Easing.Quartic.Out,EASING_LINEAR_NONE:B.Easing.Linear.None,EASING_QUARTIC_IN:B.Easing.Quartic.In,EASING_QUARTIC_OUT:B.Easing.Quartic.Out,EASING_QUARTIC_INOUT:B.Easing.Quartic.InOut,EASING_QUADRATIC_IN:B.Easing.Quadratic.In,EASING_QUADRATIC_OUT:B.Easing.Quadratic.Out,EASING_QUADRATIC_INOUT:B.Easing.Quadratic.InOut},yi={name:"moveTo",params:{target:"",position:{x:0,y:0,z:0},delay:0,duration:1e3,timingFunction:K.EASING_QUADRATIC_INOUT}},Ei=function(t,r){const e=r.params,s=t.compilerManager.getObjectBySymbol(e.target);if(!s)return console.warn(`real time animation moveTO: can not found vid object: ${e.target}`),()=>{};const o=t.renderManager,a=t.dataSupportManager.getConfigBySymbol(e.target);if(!a)return console.warn(`can not found object config: ${e.target}`),()=>{};let l=!1;return()=>{if(l)return;l=!0;const d=new B.Tween(s.position).to(e.position).duration(e.duration).delay(e.delay).easing(N[e.timingFunction]).start(),p=h=>{d.update()};o.addEventListener("render",p),d.onComplete(()=>{o.removeEventListener("render",p),a.position.x=e.position.x,a.position.y=e.position.y,a.position.z=e.position.z,l=!1})}},Si={name:"rotationTo",params:{target:"",rotation:{x:0,y:0,z:0},delay:0,duration:1e3,timingFunction:K.EASING_QUADRATIC_INOUT}},Mi=function(t,r){const e=r.params,s=t.compilerManager.getObjectBySymbol(e.target);if(!s)return console.warn(`real time animation moveTO: can not found vid object: ${e.target}`),()=>{};const o=t.renderManager,a=t.dataSupportManager.getConfigBySymbol(e.target);if(!a)return console.warn(`can not found object config: ${e.target}`),()=>{};let l=!1;return()=>{if(l)return;l=!0;const d=new B.Tween(s.rotation).to(e.rotation).duration(e.duration).delay(e.delay).easing(N[e.timingFunction]).start(),p=h=>{d.update()};o.addEventListener("render",p),d.onComplete(()=>{o.removeEventListener("render",p),a.rotation.x=e.rotation.x,a.rotation.y=e.rotation.y,a.rotation.z=e.rotation.z,l=!1})}},bi={name:"upTo",params:{target:"",up:{x:0,y:1,z:0},delay:0,duration:1e3,timingFunction:K.EASING_QUADRATIC_INOUT}},vi=function(t,r){const e=r.params,s=t.compilerManager.getObjectBySymbol(e.target);if(!s)return console.warn(`real time animation upTo: can not found vid object: ${e.target}`),()=>{};const o=t.renderManager,a=t.dataSupportManager.getConfigBySymbol(e.target);if(!a)return console.warn(`can not found object config: ${e.target}`),()=>{};let l=!1;return()=>{if(l)return;l=!0;const d=new B.Tween(s.up).to(e.up).duration(e.duration).delay(e.delay).easing(N[e.timingFunction]).start(),p=h=>{d.update()};o.addEventListener("render",p),d.onComplete(()=>{o.removeEventListener("render",p),a.up.x=e.up.x,a.up.y=e.up.y,a.up.z=e.up.z,l=!1})}},wi={name:"moveFromTo",params:{target:"",from:{x:0,y:0,z:0},to:{x:10,y:10,z:10},delay:0,duration:1e3,timingFunction:K.EASING_QUADRATIC_INOUT}},Ci=function(t,r){const e=r.params,s=t.compilerManager.getObjectBySymbol(e.target);if(!s)return console.warn(`real time animation moveTO: can not found vid object: ${e.target}`),()=>{};const o=t.renderManager,a=t.dataSupportManager.getConfigBySymbol(e.target);if(!a)return console.warn(`can not found object config: ${e.target}`),()=>{};let l=!1;return()=>{if(l)return;l=!0,s.position.set(e.from.x,e.from.y,e.from.z),s.updateMatrix(),s.updateMatrixWorld();const d=new B.Tween(s.position).to(e.to).duration(e.duration).delay(e.delay).easing(N[e.timingFunction]).start(),p=h=>{d.update()};o.addEventListener("render",p),d.onComplete(()=>{o.removeEventListener("render",p),a.position.x=e.to.x,a.position.y=e.to.y,a.position.z=e.to.z,l=!1})}},Ri={name:"moveSpacing",params:{target:"",spacing:{x:10,y:10,z:10},delay:0,duration:1e3,timingFunction:K.EASING_QUADRATIC_INOUT}},Ti=function(t,r){const e=r.params,n=t.getObjectBySymbol(e.target);if(!n)return console.warn(`can not found vid object: ${e.target}`),()=>{};if(!(n instanceof c.Object3D))return console.warn(`object is not instanceof Object3D: ${e.target}`),()=>{};const s=t.renderManager,o=t.getConfigBySymbol(e.target);let a=!1;return()=>{if(a)return;a=!0;const l={x:n.position.x+e.spacing.x,y:n.position.y+e.spacing.y,z:n.position.z+e.spacing.z},d=new B.Tween(n.position).to(l).duration(e.duration).delay(e.delay).easing(N[e.timingFunction]).start(),p=h=>{d.update()};s.addEventListener("render",p),d.onComplete(()=>{s.removeEventListener("render",p),o.position.x=l.x,o.position.y=l.y,o.position.z=l.z,a=!1})}},xi={name:"moveToObject",params:{target:"",to:"",offset:{x:0,y:0,z:0},delay:0,duration:1e3,timingFunction:K.EASING_QUADRATIC_INOUT}},Li=function(t,r){const e=r.params,n=t.compilerManager,s=n.getObjectBySymbol(e.target),o=n.getObjectBySymbol(e.to);if(!s)return console.warn(`real time animation MoveToObject: can not found vid object: ${e.target}`),()=>{};if(!o)return console.warn(`real time animation MoveToObject: can not found vid object: ${e.target}`),()=>{};const a=t.renderManager,l=t.dataSupportManager.getConfigBySymbol(e.target);if(!l)return console.warn(`can not found object config: ${e.target}`),()=>{};let d=!1;return()=>{if(d)return;d=!0;const p={x:o.position.x+e.offset.x,y:o.position.y+e.offset.y,z:o.position.z+e.offset.z},h=new B.Tween(s.position).to(p).duration(e.duration).delay(e.delay).easing(N[e.timingFunction]).start(),g=R=>{h.update()};a.addEventListener("render",g),h.onComplete(()=>{a.removeEventListener("render",g),l.position.x=p.x,l.position.y=p.y,l.position.z=p.z,d=!1})}},Oi={name:"vector3To",params:{target:"",attribute:".position",props:{x:"x",y:"y",z:"z"},delay:0,duration:500,to:{},timingFunction:K.EASING_QUADRATIC_INOUT}},Ai=function(t,r){var g,R,M;const e=r.params,n=t.compilerManager.getObjectBySymbol(e.target);if(!n)return console.warn(`real time animation vector3To: can not found vid object: ${e.target}`),()=>{};const s=t.renderManager;let o=t.dataSupportManager.getConfigBySymbol(e.target);if(!o)return console.warn(`real time animation vector3To: can not found object config: ${e.target}`),()=>{};const a=e.attribute.split(".");a.shift();let l=n;for(const C of a){if(l[C]===void 0)return console.error(`real time animation vector3To: object can not support key: ${C}`,n),()=>{};l=l[C],o=o[C]}const d=e.props;if(!(d.x in l)||!(d.y in l)||!(d.z in l))return console.error("real time animation vector3To: object can not support props:",l,d),()=>{};if(!(d.x in o)||!(d.y in o)||!(d.z in o))return console.error("real time animation vector3To: config can not support props:",o,d),()=>{};const p={x:(g=e.to.x)!=null?g:l[d.x],y:(R=e.to.y)!=null?R:l[d.y],z:(M=e.to.z)!=null?M:l[d.z]};let h=!1;return()=>{if(h)return;h=!0;const C=new B.Tween(l).to(p).duration(e.duration).delay(e.delay).easing(N[e.timingFunction]).start(),D=L=>{C.update()};s.addEventListener("render",D),C.onComplete(()=>{s.removeEventListener("render",D),o[d.x]=p.x,o[d.y]=p.y,o[d.z]=p.z,h=!1})}},Di={name:"focusObject",params:{target:"",camera:"",space:"world",offset:{x:0,y:0,z:20},delay:0,duration:1e3,timingFunction:K.EASING_QUADRATIC_INOUT,back:!0}},Pi=function(t,r){const e=r.params,n=t.getObjectBySymbol(e.target),s=t.orbitControls.target;if(!n)return console.warn(`real time animation focusObject: can not found vid object: ${e.target}`),()=>{};if(!(n instanceof c.Object3D))return console.warn(`real time animation focusObject: vid object is not a class of THREE.Object3D: ${e.target}`),()=>{};let o=!1;const a=new c.Euler;return()=>{if(o)return;o=!0;let l=t.camera;e.camera&&(l=t.getObjectBySymbol(e.camera),l||(l=t.camera,console.warn(`real time animation focusObject: can not found camera config: ${e.camera}`)));const d=t.getObjectConfig(l),p=t.orbitControls&&t.orbitControls.object===l;d||console.warn("engine current camera can not found config.");const h=t.renderManager;let g={x:n.matrixWorld.elements[12]+e.offset.x,y:n.matrixWorld.elements[13]+e.offset.y,z:n.matrixWorld.elements[14]+e.offset.z};const R={x:l.position.x,y:l.position.y,z:l.position.z};if(e.space==="local"){const A=new c.Vector3(e.offset.x,e.offset.y,e.offset.z).applyEuler(a.setFromRotationMatrix(n.matrixWorld));g={x:n.matrixWorld.elements[12]+A.x,y:n.matrixWorld.elements[13]+A.y,z:n.matrixWorld.elements[14]+A.z}}const M=new B.Tween(l.position).to(g).duration(e.duration).delay(e.delay).easing(N[e.timingFunction]).start();let C;const D={x:l.up.x,y:l.up.y,z:l.up.z};if(e.space==="local"){const A=new c.Vector3(0,1,0).applyEuler(a.setFromRotationMatrix(n.matrixWorld));C=new B.Tween(l.up).to({x:A.x,y:A.y,z:A.z}).duration(e.duration).delay(e.delay).easing(N[e.timingFunction]).start()}let L;const b={x:s.x,y:s.y,z:s.z};p&&(L=new B.Tween(s).to({x:n.matrixWorld.elements[12],y:n.matrixWorld.elements[13],z:n.matrixWorld.elements[14]}).duration(e.duration).delay(e.delay).easing(N[e.timingFunction]).start());let v;p&&e.space==="local"?v=A=>{M.update(),C.update(),L.update()}:p?v=A=>{M.update(),L.update()}:e.space==="local"?v=A=>{M.update(),C.update()}:v=A=>{M.update()},h.addEventListener("render",v),M.onComplete(()=>{if(h.removeEventListener("render",v),d&&(d.position.x=g.x,d.position.y=g.y,d.position.z=g.z),o=!1,e.back){const A=()=>{const W=new B.Tween(l.position).to(R).duration(e.duration).delay(e.delay).easing(N[e.timingFunction]).start();let O;e.space==="local"&&(O=new B.Tween(l.up).to(D).duration(e.duration).delay(e.delay).easing(N[e.timingFunction]).start());let E;p&&(E=new B.Tween(s).to(b).duration(e.duration).delay(e.delay).easing(N[e.timingFunction]).start());const H=j=>{W.update(),O&&O.update(),E&&E.update()};W.onComplete(()=>{h.removeEventListener("render",H)}),h.addEventListener("render",H),document.removeEventListener("dblclick",A)};document.addEventListener("dblclick",A)}})}},ji={name:"fadeObject",params:{target:"",direction:"out",delay:0,duration:300,timingFunction:K.EASING_QUADRATIC_INOUT,visible:!0}},Bi=function(t,r){const e=r.params,n=t.getObjectBySymbol(e.target);if(!n)return console.warn(`real time animation fadeObject: can not found vid object: ${e.target}`),()=>{};const s=t.getObjectConfig(n);if(!s.material)return console.warn(`real time animation fadeObject: target can not support fade: ${e.target}`),()=>{};const o=[],a=[],l=Array.isArray(s.material)?[].concat(s.material):[s.material];for(const p of l){const h=t.getObjectBySymbol(p),g=t.getConfigBySymbol(p);if(!(h instanceof c.Material)){console.error(`real time animation fadeObject: object config material is not instanceof Material: ${p}`);continue}if(!g){console.error(`real time animation fadeObject: object config material can not found config: ${p}`);continue}o.push(h),a.push(g)}let d=!1;return()=>{if(d)return;d=!0;const p=t.renderManager;s.visible=!0,o.forEach((h,g,R)=>{h.visible=!0,h.transparent=!0,h.opacity=e.direction==="in"?0:1,h.needsUpdate=!0;const M=new B.Tween(h).to({opacity:e.direction==="in"?1:0}).duration(e.duration).delay(e.delay).easing(N[e.timingFunction]).start(),C=D=>{M.update()};p.addEventListener("render",C),M.onComplete(()=>{p.removeEventListener("render",C),e.direction==="out"&&e.visible?(a[g].visible=!1,s.visible=!1):e.direction==="in"&&e.visible&&(a[g].visible=!0,s.visible=!0),a[g].opacity=e.direction==="in"?1:0,d=!1})})}},Ii={name:"showToCamera",params:{target:"",offset:{x:0,y:0,z:-30},delay:0,duration:1e3,timingFunction:K.EASING_QUADRATIC_INOUT,back:!0}},Gi=function(t,r){const e=r.params,n=t.getObjectBySymbol(e.target),s=t.getConfigBySymbol(e.target),o=t.camera;if(!n)return console.warn(`real time animation showToCamera: can not found vid object: ${e.target}`),()=>{};if(!n)return console.warn(`real time animation showToCamera: can not found vid config: ${e.target}`),()=>{};if(!(n instanceof c.Object3D))return console.warn(`real time animation showToCamera: vid object is not a class of THREE.Object3D: ${e.target}`),()=>{};const a=new c.Matrix4,l=new c.Euler,d=new c.Vector3;let p=!1;return()=>{if(p)return;p=!0;const h=t.renderManager;d.set(e.offset.x,e.offset.y,e.offset.z).applyEuler(o.rotation),d.set(o.position.x+d.x,o.position.y+d.y,o.position.z+d.z),a.lookAt(o.position,d,o.up),l.setFromRotationMatrix(a);const g={x:n.position.x,y:n.position.y,z:n.position.z},R={x:n.rotation.x,y:n.rotation.y,z:n.rotation.z},M=new B.Tween(n.position).to({x:d.x,y:d.y,z:d.z}).duration(e.duration).delay(e.delay).easing(N[e.timingFunction]).start(),C=new B.Tween(n.rotation).to({x:l.x,y:l.y,z:l.z}).duration(e.duration).delay(e.delay).easing(N[e.timingFunction]).start(),D=L=>{M.update(),C.update()};h.addEventListener("render",D),M.onComplete(()=>{if(h.removeEventListener("render",D),s.position.x=d.x,s.position.y=d.y,s.position.z=d.z,s.rotation.x=l.x,s.rotation.y=l.y,s.rotation.z=l.z,p=!1,e.back){const L=()=>{const b=new B.Tween(n.position).to(g).duration(e.duration).delay(e.delay).easing(N[e.timingFunction]).start(),v=new B.Tween(n.rotation).to(R).duration(e.duration).delay(e.delay).easing(N[e.timingFunction]).start(),A=W=>{b.update(),v.update()};b.onComplete(()=>{h.removeEventListener("render",A),s.position.x=g.x,s.position.y=g.y,s.position.z=g.z,s.rotation.x=R.x,s.rotation.y=R.y,s.rotation.z=R.z}),h.addEventListener("render",A),document.removeEventListener("dblclick",L)};document.addEventListener("dblclick",L)}})}},Ui={name:"colorChange",params:{target:"",attribute:"color",color:"rgb(255, 255, 255)",delay:0,duration:500,timingFunction:K.EASING_QUADRATIC_INOUT}},Hi=function(t,r){const e=r.params,n=t.getObjectBySymbol(e.target);if(!n)return console.warn(`real time animation ColorChange: can not found vid material: ${e.target}`),()=>{};if(!n[e.attribute]||!(n[e.attribute]instanceof c.Color))return console.warn(`real time animation ColorChange: material attribute is illeage: ${e.attribute}`),()=>{};const s=t.getConfigBySymbol(e.target);if(!s)return console.warn(`real time animation ColorChange: can not found material config: ${e.target}`),()=>{};const o=new c.Color(e.color),a=t.renderManager;let l=!1;return()=>{if(l)return;l=!0;const d=new B.Tween(n[e.attribute]).to({r:o.r,g:o.g,b:o.b}).duration(e.duration).delay(e.delay).easing(N[e.timingFunction]).start(),p=h=>{d.update()};a.addEventListener("render",p),d.onComplete(()=>{a.removeEventListener("render",p),s[e.attribute]=e.color,l=!1})}},Ni={name:"orbitTargetMove",params:{target:"",offset:{x:0,y:0,z:0},delay:0,duration:1e3,timingFunction:K.EASING_QUADRATIC_INOUT}},zi=function(t,r){const e=r.params;if(t.compilerManager,!t.orbitControls)return console.warn("real time animation orbitTargetMove: engine can not install orbitControls."),()=>{};const n=t.renderManager;let s=!1;return()=>{if(s)return;s=!0;let o=e.offset;if(e.target){const d=t.getObjectBySymbol(e.target);d?o={x:d.matrixWorld.elements[12]+o.x,y:d.matrixWorld.elements[13]+o.y,z:d.matrixWorld.elements[14]+o.z}:console.warn(`real time animation orbitTargetMove: can not found vid object: ${e.target}`)}const a=new B.Tween(t.orbitControls.target).to(o).duration(e.duration).delay(e.delay).easing(N[e.timingFunction]).start(),l=d=>{a.update()};n.addEventListener("render",l),a.onComplete(()=>{n.removeEventListener("render",l),s=!1})}},le=class{static generateConfig(r,e){if(!le.configLibrary.has(r))return console.warn(`event library can not found config by name: ${r}`),{name:""};const n=(o,a)=>{for(const l in a)typeof a[l]=="object"&&a[l]!==null&&!Array.isArray(a[l])?n(o[l],a[l]):o[l]=a[l]},s=JSON.parse(JSON.stringify(le.configLibrary.get(r)));return n(s,e),s}static generateEvent(r,e){return le.generatorLibrary.has(r.name)?le.generatorLibrary.get(r.name)(e,r):(console.error(`event library can not found generator by name: ${r.name}`),()=>{})}static has(r){return le.configLibrary.has(r)}};let G=le;i(G,"configLibrary",new Map),i(G,"generatorLibrary",new Map),i(G,"register",function(r,e){le.configLibrary.has(r.name)&&console.warn(`EventLibrary has already exist this event generator: ${r.name}, that will be cover.`),le.configLibrary.set(r.name,JSON.parse(JSON.stringify(r))),le.generatorLibrary.set(r.name,e)}),G.register(oi,ii),G.register(ai,ci),G.register(li,ui),G.register(di,hi),G.register(pi,mi),G.register(fi,gi),G.register(yi,Ei),G.register(Si,Mi),G.register(bi,vi),G.register(wi,Ci),G.register(Ri,Ti),G.register(xi,Li),G.register(Oi,Ai),G.register(Di,Pi),G.register(ji,Bi),G.register(Ii,Gi),G.register(Ui,Hi),G.register(Ni,zi);class Fi{constructor(){i(this,"list",[]);i(this,"timer");i(this,"time",0)}exec(r){r(!1)||(this.list.includes(r)||this.list.push(r),this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{for(const e of this.list)e(!0);this.list=[]},this.time))}append(r){this.list.length&&!this.list.includes(r)?this.list.push(r):this.exec(r)}force(r){setTimeout(()=>{r()},this.time)}}const ve=new Fi,Zr=new WeakMap,en=function({target:t,config:r,value:e,engine:n}){if(r.vid===e){console.warn("can not set object lookAt itself.");return}let s=Zr.get(t);if(s||(s={lookAtTarget:null,updateMatrixWorldFun:null},Zr.set(t,s)),!e){if(!s.updateMatrixWorldFun)return;t.updateMatrixWorld=s.updateMatrixWorldFun,s.lookAtTarget=null,s.updateMatrixWorldFun=null;return}ve.exec(o=>{const a=n.compilerManager.getObject3D(e);if(!a)return o&&console.warn(`lookAt handler can not found this vid mapping object: '${e}'`),!1;const l=t.updateMatrixWorld;return s.updateMatrixWorldFun=l,s.lookAtTarget=a.position,t.updateMatrixWorld=d=>{l.call(t,d),t.lookAt(s.lookAtTarget)},!0})},st="vis.event",me=function({target:t,path:r,value:e,engine:n}){const s=r[0];if(!G.has(e.name)){console.warn(`EventLibrary: can not support this event: ${e.name}`);return}const o=G.generateEvent(e,n),a=Symbol.for(st);e[a]=o,t.addEventListener(s,o)},we=function({target:t,path:r,value:e}){const n=r[0],s=e[Symbol.for(st)];if(!s){console.warn("event remove can not fun found event in config",e);return}t.removeEventListener(n,s),delete e[Symbol.for(st)]},Ce=function({target:t,config:r,path:e,engine:n}){if(e.length<2)return;const s=e[0],o=r[e[0]][e[1]],a=o[Symbol.for(st)];if(!a){console.warn("event remove can not fun found event in config",o);return}t.removeEventListener(s,a);const l=G.generateEvent(o,n);o[Symbol.for(st)]=l,t.addEventListener(s,l)},Zt=function({target:t,config:r,value:e,engine:n}){ve.exec(s=>{const o=n.getConfigBySymbol(e);if(!o)return s&&console.warn(` can not foud object config in engine: ${e}`),!1;if(o.parent&&o.parent!==r.vid){const l=n.getConfigBySymbol(o.parent);if(!l)return s&&console.warn(` can not foud object parent config in engine: ${o.parent}`),!1;l.children.splice(l.children.indexOf(e),1)}o.parent=r.vid;const a=n.compilerManager.getObject3D(e);return a?(t.add(a),!0):(s&&console.warn(`can not found this vid in engine: ${e}.`),!1)})},ki=function({target:t,config:r,value:e,engine:n}){const s=n.compilerManager.getObject3D(e);if(!s){console.warn(`can not found this vid in engine: ${e}.`);return}t.remove(s);const o=n.getConfigBySymbol(e);if(!o){console.warn(`can not found this vid in engine: ${e}.`);return}o.parent=""},re=function(t,r,e,n){Promise.resolve(),!e.lookAt&&en({target:t,config:r,engine:n,value:r.lookAt}),r.children.forEach(s=>{Zt({target:t,config:r,value:s,engine:n})});for(const s of Object.values(Ht))ve.force(()=>(r[s].forEach((o,a)=>{me({target:t,path:[s,a.toString()],value:o,engine:n})}),!0));return _(r,t,{vid:!0,type:!0,lookAt:!0,parent:!0,children:!0,pointerdown:!0,pointermove:!0,pointerup:!0,pointerenter:!0,pointerleave:!0,click:!0,dblclick:!0,contextmenu:!0,...e}),t},$=function(t){t._listener={}},U={add:{pointerdown:me,pointerup:me,pointermove:me,pointerenter:me,pointerleave:me,click:me,dblclick:me,contextmenu:me,children:Zt},set:{lookAt:en,pointerdown:Ce,pointerup:Ce,pointermove:Ce,pointerenter:Ce,pointerleave:Ce,click:Ce,dblclick:Ce,contextmenu:Ce,parent:Et,children:{$reg:[{reg:new RegExp(".*"),handler:Zt}]}},delete:{pointerdown:we,pointerup:we,pointermove:we,pointerenter:we,pointerleave:we,click:we,dblclick:we,contextmenu:we,children:ki}};T({configType:u.OBJECT3D,commands:U,create(t,r){return re(new c.Object3D,t,{},r)},dispose:$});const ne=new WeakMap;var $i=T({configType:u.PERSPECTIVECAMERA,commands:{add:{scale(){},...U.add},set:{scale(){},adaptiveWindow({target:t,value:r,engine:e}){if(r){if(!ne.has(r)){const n=s=>{t.aspect=s.width/s.height,t.updateProjectionMatrix()};ne.set(t,n),e.addEventListener("setSize",n),n({type:"setSize",width:e.dom.offsetWidth,height:e.dom.offsetHeight})}}else{const n=ne.get(t);n&&(e.removeEventListener("setSize",n),ne.delete(t))}},...U.set,$reg:[{reg:new RegExp("fov|aspect|near|far"),handler({target:t,key:r,value:e}){t[r]=e,t.updateProjectionMatrix()}}]},delete:{scale(){},...U.delete}},create(t,r){const e=new c.PerspectiveCamera;if(re(e,t,{scale:!0,adaptiveWindow:!0},r),e.updateProjectionMatrix(),t.adaptiveWindow){const n=s=>{e.aspect=s.width/s.height,e.updateProjectionMatrix()};ne.set(e,n),r.addEventListener("setSize",n),n({type:"setSize",width:r.dom.offsetWidth,height:r.dom.offsetHeight})}return e},dispose(t){ne.delete(t),$(t)}}),Vi=T({configType:u.ORTHOGRAPHICCAMERA,commands:{add:{scale(){},...U.add},set:{scale(){},adaptiveWindow({target:t,value:r,engine:e}){if(r){if(!ne.has(r)){const n=s=>{const o=s.width,a=s.height;t.left=-o,t.right=o,t.top=a,t.bottom=-a,t.updateProjectionMatrix()};ne.set(t,n),e.addEventListener("setSize",n),n({type:"setSize",width:e.dom.offsetWidth,height:e.dom.offsetHeight})}}else{const n=ne.get(t);n&&(e.removeEventListener("setSize",n),ne.delete(t))}},...U.set,$reg:[{reg:new RegExp("left|right|top|bottom|near|far|zoom"),handler({target:t,key:r,value:e}){t[r]=e,t.updateProjectionMatrix()}}]},delete:{scale(){},...U.delete}},create(t,r){const e=new c.OrthographicCamera(-50,50,50,-50);if(re(e,t,{scale:!0,adaptiveWindow:!0},r),e.updateProjectionMatrix(),t.adaptiveWindow){const n=s=>{const o=s.width,a=s.height;e.left=-o,e.right=o,e.top=a,e.bottom=-a,e.updateProjectionMatrix()};ne.set(e,n),r.addEventListener("setSize",n),n({type:"setSize",width:r.dom.offsetWidth,height:r.dom.offsetHeight})}return e},dispose(t){ne.delete(t),$(t)}});class Wi extends pe{constructor(){super();i(this,"MODULE",y.CAMERA)}}S.processor($i),S.processor(Vi);var Yi=T({configType:u.ORBITCONTROLS,commands:{set:{target({target:t,config:r,path:e,key:n,value:s}){const o=r.target;if(!r.type){r.target=new c.Vector3(0,0,0);return}typeof r.target=="string"||(e.length>1?t.target[n]=s:t.target=new c.Vector3(o.x,o.y,o.z))}}},create(t,r){let e;return r.orbitControls?e=r.orbitControls:(e=new Er,e.setCamera(r.camera),e.setDom(r.dom)),t.target&&(typeof t.target=="string"||(e.target=new c.Vector3(t.target.x,t.target.y,t.target.z))),_(t,e,{target:!0}),e},dispose(t){t.dispose()}}),_i=T({configType:u.TRNASFORMCONTROLS,commands:{set:{snapAllow({target:t,config:r,value:e}){e?(t.translationSnap=r.translationSnap,t.rotationSnap=r.rotationSnap,t.scaleSnap=r.scaleSnap):(t.translationSnap=null,t.rotationSnap=null,t.scaleSnap=null)},translationSnap({target:t,config:r,value:e}){r.snapAllow&&(t.translationSnap=e)},rotationSnap({target:t,config:r,value:e}){r.snapAllow&&(t.rotationSnap=e)},scaleSnap({target:t,config:r,value:e}){r.snapAllow&&(t.scaleSnap=e)}}},create(t,r){let e;return r.transformControls?e=r.transformControls:(e=new Mr,e.setCamera(r.camera),r.dom&&e.setDom(r.dom)),t.snapAllow&&(e.translationSnap=t.translationSnap,e.rotationSnap=t.rotationSnap,e.scaleSnap=t.scaleSnap),e},dispose(t){t.dispose()}});class Xi extends S{constructor(){super();i(this,"MODULE",y.CONTROLS)}useEngine(e){return e.transformControls&&(this.map.set(z(u.TRNASFORMCONTROLS),e.transformControls),this.weakMap.set(e.transformControls,z(u.TRNASFORMCONTROLS))),e.orbitControls&&(this.map.set(z(u.ORBITCONTROLS),e.orbitControls),this.weakMap.set(e.orbitControls,z(u.ORBITCONTROLS))),super.useEngine(e)}}S.processor(Yi),S.processor(_i);const ke=function(t,r){const e=r.resourceManager.resourceMap;if(!e.has(t))return console.warn(`css3D compiler: can not found resource element: ${t}`),document.createElement("div");const n=e.get(t);return n instanceof HTMLElement?n:(console.warn("css3D compiler can not suport render this resource type.",n.constructor,t),document.createElement("div"))};var Qi=T({configType:u.CSS3DOBJECT,commands:{add:U.add,set:{element({target:t,value:r,engine:e}){t.element=ke(r,e)},...U.set},delete:U.delete},create(t,r){return re(new Se.CSS3DObject(ke(t.element,r)),t,{element:!0},r)},dispose:$});class Ki extends Se.CSS3DObject{constructor(e=document.createElement("div")){const n=document.createElement("div"),s=50,o=50;n.style.width=`${s}px`,n.style.height=`${o}px`,n.appendChild(e);super(n);i(this,"geometry");i(this,"_width");i(this,"_height");this.geometry=new c.PlaneBufferGeometry(s,o),this.geometry.computeBoundingBox(),this._width=s,this._height=o}get width(){return this._width}set width(e){this.geometry.dispose(),this.geometry=new c.PlaneBufferGeometry(e,this._height),this.geometry.computeBoundingBox(),this.element.style.width=`${e}px`,this._width=e}get height(){return this._height}set height(e){this.geometry.dispose(),this.geometry=new c.PlaneBufferGeometry(this._width,e),this.geometry.computeBoundingBox(),this.element.style.height=`${e}px`,this._height=e}}class tn extends Ki{constructor(e=document.createElement("div")){super(e);i(this,"cacheBox",new c.Box3);this.type="CSS3DPlane",this.element.classList.add("vis-css3d","vis-css3d-plane")}raycast(e,n){const s=this.cacheBox.copy(this.geometry.boundingBox);s.applyMatrix4(this.matrixWorld),e.ray.intersectsBox(s)&&n.push({distance:e.ray.origin.distanceTo(this.position),object:this,point:this.position})}}var Ji=T({configType:u.CSS3DPLANE,commands:{add:U.add,set:{element({target:t,value:r,engine:e}){t.element.innerHTML="",t.element.appendChild(ke(r,e))},...U.set},delete:U.delete},create(t,r){return re(new tn(ke(t.element,r)),t,{element:!0},r)},dispose:$});class qi extends Se.CSS3DSprite{constructor(e=document.createElement("div")){const n=document.createElement("div"),s=50,o=50;n.style.width=`${s}px`,n.style.height=`${o}px`,n.appendChild(e),e.classList.add("vis-css3d","vis-css3d-sprite");super(n);i(this,"geometry");i(this,"_width");i(this,"_height");i(this,"cacheBox",new c.Box3);i(this,"cachePosition",new c.Vector3);i(this,"cacheQuaternion",new c.Quaternion);i(this,"cacheScale",new c.Vector3);i(this,"cacheMatrix4",new c.Matrix4);i(this,"rotateMatrix4",new c.Matrix4);this.geometry=new c.PlaneBufferGeometry(s,o),this.geometry.computeBoundingBox(),this._width=s,this._height=o,this.type="CSS3DSprite"}get width(){return this._width}set width(e){this.geometry.dispose(),this.geometry=new c.PlaneBufferGeometry(e,this._height),this.geometry.computeBoundingBox(),this.element.style.width=`${e}px`,this._width=e}get height(){return this._height}set height(e){this.geometry.dispose(),this.geometry=new c.PlaneBufferGeometry(this._width,e),this.geometry.computeBoundingBox(),this.element.style.height=`${e}px`,this._height=e}raycast(e,n){const s=this.cacheBox.copy(this.geometry.boundingBox);this.matrixWorld.decompose(this.cachePosition,this.cacheQuaternion,this.cacheScale);const o=this.rotateMatrix4.lookAt(this.position,e.camera.position,this.up);this.cacheQuaternion.setFromRotationMatrix(o),this.cacheMatrix4.compose(this.cachePosition,this.cacheQuaternion,this.cacheScale),s.applyMatrix4(this.cacheMatrix4),e.ray.intersectsBox(s)&&n.push({distance:e.ray.origin.distanceTo(this.position),object:this,point:this.position})}}class Zi extends qi{constructor(r=document.createElement("div")){super(r),this.type="CSS3DSprite",this.element.classList.add("vis-css3d","vis-css3d-plane")}}var ea=T({configType:u.CSS3DSPRITE,commands:{add:U.add,set:{element({target:t,value:r,engine:e}){t.element.innerHTML="",t.element.appendChild(ke(r,e))},...U.set},delete:U.delete},create(t,r){return re(new Zi(ke(t.element,r)),t,{element:!0},r)},dispose:$});class ta extends pe{constructor(){super();i(this,"MODULE",y.CSS3D)}}S.processor(Ji),S.processor(Qi),S.processor(ea);class $e extends c.BufferGeometry{constructor(e=[],n=36,s=!0){super();i(this,"parameters");this.type="CurveGeometry",this.parameters={path:e.map(o=>o.clone()),space:s,divisions:n}}}class ra extends $e{constructor(r=[],e=36,n=!0){super(r,e,n),this.type="QuadraticBezierCurveGeometry";const s=new c.CurvePath;if(r.length<3){console.warn("QuadraticBezierCurveGeometry path length at least 3.");return}const o=3+(r.length-3)-(r.length-3)%2;for(let l=1;l<o;l+=2)s.add(new c.QuadraticBezierCurve3(r[l-1],r[l],r[l+1]));const a=s.curves.reduce((l,d)=>l+=d.arcLengthDivisions,0);if(e>a){const l=Math.ceil((e-a)/s.curves.length);s.curves.forEach(d=>{d.arcLengthDivisions=d.arcLengthDivisions*(l+1),d.updateArcLengths()})}this.setFromPoints(n?s.getSpacedPoints(e):s.getPoints(e))}}class na extends $e{constructor(r=[],e=36,n=!0){super(r,e,n),this.type="CubicBezierCurveGeometry";const s=new c.CurvePath;if(r.length<4){console.warn("CubicBezierCurveGeometry path length at least 4.");return}const o=4+(r.length-4)-(r.length-4)%3;for(let l=2;l<o;l+=3)s.add(new c.CubicBezierCurve3(r[l-2],r[l-1],r[l],r[l+1]));const a=s.curves.reduce((l,d)=>l+=d.arcLengthDivisions,0);if(e>a){const l=Math.ceil((e-a)/s.curves.length);s.curves.forEach(d=>{d.arcLengthDivisions=d.arcLengthDivisions*(l+1),d.updateArcLengths()})}this.setFromPoints(n?s.getSpacedPoints(e):s.getPoints(e))}}class sa extends $e{constructor(r=[],e=36,n=!0){if(super(r,e,n),this.type="LineCurveGeometry",!r.length){console.warn("LineCurveGeometry path length at least 1.");return}const s=new c.CurvePath;for(let a=1;a<r.length;a+=1)s.add(new c.LineCurve3(r[a-1],r[a]));const o=s.curves.reduce((a,l)=>a+=l.arcLengthDivisions,0);if(e>o){const a=Math.ceil((e-o)/s.curves.length);s.curves.forEach(l=>{l.arcLengthDivisions=l.arcLengthDivisions*(a+1),l.updateArcLengths()})}this.setFromPoints(n?s.getSpacedPoints(e):s.getPoints(e))}}class oa extends $e{constructor(r=[],e=36,n=!0){if(super(r,e,n),this.type="SplineCurveGeometry",!r.length){console.warn("SplineCurveGeometry path length at least 1.");return}const s=new c.CatmullRomCurve3(r);this.setFromPoints(n?s.getSpacedPoints(e):s.getPoints(e))}}class ia extends c.TubeGeometry{constructor(r=[],e=64,n=1,s=8,o=!1){if(!r.length){console.warn("LineTubeGeometry path length at least 1.");return}const a=new c.CurvePath;for(let l=1;l<r.length;l+=1)a.add(new c.LineCurve3(r[l-1],r[l]));super(a,e,n,s,o),this.type="LineTubeGeometry"}}class aa extends c.TubeGeometry{constructor(r=[],e=64,n=1,s=8,o=!1){if(!r.length){console.warn("SplineTubeGeometry path length at least 1.");return}const a=new c.CatmullRomCurve3(r);super(a,e,n,s,o),this.type="SplineTubeGeometry"}}class ca extends c.ShapeBufferGeometry{constructor(r=[new c.Vector2(0,0)],e=12){const n=new c.Shape,s=r[0];if(s){n.moveTo(s.x,s.y);for(let o=1;o<r.length;o+=1)n.lineTo(r[o].x,r[o].y)}super(n,e),this.type="LineShapeGeometry"}}const la=function(t,r){!(t instanceof $e)&&!(t instanceof c.TubeGeometry)&&!(t instanceof c.ShapeGeometry)&&t.center(),t.computeBoundingBox();const e=t.boundingBox,n=r.position,s=r.rotation,o=r.scale,a=new c.Quaternion().setFromEuler(new c.Euler(s.x,s.y,s.z,"XYZ"));return t.applyQuaternion(a),t.scale(o.x,o.y,o.z),!(t instanceof $e)&&!(t instanceof c.TubeGeometry)&&!(t instanceof c.ShapeGeometry)&&t.center(),t.computeBoundingBox(),t.translate((e.max.x-e.min.x)/2*n.x,(e.max.y-e.min.y)/2*n.y,(e.max.z-e.min.z)/2*n.z),t},er={reg:new RegExp(".*"),handler({config:t,target:r,processor:e,engine:n}){const s=e.create(t,n);r.copy(s),r.dispatchEvent({type:"update"}),r.uuid=s.uuid,s.dispose()}},St={add:{groups({target:t,value:r}){t.addGroup(r.start,r.count,r.materialIndex)},$reg:[er]},set:{groups(t){const{path:r,target:e,config:n}=t;if(r[1]!==void 0){e.groups.splice(Number(t.path[1]),1);const s=n.groups[r[1]];e.addGroup(s.start,s.count,s.materialIndex)}else console.warn("geometry processor can not set group",t)},$reg:[er]},delete:{groups({target:t,key:r}){t.groups.splice(Number(r),1)},$reg:[er]}},Mt=function(t,r){t.clearGroups();for(const e of r.groups)t.addGroup(e.start,e.count,e.materialIndex);return la(t,r)},V=new Map;V.set(u.BOXGEOMETRY,t=>new c.BoxBufferGeometry(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)),V.set(u.SPHEREGEOMETRY,t=>new c.SphereBufferGeometry(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)),V.set(u.PLANEGEOMETRY,t=>new c.PlaneBufferGeometry(t.width,t.height,t.widthSegments,t.heightSegments)),V.set(u.CIRCLEGEOMETRY,t=>new c.CircleBufferGeometry(t.radius,t.segments,t.thetaStart,t.thetaLength)),V.set(u.CONEGEOMETRY,t=>new c.ConeBufferGeometry(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)),V.set(u.CYLINDERGEOMETRY,t=>new c.CylinderBufferGeometry(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)),V.set(u.LINECURVEGEOMETRY,t=>new sa(t.path.map(r=>new c.Vector3(r.x,r.y,r.z)),t.divisions,t.space)),V.set(u.SPLINECURVEGEOMETRY,t=>new oa(t.path.map(r=>new c.Vector3(r.x,r.y,r.z)),t.divisions,t.space)),V.set(u.CUBICBEZIERCURVEGEOMETRY,t=>new na(t.path.map(r=>new c.Vector3(r.x,r.y,r.z)),t.divisions,t.space)),V.set(u.QUADRATICBEZIERCURVEGEOMETRY,t=>new ra(t.path.map(r=>new c.Vector3(r.x,r.y,r.z)),t.divisions,t.space)),V.set(u.LINETUBEGEOMETRY,t=>new ia(t.path.map(r=>new c.Vector3(r.x,r.y,r.z)),t.tubularSegments,t.radius,t.radialSegments,t.closed)),V.set(u.SPLINETUBEGEOMETRY,t=>new aa(t.path.map(r=>new c.Vector3(r.x,r.y,r.z)),t.tubularSegments,t.radius,t.radialSegments,t.closed)),V.set(u.TORUSGEOMETRY,t=>new c.TorusGeometry(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)),V.set(u.RINGGEOMETRY,t=>new c.RingBufferGeometry(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)),V.set(u.LINESHAPEGEOMETRY,t=>new ca(t.path.map(r=>new c.Vector2(r.x,r.y)),t.curveSegments));const ua=function(t){return V.has(t.type)?Mt(V.get(t.type)(t),t):(console.error(`parametric geometry can not support this type config: ${t.type}`),new c.BufferGeometry)},da=function(t){t.dispose()},ha=function(t){return T({configType:t,commands:St,create:ua,dispose:da})},pa=[u.BOXGEOMETRY,u.SPHEREGEOMETRY,u.PLANEGEOMETRY,u.CIRCLEGEOMETRY,u.CONEGEOMETRY,u.CYLINDERGEOMETRY,u.LINECURVEGEOMETRY,u.SPLINECURVEGEOMETRY,u.CUBICBEZIERCURVEGEOMETRY,u.QUADRATICBEZIERCURVEGEOMETRY,u.LINETUBEGEOMETRY,u.SPLINETUBEGEOMETRY,u.TORUSGEOMETRY,u.RINGGEOMETRY,u.LINESHAPEGEOMETRY].map(t=>ha(t));class ma extends c.BufferGeometry{constructor(e){super();i(this,"type","LoadBufferGeometry");e&&this.copy(e)}}var fa=T({configType:u.LOADGEOMETRY,commands:St,create(t,r){const e=r.resourceManager.resourceMap.get(t.url);return!e&&!(e instanceof c.BufferGeometry)?(console.error(`engine rescoure can not found url: ${t.url}`),new c.BoxBufferGeometry(5,5,5)):Mt(new ma(e),t)},dispose(t){t.dispose()}});const ga=function(t){const r=new c.BufferGeometry;return t.position.length&&r.setAttribute("position",new c.Float32BufferAttribute(t.position,3)),t.color.length&&r.setAttribute("color",new c.Float32BufferAttribute(t.color,3)),t.normal.length&&r.setAttribute("normal",new c.Float32BufferAttribute(t.normal,3)),t.uv.length&&r.setAttribute("uv",new c.Float32BufferAttribute(t.uv,2)),t.uv2.length&&r.setAttribute("uv2",new c.Float32BufferAttribute(t.uv2,2)),t.index.length&&r.setIndex(t.index),r};var ya=T({configType:u.CUSTOMGEOMETRY,commands:St,create(t){return Mt(ga(t.attribute),t)},dispose(t){t.dispose()}}),Ea=T({configType:u.EDGESGEOMETRY,commands:St,create(t,r){const e=r.compilerManager.getObjectBySymbol(t.url);return!e||!(e instanceof c.BufferGeometry)?(console.error(`engine rescoure can not found url: ${t.url}`),new c.EdgesGeometry(new c.BoxBufferGeometry(5,5,5))):Mt(new c.EdgesGeometry(e),t)},dispose(t){t.dispose()}});class Sa extends S{constructor(){super();i(this,"MODULE",y.GEOMETRY)}}pa.forEach(t=>{S.processor(t)}),S.processor(fa),S.processor(ya),S.processor(Ea);var Ma=T({configType:u.GROUP,commands:U,create(t,r){return re(new c.Group,t,{},r)},dispose:$});class ba extends pe{constructor(){super();i(this,"MODULE",y.GROUP)}}S.processor(Ma);const va=function({target:t,value:r}){t.color.copy(new c.Color(r))},Ve=function(t,r,e,n){return t.color.copy(new c.Color(r.color)),re(t,r,{color:!0,scale:!0,rotation:!0,lookAt:!0,...e},n)},We=Object.assign({},U,{set:{color:va,scale:Et,rotation:Et,lookAt:Et}});var wa=T({configType:u.AMBIENTLIGHT,commands:We,create(t,r){return Ve(new c.AmbientLight,t,{},r)},dispose:$}),Ca=T({configType:u.DIRECTIONALLIGHT,commands:We,create(t,r){return Ve(new c.DirectionalLight,t,{},r)},dispose:$}),Ra=T({configType:u.POINTLIGHT,commands:We,create(t,r){return Ve(new c.PointLight,t,{},r)},dispose:$}),Ta=T({configType:u.SPOTLIGHT,commands:We,create(t,r){return Ve(new c.SpotLight,t,{},r)},dispose:$}),xa=T({configType:u.HEMISPHERELIGHT,commands:{set:{...We.set,groundColor:function({target:t,value:r}){t.groundColor.copy(new c.Color(r))}}},create(t,r){const e=new c.HemisphereLight;return e.groundColor.copy(new c.Color(t.groundColor)),Ve(e,t,{groundColor:!0},r)},dispose:$}),La=T({configType:u.RECTAREALIGHT,commands:We,create(t,r){return Ve(new c.RectAreaLight,t,{},r)},dispose:$});class Oa extends pe{constructor(){super();i(this,"MODULE",y.LIGHT)}}S.processor(wa),S.processor(Ca),S.processor(Ra),S.processor(Ta),S.processor(xa),S.processor(La);class bt extends pe{constructor(){super()}}const vt=new c.ShaderMaterial({fragmentShader:`
  void main () {
    gl_FragColor = vec4(0.5, 0.5, 0.5, 1.0);
  }
  `}),Aa=new c.BoxBufferGeometry(10,10,10),rn=function({target:t,value:r,engine:e}){ve.exec(n=>{const s=e.compilerManager.getGeometry(r);return s?(t.geometry=s,!0):(n&&console.warn(`can not found geometry by vid in engine: ${r}`),t.geometry=Aa,!1)})},wt=function({target:t,config:r,engine:e}){ve.exec(n=>{let s;return typeof r.material=="string"?s=e.compilerManager.getMaterial(r.material)||vt:s=r.material.map(o=>e.compilerManager.getMaterial(o)||vt),t.material=s,!(Array.isArray(s)&&s.length&&s[0]===vt||s===vt)})},Ct=function(t,r,e,n){return e.geometry||(t.geometry.dispose(),rn({target:t,value:r.geometry,engine:n})),e.material||wt({target:t,config:r,engine:n}),re(t,r,{geometry:!0,material:!0,...e},n)},Rt=function(t){$(t)},Ye={add:{material:wt,...U.add},set:{geometry:rn,material:wt,...U.set},delete:{material:wt,...U.delete}};var Da=T({configType:u.LINE,commands:Ye,create(t,r){return Ct(new c.Line,t,{},r)},dispose:Rt});class Pa extends bt{constructor(){super();i(this,"MODULE",y.LINE)}}S.processor(Da);const Re={reg:new RegExp("transparent|sizeAttenuation"),handler({target:t,key:r,value:e}){t[r]=e,t.needsUpdate=!0}},nn=function({target:t,key:r,value:e,engine:n}){ve.exec(s=>{const o=n.compilerManager.getObjectBySymbol(e);return o instanceof c.Texture?(t[r]=o,t.needsUpdate=!0,!0):(s&&console.warn(`this url resource is not instance of Texture: ${r}`,e,o),t[r]=null,!1)})},Ge={reg:new RegExp("map$","i"),handler:nn},J=function({target:t,key:r,value:e}){t[r].copy(new c.Color(e))},Ue=function(t,r,e){const n={};for(const s of Object.keys(r))s.toLocaleLowerCase().endsWith("map")&&r[s]?(nn({target:t,key:s,value:r[s],engine:e}),n[s]=!0):t[s]instanceof c.Color&&(t[s]=new c.Color(r[s]),n[s]=!0);return _(r,t,n),t.needsUpdate=!0,t},Te=function(t){t.dispose()};var sn=T({configType:u.LINEBASICMATERIAL,commands:{set:{color:J,$reg:[Ge,Re]}},create:function(t,r){return Ue(new c.LineBasicMaterial,t,r)},dispose:Te}),ja=T({configType:u.MESHBASICMATERIAL,commands:{set:{color:J,$reg:[Ge,Re]}},create:function(t,r){return Ue(new c.MeshBasicMaterial,t,r)},dispose:Te}),Ba=T({configType:u.MESHPHONGMATERIAL,commands:{set:{color:J,emissive:J,specular:J,$reg:[Ge,Re]}},create:function(t,r){return Ue(new c.MeshPhongMaterial,t,r)},dispose:Te}),Ia=T({configType:u.MESHPHYSICALMATERIAL,commands:{set:{color:J,emissive:J,specularColor:J,sheenColor:J,attenuationColor:J,$reg:[Ge,Re]}},create:function(t,r){return Ue(new c.MeshPhysicalMaterial,t,r)},dispose:Te}),Ga=T({configType:u.MESHSTANDARDMATERIAL,commands:{set:{color:J,emissive:J,$reg:[Ge,Re]}},create:function(t,r){return Ue(new c.MeshStandardMaterial,t,r)},dispose:Te}),Ua=T({configType:u.POINTSMATERIAL,commands:{set:{color:J,$reg:[Ge,Re]}},create:function(t,r){return Ue(new c.PointsMaterial,t,r)},dispose:Te});const Ha={name:"uvPulseShader",uniforms:{time:{value:0},width:{value:.5},color:{value:{r:1,g:0,b:0}},center:{value:{x:.5,y:.5}}},vertexShader:`
    varying vec2 vUv;

    void main () {

      vUv = uv;

      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }`,fragmentShader:`
    uniform float width;
    uniform float time;
    uniform vec3 color;
    uniform vec2 center;

    varying vec2 vUv;

    void main () {
      // \u6839\u636EuTime\u6C42\u51FA\u767E\u5206\u6BD4
      float deg = mod(degrees(time), 360.0);
      if (deg > 0.0 && deg < 180.0) {
        discard;
      }

      float percent = cos(time);
      float distancePercent = distance(center, vUv);

      // \u4ECE\u5916\u5411\u91CC
      if (distancePercent > 0.5) {
        discard;
      }

      if (distancePercent < percent) {
        discard;
      }

      if (distancePercent - percent > width) {
        discard;
      }

      float opacity =  (width - (distancePercent - percent)) / width;

      // float opacity = distancePercent;
      gl_FragColor = vec4(color, opacity);
    }`},Na={name:"fragCoordTestingShader",uniforms:{resolution:{value:{x:1920,y:1080}}},vertexShader:`
  void main () {
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }`,fragmentShader:`
    uniform vec2 resolution;

    void main () {
      vec2 st = gl_FragCoord.xy / resolution;
      gl_FragColor = vec4(st.x,st.y,0.0,1.0);
    }`},za={name:"colorMixShader",uniforms:{colorA:{value:{r:1,g:0,b:0}},colorB:{value:{r:0,g:1,b:0}},percent:{value:.5}},vertexShader:`
  void main () {
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }`,fragmentShader:`
    uniform vec3 colorA;
    uniform vec3 colorB;
    uniform float percent;

    void main () {
      gl_FragColor = vec4(mix(colorA, colorB, percent), 1.0);
    }`},Fa={name:"BloomShader",uniforms:{brightness:{value:.8},extend:{value:5},specular:{value:.9},outFade:{value:2},inFade:{value:.3},color:{value:{r:1,g:1,b:1}}},vertexShader:`
  uniform float extend;

  varying vec3 vNormal;
  varying vec3 vView;

  void main () {

    vec3 extendPosition = position + normalize(position) * extend;

    vNormal = normalize(position);
    vView = normalize(cameraPosition - (modelMatrix * vec4(extendPosition , 1.0 )).xyz);

    gl_Position = projectionMatrix * modelViewMatrix * vec4(extendPosition , 1.0 );
  }`,fragmentShader:`
    uniform vec3 color;
    uniform float brightness;
    uniform float specular;
    uniform float outFade;
    uniform float inFade;

    varying vec3 vNormal;
    varying vec3 vView;
    
    void main () {

      float present = smoothstep(0.0, 1.0, dot(vView, vNormal));

      if (present >= specular) {
        present = pow(smoothstep(1.0, specular, present), inFade);
      } else {
        present = pow(smoothstep(0.0, specular, present), outFade);
      }

      gl_FragColor = vec4(color, present * brightness);
    }`},ge=class{static getShader(r){return ge.library.has(r)?ge.cloneShader(ge.library.get(r)):(console.warn(`con not found shader in shader library: ${r}`),null)}static generateConfig(r){if(!ge.library.has(r))return console.warn(`con not found shader in shader library: ${r}`),{};const e=ge.library.get(r),n={shader:r,uniforms:{}};return e.uniforms&&(n.uniforms=JSON.parse(JSON.stringify(e.uniforms))),n}static cloneShader(r){const e={name:r.name};return r.vertexShader&&(e.vertexShader=r.vertexShader),r.fragmentShader&&(e.fragmentShader=r.fragmentShader),r.uniforms&&(e.uniforms=JSON.parse(JSON.stringify(r.uniforms))),e}};let ee=ge;i(ee,"library",new Map),i(ee,"reigster",function(r){ge.library.has(r.name)&&console.warn(`shader library has exist shader: ${r.name} that will be cover.`),ge.library.set(r.name,r)});const ka={name:"defaultShader"};ee.reigster(ka),ee.reigster(Ha),ee.reigster(Na),ee.reigster(za),ee.reigster(Fa);var $a=T({configType:u.SHADERMATERIAL,commands:{set:{shader({target:t,value:r}){const e=ee.getShader(r);e!=null&&e.vertexShader&&(t.vertexShader=e.vertexShader),e!=null&&e.fragmentShader&&(t.fragmentShader=e.fragmentShader),e!=null&&e.uniforms&&(t.uniforms=e.uniforms),e!=null&&e.defines&&(t.defines=e.defines),t.needsUpdate=!0},$reg:[Re]}},create:function(t,r){const e=new c.ShaderMaterial,n=ee.getShader(t.shader);return n!=null&&n.vertexShader&&(e.vertexShader=n.vertexShader),n!=null&&n.fragmentShader&&(e.fragmentShader=n.fragmentShader),n!=null&&n.uniforms&&(e.uniforms=n.uniforms),n!=null&&n.defines&&(e.defines=n.defines),_(t,e,{type:!0,shader:!0}),e.needsUpdate=!0,e},dispose:Te}),Va=T({configType:u.SPRITEMATERIAL,commands:{set:{color:J,$reg:[Ge,Re]}},create:function(t,r){return Ue(new c.SpriteMaterial,t,r)},dispose:Te});class Wa extends S{constructor(){super();i(this,"MODULE",y.MATERIAL)}}S.processor(ja),S.processor(Ga),S.processor(Ba),S.processor(sn),S.processor(Ua),S.processor(Va),S.processor(sn),S.processor($a),S.processor(Ia);var Ya=T({configType:u.MESH,commands:Ye,create(t,r){return Ct(new c.Mesh,t,{},r)},dispose:Rt});class _a extends bt{constructor(){super();i(this,"MODULE",y.MESH)}}S.processor(Ya);var Xa=T({configType:u.OBJECT3D,commands:U,create(t,r){return re(new c.Object3D,t,{},r)},dispose:$});class Qa extends pe{constructor(){super();i(this,"MODULE",y.OBJECT3D)}}S.processor(Xa);var Ka=T({configType:u.SMAAPASS,create(t,r){const e=window.devicePixelRatio;return new Xn.SMAAPass(r.dom?r.dom.offsetWidth*e:window.innerWidth*e,r.dom?r.dom.offsetHeight*e:window.innerWidth*e)},dispose(t){}}),Ja=T({configType:u.UNREALBLOOMPASS,create(t,r){const e=window.devicePixelRatio;return new Qn.UnrealBloomPass(new c.Vector2(r.dom?r.dom.offsetWidth*e:window.innerWidth*e,r.dom?r.dom.offsetHeight*e:window.innerWidth*e),t.strength,t.radius,t.threshold)},dispose(t){t.dispose()}});const Dt=class extends mr.Pass{constructor(e=new c.Vector2(256,256),n=1,s=0,o=0,a=new c.Scene,l=new c.PerspectiveCamera,d){super();i(this,"resolution");i(this,"strength");i(this,"radius");i(this,"threshold");i(this,"selectedObjects",[]);i(this,"renderScene");i(this,"renderCamera");i(this,"clearColor",new c.Color(0,0,0));i(this,"renderTargetsHorizontal",[]);i(this,"renderTargetsVertical",[]);i(this,"nMips",5);i(this,"selectRenderTarget");i(this,"renderTargetBright");i(this,"highPassUniforms");i(this,"materialHighPassFilter");i(this,"separableBlurMaterials",[]);i(this,"compositeMaterial");i(this,"bloomTintColors");i(this,"mixMaterial");i(this,"enabled",!0);i(this,"needsSwap",!1);i(this,"_oldClearColor",new c.Color);i(this,"oldClearAlpha",1);i(this,"basic",new c.MeshBasicMaterial);i(this,"fsQuad",new mr.FullScreenQuad);i(this,"materialCache",new Map);i(this,"sceneBackgroundCache",null);i(this,"overrideBackground",new c.Color("black"));i(this,"overrideMeshMaterial",new c.MeshBasicMaterial({color:"black"}));i(this,"overrideLineMaterial",new c.LineBasicMaterial({color:"black"}));i(this,"overridePointsMaterial",new c.PointsMaterial({color:"black"}));i(this,"overrideSpriteMaterial",new c.SpriteMaterial({color:"black"}));this.resolution=e,this.strength=n,this.radius=s,this.threshold=o,this.renderScene=a,this.renderCamera=l,this.selectedObjects=d;let p=Math.round(this.resolution.x/2),h=Math.round(this.resolution.y/2);this.selectRenderTarget=new c.WebGLRenderTarget(p,h),this.selectRenderTarget.texture.name="UnrealBloomPass.selected",this.selectRenderTarget.texture.generateMipmaps=!1,this.renderTargetBright=new c.WebGLRenderTarget(p,h),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let C=0;C<this.nMips;C++){const D=new c.WebGLRenderTarget(p,h);D.texture.name="UnrealBloomPass.h"+C,D.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(D);const L=new c.WebGLRenderTarget(p,h);L.texture.name="UnrealBloomPass.v"+C,L.texture.generateMipmaps=!1,this.renderTargetsVertical.push(L),p=Math.round(p/2),h=Math.round(h/2)}fr.LuminosityHighPassShader===void 0&&console.error("THREE.UnrealBloomPass relies on LuminosityHighPassShader");const g=fr.LuminosityHighPassShader;this.highPassUniforms=c.UniformsUtils.clone(g.uniforms),this.highPassUniforms.luminosityThreshold.value=o,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new c.ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:g.vertexShader,fragmentShader:g.fragmentShader,defines:{}});const R=[3,5,7,9,11];p=Math.round(this.resolution.x/2),h=Math.round(this.resolution.y/2);for(let C=0;C<this.nMips;C++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(R[C])),this.separableBlurMaterials[C].uniforms.texSize.value=new c.Vector2(p,h),p=Math.round(p/2),h=Math.round(h/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=n,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;const M=[1,.8,.6,.4,.2];this.compositeMaterial.uniforms.bloomFactors.value=M,this.bloomTintColors=[new c.Vector3(1,1,1),new c.Vector3(1,1,1),new c.Vector3(1,1,1),new c.Vector3(1,1,1),new c.Vector3(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,this.mixMaterial=this.getMixMaterial()}dispose(){for(let e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose()}setSize(e,n){let s=Math.round(e/2),o=Math.round(n/2);this.selectRenderTarget.setSize(s,o),this.renderTargetBright.setSize(s,o);for(let a=0;a<this.nMips;a++)this.renderTargetsHorizontal[a].setSize(s,o),this.renderTargetsVertical[a].setSize(s,o),this.separableBlurMaterials[a].uniforms.texSize.value=new c.Vector2(s,o),s=Math.round(s/2),o=Math.round(o/2)}render(e,n,s,o,a){if(!this.selectedObjects.length){this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=s.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e));return}e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const l=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),a&&e.state.buffers.stencil.setTest(!1);const d=new Map;for(const g of this.selectedObjects)d.set(g,!0);const p=this.materialCache;this.renderScene.background&&(this.sceneBackgroundCache=this.renderScene.background,this.renderScene.background=this.overrideBackground),this.renderScene.traverse(g=>{!d.has(g)&&!g.isLight&&g.visible&&(p.set(g,g.material),g instanceof c.Mesh?g.material=this.overrideMeshMaterial:g instanceof c.Line?g.material=this.overrideLineMaterial:g instanceof c.Points?g.material=this.overridePointsMaterial:g instanceof c.Sprite&&(g.material=this.overrideSpriteMaterial))}),e.setRenderTarget(this.selectRenderTarget),e.clear(),e.render(this.renderScene,this.renderCamera),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=this.selectRenderTarget.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=this.selectRenderTarget.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);let h=this.renderTargetBright;for(let g=0;g<this.nMips;g++)this.fsQuad.material=this.separableBlurMaterials[g],this.separableBlurMaterials[g].uniforms.colorTexture.value=h.texture,this.separableBlurMaterials[g].uniforms.direction.value=Dt.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[g]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[g].uniforms.colorTexture.value=this.renderTargetsHorizontal[g].texture,this.separableBlurMaterials[g].uniforms.direction.value=Dt.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[g]),e.clear(),this.fsQuad.render(e),h=this.renderTargetsVertical[g];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.mixMaterial,this.mixMaterial.uniforms.bloom.value=this.renderTargetsHorizontal[0].texture,this.mixMaterial.uniforms.origin.value=s.texture,a&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(s),this.fsQuad.render(e)),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=l;for(const g of p.entries())g[0].material=g[1];p.clear(),this.sceneBackgroundCache&&(this.renderScene.background=this.sceneBackgroundCache,this.sceneBackgroundCache=null)}getMixMaterial(){return new c.ShaderMaterial({blending:c.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0,uniforms:{bloom:{value:null},origin:{value:null}},vertexShader:`
    
        varying vec2 vUv;
    
        void main() {
    
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
    
        }`,fragmentShader:`
        uniform sampler2D bloom;
        uniform sampler2D origin;
    
        varying vec2 vUv;
    
        void main() {
          vec3 bloomColor = texture2D(bloom, vUv).rgb;
          vec3 originColor = texture2D(origin, vUv).rgb;
          gl_FragColor = vec4(originColor + bloomColor, 1.0);
        }`})}getSeperableBlurMaterial(e){return new c.ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new c.Vector2(.5,.5)},direction:{value:new c.Vector2(.5,.5)}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 texSize;
				uniform vec2 direction;

				float gaussianPdf(in float x, in float sigma) {
					return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;
				}
				void main() {
					vec2 invSize = 1.0 / texSize;
					float fSigma = float(SIGMA);
					float weightSum = gaussianPdf(0.0, fSigma);
					vec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;
					for( int i = 1; i < KERNEL_RADIUS; i ++ ) {
						float x = float(i);
						float w = gaussianPdf(x, fSigma);
						vec2 uvOffset = direction * invSize * x;
						vec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;
						vec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;
						diffuseSum += (sample1 + sample2) * w;
						weightSum += 2.0 * w;
					}
					gl_FragColor = vec4(diffuseSum/weightSum, 1.0);
				}`})}getCompositeMaterial(e){return new c.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;
				uniform sampler2D blurTexture1;
				uniform sampler2D blurTexture2;
				uniform sampler2D blurTexture3;
				uniform sampler2D blurTexture4;
				uniform sampler2D blurTexture5;
				uniform float bloomStrength;
				uniform float bloomRadius;
				uniform float bloomFactors[NUM_MIPS];
				uniform vec3 bloomTintColors[NUM_MIPS];

				float lerpBloomFactor(const in float factor) {
					float mirrorFactor = 1.2 - factor;
					return mix(factor, mirrorFactor, bloomRadius);
				}

				void main() {
					gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +
						lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +
						lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +
						lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +
						lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );
				}`})}};let _e=Dt;i(_e,"BlurDirectionX",new c.Vector2(1,0)),i(_e,"BlurDirectionY",new c.Vector2(0,1));var qa=T({configType:u.SELECTIVEBLOOMPASS,commands:{add:{selectedObjects({target:t,engine:r,value:e}){const n=r.compilerManager.getObject3D(e);n?t.selectedObjects.push(n):console.warn(`selectiveBloomPassProcessor: can not found vid in engine: ${e}`)}},set:{renderScene({target:t,engine:r,value:e}){const n=r.compilerManager.getObject3D(e);n instanceof c.Scene&&(t.renderScene=n)},renderCamera({target:t,engine:r,value:e}){const n=r.compilerManager.getObject3D(e);n instanceof c.Camera&&(t.renderCamera=n)},selectedObjects({target:t,config:r,engine:e}){const n=r.selectedObjects.map(s=>{const o=e.compilerManager.getObject3D(s);if(o)return o;console.warn(`selectiveBloomPassProcessor: can not found vid in engine: ${s}`)}).filter(s=>s);t.selectedObjects=n}},delete:{selectedObjects({target:t,engine:r,value:e}){const n=r.compilerManager.getObject3D(e);n?t.selectedObjects.includes(n)&&t.selectedObjects.splice(t.selectedObjects.indexOf(n),1):console.warn(`selectiveBloomPassProcessor: can not found vid in engine: ${e}`)}}},create(t,r){const e=[];for(const o of t.selectedObjects){const a=r.compilerManager.getObject3D(o);a&&e.push(a)}const n=window.devicePixelRatio;return new _e(new c.Vector2(r.dom?r.dom.offsetWidth*n:window.innerWidth*n,r.dom?r.dom.offsetHeight*n:window.innerWidth*n),t.strength,t.radius,t.threshold,t.renderScene&&r.compilerManager.getObject3D(t.renderScene)||void 0,t.renderCamera&&r.compilerManager.getObject3D(t.renderCamera)||void 0,e)},dispose(t){t.dispose()}});class Za extends S{constructor(){super();i(this,"MODULE",y.PASS);i(this,"composer")}useEngine(e){return super.useEngine(e),e.effectComposer?(this.composer=e.effectComposer,this):(console.warn("engine need install effectComposer plugin that can use pass compiler."),this)}add(e){const n=super.add(e);return n&&this.composer.addPass(n),n}remove(e){if(!this.map.has(e.vid))return console.warn(`PassCompiler can not found this vid pass: ${e.vid}.`),this;const n=this.map.get(e.vid);return this.composer.removePass(n),super.remove(e),this}}S.processor(Ka),S.processor(Ja),S.processor(qa);var ec=T({configType:u.POINTS,commands:Ye,create(t,r){return Ct(new c.Points,t,{},r)},dispose:Rt});class tc extends bt{constructor(){super();i(this,"MODULE",y.POINTS)}}S.processor(ec);var rc=T({configType:u.WEBGLRENDERER,commands:{set:{size({target:t,config:r}){r.size?t.setSize(r.size.x,r.size.y):t.setSize(t.domElement.offsetWidth,t.domElement.offsetHeight)},clearColor({target:t,value:r}){const e=Number(r.slice(0,-1).split(",").pop().trim());t.setClearColor(r,e),t.clear()},viewport({target:t,config:r}){const e=r.viewport;if(e)t.setViewport(e.x,e.y,e.width,e.height);else{const n=t.domElement;t.setViewport(0,0,n.offsetWidth,n.offsetHeight)}},scissor({target:t,config:r}){const e=r.scissor;if(e)t.setScissorTest(!0),t.setScissor(e.x,e.y,e.width,e.height);else{t.setScissorTest(!1);const n=t.domElement;t.setScissor(0,0,n.offsetWidth,n.offsetHeight)}},pixelRatio({target:t,value:r}){t.setPixelRatio(r),t.clear()}}},create(t,r){let e;if(r.webGLRenderer?e=r.webGLRenderer:e=new c.WebGLRenderer,t.size&&e.setSize(t.size.x,t.size.y),t.clearColor){const n=Number(t.clearColor.slice(0,-1).split(",").pop().trim());e.setClearColor(t.clearColor,n)}if(t.viewport){const n=t.viewport;e.setViewport(n.x,n.y,n.width,n.height)}if(t.scissor){const n=t.scissor;e.setScissorTest(!0),e.setScissor(n.x,n.y,n.width,n.height)}return t.pixelRatio&&e.setPixelRatio(t.pixelRatio),_(t,e,{size:!0,clearColor:!0,viewport:!0,scissor:!0,pixelRatio:!0}),e},dispose(t){t.clear(),t.dispose()}}),nc=T({configType:u.CSS3DRENDERER,commands:{set:{size({target:t,config:r}){r.size?t.setSize(r.size.x,r.size.y):t.setSize(t.domElement.offsetWidth,t.domElement.offsetHeight)}}},create(t,r){let e;return r.css3DRenderer?e=r.css3DRenderer:e=new Se.CSS3DRenderer,t.size&&e.setSize(t.size.x,t.size.y),_(t,e,{size:!0}),e},dispose(t){}});class sc extends S{constructor(){super();i(this,"MODULE",y.RENDERER)}useEngine(e){return e.webGLRenderer&&(this.map.set(z(u.WEBGLRENDERER),e.webGLRenderer),this.weakMap.set(e.webGLRenderer,z(u.WEBGLRENDERER))),e.css3DRenderer&&(this.map.set(z(u.CSS3DRENDERER),e.css3DRenderer),this.weakMap.set(e.css3DRenderer,z(u.CSS3DRENDERER))),super.useEngine(e)}}S.processor(rc),S.processor(nc);const on=function(t,r,e){if(!r){t.background=null;return}if(Z.validate(r)){const n=e.compilerManager.getTexture(r);n?t.background=n:console.warn(`engine can not found this vid texture : '${r}'`)}else t.background=new c.Color(r)},an=function(t,r,e){if(!r){t.environment=null;return}if(Z.validate(r)){const n=e.compilerManager.getTexture(r);n?t.environment=n:console.warn(`engine can not found this vid texture : '${r}'`)}else console.warn(`scene environment is illeage: ${r}`)};var oc=T({configType:u.SCENE,commands:{add:U.add,set:{...U.set,lookAt(){},fog({target:t,config:r,key:e,value:n}){const s=r.fog;s.type?s.type==="Fog"?!t.fog||!(t.fog instanceof c.Fog)?t.fog=new c.Fog(s.color,s.near,s.far):e==="color"?t.fog.color.copy(new c.Color(s.color)):t.fog[e]&&(t.fog[e]=n):s.type==="FogExp2"&&(!t.fog||!(t.fog instanceof c.FogExp2)?t.fog=new c.FogExp2(s.color,s.density):e==="color"?t.fog.color.copy(new c.Color(s.color)):t.fog[e]&&(t.fog[e]=n)):t.fog=null},background({target:t,value:r,engine:e}){on(t,r,e)},environment({target:t,value:r,engine:e}){an(t,r,e)}},delete:U.delete},create(t,r){const e=new c.Scene;if(on(e,t.background,r),an(e,t.environment,r),t.fog.type){const n=t.fog;n.type==="Fog"?e.fog=new c.Fog(n.color,n.near,n.far):n.type==="FogExp2"?e.fog=new c.FogExp2(n.color,n.density):console.warn(`scene processor can not support this type fog:'${t.type}'`)}return re(e,t,{lookAt:!0,background:!0,environment:!0,fog:!0},r)},dispose:$});class ic extends pe{constructor(){super();i(this,"MODULE",y.SCENE)}}S.processor(oc);const cn=new c.SpriteMaterial({color:"rgb(123, 123, 123)"});var ac=T({configType:u.SPRITE,commands:{add:Ye.add,set:{lookAt(){},...Ye.set,material({target:t,engine:r,value:e}){const n=r.compilerManager.getMaterial(e);n&&n instanceof c.SpriteMaterial?t.material=n:t.material=cn}},delete:Ye.add},create(t,r){const e=new c.Sprite,n=r.compilerManager.getMaterial(t.material);return n&&n instanceof c.SpriteMaterial?e.material=n:e.material=cn,Ct(e,t,{geometry:!0,material:!0,lookAt:!0},r)},dispose:Rt});class cc extends bt{constructor(){super();i(this,"MODULE",y.SPRITE)}}S.processor(ac);class lc extends c.Texture{constructor(r,e,n,s,o,a,l,d,p,h){super(r,e,n,s,o,a,l,d,p,h)}}const Tt={reg:new RegExp("wrapS|wrapT|format|encoding|anisotropy|magFilter|minFilter|mapping"),handler({target:t,key:r,value:e}){t[r]=e,t.needsUpdate=!0}},Xe=function({target:t,value:r,engine:e}){ve.exec(n=>(t.image=e.compilerManager.textureCompiler.getResource(r,[HTMLImageElement,HTMLVideoElement,HTMLCanvasElement]),t.needsUpdate=!0,t.images!==it.replaceImage))};var uc=T({configType:u.IMAGETEXTURE,commands:{set:{url:Xe,$reg:[Tt]}},create(t,r){const e=new lc;return t.url&&Xe({target:e,value:t.url,engine:r}),_(t,e,{type:!0,url:!0}),e.needsUpdate=!0,e},dispose(t){t.dispose()}}),dc=T({configType:u.CANVASTEXTURE,commands:{set:{url:Xe,$reg:[Tt]}},create(t,r){const e=new c.CanvasTexture(r.compilerManager.textureCompiler.getResource(t.url,HTMLCanvasElement));return Xe({target:e,value:t.url,engine:r}),_(t,e,{type:!0,url:!0}),e.needsUpdate=!0,e},dispose(t){t.dispose()}});const He=[HTMLImageElement,HTMLVideoElement,HTMLCanvasElement],Qe=function({target:t,index:r,value:e,engine:n}){t.images[r]=n.compilerManager.textureCompiler.getResource(e,He),t.needsUpdate=!0};var hc=T({configType:u.CUBETEXTURE,commands:{set:{cube:{px({target:t,value:r,engine:e}){Qe({target:t,value:r,engine:e,index:0})},nx({target:t,value:r,engine:e}){Qe({target:t,value:r,engine:e,index:1})},py({target:t,value:r,engine:e}){Qe({target:t,value:r,engine:e,index:2})},ny({target:t,value:r,engine:e}){Qe({target:t,value:r,engine:e,index:3})},pz({target:t,value:r,engine:e}){Qe({target:t,value:r,engine:e,index:4})},nz({target:t,value:r,engine:e}){Qe({target:t,value:r,engine:e,index:5})}}}},create(t,r){const e=new c.CubeTexture,n=t.cube,s=r.compilerManager.textureCompiler,o=[s.getResource(n.px,He),s.getResource(n.nx,He),s.getResource(n.py,He),s.getResource(n.ny,He),s.getResource(n.pz,He),s.getResource(n.nz,He)];return e.image=o,_(t,e,{type:!0,cube:!0}),e.needsUpdate=!0,e},dispose(t){t.dispose()}});class pc extends c.Texture{constructor(e,n,s,o,a,l,d,p,h){super(e,n,s,o,a,l,d,p,h);i(this,"isVideoTexture",!0);this.format=d!==void 0?d:c.RGBFormat,this.minFilter=l!==void 0?l:c.LinearFilter,this.magFilter=a!==void 0?a:c.LinearFilter,this.generateMipmaps=!1}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image,n="requestVideoFrameCallback"in e;n?this.needsUpdate=!0:n===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}var mc=T({configType:u.VIDEOTEXTURE,commands:{set:{url:Xe,$reg:[Tt]}},create(t,r){const e=new pc(document.createElement("video"));return t.url&&Xe({target:e,value:t.url,engine:r}),_(t,e,{type:!0,url:!0}),e.needsUpdate=!0,e},dispose(t){t.dispose()}});class ot{constructor(r){i(this,"canvas");this.canvas=document.createElement("canvas");const e=window.devicePixelRatio;this.canvas.width=((r==null?void 0:r.width)||512)*e,this.canvas.height=((r==null?void 0:r.height)||512)*e,this.canvas.style.backgroundColor=(r==null?void 0:r.bgColor)||"rgb(255, 255, 255)";const n=this.canvas.getContext("2d");n&&n.scale(window.devicePixelRatio,window.devicePixelRatio)}get(){return this.canvas}getDom(){return this.canvas}clear(r=0,e=0,n,s){!n&&(n=this.canvas.width),!s&&(s=this.canvas.height);const o=this.canvas.getContext("2d");return o?(o.clearRect(r,e,n,s),this):(console.warn("you browser can not support canvas 2d"),this)}draw(r){const e=this.canvas.getContext("2d");return e?(r(e),this):(console.warn("you browser can not support canvas 2d"),this)}preview(r){const e=this.canvas;return e.style.position="fixed",e.style.top=(r==null?void 0:r.top)||"5%",e.style.left=(r==null?void 0:r.left)||"5%",e.style.right=(r==null?void 0:r.right)||"unset",e.style.bottom=(r==null?void 0:r.bottom)||"unset",r!=null&&r.scale&&(e.style.transform=`scale(${r.scale})`),document.body.appendChild(this.canvas),this}}class ln extends c.Texture{constructor(r){super(),Object.keys(r).forEach(e=>{this[e]=r[e]}),this.copy(r)}}var fc=T({configType:u.LOADTEXTURE,commands:{set:{url({}){},$reg:[Tt]}},create(t,r){let e;const n=r.compilerManager.textureCompiler.getResource(t.url,c.Texture);if(n instanceof c.Texture)e=new ln(n);else{const s=new c.Texture(n);e=new ln(s)}return _(t,e,{type:!0,url:!0}),e.needsUpdate=!0,e},dispose(t){t.dispose()}});const ut=class extends S{constructor(){super();i(this,"MODULE",y.TEXTURE)}getResource(e,n){const s=this.engine.resourceManager.resourceMap;if(!s.has(e))return console.warn(`engine resourceManager can not found this url: ${e}`),ut.replaceImage;const o=s.get(e);if(Array.isArray(n)){for(const a of n)if(o instanceof a)return o;return console.warn(`this url mapping resource is not a texture image class: ${e}`,o),ut.replaceImage}else return o instanceof n?o:(console.warn(`this url mapping resource is not a texture image class: ${e}`,o),ut.replaceImage)}};let it=ut;i(it,"replaceImage",new ot({width:512,height:512}).draw(e=>{e.translate(256,256),e.font="72px",e.fillStyle="white",e.fillText("\u6682\u65E0\u56FE\u7247",0,0)}).getDom()),S.processor(uc),S.processor(dc),S.processor(hc),S.processor(mc),S.processor(fc);class gc extends Ut.CSS2DObject{constructor(e=document.createElement("div")){const n=document.createElement("div"),s=50,o=50;n.style.width=`${s}px`,n.style.height=`${o}px`,n.appendChild(e);super(n);i(this,"geometry");i(this,"_width");i(this,"_height");this.geometry=new c.PlaneBufferGeometry(s,o),this.geometry.computeBoundingBox(),this._width=s,this._height=o}get width(){return this._width}set width(e){this.geometry.dispose(),this.geometry=new c.PlaneBufferGeometry(e,this._height),this.geometry.computeBoundingBox(),this.element.style.width=`${e}px`,this._width=e}get height(){return this._height}set height(e){this.geometry.dispose(),this.geometry=new c.PlaneBufferGeometry(this._width,e),this.geometry.computeBoundingBox(),this.element.style.height=`${e}px`,this._height=e}}class yc extends gc{constructor(e=document.createElement("div")){super(e);i(this,"cacheBox",new c.Box3);i(this,"viewWorldMatrix",new c.Matrix4);i(this,"mvPosition",new c.Vector3);i(this,"matrixScale",new c.Vector3);i(this,"worldScale",new c.Vector3);i(this,"vA",new c.Vector3);i(this,"vB",new c.Vector3);i(this,"vC",new c.Vector3);i(this,"alignedPosition",new c.Vector2);i(this,"rotatedPosition",new c.Vector2);i(this,"intersectPoint",new c.Vector3);this.type="CSS2DPlane",this.element.classList.add("vis-css2d","vis-css2d-plane"),new MutationObserver(()=>{this.matrixScale.set(Math.abs(this.width/100)*.1,Math.abs(this.height/100)*.1,1)}).observe(this.element,{attributeFilter:["style"]})}transformVertex(e,n,s){const o=this.alignedPosition,a=this.rotatedPosition,l=0,d=1;o.copy(e).multiply(s),a.x=d*o.x-l*o.y,a.y=l*o.x+d*o.y,e.copy(n),e.x+=a.x,e.y+=a.y,e.applyMatrix4(this.viewWorldMatrix)}raycast(e,n){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),this.viewWorldMatrix.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),this.mvPosition.setFromMatrixPosition(this.modelViewMatrix),this.worldScale.copy(this.matrixScale).multiplyScalar(-this.mvPosition.z),this.transformVertex(this.vA.set(-.5,-.5,0),this.mvPosition,this.worldScale),this.transformVertex(this.vB.set(.5,-.5,0),this.mvPosition,this.worldScale),this.transformVertex(this.vC.set(.5,.5,0),this.mvPosition,this.worldScale);let s=e.ray.intersectTriangle(this.vA,this.vB,this.vC,!1,this.intersectPoint);if(s===null&&(this.transformVertex(this.vB.set(-.5,.5,0),this.mvPosition,this.worldScale),s=e.ray.intersectTriangle(this.vA,this.vC,this.vB,!1,this.intersectPoint),s===null))return;const o=e.ray.origin.distanceTo(this.intersectPoint);o<e.near||o>e.far||n.push({distance:o,point:this.intersectPoint.clone(),face:null,object:this})}}const un=function(t,r){const e=r.resourceManager.resourceMap;if(!e.has(t))return console.warn(`css2D compiler: can not found resource element: ${t}`),document.createElement("div");const n=e.get(t);return n instanceof HTMLElement?n:(console.warn("css2D compiler can not suport render this resource type.",n.constructor,t),document.createElement("div"))};var Ec=T({configType:u.CSS2DPLANE,commands:{add:U.add,set:{element({target:t,value:r,engine:e}){t.element.innerHTML="",t.element.appendChild(un(r,e))},...U.set},delete:U.delete},create(t,r){return re(new yc(un(t.element,r)),t,{element:!0},r)},dispose:$});class Sc extends pe{constructor(){super();i(this,"MODULE",y.CSS2D)}}S.processor(Ec);class Mc extends te{constructor(e){super();i(this,"object3DCompiler",new Qa);i(this,"cameraCompiler",new Wi);i(this,"lightCompiler",new Oa);i(this,"geometryCompiler",new Sa);i(this,"textureCompiler",new it);i(this,"materialCompiler",new Wa);i(this,"rendererCompiler",new sc);i(this,"sceneCompiler",new ic);i(this,"controlsCompiler",new Xi);i(this,"spriteCompiler",new cc);i(this,"lineCompiler",new Pa);i(this,"meshCompiler",new _a);i(this,"pointsCompiler",new tc);i(this,"groupCompiler",new ba);i(this,"css3DCompiler",new ta);i(this,"css2DCompiler",new Sc);i(this,"passCompiler",new Za);i(this,"animationCompiler",new si);i(this,"compilerMap");e&&Object.keys(e).forEach(s=>{this[s]=e[s]});const n=new Map;Object.keys(this).forEach(s=>{const o=this[s];o instanceof S&&n.set(o.MODULE,o)}),this.compilerMap=n}support(e){this.compilerMap.forEach(s=>{s.useEngine(e)});const n=e.dataSupportManager;for(const s of Object.values(y))n[`${s}DataSupport`].addCompiler(this[`${s}Compiler`]);return this}getObjectSymbol(e){for(const n of this.compilerMap.values()){const s=n.getObjectSymbol(e);if(s)return s}return null}getObjectBySymbol(e){for(const n of this.compilerMap.values()){const s=n.getObjectBySymbol(e);if(s)return s}return null}getObject3D(e){for(const n of this.compilerMap.values())if(n instanceof pe&&n.map.has(e))return n.map.get(e);return null}getGeometry(e){return this.geometryCompiler.map.get(e)||null}getMaterial(e){return this.materialCompiler.map.get(e)||null}getTexture(e){return this.textureCompiler.map.get(e)||null}dispose(){for(const e of this.compilerMap.values())e.dispose();return this.compilerMap.clear(),this}}const bc=function(t){if(this.compilerManager)return console.warn("engine has installed compilerManager plugin."),!1;if(!this.dataSupportManager)return console.warn("must install dataSupportManager before compilerManager plugin."),!1;if(!this.renderManager)return console.warn("must install renderManager before compilerManager plugin."),!1;const r=new Mc;return this.compilerManager=r,this.getObjectSymbol=function(e){return this.compilerManager.getObjectSymbol(e)},this.getObjectBySymbol=function(e){return this.compilerManager.getObjectBySymbol(e)},this.addEventListener("dispose",()=>{this.compilerManager.dispose()}),this.completeSet.add(()=>{this.compilerManager.support(this)}),!0};class dn extends te{constructor(){super();i(this,"map",new Map)}generateSymbol(e){return Array.isArray(e)?e.join(" + "):e.shortcutKey.join(" + ")}watch(e){return e?dt.default.watch(void 0,e):dt.default.watch(),this}register(e){const n=this.generateSymbol(e);return this.map.has(n)?(console.warn(`KeyboardManager: shortcutKey already exist: ${n}. desp: ${this.map.get(n).desp}`),this):(dt.default.bind(n,e.keydown||null,e.keyup),this.map.set(n,e),this)}update(e){const n=this.generateSymbol(e);return this.map.has(n)?(this.cancel(e.shortcutKey),this.register(e),this):(console.warn("KeyboardManager: shortcutKey unregister then exec register function"),this.register(e),this)}cancel(e){const n=this.generateSymbol(e);if(this.map.has(n)){const s=this.map.get(n);dt.default.unbind(n,s.keydown||null,s.keyup),this.map.delete(n)}return this}checkRepeat(e){const n=this.generateSymbol(e);return this.map.has(n)}getDocs(){const e=[];return this.map.forEach(n=>{e.push({shortcutKey:[].concat(n.shortcutKey),desp:n.desp})}),e}}const vc=function(t){if(this.keyboardManager)return console.warn("engine has installed keyboardManager plugin."),!1;const r=new dn;return this.keyboardManager=r,this.completeSet.add(()=>{if(this.transformControls){const e=()=>this.dataSupportManager.controlsDataSupport.getData()[u.TRNASFORMCONTROLS]||this.transformControls;this.IS_ENGINESUPPORT?r.register({shortcutKey:["shift"],desp:"\u53D8\u6362\u63A7\u5236\u5668\u9501\u5B9A\u6B65\u5E45",keyup:n=>{n==null||n.preventDefault();const s=e();s&&(s.snapAllow=!1)},keydown:n=>{n==null||n.preventDefault(),n==null||n.preventRepeat();const s=e();s&&(s.snapAllow=!0)}}):r.register({shortcutKey:["shift"],desp:"\u53D8\u6362\u63A7\u5236\u5668\u9501\u5B9A\u6B65\u5E45",keyup:n=>{n==null||n.preventDefault();const s=e();s.translationSnap=null,s.rotationSnap=null,s.scaleSnap=null},keydown:n=>{n==null||n.preventDefault(),n==null||n.preventRepeat();const s=e();s.translationSnap=5,s.rotationSnap=Math.PI/180*10,s.scaleSnap=.1}}),r.register({shortcutKey:["r"],desp:"\u53D8\u6362\u63A7\u5236\u5668\u6A21\u5F0F\uFF1A\u65CB\u8F6C",keyup:n=>{n==null||n.preventDefault();const s=e();s&&(s.mode="rotate")}}).register({shortcutKey:["t"],desp:"\u53D8\u6362\u63A7\u5236\u5668\u6A21\u5F0F\uFF1A\u79FB\u52A8",keyup:n=>{n==null||n.preventDefault();const s=e();s&&(s.mode="translate")}}).register({shortcutKey:["e"],desp:"\u53D8\u6362\u63A7\u5236\u5668\u6A21\u5F0F\uFF1A\u7F29\u653E",keyup:n=>{n==null||n.preventDefault();const s=e();s.mode="scale"}}).register({shortcutKey:["x"],desp:"\u53D8\u6362\u63A7\u5236\u5668\u5207\u6362\u8F74\uFF1Ax",keyup:n=>{n==null||n.preventDefault();const s=e();s.showX=!s.showX}}).register({shortcutKey:["y"],desp:"\u53D8\u6362\u63A7\u5236\u5668\u5207\u6362\u8F74\uFF1Ay",keyup:n=>{if(n==null||n.preventDefault(),n!=null&&n.ctrlKey)return;const s=e();s.showY=!s.showY}}).register({shortcutKey:["z"],desp:"\u53D8\u6362\u63A7\u5236\u5668\u5207\u6362\u8F74\uFF1Az",keyup:n=>{if(n==null||n.preventDefault(),n!=null&&n.ctrlKey)return;const s=e();s.showZ=!s.showZ}}).register({shortcutKey:["space"],desp:"\u53D8\u6362\u63A7\u5236\u5668\u5207\u6362\u53D8\u6362\u7A7A\u95F4",keyup:n=>{n==null||n.preventDefault();const s=e();s.space=s.space==="local"?"world":"local"}})}}),!0},wc=function(t={}){if(!this.scene)return console.error("must install some scene plugin before BasicViewpoint plugin."),!1;const r=new c.AxesHelper(t.length||500);return r.matrixAutoUpdate=!1,r.raycast=()=>{},this.scene.add(r),this.setAxesHelper=function(e){return e.show?this.scene.add(r):this.scene.remove(r),this},this.addEventListener("setScene",e=>{e.scene.add(r)}),!0},Cc=function(t={}){if(!this.scene)return console.error("must install some scene before BasicViewpoint plugin."),!1;const r=new c.GridHelper(t.range||500,t.spacing||50,t.axesColor||"rgb(130, 130, 130)",t.cellColor||"rgb(70, 70, 70)");if(t.opacity!==1){const e=r.material;e.transparent=!0,e.opacity=t.opacity||.5,e.needsUpdate=!0}return r.matrixAutoUpdate=!1,r.raycast=()=>{},this.scene.add(r),this.setGridHelper=function(e){return e.show?this.scene.add(r):this.scene.remove(r),this},this.addEventListener("setScene",e=>{e.scene.add(r)}),this.completeSet.add(()=>{this.setViewpoint&&this.addEventListener("setViewpoint",e=>{const n=e.viewpoint;n===Y.DEFAULT||n===Y.TOP||n===Y.BOTTOM?r.rotation.set(0,0,0):n===Y.RIGHT||n===Y.LEFT?r.rotation.set(0,0,Math.PI/2):(n===Y.FRONT||n===Y.BACK)&&r.rotation.set(Math.PI/2,0,0),r.updateMatrix(),r.updateMatrixWorld()})}),!0};var hn=(t=>(t.GEOMETRY="geometry",t.MATERIAL="material",t.LIGHT="light",t.ENV="env",t))(hn||{});const Rc=function(t={}){if(!this.webGLRenderer)return console.error("must install some renderer before DisplayModel plugin."),!1;if(!this.scene)return console.error("must install some scene before DisplayModel plugin."),!1;!t.overrideColor&&(t.overrideColor="rgb(250, 250, 250)"),!t.defaultAmbientLightSetting&&(t.defaultAmbientLightSetting={}),!t.defaultAmbientLightSetting.color&&(t.defaultAmbientLightSetting.color="rgb(255, 255, 255)"),!t.defaultAmbientLightSetting.intensity&&(t.defaultAmbientLightSetting.intensity=.5);const r=new c.AmbientLight(t.defaultAmbientLightSetting.color,t.defaultAmbientLightSetting.intensity);r.matrixAutoUpdate=!1,!t.defaultDirectionalLightSetting&&(t.defaultDirectionalLightSetting={}),!t.defaultDirectionalLightSetting.color&&(t.defaultDirectionalLightSetting.color="rgb(255, 255, 255)"),!t.defaultDirectionalLightSetting.intensity&&(t.defaultDirectionalLightSetting.intensity=.5),!t.defaultDirectionalLightSetting.position&&(t.defaultDirectionalLightSetting.position={x:-100,y:100,z:100});const e=new c.DirectionalLight(t.defaultDirectionalLightSetting.color,t.defaultDirectionalLightSetting.intensity);e.castShadow=!1,e.position.set(t.defaultDirectionalLightSetting.position.x,t.defaultDirectionalLightSetting.position.y,t.defaultDirectionalLightSetting.position.z),e.updateMatrix(),e.updateMatrixWorld(),e.matrixAutoUpdate=!1,!t.mode&&(t.mode="env"),this.displayMode=t.mode;const n=new c.MeshLambertMaterial({color:t.overrideColor}),s=new c.LineBasicMaterial({color:t.overrideColor}),o=new c.PointsMaterial({color:t.overrideColor,size:5,sizeAttenuation:!1}),a=new c.SpriteMaterial({color:t.overrideColor}),l=new WeakMap,d=new Set,p=new Set,h=new Set,g=new Set,R=new Set;let M,C;const D={Object3D:!0,Group:!0};this.scene.addEventListener("afterAdd",E=>{const H=this.displayMode,j=E.objects;for(const P of j)if(!D[P.type])if(P instanceof c.Mesh&&P.type==="Mesh")p.add(P),H==="geometry"&&(l.set(P,P.material),P.material=n);else if(P instanceof c.Line&&P.type.includes("Line"))h.add(P),H==="geometry"&&(l.set(P,P.material),P.material=s);else if(P instanceof c.Light&&P.type.includes("Light")){if(P===r||P===e)continue;d.has(P)||d.add(P),H!=="env"&&H!=="light"&&this.scene.remove(P)}else P instanceof c.Points&&P.type==="Points"?(g.add(P),H==="geometry"&&(l.set(P,P.material),P.material=o)):P instanceof c.Sprite&&P.type==="Sprite"&&(R.add(P),H==="geometry"&&(l.set(P,P.material),P.material=a))}),this.scene.addEventListener("afterRemove",E=>{const H=E.objects;for(const j of H)if(!D[j.type])if(j instanceof c.Mesh&&j.type==="Mesh")p.delete(j),l.has(j)&&l.delete(j);else if(j instanceof c.Line&&j.type.includes("Line"))h.delete(j),l.has(j)&&l.delete(j);else if(j instanceof c.Light&&j.type.includes("Light")){if(j===r||j===e)continue;d.delete(j)}else j instanceof c.Points&&j.type==="Points"?(g.delete(j),l.has(j)&&l.delete(j)):j instanceof c.Sprite&&j.type==="Sprite"&&(R.delete(j),l.has(j)&&l.delete(j))});const L=()=>{for(const E of p)E.material!==n&&(l.set(E,E.material),E.material=n);for(const E of h)E.material!==s&&(l.set(E,E.material),E.material=s);for(const E of g)E.material!==o&&(l.set(E,E.material),E.material=o);for(const E of R)E.material!==a&&(l.set(E,E.material),E.material=a)},b=()=>{p.forEach(E=>{l.has(E)&&(E.material=l.get(E),l.delete(E))}),h.forEach(E=>{l.has(E)&&(E.material=l.get(E),l.delete(E))}),g.forEach(E=>{l.has(E)&&(E.material=l.get(E),l.delete(E))}),R.forEach(E=>{l.has(E)&&(E.material=l.get(E),l.delete(E))})},v=()=>{d.forEach(E=>{E.visible=!1}),this.scene.add(r),this.scene.add(e)},A=()=>{d.forEach(E=>{E.visible=!0}),this.scene.remove(r),this.scene.remove(e)},W=()=>{this.scene.background instanceof c.Texture&&(M=this.scene.background,this.scene.background=null),this.scene.environment instanceof c.Texture&&(C=this.scene.environment,this.scene.environment=null)},O=()=>{M&&(this.scene.background=M,M=void 0),C&&(this.scene.environment=C,C=void 0)};return this.setDisplayMode=function(E){return this.displayMode=E||"env",E==="geometry"?(L(),W(),v()):E==="material"?(b(),W(),v()):E==="light"?(b(),W(),A()):E==="env"?(b(),O(),A()):console.warn(`displayMode plugin can not set this mode: ${E}`),this},this.completeSet.add(()=>{this.objectHelperManager&&this.objectHelperManager.addFilteredObject(e)}),!0},fe=()=>new c.LineBasicMaterial({color:"rgb(255, 255, 255)"});class tr extends c.LineSegments{constructor(e){super();i(this,"shape");i(this,"target");i(this,"type","CameraHelper");i(this,"cachaData");const n=new c.BufferGeometry,s=[0,0,0,-1,1,-1,0,0,0,-1,1,1,0,0,0,-1,-1,-1,0,0,0,-1,-1,1,-1,-1,1,-1,-1,-1,-1,-1,-1,-1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,-1,1,0,0,0,0,1,1,0,0,0,0,1,-1,0,0,0,0,-1,-1,0,0,0,0,-1,1,0,1,1,0,1,-1,0,1,-1,0,-1,-1,0,-1,-1,0,-1,1,0,-1,1,0,1,1,0,-1,1,2,-1,1,0,1,-1,2,1,-1,0,-1,-1,2,-1,-1,0,1,1,2,1,1,2,1,1,2,-1,1,2,-1,1,2,-1,-1,2,-1,-1,2,1,-1,2,1,-1,2,1,1];n.setAttribute("position",new c.Float32BufferAttribute(s,3)),n.rotateY(-90*Math.PI/180),n.computeBoundingBox();const o=new c.CameraHelper(e);o.matrix=new c.Matrix4,o.matrixAutoUpdate=!0,o.raycast=()=>{},this.add(o),this.shape=o,this.geometry=n,this.material=fe(),this.target=e,this.matrixAutoUpdate=!1,this.matrix=e.matrix,e instanceof c.PerspectiveCamera?this.cachaData={fov:e.fov,aspect:e.aspect,near:e.near,far:e.far}:e instanceof c.OrthographicCamera?this.cachaData={left:e.left,right:e.right,top:e.top,bottom:e.bottom,near:e.near,far:e.far}:this.cachaData={},this.onBeforeRender=()=>{let a=!1;const l=this.cachaData;Object.keys(l).forEach(d=>{l[d]!==e[d]&&(l[d]=e[d],a=!0)}),a&&this.shape.update()}}raycast(e,n){const s=this.matrixWorld,o=this.geometry.boundingBox.clone();if(o.applyMatrix4(s),e.ray.intersectsBox(o)){const a=this.target;n.push({distance:e.ray.origin.distanceTo(a.position),object:a,point:a.position})}}}class pn extends c.LineSegments{constructor(e){super();i(this,"sphere");i(this,"target");i(this,"shape");i(this,"type","VisDirectionalLightHelper");i(this,"cacheColor");i(this,"cacheVector3");this.geometry=new c.BufferGeometry;const n=[-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,0,0,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,-.707,0,-.707,.707,0,.707,.707,0,-.707,-.707,0,.707];this.geometry.setAttribute("position",new c.Float32BufferAttribute(n,3)),this.material=fe(),this.geometry.boundingSphere;const s=new c.Color().copy(e.color).multiplyScalar(e.intensity),o=new c.PlaneBufferGeometry(20,20);o.dispose();const a=new c.LineSegments(new c.EdgesGeometry(o),new c.LineBasicMaterial({color:s}));a.raycast=()=>{},this.shape=a,this.target=e,this.sphere=new c.Sphere(new c.Vector3(0,0,0),1),this.cacheColor=e.color.getHex(),this.cacheVector3=new c.Vector3,this.add(this.shape),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.onBeforeRender=()=>{const l=this.target,d=this.shape;l.color.getHex()!==this.cacheColor&&(d.material.color.copy(l.color).multiplyScalar(l.intensity),this.cacheColor=l.color.getHex()),d.lookAt(l.target.position)}}raycast(e,n){const s=this.target,o=s.matrixWorld,a=this.sphere;a.set(this.cacheVector3.set(0,0,0),1),a.applyMatrix4(o),e.ray.intersectsSphere(a)&&n.push({distance:e.ray.origin.distanceTo(s.position),object:s,point:s.position})}}class mn extends c.LineSegments{constructor(e){super();i(this,"sphere");i(this,"target");i(this,"shape");i(this,"type","VisPointLightHelper");i(this,"cacheColor");i(this,"cacheDistance");i(this,"cacheVector3");this.geometry=new c.BufferGeometry;const n=[-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,0,0,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,-.707,0,-.707,.707,0,.707,.707,0,-.707,-.707,0,.707];this.geometry.setAttribute("position",new c.Float32BufferAttribute(n,3)),this.material=fe(),this.geometry.boundingSphere;const s=new c.Color().copy(e.color).multiplyScalar(e.intensity),o=new c.Mesh(new c.OctahedronBufferGeometry(e.distance,0),new c.MeshBasicMaterial({color:s,wireframe:!0}));o.raycast=()=>{},o.matrixAutoUpdate=!1,this.shape=o,this.target=e,this.sphere=new c.Sphere(new c.Vector3(0,0,0),1),this.cacheColor=e.color.getHex(),this.cacheDistance=e.distance,this.cacheVector3=new c.Vector3,this.add(this.shape),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.onBeforeRender=()=>{const a=this.target,l=this.shape;a.distance!==this.cacheDistance&&(l.geometry.dispose(),l.geometry=new c.OctahedronBufferGeometry(a.distance,0),this.cacheDistance=a.distance),a.color.getHex()!==this.cacheColor&&(l.material.color.copy(a.color).multiplyScalar(a.intensity),this.cacheColor=a.color.getHex())}}raycast(e,n){const s=this.target,o=s.matrixWorld,a=this.sphere;a.set(this.cacheVector3.set(0,0,0),1),a.applyMatrix4(o),e.ray.intersectsSphere(a)&&n.push({distance:e.ray.origin.distanceTo(s.position),object:s,point:s.position})}}class Tc extends c.LineSegments{constructor(e){super();i(this,"target");i(this,"type","VisRectAreaLightHelper");i(this,"cacheBox",new c.Box3);i(this,"cacheVector3",new c.Vector3);i(this,"cacheColor");i(this,"cacheIntensity");this.target=e,this.generateShape();const n=fe();n.color.copy(e.color).multiplyScalar(e.intensity),this.cacheColor=e.color.getHex(),this.cacheIntensity=e.intensity,this.material=n,this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.onBeforeRender=()=>{const s=this.target;(s.width!==this.geometry.parameters.width||s.height!==this.geometry.parameters.height)&&this.generateShape(),(s.color.getHex()!==this.cacheColor||this.cacheIntensity!==s.intensity)&&(this.material.color.copy(s.color).multiplyScalar(s.intensity),this.cacheColor=s.color.getHex())}}generateShape(){this.geometry.dispose(),this.geometry=new c.PlaneBufferGeometry(this.target.width,this.target.height,4,4),this.geometry.computeBoundingBox()}raycast(e,n){const s=this.target,o=this.cacheBox;o.copy(this.geometry.boundingBox),o.applyMatrix4(s.matrixWorld),e.ray.intersectBox(o,this.cacheVector3)&&n.push({distance:e.ray.origin.distanceTo(s.position),object:s,point:s.position})}}class fn extends c.LineSegments{constructor(e){super();i(this,"sphere");i(this,"target");i(this,"shape");i(this,"type","VisSpotLightHelper");i(this,"cacheVector3");i(this,"cacheColor");i(this,"cacheAngle");i(this,"cacheDistance");this.geometry=new c.BufferGeometry;const n=[-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,0,0,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,-.707,0,-.707,.707,0,.707,.707,0,-.707,-.707,0,.707];this.geometry.setAttribute("position",new c.Float32BufferAttribute(n,3)),this.material=fe(),this.geometry.boundingSphere;const s=new c.BufferGeometry,o=[0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let h=0,g=1,R=32;h<R;h++,g++){const M=h/R*Math.PI*2,C=g/R*Math.PI*2;o.push(Math.cos(M),Math.sin(M),1,Math.cos(C),Math.sin(C),1)}s.setAttribute("position",new c.Float32BufferAttribute(o,3));const a=fe(),l=new c.LineSegments(s,a);l.material.color.copy(e.color).multiplyScalar(e.intensity);const d=e.distance?e.distance:1e3,p=d*Math.tan(e.angle);l.scale.set(p,p,d),l.raycast=()=>{},this.add(l),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.target=e,this.shape=l,this.sphere=new c.Sphere(new c.Vector3(0,0,0),1),this.cacheColor=e.color.getHex(),this.cacheDistance=e.distance,this.cacheAngle=e.angle,this.cacheVector3=new c.Vector3,this.onBeforeRender=()=>{const h=this.target,g=this.shape;let R=!1;if(h.distance!==this.cacheDistance&&(this.cacheDistance=h.distance,g.scale.z=h.distance,R=!0),h.angle!==this.cacheAngle&&(this.cacheAngle=h.angle,R=!0),R){const M=h.distance*Math.tan(h.angle);g.scale.set(M,M,h.distance)}h.color.getHex()!==this.cacheColor&&(g.material.color.copy(h.color).multiplyScalar(h.intensity),this.cacheColor=h.color.getHex()),g.lookAt(h.target.position)}}raycast(e,n){const s=this.target,o=s.matrixWorld,a=this.sphere;a.set(this.cacheVector3.set(0,0,0),1),a.applyMatrix4(o),e.ray.intersectsSphere(a)&&n.push({distance:e.ray.origin.distanceTo(s.position),object:s,point:s.position})}}const xc=`

#include <common>

void main() {
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );

	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

  bool isPerspective = isPerspectiveMatrix( projectionMatrix );

  if ( isPerspective ) scale *= - mvPosition.z;

	vec2 alignedPosition = position.xy * scale;

	vec2 rotatedPosition;
	rotatedPosition.x = cos( 0.0 ) * alignedPosition.x - sin( 0.0 ) * alignedPosition.y;
	rotatedPosition.y = sin( 0.0 ) * alignedPosition.x + cos( 0.0 ) * alignedPosition.y;

	mvPosition.xy += rotatedPosition;

	gl_Position = projectionMatrix * mvPosition;

}

`,Lc=`

uniform vec3 color;

void main() {
  gl_FragColor = vec4(color, 1.0);
}
`;class Oc extends c.ShaderMaterial{constructor(){super(),this.vertexShader=xc,this.fragmentShader=Lc,this.uniforms={color:{value:new c.Color("white")}}}}class Ac extends c.LineSegments{constructor(e){super();i(this,"target");i(this,"type","VisCSS2DPlaneHelper");i(this,"observer");this.geometry=new c.EdgesGeometry(new c.PlaneBufferGeometry(1,1)),this.geometry.computeBoundingBox(),this.material=new Oc,this.scale.copy(e.matrixScale),this.position.set(e.position.x,e.position.y,e.position.z),this.target=e;const n=new MutationObserver(()=>{this.scale.copy(e.matrixScale)});n.observe(e.element,{attributeFilter:["style"]}),this.observer=n,this.onBeforeRender=()=>{this.position.set(this.target.position.x,this.target.position.y,this.target.position.z)},this.raycast=()=>{}}dispose(){this.observer.disconnect()}}class Dc extends c.LineSegments{constructor(e){super();i(this,"target");i(this,"type","VisCSS3DHelper");const s=e.element.getBoundingClientRect(),o=s.width,a=s.height;this.geometry=new c.EdgesGeometry(new c.PlaneBufferGeometry(o,a)),this.geometry.computeBoundingBox(),this.material=fe(),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.target=e}raycast(e,n){const s=this.target,o=s.matrixWorld,a=this.geometry.boundingBox.clone();a.applyMatrix4(o),e.ray.intersectsBox(a)&&n.push({distance:e.ray.origin.distanceTo(s.position),object:s,point:s.position})}}class Pc extends c.LineSegments{constructor(e){super();i(this,"target");i(this,"type","VisCSS3DPlaneHelper");i(this,"observer");this.geometry=new c.EdgesGeometry(new c.PlaneBufferGeometry(e.width,e.height)),this.geometry.computeBoundingBox(),this.material=fe(),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.target=e;const n=new MutationObserver(()=>{this.geometry.dispose(),this.geometry=new c.EdgesGeometry(new c.PlaneBufferGeometry(e.width,e.height)),this.geometry.computeBoundingBox()});n.observe(e.element,{attributeFilter:["style"]}),this.observer=n,this.raycast=()=>{},this.updateMatrixWorld=()=>{}}dispose(){this.observer.disconnect()}}const jc=`
uniform float rotation2D;

#include <common>

void main() {
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );

	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

	vec2 alignedPosition = position.xy * scale;

	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation2D ) * alignedPosition.x - sin( rotation2D ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation2D ) * alignedPosition.x + cos( rotation2D ) * alignedPosition.y;

	mvPosition.xy += rotatedPosition;

	gl_Position = projectionMatrix * mvPosition;

}

`,Bc=`

uniform vec3 color;

void main() {
  gl_FragColor = vec4(color, 1.0);
}
`;class Ic extends c.ShaderMaterial{constructor(){super(),this.vertexShader=jc,this.fragmentShader=Bc,this.uniforms={color:{value:new c.Color("white")},rotation2D:{value:0}}}}class Gc extends c.LineSegments{constructor(e){super();i(this,"target");i(this,"type","VisCSS3DSpriteHelper");i(this,"observer");this.geometry=new c.EdgesGeometry(new c.PlaneBufferGeometry(1,1)),this.geometry.computeBoundingBox(),this.material=new Ic,this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.target=e;const n=new MutationObserver(()=>{this.geometry.dispose(),this.geometry=new c.EdgesGeometry(new c.PlaneBufferGeometry(e.width,e.height)),this.geometry.computeBoundingBox()});n.observe(e.element,{attributeFilter:["style"]}),this.observer=n,this.onBeforeRender=()=>{this.material.uniforms.rotation2D.value=this.target.rotation2D},this.raycast=()=>{},this.updateMatrixWorld=()=>{}}dispose(){this.observer.disconnect()}}const ir=class extends c.Sprite{constructor(e){super();i(this,"target");i(this,"type","VisGroupHelper");this.target=e,this.geometry.computeBoundingBox(),this.material=new c.SpriteMaterial({map:ir.colorTexture}),this.material.depthTest=!1,this.material.depthWrite=!1,this.scale.set(5,5,5);const n=this.updateMatrixWorld.bind(this);this.updateMatrixWorld=s=>{const o=this.position,a=this.target.position;o.x=a.x,o.y=a.y,o.z=a.z,n(s)}}raycast(e,n){const s=this.matrixWorld,o=this.geometry.boundingBox.clone();if(o.applyMatrix4(s),e.ray.intersectsBox(o)){const a=this.target;n.push({distance:e.ray.origin.distanceTo(a.position),object:a,point:a.position})}}};let at=ir;i(at,"colorTexture",new c.CanvasTexture(new ot({width:512,height:512}).draw(e=>{e.beginPath(),e.fillStyle="rgba(0, 0, 0, 0)",e.fillRect(0,0,512,512),e.closePath(),e.translate(256,200),e.beginPath(),e.fillStyle="yellow",e.fillRect(-200,0,400,200),e.closePath(),e.beginPath(),e.fillStyle="yellow",e.fillRect(-200,-70,200,70),e.closePath()}).get()));const ar=class extends c.Points{constructor(e){super();i(this,"target");i(this,"cachaGeometryUUid");i(this,"type","VisLineHelper");this.target=e,this.geometry.dispose(),this.geometry.copy(e.geometry),this.cachaGeometryUUid=e.geometry.uuid,this.material=new c.PointsMaterial({color:"rgb(255, 255, 255)",alphaMap:ar.alphaTexture,transparent:!0,size:5,sizeAttenuation:!1}),this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.matrix=e.matrix,this.matrixWorld=e.matrixWorld,this.renderOrder=-1,this.raycast=()=>{},this.onBeforeRender=()=>{const n=this.target;n.geometry.uuid!==this.cachaGeometryUUid&&(this.geometry.dispose(),this.geometry=n.geometry.clone(),this.cachaGeometryUUid=n.geometry.uuid)}}};let xt=ar;i(xt,"alphaTexture",new c.CanvasTexture(new ot({width:512,height:512,bgColor:"rgb(0, 0, 0)"}).draw(e=>{e.beginPath(),e.fillStyle="rgb(255, 255, 255)",e.arc(256,256,200,0,Math.PI*2),e.fill(),e.closePath()}).getDom()));class Uc extends c.LineSegments{constructor(e){super();i(this,"target");i(this,"type","VisMeshHelper");i(this,"cachaGeometryUUid");const n=1;this.target=e,this.geometry=new c.EdgesGeometry(e.geometry,n),this.cachaGeometryUUid=e.geometry.uuid,this.material=fe(),this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.matrix=e.matrix,this.matrixWorld=e.matrixWorld,this.updateMatrixWorld=()=>{},this.raycast=()=>{},this.onBeforeRender=()=>{const s=this.target;s.geometry.uuid!==this.cachaGeometryUUid&&(this.geometry.dispose(),this.geometry=new c.EdgesGeometry(s.geometry,n),this.cachaGeometryUUid=s.geometry.uuid)}}}const cr=class extends c.Points{constructor(e){super();i(this,"target");i(this,"type","VisPointsHelper");this.target=e,this.geometry.dispose(),this.geometry.copy(e.geometry),this.material.dispose(),this.material=new c.PointsMaterial({color:"rgb(255, 255, 255)",alphaMap:cr.alphaTexture,transparent:!0});const n=Array.isArray(e.material)?e.material[0]:e.material;n instanceof c.PointsMaterial&&(this.material.size=n.size,this.material.sizeAttenuation=n.sizeAttenuation),this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.matrix=e.matrix,this.matrixWorld=e.matrixWorld,this.raycast=()=>{}}};let Lt=cr;i(Lt,"alphaTexture",new c.CanvasTexture(new ot({width:512,height:512,bgColor:"rgb(0, 0, 0)"}).draw(e=>{e.beginPath(),e.strokeStyle="rgb(255, 255, 255)",e.lineWidth=4,e.strokeRect(0,0,512,512),e.closePath()}).get()));const Hc=`

uniform float rotation;
uniform vec2 center;
uniform bool sizeAttenuation;

#include <common>

void main() {
  vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );

	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

	if (!sizeAttenuation) {
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );

		if ( isPerspective ) scale *= - mvPosition.z;
  }

	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;

	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;

	mvPosition.xy += rotatedPosition;

	gl_Position = projectionMatrix * mvPosition;

}

`,Nc=`

uniform vec3 color;

void main() {
  gl_FragColor = vec4(color, 1.0);
}
`;class zc extends c.ShaderMaterial{constructor(){super(),this.vertexShader=Hc,this.fragmentShader=Nc,this.uniforms={color:{value:new c.Color("white")},center:{value:new c.Vector2(.5,.5)},rotation:{value:0},sizeAttenuation:{value:!1}}}}class Fc extends c.LineSegments{constructor(e){super();i(this,"target");i(this,"type","VisSpriteHelper");this.geometry=new c.EdgesGeometry(new c.PlaneBufferGeometry(1,1)),this.geometry.computeBoundingBox(),this.material=new zc,this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.matrix=e.matrix,this.matrixWorld=e.matrixWorld,this.target=e,this.onBeforeRender=()=>{this.material.uniforms.rotation.value=this.target.material.rotation,this.material.uniforms.sizeAttenuation.value=this.target.material.sizeAttenuation},this.raycast=()=>{}}}class kc extends te{constructor(e={}){super();i(this,"helperGenerator",{[u.POINTLIGHT]:mn,[u.SPOTLIGHT]:fn,[u.DIRECTIONALLIGHT]:pn,[u.RECTAREALIGHT]:Tc,[u.PERSPECTIVECAMERA]:tr,[u.ORTHOGRAPHICCAMERA]:tr,[u.MESH]:Uc,[u.GROUP]:at,[u.SPRITE]:Fc,[u.POINTS]:Lt,[u.LINE]:xt,[u.CSS3DOBJECT]:Dc,[u.CSS3DPLANE]:Pc,[u.CSS3DSPRITE]:Gc,[u.CSS2DPLANE]:Ac});i(this,"helperFilter",{AmbientLight:!0,HemisphereLight:!0,Object3D:!0,TransformControls:!0,Scene:!0});i(this,"objectFilter",new Set);i(this,"objectHelperMap",new Map);e.helperGenerator&&(this.helperGenerator=Object.assign(this.helperGenerator,e.helperGenerator)),e.helperFilter&&(this.helperFilter=Object.assign(this.helperFilter,e.helperFilter)),e.objectFilter&&(this.objectFilter=new Set(e.objectFilter.concat(Array.from(this.objectFilter))))}addFilteredObject(...e){for(const n of e)this.objectFilter.add(n);return this}addObjectHelper(e){if(this.objectFilter.has(e)||this.objectHelperMap.has(e)||this.helperFilter[e.type]||e.type.toLocaleLowerCase().includes("helper"))return null;if(!this.helperGenerator[e.type])return console.warn(`object helper can not support this type object: '${e.type}'`),null;const n=new this.helperGenerator[e.type](e);return this.objectHelperMap.set(e,n),n}disposeObjectHelper(e){if(this.objectFilter.has(e)||this.helperFilter[e.type]||e.type.toLocaleLowerCase().includes("helper"))return null;if(!this.objectHelperMap.has(e))return console.warn("object helper manager can not found this object`s helper: ",e),null;const n=this.objectHelperMap.get(e);return n.geometry&&n.geometry.dispose(),n.material&&(n.material instanceof c.Material?n.material.dispose():n.material.forEach(s=>{s.dispose()})),this.objectHelperMap.delete(e),n}}const $c=function(t={}){if(!this.scene)return console.error("must install some scene plugin before ObjectHelper plugin."),!1;t.interact===void 0&&(t.interact=!0),t.interact&&(this.eventManager||(console.warn("must install eventManager plugin that can use interact function."),t.interact=!1));const r=new kc,e=new Map,n=new Map,s=new Map,o=r.objectHelperMap;this.objectHelperManager=r,!t.activeColor&&(t.activeColor="rgb(230, 20, 240)"),!t.hoverColor&&(t.hoverColor="rgb(255, 158, 240)"),!t.defaultColor&&(t.defaultColor="rgb(255, 255, 255)"),!t.selectedColor&&(t.selectedColor=t.activeColor);const a=new c.Color(t.defaultColor).getHex(),l=new c.Color(t.activeColor).getHex(),d=new c.Color(t.hoverColor).getHex(),p=new c.Color(t.selectedColor).getHex(),h=new WeakSet,g=(L,b)=>{L.material.color?L.material.color.setHex(a):L.material instanceof c.ShaderMaterial&&L.material.uniforms.color.value.setHex(b)},R=L=>{const b=L.objects;for(const v of b){const A=r.addObjectHelper(v);if(!!A&&(g(A,a),this.scene.add(A),t.interact)){const W=()=>{var H;(H=this.transformControls)!=null&&H.dragging||this.selectionBox&&this.selectionBox.has(v)||g(A,d)},O=()=>{var H;(H=this.transformControls)!=null&&H.dragging||this.selectionBox&&this.selectionBox.has(v)||g(A,a)},E=()=>{var H;(H=this.transformControls)!=null&&H.dragging||this.selectionBox&&this.selectionBox.has(v)||g(A,l)};v.addEventListener("pointerenter",W),v.addEventListener("pointerleave",O),v.addEventListener("click",E),e.set(v,W),n.set(v,O),s.set(v,E)}}},M=L=>{const b=L.objects;for(const v of b){const A=r.disposeObjectHelper(v);!A||(this.scene.remove(A),t.interact&&(v.removeEventListener("pointerenter",e.get(v)),v.removeEventListener("pointerleave",n.get(v)),v.removeEventListener("click",s.get(v)),e.delete(v),n.delete(v),s.delete(v)))}},C=L=>{h.has(L)||(L.traverse(b=>{const v=r.addObjectHelper(b);v&&L.add(v)}),h.add(L))};this.scene.addEventListener("afterAdd",R),this.scene.addEventListener("afterRemove",M),this.setObjectHelper=function(L){return L.show?this.scene.traverse(b=>{o.has(b)&&this.scene.add(o.get(b))}):this.scene.traverse(b=>{o.has(b)&&this.scene.remove(o.get(b))}),this},this.addEventListener("setScene",L=>{const b=L.scene;!h.has(b)&&C(b),b.hasEventListener("afterAdd",R)||b.addEventListener("afterAdd",R),b.hasEventListener("afterRemove",M)||b.addEventListener("afterRemove",M)});const D=new Set;return this.completeSet.add(()=>{this.selectionBox&&this.addEventListener("selected",L=>{D.forEach(b=>{g(b,a)}),D.clear();for(const b of L.objects)if(o.has(b)){const v=o.get(b);g(v,p),D.add(v)}})}),!0},Vc=function(t={}){if(this.selectionBox)return console.warn("engine has installed selection plugin."),!1;if(!this.eventManager)return console.warn("must install eventManager plugin before Selection plugin."),!1;this.selectionBox=new Set;const r=()=>{const e=[];this.IS_ENGINESUPPORT&&this.selectionBox.forEach(n=>{const s=this.compilerManager.getObjectSymbol(n);s?e.push(s):console.warn("selection plugin can not font vid in compilerManager.",n)}),this.dispatchEvent({type:"selected",objects:[...this.selectionBox],objectSymbols:e})};return this.setSelectionBox=function(e){this.selectionBox.clear();for(const n of e.objects)this.selectionBox.add(n);return r(),this},this.eventManager.addEventListener("click",e=>{var s,o,a;if(this.transing){this.transing=!1;return}const n=e.intersections;if(e.ctrlKey||this.selectionBox.clear(),this.eventManager.penetrate)for(const l of n){if(e.ctrlKey&&(s=this.selectionBox)!=null&&s.has(l.object)){this.selectionBox.delete(l.object);continue}this.selectionBox.add(l.object)}else if(n.length){const l=n[0].object;if(e.ctrlKey&&(o=this.selectionBox)!=null&&o.has(l)){this.selectionBox.delete(l);return}(a=this.selectionBox)==null||a.add(l)}r()}),!0},Wc=function(t={}){if(this.css3DRenderer)return console.warn("this has installed css3DRenderer plugin."),!1;this.css3DRenderer=new Se.CSS3DRenderer;const r=this.css3DRenderer.domElement;if(r.classList.add("vis-css3D"),r.style.position="absolute",r.style.top="0",r.style.left="0",this.addEventListener("setDom",e=>{e.dom.appendChild(this.css3DRenderer.domElement)}),this.addEventListener("setSize",e=>{this.css3DRenderer.setSize(e.width,e.height)}),this.addEventListener("setScene",e=>{e.oldScene.traverse(s=>{s instanceof Se.CSS3DObject&&(s.element.style.display="none")})}),this.renderManager)this.renderManager.addEventListener("render",e=>{this.css3DRenderer.render(this.scene,this.camera)});else{const e=this.render.bind(this);this.render=function(){return e(),this.css3DRenderer.render(this.scene,this.camera),this}}return!0},Yc=function(t={}){if(this.css2DRenderer)return console.warn("this has installed css2DRenderer plugin."),!1;this.css2DRenderer=new Ut.CSS2DRenderer;const r=this.css2DRenderer.domElement;if(r.classList.add("vis-css2D"),r.style.position="absolute",r.style.top="0",r.style.left="0",this.addEventListener("setDom",e=>{e.dom.appendChild(this.css2DRenderer.domElement)}),this.addEventListener("setSize",e=>{this.css2DRenderer.setSize(e.width,e.height)}),this.addEventListener("setScene",e=>{e.oldScene.traverse(s=>{s instanceof Ut.CSS2DObject&&(s.element.style.display="none")})}),this.renderManager)this.renderManager.addEventListener("render",e=>{this.css2DRenderer.render(this.scene,this.camera)});else{const e=this.render.bind(this);this.render=function(){return e(),this.css2DRenderer.render(this.scene,this.camera),this}}return!0};var x=(t=>(t.WEBGLRENDERER="WebGLRenderer",t.CSS3DRENDERER="CSS3DRenderer",t.CSS2DRENDERER="CSS2DRenderer",t.SCENE="Scene",t.MODELINGSCENE="ModelingScene",t.RENDERMANAGER="RenderManager",t.ORBITCONTROLS="OrbitControls",t.STATS="Stats",t.EFFECTCOMPOSER="EffectComposer",t.POINTERMANAGER="PointerManager",t.EVENTMANAGER="EventManager",t.TRANSFORMCONTROLS="TransformControls",t.LOADERMANAGER="LoaderManager",t.RESOURCEMANAGER="ResourceManager",t.DATASUPPORTMANAGER="DataSupportManager",t.COMPILERMANAGER="CompilerManager",t.KEYBOARDMANAGER="KeyboardManager",t.AXESHELPER="AxesHelper",t.GRIDHELPER="GridHelper",t.VIEWPOINT="Viewpoint",t.DISPLAYMODE="DisplayMode",t.OBJECTHELPER="ObjectHelper",t.SELECTION="Selection",t))(x||{});const Le=class extends te{constructor(){super();i(this,"completeSet");i(this,"camera",new c.PerspectiveCamera);i(this,"scene",new c.Scene);i(this,"IS_ENGINESUPPORT",!1);i(this,"dom");i(this,"webGLRenderer");i(this,"css3DRenderer");i(this,"css2DRenderer");i(this,"orbitControls");i(this,"transformControls");i(this,"effectComposer");i(this,"renderManager");i(this,"pointerManager");i(this,"eventManager");i(this,"loaderManager");i(this,"resourceManager");i(this,"dataSupportManager");i(this,"compilerManager");i(this,"keyboardManager");i(this,"objectHelperManager");i(this,"transing");i(this,"stats");i(this,"displayMode");i(this,"selectionBox");i(this,"getScreenshot");i(this,"setStats");i(this,"setTransformControls");i(this,"setViewpoint");i(this,"setDisplayMode");i(this,"setAxesHelper");i(this,"setGridHelper");i(this,"setObjectHelper");i(this,"setSelectionBox");i(this,"loadResources");i(this,"loadResourcesAsync");i(this,"registerResources");i(this,"toJSON");i(this,"exportConfig");i(this,"applyConfig");i(this,"getConfigBySymbol");i(this,"removeConfigBySymbol");i(this,"getObjectSymbol");i(this,"getObjectBySymbol");i(this,"play");i(this,"stop");i(this,"render");this.completeSet=new Set,this.render=function(){return console.warn("can not install some plugin"),this},this.camera.position.set(50,50,50),this.addEventListener("setSize",e=>{this.camera.aspect=e.width/e.height,this.camera.updateProjectionMatrix()})}optimizeMemory(){Object.keys(this).forEach(e=>{this[e]===void 0&&delete this[e]})}install(e,n){return Le.pluginHandler.has(e)?Le.pluginHandler.get(e).call(this,n):console.error(`engine can not support ${e} plugin.`),this}complete(){return this.completeSet.forEach(e=>{e(this)}),this.completeSet.clear(),this}dispose(){return this.dispatchEvent({type:"dispose"}),this}setDom(e){return this.dom=e,this.dispatchEvent({type:"setDom",dom:e}),this}setSize(e,n){var s,o;return e&&e<=0||n&&n<=0?(console.warn(`you must be input width and height bigger then zero, width: ${e}, height: ${n}`),this):(!e&&(e=((s=this.dom)==null?void 0:s.offsetWidth)||window.innerWidth),!n&&(n=((o=this.dom)==null?void 0:o.offsetHeight)||window.innerHeight),this.dispatchEvent({type:"setSize",width:e,height:n}),this)}setCamera(e,n){if(typeof e=="object"&&e instanceof c.Camera)this.camera=e,this.dispatchEvent({type:"setCamera",camera:e,options:Object.assign({orbitControls:!0,transformControls:!0},n||{})});else if(this.IS_ENGINESUPPORT){const s=this.compilerManager.getObjectBySymbol(e);s?(this.camera=s,this.dispatchEvent({type:"setCamera",camera:s,options:Object.assign({orbitControls:!0,transformControls:!0},n||{})})):console.warn(`can not found camera in compilerManager: ${e}`)}else console.warn("engine is not a Engine support but use symbol to found camera.");return this}setScene(e){if(typeof e=="object"&&e instanceof c.Scene)this.dispatchEvent({type:"setScene",scene:e,oldScene:this.scene}),this.scene=e;else if(this.IS_ENGINESUPPORT){const n=this.compilerManager.getObjectBySymbol(e);n?(this.dispatchEvent({type:"setScene",scene:n,oldScene:this.scene}),this.scene=n):console.warn(`can not found scene in compilerManager: ${e}`)}else console.warn("engine is not a Engine support but use symbol to found scene.");return this}};let I=Le;i(I,"pluginHandler",new Map),i(I,"register",function(e,n){return Le.pluginHandler&&Le.pluginHandler.set(e,n),Le}),i(I,"dispose",function(){Le.pluginHandler=void 0}),I.register("WebGLRenderer",cs),I.register("CSS3DRenderer",Wc),I.register("CSS2DRenderer",Yc),I.register("EffectComposer",rs),I.register("RenderManager",Jn),I.register("PointerManager",ss),I.register("EventManager",is),I.register("LoaderManager",ls),I.register("ResourceManager",Co),I.register("DataSupportManager",Jo),I.register("CompilerManager",bc),I.register("KeyboardManager",vc),I.register("OrbitControls",Zn),I.register("TransformControls",as),I.register("AxesHelper",wc),I.register("GridHelper",Cc),I.register("ObjectHelper",$c),I.register("DisplayMode",Rc),I.register("Viewpoint",qn),I.register("Stats",ts),I.register("Selection",Vc);class _c extends I{constructor(){super(),this.install(x.WEBGLRENDERER,{antialias:!0,alpha:!0}).install(x.RENDERMANAGER).install(x.EFFECTCOMPOSER,{WebGLMultisampleRenderTarget:!0}).install(x.ORBITCONTROLS).install(x.POINTERMANAGER).install(x.EVENTMANAGER).complete()}}class Xc extends I{constructor(){super(),this.install(x.RENDERMANAGER).install(x.WEBGLRENDERER,{antialias:!0,alpha:!0}).install(x.POINTERMANAGER).install(x.EVENTMANAGER).install(x.EFFECTCOMPOSER,{WebGLMultisampleRenderTarget:!0}).install(x.SELECTION).install(x.AXESHELPER).install(x.GRIDHELPER).install(x.OBJECTHELPER).install(x.VIEWPOINT).install(x.DISPLAYMODE).install(x.STATS).install(x.ORBITCONTROLS).install(x.KEYBOARDMANAGER).install(x.TRANSFORMCONTROLS).complete()}}const q=function(t,r,e={strict:!0,warn:!0}){if(!k[t])return console.error(`type: ${t} can not be found in configList.`),{vid:"",type:t};const n=(a,l)=>{for(const d in l){if(a[d]===void 0){!e.strict&&(a[d]=l[d]),e.strict&&e.warn&&console.warn(`'${t}' config can not set key: ${d}`);continue}typeof l[d]=="object"&&l[d]!==null&&!Array.isArray(l[d])?(a[d]===null&&(a[d]={...l[d]}),n(a[d],l[d])):a[d]=l[d]}};let s=k[t]();if([u.SHADERMATERIAL].includes(t)){const a=ee.generateConfig((r==null?void 0:r.shader)||"defaultShader"),l=e.strict;e.strict=!1,n(s,a),e.strict=l}[u.SCRIPTANIMATION,u.KEYFRAMEANIMATION].includes(t)&&(e.strict=!1),s.vid===""&&(s.vid=Z.v4()),r&&n(s,r),e.handler&&(s=e.handler(s));const o=Jt(s);if(q.autoInject&&q.injectEngine){const a=q.injectEngine;if(a.applyConfig(o),q.injectScene&&wr(s.type)&&s.type!==u.SCENE){let l=null;typeof q.injectScene=="boolean"?l=a.getObjectConfig(a.scene):typeof q.injectScene=="string"&&(l=a.getConfigBySymbol(q.injectScene)),l?l.children.push(s.vid):console.warn("current engine scene can not found it config",a,a.scene)}return o}return o};q.autoInject=!0,q.injectScene=!1,q.injectEngine=null;class Qc{constructor(){i(this,"supportData");i(this,"supportDataType")}create(r){return r?(this.supportData={},this.supportDataType=r,this):(console.warn("you must give a module type in create params"),this)}add(r){return!this.supportData||!this.supportDataType?(console.warn("you must call 'create' method before the 'add' method"),this):r.type?Ne(r.type)!==this.supportDataType?(console.warn(`current generator create config which module is in: ${this.supportDataType}, but you provide type is '${r.type}'`),this):(this.supportData[r.vid]=q(r.type,r),this):(console.warn("config can not found attribute 'type'"),this)}get(){return this.supportDataType=void 0,this.supportData?this.supportData:{}}}const rr=new c.PointLight("rgb(255, 255, 255)",.5,200,1);rr.position.set(-30,5,20),rr.castShadow=!0;const Ot=new c.Mesh(new c.BoxBufferGeometry(80,2,80),new c.MeshStandardMaterial({color:"rgb(255, 255, 255)"}));Ot.position.set(0,-11,0),Ot.receiveShadow=!0,Ot.castShadow=!0;const ue=class{constructor(r){i(this,"material");i(this,"dom");i(this,"renderer");i(this,"scene");i(this,"camera");i(this,"object");const e=new c.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0});e.setPixelRatio(window.devicePixelRatio),e.setClearColor("rgb(150, 150, 150)"),e.shadowMap.enabled=!0,e.shadowMap.type=c.PCFSoftShadowMap;const n=new c.Scene,s=new c.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,500);s.position.set(0,0,35),s.up.x=0,s.up.y=1,s.up.z=0,s.lookAt(new c.Vector3(0,0,0)),n.add(ue.ambientLight),n.add(ue.pointLight),n.add(ue.plane),this.scene=n,this.renderer=e,this.camera=s,this.object=new c.Object3D,r!=null&&r.material&&this.setMaterial(r.material),r!=null&&r.dom&&this.setDom(r.dom)}setMaterial(r){if(this.scene.remove(this.object),this.material=r,r.type.includes("Mesh"))this.object=new c.Mesh(ue.geometry,r);else if(r.type.includes("Line"))this.object=new c.Line(ue.geometry,r);else if(r.type.includes("Ponits"))this.object=new c.Points(ue.geometry,r);else if(r.type.includes("Sprite"))this.object=new c.Sprite(r);else return console.warn(`material displayer can not support this type material: '${r.type}'`),this;return this.object.castShadow=!0,this.object.receiveShadow=!0,this.scene.add(this.object),this}setDom(r){return this.dom=r,this.setSize(),r.appendChild(this.renderer.domElement),this}setSize(r,e){if(r&&e)this.camera.aspect=r/e,this.camera.updateProjectionMatrix(),this.renderer.setSize(r,e,!0);else{if(!this.dom)return console.warn("material displayer must set dom before setSize with empty parameters"),this;const n=this.dom;this.camera.aspect=n.offsetWidth/n.offsetHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(n.offsetWidth,n.offsetHeight,!0)}return this}render(){this.renderer.render(this.scene,this.camera)}getDataURL(r){return this.renderer.domElement.toDataURL(r||"image/png")}dispose(){this.renderer.dispose()}};let xe=ue;i(xe,"ambientLight",new c.AmbientLight("rgb(255, 255, 255)",.7)),i(xe,"pointLight",rr),i(xe,"geometry",new c.SphereBufferGeometry(10,12,12)),i(xe,"plane",Ot),i(xe,"dispose",()=>{ue.geometry.dispose(),ue.plane.geometry.dispose()});const lr=class{constructor(r){i(this,"dom");i(this,"texture");i(this,"renderer");i(this,"scene");i(this,"camera");const e=new c.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0});e.setPixelRatio(window.devicePixelRatio),e.setClearColor("rgb(150, 150, 150)"),e.shadowMap.enabled=!0,e.shadowMap.type=c.PCFSoftShadowMap;const n=new c.Scene,s=new c.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,500);s.position.set(0,0,35),s.up.x=0,s.up.y=1,s.up.z=0,s.lookAt(new c.Vector3(0,0,0)),n.add(lr.ambientLight),this.scene=n,this.renderer=e,this.camera=s,r!=null&&r.texture&&this.setTexture(r.texture),r!=null&&r.dom&&this.setDom(r.dom)}setTexture(r){return this.scene.background=r,this}setDom(r){return this.dom=r,this.setSize(),r.appendChild(this.renderer.domElement),this}setSize(r,e){if(r&&e)this.camera.aspect=r/e,this.camera.updateProjectionMatrix(),this.renderer.setSize(r,e,!0);else{if(!this.dom)return console.warn("texture displayer must set dom before setSize with empty parameters"),this;const n=this.dom;this.camera.aspect=n.offsetWidth/n.offsetHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(n.offsetWidth,n.offsetHeight,!0)}return this}render(){this.renderer.render(this.scene,this.camera)}getDataURL(r){return this.renderer.domElement.toDataURL(r||"image/png")}dispose(){this.renderer.dispose()}};let At=lr;i(At,"ambientLight",new c.AmbientLight("rgb(255, 255, 255)",1));class nr extends I{constructor(e={},n={}){super();i(this,"IS_ENGINESUPPORT",!0);this.install(x.LOADERMANAGER).install(x.RESOURCEMANAGER,{resources:n}).install(x.POINTERMANAGER).install(x.EVENTMANAGER).install(x.RENDERMANAGER).install(x.DATASUPPORTMANAGER,e).install(x.COMPILERMANAGER)}loadLifeCycle(e){const n=this.dataSupportManager;e.texture&&n.load({texture:e.texture}),e.material&&n.load({material:e.material}),delete e.texture,delete e.material,n.load(e)}removeLifeCycle(e){const n=this.dataSupportManager,s=e[y.TEXTURE]||[],o=e[y.MATERIAL]||[],a=e.assets||[];delete e.texture,delete e.material,delete e.assets,n.remove(e),n.remove({[y.MATERIAL]:o}),n.remove({[y.TEXTURE]:s});const l=this.resourceManager,d=this.loaderManager;a.forEach(p=>{l.remove(p),d.remove(p)})}loadConfig(e,n){const s=this.renderManager.hasRendering();if(s&&this.renderManager.stop(),e.assets&&e.assets.length){const o=a=>{delete e.assets,this.loadLifeCycle(e),this.resourceManager.removeEventListener("mapped",o),n&&n(a),s?this.renderManager.play():this.renderManager.render()};this.resourceManager.addEventListener("mapped",o),this.loaderManager.reset().load(e.assets)}else this.loadLifeCycle(e),n&&n(),s?this.renderManager.play():this.renderManager.render();return this}loadConfigAsync(e){return new Promise((n,s)=>{const o=this.renderManager.hasRendering();if(o&&this.renderManager.stop(),e.assets&&e.assets.length){const a=l=>{delete e.assets,this.loadLifeCycle(e),this.resourceManager.removeEventListener("mapped",a),o?this.renderManager.play():this.renderManager.render(),n(l)};this.resourceManager.addEventListener("mapped",a),this.loaderManager.reset().load(e.assets)}else this.loadLifeCycle(e),o?this.renderManager.play():this.renderManager.render(),n(void 0)})}removeConfig(e){this.removeLifeCycle(e)}getObjectConfig(e){const n=this.getObjectSymbol(e);return n?this.getConfigBySymbol(n):null}use(e){e.init(this)}}class Kc extends nr{constructor(e){super(e);i(this,"IS_ENGINESUPPORT",!0);this.install(x.WEBGLRENDERER,{antialias:!0,alpha:!0}).install(x.EFFECTCOMPOSER,{WebGLMultisampleRenderTarget:!0}).install(x.SELECTION).install(x.AXESHELPER).install(x.GRIDHELPER).install(x.OBJECTHELPER).install(x.VIEWPOINT).install(x.DISPLAYMODE).install(x.STATS).install(x.ORBITCONTROLS).install(x.KEYBOARDMANAGER).install(x.TRANSFORMCONTROLS).complete()}}class Jc extends nr{constructor(r){super(r),this.install(x.WEBGLRENDERER,{antialias:!0,alpha:!0}).install(x.EFFECTCOMPOSER,{WebGLMultisampleRenderTarget:!0}).install(x.ORBITCONTROLS).complete()}}class qc{constructor(r){i(this,"visible",!0);r.visible&&(this.visible=r.visible)}}class Zc extends qc{constructor(e){super(e);i(this,"source");i(this,"target");i(this,"mode");i(this,"cacheSourceMatrix");i(this,"cacheTargetMatrix");i(this,"cacheSoruceGeometryUuid");i(this,"cacheTargetGeometryUuid");i(this,"originalGeometry");i(this,"modifiedGeometry");this.source=e.source,this.target=e.target,this.mode=e.mode||"subtract",this.cacheSourceMatrix=this.source.matrix.clone(),this.cacheTargetMatrix=this.target.matrix.clone(),this.cacheSoruceGeometryUuid=this.source.geometry.uuid,this.cacheTargetGeometryUuid=this.target.geometry.uuid,this.originalGeometry=this.source.geometry,this.modifiedGeometry=new c.BufferGeometry,this.modify(),this.source.geometry=this.modifiedGeometry}async modify(){const e=this.source,n={geometry:this.originalGeometry,matrix:this.source.matrix},s=Gt.CSG.fromMesh(n),o=Gt.CSG.fromMesh(this.target),a=Gt.CSG.toGeometry(s[this.mode](o),e.matrix);this.modifiedGeometry.copy(a),this.modifiedGeometry.uuid=a.uuid}render(){if(this.visible){if(!this.cacheSourceMatrix.equals(this.source.matrix)){this.modify(),this.cacheSourceMatrix.copy(this.source.matrix);return}if(!this.cacheTargetMatrix.equals(this.target.matrix)){this.modify(),this.cacheTargetMatrix.copy(this.target.matrix);return}if(this.originalGeometry.uuid!==this.cacheSoruceGeometryUuid){this.modify(),this.cacheSoruceGeometryUuid=this.originalGeometry.uuid;return}if(this.target.geometry.uuid!==this.cacheTargetGeometryUuid){this.modify(),this.cacheTargetGeometryUuid=this.target.geometry.uuid;return}}else this.modifiedGeometry.copy(this.originalGeometry)}apply(){this.originalGeometry.copy(this.modifiedGeometry),this.originalGeometry.uuid=this.modifiedGeometry.uuid,this.source.geometry=this.originalGeometry}dispose(){this.source.geometry=this.originalGeometry,this.modifiedGeometry.dispose()}}class el{next(){console.warn(`this action can not set next function: ${this.constructor.name}`)}prev(){console.warn(`this action can not set prev function: ${this.constructor.name}`)}}class tl{constructor(r){i(this,"actionList",[]);i(this,"index",-1);i(this,"step",50);this.step=r||50}do(r){this.actionList[this.index][r]()}apply(r,e=!1){const n=this.actionList;this.index===n.length-1&&n.length>=this.step?(n.shift(),this.index=this.actionList.length-1):this.index!==-1?n.splice(this.index+1,n.length-1):this.index===-1&&(this.actionList=[]),this.actionList.push(r),e?this.redo():this.index+=1}redo(){if(this.index+=1,this.index>this.actionList.length-1){this.index=this.actionList.length-1;return}this.do("next")}undo(){this.index<0||(this.do("prev"),this.index-=1)}clear(){this.actionList=[]}}const gn=(t,r={})=>{let e=JSON.stringify(t,ft.stringify);const n={},s=Object.keys(t).filter(a=>a!=="assets");for(const a of s)for(const l of t[a]){const d=l.vid,p=Z.v4();e=e.replace(new RegExp(d,"g"),p),r.detail&&(n[d]=p)}const o=JSON.parse(e,ft.parse);if(r.fillName)if(typeof r.fillName=="function")for(const a of s)for(const l of o[a])l.name||(l.name=r.fillName(l));else for(const a of s)for(const l of o[a])l.name||(l.name=`${l.type}-${l.vid.slice(-2)}`);return r.detail?{config:o,detail:n}:o},yn=(t,r,e={clone:!0,assets:!1})=>{const n=e.clone?ft.clone(t):t,s=e.assets?Object.keys(n):Object.keys(n).filter(o=>o!=="assets");for(const o of s)n[o].forEach((l,d,p)=>{p[d]=r(l)});return n},En=function(t){const r={};for(const e of Object.keys(t))for(const n of t[e])r[n.name]=n;return r};var rl={clone:gn,handler:yn,planish:En};const ur=class{constructor(r){i(this,"token",Symbol("VIS.RENDER.WATCHER"));i(this,"target",{});i(this,"path","");i(this,"dep",{});i(this,"ob");i(this,"run");this.run=r,ur.map.set(this.token,this)}init(r,e,n){this.target=e,this.path=r,this.ob=n}notify(r){this.dep[r]&&this.update()}update(){const r=this.path.split("."),e=r.pop();let n=this.target;for(const o of r)n=n[o];const s=this.ob.subscribe(o=>{o.operate==="get"&&(this.dep[o.path]=!0)});n[e]=this.run(),s.unsubscribe()}};let ct=ur;i(ct,"map",new Map);class nl extends It.Subject{constructor(){super();i(this,"subscriptions",[]);i(this,"watchers",[])}watch(e){const n=qt(e);if(!n){console.error("Observer: can not found observable",e);return}for(const o in e)if(ze(e[o])){const a=qt(e[o]);if(!a)continue;this.subscriptions.push(a.subscribe(l=>{n.next({operate:l.operate,path:be(o,l.path),key:l.key,value:l.value})}))}this.subscriptions.push(n.subscribe(o=>{this.next(o)})),this.subscriptions.push(this.subscribe(o=>{if(o.operate!=="get")for(const a of this.watchers)a.notify(o.path)}));const s=(o,a="")=>{for(const l in o){const d=be(a,l);if(typeof o[l]=="symbol"){const p=ct.map.get(o[l]);if(!p)continue;p.init(d,e,this),this.watchers.push(p)}else ze(o[l])&&!n.isIgnore(d)&&s(o[l],d)}};s(e);for(const o of this.watchers)o.update()}dispose(){for(const e of this.subscriptions)e.unsubscribe()}}const Sn=function(t){return new ct(t).token},sl=function(t){const r={name:Symbol("VIS.RENDER.EVENT")};return G.register(r,()=>t),r},Mn=function(t,r){return q(t,r,!1)},ol=["beforeLoad","loaded","beforeCreate","created","beforeRender","rednered","beforeDispose","disposed"],Pt=class extends te{constructor(e){super();i(this,"wid",Z.v4());i(this,"parent","");i(this,"name");i(this,"observed",{});i(this,"options");i(this,"load",[]);i(this,"render",{});i(this,"observer",new nl);this.options=e,this.name=`${e.name}-${this.wid.slice(-4)}`}initMixins(){}initLifetimes(){const e=this.options;for(const n of ol)e[n]&&this.on(n,()=>{e[n]()})}async createLoad(e){const s=this.options.load;this.emit("beforeLoad"),s&&await e.loadResourcesAsync(s),this.emit("created")}createComputed(){const e=this.options.computed||{};for(const n in e)this.observed[n]=Sn(e[n].bind(this.observed))}createRender(e){const n=this.options.render.call(this.observed,Mn,()=>{},Sn,sl,s=>En(yn(gn(e.resourceManager.getResourceConfig(s),{fillName:!0}),o=>Mn(o.type,o))));for(const s in n)this.observed[s]=n[s],this.render[s]=!0;for(const s in this.options.resources||{})delete this.observed[s]}createObserved(){const e=this.options,n={},s=e.methods||{};for(const a in s)n[a]=!0;const o=Object.assign(this.observed,e.input,e.data&&e.data(n),s);e.beforeCreate&&e.beforeCreate(o),this.observed=Jt(o,n)}createResources(e){const n=this.options.resources;n&&e.registerResources(n.call(this.observed))}initObserver(){this.observer.watch(this.observed),this.options.created&&this.options.created.call(this.observed)}createWatch(){const e=this.options.watch||{};for(const n in e){const s=e[n];let o;if(typeof s=="object"){if(s.immediate){let a=this.observed;const l=n.split("."),d=l.pop();for(const h of l)a=a[h];const p=a[d];s.handler.call(this.observed,p)}o=s.handler}else o=s;this.observer.subscribe(a=>{const{operate:l,key:d,path:p,value:h}=a;l!=="get"&&n===p&&o.call(this.observed,h)})}}async init(e){const n=this.options;this.initLifetimes(),await this.createLoad(e),this.createObserved(),this.createResources(e),this.createComputed(),this.createRender(e),this.initObserver(),this.emit("beforeRender");const s=e.dataSupportManager,o=q(u.GROUP);Object.keys(this.render).forEach(l=>{const d=this.observed[l],p=Ne(d.type);p?(p.toLocaleUpperCase()in Nt&&(d.parent||o.children.push(d.vid)),s.applyConfig(d)):console.warn(`widget can not support this config type: ${d.type}`)}),s.applyConfig(o),e.getConfigBySymbol(n.parent).children.push(o.vid),this.parent=n.parent,ve.append(()=>(this.createWatch(),this.emit("rendered"),!0))}exportConfig(){}loadConfig(){}};let lt=Pt;i(lt,"components",{}),i(lt,"component",function(e){if(Pt.components[e.name]){console.warn(`${e.name} components has exist`);return}Pt.components[e.name]=e});const il="0.3.2";window.__THREE__||console.error("vis-three dependent on three.js module, pleace run 'npm i three' first."),window.__VIS__?console.warn("Duplicate vis-three frames are introduced"):window.__VIS__=il,c.Scene.prototype.add=function(...t){if(!arguments.length)return this;if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}const r=t[0];if(r===this)return console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this;if(r&&r.isObject3D){if(r.parent!==null){const e=this.children.indexOf(r);e!==-1&&(r.parent=null,this.children.splice(e,1),r.dispatchEvent({type:"removed"}))}r.parent=this,this.children.push(r),r.dispatchEvent({type:"added"})}else console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t);return this};const al=c.Scene.prototype.add,cl=c.Scene.prototype.remove;c.Scene.prototype.add=function(...t){return al.call(this,...t),this.dispatchEvent({type:"afterAdd",objects:t}),this},c.Scene.prototype.remove=function(...t){return cl.call(this,...t),this.dispatchEvent({type:"afterRemove",objects:t}),this};const sr=new _n.LightShadow(new c.OrthographicCamera(-256,256,256,-256));sr.autoUpdate=!1,sr.needsUpdate=!1,c.AmbientLight.prototype.shadow=sr,Yn.RectAreaLightUniformsLib.init(),f.Action=el,f.AniScriptLibrary=he,f.AnimationDataSupport=_r,f.BooleanModifier=Zc,f.CONFIGMODULE=us,f.CONFIGTYPE=u,f.CSS2DDataSupport=Kr,f.CSS3DDataSupport=Xr,f.CSS3DPlane=tn,f.CameraDataSupport=Ur,f.CameraHelper=tr,f.CanvasGenerator=ot,f.ControlsDataSupport=zr,f.DISPLAYMODE=hn,f.DataContainer=nt,f.DataSupportManager=Jr,f.DirectionalLightHelper=pn,f.DisplayEngine=_c,f.DisplayEngineSupport=Jc,f.ENGINEPLUGIN=x,f.EVENTNAME=Ht,f.Engine=I,f.EngineSupport=nr,f.EventDispatcher=te,f.EventLibrary=G,f.GeometryDataSupport=Gr,f.GroupDataSupport=Wr,f.GroupHelper=at,f.History=tl,f.JSONHandler=Ro,f.KeyboardManager=dn,f.LightDataSupport=Ir,f.LineDataSupport=kr,f.LoaderManager=br,f.MODULETYPE=y,f.MaterialDataSupport=Br,f.MaterialDisplayer=xe,f.MeshDataSupport=$r,f.ModelingEngine=Xc,f.ModelingEngineSupport=Kc,f.OBJECTMODULE=Nt,f.Object3DDataSupport=Qr,f.PassDataSupport=Yr,f.PointLightHelper=mn,f.PointsDataSupport=Vr,f.RESOURCEEVENTTYPE=Or,f.RenderManager=yr,f.RendererDataSupport=Hr,f.ResourceManager=Ar,f.SceneDataSupport=Nr,f.SelectiveBloomPass=_e,f.ShaderLibrary=ee,f.SpotLightHelper=fn,f.SpriteDataSupport=Fr,f.SupportDataGenerator=Qc,f.TIMINGFUNCTION=K,f.Template=rl,f.TextureDataSupport=jr,f.TextureDisplayer=At,f.Translater=Pr,f.Utils=bo,f.VIEWPOINT=Y,f.VideoLoader=Me,f.Widget=lt,f.generateConfig=q,f.getModule=Ne,f.isObject=wr,f.isObjectModule=vr,f.observable=Jt,f.uniqueSymbol=z,Object.defineProperty(f,"__esModule",{value:!0}),f[Symbol.toStringTag]="Module"});
