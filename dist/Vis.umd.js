var ol=Object.defineProperty,al=Object.defineProperties;var cl=Object.getOwnPropertyDescriptors;var Bs=Object.getOwnPropertySymbols;var ll=Object.prototype.hasOwnProperty,ul=Object.prototype.propertyIsEnumerable;var un=(a,l,W)=>l in a?ol(a,l,{enumerable:!0,configurable:!0,writable:!0,value:W}):a[l]=W,Y=(a,l)=>{for(var W in l||(l={}))ll.call(l,W)&&un(a,W,l[W]);if(Bs)for(var W of Bs(l))ul.call(l,W)&&un(a,W,l[W]);return a},ot=(a,l)=>al(a,cl(l));var h=(a,l,W)=>(un(a,typeof l!="symbol"?l+"":l,W),W);(function(a,l){typeof exports=="object"&&typeof module!="undefined"?l(exports,require("three"),require("three/examples/jsm/libs/stats.module"),require("three/examples/jsm/postprocessing/EffectComposer"),require("three/examples/jsm/postprocessing/RenderPass"),require("three/examples/jsm/controls/TransformControls"),require("three/examples/jsm/loaders/OBJLoader"),require("three/examples/jsm/loaders/MTLLoader"),require("three/examples/jsm/loaders/RGBELoader"),require("uuid"),require("three/examples/jsm/renderers/CSS3DRenderer"),require("@tweenjs/tween.js"),require("three/examples/jsm/postprocessing/SMAAPass"),require("three/examples/jsm/postprocessing/UnrealBloomPass"),require("three/examples/jsm/postprocessing/Pass"),require("three/examples/jsm/shaders/LuminosityHighPassShader"),require("keyboardjs"),require("three-csg-ts"),require("three/src/lights/LightShadow")):typeof define=="function"&&define.amd?define(["exports","three","three/examples/jsm/libs/stats.module","three/examples/jsm/postprocessing/EffectComposer","three/examples/jsm/postprocessing/RenderPass","three/examples/jsm/controls/TransformControls","three/examples/jsm/loaders/OBJLoader","three/examples/jsm/loaders/MTLLoader","three/examples/jsm/loaders/RGBELoader","uuid","three/examples/jsm/renderers/CSS3DRenderer","@tweenjs/tween.js","three/examples/jsm/postprocessing/SMAAPass","three/examples/jsm/postprocessing/UnrealBloomPass","three/examples/jsm/postprocessing/Pass","three/examples/jsm/shaders/LuminosityHighPassShader","keyboardjs","three-csg-ts","three/src/lights/LightShadow"],l):(a=typeof globalThis!="undefined"?globalThis:a||self,l(a.Vis={},a.three,a.Stats,a.EffectComposer,a.RenderPass,a.TransformControls,a.OBJLoader,a.MTLLoader,a.RGBELoader,a.uuid,a.CSS3DRenderer,a.tween_js,a.SMAAPass,a.UnrealBloomPass,a.Pass,a.LuminosityHighPassShader,a.keyboardjs,a.threeCsgTs,a.LightShadow))})(this,function(a,l,W,Lt,Pt,ys,Ss,Rs,Os,se,we,w,Gs,bs,dn,hn,Is,Dt,Ls){"use strict";function pn(n){return n&&typeof n=="object"&&"default"in n?n:{default:n}}var Ps=pn(W),at=pn(Is);class re{constructor(){h(this,"listeners",new Map)}addEventListener(e,t){const s=this.listeners;s.has(e)||s.set(e,new Set),s.get(e).add(t)}hasEventListener(e,t){const s=this.listeners;return s.has(e)?s.get(e).has(t):!1}removeEventListener(e,t){const s=this.listeners;!s.has(e)||!s.get(e).has(t)||s.get(e).delete(t)}dispatchEvent(e){var r;const t=e.type,s=this.listeners;if(s.has(t))try{(r=s.get(t))==null||r.forEach(i=>{i.call(this,e)})}catch(i){console.error(i)}}clear(){this.listeners=new Map}useful(){return Boolean([...this.listeners.keys()].length)}once(e,t){const s=function(r){t.call(this,r),this.removeEventListener(e,s)};this.addEventListener(e,s)}}class fn extends re{constructor(e=0){super();h(this,"clock",new l.Clock);h(this,"animationFrame",-1);h(this,"fps",0);h(this,"timer",null);h(this,"playFun",()=>{});h(this,"render",()=>{this.dispatchEvent({type:"render",delta:this.clock.getDelta(),total:this.clock.getElapsedTime()})});h(this,"play",()=>{if(this.hasRendering()){console.warn("render manager is rendering.");return}this.dispatchEvent({type:"play"}),this.playFun()});h(this,"stop",()=>{this.animationFrame!==-1&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=-1),this.timer&&(clearTimeout(this.timer),this.timer=null),this.dispatchEvent({type:"stop"})});h(this,"hasRendering",()=>Boolean(this.animationFrame!==-1||this.timer));h(this,"hasVaildRender",()=>this.useful());this.setFPS(e)}setFPS(e){return this.animationFrame!==-1&&cancelAnimationFrame(this.animationFrame),this.timer&&clearTimeout(this.timer),this.fps=e,e<=0?(this.fps=0,this.playFun=()=>{this.render(),this.animationFrame=requestAnimationFrame(this.playFun)}):this.playFun=()=>{this.timer=setTimeout(()=>{this.playFun()},e),this.render()},this.playFun(),this}dispose(){this.hasRendering()&&this.stop(),this.clear()}}const Ds=function(){return this.renderManager?(console.warn("has installed render manager plugin."),!1):(this.renderManager=new fn,this.render=function(){return this.renderManager.render(),this},this.play=function(){return this.renderManager.play(),this},this.stop=function(){return this.renderManager.stop(),this},this.addEventListener("dispose",()=>{this.renderManager.dispose()}),!0)};class mn extends re{constructor(e,t){super();h(this,"object");h(this,"domElement");h(this,"enabled",!0);h(this,"target",new l.Vector3);h(this,"minDistance",0);h(this,"maxDistance",1/0);h(this,"minZoom",0);h(this,"maxZoom",1/0);h(this,"minPolarAngle",0);h(this,"maxPolarAngle",Math.PI);h(this,"minAzimuthAngle",-1/0);h(this,"maxAzimuthAngle",1/0);h(this,"enableDamping",!1);h(this,"dampingFactor",.05);h(this,"enableZoom",!0);h(this,"zoomSpeed",1);h(this,"enableRotate",!0);h(this,"rotateSpeed",1);h(this,"enablePan",!0);h(this,"panSpeed",1);h(this,"screenSpacePanning",!0);h(this,"keyPanSpeed",7);h(this,"autoRotate",!1);h(this,"autoRotateSpeed",2);h(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"});h(this,"mouseButtons",{LEFT:null,MIDDLE:l.MOUSE.DOLLY,RIGHT:l.MOUSE.ROTATE});h(this,"touches",{ONE:l.TOUCH.ROTATE,TWO:l.TOUCH.DOLLY_PAN});h(this,"target0");h(this,"position0");h(this,"zoom0");h(this,"_domElementKeyEvents",null);h(this,"spherical");h(this,"reset");h(this,"update");h(this,"onContextMenu");h(this,"onPointerDown");h(this,"onPointerCancel");h(this,"onMouseWheel");h(this,"onPointerMove");h(this,"onPointerUp");h(this,"onKeyDown");this.object=e||new l.PerspectiveCamera,this.domElement=t||document.createElement("div"),this.domElement.style.touchAction="none",this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.update=(()=>{const g=new l.Vector3,G=new l.Quaternion().setFromUnitVectors(this.object.up,new l.Vector3(0,1,0)),x=G.clone().invert(),K=new l.Vector3,De=new l.Quaternion,Fe=2*Math.PI;return()=>{const Ts=this.object.position;g.copy(Ts).sub(this.target),g.applyQuaternion(G),o.setFromVector3(g),this.autoRotate&&r===s.NONE&&I(B()),this.enableDamping?(o.theta+=c.theta*this.dampingFactor,o.phi+=c.phi*this.dampingFactor):(o.theta+=c.theta,o.phi+=c.phi);let Te=this.minAzimuthAngle,Be=this.maxAzimuthAngle;return isFinite(Te)&&isFinite(Be)&&(Te<-Math.PI?Te+=Fe:Te>Math.PI&&(Te-=Fe),Be<-Math.PI?Be+=Fe:Be>Math.PI&&(Be-=Fe),Te<=Be?o.theta=Math.max(Te,Math.min(Be,o.theta)):o.theta=o.theta>(Te+Be)/2?Math.max(Te,o.theta):Math.min(Be,o.theta)),o.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,o.phi)),o.makeSafe(),o.radius*=u,o.radius=Math.max(this.minDistance,Math.min(this.maxDistance,o.radius)),this.enableDamping===!0?this.target.addScaledVector(d,this.dampingFactor):this.target.add(d),g.setFromSpherical(o),g.applyQuaternion(x),Ts.copy(this.target).add(g),this.object.lookAt(this.target),this.enableDamping===!0?(c.theta*=1-this.dampingFactor,c.phi*=1-this.dampingFactor,d.multiplyScalar(1-this.dampingFactor)):(c.set(0,0,0),d.set(0,0,0)),u=1,p||K.distanceToSquared(this.object.position)>i||8*(1-De.dot(this.object.quaternion))>i?(this.dispatchEvent({type:"change"}),K.copy(this.object.position),De.copy(this.object.quaternion),p=!1,!0):!1}})();const s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let r=s.NONE;const i=1e-6,o=new l.Spherical,c=new l.Spherical;let u=1;const d=new l.Vector3;let p=!1;const f=new l.Vector2,m=new l.Vector2,E=new l.Vector2,A=new l.Vector2,M=new l.Vector2,T=new l.Vector2,C=new l.Vector2,S=new l.Vector2,y=new l.Vector2,R=[],P={},B=()=>2*Math.PI/60/60*this.autoRotateSpeed,F=()=>Math.pow(.95,this.zoomSpeed),I=g=>{c.theta-=g},b=g=>{c.phi-=g},he=function(){const g=new l.Vector3;return function(x,K){g.setFromMatrixColumn(K,0),g.multiplyScalar(-x),d.add(g)}}(),pe=(()=>{const g=new l.Vector3;return(G,x)=>{this.screenSpacePanning===!0?g.setFromMatrixColumn(x,1):(g.setFromMatrixColumn(x,0),g.crossVectors(this.object.up,g)),g.multiplyScalar(G),d.add(g)}})(),z=(()=>{const g=new l.Vector3;return(G,x)=>{const K=this.domElement;if(this.object instanceof l.PerspectiveCamera){const De=this.object.position;g.copy(De).sub(this.target);let Fe=g.length();Fe*=Math.tan(this.object.fov/2*Math.PI/180),he(2*G*Fe/K.clientHeight,this.object.matrix),pe(2*x*Fe/K.clientHeight,this.object.matrix)}else this.object instanceof l.OrthographicCamera?(he(G*(this.object.right-this.object.left)/this.object.zoom/K.clientWidth,this.object.matrix),pe(x*(this.object.top-this.object.bottom)/this.object.zoom/K.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}})(),_=g=>{this.object instanceof l.PerspectiveCamera?u/=g:this.object instanceof l.OrthographicCamera?(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*g)),this.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)},fe=g=>{this.object instanceof l.PerspectiveCamera?u*=g:this.object instanceof l.OrthographicCamera?(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/g)),this.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)};function ne(g){f.set(g.clientX,g.clientY)}function bt(g){C.set(g.clientX,g.clientY)}function It(g){A.set(g.clientX,g.clientY)}const an=g=>{m.set(g.clientX,g.clientY),E.subVectors(m,f).multiplyScalar(this.rotateSpeed);const G=this.domElement;I(2*Math.PI*E.x/G.clientHeight),b(2*Math.PI*E.y/G.clientHeight),f.copy(m),this.update()},Kc=g=>{S.set(g.clientX,g.clientY),y.subVectors(S,C),y.y>0?_(F()):y.y<0&&fe(F()),C.copy(S),this.update()},Wc=g=>{M.set(g.clientX,g.clientY),T.subVectors(M,A).multiplyScalar(this.panSpeed),z(T.x,T.y),A.copy(M),this.update()},Qc=g=>{g.deltaY<0?fe(F()):g.deltaY>0&&_(F()),this.update()},Vc=g=>{let G=!1;switch(g.code){case this.keys.UP:z(0,this.keyPanSpeed),G=!0;break;case this.keys.BOTTOM:z(0,-this.keyPanSpeed),G=!0;break;case this.keys.LEFT:z(this.keyPanSpeed,0),G=!0;break;case this.keys.RIGHT:z(-this.keyPanSpeed,0),G=!0;break}G&&(g.preventDefault(),this.update())};function ps(){if(R.length===1)f.set(R[0].pageX,R[0].pageY);else{const g=.5*(R[0].pageX+R[1].pageX),G=.5*(R[0].pageY+R[1].pageY);f.set(g,G)}}function fs(){if(R.length===1)A.set(R[0].pageX,R[0].pageY);else{const g=.5*(R[0].pageX+R[1].pageX),G=.5*(R[0].pageY+R[1].pageY);A.set(g,G)}}function ms(){const g=R[0].pageX-R[1].pageX,G=R[0].pageY-R[1].pageY,x=Math.sqrt(g*g+G*G);C.set(0,x)}const Xc=()=>{this.enableZoom&&ms(),this.enablePan&&fs()},zc=()=>{this.enableZoom&&ms(),this.enableRotate&&ps()},Es=g=>{if(R.length==1)m.set(g.pageX,g.pageY);else{const x=ln(g),K=.5*(g.pageX+x.x),De=.5*(g.pageY+x.y);m.set(K,De)}E.subVectors(m,f).multiplyScalar(this.rotateSpeed);const G=this.domElement;I(2*Math.PI*E.x/G.clientHeight),b(2*Math.PI*E.y/G.clientHeight),f.copy(m)},gs=g=>{if(R.length===1)M.set(g.pageX,g.pageY);else{const G=ln(g),x=.5*(g.pageX+G.x),K=.5*(g.pageY+G.y);M.set(x,K)}T.subVectors(M,A).multiplyScalar(this.panSpeed),z(T.x,T.y),A.copy(M)},As=g=>{const G=ln(g),x=g.pageX-G.x,K=g.pageY-G.y,De=Math.sqrt(x*x+K*K);S.set(0,De),y.set(0,Math.pow(S.y/C.y,this.zoomSpeed)),_(y.y),C.copy(S)},Zc=g=>{this.enableZoom&&As(g),this.enablePan&&gs(g)},$c=g=>{this.enableZoom&&As(g),this.enableRotate&&Es(g)};this.onPointerDown=g=>{this.enabled!==!1&&(R.length===0&&(this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp)),il(g),g.pointerType==="touch"?nl(g):qc(g))};let cn=!1;this.onPointerMove=g=>{this.enabled!==!1&&(cn||(this.domElement.setPointerCapture(g.pointerId),cn=!0),g.pointerType==="touch"?sl(g):el(g))},this.onPointerUp=g=>{this.enabled!==!1&&(cn=!1,g.pointerType==="touch"?rl():tl(g),Cs(g),R.length===0&&(this.domElement.releasePointerCapture(g.pointerId),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)))},this.onPointerCancel=g=>{Cs(g)};const qc=g=>{let G;switch(g.button){case 0:G=this.mouseButtons.LEFT;break;case 1:G=this.mouseButtons.MIDDLE;break;case 2:G=this.mouseButtons.RIGHT;break;default:G=-1}switch(G){case l.MOUSE.DOLLY:if(this.enableZoom===!1)return;bt(g),r=s.DOLLY;break;case l.MOUSE.ROTATE:if(g.ctrlKey||g.metaKey||g.shiftKey){if(this.enablePan===!1)return;It(g),r=s.PAN}else{if(this.enableRotate===!1)return;ne(g),r=s.ROTATE}break;case l.MOUSE.PAN:if(g.ctrlKey||g.metaKey||g.shiftKey){if(this.enableRotate===!1)return;ne(g),r=s.ROTATE}else{if(this.enablePan===!1)return;It(g),r=s.PAN}break;default:r=s.NONE}r!==s.NONE&&this.dispatchEvent({type:"start"})},el=g=>{if(this.enabled!==!1)switch(r){case s.ROTATE:if(this.enableRotate===!1)return;an(g);break;case s.DOLLY:if(this.enableZoom===!1)return;Kc(g);break;case s.PAN:if(this.enablePan===!1)return;Wc(g);break}},tl=g=>{this.dispatchEvent({type:"end"}),r=s.NONE};this.onMouseWheel=g=>{this.enabled===!1||this.enableZoom===!1||r!==s.NONE||(g.preventDefault(),this.dispatchEvent({type:"start"}),Qc(g),this.dispatchEvent({type:"end"}))},this.onKeyDown=g=>{this.enabled===!1||this.enablePan===!1||Vc(g)};const nl=g=>{switch(Ms(g),R.length){case 1:switch(this.touches.ONE){case l.TOUCH.ROTATE:if(this.enableRotate===!1)return;ps(),r=s.TOUCH_ROTATE;break;case l.TOUCH.PAN:if(this.enablePan===!1)return;fs(),r=s.TOUCH_PAN;break;default:r=s.NONE}break;case 2:switch(this.touches.TWO){case l.TOUCH.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;Xc(),r=s.TOUCH_DOLLY_PAN;break;case l.TOUCH.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;zc(),r=s.TOUCH_DOLLY_ROTATE;break;default:r=s.NONE}break;default:r=s.NONE}r!==s.NONE&&this.dispatchEvent({type:"start"})},sl=g=>{switch(Ms(g),r){case s.TOUCH_ROTATE:if(this.enableRotate===!1)return;Es(g),this.update();break;case s.TOUCH_PAN:if(this.enablePan===!1)return;gs(g),this.update();break;case s.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;Zc(g),this.update();break;case s.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;$c(g),this.update();break;default:r=s.NONE}},rl=g=>{this.dispatchEvent({type:"end"}),r=s.NONE};this.onContextMenu=g=>{this.enabled!==!1&&g.preventDefault()};function il(g){R.push(g)}const Cs=g=>{delete P[g.pointerId];for(let G=0;G<R.length;G++)if(R[G].pointerId==g.pointerId){R.splice(G,1);return}};function Ms(g){let G=P[g.pointerId];G===void 0&&(G=new l.Vector2,P[g.pointerId]=G),G.set(g.pageX,g.pageY)}function ln(g){const G=g.pointerId===R[0].pointerId?R[1]:R[0];return P[G.pointerId]}this.spherical=o,this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),this.domElement.addEventListener("wheel",this.onMouseWheel,{passive:!1}),this.reset=()=>{this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent({type:"change"}),this.update(),r=s.NONE},this.update()}getPolarAngle(){return this.spherical.phi}getAzimuthalAngle(){return this.spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this.onKeyDown),this._domElementKeyEvents=e}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}setCamera(e){this.object=e}setDom(e){this.dispose(),this.domElement=e,this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),this.domElement.addEventListener("wheel",this.onMouseWheel,{passive:!1})}dispose(){this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("pointercancel",this.onPointerCancel),this.domElement.removeEventListener("wheel",this.onMouseWheel),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp),this._domElementKeyEvents!==null&&this._domElementKeyEvents.removeEventListener("keydown",this.onKeyDown)}}a.VIEWPOINT=void 0,function(n){n.DEFAULT="default",n.TOP="top",n.BOTTOM="bottom",n.LEFT="left",n.RIGHT="right",n.FRONT="front",n.BACK="back"}(a.VIEWPOINT||(a.VIEWPOINT={}));const Fs=function(n={}){var r;if(!this.webGLRenderer)return console.error("must install some renderer before BasicViewpoint plugin."),!1;!n.viewpoint&&(n.viewpoint=a.VIEWPOINT.DEFAULT),!n.perspective&&(n.perspective={}),!n.perspective.position&&(n.perspective.position={x:60,y:60,z:60}),!n.perspective.lookAt&&(n.perspective.lookAt={x:0,y:0,z:0}),!n.perspective.up&&(n.perspective.up={x:0,y:1,z:0}),!n.orthograpbic&&(n.orthograpbic={}),!n.orthograpbic.up&&(n.orthograpbic.up={x:0,y:1,z:0});const e=new l.PerspectiveCamera;e.position.set(n.perspective.position.x,n.perspective.position.y,n.perspective.position.z),e.lookAt(n.perspective.lookAt.x,n.perspective.lookAt.y,n.perspective.lookAt.z),e.up.set(n.perspective.up.x,n.perspective.up.y,n.perspective.up.z);const t=n.orthograpbic.distance||1e4,s=new l.OrthographicCamera(-window.innerWidth/8,window.innerWidth/8,-window.innerHeight/8,window.innerHeight/8,0,t);return s.up.set(n.perspective.up.x,n.perspective.up.y,n.perspective.up.z),this.setViewpoint=function(i){return this.dispatchEvent({type:"setViewpoint",viewpoint:i}),this},this.addEventListener("setSize",i=>{const o=i.width,c=i.height,u=o/c;e.aspect=u,e.updateProjectionMatrix(),s.left=-t*u,s.right=t*u,s.top=t,s.bottom=-t,s.zoom=t/c*5,s.updateProjectionMatrix()}),(r=n.orthograpbic.allowRotate)!=null,this.addEventListener("setViewpoint",i=>{const o=i.viewpoint;if(o===a.VIEWPOINT.DEFAULT){this.setCamera(e);return}o===a.VIEWPOINT.TOP?s.position.set(0,t/2,0):o===a.VIEWPOINT.BOTTOM?s.position.set(0,-t/2,0):o===a.VIEWPOINT.RIGHT?s.position.set(t/2,0,0):o===a.VIEWPOINT.LEFT?s.position.set(-t/2,0,0):o===a.VIEWPOINT.FRONT?s.position.set(0,0,t/2):o===a.VIEWPOINT.BACK&&s.position.set(0,0,-t/2),this.setCamera(s)}),this.completeSet.add(()=>{n.viewpoint===a.VIEWPOINT.DEFAULT?this.setCamera(e):this.setCamera(s),this.objectHelperManager&&this.objectHelperManager.addFilteredObject(e,s)}),!0},ws=function(n){return this.orbitControls?(console.warn("this has installed orbitControls plugin."),!1):this.renderManager?(this.orbitControls=new mn(this.camera,this.dom),this.addEventListener("setCamera",e=>{e.options.orbitControls&&this.orbitControls.setCamera(e.camera)}),this.addEventListener("setDom",e=>{this.orbitControls.setDom(e.dom)}),this.renderManager.addEventListener("render",()=>{this.orbitControls.update()}),this.completeSet.add(()=>{this.setViewpoint&&this.addEventListener("setViewpoint",e=>{const t=e.viewpoint;this.orbitControls.target.set(0,0,0),t===a.VIEWPOINT.DEFAULT?this.orbitControls.enableRotate=!0:t===a.VIEWPOINT.TOP?this.orbitControls.enableRotate=!1:t===a.VIEWPOINT.BOTTOM?this.orbitControls.enableRotate=!1:t===a.VIEWPOINT.RIGHT?this.orbitControls.enableRotate=!1:t===a.VIEWPOINT.LEFT?this.orbitControls.enableRotate=!1:t===a.VIEWPOINT.FRONT?this.orbitControls.enableRotate=!1:t===a.VIEWPOINT.BACK&&(this.orbitControls.enableRotate=!1)})}),!0):(console.warn("this must install renderManager before install orbitControls plugin."),!1)};class Ns{constructor(e){h(this,"REVISION");h(this,"dom");h(this,"addPanel");h(this,"showPanel");h(this,"begin");h(this,"end");h(this,"update");h(this,"domElement");h(this,"setMode");const t=Ps.default();this.REVISION=t.REVISION,this.dom=t.dom,this.domElement=t.domElement,this.begin=t.begin.bind(t),this.end=t.end.bind(t),this.update=t.update.bind(t),this.addPanel=t.addPanel.bind(t),this.showPanel=t.showPanel.bind(t),this.setMode=t.setMode.bind(t);const s=this.domElement;s.style.position="absolute",s.style.top="0",s.style.left="35px",e&&(s.style.top=`${e.top}px`,s.style.left=`${e.left}px`,s.style.right=`${e.right}px`,s.style.bottom=`${e.bottom}px`)}}const vs=function(n){if(this.stats)return console.warn("this has installed stats plugin."),!1;if(!this.renderManager)return console.warn("this must install renderManager before install stats plugin."),!1;const e=new Ns(n);this.stats=e;const t=()=>{this.stats.update()};return this.setStats=function(s){if(s)this.dom.appendChild(this.stats.domElement),this.renderManager.addEventListener("render",t);else try{this.dom.removeChild(this.stats.domElement),this.renderManager.removeEventListener("render",t)}catch{}return this},!0},Us=function(n={}){if(this.effectComposer)return console.warn("this has installed effect composer plugin."),!1;if(!this.webGLRenderer)return console.error("must install some renderer before this plugin."),!1;let e;if(n.WebGLMultisampleRenderTarget||n.MSAA){const s=this.webGLRenderer,r=s.getPixelRatio(),i=s.getDrawingBufferSize(new l.Vector2);Number(window.__THREE__)>137?e=new Lt.EffectComposer(s,new l.WebGLRenderTarget(i.width*r,i.height*r,{format:n.format||l.RGBAFormat,samples:n.samples||4})):e=new Lt.EffectComposer(s,new l.WebGLMultisampleRenderTarget(i.width*r,i.height*r,{format:n.format||l.RGBAFormat}))}else e=new Lt.EffectComposer(this.webGLRenderer);this.effectComposer=e;let t;return this.scene&&this.camera&&(t=new Pt.RenderPass(this.scene,this.camera),e.addPass(t)),this.addEventListener("setCamera",s=>{if(!t&&this.scene){t=new Pt.RenderPass(this.scene,s.camera),e.addPass(t);return}else t&&(t.camera=s.camera)}),this.addEventListener("setScene",s=>{if(!t&&this.camera){t=new Pt.RenderPass(s.scene,this.camera),e.addPass(t);return}else t&&(t.scene=s.scene)}),this.addEventListener("setSize",s=>{e.setSize(s.width,s.height)}),this.renderManager?(this.renderManager.removeEventListener("render",this.render),this.renderManager.addEventListener("render",s=>{this.effectComposer.render(s.delta)})):this.render=function(){return this.effectComposer.render(),this},!0};class Hs extends re{constructor(e){super();h(this,"dom");h(this,"mouse");h(this,"canMouseMove");h(this,"mouseEventTimer");h(this,"throttleTime");h(this,"pointerDownHandler");h(this,"pointerMoveHandler");h(this,"pointerUpHandler");h(this,"mouseDownHandler");h(this,"mouseUpHandler");h(this,"clickHandler");h(this,"dblclickHandler");h(this,"contextmenuHandler");this.dom=e.dom,this.mouse=new l.Vector2,this.canMouseMove=!0,this.mouseEventTimer=null,this.throttleTime=e.throttleTime||1e3/60;const t=r=>{const i={mouse:{x:this.mouse.x,y:this.mouse.y}};for(const o in r)i[o]=r[o];return i},s=r=>{this.dispatchEvent(t(r))};this.pointerMoveHandler=r=>{!this.canMouseMove||(this.canMouseMove=!1,this.mouseEventTimer=window.setTimeout(()=>{const i=this.mouse,o=this.dom,c=o.getBoundingClientRect();i.x=(r.clientX-c.left)/o.offsetWidth*2-1,i.y=-((r.clientY-c.top)/o.offsetHeight)*2+1,this.canMouseMove=!0,this.dispatchEvent(t(r))},this.throttleTime))},this.mouseDownHandler=s,this.mouseUpHandler=s,this.pointerDownHandler=s,this.pointerUpHandler=s,this.clickHandler=s,this.dblclickHandler=s,this.contextmenuHandler=s}setDom(e){if(this.dom){const t=this.dom;t.removeEventListener("mousedown",this.mouseDownHandler),t.removeEventListener("mouseup",this.mouseUpHandler),t.removeEventListener("pointerdown",this.pointerDownHandler),t.removeEventListener("pointermove",this.pointerMoveHandler),t.removeEventListener("pointerup",this.pointerUpHandler),t.removeEventListener("click",this.clickHandler),t.removeEventListener("dblclick",this.dblclickHandler),t.removeEventListener("contextmenu",this.contextmenuHandler)}return e.addEventListener("mousedown",this.mouseDownHandler),e.addEventListener("mouseup",this.mouseUpHandler),e.addEventListener("pointerdown",this.pointerDownHandler),e.addEventListener("pointermove",this.pointerMoveHandler),e.addEventListener("pointerup",this.pointerUpHandler),e.addEventListener("click",this.clickHandler),e.addEventListener("dblclick",this.dblclickHandler),e.addEventListener("contextmenu",this.contextmenuHandler),this.dom=e,this}getNormalMouse(){return this.mouse}}const xs=function(n){if(this.pointerManager)return console.warn("this has installed pointerManager plugin."),!1;const e=new Hs(Object.assign(n||{},{dom:this.dom}));return this.addEventListener("setDom",t=>{e.setDom(t.dom)}),this.pointerManager=e,!0};a.EVENTNAME=void 0,function(n){n.POINTERDOWN="pointerdown",n.POINTERUP="pointerup",n.POINTERMOVE="pointermove",n.POINTERENTER="pointerenter",n.POINTERLEAVE="pointerleave",n.CLICK="click",n.DBLCLICK="dblclick",n.CONTEXTMENU="contextmenu"}(a.EVENTNAME||(a.EVENTNAME={}));class Ys extends re{constructor(e){super();h(this,"raycaster");h(this,"scene");h(this,"camera");h(this,"filter",new Set);h(this,"recursive",!1);h(this,"penetrate",!1);h(this,"propagation",!1);h(this,"delegation",!1);this.raycaster=new l.Raycaster,this.camera=e.camera,this.scene=e.scene,e.recursive&&(this.recursive=e.recursive),e.penetrate&&(this.penetrate=e.penetrate)}setScene(e){return this.scene=e,this}setCamera(e){return this.camera=e,this}addFilterObject(e){return this.filter.add(e),this}removeFilterObject(e){return this.filter.delete(e),this}intersectObject(e){this.raycaster.setFromCamera(e,this.camera);const t=this.filter,s=this.scene.children.filter(r=>!t.has(r));return this.raycaster.intersectObjects(s,this.recursive)}use(e){const t=function(c,u){return Object.assign({},c,u)},s=(c,u)=>{const d=this.intersectObject(c.mouse);if(d.length)if(this.penetrate)for(const p of d)p.object.dispatchEvent(t(c,{type:u,intersection:p}));else{const p=d[0];p.object.dispatchEvent(t(c,{type:u,intersection:p}))}this.dispatchEvent(t(c,{type:u,intersections:d}))},r=["pointerdown","pointerup","mousedown","mouseup","pointermove","click","dblclick","contextmenu"];for(const c of r)e.addEventListener(c,u=>{s(u,c)});const i=new Map;let o=null;return e.addEventListener("pointermove",c=>{const u=this.intersectObject(c.mouse);if(this.penetrate){if(!u.length){i.forEach(d=>{d.object.dispatchEvent(t(c,{type:"pointerleave",intersection:d})),d.object.dispatchEvent(t(c,{type:"mouseleave",intersection:d}))}),i.clear();return}for(const d of u)i.has(d.object)?(d.object.dispatchEvent(t(c,{type:"pointermove",intersection:d})),d.object.dispatchEvent(t(c,{type:"mousemove",intersection:d})),i.delete(d.object)):(d.object.dispatchEvent(t(c,{type:"pointerenter",intersection:d})),d.object.dispatchEvent(t(c,{type:"mouseenter",intersection:d})));for(const d of i.values())d.object.dispatchEvent(t(c,{type:"pointerleave",intersection:d})),d.object.dispatchEvent(t(c,{type:"mouseleave",intersection:d}));i.clear();for(const d of u)i.set(d.object,d)}else{if(!u.length){o&&(o.object.dispatchEvent(t(c,{type:"pointerleave",intersection:o})),o.object.dispatchEvent(t(c,{type:"mouseleave",intersection:o})),o=null);return}const d=u[0];if(!o){d.object.dispatchEvent(t(c,{type:"pointerenter",intersection:d})),d.object.dispatchEvent(t(c,{type:"mouseenter",intersection:d})),o=d;return}if(d.object!==o.object){o.object.dispatchEvent(t(c,{type:"pointerleave",intersection:d})),o.object.dispatchEvent(t(c,{type:"mouseleave",intersection:d})),d.object.dispatchEvent(t(c,{type:"pointerenter",intersection:d})),d.object.dispatchEvent(t(c,{type:"mouseenter",intersection:d})),o=d;return}d.object===o.object&&(d.object.dispatchEvent(t(c,{type:"pointermove",intersection:d})),d.object.dispatchEvent(t(c,{type:"mousemove",intersection:d})))}this.dispatchEvent(t(c,{type:"pointermove",intersections:u})),this.dispatchEvent(t(c,{type:"mousemove",intersections:u}))}),this}}const js=function(n){if(this.eventManager)return console.warn("engine has installed eventManager plugin."),!1;if(!this.pointerManager)return console.error("must install pointerManager before this plugin."),!1;const e=new Ys(Object.assign({scene:this.scene,camera:this.camera},n));return e.use(this.pointerManager),this.eventManager=e,this.addEventListener("setCamera",t=>{this.eventManager.setCamera(t.camera)}),this.addEventListener("setScene",t=>{this.eventManager.setScene(t.scene)}),!0};var ct;(function(n){n.OBJECTCHANGED="objectChanged"})(ct||(ct={}));class En extends ys.TransformControls{constructor(e,t){!e&&(e=new l.PerspectiveCamera),!t&&(t=document.body);super(e,t);h(this,"target");h(this,"transObjectSet");this.domElement.removeEventListener("pointerdown",this._onPointerDown),this._onPointerDown=u=>{var d;!this.enabled||!((d=this.object)==null?void 0:d.parent)||(this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(u)),this.pointerDown(this._getPointer(u)))},this.domElement.addEventListener("pointerdown",this._onPointerDown),this.target=new l.Object3D,this.transObjectSet=new Set;let s="";const r=this.target,i=this.transObjectSet,o={x:0,y:0,z:0},c=new WeakMap;this.addEventListener("mouseDown",u=>{s=u.target.mode,s==="translate"&&(s="position"),s==="rotate"&&(s="rotation"),o.x=r[s].x,o.y=r[s].y,o.z=r[s].z,i.forEach(d=>{c.set(d,d.matrixAutoUpdate),d.matrixAutoUpdate=!1})}),this.addEventListener("objectChange",u=>{const d=r[s].x-o.x,p=r[s].y-o.y,f=r[s].z-o.z;o.x=r[s].x,o.y=r[s].y,o.z=r[s].z,i.forEach(m=>{m[s].x+=d,m[s].y+=p,m[s].z+=f,m.updateMatrix(),m.updateMatrixWorld()}),this.dispatchEvent({type:ct.OBJECTCHANGED,transObjectSet:i,mode:s,target:r})}),this.addEventListener("mouseUp",u=>{i.forEach(d=>{d.matrixAutoUpdate=c.get(d),c.delete(d)})})}setDom(e){return this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),e.addEventListener("pointerdown",this._onPointerDown),e.addEventListener("pointermove",this._onPointerHover),e.addEventListener("pointerup",this._onPointerUp),this.domElement=e,this}setCamera(e){return this.camera=e,this}getTarget(){return this.target}getTransObjectSet(){return this.transObjectSet}setAttach(...e){if(this.transObjectSet.clear(),!e.length||!e[0])return this.detach(),this;this.attach(this.target);const t=this.target;if(e.length===1){const o=e[0];return o.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.updateMatrix(),t.updateMatrixWorld(),this.transObjectSet.add(o),this}const s=[],r=[],i=[];return e.forEach(o=>{s.push(o.matrixWorld.elements[12]),r.push(o.matrixWorld.elements[13]),i.push(o.matrixWorld.elements[14])}),t.rotation.set(0,0,0),t.scale.set(0,0,0),t.position.x=(Math.max(...s)-Math.min(...s))/2+Math.min(...s),t.position.y=(Math.max(...r)-Math.min(...r))/2+Math.min(...r),t.position.z=(Math.max(...i)-Math.min(...i))/2+Math.min(...i),t.updateMatrix(),t.updateMatrixWorld(),e.forEach(o=>{this.transObjectSet.add(o)}),this}}const Js=function(n){if(this.transformControls)return console.warn("this has installed transformControls plugin."),!1;if(!this.pointerManager)return console.warn("this must install pointerManager before install transformControls plugin."),!1;if(!this.eventManager)return console.warn("this must install eventManager before install transformControls plugin."),!1;const e=new En(this.camera,this.dom);return e.detach(),this.transformControls=e,this.scene.add(this.transformControls),this.scene.add(this.transformControls.target),this.transformControls.addEventListener("mouseDown",()=>{this.transing=!0}),this.setTransformControls=function(t){return t?this.scene.add(this.transformControls):this.scene.remove(this.transformControls),this},this.addEventListener("setCamera",t=>{t.options.transformControls&&e.setCamera(t.camera)}),this.addEventListener("setDom",t=>{e.setDom(t.dom)}),this.addEventListener("setScene",t=>{const s=t.scene;s.add(this.transformControls.target),s.add(this.transformControls)}),this.selectionBox?this.addEventListener("selected",t=>{e.setAttach(...t.objects)}):this.eventManager.addEventListener("click",t=>{if(this.transing){this.transing=!1;return}if(t.button===0){const r=t.intersections.map(i=>i.object)[0]||null;r?e.setAttach(r):e.detach()}}),this.eventManager.addFilterObject(e),this.completeSet.add(()=>{if(this.IS_ENGINESUPPORT){const t=i=>{const o=this.compilerManager.getObjectSymbol(i);return o?this.dataSupportManager.getConfigBySymbol(o):null};let s=null,r;e.addEventListener(ct.OBJECTCHANGED,i=>{const o=i;o.transObjectSet.forEach(c=>{s=t(c),r=o.mode,s&&(s[r].x=c[r].x,s[r].y=c[r].y,s[r].z=c[r].z)})})}}),!0},ks=function(n={}){if(this.webGLRenderer)return console.warn("this has installed webglRenderer plugin."),!1;this.webGLRenderer=new l.WebGLRenderer(n);const e=this.webGLRenderer.domElement;return e.style.position="absolute",e.style.top="0",e.style.left="0",e.classList.add("vis-webgl"),this.getScreenshot=async function(t={}){const s={width:this.dom.offsetWidth,height:this.dom.offsetHeight};!t.width&&(t.width=this.dom.offsetWidth),!t.height&&(t.height=this.dom.offsetHeight),!t.mine&&(t.mine="image/png");let r=!1;this.renderManager.hasRendering()&&(this.renderManager.stop(),r=!0);let i="";const o=this.webGLRenderer.getContext(),u=o.getParameter(o.MAX_RENDERBUFFER_SIZE)/4;if(t.width>u||t.height>u){const d=[],p=Math.ceil(t.width/u),f=Math.ceil(t.height/u),m=t.width/p,E=t.height/f,A=document.createElement("canvas");A.setAttribute("width",t.width.toString()),A.setAttribute("height",t.height.toString());const M=A.getContext("2d");if(!M)return console.warn("can not support canvas 2d;"),i;this.setSize(m,E);for(let C=0;C<p;C+=1)for(let S=0;S<f;S+=1)d.push({x:m*C,y:E*S});const T=[];d.forEach(C=>{this.camera.setViewOffset(t.width,t.height,C.x,C.y,m,E),this.renderManager.render();const S=this.webGLRenderer.domElement.toDataURL(t.mine);T.push(new Promise((y,R)=>{const P=new Image;P.src=S,P.onload=()=>{M.drawImage(P,C.x,C.y,m,E),y(null)}}))}),this.setSize(s.width,s.height),await Promise.all(T).catch(C=>{console.warn(C)}),i=A.toDataURL(t.mine),this.camera.clearViewOffset()}else this.setSize(t.width,t.height),this.renderManager.render(),i=this.webGLRenderer.domElement.toDataURL(t.mine),this.setSize(s.width,s.height);return r&&this.renderManager.play(),i},this.addEventListener("setDom",t=>{t.dom.appendChild(this.webGLRenderer.domElement)}),this.addEventListener("setSize",t=>{this.webGLRenderer.setSize(t.width,t.height,!0)}),this.addEventListener("dispose",()=>{this.webGLRenderer.dispose()}),this.renderManager?(this.renderManager.removeEventListener("render",this.render),this.renderManager.addEventListener("render",t=>{this.webGLRenderer.render(this.scene,this.camera)})):this.render=function(){return this.webGLRenderer.render(this.scene,this.camera),this},!0},Ze=class extends l.Loader{constructor(e){super(e)}load(e,t,s,r){this.path!==void 0&&(e=this.path+e),this.manager.itemStart(e),e=this.manager.resolveURL(e);const i=l.Cache.get(e);if(i!==void 0)return setTimeout(()=>{t&&t(i),this.manager.itemEnd(e)},0),i;const o=document.createElement("video");return o.preload=Ze.preload,o.autoplay=Ze.autoplay,o.loop=Ze.loop,o.muted=Ze.muted,o.src=e,o.style.position="fixed",o.style.top="0",o.style.left="0",o.style.zIndex="-1",document.body.appendChild(o),o.oncanplay=()=>{l.Cache.add(e,o),this.manager.itemEnd(e),t&&t(o)},o.onerror=c=>{this.manager.itemEnd(e),r&&r(c)},o}};let Ne=Ze;h(Ne,"autoplay",!0),h(Ne,"preload","auto"),h(Ne,"muted",!0),h(Ne,"loop",!0);class _s extends l.Loader{constructor(e){super(e);this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new Xs(t)}),this.register(function(t){return new nr(t)}),this.register(function(t){return new sr(t)}),this.register(function(t){return new Zs(t)}),this.register(function(t){return new $s(t)}),this.register(function(t){return new qs(t)}),this.register(function(t){return new er(t)}),this.register(function(t){return new Vs(t)}),this.register(function(t){return new tr(t)}),this.register(function(t){return new zs(t)}),this.register(function(t){return new Ws(t)}),this.register(function(t){return new rr(t)})}load(e,t,s,r){const i=this;let o;this.resourcePath!==""?o=this.resourcePath:this.path!==""?o=this.path:o=l.LoaderUtils.extractUrlBase(e),this.manager.itemStart(e);const c=function(d){r?r(d):console.error(d),i.manager.itemError(e),i.manager.itemEnd(e)},u=new l.FileLoader(this.manager);u.setPath(this.path),u.setResponseType("arraybuffer"),u.setRequestHeader(this.requestHeader),u.setWithCredentials(this.withCredentials),u.load(e,function(d){try{i.parse(d,o,function(p){t(p),i.manager.itemEnd(e)},c)}catch(p){c(p)}},s,c)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,s,r){let i;const o={},c={};if(typeof e=="string")i=e;else if(l.LoaderUtils.decodeText(new Uint8Array(e,0,4))===gn){try{o[D.KHR_BINARY_GLTF]=new ir(e)}catch(f){r&&r(f);return}i=o[D.KHR_BINARY_GLTF].content}else i=l.LoaderUtils.decodeText(new Uint8Array(e));const u=JSON.parse(i);if(u.asset===void 0||u.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const d=new Ar(u,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});d.fileLoader.setRequestHeader(this.requestHeader);for(let p=0;p<this.pluginCallbacks.length;p++){const f=this.pluginCallbacks[p](d);c[f.name]=f,o[f.name]=!0}if(u.extensionsUsed)for(let p=0;p<u.extensionsUsed.length;++p){const f=u.extensionsUsed[p],m=u.extensionsRequired||[];switch(f){case D.KHR_MATERIALS_UNLIT:o[f]=new Qs;break;case D.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[f]=new cr;break;case D.KHR_DRACO_MESH_COMPRESSION:o[f]=new or(u,this.dracoLoader);break;case D.KHR_TEXTURE_TRANSFORM:o[f]=new ar;break;case D.KHR_MESH_QUANTIZATION:o[f]=new lr;break;default:m.indexOf(f)>=0&&c[f]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+f+'".')}}d.setExtensions(o),d.setPlugins(c),d.parse(s,r)}parseAsync(e,t){const s=this;return new Promise(function(r,i){s.parse(e,t,r,i)})}}function Ks(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}const D={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class Ws{constructor(e){this.parser=e,this.name=D.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let s=0,r=t.length;s<r;s++){const i=t[s];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const t=this.parser,s="light:"+e;let r=t.cache.get(s);if(r)return r;const i=t.json,u=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e];let d;const p=new l.Color(16777215);u.color!==void 0&&p.fromArray(u.color);const f=u.range!==void 0?u.range:0;switch(u.type){case"directional":d=new l.DirectionalLight(p),d.target.position.set(0,0,-1),d.add(d.target);break;case"point":d=new l.PointLight(p),d.distance=f;break;case"spot":d=new l.SpotLight(p),d.distance=f,u.spot=u.spot||{},u.spot.innerConeAngle=u.spot.innerConeAngle!==void 0?u.spot.innerConeAngle:0,u.spot.outerConeAngle=u.spot.outerConeAngle!==void 0?u.spot.outerConeAngle:Math.PI/4,d.angle=u.spot.outerConeAngle,d.penumbra=1-u.spot.innerConeAngle/u.spot.outerConeAngle,d.target.position.set(0,0,-1),d.add(d.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+u.type)}return d.position.set(0,0,0),d.decay=2,u.intensity!==void 0&&(d.intensity=u.intensity),d.name=t.createUniqueName(u.name||"light_"+e),r=Promise.resolve(d),t.cache.add(s,r),r}createNodeAttachment(e){const t=this,s=this.parser,i=s.json.nodes[e],c=(i.extensions&&i.extensions[this.name]||{}).light;return c===void 0?null:this._loadLight(c).then(function(u){return s._getNodeRef(t.cache,c,u)})}}class Qs{constructor(){this.name=D.KHR_MATERIALS_UNLIT}getMaterialType(){return l.MeshBasicMaterial}extendParams(e,t,s){const r=[];e.color=new l.Color(1,1,1),e.opacity=1;const i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const o=i.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}i.baseColorTexture!==void 0&&r.push(s.assignTexture(e,"map",i.baseColorTexture,l.sRGBEncoding))}return Promise.all(r)}}class Vs{constructor(e){this.parser=e,this.name=D.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=r.extensions[this.name].emissiveStrength;return i!==void 0&&(t.emissiveIntensity=i),Promise.resolve()}}class Xs{constructor(e){this.parser=e,this.name=D.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const s=this.parser,r=s.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],o=r.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&i.push(s.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&i.push(s.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(i.push(s.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const c=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new l.Vector2(c,c)}return Promise.all(i)}}class zs{constructor(e){this.parser=e,this.name=D.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const s=this.parser,r=s.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],o=r.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&i.push(s.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&i.push(s.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(i)}}class Zs{constructor(e){this.parser=e,this.name=D.KHR_MATERIALS_SHEEN}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const s=this.parser,r=s.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[];t.sheenColor=new l.Color(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=r.extensions[this.name];return o.sheenColorFactor!==void 0&&t.sheenColor.fromArray(o.sheenColorFactor),o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&i.push(s.assignTexture(t,"sheenColorMap",o.sheenColorTexture,l.sRGBEncoding)),o.sheenRoughnessTexture!==void 0&&i.push(s.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(i)}}class $s{constructor(e){this.parser=e,this.name=D.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const s=this.parser,r=s.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],o=r.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&i.push(s.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(i)}}class qs{constructor(e){this.parser=e,this.name=D.KHR_MATERIALS_VOLUME}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const s=this.parser,r=s.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],o=r.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&i.push(s.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||0;const c=o.attenuationColor||[1,1,1];return t.attenuationColor=new l.Color(c[0],c[1],c[2]),Promise.all(i)}}class er{constructor(e){this.parser=e,this.name=D.KHR_MATERIALS_IOR}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=r.extensions[this.name];return t.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}}class tr{constructor(e){this.parser=e,this.name=D.KHR_MATERIALS_SPECULAR}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const s=this.parser,r=s.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],o=r.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&i.push(s.assignTexture(t,"specularIntensityMap",o.specularTexture));const c=o.specularColorFactor||[1,1,1];return t.specularColor=new l.Color(c[0],c[1],c[2]),o.specularColorTexture!==void 0&&i.push(s.assignTexture(t,"specularColorMap",o.specularColorTexture,l.sRGBEncoding)),Promise.all(i)}}class nr{constructor(e){this.parser=e,this.name=D.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,s=t.json,r=s.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const i=r.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,i.source,o)}}class sr{constructor(e){this.parser=e,this.name=D.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,r=s.json,i=r.textures[e];if(!i.extensions||!i.extensions[t])return null;const o=i.extensions[t],c=r.images[o.source];let u=s.textureLoader;if(c.uri){const d=s.options.manager.getHandler(c.uri);d!==null&&(u=d)}return this.detectSupport().then(function(d){if(d)return s.loadTextureImage(e,o.source,u);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class rr{constructor(e){this.name=D.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,s=t.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const r=s.extensions[this.name],i=this.parser.getDependency("buffer",r.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([i,o.ready]).then(function(c){const u=r.byteOffset||0,d=r.byteLength||0,p=r.count,f=r.byteStride,m=new ArrayBuffer(p*f),E=new Uint8Array(c[0],u,d);return o.decodeGltfBuffer(new Uint8Array(m),p,f,E,r.mode,r.filter),m})}else return null}}const gn="glTF",$e=12,An={JSON:1313821514,BIN:5130562};class ir{constructor(e){this.name=D.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,$e);if(this.header={magic:l.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==gn)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-$e,r=new DataView(e,$e);let i=0;for(;i<s;){const o=r.getUint32(i,!0);i+=4;const c=r.getUint32(i,!0);if(i+=4,c===An.JSON){const u=new Uint8Array(e,$e+i,o);this.content=l.LoaderUtils.decodeText(u)}else if(c===An.BIN){const u=$e+i;this.body=e.slice(u,u+o)}i+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class or{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=D.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const s=this.json,r=this.dracoLoader,i=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,c={},u={},d={};for(const p in o){const f=Nt[p]||p.toLowerCase();c[f]=o[p]}for(const p in e.attributes){const f=Nt[p]||p.toLowerCase();if(o[p]!==void 0){const m=s.accessors[e.attributes[p]],E=qe[m.componentType];d[f]=E,u[f]=m.normalized===!0}}return t.getDependency("bufferView",i).then(function(p){return new Promise(function(f){r.decodeDracoFile(p,function(m){for(const E in m.attributes){const A=m.attributes[E],M=u[E];M!==void 0&&(A.normalized=M)}f(m)},c,d)})})}}class ar{constructor(){this.name=D.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return t.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Ft extends l.MeshStandardMaterial{constructor(e){super();this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),s=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),r=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),i=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),c={specular:{value:new l.Color().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=c,this.onBeforeCompile=function(u){for(const d in c)u.uniforms[d]=c[d];u.fragmentShader=u.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",s).replace("#include <roughnessmap_fragment>",r).replace("#include <metalnessmap_fragment>",i).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return c.specular.value},set:function(u){c.specular.value=u}},specularMap:{get:function(){return c.specularMap.value},set:function(u){c.specularMap.value=u,u?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return c.glossiness.value},set:function(u){c.glossiness.value=u}},glossinessMap:{get:function(){return c.glossinessMap.value},set:function(u){c.glossinessMap.value=u,u?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class cr{constructor(){this.name=D.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return Ft}extendParams(e,t,s){const r=t.extensions[this.name];e.color=new l.Color(1,1,1),e.opacity=1;const i=[];if(Array.isArray(r.diffuseFactor)){const o=r.diffuseFactor;e.color.fromArray(o),e.opacity=o[3]}if(r.diffuseTexture!==void 0&&i.push(s.assignTexture(e,"map",r.diffuseTexture,l.sRGBEncoding)),e.emissive=new l.Color(0,0,0),e.glossiness=r.glossinessFactor!==void 0?r.glossinessFactor:1,e.specular=new l.Color(1,1,1),Array.isArray(r.specularFactor)&&e.specular.fromArray(r.specularFactor),r.specularGlossinessTexture!==void 0){const o=r.specularGlossinessTexture;i.push(s.assignTexture(e,"glossinessMap",o)),i.push(s.assignTexture(e,"specularMap",o,l.sRGBEncoding))}return Promise.all(i)}createMaterial(e){const t=new Ft(e);return t.fog=!0,t.color=e.color,t.map=e.map===void 0?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=e.aoMap===void 0?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=e.emissiveIntensity===void 0?1:e.emissiveIntensity,t.emissiveMap=e.emissiveMap===void 0?null:e.emissiveMap,t.bumpMap=e.bumpMap===void 0?null:e.bumpMap,t.bumpScale=1,t.normalMap=e.normalMap===void 0?null:e.normalMap,t.normalMapType=l.TangentSpaceNormalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=e.specularMap===void 0?null:e.specularMap,t.specular=e.specular,t.glossinessMap=e.glossinessMap===void 0?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=e.envMap===void 0?null:e.envMap,t.envMapIntensity=1,t}}class lr{constructor(){this.name=D.KHR_MESH_QUANTIZATION}}class wt extends l.Interpolant{constructor(e,t,s,r){super(e,t,s,r)}copySampleValue_(e){const t=this.resultBuffer,s=this.sampleValues,r=this.valueSize,i=e*r*3+r;for(let o=0;o!==r;o++)t[o]=s[i+o];return t}}wt.prototype.interpolate_=function(n,e,t,s){const r=this.resultBuffer,i=this.sampleValues,o=this.valueSize,c=o*2,u=o*3,d=s-e,p=(t-e)/d,f=p*p,m=f*p,E=n*u,A=E-u,M=-2*m+3*f,T=m-f,C=1-M,S=T-f+p;for(let y=0;y!==o;y++){const R=i[A+y+o],P=i[A+y+c]*d,B=i[E+y+o],F=i[E+y]*d;r[y]=C*R+S*P+M*B+T*F}return r};const ur=new l.Quaternion;class dr extends wt{interpolate_(e,t,s,r){const i=super.interpolate_(e,t,s,r);return ur.fromArray(i).normalize().toArray(i),i}}const me={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},qe={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Cn={9728:l.NearestFilter,9729:l.LinearFilter,9984:l.NearestMipmapNearestFilter,9985:l.LinearMipmapNearestFilter,9986:l.NearestMipmapLinearFilter,9987:l.LinearMipmapLinearFilter},Mn={33071:l.ClampToEdgeWrapping,33648:l.MirroredRepeatWrapping,10497:l.RepeatWrapping},Tn={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Nt={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},ye={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},hr={CUBICSPLINE:void 0,LINEAR:l.InterpolateLinear,STEP:l.InterpolateDiscrete},vt={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function pr(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new l.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:l.FrontSide})),n.DefaultMaterial}function et(n,e,t){for(const s in t.extensions)n[s]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[s]=t.extensions[s])}function ve(n,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function fr(n,e,t){let s=!1,r=!1,i=!1;for(let d=0,p=e.length;d<p;d++){const f=e[d];if(f.POSITION!==void 0&&(s=!0),f.NORMAL!==void 0&&(r=!0),f.COLOR_0!==void 0&&(i=!0),s&&r&&i)break}if(!s&&!r&&!i)return Promise.resolve(n);const o=[],c=[],u=[];for(let d=0,p=e.length;d<p;d++){const f=e[d];if(s){const m=f.POSITION!==void 0?t.getDependency("accessor",f.POSITION):n.attributes.position;o.push(m)}if(r){const m=f.NORMAL!==void 0?t.getDependency("accessor",f.NORMAL):n.attributes.normal;c.push(m)}if(i){const m=f.COLOR_0!==void 0?t.getDependency("accessor",f.COLOR_0):n.attributes.color;u.push(m)}}return Promise.all([Promise.all(o),Promise.all(c),Promise.all(u)]).then(function(d){const p=d[0],f=d[1],m=d[2];return s&&(n.morphAttributes.position=p),r&&(n.morphAttributes.normal=f),i&&(n.morphAttributes.color=m),n.morphTargetsRelative=!0,n})}function mr(n,e){if(n.updateMorphTargets(),e.weights!==void 0)for(let t=0,s=e.weights.length;t<s;t++)n.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(n.morphTargetInfluences.length===t.length){n.morphTargetDictionary={};for(let s=0,r=t.length;s<r;s++)n.morphTargetDictionary[t[s]]=s}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Er(n){const e=n.extensions&&n.extensions[D.KHR_DRACO_MESH_COMPRESSION];let t;return e?t="draco:"+e.bufferView+":"+e.indices+":"+Bn(e.attributes):t=n.indices+":"+Bn(n.attributes)+":"+n.mode,t}function Bn(n){let e="";const t=Object.keys(n).sort();for(let s=0,r=t.length;s<r;s++)e+=t[s]+":"+n[t[s]]+";";return e}function Ut(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function gr(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}class Ar{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Ks,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const s=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,r=navigator.userAgent.indexOf("Firefox")>-1,i=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;typeof createImageBitmap=="undefined"||s||r&&i<98?this.textureLoader=new l.TextureLoader(this.options.manager):this.textureLoader=new l.ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new l.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const s=this,r=this.json,i=this.extensions;this.cache.removeAll(),this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])}).then(function(o){const c={scene:o[0][r.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:r.asset,parser:s,userData:{}};et(i,c,r),ve(c,r),Promise.all(s._invokeAll(function(u){return u.afterRoot&&u.afterRoot(c)})).then(function(){e(c)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],s=this.json.meshes||[];for(let r=0,i=t.length;r<i;r++){const o=t[r].joints;for(let c=0,u=o.length;c<u;c++)e[o[c]].isBone=!0}for(let r=0,i=e.length;r<i;r++){const o=e[r];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(s[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,s){if(e.refs[t]<=1)return s;const r=s.clone(),i=(o,c)=>{const u=this.associations.get(o);u!=null&&this.associations.set(c,u);for(const[d,p]of o.children.entries())i(p,c.children[d])};return i(s,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let s=0;s<t.length;s++){const r=e(t[s]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const s=[];for(let r=0;r<t.length;r++){const i=e(t[r]);i&&s.push(i)}return s}getDependency(e,t){const s=e+":"+t;let r=this.cache.get(s);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this._invokeOne(function(i){return i.loadMesh&&i.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(i){return i.loadBufferView&&i.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(i){return i.loadMaterial&&i.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(i){return i.loadTexture&&i.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(i){return i.loadAnimation&&i.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(s,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const s=this,r=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(r.map(function(i,o){return s.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],s=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[D.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(i,o){s.load(l.LoaderUtils.resolveURL(t.uri,r.path),i,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(s){const r=t.byteLength||0,i=t.byteOffset||0;return s.slice(i,i+r)})}loadAccessor(e){const t=this,s=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0)return Promise.resolve(null);const i=[];return r.bufferView!==void 0?i.push(this.getDependency("bufferView",r.bufferView)):i.push(null),r.sparse!==void 0&&(i.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(i).then(function(o){const c=o[0],u=Tn[r.type],d=qe[r.componentType],p=d.BYTES_PER_ELEMENT,f=p*u,m=r.byteOffset||0,E=r.bufferView!==void 0?s.bufferViews[r.bufferView].byteStride:void 0,A=r.normalized===!0;let M,T;if(E&&E!==f){const C=Math.floor(m/E),S="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+C+":"+r.count;let y=t.cache.get(S);y||(M=new d(c,C*E,r.count*E/p),y=new l.InterleavedBuffer(M,E/p),t.cache.add(S,y)),T=new l.InterleavedBufferAttribute(y,u,m%E/p,A)}else c===null?M=new d(r.count*u):M=new d(c,m,r.count*u),T=new l.BufferAttribute(M,u,A);if(r.sparse!==void 0){const C=Tn.SCALAR,S=qe[r.sparse.indices.componentType],y=r.sparse.indices.byteOffset||0,R=r.sparse.values.byteOffset||0,P=new S(o[1],y,r.sparse.count*C),B=new d(o[2],R,r.sparse.count*u);c!==null&&(T=new l.BufferAttribute(T.array.slice(),T.itemSize,T.normalized));for(let F=0,I=P.length;F<I;F++){const b=P[F];if(T.setX(b,B[F*u]),u>=2&&T.setY(b,B[F*u+1]),u>=3&&T.setZ(b,B[F*u+2]),u>=4&&T.setW(b,B[F*u+3]),u>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return T})}loadTexture(e){const t=this.json,s=this.options,i=t.textures[e].source,o=t.images[i];let c=this.textureLoader;if(o.uri){const u=s.manager.getHandler(o.uri);u!==null&&(c=u)}return this.loadTextureImage(e,i,c)}loadTextureImage(e,t,s){const r=this,i=this.json,o=i.textures[e],c=i.images[t],u=(c.uri||c.bufferView)+":"+o.sampler;if(this.textureCache[u])return this.textureCache[u];const d=this.loadImageSource(t,s).then(function(p){p.flipY=!1,o.name&&(p.name=o.name);const m=(i.samplers||{})[o.sampler]||{};return p.magFilter=Cn[m.magFilter]||l.LinearFilter,p.minFilter=Cn[m.minFilter]||l.LinearMipmapLinearFilter,p.wrapS=Mn[m.wrapS]||l.RepeatWrapping,p.wrapT=Mn[m.wrapT]||l.RepeatWrapping,r.associations.set(p,{textures:e}),p}).catch(function(){return null});return this.textureCache[u]=d,d}loadImageSource(e,t){const s=this,r=this.json,i=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(f=>f.clone());const o=r.images[e],c=self.URL||self.webkitURL;let u=o.uri||"",d=!1;if(o.bufferView!==void 0)u=s.getDependency("bufferView",o.bufferView).then(function(f){d=!0;const m=new Blob([f],{type:o.mimeType});return u=c.createObjectURL(m),u});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const p=Promise.resolve(u).then(function(f){return new Promise(function(m,E){let A=m;t.isImageBitmapLoader===!0&&(A=function(M){const T=new l.Texture(M);T.needsUpdate=!0,m(T)}),t.load(l.LoaderUtils.resolveURL(f,i.path),A,void 0,E)})}).then(function(f){return d===!0&&c.revokeObjectURL(u),f.userData.mimeType=o.mimeType||gr(o.uri),f}).catch(function(f){throw console.error("THREE.GLTFLoader: Couldn't load texture",u),f});return this.sourceCache[e]=p,p}assignTexture(e,t,s,r){const i=this;return this.getDependency("texture",s.index).then(function(o){if(s.texCoord!==void 0&&s.texCoord!=0&&!(t==="aoMap"&&s.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+s.texCoord+" for texture "+t+" not yet supported."),i.extensions[D.KHR_TEXTURE_TRANSFORM]){const c=s.extensions!==void 0?s.extensions[D.KHR_TEXTURE_TRANSFORM]:void 0;if(c){const u=i.associations.get(o);o=i.extensions[D.KHR_TEXTURE_TRANSFORM].extendTexture(o,c),i.associations.set(o,u)}}return r!==void 0&&(o.encoding=r),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let s=e.material;const r=t.attributes.tangent===void 0,i=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const c="PointsMaterial:"+s.uuid;let u=this.cache.get(c);u||(u=new l.PointsMaterial,l.Material.prototype.copy.call(u,s),u.color.copy(s.color),u.map=s.map,u.sizeAttenuation=!1,this.cache.add(c,u)),s=u}else if(e.isLine){const c="LineBasicMaterial:"+s.uuid;let u=this.cache.get(c);u||(u=new l.LineBasicMaterial,l.Material.prototype.copy.call(u,s),u.color.copy(s.color),this.cache.add(c,u)),s=u}if(r||i||o){let c="ClonedMaterial:"+s.uuid+":";s.isGLTFSpecularGlossinessMaterial&&(c+="specular-glossiness:"),r&&(c+="derivative-tangents:"),i&&(c+="vertex-colors:"),o&&(c+="flat-shading:");let u=this.cache.get(c);u||(u=s.clone(),i&&(u.vertexColors=!0),o&&(u.flatShading=!0),r&&(u.normalScale&&(u.normalScale.y*=-1),u.clearcoatNormalScale&&(u.clearcoatNormalScale.y*=-1)),this.cache.add(c,u),this.associations.set(u,this.associations.get(s))),s=u}s.aoMap&&t.attributes.uv2===void 0&&t.attributes.uv!==void 0&&t.setAttribute("uv2",t.attributes.uv),e.material=s}getMaterialType(){return l.MeshStandardMaterial}loadMaterial(e){const t=this,s=this.json,r=this.extensions,i=s.materials[e];let o;const c={},u=i.extensions||{},d=[];if(u[D.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const f=r[D.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];o=f.getMaterialType(),d.push(f.extendParams(c,i,t))}else if(u[D.KHR_MATERIALS_UNLIT]){const f=r[D.KHR_MATERIALS_UNLIT];o=f.getMaterialType(),d.push(f.extendParams(c,i,t))}else{const f=i.pbrMetallicRoughness||{};if(c.color=new l.Color(1,1,1),c.opacity=1,Array.isArray(f.baseColorFactor)){const m=f.baseColorFactor;c.color.fromArray(m),c.opacity=m[3]}f.baseColorTexture!==void 0&&d.push(t.assignTexture(c,"map",f.baseColorTexture,l.sRGBEncoding)),c.metalness=f.metallicFactor!==void 0?f.metallicFactor:1,c.roughness=f.roughnessFactor!==void 0?f.roughnessFactor:1,f.metallicRoughnessTexture!==void 0&&(d.push(t.assignTexture(c,"metalnessMap",f.metallicRoughnessTexture)),d.push(t.assignTexture(c,"roughnessMap",f.metallicRoughnessTexture))),o=this._invokeOne(function(m){return m.getMaterialType&&m.getMaterialType(e)}),d.push(Promise.all(this._invokeAll(function(m){return m.extendMaterialParams&&m.extendMaterialParams(e,c)})))}i.doubleSided===!0&&(c.side=l.DoubleSide);const p=i.alphaMode||vt.OPAQUE;if(p===vt.BLEND?(c.transparent=!0,c.depthWrite=!1):(c.transparent=!1,p===vt.MASK&&(c.alphaTest=i.alphaCutoff!==void 0?i.alphaCutoff:.5)),i.normalTexture!==void 0&&o!==l.MeshBasicMaterial&&(d.push(t.assignTexture(c,"normalMap",i.normalTexture)),c.normalScale=new l.Vector2(1,1),i.normalTexture.scale!==void 0)){const f=i.normalTexture.scale;c.normalScale.set(f,f)}return i.occlusionTexture!==void 0&&o!==l.MeshBasicMaterial&&(d.push(t.assignTexture(c,"aoMap",i.occlusionTexture)),i.occlusionTexture.strength!==void 0&&(c.aoMapIntensity=i.occlusionTexture.strength)),i.emissiveFactor!==void 0&&o!==l.MeshBasicMaterial&&(c.emissive=new l.Color().fromArray(i.emissiveFactor)),i.emissiveTexture!==void 0&&o!==l.MeshBasicMaterial&&d.push(t.assignTexture(c,"emissiveMap",i.emissiveTexture,l.sRGBEncoding)),Promise.all(d).then(function(){let f;return o===Ft?f=r[D.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(c):f=new o(c),i.name&&(f.name=i.name),ve(f,i),t.associations.set(f,{materials:e}),i.extensions&&et(r,f,i),f})}createUniqueName(e){const t=l.PropertyBinding.sanitizeNodeName(e||"");let s=t;for(let r=1;this.nodeNamesUsed[s];++r)s=t+"_"+r;return this.nodeNamesUsed[s]=!0,s}loadGeometries(e){const t=this,s=this.extensions,r=this.primitiveCache;function i(c){return s[D.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(c,t).then(function(u){return Sn(u,c,t)})}const o=[];for(let c=0,u=e.length;c<u;c++){const d=e[c],p=Er(d),f=r[p];if(f)o.push(f.promise);else{let m;d.extensions&&d.extensions[D.KHR_DRACO_MESH_COMPRESSION]?m=i(d):m=Sn(new l.BufferGeometry,d,t),r[p]={primitive:d,promise:m},o.push(m)}}return Promise.all(o)}loadMesh(e){const t=this,s=this.json,r=this.extensions,i=s.meshes[e],o=i.primitives,c=[];for(let u=0,d=o.length;u<d;u++){const p=o[u].material===void 0?pr(this.cache):this.getDependency("material",o[u].material);c.push(p)}return c.push(t.loadGeometries(o)),Promise.all(c).then(function(u){const d=u.slice(0,u.length-1),p=u[u.length-1],f=[];for(let E=0,A=p.length;E<A;E++){const M=p[E],T=o[E];let C;const S=d[E];if(T.mode===me.TRIANGLES||T.mode===me.TRIANGLE_STRIP||T.mode===me.TRIANGLE_FAN||T.mode===void 0)C=i.isSkinnedMesh===!0?new l.SkinnedMesh(M,S):new l.Mesh(M,S),C.isSkinnedMesh===!0&&!C.geometry.attributes.skinWeight.normalized&&C.normalizeSkinWeights(),T.mode===me.TRIANGLE_STRIP?C.geometry=Rn(C.geometry,l.TriangleStripDrawMode):T.mode===me.TRIANGLE_FAN&&(C.geometry=Rn(C.geometry,l.TriangleFanDrawMode));else if(T.mode===me.LINES)C=new l.LineSegments(M,S);else if(T.mode===me.LINE_STRIP)C=new l.Line(M,S);else if(T.mode===me.LINE_LOOP)C=new l.LineLoop(M,S);else if(T.mode===me.POINTS)C=new l.Points(M,S);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+T.mode);Object.keys(C.geometry.morphAttributes).length>0&&mr(C,i),C.name=t.createUniqueName(i.name||"mesh_"+e),ve(C,i),T.extensions&&et(r,C,T),t.assignFinalMaterial(C),f.push(C)}for(let E=0,A=f.length;E<A;E++)t.associations.set(f[E],{meshes:e,primitives:E});if(f.length===1)return f[0];const m=new l.Group;t.associations.set(m,{meshes:e});for(let E=0,A=f.length;E<A;E++)m.add(f[E]);return m})}loadCamera(e){let t;const s=this.json.cameras[e],r=s[s.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return s.type==="perspective"?t=new l.PerspectiveCamera(l.MathUtils.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):s.type==="orthographic"&&(t=new l.OrthographicCamera(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),s.name&&(t.name=this.createUniqueName(s.name)),ve(t,s),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],s={joints:t.joints};return t.inverseBindMatrices===void 0?Promise.resolve(s):this.getDependency("accessor",t.inverseBindMatrices).then(function(r){return s.inverseBindMatrices=r,s})}loadAnimation(e){const s=this.json.animations[e],r=[],i=[],o=[],c=[],u=[];for(let d=0,p=s.channels.length;d<p;d++){const f=s.channels[d],m=s.samplers[f.sampler],E=f.target,A=E.node!==void 0?E.node:E.id,M=s.parameters!==void 0?s.parameters[m.input]:m.input,T=s.parameters!==void 0?s.parameters[m.output]:m.output;r.push(this.getDependency("node",A)),i.push(this.getDependency("accessor",M)),o.push(this.getDependency("accessor",T)),c.push(m),u.push(E)}return Promise.all([Promise.all(r),Promise.all(i),Promise.all(o),Promise.all(c),Promise.all(u)]).then(function(d){const p=d[0],f=d[1],m=d[2],E=d[3],A=d[4],M=[];for(let C=0,S=p.length;C<S;C++){const y=p[C],R=f[C],P=m[C],B=E[C],F=A[C];if(y===void 0)continue;y.updateMatrix(),y.matrixAutoUpdate=!0;let I;switch(ye[F.path]){case ye.weights:I=l.NumberKeyframeTrack;break;case ye.rotation:I=l.QuaternionKeyframeTrack;break;case ye.position:case ye.scale:default:I=l.VectorKeyframeTrack;break}const b=y.name?y.name:y.uuid,he=B.interpolation!==void 0?hr[B.interpolation]:l.InterpolateLinear,pe=[];ye[F.path]===ye.weights?y.traverse(function(_){_.morphTargetInfluences&&pe.push(_.name?_.name:_.uuid)}):pe.push(b);let z=P.array;if(P.normalized){const _=Ut(z.constructor),fe=new Float32Array(z.length);for(let ne=0,bt=z.length;ne<bt;ne++)fe[ne]=z[ne]*_;z=fe}for(let _=0,fe=pe.length;_<fe;_++){const ne=new I(pe[_]+"."+ye[F.path],R.array,z,he);B.interpolation==="CUBICSPLINE"&&(ne.createInterpolant=function(It){const an=this instanceof l.QuaternionKeyframeTrack?dr:wt;return new an(this.times,this.values,this.getValueSize()/3,It)},ne.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),M.push(ne)}}const T=s.name?s.name:"animation_"+e;return new l.AnimationClip(T,void 0,M)})}createNodeMesh(e){const t=this.json,s=this,r=t.nodes[e];return r.mesh===void 0?null:s.getDependency("mesh",r.mesh).then(function(i){const o=s._getNodeRef(s.meshCache,r.mesh,i);return r.weights!==void 0&&o.traverse(function(c){if(!!c.isMesh)for(let u=0,d=r.weights.length;u<d;u++)c.morphTargetInfluences[u]=r.weights[u]}),o})}loadNode(e){const t=this.json,s=this.extensions,r=this,i=t.nodes[e],o=i.name?r.createUniqueName(i.name):"";return function(){const c=[],u=r._invokeOne(function(d){return d.createNodeMesh&&d.createNodeMesh(e)});return u&&c.push(u),i.camera!==void 0&&c.push(r.getDependency("camera",i.camera).then(function(d){return r._getNodeRef(r.cameraCache,i.camera,d)})),r._invokeAll(function(d){return d.createNodeAttachment&&d.createNodeAttachment(e)}).forEach(function(d){c.push(d)}),Promise.all(c)}().then(function(c){let u;if(i.isBone===!0?u=new l.Bone:c.length>1?u=new l.Group:c.length===1?u=c[0]:u=new l.Object3D,u!==c[0])for(let d=0,p=c.length;d<p;d++)u.add(c[d]);if(i.name&&(u.userData.name=i.name,u.name=o),ve(u,i),i.extensions&&et(s,u,i),i.matrix!==void 0){const d=new l.Matrix4;d.fromArray(i.matrix),u.applyMatrix4(d)}else i.translation!==void 0&&u.position.fromArray(i.translation),i.rotation!==void 0&&u.quaternion.fromArray(i.rotation),i.scale!==void 0&&u.scale.fromArray(i.scale);return r.associations.has(u)||r.associations.set(u,{}),r.associations.get(u).nodes=e,u})}loadScene(e){const t=this.json,s=this.extensions,r=this.json.scenes[e],i=this,o=new l.Group;r.name&&(o.name=i.createUniqueName(r.name)),ve(o,r),r.extensions&&et(s,o,r);const c=r.nodes||[],u=[];for(let d=0,p=c.length;d<p;d++)u.push(yn(c[d],o,t,i));return Promise.all(u).then(function(){const d=p=>{const f=new Map;for(const[m,E]of i.associations)(m instanceof l.Material||m instanceof l.Texture)&&f.set(m,E);return p.traverse(m=>{const E=i.associations.get(m);E!=null&&f.set(m,E)}),f};return i.associations=d(o),o})}}function yn(n,e,t,s){const r=t.nodes[n];return s.getDependency("node",n).then(function(i){if(r.skin===void 0)return i;let o;return s.getDependency("skin",r.skin).then(function(c){o=c;const u=[];for(let d=0,p=o.joints.length;d<p;d++)u.push(s.getDependency("node",o.joints[d]));return Promise.all(u)}).then(function(c){return i.traverse(function(u){if(!u.isMesh)return;const d=[],p=[];for(let f=0,m=c.length;f<m;f++){const E=c[f];if(E){d.push(E);const A=new l.Matrix4;o.inverseBindMatrices!==void 0&&A.fromArray(o.inverseBindMatrices.array,f*16),p.push(A)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',o.joints[f])}u.bind(new l.Skeleton(d,p),u.matrixWorld)}),i})}).then(function(i){e.add(i);const o=[];if(r.children){const c=r.children;for(let u=0,d=c.length;u<d;u++){const p=c[u];o.push(yn(p,i,t,s))}}return Promise.all(o)})}function Cr(n,e,t){const s=e.attributes,r=new l.Box3;if(s.POSITION!==void 0){const c=t.json.accessors[s.POSITION],u=c.min,d=c.max;if(u!==void 0&&d!==void 0){if(r.set(new l.Vector3(u[0],u[1],u[2]),new l.Vector3(d[0],d[1],d[2])),c.normalized){const p=Ut(qe[c.componentType]);r.min.multiplyScalar(p),r.max.multiplyScalar(p)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const i=e.targets;if(i!==void 0){const c=new l.Vector3,u=new l.Vector3;for(let d=0,p=i.length;d<p;d++){const f=i[d];if(f.POSITION!==void 0){const m=t.json.accessors[f.POSITION],E=m.min,A=m.max;if(E!==void 0&&A!==void 0){if(u.setX(Math.max(Math.abs(E[0]),Math.abs(A[0]))),u.setY(Math.max(Math.abs(E[1]),Math.abs(A[1]))),u.setZ(Math.max(Math.abs(E[2]),Math.abs(A[2]))),m.normalized){const M=Ut(qe[m.componentType]);u.multiplyScalar(M)}c.max(u)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(c)}n.boundingBox=r;const o=new l.Sphere;r.getCenter(o.center),o.radius=r.min.distanceTo(r.max)/2,n.boundingSphere=o}function Sn(n,e,t){const s=e.attributes,r=[];function i(o,c){return t.getDependency("accessor",o).then(function(u){n.setAttribute(c,u)})}for(const o in s){const c=Nt[o]||o.toLowerCase();c in n.attributes||r.push(i(s[o],c))}if(e.indices!==void 0&&!n.index){const o=t.getDependency("accessor",e.indices).then(function(c){n.setIndex(c)});r.push(o)}return ve(n,e),Cr(n,e,t),Promise.all(r).then(function(){return e.targets!==void 0?fr(n,e.targets,t):n})}function Rn(n,e){let t=n.getIndex();if(t===null){const o=[],c=n.getAttribute("position");if(c!==void 0){for(let u=0;u<c.count;u++)o.push(u);n.setIndex(o),t=n.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const s=t.count-2,r=[];if(e===l.TriangleFanDrawMode)for(let o=1;o<=s;o++)r.push(t.getX(0)),r.push(t.getX(o)),r.push(t.getX(o+1));else for(let o=0;o<s;o++)o%2==0?(r.push(t.getX(o)),r.push(t.getX(o+1)),r.push(t.getX(o+2))):(r.push(t.getX(o+2)),r.push(t.getX(o+1)),r.push(t.getX(o)));r.length/3!==s&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const i=n.clone();return i.setIndex(r),i}const Ht=new WeakMap;class Mr extends l.Loader{constructor(e){super(e);this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,s,r){const i=new l.FileLoader(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,o=>{const c={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(o,c).then(t).catch(r)},s,r)}decodeDracoFile(e,t,s,r){const i={attributeIDs:s||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!s};this.decodeGeometry(e,i).then(t)}decodeGeometry(e,t){for(const u in t.attributeTypes){const d=t.attributeTypes[u];d.BYTES_PER_ELEMENT!==void 0&&(t.attributeTypes[u]=d.name)}const s=JSON.stringify(t);if(Ht.has(e)){const u=Ht.get(e);if(u.key===s)return u.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r;const i=this.workerNextTaskID++,o=e.byteLength,c=this._getWorker(i,o).then(u=>(r=u,new Promise((d,p)=>{r._callbacks[i]={resolve:d,reject:p},r.postMessage({type:"decode",id:i,taskConfig:t,buffer:e},[e])}))).then(u=>this._createGeometry(u.geometry));return c.catch(()=>!0).then(()=>{r&&i&&this._releaseTask(r,i)}),Ht.set(e,{key:s,promise:c}),c}_createGeometry(e){const t=new l.BufferGeometry;e.index&&t.setIndex(new l.BufferAttribute(e.index.array,1));for(let s=0;s<e.attributes.length;s++){const r=e.attributes[s],i=r.name,o=r.array,c=r.itemSize;t.setAttribute(i,new l.BufferAttribute(o,c))}return t}_loadLibrary(e,t){const s=new l.FileLoader(this.manager);return s.setPath(this.decoderPath),s.setResponseType(t),s.setWithCredentials(this.withCredentials),new Promise((r,i)=>{s.load(e,r,void 0,i)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(s=>{const r=s[0];e||(this.decoderConfig.wasmBinary=s[1]);const i=Tr.toString(),o=["/* draco decoder */",r,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([o]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(i){const o=i.data;switch(o.type){case"decode":r._callbacks[o.id].resolve(o);break;case"error":r._callbacks[o.id].reject(o);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,i){return r._taskLoad>i._taskLoad?-1:1});const s=this.workerPool[this.workerPool.length-1];return s._taskCosts[e]=t,s._taskLoad+=t,s})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function Tr(){let n,e;onmessage=function(o){const c=o.data;switch(c.type){case"init":n=c.decoderConfig,e=new Promise(function(p){n.onModuleLoaded=function(f){p({draco:f})},DracoDecoderModule(n)});break;case"decode":const u=c.buffer,d=c.taskConfig;e.then(p=>{const f=p.draco,m=new f.Decoder,E=new f.DecoderBuffer;E.Init(new Int8Array(u),u.byteLength);try{const A=t(f,m,E,d),M=A.attributes.map(T=>T.array.buffer);A.index&&M.push(A.index.array.buffer),self.postMessage({type:"decode",id:c.id,geometry:A},M)}catch(A){console.error(A),self.postMessage({type:"error",id:c.id,error:A.message})}finally{f.destroy(E),f.destroy(m)}});break}};function t(o,c,u,d){const p=d.attributeIDs,f=d.attributeTypes;let m,E;const A=c.GetEncodedGeometryType(u);if(A===o.TRIANGULAR_MESH)m=new o.Mesh,E=c.DecodeBufferToMesh(u,m);else if(A===o.POINT_CLOUD)m=new o.PointCloud,E=c.DecodeBufferToPointCloud(u,m);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!E.ok()||m.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+E.error_msg());const M={index:null,attributes:[]};for(const T in p){const C=self[f[T]];let S,y;if(d.useUniqueIDs)y=p[T],S=c.GetAttributeByUniqueId(m,y);else{if(y=c.GetAttributeId(m,o[p[T]]),y===-1)continue;S=c.GetAttribute(m,y)}M.attributes.push(r(o,c,m,T,C,S))}return A===o.TRIANGULAR_MESH&&(M.index=s(o,c,m)),o.destroy(m),M}function s(o,c,u){const p=u.num_faces()*3,f=p*4,m=o._malloc(f);c.GetTrianglesUInt32Array(u,f,m);const E=new Uint32Array(o.HEAPF32.buffer,m,p).slice();return o._free(m),{array:E,itemSize:1}}function r(o,c,u,d,p,f){const m=f.num_components(),A=u.num_points()*m,M=A*p.BYTES_PER_ELEMENT,T=i(o,p),C=o._malloc(M);c.GetAttributeDataArrayForAllPoints(u,f,T,M,C);const S=new p(o.HEAPF32.buffer,C,A).slice();return o._free(C),{name:d,array:S,itemSize:m}}function i(o,c){switch(c){case Float32Array:return o.DT_FLOAT32;case Int8Array:return o.DT_INT8;case Int16Array:return o.DT_INT16;case Int32Array:return o.DT_INT32;case Uint8Array:return o.DT_UINT8;case Uint16Array:return o.DT_UINT16;case Uint32Array:return o.DT_UINT32}}}class Br{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const s=this.workersResolve[e];if(s&&s(t),this.queue.length){const{resolve:r,msg:i,transfer:o}=this.queue.shift();this.workersResolve[e]=r,this.workers[e].postMessage(i,o)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(s=>{const r=this._getIdleWorker();r!==-1?(this._initWorker(r),this.workerStatus|=1<<r,this.workersResolve[r]=s,this.workers[r].postMessage(e,t)):this.queue.push({resolve:s,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const yr=2,Sr=1,xt=new WeakMap;let Yt=0;class oe extends l.Loader{constructor(e){super(e);this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new Br,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER!="undefined"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){const e=new l.FileLoader(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),s=new l.FileLoader(this.manager);s.setPath(this.transcoderPath),s.setResponseType("arraybuffer"),s.setWithCredentials(this.withCredentials);const r=s.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,r]).then(([i,o])=>{const c=oe.BasisWorker.toString(),u=["/* constants */","let _EngineFormat = "+JSON.stringify(oe.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(oe.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(oe.BasisFormat),"/* basis_transcoder.js */",i,"/* worker */",c.substring(c.indexOf("{")+1,c.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([u])),this.transcoderBinary=o,this.workerPool.setWorkerCreator(()=>{const d=new Worker(this.workerSourceURL),p=this.transcoderBinary.slice(0);return d.postMessage({type:"init",config:this.workerConfig,transcoderBinary:p},[p]),d})}),Yt>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),Yt++}return this.transcoderPending}load(e,t,s,r){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const i=new l.FileLoader(this.manager);i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials);const o=new l.CompressedTexture;return i.load(e,c=>{if(xt.has(c))return xt.get(c).promise.then(t).catch(r);this._createTexture([c]).then(function(u){o.copy(u),o.needsUpdate=!0,t&&t(o)}).catch(r)},s,r),o}_createTextureFrom(e){const{mipmaps:t,width:s,height:r,format:i,type:o,error:c,dfdTransferFn:u,dfdFlags:d}=e;if(o==="error")return Promise.reject(c);const p=new l.CompressedTexture(t,s,r,i,l.UnsignedByteType);return p.minFilter=t.length===1?l.LinearFilter:l.LinearMipmapLinearFilter,p.magFilter=l.LinearFilter,p.generateMipmaps=!1,p.needsUpdate=!0,p.encoding=u===yr?l.sRGBEncoding:l.LinearEncoding,p.premultiplyAlpha=!!(d&Sr),p}_createTexture(e,t={}){const s=t,r=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffers:e,taskConfig:s},e)).then(i=>this._createTextureFrom(i.data));return xt.set(e[0],{promise:r}),r}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),Yt--,this}}oe.BasisFormat={ETC1S:0,UASTC_4x4:1},oe.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},oe.EngineFormat={RGBAFormat:l.RGBAFormat,RGBA_ASTC_4x4_Format:l.RGBA_ASTC_4x4_Format,RGBA_BPTC_Format:l.RGBA_BPTC_Format,RGBA_ETC2_EAC_Format:l.RGBA_ETC2_EAC_Format,RGBA_PVRTC_4BPPV1_Format:l.RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT5_Format:l.RGBA_S3TC_DXT5_Format,RGB_ETC1_Format:l.RGB_ETC1_Format,RGB_ETC2_Format:l.RGB_ETC2_Format,RGB_PVRTC_4BPPV1_Format:l.RGB_PVRTC_4BPPV1_Format,RGB_S3TC_DXT1_Format:l.RGB_S3TC_DXT1_Format},oe.BasisWorker=function(){let n,e,t;const s=_EngineFormat,r=_TranscoderFormat,i=_BasisFormat;self.addEventListener("message",function(E){const A=E.data;switch(A.type){case"init":n=A.config,o(A.transcoderBinary);break;case"transcode":e.then(()=>{try{const{width:M,height:T,hasAlpha:C,mipmaps:S,format:y,dfdTransferFn:R,dfdFlags:P}=c(A.buffers[0]),B=[];for(let F=0;F<S.length;++F)B.push(S[F].data.buffer);self.postMessage({type:"transcode",id:A.id,width:M,height:T,hasAlpha:C,mipmaps:S,format:y,dfdTransferFn:R,dfdFlags:P},B)}catch(M){console.error(M),self.postMessage({type:"error",id:A.id,error:M.message})}});break}});function o(E){e=new Promise(A=>{t={wasmBinary:E,onRuntimeInitialized:A},BASIS(t)}).then(()=>{t.initializeBasis(),t.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function c(E){const A=new t.KTX2File(new Uint8Array(E));function M(){A.close(),A.delete()}if(!A.isValid())throw M(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const T=A.isUASTC()?i.UASTC_4x4:i.ETC1S,C=A.getWidth(),S=A.getHeight(),y=A.getLevels(),R=A.getHasAlpha(),P=A.getDFDTransferFunc(),B=A.getDFDFlags(),{transcoderFormat:F,engineFormat:I}=f(T,C,S,R);if(!C||!S||!y)throw M(),new Error("THREE.KTX2Loader:	Invalid texture");if(!A.startTranscoding())throw M(),new Error("THREE.KTX2Loader: .startTranscoding failed");const b=[];for(let he=0;he<y;he++){const pe=A.getImageLevelInfo(he,0,0),z=pe.origWidth,_=pe.origHeight,fe=new Uint8Array(A.getImageTranscodedSizeInBytes(he,0,0,F));if(!A.transcodeImage(fe,he,0,0,F,0,-1,-1))throw M(),new Error("THREE.KTX2Loader: .transcodeImage failed.");b.push({data:fe,width:z,height:_})}return M(),{width:C,height:S,hasAlpha:R,mipmaps:b,format:I,dfdTransferFn:P,dfdFlags:B}}const u=[{if:"astcSupported",basisFormat:[i.UASTC_4x4],transcoderFormat:[r.ASTC_4x4,r.ASTC_4x4],engineFormat:[s.RGBA_ASTC_4x4_Format,s.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[r.BC7_M5,r.BC7_M5],engineFormat:[s.RGBA_BPTC_Format,s.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[r.BC1,r.BC3],engineFormat:[s.RGB_S3TC_DXT1_Format,s.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[r.ETC1,r.ETC2],engineFormat:[s.RGB_ETC2_Format,s.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[r.ETC1],engineFormat:[s.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[r.PVRTC1_4_RGB,r.PVRTC1_4_RGBA],engineFormat:[s.RGB_PVRTC_4BPPV1_Format,s.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],d=u.sort(function(E,A){return E.priorityETC1S-A.priorityETC1S}),p=u.sort(function(E,A){return E.priorityUASTC-A.priorityUASTC});function f(E,A,M,T){let C,S;const y=E===i.ETC1S?d:p;for(let R=0;R<y.length;R++){const P=y[R];if(!!n[P.if]&&!!P.basisFormat.includes(E)&&!(T&&P.transcoderFormat.length<2)&&!(P.needsPowerOfTwo&&!(m(A)&&m(M))))return C=P.transcoderFormat[T?1:0],S=P.engineFormat[T?1:0],{transcoderFormat:C,engineFormat:S}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),C=r.RGBA32,S=s.RGBAFormat,{transcoderFormat:C,engineFormat:S}}function m(E){return E<=2?!0:(E&E-1)==0&&E!==0}};var Rr=function(){var n="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",e="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",t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),s=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};var r=n;WebAssembly.validate(t)&&(r=e,console.log("Warning: meshopt_decoder is using experimental SIMD support"));var i,o=WebAssembly.instantiate(c(r),{}).then(function(f){i=f.instance,i.exports.__wasm_call_ctors()});function c(f){for(var m=new Uint8Array(f.length),E=0;E<f.length;++E){var A=f.charCodeAt(E);m[E]=A>96?A-71:A>64?A-65:A>47?A+4:A>46?63:62}for(var M=0,E=0;E<f.length;++E)m[M++]=m[E]<60?s[m[E]]:(m[E]-60)*64+m[++E];return m.buffer.slice(0,M)}function u(f,m,E,A,M,T){var C=i.exports.sbrk,S=E+3&~3,y=C(S*A),R=C(M.length),P=new Uint8Array(i.exports.memory.buffer);P.set(M,R);var B=f(y,E,A,R,M.length);if(B==0&&T&&T(y,S,A),m.set(P.subarray(y,y+E*A)),C(y-C(0)),B!=0)throw new Error("Malformed buffer data: "+B)}var d={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},p={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:o,supported:!0,decodeVertexBuffer:function(f,m,E,A,M){u(i.exports.meshopt_decodeVertexBuffer,f,m,E,A,i.exports[d[M]])},decodeIndexBuffer:function(f,m,E,A){u(i.exports.meshopt_decodeIndexBuffer,f,m,E,A)},decodeIndexSequence:function(f,m,E,A){u(i.exports.meshopt_decodeIndexSequence,f,m,E,A)},decodeGltfBuffer:function(f,m,E,A,M,T){u(i.exports[p[M]],f,m,E,A,i.exports[d[T]])}}}(),Q;(function(n){n.BEFORELOAD="beforeLoad",n.LOADING="loading",n.DETAILLOADING="detailLoading",n.DETAILLOADED="detailLoaded",n.LOADED="loaded"})(Q||(Q={}));class On extends re{constructor(e){super();h(this,"resourceMap");h(this,"loaderMap");h(this,"loadTotal");h(this,"loadSuccess");h(this,"loadError");h(this,"isError");h(this,"isLoading");h(this,"isLoaded");h(this,"loadDetailMap");h(this,"path","");this.resourceMap=new Map,this.loadTotal=0,this.loadSuccess=0,this.loadError=0,this.isError=!1,this.isLoading=!1,this.isLoaded=!1,this.loadDetailMap={};const t=new l.ImageLoader,s=new Ne,r=new _s;r.setDRACOLoader(new Mr),r.setKTX2Loader(new oe),r.setMeshoptDecoder(Rr),this.loaderMap={jpg:t,png:t,jpeg:t,obj:new Ss.OBJLoader,mtl:new Rs.MTLLoader,mp4:s,webm:s,ogg:s,hdr:new Os.RGBELoader,gltf:r,glb:r},e&&(this.loaderMap=Object.assign(this.loaderMap,e.loaderExtends))}loaded(){return this.dispatchEvent({type:Q.LOADED,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError,resourceMap:this.resourceMap}),this}checkLoaded(){return this.loadTotal===this.loadSuccess+this.loadError&&(this.isError=!0,this.isLoaded=!0,this.isLoading=!1,this.loaded()),this}setPath(e){return this.path=e,this}getLoader(e){return this.loaderMap[e]?this.loaderMap[e]:null}load(e){var i;if(this.reset(),this.isLoading=!0,this.dispatchEvent({type:Q.BEFORELOAD,urlList:[...e]}),e.length<=0)return this.checkLoaded(),console.warn("url list is empty."),this;this.loadTotal+=e.length;const t=this.resourceMap,s=this.loaderMap,r=this.loadDetailMap;for(const o of e){let c,u;typeof o=="string"?(c=o,u=((i=c.split(".").pop())==null?void 0:i.toLocaleLowerCase())||""):(c=o.url,u=o.ext.toLocaleLowerCase());const d={url:c,progress:0,error:!1,message:c};if(r[c]=d,t.has(c)){d.progress=1,this.loadSuccess+=1,this.dispatchEvent({type:Q.DETAILLOADED,detail:d}),this.dispatchEvent({type:Q.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded();continue}if(!u){d.message=`url: ${c} \u5730\u5740\u6709\u8BEF\uFF0C\u65E0\u6CD5\u83B7\u53D6\u6587\u4EF6\u683C\u5F0F\u3002`,console.warn(d.message),d.error=!0,this.isError=!0,this.loadError+=1,this.dispatchEvent({type:Q.DETAILLOADED,detail:d}),this.dispatchEvent({type:Q.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError});continue}const p=s[u];if(!p){d.message=`url: ${c} \u4E0D\u652F\u6301\u6B64\u6587\u4EF6\u683C\u5F0F\u52A0\u8F7D\u3002`,console.warn(d.message),d.error=!0,this.isError=!0,this.loadError+=1,this.dispatchEvent({type:Q.DETAILLOADED,detail:d}),this.dispatchEvent({type:Q.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError});continue}const f=c.replace(/\\/g,"/").split("/"),m=f.pop(),E=this.path+f.join("/")+"/";p.setPath(E).loadAsync(m,A=>{d.progress=Number((A.loaded/A.total).toFixed(2)),this.dispatchEvent({type:Q.DETAILLOADING,detail:d})}).then(A=>{d.progress=1,this.loadSuccess+=1,this.resourceMap.set(c,A),this.dispatchEvent({type:Q.DETAILLOADED,detail:d}),this.dispatchEvent({type:Q.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded()}).catch(A=>{d.error=!0,d.message=JSON.stringify(A),this.loadError+=1,this.dispatchEvent({type:Q.DETAILLOADED,detail:d}),this.dispatchEvent({type:Q.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded()})}return this}reset(){return this.loadTotal=0,this.loadSuccess=0,this.loadError=0,this.isError=!1,this.isLoading=!1,this.isLoaded=!1,this.loadDetailMap={},this}register(e,t){return this.loaderMap[e]=t,this}hasLoaded(e){return this.resourceMap.has(e)}getResource(e){return this.resourceMap.get(e)}getLoadDetailMap(){return this.loadDetailMap}setLoadDetailMap(e){return this.loadDetailMap=e,this}remove(e){}toJSON(){const e=[];return this.resourceMap.forEach((t,s)=>{e.push(s)}),JSON.stringify(e)}exportConfig(){const e=[];return this.resourceMap.forEach((t,s)=>{e.push(s)}),e}dispose(){return this.resourceMap.clear(),this}}const Or=function(n){if(this.loaderManager)return console.warn("engine has installed loaderManager plugin."),!1;const e=new On(n);return this.loaderManager=e,this.loadResources=(t,s)=>{if(this.resourceManager){const r=i=>{s(void 0,i),this.resourceManager.removeEventListener("mapped",r)};try{this.resourceManager.addEventListener("mapped",r)}catch(i){s(i)}}else{const r=i=>{s(void 0,i),this.loaderManager.removeEventListener("loaded",r)};try{this.loaderManager.addEventListener("loaded",r)}catch(i){s(i)}}return this.loaderManager.load(t),this},this.loadResourcesAsync=t=>new Promise((s,r)=>{if(this.resourceManager){const i=o=>{s(o),this.resourceManager.removeEventListener("mapped",i)};try{this.resourceManager.addEventListener("mapped",i)}catch(o){r(o)}}else{const i=o=>{s(o),this.loaderManager.removeEventListener("loaded",i)};try{this.loaderManager.addEventListener("loaded",i)}catch(o){r(o)}}this.loaderManager.load(t)}),!0};a.CONFIGTYPE=void 0,function(n){n.BOXGEOMETRY="BoxGeometry",n.SPHEREGEOMETRY="SphereGeometry",n.LOADGEOMETRY="LoadGeometry",n.PLANEGEOMETRY="PlaneGeometry",n.CIRCLEGEOMETRY="CircleGeometry",n.CONEGEOMETRY="ConeGeometry",n.CYLINDERGEOMETRY="CylinderGeometry",n.DODECAHEDRONGEOMETRY="DodecahedronGeometry",n.TORUSGEOMETRY="TorusGeometry",n.RINGGEOMETRY="RingGeometry",n.EDGESGEOMETRY="EdgesGeometry",n.LINECURVEGEOMETRY="LineCurveGeometry",n.SPLINECURVEGEOMETRY="SplineCurveGeometry",n.CUBICBEZIERCURVEGEOMETRY="CubicBezierCurveGeometry",n.QUADRATICBEZIERCURVEGEOMETRY="QuadraticBezierCurveGeometry",n.CUSTOMGEOMETRY="CustomGeometry",n.LINETUBEGEOMETRY="LineTubeGeometry",n.SPLINETUBEGEOMETRY="SplineTubeGeometry",n.LINESHAPEGEOMETRY="LineShapeGeometry",n.OBJECT3D="Object3D",n.MESH="Mesh",n.LINE="Line",n.POINTS="Points",n.SPRITE="Sprite",n.GROUP="Group",n.CSS3DOBJECT="CSS3DObject",n.CSS3DSPRITE="CSS3DSprite",n.CSS3DPLANE="CSS3DPlane",n.IMAGETEXTURE="ImageTexture",n.CUBETEXTURE="CubeTexture",n.CANVASTEXTURE="CanvasTexture",n.VIDEOTEXTURE="VideoTexture",n.LOADTEXTURE="LoadTexture",n.MESHBASICMATERIAL="MeshBasicMaterial",n.MESHSTANDARDMATERIAL="MeshStandardMaterial",n.MESHPHONGMATERIAL="MeshPhongMaterial",n.SPRITEMATERIAL="SpriteMaterial",n.LINEBASICMATERIAL="LineBasicMaterial",n.POINTSMATERIAL="PointsMaterial",n.SHADERMATERIAL="ShaderMaterial",n.MESHPHYSICALMATERIAL="MeshPhysicalMaterial",n.AMBIENTLIGHT="AmbientLight",n.SPOTLIGHT="SpotLight",n.POINTLIGHT="PointLight",n.DIRECTIONALLIGHT="DirectionalLight",n.HEMISPHERELIGHT="HemisphereLight",n.PERSPECTIVECAMERA="PerspectiveCamera",n.ORTHOGRAPHICCAMERA="OrthographicCamera",n.WEBGLRENDERER="WebGLRenderer",n.CSS3DRENDERER="CSS3DRenderer",n.SCENE="Scene",n.TRNASFORMCONTROLS="TransformControls",n.ORBITCONTROLS="OrbitControls",n.SMAAPASS="SMAAPass",n.UNREALBLOOMPASS="UnrealBloomPass",n.SELECTIVEBLOOMPASS="SelectiveBloomPass",n.SCRIPTANIMATION="ScriptAnimation",n.KEYFRAMEANIMATION="KeyframeAnimation"}(a.CONFIGTYPE||(a.CONFIGTYPE={})),a.MODULETYPE=void 0,function(n){n.OBJECT3D="Object3D",n.CAMERA="camera",n.LIGHT="light",n.GEOMETRY="geometry",n.TEXTURE="texture",n.MATERIAL="material",n.RENDERER="renderer",n.SCENE="scene",n.SPRITE="sprite",n.CONTROLS="controls",n.LINE="line",n.MESH="mesh",n.POINTS="points",n.GROUP="group",n.CSS3D="css3D",n.PASS="pass",n.ANIMATION="animation"}(a.MODULETYPE||(a.MODULETYPE={})),a.OBJECTMODULE=void 0,function(n){n[n.CAMERA=a.MODULETYPE.CAMERA]="CAMERA",n[n.LIGHT=a.MODULETYPE.LIGHT]="LIGHT",n[n.SCENE=a.MODULETYPE.SCENE]="SCENE",n[n.SPRITE=a.MODULETYPE.SPRITE]="SPRITE",n[n.LINE=a.MODULETYPE.LINE]="LINE",n[n.MESH=a.MODULETYPE.MESH]="MESH",n[n.POINTS=a.MODULETYPE.POINTS]="POINTS",n[n.GROUP=a.MODULETYPE.GROUP]="GROUP",n[n.CSS3D=a.MODULETYPE.CSS3D]="CSS3D",n[n.OBJECT3D=a.MODULETYPE.OBJECT3D]="OBJECT3D"}(a.OBJECTMODULE||(a.OBJECTMODULE={}));const Gr={[a.CONFIGTYPE.IMAGETEXTURE]:a.MODULETYPE.TEXTURE,[a.CONFIGTYPE.CUBETEXTURE]:a.MODULETYPE.TEXTURE,[a.CONFIGTYPE.CANVASTEXTURE]:a.MODULETYPE.TEXTURE,[a.CONFIGTYPE.VIDEOTEXTURE]:a.MODULETYPE.TEXTURE,[a.CONFIGTYPE.MESHBASICMATERIAL]:a.MODULETYPE.MATERIAL,[a.CONFIGTYPE.MESHSTANDARDMATERIAL]:a.MODULETYPE.MATERIAL,[a.CONFIGTYPE.MESHPHONGMATERIAL]:a.MODULETYPE.MATERIAL,[a.CONFIGTYPE.SPRITEMATERIAL]:a.MODULETYPE.MATERIAL,[a.CONFIGTYPE.LINEBASICMATERIAL]:a.MODULETYPE.MATERIAL,[a.CONFIGTYPE.POINTSMATERIAL]:a.MODULETYPE.MATERIAL,[a.CONFIGTYPE.SHADERMATERIAL]:a.MODULETYPE.MATERIAL,[a.CONFIGTYPE.AMBIENTLIGHT]:a.MODULETYPE.LIGHT,[a.CONFIGTYPE.SPOTLIGHT]:a.MODULETYPE.LIGHT,[a.CONFIGTYPE.POINTLIGHT]:a.MODULETYPE.LIGHT,[a.CONFIGTYPE.DIRECTIONALLIGHT]:a.MODULETYPE.LIGHT,[a.CONFIGTYPE.BOXGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.SPHEREGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.LOADGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.CUSTOMGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.PLANEGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.CIRCLEGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.CONEGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.CIRCLEGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.EDGESGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.CYLINDERGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.LINECURVEGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.SPLINECURVEGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.CUBICBEZIERCURVEGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.QUADRATICBEZIERCURVEGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.LINETUBEGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.SPLINETUBEGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.TORUSGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.RINGGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.LINESHAPEGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.SPRITE]:a.MODULETYPE.SPRITE,[a.CONFIGTYPE.LINE]:a.MODULETYPE.LINE,[a.CONFIGTYPE.MESH]:a.MODULETYPE.MESH,[a.CONFIGTYPE.POINTS]:a.MODULETYPE.POINTS,[a.CONFIGTYPE.GROUP]:a.MODULETYPE.GROUP,[a.CONFIGTYPE.CSS3DOBJECT]:a.MODULETYPE.CSS3D,[a.CONFIGTYPE.CSS3DSPRITE]:a.MODULETYPE.CSS3D,[a.CONFIGTYPE.CSS3DPLANE]:a.MODULETYPE.CSS3D,[a.CONFIGTYPE.PERSPECTIVECAMERA]:a.MODULETYPE.CAMERA,[a.CONFIGTYPE.ORTHOGRAPHICCAMERA]:a.MODULETYPE.CAMERA,[a.CONFIGTYPE.WEBGLRENDERER]:a.MODULETYPE.RENDERER,[a.CONFIGTYPE.SCENE]:a.MODULETYPE.SCENE,[a.CONFIGTYPE.TRNASFORMCONTROLS]:a.MODULETYPE.CONTROLS,[a.CONFIGTYPE.ORBITCONTROLS]:a.MODULETYPE.CONTROLS,[a.CONFIGTYPE.SMAAPASS]:a.MODULETYPE.PASS,[a.CONFIGTYPE.UNREALBLOOMPASS]:a.MODULETYPE.PASS,[a.CONFIGTYPE.SCRIPTANIMATION]:a.MODULETYPE.ANIMATION,[a.CONFIGTYPE.KEYFRAMEANIMATION]:a.MODULETYPE.ANIMATION},ke=n=>{const e=t=>n.toLocaleLowerCase().includes(t.toLocaleLowerCase());for(const t of Object.values(a.MODULETYPE))if(e(t))return t;return null},Ee=()=>({vid:"",name:"",type:a.CONFIGTYPE.OBJECT3D,castShadow:!0,receiveShadow:!0,lookAt:"",visible:!0,matrixAutoUpdate:!0,renderOrder:0,position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},up:{x:0,y:1,z:0},parent:"",children:[],pointerdown:[],pointermove:[],pointerup:[],pointerenter:[],pointerleave:[],click:[],dblclick:[],contextmenu:[]}),lt=function(){return Object.assign(Ee(),{type:"Light",color:"rgb(255, 255, 255)",intensity:1})},br=function(){return Object.assign(Ee(),{type:a.CONFIGTYPE.AMBIENTLIGHT,color:"rgb(255, 255, 255)",intensity:1})},Ir=function(){return Object.assign(lt(),{type:a.CONFIGTYPE.POINTLIGHT,distance:30,decay:.01})},Lr=function(){return Object.assign(lt(),{type:a.CONFIGTYPE.SPOTLIGHT,distance:30,angle:Math.PI/180*45,penumbra:.01,decay:.01})},Pr=function(){return Object.assign(lt(),{type:a.CONFIGTYPE.DIRECTIONALLIGHT,shadow:{mapSize:{width:512,height:512},camera:{near:.5,far:500}}})},Dr=function(){return Object.assign(lt(),{type:a.CONFIGTYPE.HEMISPHERELIGHT,color:"rgb(255, 255, 255)",groundColor:"rgb(0, 0, 0)"})},V=function(){return{vid:"",type:"Geometry",position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},groups:[]}},Fr=function(){return Object.assign(V(),{type:a.CONFIGTYPE.BOXGEOMETRY,width:5,height:5,depth:5,widthSegments:1,heightSegments:1,depthSegments:1})},wr=function(){return Object.assign(V(),{type:a.CONFIGTYPE.SPHEREGEOMETRY,radius:3,widthSegments:32,heightSegments:32,phiStart:0,phiLength:Math.PI*2,thetaStart:0,thetaLength:Math.PI})},Nr=function(){return Object.assign(V(),{type:a.CONFIGTYPE.PLANEGEOMETRY,width:5,height:5,widthSegments:1,heightSegments:1})},vr=function(){return Object.assign(V(),{type:a.CONFIGTYPE.CIRCLEGEOMETRY,radius:3,segments:8,thetaStart:0,thetaLength:Math.PI*2})},Ur=function(){return Object.assign(V(),{type:a.CONFIGTYPE.CONEGEOMETRY,radius:3,height:5,radialSegments:8,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:Math.PI*2})},Hr=function(){return Object.assign(V(),{type:a.CONFIGTYPE.TORUSGEOMETRY,radius:3,tube:.4,radialSegments:8,tubularSegments:6,arc:Math.PI*2})},xr=function(){return Object.assign(V(),{type:a.CONFIGTYPE.RINGGEOMETRY,innerRadius:2,outerRadius:3,thetaSegments:8,phiSegments:8,thetaStart:0,thetaLength:Math.PI*2})},Yr=function(){return Object.assign(V(),{type:a.CONFIGTYPE.LOADGEOMETRY,url:""})},jr=function(){return Object.assign(V(),{type:a.CONFIGTYPE.CUSTOMGEOMETRY,attribute:{position:[],color:[],index:[],normal:[],uv:[],uv2:[]}})},Jr=function(){return Object.assign(V(),{type:a.CONFIGTYPE.CYLINDERGEOMETRY,radiusTop:3,radiusBottom:3,height:5,radialSegments:8,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:Math.PI*2})},kr=function(){return Object.assign(V(),{type:"",radius:3,detail:0})},_r=function(){return Object.assign(V(),{type:a.CONFIGTYPE.LOADGEOMETRY,url:"",thresholdAngle:1})},ut=function(){return Object.assign(V(),{path:[],divisions:36,space:!0})},Kr=function(){return Object.assign(ut(),{type:a.CONFIGTYPE.LINECURVEGEOMETRY})},Wr=function(){return Object.assign(ut(),{type:a.CONFIGTYPE.SPLINECURVEGEOMETRY})},Qr=function(){return Object.assign(ut(),{type:a.CONFIGTYPE.CUBICBEZIERCURVEGEOMETRY})},Vr=function(){return Object.assign(ut(),{type:a.CONFIGTYPE.QUADRATICBEZIERCURVEGEOMETRY})},Gn=function(){return Object.assign(V(),{type:"TubeGeometry",path:[],tubularSegments:64,radius:1,radialSegments:8,closed:!1})},Xr=function(){return Object.assign(Gn(),{type:a.CONFIGTYPE.LINETUBEGEOMETRY})},zr=function(){return Object.assign(Gn(),{type:a.CONFIGTYPE.SPLINETUBEGEOMETRY})},Zr=function(){return Object.assign(V(),{path:[],curveSegments:12})},$r=function(){return Object.assign(Zr(),{type:a.CONFIGTYPE.LINESHAPEGEOMETRY})},tt=function(){return{vid:"",type:"Texture",name:"",mapping:l.UVMapping,wrapS:l.ClampToEdgeWrapping,wrapT:l.ClampToEdgeWrapping,magFilter:l.LinearFilter,minFilter:l.LinearMipmapLinearFilter,anisotropy:1,format:l.RGBAFormat,flipY:!0,offset:{x:0,y:0},repeat:{x:1,y:1},rotation:0,center:{x:0,y:0},matrixAutoUpdate:!0,encoding:l.LinearEncoding,needsUpdate:!1}},qr=function(){return Object.assign(tt(),{type:a.CONFIGTYPE.IMAGETEXTURE,url:""})},ei=function(){return Object.assign(tt(),{type:a.CONFIGTYPE.VIDEOTEXTURE,url:"",minFilter:l.LinearFilter})},ti=function(){return Object.assign(tt(),{type:a.CONFIGTYPE.CUBETEXTURE,cube:{nx:"",ny:"",nz:"",px:"",py:"",pz:""},mapping:l.CubeReflectionMapping,flipY:!1})},ni=function(){return Object.assign(tt(),{type:a.CONFIGTYPE.CANVASTEXTURE,url:"",needsUpdate:!1})},si=function(){return Object.assign(tt(),{type:a.CONFIGTYPE.LOADTEXTURE,url:""})},Ue=function(){return{vid:"",type:"Material",alphaTest:0,colorWrite:!0,depthTest:!0,depthWrite:!0,fog:!0,name:"",needsUpdate:!1,opacity:1,dithering:!1,shadowSide:null,side:l.FrontSide,toneMapped:!0,transparent:!1,visible:!0,blendDst:l.OneMinusSrcAlphaFactor,blendDstAlpha:null,blendEquation:l.AddEquation,blendEquationAlpha:null,blending:l.NormalBlending,blendSrc:l.SrcAlphaFactor,blendSrcAlpha:null,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0}},ri=function(){return Object.assign(Ue(),{type:a.CONFIGTYPE.MESHBASICMATERIAL,color:"rgb(255, 255, 255)",combine:l.MultiplyOperation,aoMapIntensity:1,fog:!0,lightMapIntensity:1,reflectivity:1,refractionRatio:.98,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",wireframeLinewidth:1,map:"",envMap:"",alphaMap:"",aoMap:"",lightMap:"",specularMap:""})},bn=function(){return Object.assign(Ue(),{type:a.CONFIGTYPE.MESHSTANDARDMATERIAL,aoMapIntensity:1,bumpScale:1,color:"rgb(255, 255, 255)",displacementScale:1,displacementBias:0,emissive:"rgb(0, 0, 0)",emissiveIntensity:1,envMapIntensity:1,flatShading:!1,lightMapIntensity:1,metalness:0,normalMapType:l.TangentSpaceNormalMap,refractionRatio:.98,roughness:1,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",roughnessMap:"",normalMap:"",metalnessMap:"",map:"",lightMap:"",envMap:"",emissiveMap:"",displacementMap:"",bumpMap:"",alphaMap:"",aoMap:""})},ii=function(){return Object.assign(bn(),{type:a.CONFIGTYPE.MESHPHYSICALMATERIAL,attenuationColor:"rgb(255, 255, 255)",attenuationDistance:0,clearcoat:0,clearcoatNormalScale:{x:1,y:1},clearcoatRoughness:0,ior:1.5,reflectivity:.5,sheen:0,sheenRoughness:1,sheenColor:"rgb(255, 255, 255)",specularIntensity:0,specularColor:"rgb(255, 255, 255)",thickness:0,transmission:0,clearcoatMap:"",clearcoatNormalMap:"",clearcoatRoughnessMap:"",sheenRoughnessMap:"",sheenColorMap:"",specularIntensityMap:"",specularColorMap:"",thicknessMap:"",transmissionMap:""})},oi=function(){return Object.assign(Ue(),{type:a.CONFIGTYPE.MESHPHONGMATERIAL,aoMapIntensity:1,bumpScale:1,color:"rgb(255, 255, 255)",displacementScale:1,displacementBias:0,emissive:"rgb(0, 0, 0)",emissiveIntensity:1,envMapIntensity:1,flatShading:!1,lightMapIntensity:1,normalMapType:l.TangentSpaceNormalMap,refractionRatio:.98,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",specular:"rgb(17, 17, 17)",shininess:30,combine:l.MultiplyOperation,normalMap:"",map:"",lightMap:"",envMap:"",emissiveMap:"",displacementMap:"",bumpMap:"",alphaMap:"",aoMap:"",specularMap:""})},ai=function(){return Object.assign(Ue(),{type:a.CONFIGTYPE.SPRITEMATERIAL,color:"rgb(255, 255, 255)",rotation:0,map:"",alphaMap:"",sizeAttenuation:!0})},ci=function(){return Object.assign(Ue(),{type:a.CONFIGTYPE.LINEBASICMATERIAL,color:"rgb(255, 255, 255)",linecap:"round",linejoin:"round",linewidth:1})},li=function(){return Object.assign(Ue(),{type:a.CONFIGTYPE.POINTSMATERIAL,map:"",alphaMap:"",color:"rgb(255, 255, 255)",sizeAttenuation:!0,size:1})},ui=function(){return Object.assign(Ue(),{type:a.CONFIGTYPE.SHADERMATERIAL,shader:"defaultShader",uniforms:{}})},di=function(){return Object.assign(Ee(),{type:a.CONFIGTYPE.PERSPECTIVECAMERA,adaptiveWindow:!1,fov:45,aspect:1920/1080,near:5,far:50})},hi=function(){return Object.assign(Ee(),{type:a.CONFIGTYPE.ORTHOGRAPHICCAMERA,adaptiveWindow:!1,left:-window.innerWidth,right:window.innerWidth,top:window.innerHeight,bottom:-window.innerHeight,near:5,far:50,zoom:1})},In=function(){return{vid:"",type:"Renderer",size:null}},pi=function(){return Object.assign(In(),{vid:a.CONFIGTYPE.WEBGLRENDERER,type:a.CONFIGTYPE.WEBGLRENDERER,clearColor:"rgba(0, 0, 0, 0)",outputEncoding:l.LinearEncoding,physicallyCorrectLights:!1,shadowMap:{enabled:!1,autoUpdate:!0,needsUpdate:!1,type:l.PCFShadowMap},toneMapping:l.NoToneMapping,toneMappingExposure:1,pixelRatio:window.devicePixelRatio,adaptiveCamera:!1,viewport:null,scissor:null})},fi=function(){return Object.assign(In(),{vid:a.CONFIGTYPE.CSS3DRENDERER,type:a.CONFIGTYPE.CSS3DRENDERER})},mi=function(){return Object.assign(Ee(),{vid:a.CONFIGTYPE.SCENE,type:a.CONFIGTYPE.SCENE,background:"",environment:"",fog:{type:"",color:"rgb(150, 150, 150)",near:1,far:200,density:.003}})},Ei=function(){return{vid:a.CONFIGTYPE.TRNASFORMCONTROLS,type:a.CONFIGTYPE.TRNASFORMCONTROLS,axis:"XYZ",enabled:!0,mode:"translate",snapAllow:!1,rotationSnap:Math.PI/180*10,translationSnap:5,scaleSnap:.1,showX:!0,showY:!0,showZ:!0,size:1,space:"world"}},gi=function(){return{vid:a.CONFIGTYPE.ORBITCONTROLS,type:a.CONFIGTYPE.ORBITCONTROLS,autoRotate:!1,autoRotateSpeed:2,enableDamping:!1,dampingFactor:.05,enabled:!0,enablePan:!0,enableRotate:!0,enableZoom:!0,maxAzimuthAngle:1/0,maxDistance:1/0,maxPolarAngle:Math.PI,maxZoom:1/0,minAzimuthAngle:-1/0,minDistance:0,minPolarAngle:0,minZoom:0,panSpeed:1,rotateSpeed:1,zoomSpeed:1,screenSpacePanning:!0,target:null}},dt=function(){return Object.assign(Ee(),{material:"",geometry:""})},Ai=function(){return Object.assign(dt(),{type:"Sprite",material:"",center:{x:.5,y:.5}})},Ci=function(){return Object.assign(dt(),{type:a.CONFIGTYPE.MESH,geometry:"",material:""})},Mi=function(){return Object.assign(dt(),{type:a.CONFIGTYPE.POINTS,geometry:"",material:""})},Ti=function(){return Object.assign(dt(),{type:a.CONFIGTYPE.LINE,geometry:"",material:""})},Bi=function(){return Object.assign(Ee(),{type:a.CONFIGTYPE.GROUP,children:[]})},jt=function(){return{vid:"",type:"Pass"}},yi=function(){return Object.assign(jt(),{type:a.CONFIGTYPE.SMAAPASS})},Si=function(){return Object.assign(jt(),{type:a.CONFIGTYPE.UNREALBLOOMPASS,strength:1.5,threshold:0,radius:0})},Ri=function(){return Object.assign(jt(),{type:a.CONFIGTYPE.SELECTIVEBLOOMPASS,strength:1,threshold:0,radius:0,renderScene:"",renderCamera:"",selectedObjects:[]})},Ln=function(){return{vid:"",type:"",name:"",target:"",attribute:"",play:!0}},Oi=function(){return Object.assign(Ln(),{type:a.CONFIGTYPE.SCRIPTANIMATION,script:{name:""}})},Gi=function(){return Object.assign(Ln(),{type:a.CONFIGTYPE.KEYFRAMEANIMATION,script:{name:""}})},Jt=function(){return Object.assign(Ee(),{type:a.CONFIGTYPE.CSS3DOBJECT,element:"",width:50,height:50})},bi=function(){return Object.assign(Jt(),{type:a.CONFIGTYPE.CSS3DPLANE})},Ii=function(){return Object.assign(Jt(),{type:a.CONFIGTYPE.CSS3DSPRITE,rotation2D:0})},j={[a.CONFIGTYPE.IMAGETEXTURE]:qr,[a.CONFIGTYPE.CUBETEXTURE]:ti,[a.CONFIGTYPE.CANVASTEXTURE]:ni,[a.CONFIGTYPE.VIDEOTEXTURE]:ei,[a.CONFIGTYPE.LOADTEXTURE]:si,[a.CONFIGTYPE.MESHBASICMATERIAL]:ri,[a.CONFIGTYPE.MESHSTANDARDMATERIAL]:bn,[a.CONFIGTYPE.MESHPHONGMATERIAL]:oi,[a.CONFIGTYPE.SPRITEMATERIAL]:ai,[a.CONFIGTYPE.LINEBASICMATERIAL]:ci,[a.CONFIGTYPE.POINTSMATERIAL]:li,[a.CONFIGTYPE.SHADERMATERIAL]:ui,[a.CONFIGTYPE.MESHPHYSICALMATERIAL]:ii,[a.CONFIGTYPE.AMBIENTLIGHT]:br,[a.CONFIGTYPE.SPOTLIGHT]:Lr,[a.CONFIGTYPE.POINTLIGHT]:Ir,[a.CONFIGTYPE.DIRECTIONALLIGHT]:Pr,[a.CONFIGTYPE.HEMISPHERELIGHT]:Dr,[a.CONFIGTYPE.BOXGEOMETRY]:Fr,[a.CONFIGTYPE.SPHEREGEOMETRY]:wr,[a.CONFIGTYPE.LOADGEOMETRY]:Yr,[a.CONFIGTYPE.CUSTOMGEOMETRY]:jr,[a.CONFIGTYPE.PLANEGEOMETRY]:Nr,[a.CONFIGTYPE.CIRCLEGEOMETRY]:vr,[a.CONFIGTYPE.CONEGEOMETRY]:Ur,[a.CONFIGTYPE.CYLINDERGEOMETRY]:Jr,[a.CONFIGTYPE.EDGESGEOMETRY]:_r,[a.CONFIGTYPE.LINECURVEGEOMETRY]:Kr,[a.CONFIGTYPE.SPLINECURVEGEOMETRY]:Wr,[a.CONFIGTYPE.CUBICBEZIERCURVEGEOMETRY]:Qr,[a.CONFIGTYPE.QUADRATICBEZIERCURVEGEOMETRY]:Vr,[a.CONFIGTYPE.DODECAHEDRONGEOMETRY]:kr,[a.CONFIGTYPE.SPLINETUBEGEOMETRY]:zr,[a.CONFIGTYPE.LINETUBEGEOMETRY]:Xr,[a.CONFIGTYPE.TORUSGEOMETRY]:Hr,[a.CONFIGTYPE.RINGGEOMETRY]:xr,[a.CONFIGTYPE.LINESHAPEGEOMETRY]:$r,[a.CONFIGTYPE.OBJECT3D]:Ee,[a.CONFIGTYPE.SPRITE]:Ai,[a.CONFIGTYPE.LINE]:Ti,[a.CONFIGTYPE.MESH]:Ci,[a.CONFIGTYPE.POINTS]:Mi,[a.CONFIGTYPE.GROUP]:Bi,[a.CONFIGTYPE.CSS3DOBJECT]:Jt,[a.CONFIGTYPE.CSS3DSPRITE]:Ii,[a.CONFIGTYPE.CSS3DPLANE]:bi,[a.CONFIGTYPE.PERSPECTIVECAMERA]:di,[a.CONFIGTYPE.ORTHOGRAPHICCAMERA]:hi,[a.CONFIGTYPE.WEBGLRENDERER]:pi,[a.CONFIGTYPE.CSS3DRENDERER]:fi,[a.CONFIGTYPE.SCENE]:mi,[a.CONFIGTYPE.TRNASFORMCONTROLS]:Ei,[a.CONFIGTYPE.ORBITCONTROLS]:gi,[a.CONFIGTYPE.SMAAPASS]:yi,[a.CONFIGTYPE.UNREALBLOOMPASS]:Si,[a.CONFIGTYPE.SELECTIVEBLOOMPASS]:Ri,[a.CONFIGTYPE.SCRIPTANIMATION]:Oi,[a.CONFIGTYPE.KEYFRAMEANIMATION]:Gi},Li=(n,e,t)=>{const s=(r,i)=>Object.getPrototypeOf(i)?t.has(Object.getPrototypeOf(i).constructor.name+"Parser")?t.get(Object.getPrototypeOf(i).constructor.name+"Parser"):s(r,Object.getPrototypeOf(i)):null;return s(n,e)};class He{registHandler(){return Li}}class Pi extends He{parse({url:e,resource:t,configMap:s,resourceMap:r}){const i=j[a.CONFIGTYPE.IMAGETEXTURE]();i.url=e,r.set(e,t),s.set(e,i)}}class Di extends He{parse({url:e,resource:t,configMap:s,resourceMap:r}){const i=j[a.CONFIGTYPE.CANVASTEXTURE]();i.url=e,r.set(e,t),s.set(e,i)}}class Fi extends He{parse({url:e,resource:t,configMap:s,resourceMap:r}){const i=j[a.CONFIGTYPE.VIDEOTEXTURE]();i.url=e,r.set(e,t),s.set(e,i)}}function Pn(n,e){return n in e}function wi(n,e){return Object.values(n).includes(e)}function Ni(n){return e=>{const t=(s,r)=>{for(const i in r){if(s[i]===void 0){console.warn(` config can not set key: ${i}`);continue}typeof r[i]=="object"&&r[i]!==null&&!Array.isArray(r[i])?t(s[i],r[i]):s[i]=r[i]}};return e&&t(n,e),n}}function k(n,e,t,s){const r=(i,o,c)=>{for(const u in i)if(o[u]!==void 0&&!(c&&c[u])){if(typeof i[u]=="object"&&typeof i[u]!==null){c&&typeof c[u]=="object"&&typeof c[u]!==null?r(i[u],o[u],c[u]):r(i[u],o[u]);continue}o[u]=i[u]}};r(n,e,t),s&&s()}var vi=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",isValidKey:Pn,isValidEnum:wi,generateConfigFunction:Ni,syncObject:k});class Dn extends He{parse(e){this.parseObject3D(e)}parseColor(e){return`rgb(${Math.round(255*e.r)}, ${Math.round(255*e.g)}, ${Math.round(255*e.b)})`}attributeEnhance(e){const t={};for(const s in e)s.startsWith("_")?t[s.slice(1)]=e[s]:t[s]=e[s];return t}parseTexture({url:e,resource:t,configMap:s,resourceMap:r}){r.set(e,t);const i=j[a.CONFIGTYPE.LOADTEXTURE]();s.set(e,i),i.vid=se.v4(),i.url=e,k(t,i,{type:!0,vid:!0,url:!0})}parseMaterial({url:e,resource:t,configMap:s,resourceMap:r}){if(r.set(e,t),!j[t.type]){console.warn("can not found support config in vis for this resource",t);return}const i=j[t.type]();s.set(e,i),i.vid=se.v4(),k(this.attributeEnhance(t),i,{type:!0,vid:!0});for(const o in t)if(!!t[o]){if(t[o].isColor)i[o]=this.parseColor(t[o]);else if(o.toLocaleLowerCase().endsWith("map")&&t[o]){const c=`${e}.${o}`;this.parseTexture({url:c,resource:t[o],configMap:s,resourceMap:r}),i[o]=s.get(c).vid}}}parseGeometry({url:e,resource:t,configMap:s,resourceMap:r}){r.set(e,t),t.computeBoundingBox();const i=t.boundingBox,o=i.getCenter(new l.Vector3),c=j[a.CONFIGTYPE.LOADGEOMETRY]();c.vid=se.v4(),c.url=e,c.position.x=o.x/(i.max.x-i.min.x)*2,c.position.y=o.y/(i.max.y-i.min.y)*2,c.position.z=o.z/(i.max.z-i.min.z)*2,s.set(e,c)}parseObject3D({url:e,resource:t,configMap:s,resourceMap:r}){if(r.set(e,t),!j[t.type]){console.warn("can not found support config in vis for this resource",t);return}const i=j[t.type]();if(i.vid=se.v4(),k(t,i,{type:!0,vid:!0,children:!0,geometry:!0,material:!0,parent:!0,lookAt:!0}),i.rotation.x=t.rotation.x,i.rotation.y=t.rotation.y,i.rotation.z=t.rotation.z,s.set(e,i),t.material)if(Array.isArray(t.material))i.material=[],t.material.forEach((o,c,u)=>{const d=`${e}.material.${c}`;this.parseMaterial({url:d,resource:o,configMap:s,resourceMap:r}),i.material.push(s.get(d).vid)});else{const o=`${e}.material`;this.parseMaterial({url:o,resource:t.material,configMap:s,resourceMap:r}),i.material=s.get(o).vid}if(t.geometry){const o=`${e}.geometry`;this.parseGeometry({url:o,resource:t.geometry,configMap:s,resourceMap:r}),i.geometry=s.get(o).vid}t.children&&t.children.length&&t.children.forEach((o,c,u)=>{const d=`${e}.children.${c}`;this.parseObject3D({url:d,resource:o,configMap:s,resourceMap:r}),i.children.push(s.get(d).vid)})}}class Ui extends He{parse({url:e,resource:t,configMap:s,resourceMap:r}){const i=j[a.CONFIGTYPE.CSS3DPLANE]();i.element=e,r.set(e,t),s.set(e,i)}}class Hi extends He{parse({url:e,resource:t,configMap:s,resourceMap:r}){const i=j[a.CONFIGTYPE.LOADTEXTURE]();i.url=e,r.set(e,t),s.set(e,i)}}class xi extends He{constructor(){super();h(this,"object3DParser",new Dn)}parse({url:e,resource:t,configMap:s,resourceMap:r}){this.object3DParser.parse({url:`${e}.scene`,resource:t.scene,configMap:s,resourceMap:r})}registHandler(){return(e,t,s)=>t.parser.constructor.name==="GLTFParser"&&s.get(this.constructor.name)||null}}a.RESOURCEEVENTTYPE=void 0,function(n){n.MAPPED="mapped"}(a.RESOURCEEVENTTYPE||(a.RESOURCEEVENTTYPE={}));class Fn extends re{constructor(e={}){super();h(this,"structureMap",new Map);h(this,"configMap",new Map);h(this,"resourceMap",new Map);h(this,"paserMap",new Map);h(this,"handlerMap",new Map);this.addParser(new Pi,{warn:!1}).addParser(new Di,{warn:!1}).addParser(new Fi,{warn:!1}).addParser(new Dn,{warn:!1}).addParser(new Ui,{warn:!1}).addParser(new Hi,{warn:!1}).addParser(new xi,{warn:!1});const t=new Map;for(const s in e)t.has(s)&&console.warn(`resourceManager construct params rescource already exist: ${s}, that will be cover.`),t.set(s,e[s]);this.mappingResource(t)}addParser(e,t={warn:!0}){return this.paserMap.has(e.constructor.name)&&t.warn&&console.warn("resourceManager has already exist this parser, that will be cover",this.paserMap.get(e.constructor.name)),this.paserMap.set(e.constructor.name,e),this.addHanlder(e.registHandler(),t),this}addHanlder(e,t={warn:!0}){return this.handlerMap.has(e.name)&&t.warn&&console.warn("resourceManager has already exist this hanlder, that will be cover",e.name),this.handlerMap.set(e.name,e),this}mappingResource(e,t){const s=this.configMap,r=this.resourceMap,i={};return e.forEach((o,c)=>{if(t&&t.hanlder&&t.hanlder[c]){const u=this.handlerMap.get(t.hanlder[c]);if(!u)console.warn(`resource manager can not support this handler: ${t.hanlder[c]}`);else{const d=u(c,o,this.paserMap);d?(d.parse({url:c,resource:o,configMap:s,resourceMap:r}),i[c]=this.getResourceConfig(c)):console.warn("resource manager hanlder can not found this resource parser: ",o,u)}}else{let u=null;for(const d of this.handlerMap.values())if(u=d(c,o,this.paserMap),u)break;u?(u.parse({url:c,resource:o,configMap:s,resourceMap:r}),i[c]=this.getResourceConfig(c)):console.warn("resouce manager can not found some handler to parser this resource:",o)}}),this.dispatchEvent({type:"mapped",structureMap:this.structureMap,configMap:s,resourceMap:r,resourceConfig:i}),this}getResourceConfig(e){const t=this.configMap,s={};return[...t.keys()].filter(r=>r.startsWith(e)).some(r=>{const i=t.get(r);if(!i)console.error(`unknow error: can not found config by url: ${r}`);else{const o=ke(i.type);o?(!s[o]&&(s[o]={}),s[o][i.vid]=i):console.error(`unknow error: can not found module by type: ${i.type}`,i)}}),s}hasResource(e){return this.resourceMap.has(e)}remove(e){const t=this.configMap,s=this.resourceMap;return[...t.keys()].filter(r=>r.startsWith(e)).forEach(r=>{t.delete(r);const i=s.get(r);i.dispose&&i.dispose(),s.delete(r)}),this}dispose(){this.resourceMap.forEach((e,t)=>{e.dispose&&e.dispose()}),this.resourceMap.clear(),this.configMap.clear()}}const Yi=function(n){if(this.resourceManager)return console.warn("engine has installed resourceManager plugin."),!1;const e=new Fn(n.resources);return this.resourceManager=e,this.loaderManager&&this.loaderManager.addEventListener("loaded",t=>{this.resourceManager.mappingResource(t.resourceMap)}),this.registerResources=t=>{const s=new Map;return Object.keys(t).forEach(r=>{s.set(r,t[r])}),this.resourceManager.mappingResource(s),this},this.addEventListener("dispose",()=>{this.resourceManager.dispose()}),!0},nt=(n,e)=>e===1/0?"Infinity":e===-1/0?"-Infinity":e,wn=(n,e)=>e==="Infinity"?1/0:e==="-Infinity"?-1/0:e,ht=n=>JSON.parse(JSON.stringify(n,nt),wn);var ji=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",stringify:nt,parse:wn,clone:ht});const $=class extends re{constructor(e){super();h(this,"ignoreAttribute");this.ignoreAttribute=e||{}}static proxyGetter(e,t,s){return Reflect.get(e,t,s)}static proxySetter(e,t,s,r,i,o){if(typeof t=="symbol")return Reflect.set(e,t,s,r);$.cacheArray(s);let c;if(e[t]===void 0){if(typeof s=="object"&&s!==null&&!$.proxyWeakSet.has(s)&&!i.ignoreAttribute[t]){const u=o.concat([t]);s=i.proxyExtends(s,u)}c=Reflect.set(e,t,s),i.broadcast({operate:"add",path:o.concat([]),key:t,value:s})}else{if(typeof s=="object"&&s!==null&&!$.proxyWeakSet.has(s)&&!i.ignoreAttribute[t]){const u=o.concat([t]);s=i.proxyExtends(s,u)}if(c=Reflect.set(e,t,s),Array.isArray(e)&&t==="length"){const u=e[Symbol.for($.arraySymobl)],d=u.length-e.length;if(d>0){let p=0,f=0;for(const m of u){if(!e.includes(m)&&(i.broadcast({operate:"delete",path:o.concat([]),key:f.toString(),value:m}),p+=1,p===d))break;f+=1}}return e[Symbol.for(this.arraySymobl)]=e.concat([]),c}i.broadcast({operate:"set",path:o.concat([]),key:t,value:s})}return c}static proxyDeleter(e,t,s,r){const i=e[t],o=Reflect.deleteProperty(e,t);return Array.isArray(e)||typeof t=="symbol"||s.broadcast({operate:"delete",path:r.concat([]),key:t,value:i}),o}proxyExtends(e,t=[]){if($.proxyWeakSet.has(e)||typeof e!="object")return e;const s={get:$.proxyGetter,set:(i,o,c,u)=>$.proxySetter(i,o,c,u,this,t),deleteProperty:(i,o)=>$.proxyDeleter(i,o,this,t)};if(typeof e=="object"&&e!==null)for(const i in e){const o=t.concat([i]);let c=this.ignoreAttribute,u=!1;for(const d of o.slice(1)){if(c[d]===!0){u=!0;break}c[d]&&(c=c[d])}u||Pn(i,e)&&typeof e[i]=="object"&&e[i]!==null&&($.cacheArray(e[i]),e[i]=this.proxyExtends(e[i],o))}const r=new Proxy(e,s);return $.proxyWeakSet.add(r),r}broadcast({operate:e,path:t,key:s,value:r}){return{__poto__:!0,length:!0}[s]?this:(this.dispatchEvent({type:"broadcast",notice:{operate:e,path:t,key:s,value:r}}),this)}};let _e=$;h(_e,"proxyWeakSet",new WeakSet),h(_e,"arraySymobl","vis.array"),h(_e,"cacheArray",function(e){Array.isArray(e)&&!e[Symbol.for($.arraySymobl)]&&(e[Symbol.for($.arraySymobl)]=e.concat([]))});class Nn{constructor(){h(this,"rule");h(this,"memberSet");this.rule=function(){},this.memberSet=new Set}apply(e){return this.memberSet.add(e),this}cancel(e){return this.memberSet.delete(e),this}setRule(e){return this.rule=e,this}translate(e){const t=this.rule;return this.memberSet.forEach(s=>{t(e,s)}),this}}class ae{constructor(e,t,s){h(this,"data");h(this,"broadcast");h(this,"translater");this.translater=new Nn().setRule(e),this.broadcast=new _e(s),this.data=this.broadcast.proxyExtends(t),this.broadcast.addEventListener("broadcast",r=>{this.translater.translate(r.notice)})}getData(){return this.data}setData(e){return this.data=e,this}proxyData(e){return this.data=this.broadcast.proxyExtends(e),this.data}existSymbol(e){return Boolean(this.data[e])}addConfig(e){return this.data[e.vid]=e,this}getConfig(e){return this.data[e]}removeConfig(e){const t=this.data;t[e]!==void 0&&delete t[e]}addCompiler(e){return e.setTarget(this.data),e.compileAll(),this.translater.apply(e),this}toJSON(e=!0){return e?JSON.stringify(this.exportConfig(),nt):JSON.stringify(this.data,nt)}exportConfig(e=!0){if(e){const t=this.data,s={},r={},i=(o,c,u={})=>{for(const d in o){if(["vid","type"].includes(d)){u[d]=o[d];continue}if(typeof o[d]=="object"&&o[d]!==null){if(Array.isArray(o[d])){if(!o[d].length)continue;u[d]=o[d].map(p=>typeof p=="object"&&p!==null?ht(p):p);continue}u[d]={},c[d]?(i(o[d],c[d],u[d]),Object.keys(u[d]).length===0&&delete u[d]):u[d]=ht(o[d])}else c[d]!==o[d]&&(u[d]=o[d])}};for(const o of Object.values(t)){if(!r[o.type]){if(!j[o.type]){console.error(`can not font some config with: ${o.type}`);continue}r[o.type]=j[o.type]()}s[o.vid]={},i(o,r[o.type],s[o.vid])}return s}else return ht(this.data)}load(e){const t=this.data,s={},r=(i,o)=>{for(const c in o)typeof i[c]=="object"&&i[c]!==null&&typeof o[c]=="object"&&o[c]!==null?r(i[c],o[c]):i[c]===void 0&&(i[c]=o[c])};for(const i in e){const o=e[i];if(!s[o.type]){if(!j[o.type]){console.error(`can not font some config with: ${o.type}`);continue}s[o.type]=j[o.type]()}r(o,s[o.type]),t[i]=o}return this}remove(e){const t=this.data;for(const s in e)t[s]!==void 0&&delete t[s];return this}getModule(){return this.MODULE}}const ge=(n,e,t=se.validate)=>{const{operate:s,key:r,path:i,value:o}=n;let c=r;const u=[].concat(i);if(i.length&&(c=u.shift()),!t(c)){console.warn(`${e.MODULE} Rule: vid is illeage: ${c}`);return}if(s==="add"&&!u.length){e.add(o);return}if(n.operate==="delete"&&!u.length){e.remove(o);return}if(n.operate==="set"&&!u.length&&r===c){e.cover(o);return}e.compile(c,{operate:s,key:r,path:u,value:o})},Ji=function(n,e){ge(n,e)};class vn extends ae{constructor(e,t){!e&&(e={});super(Ji,e,t);h(this,"MODULE",a.MODULETYPE.TEXTURE)}}const ki=function(n,e){ge(n,e)};class Un extends ae{constructor(e,t){!e&&(e={});super(ki,e,t);h(this,"MODULE",a.MODULETYPE.MATERIAL)}}class Ke extends ae{constructor(e,t,s){!t&&(t=Object.create(Object.prototype));super(e,t,s);h(this,"MODULE",a.MODULETYPE.GROUP)}}const Ae=function(n,e){n.key!=="parent"&&ge(n,e)},_i=function(n,e){Ae(n,e)};class Hn extends Ke{constructor(e,t){!e&&(e={});super(_i,e,t);h(this,"MODULE",a.MODULETYPE.LIGHT)}}const Ki=function(n,e){ge(n,e)};class xn extends ae{constructor(e,t){!e&&(e={});super(Ki,e,t);h(this,"MODULE",a.MODULETYPE.GEOMETRY)}}const Wi=function(n,e){Ae(n,e)};class Yn extends Ke{constructor(e,t){!e&&(e={});super(Wi,e,t);h(this,"MODULE",a.MODULETYPE.CAMERA)}}const Qi=function(n,e){ge(n,e,t=>se.validate(t)||[a.CONFIGTYPE.WEBGLRENDERER,a.CONFIGTYPE.CSS3DRENDERER].includes(t))};class jn extends ae{constructor(e,t){!e&&(e={});super(Qi,e,t);h(this,"MODULE",a.MODULETYPE.RENDERER)}}const Vi=function(n,e){ge(n,e,t=>se.validate(t)||[a.CONFIGTYPE.SCENE].includes(t))};class Jn extends Ke{constructor(e,t){!e&&(e={});super(Vi,e,t);h(this,"MODULE",a.MODULETYPE.SCENE)}}const Xi=function(n,e){ge(n,e,t=>se.validate(t)||[a.CONFIGTYPE.TRNASFORMCONTROLS,a.CONFIGTYPE.ORBITCONTROLS].includes(t))};class kn extends ae{constructor(e,t){!e&&(e={});super(Xi,e,t);h(this,"MODULE",a.MODULETYPE.CONTROLS)}}class pt extends ae{constructor(e,t,s){!t&&(t=Object.create(Object.prototype));super(e,t,s);h(this,"MODULE",a.MODULETYPE.MESH)}}const zi=function(n,e){n.key!=="geometry"&&Ae(n,e)};class _n extends pt{constructor(e,t){!e&&(e={});super(zi,e,t);h(this,"MODULE",a.MODULETYPE.SPRITE)}}const Zi=function(n,e){Ae(n,e)};class Kn extends pt{constructor(e,t){!e&&(e={});super(Zi,e,t);h(this,"MODULE",a.MODULETYPE.LINE)}}const $i=function(n,e){Ae(n,e)};class Wn extends pt{constructor(e,t){!e&&(e={});super($i,e,t);h(this,"MODULE",a.MODULETYPE.MESH)}}const qi=function(n,e){Ae(n,e)};class Qn extends pt{constructor(e,t){!e&&(e={});super(qi,e,t);h(this,"MODULE",a.MODULETYPE.POINTS)}}const eo=function(n,e){Ae(n,e)};class Vn extends Ke{constructor(e,t){!e&&(e={});super(eo,e,t);h(this,"MODULE",a.MODULETYPE.GROUP)}}const to=function(n,e){ge(n,e)};class Xn extends ae{constructor(e,t){!e&&(e={});super(to,e,t);h(this,"MODULE",a.MODULETYPE.PASS)}}const no=function(n,e){n.key==="name"&&n.path.length===1||ge(n,e)};class zn extends ae{constructor(e,t){!e&&(e={});super(no,e,t);h(this,"MODULE",a.MODULETYPE.ANIMATION)}}const so=function(n,e){Ae(n,e)};class Zn extends Ke{constructor(e,t){!e&&(e={});super(so,e,t);h(this,"MODULE",a.MODULETYPE.CSS3D)}}const ro=function(n,e){Ae(n,e)};class io extends Ke{constructor(e,t){!e&&(e={});super(ro,e,t);h(this,"MODULE",a.MODULETYPE.OBJECT3D)}}class $n{constructor(e){h(this,"object3DDataSupport",new io);h(this,"cameraDataSupport",new Yn);h(this,"lightDataSupport",new Hn);h(this,"geometryDataSupport",new xn);h(this,"textureDataSupport",new vn);h(this,"materialDataSupport",new Un);h(this,"rendererDataSupport",new jn);h(this,"sceneDataSupport",new Jn);h(this,"controlsDataSupport",new kn);h(this,"spriteDataSupport",new _n);h(this,"lineDataSupport",new Kn);h(this,"meshDataSupport",new Wn);h(this,"pointsDataSupport",new Qn);h(this,"groupDataSupport",new Vn);h(this,"css3DDataSupport",new Zn);h(this,"passDataSupport",new Xn);h(this,"animationDataSupport",new zn);h(this,"dataSupportMap");e&&Object.keys(e).forEach(s=>{this[s]!==void 0&&(this[s]=e[s])});const t=new Map;Object.keys(this).forEach(s=>{const r=this[s];r instanceof ae&&t.set(r.MODULE,r)}),this.dataSupportMap=t}getDataSupport(e){return this.dataSupportMap.has(e)?this.dataSupportMap.get(e):(console.warn(`can not found this type in dataSupportManager: ${e}`),null)}getSupportData(e){return this.dataSupportMap.has(e)?this.dataSupportMap.get(e).getData():(console.warn(`can not found this type in dataSupportManager: ${e}`),null)}setSupportData(e,t){return this.dataSupportMap.has(e)?this.dataSupportMap.get(e).setData(t):console.warn(`can not found this type in dataSupportManager: ${e}`),this}getConfigBySymbol(e){const t=this.dataSupportMap.values();for(const s of t){const r=s.getConfig(e);if(r)return r}return null}removeConfigBySymbol(...e){const t=this.dataSupportMap.values();for(const s of e)for(const r of t)if(r.existSymbol(s)){r.removeConfig(s);break}return this}getModuleBySymbol(e){const t=this.dataSupportMap.values();for(const s of t)if(s.existSymbol(e))return s.MODULE;return null}applyConfig(...e){for(const t of e){const s=ke(t.type);s?this.dataSupportMap.get(s).addConfig(t):console.warn(`dataSupportManager can not found this config module: ${t.type}`)}return this}reactiveConfig(e){const t=ke(e.type);return t?this.dataSupportMap.get(t).addConfig(e).getConfig(e.vid):(console.warn(`dataSupportManager can not found this config module: ${e.type}`),e)}load(e){return this.dataSupportMap.forEach((s,r)=>{e[r]&&s.load(e[r])}),this}remove(e){return this.dataSupportMap.forEach((s,r)=>{e[r]&&s.remove(e[r])}),this}toJSON(e={},t=!0){return JSON.stringify(this.exportConfig(e,t),nt)}exportConfig(e={},t=!0){return this.dataSupportMap.forEach((r,i)=>{e[i]=r.exportConfig(t)}),e}}const oo={name:"uvPulseShader",uniforms:{time:{value:0},width:{value:.5},color:{value:{r:1,g:0,b:0}},center:{value:{x:.5,y:.5}}},vertexShader:`
    varying vec2 vUv;

    void main () {

      vUv = uv;

      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }`,fragmentShader:`
    uniform float width;
    uniform float time;
    uniform vec3 color;
    uniform vec2 center;

    varying vec2 vUv;

    void main () {
      // \u6839\u636EuTime\u6C42\u51FA\u767E\u5206\u6BD4
      float deg = mod(degrees(time), 360.0);
      if (deg > 0.0 && deg < 180.0) {
        discard;
      }

      float percent = cos(time);
      float distancePercent = distance(center, vUv);

      // \u4ECE\u5916\u5411\u91CC
      if (distancePercent > 0.5) {
        discard;
      }

      if (distancePercent < percent) {
        discard;
      }

      if (distancePercent - percent > width) {
        discard;
      }

      float opacity =  (width - (distancePercent - percent)) / width;

      // float opacity = distancePercent;
      gl_FragColor = vec4(color, opacity);
    }`},ao={name:"fragCoordTestingShader",uniforms:{resolution:{value:{x:1920,y:1080}}},vertexShader:`
  void main () {
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }`,fragmentShader:`
    uniform vec2 resolution;

    void main () {
      vec2 st = gl_FragCoord.xy / resolution;
      gl_FragColor = vec4(st.x,st.y,0.0,1.0);
    }`},co={name:"colorMixShader",uniforms:{colorA:{value:{r:1,g:0,b:0}},colorB:{value:{r:0,g:1,b:0}},percent:{value:.5}},vertexShader:`
  void main () {
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }`,fragmentShader:`
    uniform vec3 colorA;
    uniform vec3 colorB;
    uniform float percent;

    void main () {
      gl_FragColor = vec4(mix(colorA, colorB, percent), 1.0);
    }`},lo={name:"BloomShader",uniforms:{brightness:{value:.5},extend:{value:5},range:{value:10},specular:{value:.8},specularRange:{value:2},color:{value:{r:1,g:1,b:1}}},vertexShader:`
  uniform float extend;

  varying vec2 vUv;

  void main () {

    vUv = uv;

    vec3 extendPosition = position + normalize(position) * extend;

    gl_Position = projectionMatrix * modelViewMatrix * vec4(extendPosition , 1.0 );
  }`,fragmentShader:`
    uniform vec3 color;
    uniform float brightness;
    uniform float specular;
    uniform float range;
    uniform float specularRange;

    varying vec2 vUv;
    
    void main () {

      gl_FragColor = vec4(color, brightness);
    }`},Me=class{static getShader(e){return Me.library.has(e)?Me.cloneShader(Me.library.get(e)):(console.warn(`con not found shader in shader library: ${e}`),null)}static generateConfig(e){if(!Me.library.has(e))return console.warn(`con not found shader in shader library: ${e}`),{};const t=Me.library.get(e),s={shader:e,uniforms:{}};return t.uniforms&&(s.uniforms=JSON.parse(JSON.stringify(t.uniforms))),s}static cloneShader(e){const t={name:e.name};return e.vertexShader&&(t.vertexShader=e.vertexShader),e.fragmentShader&&(t.fragmentShader=e.fragmentShader),e.uniforms&&(t.uniforms=JSON.parse(JSON.stringify(e.uniforms))),t}};let ee=Me;h(ee,"library",new Map),h(ee,"reigster",function(e){Me.library.has(e.name)&&console.warn(`shader library has exist shader: ${e.name} that will be cover.`),Me.library.set(e.name,e)});const uo={name:"defaultShader"};ee.reigster(uo),ee.reigster(oo),ee.reigster(ao),ee.reigster(co),ee.reigster(lo);const X=function(n,e,t=!0,s=!0){if(!j[n])return console.error(`type: ${n} can not be found in configList.`),{vid:"",type:n};const r=(o,c)=>{for(const u in c){if(o[u]===void 0){!t&&(o[u]=c[u]),t&&s&&console.warn(`'${n}' config can not set key: ${u}`);continue}typeof c[u]=="object"&&c[u]!==null&&!Array.isArray(c[u])?(o[u]===null&&(o[u]=Y({},c[u])),r(o[u],c[u])):o[u]=c[u]}},i=j[n]();if([a.CONFIGTYPE.SHADERMATERIAL].includes(n)){const o=ee.generateConfig((e==null?void 0:e.shader)||"defaultShader"),c=t;t=!1,r(i,o),t=c}if([a.CONFIGTYPE.SCRIPTANIMATION,a.CONFIGTYPE.KEYFRAMEANIMATION].includes(n)&&(t=!1),i.vid===""&&(i.vid=se.v4()),e&&r(i,e),X.autoInject&&X.injectEngine){const o=X.injectEngine,c=o.reactiveConfig(i);if(X.injectScene&&ke(i.type)in a.OBJECTMODULE&&i.type!==a.CONFIGTYPE.SCENE){let u=null;typeof X.injectScene=="boolean"?u=o.getObjectConfig(o.scene):typeof X.injectScene=="string"&&(u=o.getConfigBySymbol(X.injectScene)),u?u.children.push(i.vid):console.warn("current engine scene can not found it config",o,o.scene)}return c}return i};X.autoInject=!0,X.injectScene=!1,X.injectEngine=null;const ho=function(n){if(this.dataSupportManager)return console.warn("engine has installed dataSupportManager plugin."),!1;const e=new $n(n);return this.dataSupportManager=e,this.applyConfig=function(...t){return this.dataSupportManager.applyConfig(...t),this},this.reactiveConfig=function(t){return this.dataSupportManager.reactiveConfig(t)},this.getConfigBySymbol=function(t){return this.dataSupportManager.getConfigBySymbol(t)},this.removeConfigBySymbol=function(...t){return this.dataSupportManager.removeConfigBySymbol(...t),this},this.toJSON=function(){if(this.loaderManager){const t={assets:JSON.parse(this.loaderManager.toJSON())};return this.dataSupportManager.toJSON(t)}return this.dataSupportManager.toJSON()},this.exportConfig=function(){let t={};return this.loaderManager&&(t={assets:this.loaderManager.exportConfig()}),this.dataSupportManager.exportConfig(t)},this.completeSet.add(()=>{const t=this.dataSupportManager.getDataSupport(a.MODULETYPE.RENDERER).getData();t.WebGLRenderer||(t.WebGLRenderer=X(a.CONFIGTYPE.WEBGLRENDERER));const s=this.dataSupportManager.getDataSupport(a.MODULETYPE.CONTROLS).getData();this.transformControls&&(s[a.CONFIGTYPE.TRNASFORMCONTROLS]||(s[a.CONFIGTYPE.TRNASFORMCONTROLS]=X(a.CONFIGTYPE.TRNASFORMCONTROLS))),this.orbitControls&&(s[a.CONFIGTYPE.ORBITCONTROLS]||(s[a.CONFIGTYPE.ORBITCONTROLS]=X(a.CONFIGTYPE.ORBITCONTROLS)))}),!0},ie=class{constructor(){h(this,"target",{});h(this,"map",new Map);h(this,"weakMap",new WeakMap);h(this,"engine");h(this,"cacheCompile")}getMap(){return this.map}useEngine(e){return this.engine=e,this}setTarget(e){return this.target=e,this}add(e){if(!ie.processors.has(e.type))return console.warn(`${this.MODULE} compiler can not support this type: ${e.type}`),null;const s=ie.processors.get(e.type).create(e,this.engine);return this.map.set(e.vid,s),this.weakMap.set(s,e.vid),s}remove(e){const t=e.vid;if(!this.map.has(t))return console.warn(`${this.MODULE} compiler can not found this vid object: ${t}.`),this;if(!ie.processors.has(e.type))return console.warn(`${this.MODULE} compiler can not support this type: ${e.type}`),this;const s=this.map.get(t);return ie.processors.get(e.type).dispose(s),this.map.delete(t),this.weakMap.delete(s),this}cover(e){const t=e.vid;return this.map.has(t)?(Promise.resolve().then(()=>{k(e,e,{vid:!0,type:!0})}),this):(console.warn(`${this.MODULE} compiler can not found this vid object: ${t}.`),this)}compile(e,t){const s=this.cacheCompile;let r,i,o;if(s&&s.vid===e)r=s.target,i=s.config,o=s.processor;else{if(!this.map.has(e))return console.warn(`${this.MODULE} compiler set function: can not found object which vid is: '${e}'`),this;if(!this.target[e])return console.warn(`${this.MODULE} compiler set function: can not found config which vid is: '${e}'`),this;if(r=this.map.get(e),i=this.target[e],!ie.processors.has(i.type))return console.warn(`PassCompiler can not support this type: ${i.type}`),this;o=ie.processors.get(i.type),this.cacheCompile={target:r,config:i,processor:o,vid:e}}return o.process(Y({config:i,target:r,engine:this.engine,processor:o,compiler:this},t)),this}compileAll(){const e=this.target;for(const t of Object.values(e))this.add(t);return this}dispose(){this.cacheCompile&&(this.cacheCompile=void 0);for(const e of Object.values(this.target)){if(!this.map.has(e.vid)){console.warn(`${this.MODULE} compiler set function: can not found object which vid is: '${e.vid}'`);continue}const t=this.map.get(e.vid);if(!ie.processors.has(e.type)){console.warn(`${this.MODULE}  can not support this type: ${e.type}`);continue}ie.processors.get(e.type).dispose(t)}return this.map.clear(),this.target={},this}getObjectSymbol(e){return this.weakMap.get(e)||null}getObjectBySymbol(e){return this.map.get(e)||null}};let O=ie;h(O,"processors",new Map),h(O,"processor",function(e){ie.processors.set(e.configType,e)});const We="vis.scriptAni";class po{constructor(e){h(this,"configType");h(this,"commands");h(this,"create");h(this,"dispose");this.configType=e.configType,this.commands=e.commands,this.create=e.create,this.dispose=e.dispose}process(e){if(!this.commands||!this.commands[e.operate]){this[e.operate](e);return}let t=this.commands[e.operate];for(const s of[].concat(e.path,e.key))if(!t[s]&&!t.$reg){this[e.operate](e);return}else if(t[s])if(typeof t[s]=="function"){t[s](e);return}else t=t[s];else if(t.$reg){for(const r of t.$reg)if(r.reg.test(s)){r.handler(e);return}}this[e.operate](e)}add(e){let t=e.target;const s=e.path;for(const r of s)if(typeof t[r]!==void 0)t=t[r];else{console.warn("processor can not exec default add operate.",e);return}t[e.key]=e.value}set(e){let t=e.target;const s=e.path;for(const r of s)if(typeof t[r]!==void 0)t=t[r];else{console.warn("processor can not exec default set operate.",e);return}t[e.key]=e.value}delete(e){let t=e.target;const s=e.path;for(const r of s)if(typeof t[r]!==void 0)t=t[r];else{console.warn("processor can not exec default delete operate.",e);return}delete t[e.key]}}const L=n=>new po(n),ft=function(){},fo={name:"linearTime",multiply:1},mo=function(n,e,t,s){return e[t]===void 0?(console.warn(`object not exist attribute: ${t}`,e),r=>{}):typeof e[t]!="number"?(console.warn("object attribute is not typeof number.",e,t),r=>{}):r=>{e[t]+=r.delta*s.multiply}},Eo={name:"sinWave",wavelength:1,offset:0,amplitude:1,speed:1},go=function(n,e,t,s){if(e[t]===void 0)return console.warn(`object not exist attribute: ${t}`,e),i=>{};if(typeof e[t]!="number")return console.warn("object attribute is not typeof number.",e,t),i=>{};const r=e[t];return i=>{e[t]=r+s.amplitude*Math.sin(i.total*s.speed/s.wavelength)+s.offset}},le=class{static generateConfig(e,t){if(!le.configLibrary.has(e))return console.warn(`event library can not found config by name: ${e}`),{name:""};const s=(i,o)=>{for(const c in o)i[c]!==void 0&&(typeof o[c]=="object"&&o[c]!==null&&!Array.isArray(o[c])?s(i[c],o[c]):i[c]=o[c])},r=JSON.parse(JSON.stringify(le.configLibrary.get(e)));return s(r,t),r}static generateScript(e,t,s,r){return le.generatorLibrary.has(r.name)?le.generatorLibrary.get(r.name)(e,t,s,r):(console.error(`event library can not found generator by name: ${r.name}`),()=>{})}static has(e){return le.configLibrary.has(e)}};let Se=le;h(Se,"configLibrary",new Map),h(Se,"generatorLibrary",new Map),h(Se,"register",function(e,t){le.configLibrary.has(e.name)&&console.warn(`EventLibrary has already exist this event generator: ${e.name}, that will be cover.`),le.configLibrary.set(e.name,JSON.parse(JSON.stringify(e))),le.generatorLibrary.set(e.name,t)}),Se.register(fo,mo),Se.register(Eo,go);const qn=function(n,e){let t=e.compilerManager.getObjectBySymbol(n.target);t||console.error(`can not found object in enigne: ${n.target}`);const s=n.attribute.split(".");s.shift();const r=s.pop();for(const i of s){if(t[i]===void 0)return console.error(`animaton processor: target object can not found key: ${i}`,t),()=>{};t=t[i]}return Se.generateScript(e,t,r,n.script)};var Ao=L({configType:a.CONFIGTYPE.SCRIPTANIMATION,commands:{set:{play({target:n,engine:e,value:t}){t?e.renderManager.addEventListener("render",n):e.renderManager.removeEventListener("render",n)},$reg:[{reg:new RegExp(".*"),handler({config:n,engine:e}){const t=n[Symbol.for(We)];e.renderManager.removeEventListener("render",t);const s=qn(n,e);n[Symbol.for(We)]=s,n.play&&e.renderManager.addEventListener("render",t)}}]}},create(n,e){const t=qn(n,e);return n.play&&e.renderManager.addEventListener("render",t),n[Symbol.for(We)]=t,t},dispose(){}});class Co extends O{constructor(){super();h(this,"MODULE",a.MODULETYPE.ANIMATION)}cover(e){super.cover(e);const t=this.map.get(e.vid);return e[Symbol.for(We)]=t,this}remove(e){return delete e[Symbol.for(We)],super.remove(e),this}compile(e,t){super.compile(e,t);const s=this.target[e],r=this.map.get(s.vid);return s[Symbol.for(We)]=r,this}}O.processor(Ao);class Re extends O{constructor(){super()}}const Mo={name:"openWindow",params:{url:""}},To=function(n,e){return()=>{window.open(e.params.url)}},Bo={name:"visibleObject",params:{target:"",visible:!0,delay:0}},yo=function(n,e){const t=e.params,s=n.getObjectBySymbol(t.target);return s?()=>{setTimeout(()=>{s.visible=t.visible},t.delay)}:(console.warn(`basic event visibleObject: can not found vid object: ${t.target}`),()=>{})},So={name:"addClass",params:{target:"",className:"",delay:0}},Ro=function(n,e){const t=e.params,s=[];if(t.target==="all")n.scene.traverse(r=>{r instanceof we.CSS3DObject&&s.push(r)});else if(Array.isArray(t.target))t.target.forEach(r=>{const i=n.getObjectBySymbol(r);i?s.push(i):console.warn(`basic event AddClass: can not found vid object: ${t.target}`)});else{const r=n.getObjectBySymbol(t.target);if(!r)return console.warn(`basic event AddClass: can not found vid object: ${t.target}`),()=>{};if(!(r instanceof we.CSS3DObject))return console.warn("basic event AddClass: object is not a CSS3DObject."),()=>{};s.push(r)}return s.length?()=>{setTimeout(()=>{s.forEach(r=>{r.element.classList.add(t.className)})},t.delay)}:(console.warn(`basic event AddClass: can not found vid object: ${t.target}`),()=>{})},Oo={name:"changeScene",params:{scene:"Scene",delay:0}},Go=function(n,e){const t=e.params;return()=>{setTimeout(()=>{n.setScene(t.scene)},t.delay)}},bo={name:"changeCamera",params:{camera:"",delay:0}},Io=function(n,e){const t=e.params;return()=>{setTimeout(()=>{n.setCamera(t.camera)},t.delay)}},Lo={name:"switchAnimate",params:{target:"",toggle:"auto",delay:0}},Po=function(n,e){const t=e.params,s=n.getConfigBySymbol(t.target);return s?()=>{setTimeout(()=>{if(t.toggle==="auto"){s.play!=s.play;return}if(t.toggle==="off"){s.play=!1;return}if(t.toggle==="on"){s.play=!0;return}},t.delay)}:(console.warn(`basic event switchAnimate: can not found vid config: ${t.target}`),()=>{})};a.TIMINGFUNCTION=void 0,function(n){n.ELN="ELN",n.EQI="EQI",n.EQO="EQO",n.EASING_LINEAR_NONE="EASING_LINEAR_NONE",n.EASING_QUARTIC_IN="EASING_QUARTIC_IN",n.EASING_QUARTIC_OUT="EASING_QUARTIC_OUT",n.EASING_QUARTIC_INOUT="EASING_QUARTIC_INOUT",n.EASING_QUADRATIC_IN="EASING_QUADRATIC_IN",n.EASING_QUADRATIC_OUT="EASING_QUADRATIC_OUT",n.EASING_QUADRATIC_INOUT="EASING_QUADRATIC_INOUT"}(a.TIMINGFUNCTION||(a.TIMINGFUNCTION={}));const H={ELN:w.Easing.Linear.None,EQI:w.Easing.Quartic.In,EQO:w.Easing.Quartic.Out,EASING_LINEAR_NONE:w.Easing.Linear.None,EASING_QUARTIC_IN:w.Easing.Quartic.In,EASING_QUARTIC_OUT:w.Easing.Quartic.Out,EASING_QUARTIC_INOUT:w.Easing.Quartic.InOut,EASING_QUADRATIC_IN:w.Easing.Quadratic.In,EASING_QUADRATIC_OUT:w.Easing.Quadratic.Out,EASING_QUADRATIC_INOUT:w.Easing.Quadratic.InOut},Do={name:"moveTo",params:{target:"",position:{x:0,y:0,z:0},delay:0,duration:1e3,timingFunction:a.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},Fo=function(n,e){const t=e.params,r=n.compilerManager.getObjectBySymbol(t.target);if(!r)return console.warn(`real time animation moveTO: can not found vid object: ${t.target}`),()=>{};const i=n.renderManager,o=n.dataSupportManager.getConfigBySymbol(t.target);if(!o)return console.warn(`can not found object config: ${t.target}`),()=>{};let c=!1;return()=>{if(c)return;c=!0;const u=new w.Tween(r.position).to(t.position).duration(t.duration).delay(t.delay).easing(H[t.timingFunction]).start(),d=p=>{u.update()};i.addEventListener("render",d),u.onComplete(()=>{i.removeEventListener("render",d),o.position.x=t.position.x,o.position.y=t.position.y,o.position.z=t.position.z,c=!1})}},wo={name:"rotationTo",params:{target:"",rotation:{x:0,y:0,z:0},delay:0,duration:1e3,timingFunction:a.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},No=function(n,e){const t=e.params,r=n.compilerManager.getObjectBySymbol(t.target);if(!r)return console.warn(`real time animation moveTO: can not found vid object: ${t.target}`),()=>{};const i=n.renderManager,o=n.dataSupportManager.getConfigBySymbol(t.target);if(!o)return console.warn(`can not found object config: ${t.target}`),()=>{};let c=!1;return()=>{if(c)return;c=!0;const u=new w.Tween(r.rotation).to(t.rotation).duration(t.duration).delay(t.delay).easing(H[t.timingFunction]).start(),d=p=>{u.update()};i.addEventListener("render",d),u.onComplete(()=>{i.removeEventListener("render",d),o.rotation.x=t.rotation.x,o.rotation.y=t.rotation.y,o.rotation.z=t.rotation.z,c=!1})}},vo={name:"upTo",params:{target:"",up:{x:0,y:1,z:0},delay:0,duration:1e3,timingFunction:a.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},Uo=function(n,e){const t=e.params,r=n.compilerManager.getObjectBySymbol(t.target);if(!r)return console.warn(`real time animation upTo: can not found vid object: ${t.target}`),()=>{};const i=n.renderManager,o=n.dataSupportManager.getConfigBySymbol(t.target);if(!o)return console.warn(`can not found object config: ${t.target}`),()=>{};let c=!1;return()=>{if(c)return;c=!0;const u=new w.Tween(r.up).to(t.up).duration(t.duration).delay(t.delay).easing(H[t.timingFunction]).start(),d=p=>{u.update()};i.addEventListener("render",d),u.onComplete(()=>{i.removeEventListener("render",d),o.up.x=t.up.x,o.up.y=t.up.y,o.up.z=t.up.z,c=!1})}},Ho={name:"moveFromTo",params:{target:"",from:{x:0,y:0,z:0},to:{x:10,y:10,z:10},delay:0,duration:1e3,timingFunction:a.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},xo=function(n,e){const t=e.params,r=n.compilerManager.getObjectBySymbol(t.target);if(!r)return console.warn(`real time animation moveTO: can not found vid object: ${t.target}`),()=>{};const i=n.renderManager,o=n.dataSupportManager.getConfigBySymbol(t.target);if(!o)return console.warn(`can not found object config: ${t.target}`),()=>{};let c=!1;return()=>{if(c)return;c=!0,r.position.set(t.from.x,t.from.y,t.from.z),r.updateMatrix(),r.updateMatrixWorld();const u=new w.Tween(r.position).to(t.to).duration(t.duration).delay(t.delay).easing(H[t.timingFunction]).start(),d=p=>{u.update()};i.addEventListener("render",d),u.onComplete(()=>{i.removeEventListener("render",d),o.position.x=t.to.x,o.position.y=t.to.y,o.position.z=t.to.z,c=!1})}},Yo={name:"moveSpacing",params:{target:"",spacing:{x:10,y:10,z:10},delay:0,duration:1e3,timingFunction:a.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},jo=function(n,e){const t=e.params,s=n.getObjectBySymbol(t.target);if(!s)return console.warn(`can not found vid object: ${t.target}`),()=>{};if(!(s instanceof l.Object3D))return console.warn(`object is not instanceof Object3D: ${t.target}`),()=>{};const r=n.renderManager,i=n.getConfigBySymbol(t.target);let o=!1;return()=>{if(o)return;o=!0;const c={x:s.position.x+t.spacing.x,y:s.position.y+t.spacing.y,z:s.position.z+t.spacing.z},u=new w.Tween(s.position).to(c).duration(t.duration).delay(t.delay).easing(H[t.timingFunction]).start(),d=p=>{u.update()};r.addEventListener("render",d),u.onComplete(()=>{r.removeEventListener("render",d),i.position.x=c.x,i.position.y=c.y,i.position.z=c.z,o=!1})}},Jo={name:"moveToObject",params:{target:"",to:"",offset:{x:0,y:0,z:0},delay:0,duration:1e3,timingFunction:a.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},ko=function(n,e){const t=e.params,s=n.compilerManager,r=s.getObjectBySymbol(t.target),i=s.getObjectBySymbol(t.to);if(!r)return console.warn(`real time animation MoveToObject: can not found vid object: ${t.target}`),()=>{};if(!i)return console.warn(`real time animation MoveToObject: can not found vid object: ${t.target}`),()=>{};const o=n.renderManager,c=n.dataSupportManager.getConfigBySymbol(t.target);if(!c)return console.warn(`can not found object config: ${t.target}`),()=>{};let u=!1;return()=>{if(u)return;u=!0;const d={x:i.position.x+t.offset.x,y:i.position.y+t.offset.y,z:i.position.z+t.offset.z},p=new w.Tween(r.position).to(d).duration(t.duration).delay(t.delay).easing(H[t.timingFunction]).start(),f=m=>{p.update()};o.addEventListener("render",f),p.onComplete(()=>{o.removeEventListener("render",f),c.position.x=d.x,c.position.y=d.y,c.position.z=d.z,u=!1})}},_o={name:"vector3To",params:{target:"",attribute:".position",props:{x:"x",y:"y",z:"z"},delay:0,duration:500,to:{},timingFunction:a.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},Ko=function(n,e){var f,m,E;const t=e.params,s=n.compilerManager.getObjectBySymbol(t.target);if(!s)return console.warn(`real time animation vector3To: can not found vid object: ${t.target}`),()=>{};const r=n.renderManager;let i=n.dataSupportManager.getConfigBySymbol(t.target);if(!i)return console.warn(`real time animation vector3To: can not found object config: ${t.target}`),()=>{};const o=t.attribute.split(".");o.shift();let c=s;for(const A of o){if(c[A]===void 0)return console.error(`real time animation vector3To: object can not support key: ${A}`,s),()=>{};c=c[A],i=i[A]}const u=t.props;if(!(u.x in c)||!(u.y in c)||!(u.z in c))return console.error("real time animation vector3To: object can not support props:",c,u),()=>{};if(!(u.x in i)||!(u.y in i)||!(u.z in i))return console.error("real time animation vector3To: config can not support props:",i,u),()=>{};const d={x:(f=t.to.x)!=null?f:c[u.x],y:(m=t.to.y)!=null?m:c[u.y],z:(E=t.to.z)!=null?E:c[u.z]};let p=!1;return()=>{if(p)return;p=!0;const A=new w.Tween(c).to(d).duration(t.duration).delay(t.delay).easing(H[t.timingFunction]).start(),M=T=>{A.update()};r.addEventListener("render",M),A.onComplete(()=>{r.removeEventListener("render",M),i[u.x]=d.x,i[u.y]=d.y,i[u.z]=d.z,p=!1})}},Wo={name:"focusObject",params:{target:"",camera:"",space:"world",offset:{x:0,y:0,z:20},delay:0,duration:1e3,timingFunction:a.TIMINGFUNCTION.EASING_QUADRATIC_INOUT,back:!0}},Qo=function(n,e){const t=e.params,s=n.getObjectBySymbol(t.target),r=n.orbitControls.target;if(!s)return console.warn(`real time animation focusObject: can not found vid object: ${t.target}`),()=>{};if(!(s instanceof l.Object3D))return console.warn(`real time animation focusObject: vid object is not a class of THREE.Object3D: ${t.target}`),()=>{};let i=!1;const o=new l.Euler;return()=>{if(i)return;i=!0;let c=n.camera;t.camera&&(c=n.getObjectBySymbol(t.camera),c||(c=n.camera,console.warn(`real time animation focusObject: can not found camera config: ${t.camera}`)));const u=n.getObjectConfig(c),d=n.orbitControls&&n.orbitControls.object===c;u||console.warn("engine current camera can not found config.");const p=n.renderManager;let f={x:s.matrixWorld.elements[12]+t.offset.x,y:s.matrixWorld.elements[13]+t.offset.y,z:s.matrixWorld.elements[14]+t.offset.z};const m={x:c.position.x,y:c.position.y,z:c.position.z};if(t.space==="local"){const y=new l.Vector3(t.offset.x,t.offset.y,t.offset.z).applyEuler(o.setFromRotationMatrix(s.matrixWorld));f={x:s.matrixWorld.elements[12]+y.x,y:s.matrixWorld.elements[13]+y.y,z:s.matrixWorld.elements[14]+y.z}}const E=new w.Tween(c.position).to(f).duration(t.duration).delay(t.delay).easing(H[t.timingFunction]).start();let A;const M={x:c.up.x,y:c.up.y,z:c.up.z};if(t.space==="local"){const y=new l.Vector3(0,1,0).applyEuler(o.setFromRotationMatrix(s.matrixWorld));A=new w.Tween(c.up).to({x:y.x,y:y.y,z:y.z}).duration(t.duration).delay(t.delay).easing(H[t.timingFunction]).start()}let T;const C={x:r.x,y:r.y,z:r.z};d&&(T=new w.Tween(r).to({x:s.matrixWorld.elements[12],y:s.matrixWorld.elements[13],z:s.matrixWorld.elements[14]}).duration(t.duration).delay(t.delay).easing(H[t.timingFunction]).start());let S;d&&t.space==="local"?S=y=>{E.update(),A.update(),T.update()}:d?S=y=>{E.update(),T.update()}:t.space==="local"?S=y=>{E.update(),A.update()}:S=y=>{E.update()},p.addEventListener("render",S),E.onComplete(()=>{if(p.removeEventListener("render",S),u&&(u.position.x=f.x,u.position.y=f.y,u.position.z=f.z),i=!1,t.back){const y=()=>{const R=new w.Tween(c.position).to(m).duration(t.duration).delay(t.delay).easing(H[t.timingFunction]).start();let P;t.space==="local"&&(P=new w.Tween(c.up).to(M).duration(t.duration).delay(t.delay).easing(H[t.timingFunction]).start());let B;d&&(B=new w.Tween(r).to(C).duration(t.duration).delay(t.delay).easing(H[t.timingFunction]).start());const F=I=>{R.update(),P&&P.update(),B&&B.update()};R.onComplete(()=>{p.removeEventListener("render",F)}),p.addEventListener("render",F),document.removeEventListener("dblclick",y)};document.addEventListener("dblclick",y)}})}},Vo={name:"fadeObject",params:{target:"",direction:"out",delay:0,duration:300,timingFunction:a.TIMINGFUNCTION.EASING_QUADRATIC_INOUT,visible:!0}},Xo=function(n,e){const t=e.params,s=n.getObjectBySymbol(t.target);if(!s)return console.warn(`real time animation fadeObject: can not found vid object: ${t.target}`),()=>{};const r=n.getObjectConfig(s);if(!r.material)return console.warn(`real time animation fadeObject: target can not support fade: ${t.target}`),()=>{};const i=[],o=[],c=Array.isArray(r.material)?[].concat(r.material):[r.material];for(const d of c){const p=n.getObjectBySymbol(d),f=n.getConfigBySymbol(d);if(!(p instanceof l.Material)){console.error(`real time animation fadeObject: object config material is not instanceof Material: ${d}`);continue}if(!f){console.error(`real time animation fadeObject: object config material can not found config: ${d}`);continue}i.push(p),o.push(f)}let u=!1;return()=>{if(u)return;u=!0;const d=n.renderManager;r.visible=!0,i.forEach((p,f,m)=>{p.visible=!0,p.transparent=!0,p.opacity=t.direction==="in"?0:1,p.needsUpdate=!0;const E=new w.Tween(p).to({opacity:t.direction==="in"?1:0}).duration(t.duration).delay(t.delay).easing(H[t.timingFunction]).start(),A=M=>{E.update()};d.addEventListener("render",A),E.onComplete(()=>{d.removeEventListener("render",A),t.direction==="out"&&t.visible?(o[f].visible=!1,r.visible=!1):t.direction==="in"&&t.visible&&(o[f].visible=!0,r.visible=!0),o[f].opacity=t.direction==="in"?1:0,u=!1})})}},zo={name:"showToCamera",params:{target:"",offset:{x:0,y:0,z:-30},delay:0,duration:1e3,timingFunction:a.TIMINGFUNCTION.EASING_QUADRATIC_INOUT,back:!0}},Zo=function(n,e){const t=e.params,s=n.getObjectBySymbol(t.target),r=n.getConfigBySymbol(t.target),i=n.camera;if(!s)return console.warn(`real time animation showToCamera: can not found vid object: ${t.target}`),()=>{};if(!s)return console.warn(`real time animation showToCamera: can not found vid config: ${t.target}`),()=>{};if(!(s instanceof l.Object3D))return console.warn(`real time animation showToCamera: vid object is not a class of THREE.Object3D: ${t.target}`),()=>{};const o=new l.Matrix4,c=new l.Euler,u=new l.Vector3;let d=!1;return()=>{if(d)return;d=!0;const p=n.renderManager;u.set(t.offset.x,t.offset.y,t.offset.z).applyEuler(i.rotation),u.set(i.position.x+u.x,i.position.y+u.y,i.position.z+u.z),o.lookAt(i.position,u,i.up),c.setFromRotationMatrix(o);const f={x:s.position.x,y:s.position.y,z:s.position.z},m={x:s.rotation.x,y:s.rotation.y,z:s.rotation.z},E=new w.Tween(s.position).to({x:u.x,y:u.y,z:u.z}).duration(t.duration).delay(t.delay).easing(H[t.timingFunction]).start(),A=new w.Tween(s.rotation).to({x:c.x,y:c.y,z:c.z}).duration(t.duration).delay(t.delay).easing(H[t.timingFunction]).start(),M=T=>{E.update(),A.update()};p.addEventListener("render",M),E.onComplete(()=>{if(p.removeEventListener("render",M),r.position.x=u.x,r.position.y=u.y,r.position.z=u.z,r.rotation.x=c.x,r.rotation.y=c.y,r.rotation.z=c.z,d=!1,t.back){const T=()=>{const C=new w.Tween(s.position).to(f).duration(t.duration).delay(t.delay).easing(H[t.timingFunction]).start(),S=new w.Tween(s.rotation).to(m).duration(t.duration).delay(t.delay).easing(H[t.timingFunction]).start(),y=R=>{C.update(),S.update()};C.onComplete(()=>{p.removeEventListener("render",y),r.position.x=f.x,r.position.y=f.y,r.position.z=f.z,r.rotation.x=m.x,r.rotation.y=m.y,r.rotation.z=m.z}),p.addEventListener("render",y),document.removeEventListener("dblclick",T)};document.addEventListener("dblclick",T)}})}},$o={name:"colorChange",params:{target:"",attribute:"color",color:"rgb(255, 255, 255)",delay:0,duration:500,timingFunction:a.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},qo=function(n,e){const t=e.params,s=n.getObjectBySymbol(t.target);if(!s)return console.warn(`real time animation ColorChange: can not found vid material: ${t.target}`),()=>{};if(!s[t.attribute]||!(s[t.attribute]instanceof l.Color))return console.warn(`real time animation ColorChange: material attribute is illeage: ${t.attribute}`),()=>{};const r=n.getConfigBySymbol(t.target);if(!r)return console.warn(`real time animation ColorChange: can not found material config: ${t.target}`),()=>{};const i=new l.Color(t.color),o=n.renderManager;let c=!1;return()=>{if(c)return;c=!0;const u=new w.Tween(s[t.attribute]).to({r:i.r,g:i.g,b:i.b}).duration(t.duration).delay(t.delay).easing(H[t.timingFunction]).start(),d=p=>{u.update()};o.addEventListener("render",d),u.onComplete(()=>{o.removeEventListener("render",d),r[t.attribute]=t.color,c=!1})}},ea={name:"orbitTargetMove",params:{target:"",offset:{x:0,y:0,z:0},delay:0,duration:1e3,timingFunction:a.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},ta=function(n,e){const t=e.params;if(n.compilerManager,!n.orbitControls)return console.warn("real time animation orbitTargetMove: engine can not install orbitControls."),()=>{};const s=n.renderManager;let r=!1;return()=>{if(r)return;r=!0;let i=t.offset;if(t.target){const u=n.getObjectBySymbol(t.target);u?i={x:u.matrixWorld.elements[12]+i.x,y:u.matrixWorld.elements[13]+i.y,z:u.matrixWorld.elements[14]+i.z}:console.warn(`real time animation orbitTargetMove: can not found vid object: ${t.target}`)}const o=new w.Tween(n.orbitControls.target).to(i).duration(t.duration).delay(t.delay).easing(H[t.timingFunction]).start(),c=u=>{o.update()};s.addEventListener("render",c),o.onComplete(()=>{s.removeEventListener("render",c),r=!1})}},ue=class{static generateConfig(e,t){if(!ue.configLibrary.has(e))return console.warn(`event library can not found config by name: ${e}`),{name:""};const s=(i,o)=>{for(const c in o)typeof o[c]=="object"&&o[c]!==null&&!Array.isArray(o[c])?s(i[c],o[c]):i[c]=o[c]},r=JSON.parse(JSON.stringify(ue.configLibrary.get(e)));return s(r,t),r}static generateEvent(e,t){return ue.generatorLibrary.has(e.name)?ue.generatorLibrary.get(e.name)(t,e):(console.error(`event library can not found generator by name: ${e.name}`),()=>{})}static has(e){return ue.configLibrary.has(e)}};let v=ue;h(v,"configLibrary",new Map),h(v,"generatorLibrary",new Map),h(v,"register",function(e,t){ue.configLibrary.has(e.name)&&console.warn(`EventLibrary has already exist this event generator: ${e.name}, that will be cover.`),ue.configLibrary.set(e.name,JSON.parse(JSON.stringify(e))),ue.generatorLibrary.set(e.name,t)}),v.register(Mo,To),v.register(Bo,yo),v.register(So,Ro),v.register(Oo,Go),v.register(bo,Io),v.register(Lo,Po),v.register(Do,Fo),v.register(wo,No),v.register(vo,Uo),v.register(Ho,xo),v.register(Yo,jo),v.register(Jo,ko),v.register(_o,Ko),v.register(Wo,Qo),v.register(Vo,Xo),v.register(zo,Zo),v.register($o,qo),v.register(ea,ta);const es=new WeakMap,ts=function({target:n,config:e,value:t,engine:s}){if(e.vid===t){console.warn("can not set object lookAt itself.");return}let r=es.get(n);if(r||(r={lookAtTarget:null,updateMatrixWorldFun:null},es.set(n,r)),!t){if(!r.updateMatrixWorldFun)return;n.updateMatrixWorld=r.updateMatrixWorldFun,r.lookAtTarget=null,r.updateMatrixWorldFun=null;return}const i=s.compilerManager.getObject3D(t);if(!i){console.warn(`lookAt handler can not found this vid mapping object: '${t}'`);return}const o=n.updateMatrixWorld;r.updateMatrixWorldFun=o,r.lookAtTarget=i.position,n.updateMatrixWorld=c=>{o.call(n,c),n.lookAt(r.lookAtTarget)}},st="vis.event",Ce=function({target:n,path:e,value:t,engine:s}){const r=e[0];if(!v.has(t.name)){console.warn(`EventLibrary: can not support this event: ${t.name}`);return}const i=v.generateEvent(t,s),o=Symbol.for(st);t[o]=i,n.addEventListener(r,i)},Oe=function({target:n,path:e,value:t}){const s=e[0],r=t[Symbol.for(st)];if(!r){console.warn("event remove can not fun found event in config",t);return}n.removeEventListener(s,r),delete t[Symbol.for(st)]},Ge=function({target:n,config:e,path:t,engine:s}){const r=t[0],i=e[t[0]][t[1]],o=i[Symbol.for(st)];if(!o){console.warn("event remove can not fun found event in config",i);return}n.removeEventListener(r,o);const c=v.generateEvent(i,s);i[Symbol.for(st)]=c,n.addEventListener(r,c)},kt=function({target:n,config:e,value:t,engine:s}){const r=s.getConfigBySymbol(t);if(!r){console.warn(` can not foud object config in engine: ${t}`);return}if(r.parent&&r.parent!==e.vid){const o=s.getConfigBySymbol(r.parent);if(!o){console.warn(` can not foud object parent config in engine: ${r.parent}`);return}o.children.splice(o.children.indexOf(t),1)}r.parent=e.vid;const i=s.compilerManager.getObject3D(t);if(!i){console.warn(`can not found this vid in engine: ${t}.`);return}n.add(i)},na=function({target:n,config:e,value:t,engine:s}){const r=s.compilerManager.getObject3D(t);if(!r){console.warn(`can not found this vid in engine: ${t}.`);return}n.remove(r);const i=s.getConfigBySymbol(t);if(!i){console.warn(`can not found this vid in engine: ${t}.`);return}i.parent=""},ce=function(n,e,t,s){return Promise.resolve().then(()=>{!t.lookAt&&ts({target:n,config:e,engine:s,value:e.lookAt}),e.children.forEach(i=>{kt({target:n,config:e,value:i,engine:s})});for(const i of Object.values(a.EVENTNAME))e[i].forEach((o,c)=>{Ce({target:n,path:[i,c.toString()],value:o,engine:s})})}),k(e,n,Y({vid:!0,type:!0,lookAt:!0,parent:!0,children:!0,pointerdown:!0,pointermove:!0,pointerup:!0,pointerenter:!0,pointerleave:!0,click:!0,dblclick:!0,contextmenu:!0},t)),n},q=function(n){n._listener={}},U={add:{pointerdown:Ce,pointerup:Ce,pointermove:Ce,pointerenter:Ce,pointerleave:Ce,click:Ce,dblclick:Ce,contextmenu:Ce,children:kt},set:{lookAt:ts,pointerdown:Ge,pointerup:Ge,pointermove:Ge,pointerenter:Ge,pointerleave:Ge,click:Ge,dblclick:Ge,contextmenu:Ge,parent:ft,children:{$reg:[{reg:new RegExp(".*"),handler:kt}]}},delete:{pointerdown:Oe,pointerup:Oe,pointermove:Oe,pointerenter:Oe,pointerleave:Oe,click:Oe,dblclick:Oe,contextmenu:Oe,children:na}};L({configType:a.CONFIGTYPE.OBJECT3D,commands:U,create(n,e){return ce(new l.Object3D,n,{},e)},dispose:q});const te=new WeakMap;var sa=L({configType:a.CONFIGTYPE.PERSPECTIVECAMERA,commands:{add:Y({scale(){}},U.add),set:ot(Y({scale(){},adaptiveWindow({target:n,value:e,engine:t}){if(e){if(!te.has(e)){const s=r=>{n.aspect=r.width/r.height,n.updateProjectionMatrix()};te.set(n,s),t.addEventListener("setSize",s),s({type:"setSize",width:t.dom.offsetWidth,height:t.dom.offsetHeight})}}else{const s=te.get(n);s&&(t.removeEventListener("setSize",s),te.delete(n))}}},U.set),{$reg:[{reg:new RegExp("fov|aspect|near|far"),handler({target:n,key:e,value:t}){n[e]=t,n.updateProjectionMatrix()}}]}),delete:Y({scale(){}},U.delete)},create(n,e){const t=new l.PerspectiveCamera;if(ce(t,n,{scale:!0,adaptiveWindow:!0},e),t.updateProjectionMatrix(),n.adaptiveWindow){const s=r=>{t.aspect=r.width/r.height,t.updateProjectionMatrix()};te.set(t,s),e.addEventListener("setSize",s),s({type:"setSize",width:e.dom.offsetWidth,height:e.dom.offsetHeight})}return t},dispose(n){te.delete(n),q(n)}}),ra=L({configType:a.CONFIGTYPE.ORTHOGRAPHICCAMERA,commands:{add:Y({scale(){}},U.add),set:ot(Y({scale(){},adaptiveWindow({target:n,value:e,engine:t}){if(e){if(!te.has(e)){const s=r=>{const i=r.width,o=r.height;n.left=-i,n.right=i,n.top=o,n.bottom=-o,n.updateProjectionMatrix()};te.set(n,s),t.addEventListener("setSize",s),s({type:"setSize",width:t.dom.offsetWidth,height:t.dom.offsetHeight})}}else{const s=te.get(n);s&&(t.removeEventListener("setSize",s),te.delete(n))}}},U.set),{$reg:[{reg:new RegExp("left|right|top|bottom|near|far|zoom"),handler({target:n,key:e,value:t}){n[e]=t,n.updateProjectionMatrix()}}]}),delete:Y({scale(){}},U.delete)},create(n,e){const t=new l.OrthographicCamera(-50,50,50,-50);if(ce(t,n,{scale:!0,adaptiveWindow:!0},e),t.updateProjectionMatrix(),n.adaptiveWindow){const s=r=>{const i=r.width,o=r.height;t.left=-i,t.right=i,t.top=o,t.bottom=-o,t.updateProjectionMatrix()};te.set(t,s),e.addEventListener("setSize",s),s({type:"setSize",width:e.dom.offsetWidth,height:e.dom.offsetHeight})}return t},dispose(n){te.delete(n),q(n)}});class ia extends Re{constructor(){super();h(this,"MODULE",a.MODULETYPE.CAMERA)}}O.processor(sa),O.processor(ra);var oa=L({configType:a.CONFIGTYPE.ORBITCONTROLS,commands:{set:{target({target:n,config:e,path:t,key:s,value:r}){const i=e.target;if(!e.type){e.target=new l.Vector3(0,0,0);return}typeof e.target=="string"||(t.length>1?n.target[s]=r:n.target=new l.Vector3(i.x,i.y,i.z))}}},create(n,e){let t;return e.orbitControls?t=e.orbitControls:(t=new mn,t.setCamera(e.camera),t.setDom(e.dom)),n.target&&(typeof n.target=="string"||(t.target=new l.Vector3(n.target.x,n.target.y,n.target.z))),k(n,t,{target:!0}),t},dispose(n){n.dispose()}}),aa=L({configType:a.CONFIGTYPE.TRNASFORMCONTROLS,commands:{set:{snapAllow({target:n,config:e,value:t}){t?(n.translationSnap=e.translationSnap,n.rotationSnap=e.rotationSnap,n.scaleSnap=e.scaleSnap):(n.translationSnap=null,n.rotationSnap=null,n.scaleSnap=null)},translationSnap({target:n,config:e,value:t}){e.snapAllow&&(n.translationSnap=t)},rotationSnap({target:n,config:e,value:t}){e.snapAllow&&(n.rotationSnap=t)},scaleSnap({target:n,config:e,value:t}){e.snapAllow&&(n.scaleSnap=t)}}},create(n,e){let t;return e.transformControls?t=e.transformControls:(t=new En,t.setCamera(e.camera),t.setDom(e.dom)),n.snapAllow&&(t.translationSnap=n.translationSnap,t.rotationSnap=n.rotationSnap,t.scaleSnap=n.scaleSnap),t},dispose(n){n.dispose()}});class ca extends O{constructor(){super();h(this,"MODULE",a.MODULETYPE.CONTROLS)}useEngine(e){return e.transformControls&&(this.map.set(a.CONFIGTYPE.TRNASFORMCONTROLS,e.transformControls),this.weakMap.set(e.transformControls,a.CONFIGTYPE.TRNASFORMCONTROLS)),e.orbitControls&&(this.map.set(a.CONFIGTYPE.ORBITCONTROLS,e.orbitControls),this.weakMap.set(e.orbitControls,a.CONFIGTYPE.ORBITCONTROLS)),super.useEngine(e)}}O.processor(oa),O.processor(aa);const mt=function(n,e){const t=e.resourceManager.resourceMap;if(!t.has(n))return console.warn(`css3D compiler: can not found resource element: ${n}`),document.createElement("div");const s=t.get(n);return s instanceof HTMLElement?s:(console.warn("css3D compiler can not suport render this resource type.",s.constructor,n),document.createElement("div"))};var la=L({configType:a.CONFIGTYPE.CSS3DOBJECT,commands:{add:U.add,set:Y({element({target:n,value:e,engine:t}){n.element=mt(e,t)}},U.set),delete:U.delete},create(n,e){return ce(new we.CSS3DObject(mt(n.element,e)),n,{element:!0},e)},dispose:q});class ua extends we.CSS3DObject{constructor(e=document.createElement("div")){const t=document.createElement("div"),s=50,r=50;t.style.width=`${s}px`,t.style.height=`${r}px`,t.appendChild(e);super(t);h(this,"geometry");h(this,"_width");h(this,"_height");h(this,"cacheBox",new l.Box3);this.geometry=new l.PlaneBufferGeometry(s,r),this.geometry.computeBoundingBox(),this._width=s,this._height=r}get width(){return this._width}set width(e){this.geometry.dispose(),this.geometry=new l.PlaneBufferGeometry(e,this._height),this.geometry.computeBoundingBox(),this.element.style.width=`${e}px`,this._width=e}get height(){return this._height}set height(e){this.geometry.dispose(),this.geometry=new l.PlaneBufferGeometry(this._width,e),this.geometry.computeBoundingBox(),this.element.style.height=`${e}px`,this._height=e}}class ns extends ua{constructor(e=document.createElement("div")){super(e);this.element.classList.add("vis-css3d-plane")}raycast(e,t){const s=this.cacheBox.copy(this.geometry.boundingBox);s.applyMatrix4(this.matrixWorld),e.ray.intersectsBox(s)&&t.push({distance:e.ray.origin.distanceTo(this.position),object:this,point:this.position})}}var da=L({configType:a.CONFIGTYPE.CSS3DPLANE,commands:{add:U.add,set:Y({element({target:n,value:e,engine:t}){n.element.innerHTML="",n.element.appendChild(mt(e,t))}},U.set),delete:U.delete},create(n,e){return ce(new ns(mt(n.element,e)),n,{element:!0},e)},dispose:q});class ha extends Re{constructor(){super();h(this,"MODULE",a.MODULETYPE.CSS3D)}}O.processor(da),O.processor(la);class Qe extends l.BufferGeometry{constructor(e=[],t=36,s=!0){super();h(this,"parameters");this.type="CurveGeometry",this.parameters={path:e.map(r=>r.clone()),space:s,divisions:t}}}class pa extends Qe{constructor(e=[],t=36,s=!0){super(e,t,s);this.type="QuadraticBezierCurveGeometry";const r=new l.CurvePath;if(e.length<3){console.warn("QuadraticBezierCurveGeometry path length at least 3.");return}const i=3+(e.length-3)-(e.length-3)%2;for(let c=1;c<i;c+=2)r.add(new l.QuadraticBezierCurve3(e[c-1],e[c],e[c+1]));const o=r.curves.reduce((c,u)=>c+=u.arcLengthDivisions,0);if(t>o){const c=Math.ceil((t-o)/r.curves.length);r.curves.forEach(u=>{u.arcLengthDivisions=u.arcLengthDivisions*(c+1),u.updateArcLengths()})}this.setFromPoints(s?r.getSpacedPoints(t):r.getPoints(t))}}class fa extends Qe{constructor(e=[],t=36,s=!0){super(e,t,s);this.type="CubicBezierCurveGeometry";const r=new l.CurvePath;if(e.length<4){console.warn("CubicBezierCurveGeometry path length at least 4.");return}const i=4+(e.length-4)-(e.length-4)%3;for(let c=2;c<i;c+=3)r.add(new l.CubicBezierCurve3(e[c-2],e[c-1],e[c],e[c+1]));const o=r.curves.reduce((c,u)=>c+=u.arcLengthDivisions,0);if(t>o){const c=Math.ceil((t-o)/r.curves.length);r.curves.forEach(u=>{u.arcLengthDivisions=u.arcLengthDivisions*(c+1),u.updateArcLengths()})}this.setFromPoints(s?r.getSpacedPoints(t):r.getPoints(t))}}class ma extends Qe{constructor(e=[],t=36,s=!0){super(e,t,s);if(this.type="LineCurveGeometry",!e.length){console.warn("LineCurveGeometry path length at least 1.");return}const r=new l.CurvePath;for(let o=1;o<e.length;o+=1)r.add(new l.LineCurve3(e[o-1],e[o]));const i=r.curves.reduce((o,c)=>o+=c.arcLengthDivisions,0);if(t>i){const o=Math.ceil((t-i)/r.curves.length);r.curves.forEach(c=>{c.arcLengthDivisions=c.arcLengthDivisions*(o+1),c.updateArcLengths()})}this.setFromPoints(s?r.getSpacedPoints(t):r.getPoints(t))}}class Ea extends Qe{constructor(e=[],t=36,s=!0){super(e,t,s);if(this.type="SplineCurveGeometry",!e.length){console.warn("SplineCurveGeometry path length at least 1.");return}const r=new l.CatmullRomCurve3(e);this.setFromPoints(s?r.getSpacedPoints(t):r.getPoints(t))}}class ga extends l.TubeGeometry{constructor(e=[],t=64,s=1,r=8,i=!1){if(!e.length){console.warn("LineTubeGeometry path length at least 1.");return}const o=new l.CurvePath;for(let c=1;c<e.length;c+=1)o.add(new l.LineCurve3(e[c-1],e[c]));super(o,t,s,r,i);this.type="LineTubeGeometry"}}class Aa extends l.TubeGeometry{constructor(e=[],t=64,s=1,r=8,i=!1){if(!e.length){console.warn("SplineTubeGeometry path length at least 1.");return}const o=new l.CatmullRomCurve3(e);super(o,t,s,r,i);this.type="SplineTubeGeometry"}}class Ca extends l.ShapeBufferGeometry{constructor(e=[new l.Vector2(0,0)],t=12){const s=new l.Shape,r=e[0];if(r){s.moveTo(r.x,r.y);for(let i=1;i<e.length;i+=1)s.lineTo(e[i].x,e[i].y)}super(s,t);this.type="LineShapeGeometry"}}const Ma=function(n,e){!(n instanceof Qe)&&!(n instanceof l.TubeGeometry)&&!(n instanceof l.ShapeGeometry)&&n.center(),n.computeBoundingBox();const t=n.boundingBox,s=e.position,r=e.rotation,i=e.scale,o=new l.Quaternion().setFromEuler(new l.Euler(r.x,r.y,r.z,"XYZ"));return n.applyQuaternion(o),n.scale(i.x,i.y,i.z),!(n instanceof Qe)&&!(n instanceof l.TubeGeometry)&&!(n instanceof l.ShapeGeometry)&&n.center(),n.computeBoundingBox(),n.translate((t.max.x-t.min.x)/2*s.x,(t.max.y-t.min.y)/2*s.y,(t.max.z-t.min.z)/2*s.z),n},_t={reg:new RegExp(".*"),handler({config:n,target:e,processor:t,engine:s}){const r=t.create(n,s);e.copy(r),e.dispatchEvent({type:"update"}),e.uuid=r.uuid,r.dispose()}},Et={add:{groups({target:n,value:e}){n.addGroup(e.start,e.count,e.materialIndex)},$reg:[_t]},set:{groups(n){const{path:e,target:t,config:s}=n;if(e[1]!==void 0){t.groups.splice(Number(n.path[1]),1);const r=s.groups[e[1]];t.addGroup(r.start,r.count,r.materialIndex)}else console.warn("geometry processor can not set group",n)},$reg:[_t]},delete:{groups({target:n,key:e}){n.groups.splice(Number(e),1)},$reg:[_t]}},gt=function(n,e){n.clearGroups();for(const t of e.groups)n.addGroup(t.start,t.count,t.materialIndex);return Ma(n,e)},J=new Map;J.set(a.CONFIGTYPE.BOXGEOMETRY,n=>new l.BoxBufferGeometry(n.width,n.height,n.depth,n.widthSegments,n.heightSegments,n.depthSegments)),J.set(a.CONFIGTYPE.SPHEREGEOMETRY,n=>new l.SphereBufferGeometry(n.radius,n.widthSegments,n.heightSegments,n.phiStart,n.phiLength,n.thetaStart,n.thetaLength)),J.set(a.CONFIGTYPE.PLANEGEOMETRY,n=>new l.PlaneBufferGeometry(n.width,n.height,n.widthSegments,n.heightSegments)),J.set(a.CONFIGTYPE.CIRCLEGEOMETRY,n=>new l.CircleBufferGeometry(n.radius,n.segments,n.thetaStart,n.thetaLength)),J.set(a.CONFIGTYPE.CONEGEOMETRY,n=>new l.ConeBufferGeometry(n.radius,n.height,n.radialSegments,n.heightSegments,n.openEnded,n.thetaStart,n.thetaLength)),J.set(a.CONFIGTYPE.CYLINDERGEOMETRY,n=>new l.CylinderBufferGeometry(n.radiusTop,n.radiusBottom,n.height,n.radialSegments,n.heightSegments,n.openEnded,n.thetaStart,n.thetaLength)),J.set(a.CONFIGTYPE.LINECURVEGEOMETRY,n=>new ma(n.path.map(e=>new l.Vector3(e.x,e.y,e.z)),n.divisions,n.space)),J.set(a.CONFIGTYPE.SPLINECURVEGEOMETRY,n=>new Ea(n.path.map(e=>new l.Vector3(e.x,e.y,e.z)),n.divisions,n.space)),J.set(a.CONFIGTYPE.CUBICBEZIERCURVEGEOMETRY,n=>new fa(n.path.map(e=>new l.Vector3(e.x,e.y,e.z)),n.divisions,n.space)),J.set(a.CONFIGTYPE.QUADRATICBEZIERCURVEGEOMETRY,n=>new pa(n.path.map(e=>new l.Vector3(e.x,e.y,e.z)),n.divisions,n.space)),J.set(a.CONFIGTYPE.LINETUBEGEOMETRY,n=>new ga(n.path.map(e=>new l.Vector3(e.x,e.y,e.z)),n.tubularSegments,n.radius,n.radialSegments,n.closed)),J.set(a.CONFIGTYPE.SPLINETUBEGEOMETRY,n=>new Aa(n.path.map(e=>new l.Vector3(e.x,e.y,e.z)),n.tubularSegments,n.radius,n.radialSegments,n.closed)),J.set(a.CONFIGTYPE.TORUSGEOMETRY,n=>new l.TorusGeometry(n.radius,n.tube,n.radialSegments,n.tubularSegments,n.arc)),J.set(a.CONFIGTYPE.RINGGEOMETRY,n=>new l.RingBufferGeometry(n.innerRadius,n.outerRadius,n.thetaSegments,n.phiSegments,n.thetaStart,n.thetaLength)),J.set(a.CONFIGTYPE.LINESHAPEGEOMETRY,n=>new Ca(n.path.map(e=>new l.Vector2(e.x,e.y)),n.curveSegments));const Ta=function(n){return J.has(n.type)?gt(J.get(n.type)(n),n):(console.error(`parametric geometry can not support this type config: ${n.type}`),new l.BufferGeometry)},Ba=function(n){n.dispose()},ya=function(n){return L({configType:n,commands:Et,create:Ta,dispose:Ba})},Sa=[a.CONFIGTYPE.BOXGEOMETRY,a.CONFIGTYPE.SPHEREGEOMETRY,a.CONFIGTYPE.PLANEGEOMETRY,a.CONFIGTYPE.CIRCLEGEOMETRY,a.CONFIGTYPE.CONEGEOMETRY,a.CONFIGTYPE.CYLINDERGEOMETRY,a.CONFIGTYPE.LINECURVEGEOMETRY,a.CONFIGTYPE.SPLINECURVEGEOMETRY,a.CONFIGTYPE.CUBICBEZIERCURVEGEOMETRY,a.CONFIGTYPE.QUADRATICBEZIERCURVEGEOMETRY,a.CONFIGTYPE.LINETUBEGEOMETRY,a.CONFIGTYPE.SPLINETUBEGEOMETRY,a.CONFIGTYPE.TORUSGEOMETRY,a.CONFIGTYPE.RINGGEOMETRY,a.CONFIGTYPE.LINESHAPEGEOMETRY].map(n=>ya(n));class Ra extends l.BufferGeometry{constructor(e){super();h(this,"type","LoadBufferGeometry");e&&this.copy(e)}}var Oa=L({configType:a.CONFIGTYPE.LOADGEOMETRY,commands:Et,create(n,e){const t=e.resourceManager.resourceMap.get(n.url);return!t&&!(t instanceof l.BufferGeometry)?(console.error(`engine rescoure can not found url: ${n.url}`),new l.BoxBufferGeometry(5,5,5)):gt(new Ra(t),n)},dispose(n){n.dispose()}});const Ga=function(n){const e=new l.BufferGeometry;return n.position.length&&e.setAttribute("position",new l.Float32BufferAttribute(n.position,3)),n.color.length&&e.setAttribute("color",new l.Float32BufferAttribute(n.color,3)),n.normal.length&&e.setAttribute("normal",new l.Float32BufferAttribute(n.normal,3)),n.uv.length&&e.setAttribute("uv",new l.Float32BufferAttribute(n.uv,2)),n.uv2.length&&e.setAttribute("uv2",new l.Float32BufferAttribute(n.uv2,2)),n.index.length&&e.setIndex(n.index),e};var ba=L({configType:a.CONFIGTYPE.CUSTOMGEOMETRY,commands:Et,create(n){return gt(Ga(n.attribute),n)},dispose(n){n.dispose()}}),Ia=L({configType:a.CONFIGTYPE.EDGESGEOMETRY,commands:Et,create(n,e){const t=e.compilerManager.getObjectBySymbol(n.url);return!t||!(t instanceof l.BufferGeometry)?(console.error(`engine rescoure can not found url: ${n.url}`),new l.EdgesGeometry(new l.BoxBufferGeometry(5,5,5))):gt(new l.EdgesGeometry(t),n)},dispose(n){n.dispose()}});class La extends O{constructor(){super();h(this,"MODULE",a.MODULETYPE.GEOMETRY)}}Sa.forEach(n=>{O.processor(n)}),O.processor(Oa),O.processor(ba),O.processor(Ia);var Pa=L({configType:a.CONFIGTYPE.GROUP,commands:U,create(n,e){return ce(new l.Group,n,{},e)},dispose:q});class Da extends Re{constructor(){super();h(this,"MODULE",a.MODULETYPE.GROUP)}}O.processor(Pa);const Fa=function({target:n,value:e}){n.color.copy(new l.Color(e))},At=function(n,e,t,s){return n.color.copy(new l.Color(e.color)),ce(n,e,Y({color:!0,scale:!0,rotation:!0,lookAt:!0},t),s)},Ct=Object.assign({},U,{set:{color:Fa,scale:ft,rotation:ft,lookAt:ft}});var wa=L({configType:a.CONFIGTYPE.AMBIENTLIGHT,commands:Ct,create(n,e){return At(new l.AmbientLight,n,{},e)},dispose:q}),Na=L({configType:a.CONFIGTYPE.DIRECTIONALLIGHT,commands:Ct,create(n,e){return At(new l.DirectionalLight,n,{},e)},dispose:q}),va=L({configType:a.CONFIGTYPE.POINTLIGHT,commands:Ct,create(n,e){return At(new l.PointLight,n,{},e)},dispose:q}),Ua=L({configType:a.CONFIGTYPE.SPOTLIGHT,commands:Ct,create(n,e){return At(new l.SpotLight,n,{},e)},dispose:q});class Ha extends Re{constructor(){super();h(this,"MODULE",a.MODULETYPE.LIGHT)}}O.processor(wa),O.processor(Na),O.processor(va),O.processor(Ua);class Mt extends Re{constructor(){super()}}const Tt=new l.ShaderMaterial({fragmentShader:`
  void main () {
    gl_FragColor = vec4(0.5, 0.5, 0.5, 1.0);
  }
  `}),ss=new l.BoxBufferGeometry(10,10,10),xa=function({target:n,value:e,engine:t}){const s=t.compilerManager.getGeometry(e);if(!s){console.warn(`can not found geometry by vid in engine: ${e}`),n.geometry=ss;return}n.geometry=s},Kt=function({target:n,config:e,engine:t}){let s;typeof e.material=="string"?s=t.compilerManager.getMaterial(e.material)||Tt:s=e.material.map(r=>t.compilerManager.getMaterial(r)||Tt),n.material=s},Bt=function(n,e,t,s){if(!t.geometry){let r=s.getObjectBySymbol(e.geometry);r instanceof l.BufferGeometry||(console.warn(`geometry vid in engine is not instance of BufferGeometry: ${e.geometry}`,r),r=ss),n.geometry.dispose(),n.geometry=r}if(!t.material){let r;typeof e.material=="string"?r=s.compilerManager.getMaterial(e.material)||Tt:r=e.material.map(i=>s.compilerManager.getMaterial(i)||Tt),n.material=r}return ce(n,e,Y({geometry:!0,material:!0},t),s)},yt=function(n){q(n)},Ve={add:Y({material:Kt},U.add),set:Y({geometry:xa,material:Kt},U.set),delete:Y({material:Kt},U.delete)};var Ya=L({configType:a.CONFIGTYPE.LINE,commands:Ve,create(n,e){return Bt(new l.Line,n,{},e)},dispose:yt});class ja extends Mt{constructor(){super();h(this,"MODULE",a.MODULETYPE.LINE)}}O.processor(Ya);const be={reg:new RegExp("transparent|sizeAttenuation"),handler({target:n,key:e,value:t}){n[e]=t,n.needsUpdate=!0}},xe={reg:new RegExp("map$","i"),handler({target:n,key:e,value:t,engine:s}){const r=s.compilerManager.getObjectBySymbol(t);r instanceof l.Texture||console.warn(`this url resource is not instance of Texture: ${e}`,t,r),n[e]=r,n.needsUpdate=!0}},Z=function({target:n,key:e,value:t}){n[e].copy(new l.Color(t))},Ye=function(n,e,t){const s={};for(const r of Object.keys(e))if(r.toLocaleLowerCase().endsWith("map")&&e[r]){const i=t.compilerManager.getObjectBySymbol(e[r]);if(!(i instanceof l.Texture)){console.warn(`this url resource is not instance of Texture: ${r}`,e[r],i);continue}n[r]=i,s[r]=!0}else n[r]instanceof l.Color&&(n[r]=new l.Color(e[r]),s[r]=!0);return k(e,n,s),n.needsUpdate=!0,n},Ie=function(n){n.dispose()};var rs=L({configType:a.CONFIGTYPE.LINEBASICMATERIAL,commands:{set:{color:Z,$reg:[xe,be]}},create:function(n,e){return Ye(new l.LineBasicMaterial,n,e)},dispose:Ie}),Ja=L({configType:a.CONFIGTYPE.MESHBASICMATERIAL,commands:{set:{color:Z,$reg:[xe,be]}},create:function(n,e){return Ye(new l.MeshBasicMaterial,n,e)},dispose:Ie}),ka=L({configType:a.CONFIGTYPE.MESHPHONGMATERIAL,commands:{set:{color:Z,emissive:Z,specular:Z,$reg:[xe,be]}},create:function(n,e){return Ye(new l.MeshPhongMaterial,n,e)},dispose:Ie}),_a=L({configType:a.CONFIGTYPE.MESHPHYSICALMATERIAL,commands:{set:{color:Z,emissive:Z,specularColor:Z,sheenColor:Z,attenuationColor:Z,$reg:[xe,be]}},create:function(n,e){return Ye(new l.MeshPhysicalMaterial,n,e)},dispose:Ie}),Ka=L({configType:a.CONFIGTYPE.MESHSTANDARDMATERIAL,commands:{set:{color:Z,emissive:Z,$reg:[xe,be]}},create:function(n,e){return Ye(new l.MeshStandardMaterial,n,e)},dispose:Ie}),Wa=L({configType:a.CONFIGTYPE.POINTSMATERIAL,commands:{set:{color:Z,$reg:[xe,be]}},create:function(n,e){return Ye(new l.PointsMaterial,n,e)},dispose:Ie}),Qa=L({configType:a.CONFIGTYPE.SHADERMATERIAL,commands:{set:{shader({target:n,value:e}){const t=ee.getShader(e);(t==null?void 0:t.vertexShader)&&(n.vertexShader=t.vertexShader),(t==null?void 0:t.fragmentShader)&&(n.fragmentShader=t.fragmentShader),(t==null?void 0:t.uniforms)&&(n.uniforms=t.uniforms),(t==null?void 0:t.defines)&&(n.defines=t.defines),n.needsUpdate=!0},$reg:[be]}},create:function(n,e){const t=new l.ShaderMaterial,s=ee.getShader(n.shader);return(s==null?void 0:s.vertexShader)&&(t.vertexShader=s.vertexShader),(s==null?void 0:s.fragmentShader)&&(t.fragmentShader=s.fragmentShader),(s==null?void 0:s.uniforms)&&(t.uniforms=s.uniforms),(s==null?void 0:s.defines)&&(t.defines=s.defines),k(n,t,{type:!0,shader:!0}),t.needsUpdate=!0,t},dispose:Ie}),Va=L({configType:a.CONFIGTYPE.SPRITEMATERIAL,commands:{set:{color:Z,$reg:[xe,be]}},create:function(n,e){return Ye(new l.SpriteMaterial,n,e)},dispose:Ie});class Xa extends O{constructor(){super();h(this,"MODULE",a.MODULETYPE.MATERIAL)}}O.processor(Ja),O.processor(Ka),O.processor(ka),O.processor(rs),O.processor(Wa),O.processor(Va),O.processor(rs),O.processor(Qa),O.processor(_a);var za=L({configType:a.CONFIGTYPE.MESH,commands:Ve,create(n,e){return Bt(new l.Mesh,n,{},e)},dispose:yt});class Za extends Mt{constructor(){super();h(this,"MODULE",a.MODULETYPE.MESH)}}O.processor(za);var $a=L({configType:a.CONFIGTYPE.OBJECT3D,commands:U,create(n,e){return ce(new l.Object3D,n,{},e)},dispose:q});class qa extends Re{constructor(){super();h(this,"MODULE",a.MODULETYPE.OBJECT3D)}}O.processor($a);var ec=L({configType:a.CONFIGTYPE.SMAAPASS,create(n,e){const t=window.devicePixelRatio;return new Gs.SMAAPass(e.dom?e.dom.offsetWidth*t:window.innerWidth*t,e.dom?e.dom.offsetHeight*t:window.innerWidth*t)},dispose(n){}}),tc=L({configType:a.CONFIGTYPE.UNREALBLOOMPASS,create(n,e){const t=window.devicePixelRatio;return new bs.UnrealBloomPass(new l.Vector2(e.dom?e.dom.offsetWidth*t:window.innerWidth*t,e.dom?e.dom.offsetHeight*t:window.innerWidth*t),n.strength,n.radius,n.threshold)},dispose(n){n.dispose()}});const Gt=class extends dn.Pass{constructor(e=new l.Vector2(256,256),t=1,s=0,r=0,i=new l.Scene,o=new l.PerspectiveCamera,c){super();h(this,"resolution");h(this,"strength");h(this,"radius");h(this,"threshold");h(this,"selectedObjects",[]);h(this,"renderScene");h(this,"renderCamera");h(this,"clearColor",new l.Color(0,0,0));h(this,"renderTargetsHorizontal",[]);h(this,"renderTargetsVertical",[]);h(this,"nMips",5);h(this,"selectRenderTarget");h(this,"renderTargetBright");h(this,"highPassUniforms");h(this,"materialHighPassFilter");h(this,"separableBlurMaterials",[]);h(this,"compositeMaterial");h(this,"bloomTintColors");h(this,"mixMaterial");h(this,"enabled",!0);h(this,"needsSwap",!1);h(this,"_oldClearColor",new l.Color);h(this,"oldClearAlpha",1);h(this,"basic",new l.MeshBasicMaterial);h(this,"fsQuad",new dn.FullScreenQuad);h(this,"materialCache",new Map);h(this,"sceneBackgroundCache",null);h(this,"overrideBackground",new l.Color("black"));h(this,"overrideMeshMaterial",new l.MeshBasicMaterial({color:"black"}));h(this,"overrideLineMaterial",new l.LineBasicMaterial({color:"black"}));h(this,"overridePointsMaterial",new l.PointsMaterial({color:"black"}));h(this,"overrideSpriteMaterial",new l.SpriteMaterial({color:"black"}));this.resolution=e,this.strength=t,this.radius=s,this.threshold=r,this.renderScene=i,this.renderCamera=o,this.selectedObjects=c;let u=Math.round(this.resolution.x/2),d=Math.round(this.resolution.y/2);this.selectRenderTarget=new l.WebGLRenderTarget(u,d),this.selectRenderTarget.texture.name="UnrealBloomPass.selected",this.selectRenderTarget.texture.generateMipmaps=!1,this.renderTargetBright=new l.WebGLRenderTarget(u,d),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let E=0;E<this.nMips;E++){const A=new l.WebGLRenderTarget(u,d);A.texture.name="UnrealBloomPass.h"+E,A.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(A);const M=new l.WebGLRenderTarget(u,d);M.texture.name="UnrealBloomPass.v"+E,M.texture.generateMipmaps=!1,this.renderTargetsVertical.push(M),u=Math.round(u/2),d=Math.round(d/2)}hn.LuminosityHighPassShader===void 0&&console.error("THREE.UnrealBloomPass relies on LuminosityHighPassShader");const p=hn.LuminosityHighPassShader;this.highPassUniforms=l.UniformsUtils.clone(p.uniforms),this.highPassUniforms.luminosityThreshold.value=r,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new l.ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:p.vertexShader,fragmentShader:p.fragmentShader,defines:{}});const f=[3,5,7,9,11];u=Math.round(this.resolution.x/2),d=Math.round(this.resolution.y/2);for(let E=0;E<this.nMips;E++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(f[E])),this.separableBlurMaterials[E].uniforms.texSize.value=new l.Vector2(u,d),u=Math.round(u/2),d=Math.round(d/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;const m=[1,.8,.6,.4,.2];this.compositeMaterial.uniforms.bloomFactors.value=m,this.bloomTintColors=[new l.Vector3(1,1,1),new l.Vector3(1,1,1),new l.Vector3(1,1,1),new l.Vector3(1,1,1),new l.Vector3(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,this.mixMaterial=this.getMixMaterial()}dispose(){for(let e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose()}setSize(e,t){let s=Math.round(e/2),r=Math.round(t/2);this.selectRenderTarget.setSize(s,r),this.renderTargetBright.setSize(s,r);for(let i=0;i<this.nMips;i++)this.renderTargetsHorizontal[i].setSize(s,r),this.renderTargetsVertical[i].setSize(s,r),this.separableBlurMaterials[i].uniforms.texSize.value=new l.Vector2(s,r),s=Math.round(s/2),r=Math.round(r/2)}render(e,t,s,r,i){if(!this.selectedObjects.length){this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=s.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e));return}e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const o=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),i&&e.state.buffers.stencil.setTest(!1);const c=new Map;for(const p of this.selectedObjects)c.set(p,!0);const u=this.materialCache;this.renderScene.background&&(this.sceneBackgroundCache=this.renderScene.background,this.renderScene.background=this.overrideBackground),this.renderScene.traverse(p=>{!c.has(p)&&!p.isLight&&p.visible&&(u.set(p,p.material),p instanceof l.Mesh?p.material=this.overrideMeshMaterial:p instanceof l.Line?p.material=this.overrideLineMaterial:p instanceof l.Points?p.material=this.overridePointsMaterial:p instanceof l.Sprite&&(p.material=this.overrideSpriteMaterial))}),e.setRenderTarget(this.selectRenderTarget),e.clear(),e.render(this.renderScene,this.renderCamera),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=this.selectRenderTarget.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=this.selectRenderTarget.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);let d=this.renderTargetBright;for(let p=0;p<this.nMips;p++)this.fsQuad.material=this.separableBlurMaterials[p],this.separableBlurMaterials[p].uniforms.colorTexture.value=d.texture,this.separableBlurMaterials[p].uniforms.direction.value=Gt.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[p]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[p].uniforms.colorTexture.value=this.renderTargetsHorizontal[p].texture,this.separableBlurMaterials[p].uniforms.direction.value=Gt.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[p]),e.clear(),this.fsQuad.render(e),d=this.renderTargetsVertical[p];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.mixMaterial,this.mixMaterial.uniforms.bloom.value=this.renderTargetsHorizontal[0].texture,this.mixMaterial.uniforms.origin.value=s.texture,i&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(s),this.fsQuad.render(e)),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=o;for(const p of u.entries())p[0].material=p[1];u.clear(),this.sceneBackgroundCache&&(this.renderScene.background=this.sceneBackgroundCache,this.sceneBackgroundCache=null)}getMixMaterial(){return new l.ShaderMaterial({blending:l.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0,uniforms:{bloom:{value:null},origin:{value:null}},vertexShader:`
    
        varying vec2 vUv;
    
        void main() {
    
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
    
        }`,fragmentShader:`
        uniform sampler2D bloom;
        uniform sampler2D origin;
    
        varying vec2 vUv;
    
        void main() {
          vec3 bloomColor = texture2D(bloom, vUv).rgb;
          vec3 originColor = texture2D(origin, vUv).rgb;
          gl_FragColor = vec4(originColor + bloomColor, 1.0);
        }`})}getSeperableBlurMaterial(e){return new l.ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new l.Vector2(.5,.5)},direction:{value:new l.Vector2(.5,.5)}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 texSize;
				uniform vec2 direction;

				float gaussianPdf(in float x, in float sigma) {
					return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;
				}
				void main() {
					vec2 invSize = 1.0 / texSize;
					float fSigma = float(SIGMA);
					float weightSum = gaussianPdf(0.0, fSigma);
					vec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;
					for( int i = 1; i < KERNEL_RADIUS; i ++ ) {
						float x = float(i);
						float w = gaussianPdf(x, fSigma);
						vec2 uvOffset = direction * invSize * x;
						vec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;
						vec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;
						diffuseSum += (sample1 + sample2) * w;
						weightSum += 2.0 * w;
					}
					gl_FragColor = vec4(diffuseSum/weightSum, 1.0);
				}`})}getCompositeMaterial(e){return new l.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;
				uniform sampler2D blurTexture1;
				uniform sampler2D blurTexture2;
				uniform sampler2D blurTexture3;
				uniform sampler2D blurTexture4;
				uniform sampler2D blurTexture5;
				uniform float bloomStrength;
				uniform float bloomRadius;
				uniform float bloomFactors[NUM_MIPS];
				uniform vec3 bloomTintColors[NUM_MIPS];

				float lerpBloomFactor(const in float factor) {
					float mirrorFactor = 1.2 - factor;
					return mix(factor, mirrorFactor, bloomRadius);
				}

				void main() {
					gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +
						lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +
						lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +
						lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +
						lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );
				}`})}};let rt=Gt;h(rt,"BlurDirectionX",new l.Vector2(1,0)),h(rt,"BlurDirectionY",new l.Vector2(0,1));var nc=L({configType:a.CONFIGTYPE.SELECTIVEBLOOMPASS,commands:{add:{selectedObjects({target:n,engine:e,value:t}){const s=e.compilerManager.getObject3D(t);s?n.selectedObjects.push(s):console.warn(`selectiveBloomPassProcessor: can not found vid in engine: ${t}`)}},set:{renderScene({target:n,engine:e,value:t}){const s=e.compilerManager.getObject3D(t);s instanceof l.Scene&&(n.renderScene=s)},renderCamera({target:n,engine:e,value:t}){const s=e.compilerManager.getObject3D(t);s instanceof l.Camera&&(n.renderCamera=s)},selectedObjects({target:n,config:e,engine:t}){const s=e.selectedObjects.map(r=>{const i=t.compilerManager.getObject3D(r);if(i)return i;console.warn(`selectiveBloomPassProcessor: can not found vid in engine: ${r}`)}).filter(r=>r);n.selectedObjects=s}},delete:{selectedObjects({target:n,engine:e,value:t}){const s=e.compilerManager.getObject3D(t);s?n.selectedObjects.includes(s)&&n.selectedObjects.splice(n.selectedObjects.indexOf(s),1):console.warn(`selectiveBloomPassProcessor: can not found vid in engine: ${t}`)}}},create(n,e){const t=[];for(const i of n.selectedObjects){const o=e.compilerManager.getObject3D(i);o&&t.push(o)}const s=window.devicePixelRatio;return new rt(new l.Vector2(e.dom?e.dom.offsetWidth*s:window.innerWidth*s,e.dom?e.dom.offsetHeight*s:window.innerWidth*s),n.strength,n.radius,n.threshold,n.renderScene&&e.compilerManager.getObject3D(n.renderScene)||void 0,n.renderCamera&&e.compilerManager.getObject3D(n.renderCamera)||void 0,t)},dispose(n){n.dispose()}});class sc extends O{constructor(){super();h(this,"MODULE",a.MODULETYPE.PASS);h(this,"composer")}useEngine(e){return super.useEngine(e),e.effectComposer?(this.composer=e.effectComposer,this):(console.warn("engine need install effectComposer plugin that can use pass compiler."),this)}add(e){const t=super.add(e);return t&&this.composer.addPass(t),t}remove(e){if(!this.map.has(e.vid))return console.warn(`PassCompiler can not found this vid pass: ${e.vid}.`),this;const t=this.map.get(e.vid);return this.composer.removePass(t),super.remove(e),this}}O.processor(ec),O.processor(tc),O.processor(nc);var rc=L({configType:a.CONFIGTYPE.POINTS,commands:Ve,create(n,e){return Bt(new l.Points,n,{},e)},dispose:yt});class ic extends Mt{constructor(){super();h(this,"MODULE",a.MODULETYPE.POINTS)}}O.processor(rc);var oc=L({configType:a.CONFIGTYPE.WEBGLRENDERER,commands:{set:{size({target:n,config:e}){e.size?n.setSize(e.size.x,e.size.y):n.setSize(n.domElement.offsetWidth,n.domElement.offsetHeight)},clearColor({target:n,value:e}){const t=Number(e.slice(0,-1).split(",").pop().trim());n.setClearColor(e,t),n.clear()},viewport({target:n,config:e}){const t=e.viewport;if(t)n.setViewport(t.x,t.y,t.width,t.height);else{const s=n.domElement;n.setViewport(0,0,s.offsetWidth,s.offsetHeight)}},scissor({target:n,config:e}){const t=e.scissor;if(t)n.setScissorTest(!0),n.setScissor(t.x,t.y,t.width,t.height);else{n.setScissorTest(!1);const s=n.domElement;n.setScissor(0,0,s.offsetWidth,s.offsetHeight)}},pixelRatio({target:n,value:e}){n.setPixelRatio(e),n.clear()}}},create(n,e){let t;if(e.webGLRenderer?t=e.webGLRenderer:t=new l.WebGLRenderer,n.size&&t.setSize(n.size.x,n.size.y),n.clearColor){const s=Number(n.clearColor.slice(0,-1).split(",").pop().trim());t.setClearColor(n.clearColor,s)}if(n.viewport){const s=n.viewport;t.setViewport(s.x,s.y,s.width,s.height)}if(n.scissor){const s=n.scissor;t.setScissorTest(!0),t.setScissor(s.x,s.y,s.width,s.height)}return n.pixelRatio&&t.setPixelRatio(n.pixelRatio),k(n,t,{size:!0,clearColor:!0,viewport:!0,scissor:!0,pixelRatio:!0}),t},dispose(n){n.clear(),n.dispose()}}),ac=L({configType:a.CONFIGTYPE.CSS3DRENDERER,commands:{set:{size({target:n,config:e}){e.size?n.setSize(e.size.x,e.size.y):n.setSize(n.domElement.offsetWidth,n.domElement.offsetHeight)}}},create(n,e){let t;return e.css3DRenderer?t=e.css3DRenderer:t=new we.CSS3DRenderer,n.size&&t.setSize(n.size.x,n.size.y),k(n,t,{size:!0}),t},dispose(n){}});class cc extends O{constructor(){super();h(this,"MODULE",a.MODULETYPE.RENDERER)}useEngine(e){return e.webGLRenderer&&this.map.set(a.CONFIGTYPE.WEBGLRENDERER,e.webGLRenderer),e.css3DRenderer&&this.map.set(a.CONFIGTYPE.CSS3DRENDERER,e.css3DRenderer),super.useEngine(e)}}O.processor(oc),O.processor(ac);const is=function(n,e,t){if(!e){n.background=null;return}if(se.validate(e)){const s=t.compilerManager.getTexture(e);s?n.background=s:console.warn(`engine can not found this vid texture : '${e}'`)}else n.background=new l.Color(e)},os=function(n,e,t){if(!e){n.environment=null;return}if(se.validate(e)){const s=t.compilerManager.getTexture(e);s?n.environment=s:console.warn(`engine can not found this vid texture : '${e}'`)}else console.warn(`scene environment is illeage: ${e}`)};var lc=L({configType:a.CONFIGTYPE.SCENE,commands:{add:U.add,set:ot(Y({},U.set),{lookAt(){},fog({target:n,config:e,key:t,value:s}){const r=e.fog;r.type?r.type==="Fog"?!n.fog||!(n.fog instanceof l.Fog)?n.fog=new l.Fog(r.color,r.near,r.far):t==="color"?n.fog.color.copy(new l.Color(r.color)):n.fog[t]&&(n.fog[t]=s):r.type==="FogExp2"&&(!n.fog||!(n.fog instanceof l.FogExp2)?n.fog=new l.FogExp2(r.color,r.density):t==="color"?n.fog.color.copy(new l.Color(r.color)):n.fog[t]&&(n.fog[t]=s)):n.fog=null},background({target:n,value:e,engine:t}){is(n,e,t)},environment({target:n,value:e,engine:t}){os(n,e,t)}}),delete:U.delete},create(n,e){const t=new l.Scene;if(is(t,n.background,e),os(t,n.environment,e),n.fog.type){const s=n.fog;s.type==="Fog"?t.fog=new l.Fog(s.color,s.near,s.far):s.type==="FogExp2"?t.fog=new l.FogExp2(s.color,s.density):console.warn(`scene processor can not support this type fog:'${n.type}'`)}return ce(t,n,{lookAt:!0,background:!0,environment:!0,fog:!0},e)},dispose:q});class uc extends Re{constructor(){super();h(this,"MODULE",a.MODULETYPE.SCENE)}}O.processor(lc);const as=new l.SpriteMaterial({color:"rgb(123, 123, 123)"});var dc=L({configType:a.CONFIGTYPE.SPRITE,commands:{add:Ve.add,set:ot(Y({lookAt(){}},Ve.set),{material({target:n,engine:e,value:t}){const s=e.compilerManager.getMaterial(t);s&&s instanceof l.SpriteMaterial?n.material=s:n.material=as}}),delete:Ve.add},create(n,e){const t=new l.Sprite,s=e.compilerManager.getMaterial(n.material);return s&&s instanceof l.SpriteMaterial?t.material=s:t.material=as,Bt(t,n,{geometry:!0,material:!0,lookAt:!0},e)},dispose:yt});class hc extends Mt{constructor(){super();h(this,"MODULE",a.MODULETYPE.SPRITE)}}O.processor(dc);class pc extends l.Texture{constructor(e,t,s,r,i,o,c,u,d,p){super(e,t,s,r,i,o,c,u,d,p)}}const St={reg:new RegExp("wrapS|wrapT|format|encoding|anisotropy|magFilter|minFilter|mapping"),handler({target:n,key:e,value:t}){n[e]=t,n.needsUpdate=!0}};var fc=L({configType:a.CONFIGTYPE.IMAGETEXTURE,commands:{set:{url({target:n,value:e,engine:t}){n.image=t.compilerManager.textureCompiler.getResource(e,HTMLImageElement),n.needsUpdate=!0},$reg:[St]}},create(n,e){const t=new pc;return n.url&&(t.image=e.compilerManager.textureCompiler.getResource(n.url,HTMLImageElement)),k(n,t,{type:!0,url:!0}),t.needsUpdate=!0,t},dispose(n){n.dispose()}}),mc=L({configType:a.CONFIGTYPE.CANVASTEXTURE,commands:{set:{url({target:n,value:e,engine:t}){n.image=t.compilerManager.textureCompiler.getResource(e,HTMLCanvasElement),n.needsUpdate=!0},$reg:[St]}},create(n,e){const t=new l.CanvasTexture(e.compilerManager.textureCompiler.getResource(n.url,HTMLCanvasElement));return k(n,t,{type:!0,url:!0}),t.needsUpdate=!0,t},dispose(n){n.dispose()}});const je=[HTMLImageElement,HTMLVideoElement,HTMLCanvasElement],Xe=function({target:n,index:e,value:t,engine:s}){n.images[e]=s.compilerManager.textureCompiler.getResource(t,je),n.needsUpdate=!0};var Ec=L({configType:a.CONFIGTYPE.CUBETEXTURE,commands:{set:{cube:{px({target:n,value:e,engine:t}){Xe({target:n,value:e,engine:t,index:0})},nx({target:n,value:e,engine:t}){Xe({target:n,value:e,engine:t,index:1})},py({target:n,value:e,engine:t}){Xe({target:n,value:e,engine:t,index:2})},ny({target:n,value:e,engine:t}){Xe({target:n,value:e,engine:t,index:3})},pz({target:n,value:e,engine:t}){Xe({target:n,value:e,engine:t,index:4})},nz({target:n,value:e,engine:t}){Xe({target:n,value:e,engine:t,index:5})}}}},create(n,e){const t=new l.CubeTexture,s=n.cube,r=e.compilerManager.textureCompiler,i=[r.getResource(s.px,je),r.getResource(s.nx,je),r.getResource(s.py,je),r.getResource(s.ny,je),r.getResource(s.pz,je),r.getResource(s.nz,je)];return t.image=i,k(n,t,{type:!0,cube:!0}),t.needsUpdate=!0,t},dispose(n){n.dispose()}});class gc extends l.Texture{constructor(e,t,s,r,i,o,c,u,d){super(e,t,s,r,i,o,c,u,d);h(this,"isVideoTexture",!0);this.format=c!==void 0?c:l.RGBFormat,this.minFilter=o!==void 0?o:l.LinearFilter,this.magFilter=i!==void 0?i:l.LinearFilter,this.generateMipmaps=!1}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image,t="requestVideoFrameCallback"in e;t?this.needsUpdate=!0:t===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}var Ac=L({configType:a.CONFIGTYPE.VIDEOTEXTURE,commands:{set:{url({target:n,value:e,engine:t}){n.image=t.compilerManager.textureCompiler.getResource(e,HTMLVideoElement),n.needsUpdate=!0},$reg:[St]}},create(n,e){const t=new gc(document.createElement("video"));return n.url&&(t.image=e.compilerManager.textureCompiler.getResource(n.url,HTMLVideoElement)),k(n,t,{type:!0,url:!0}),t.needsUpdate=!0,t},dispose(n){n.dispose()}});class ze{constructor(e){h(this,"canvas");this.canvas=document.createElement("canvas");const t=window.devicePixelRatio;this.canvas.width=((e==null?void 0:e.width)||512)*t,this.canvas.height=((e==null?void 0:e.height)||512)*t,this.canvas.style.backgroundColor=(e==null?void 0:e.bgColor)||"rgb(255, 255, 255)";const s=this.canvas.getContext("2d");s&&s.scale(window.devicePixelRatio,window.devicePixelRatio)}get(){return this.canvas}getDom(){return this.canvas}clear(e=0,t=0,s,r){!s&&(s=this.canvas.width),!r&&(r=this.canvas.height);const i=this.canvas.getContext("2d");return i?(i.clearRect(e,t,s,r),this):(console.warn("you browser can not support canvas 2d"),this)}draw(e){const t=this.canvas.getContext("2d");return t?(e(t),this):(console.warn("you browser can not support canvas 2d"),this)}preview(e){const t=this.canvas;return t.style.position="fixed",t.style.top=(e==null?void 0:e.top)||"5%",t.style.left=(e==null?void 0:e.left)||"5%",t.style.right=(e==null?void 0:e.right)||"unset",t.style.bottom=(e==null?void 0:e.bottom)||"unset",(e==null?void 0:e.scale)&&(t.style.transform=`scale(${e.scale})`),document.body.appendChild(this.canvas),this}}class cs extends l.Texture{constructor(e){super();Object.keys(e).forEach(t=>{this[t]=e[t]}),this.copy(e)}}var Cc=L({configType:a.CONFIGTYPE.LOADTEXTURE,commands:{set:{url({}){},$reg:[St]}},create(n,e){let t;const s=e.compilerManager.textureCompiler.getResource(n.url,l.Texture);if(s instanceof l.Texture)t=new cs(s);else{const r=new l.Texture(s);t=new cs(r)}return k(n,t,{type:!0,url:!0}),t.needsUpdate=!0,t},dispose(n){n.dispose()}});const it=class extends O{constructor(){super();h(this,"MODULE",a.MODULETYPE.TEXTURE)}getResource(e,t){const s=this.engine.resourceManager.resourceMap;if(!s.has(e))return console.warn(`engine resourceManager can not found this url: ${e}`),it.replaceImage;const r=s.get(e);if(Array.isArray(t)){for(const i of t)if(r instanceof i)return r;return console.warn(`this url mapping resource is not a texture image class: ${e}`,r),it.replaceImage}else return r instanceof t?r:(console.warn(`this url mapping resource is not a texture image class: ${e}`,r),it.replaceImage)}};let Wt=it;h(Wt,"replaceImage",new ze({width:512,height:512}).draw(e=>{e.translate(256,256),e.font="72px",e.fillStyle="white",e.fillText("\u6682\u65E0\u56FE\u7247",0,0)}).getDom()),O.processor(fc),O.processor(mc),O.processor(Ec),O.processor(Ac),O.processor(Cc);class Mc{constructor(e){h(this,"object3DCompiler",new qa);h(this,"cameraCompiler",new ia);h(this,"lightCompiler",new Ha);h(this,"geometryCompiler",new La);h(this,"textureCompiler",new Wt);h(this,"materialCompiler",new Xa);h(this,"rendererCompiler",new cc);h(this,"sceneCompiler",new uc);h(this,"controlsCompiler",new ca);h(this,"spriteCompiler",new hc);h(this,"lineCompiler",new ja);h(this,"meshCompiler",new Za);h(this,"pointsCompiler",new ic);h(this,"groupCompiler",new Da);h(this,"css3DCompiler",new ha);h(this,"passCompiler",new sc);h(this,"animationCompiler",new Co);h(this,"compilerMap");e&&Object.keys(e).forEach(s=>{this[s]=e[s]});const t=new Map;Object.keys(this).forEach(s=>{const r=this[s];r instanceof O&&t.set(r.MODULE,r)}),this.compilerMap=t}support(e){this.compilerMap.forEach(s=>{s.useEngine(e)});const t=e.dataSupportManager;return t.textureDataSupport.addCompiler(this.textureCompiler),t.materialDataSupport.addCompiler(this.materialCompiler),t.geometryDataSupport.addCompiler(this.geometryCompiler),t.rendererDataSupport.addCompiler(this.rendererCompiler),t.controlsDataSupport.addCompiler(this.controlsCompiler),t.passDataSupport.addCompiler(this.passCompiler),t.object3DDataSupport.addCompiler(this.object3DCompiler),t.cameraDataSupport.addCompiler(this.cameraCompiler),t.lightDataSupport.addCompiler(this.lightCompiler),t.spriteDataSupport.addCompiler(this.spriteCompiler),t.lineDataSupport.addCompiler(this.lineCompiler),t.meshDataSupport.addCompiler(this.meshCompiler),t.pointsDataSupport.addCompiler(this.pointsCompiler),t.css3DDataSupport.addCompiler(this.css3DCompiler),t.groupDataSupport.addCompiler(this.groupCompiler),t.sceneDataSupport.addCompiler(this.sceneCompiler),t.animationDataSupport.addCompiler(this.animationCompiler),this}getObjectSymbol(e){for(const t of this.compilerMap.values()){const s=t.getObjectSymbol(e);if(s)return s}return null}getObjectBySymbol(e){for(const t of this.compilerMap.values()){const s=t.getObjectBySymbol(e);if(s)return s}return null}getObject3D(e){for(const t of this.compilerMap.values())if(t instanceof Re&&t.map.has(e))return t.map.get(e);return null}getGeometry(e){return this.geometryCompiler.map.get(e)||null}getMaterial(e){return this.materialCompiler.map.get(e)||null}getTexture(e){return this.textureCompiler.map.get(e)||null}dispose(){for(const e of this.compilerMap.values())e.dispose();return this.compilerMap.clear(),this}}const Tc=function(n){if(this.compilerManager)return console.warn("engine has installed compilerManager plugin."),!1;if(!this.dataSupportManager)return console.warn("must install dataSupportManager before compilerManager plugin."),!1;if(!this.renderManager)return console.warn("must install renderManager before compilerManager plugin."),!1;const e=new Mc;return this.compilerManager=e,this.getObjectSymbol=function(t){return this.compilerManager.getObjectSymbol(t)},this.getObjectBySymbol=function(t){return this.compilerManager.getObjectBySymbol(t)},this.addEventListener("dispose",()=>{this.compilerManager.dispose()}),this.completeSet.add(()=>{this.compilerManager.support(this)}),!0};class ls extends re{constructor(){super();h(this,"map",new Map)}generateSymbol(e){return Array.isArray(e)?e.join(" + "):e.shortcutKey.join(" + ")}watch(e){return e?at.default.watch(void 0,e):at.default.watch(),this}register(e){const t=this.generateSymbol(e);return this.map.has(t)?(console.warn(`KeyboardManager: shortcutKey already exist: ${t}. desp: ${this.map.get(t).desp}`),this):(at.default.bind(t,e.keydown||null,e.keyup),this.map.set(t,e),this)}update(e){const t=this.generateSymbol(e);return this.map.has(t)?(this.cancel(e.shortcutKey),this.register(e),this):(console.warn("KeyboardManager: shortcutKey unregister then exec register function"),this.register(e),this)}cancel(e){const t=this.generateSymbol(e);if(this.map.has(t)){const s=this.map.get(t);at.default.unbind(t,s.keydown||null,s.keyup),this.map.delete(t)}return this}checkRepeat(e){const t=this.generateSymbol(e);return this.map.has(t)}}const Bc=function(n){if(this.keyboardManager)return console.warn("engine has installed keyboardManager plugin."),!1;const e=new ls;return this.keyboardManager=e,this.completeSet.add(()=>{if(this.transformControls)if(this.IS_ENGINESUPPORT){const t=this.dataSupportManager.controlsDataSupport.getData()[a.CONFIGTYPE.TRNASFORMCONTROLS];e.register({shortcutKey:["r"],desp:"tranformControls rotate mode",keyup:s=>{s==null||s.preventDefault(),t.mode="rotate"}}).register({shortcutKey:["t"],desp:"tranformControls translate mode",keyup:s=>{s==null||s.preventDefault(),t.mode="translate"}}).register({shortcutKey:["e"],desp:"tranformControls scale mode",keyup:s=>{s==null||s.preventDefault(),t.mode="scale"}}).register({shortcutKey:["x"],desp:"tranformControls switch x axis",keyup:s=>{s==null||s.preventDefault(),t.showX=!t.showX}}).register({shortcutKey:["y"],desp:"tranformControls switch y axis",keyup:s=>{s==null||s.preventDefault(),!(s==null?void 0:s.ctrlKey)&&(t.showY=!t.showY)}}).register({shortcutKey:["z"],desp:"tranformControls switch z axis",keyup:s=>{s==null||s.preventDefault(),!(s==null?void 0:s.ctrlKey)&&(t.showZ=!t.showZ)}}).register({shortcutKey:["space"],desp:"tranformControls switch coordinate space",keyup:s=>{s==null||s.preventDefault(),t.space=t.space==="local"?"world":"local"}}).register({shortcutKey:["shift"],desp:"tranformControls switch tranform numeric value",keyup:s=>{s==null||s.preventDefault(),t.snapAllow=!1},keydown:s=>{s==null||s.preventDefault(),s==null||s.preventRepeat(),t.snapAllow=!0}})}else{const t=this.transformControls;e.register({shortcutKey:["r"],desp:"tranformControls rotate mode",keyup:s=>{s==null||s.preventDefault(),t.mode="rotate"}}).register({shortcutKey:["t"],desp:"tranformControls translate mode",keyup:s=>{s==null||s.preventDefault(),t.mode="translate"}}).register({shortcutKey:["e"],desp:"tranformControls scale mode",keyup:s=>{s==null||s.preventDefault(),t.mode="scale"}}).register({shortcutKey:["x"],desp:"tranformControls switch x axis",keyup:s=>{s==null||s.preventDefault(),t.showX=!t.showX}}).register({shortcutKey:["y"],desp:"tranformControls switch y axis",keyup:s=>{s==null||s.preventDefault(),!(s==null?void 0:s.ctrlKey)&&(t.showY=!t.showY)}}).register({shortcutKey:["z"],desp:"tranformControls switch z axis",keyup:s=>{s==null||s.preventDefault(),!(s==null?void 0:s.ctrlKey)&&(t.showZ=!t.showZ)}}).register({shortcutKey:["space"],desp:"tranformControls switch coordinate space",keyup:s=>{s==null||s.preventDefault(),t.space=t.space==="local"?"world":"local"}}).register({shortcutKey:["shift"],desp:"tranformControls switch tranform numeric value",keyup:s=>{s==null||s.preventDefault(),t.translationSnap=null,t.rotationSnap=null,t.scaleSnap=null},keydown:s=>{s==null||s.preventDefault(),s==null||s.preventRepeat(),t.translationSnap=5,t.rotationSnap=Math.PI/180*10,t.scaleSnap=.1}})}}),!0},yc=function(n={}){if(!this.scene)return console.error("must install some scene plugin before BasicViewpoint plugin."),!1;const e=new l.AxesHelper(n.length||500);return e.matrixAutoUpdate=!1,e.raycast=()=>{},this.scene.add(e),this.setAxesHelper=function(t){return t.show?this.scene.add(e):this.scene.remove(e),this},this.addEventListener("setScene",t=>{t.scene.add(e)}),!0},Sc=function(n={}){if(!this.scene)return console.error("must install some scene before BasicViewpoint plugin."),!1;const e=new l.GridHelper(n.range||500,n.spacing||50,n.axesColor||"rgb(130, 130, 130)",n.cellColor||"rgb(70, 70, 70)");if(n.opacity!==1){const t=e.material;t.transparent=!0,t.opacity=n.opacity||.5,t.needsUpdate=!0}return e.matrixAutoUpdate=!1,e.raycast=()=>{},this.scene.add(e),this.setGridHelper=function(t){return t.show?this.scene.add(e):this.scene.remove(e),this},this.addEventListener("setScene",t=>{t.scene.add(e)}),this.completeSet.add(()=>{this.setViewpoint&&this.addEventListener("setViewpoint",t=>{const s=t.viewpoint;s===a.VIEWPOINT.DEFAULT||s===a.VIEWPOINT.TOP||s===a.VIEWPOINT.BOTTOM?e.rotation.set(0,0,0):s===a.VIEWPOINT.RIGHT||s===a.VIEWPOINT.LEFT?e.rotation.set(0,0,Math.PI/2):(s===a.VIEWPOINT.FRONT||s===a.VIEWPOINT.BACK)&&e.rotation.set(Math.PI/2,0,0),e.updateMatrix(),e.updateMatrixWorld()})}),!0};a.DISPLAYMODE=void 0,function(n){n.GEOMETRY="geometry",n.MATERIAL="material",n.LIGHT="light",n.ENV="env"}(a.DISPLAYMODE||(a.DISPLAYMODE={}));const Rc=function(n={}){if(!this.webGLRenderer)return console.error("must install some renderer before DisplayModel plugin."),!1;if(!this.scene)return console.error("must install some scene before DisplayModel plugin."),!1;!n.overrideColor&&(n.overrideColor="rgb(250, 250, 250)"),!n.defaultAmbientLightSetting&&(n.defaultAmbientLightSetting={}),!n.defaultAmbientLightSetting.color&&(n.defaultAmbientLightSetting.color="rgb(255, 255, 255)"),!n.defaultAmbientLightSetting.intensity&&(n.defaultAmbientLightSetting.intensity=.5);const e=new l.AmbientLight(n.defaultAmbientLightSetting.color,n.defaultAmbientLightSetting.intensity);e.matrixAutoUpdate=!1,!n.defaultDirectionalLightSetting&&(n.defaultDirectionalLightSetting={}),!n.defaultDirectionalLightSetting.color&&(n.defaultDirectionalLightSetting.color="rgb(255, 255, 255)"),!n.defaultDirectionalLightSetting.intensity&&(n.defaultDirectionalLightSetting.intensity=.5),!n.defaultDirectionalLightSetting.position&&(n.defaultDirectionalLightSetting.position={x:-100,y:100,z:100});const t=new l.DirectionalLight(n.defaultDirectionalLightSetting.color,n.defaultDirectionalLightSetting.intensity);t.castShadow=!1,t.position.set(n.defaultDirectionalLightSetting.position.x,n.defaultDirectionalLightSetting.position.y,n.defaultDirectionalLightSetting.position.z),t.updateMatrix(),t.updateMatrixWorld(),t.matrixAutoUpdate=!1,!n.mode&&(n.mode=a.DISPLAYMODE.ENV),this.displayMode=n.mode;const s=new l.MeshLambertMaterial({color:n.overrideColor}),r=new l.LineBasicMaterial({color:n.overrideColor}),i=new l.PointsMaterial({color:n.overrideColor,size:5,sizeAttenuation:!1}),o=new l.SpriteMaterial({color:n.overrideColor}),c=new WeakMap,u=new Set,d=new Set,p=new Set,f=new Set,m=new Set;let E,A;const M={Object3D:!0,Group:!0};this.scene.addEventListener("afterAdd",B=>{const F=this.displayMode,I=B.objects;for(const b of I)if(!M[b.type])if(b instanceof l.Mesh&&b.type==="Mesh")d.add(b),F===a.DISPLAYMODE.GEOMETRY&&(c.set(b,b.material),b.material=s);else if(b instanceof l.Line&&b.type.includes("Line"))p.add(b),F===a.DISPLAYMODE.GEOMETRY&&(c.set(b,b.material),b.material=r);else if(b instanceof l.Light&&b.type.includes("Light")){if(b===e||b===t)continue;u.has(b)||u.add(b),F!==a.DISPLAYMODE.ENV&&F!==a.DISPLAYMODE.LIGHT&&this.scene.remove(b)}else b instanceof l.Points&&b.type==="Points"?(f.add(b),F===a.DISPLAYMODE.GEOMETRY&&(c.set(b,b.material),b.material=i)):b instanceof l.Sprite&&b.type==="Sprite"&&(m.add(b),F===a.DISPLAYMODE.GEOMETRY&&(c.set(b,b.material),b.material=o))}),this.scene.addEventListener("afterRemove",B=>{const F=B.objects;for(const I of F)if(!M[I.type])if(I instanceof l.Mesh&&I.type==="Mesh")d.delete(I),c.has(I)&&c.delete(I);else if(I instanceof l.Line&&I.type.includes("Line"))p.delete(I),c.has(I)&&c.delete(I);else if(I instanceof l.Light&&I.type.includes("Light")){if(I===e||I===t)continue;u.delete(I)}else I instanceof l.Points&&I.type==="Points"?(f.delete(I),c.has(I)&&c.delete(I)):I instanceof l.Sprite&&I.type==="Sprite"&&(m.delete(I),c.has(I)&&c.delete(I))});const T=()=>{for(const B of d)B.material!==s&&(c.set(B,B.material),B.material=s);for(const B of p)B.material!==r&&(c.set(B,B.material),B.material=r);for(const B of f)B.material!==i&&(c.set(B,B.material),B.material=i);for(const B of m)B.material!==o&&(c.set(B,B.material),B.material=o)},C=()=>{d.forEach(B=>{c.has(B)&&(B.material=c.get(B),c.delete(B))}),p.forEach(B=>{c.has(B)&&(B.material=c.get(B),c.delete(B))}),f.forEach(B=>{c.has(B)&&(B.material=c.get(B),c.delete(B))}),m.forEach(B=>{c.has(B)&&(B.material=c.get(B),c.delete(B))})},S=()=>{u.forEach(B=>{B.visible=!1}),this.scene.add(e),this.scene.add(t)},y=()=>{u.forEach(B=>{B.visible=!0}),this.scene.remove(e),this.scene.remove(t)},R=()=>{this.scene.background instanceof l.Texture&&(E=this.scene.background,this.scene.background=null),this.scene.environment instanceof l.Texture&&(A=this.scene.environment,this.scene.environment=null)},P=()=>{E&&(this.scene.background=E,E=void 0),A&&(this.scene.environment=A,A=void 0)};return this.setDisplayMode=function(B){return this.displayMode=B||a.DISPLAYMODE.ENV,B===a.DISPLAYMODE.GEOMETRY?(T(),R(),S()):B===a.DISPLAYMODE.MATERIAL?(C(),R(),S()):B===a.DISPLAYMODE.LIGHT?(C(),R(),y()):B===a.DISPLAYMODE.ENV?(C(),P(),y()):console.warn(`displayMode plugin can not set this mode: ${B}`),this},this.completeSet.add(()=>{this.objectHelperManager&&this.objectHelperManager.addFilteredObject(t)}),!0},Le=()=>new l.LineBasicMaterial({color:"rgb(255, 255, 255)"});class Qt extends l.LineSegments{constructor(e){super();h(this,"shape");h(this,"target");h(this,"type","CameraHelper");h(this,"cachaData");const t=new l.BufferGeometry,s=[0,0,0,-1,1,-1,0,0,0,-1,1,1,0,0,0,-1,-1,-1,0,0,0,-1,-1,1,-1,-1,1,-1,-1,-1,-1,-1,-1,-1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,-1,1,0,0,0,0,1,1,0,0,0,0,1,-1,0,0,0,0,-1,-1,0,0,0,0,-1,1,0,1,1,0,1,-1,0,1,-1,0,-1,-1,0,-1,-1,0,-1,1,0,-1,1,0,1,1,0,-1,1,2,-1,1,0,1,-1,2,1,-1,0,-1,-1,2,-1,-1,0,1,1,2,1,1,2,1,1,2,-1,1,2,-1,1,2,-1,-1,2,-1,-1,2,1,-1,2,1,-1,2,1,1];t.setAttribute("position",new l.Float32BufferAttribute(s,3)),t.rotateY(-90*Math.PI/180),t.computeBoundingBox();const r=new l.CameraHelper(e);r.matrix=new l.Matrix4,r.matrixAutoUpdate=!0,r.raycast=()=>{},this.add(r),this.shape=r,this.geometry=t,this.material=Le(),this.target=e,this.matrixAutoUpdate=!1,this.matrix=e.matrix,e instanceof l.PerspectiveCamera?this.cachaData={fov:e.fov,aspect:e.aspect,near:e.near,far:e.far}:e instanceof l.OrthographicCamera?this.cachaData={left:e.left,right:e.right,top:e.top,bottom:e.bottom,near:e.near,far:e.far}:this.cachaData={},this.onBeforeRender=()=>{let i=!1;const o=this.cachaData;Object.keys(o).forEach(c=>{o[c]!==e[c]&&(o[c]=e[c],i=!0)}),i&&this.shape.update()}}raycast(e,t){const s=this.matrixWorld,r=this.geometry.boundingBox.clone();if(r.applyMatrix4(s),e.ray.intersectsBox(r)){const i=this.target;t.push({distance:e.ray.origin.distanceTo(i.position),object:i,point:i.position})}}}class us extends l.LineSegments{constructor(e){super();h(this,"sphere");h(this,"target");h(this,"shape");h(this,"type","VisDirectionalLightHelper");h(this,"cacheColor");h(this,"cacheVector3");this.geometry=new l.BufferGeometry;const t=[-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,0,0,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,-.707,0,-.707,.707,0,.707,.707,0,-.707,-.707,0,.707];this.geometry.setAttribute("position",new l.Float32BufferAttribute(t,3)),this.material=Le(),this.geometry.boundingSphere;const s=new l.Color().copy(e.color).multiplyScalar(e.intensity),r=new l.PlaneBufferGeometry(20,20);r.dispose();const i=new l.LineSegments(new l.EdgesGeometry(r),new l.LineBasicMaterial({color:s}));i.raycast=()=>{},this.shape=i,this.target=e,this.sphere=new l.Sphere(new l.Vector3(0,0,0),1),this.cacheColor=e.color.getHex(),this.cacheVector3=new l.Vector3,this.add(this.shape),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.onBeforeRender=()=>{const o=this.target,c=this.shape;o.color.getHex()!==this.cacheColor&&(c.material.color.copy(o.color).multiplyScalar(o.intensity),this.cacheColor=o.color.getHex()),c.lookAt(o.target.position)}}raycast(e,t){const s=this.target,r=s.matrixWorld,i=this.sphere;i.set(this.cacheVector3.set(0,0,0),1),i.applyMatrix4(r),e.ray.intersectsSphere(i)&&t.push({distance:e.ray.origin.distanceTo(s.position),object:s,point:s.position})}}class ds extends l.LineSegments{constructor(e){super();h(this,"sphere");h(this,"target");h(this,"shape");h(this,"type","VisPointLightHelper");h(this,"cacheColor");h(this,"cacheDistance");h(this,"cacheVector3");this.geometry=new l.BufferGeometry;const t=[-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,0,0,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,-.707,0,-.707,.707,0,.707,.707,0,-.707,-.707,0,.707];this.geometry.setAttribute("position",new l.Float32BufferAttribute(t,3)),this.material=Le(),this.geometry.boundingSphere;const s=new l.Color().copy(e.color).multiplyScalar(e.intensity),r=new l.Mesh(new l.OctahedronBufferGeometry(e.distance,0),new l.MeshBasicMaterial({color:s,wireframe:!0}));r.raycast=()=>{},r.matrixAutoUpdate=!1,this.shape=r,this.target=e,this.sphere=new l.Sphere(new l.Vector3(0,0,0),1),this.cacheColor=e.color.getHex(),this.cacheDistance=e.distance,this.cacheVector3=new l.Vector3,this.add(this.shape),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.onBeforeRender=()=>{const i=this.target,o=this.shape;i.distance!==this.cacheDistance&&(o.geometry.dispose(),o.geometry=new l.OctahedronBufferGeometry(i.distance,0),this.cacheDistance=i.distance),i.color.getHex()!==this.cacheColor&&(o.material.color.copy(i.color).multiplyScalar(i.intensity),this.cacheColor=i.color.getHex())}}raycast(e,t){const s=this.target,r=s.matrixWorld,i=this.sphere;i.set(this.cacheVector3.set(0,0,0),1),i.applyMatrix4(r),e.ray.intersectsSphere(i)&&t.push({distance:e.ray.origin.distanceTo(s.position),object:s,point:s.position})}}class hs extends l.LineSegments{constructor(e){super();h(this,"sphere");h(this,"target");h(this,"shape");h(this,"type","VisSpotLightHelper");h(this,"cacheVector3");h(this,"cacheColor");h(this,"cacheAngle");h(this,"cacheDistance");this.geometry=new l.BufferGeometry;const t=[-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,0,0,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,-.707,0,-.707,.707,0,.707,.707,0,-.707,-.707,0,.707];this.geometry.setAttribute("position",new l.Float32BufferAttribute(t,3)),this.material=Le(),this.geometry.boundingSphere;const s=new l.BufferGeometry,r=[0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let d=0,p=1,f=32;d<f;d++,p++){const m=d/f*Math.PI*2,E=p/f*Math.PI*2;r.push(Math.cos(m),Math.sin(m),1,Math.cos(E),Math.sin(E),1)}s.setAttribute("position",new l.Float32BufferAttribute(r,3));const i=Le(),o=new l.LineSegments(s,i);o.material.color.copy(e.color).multiplyScalar(e.intensity);const c=e.distance?e.distance:1e3,u=c*Math.tan(e.angle);o.scale.set(u,u,c),o.raycast=()=>{},this.add(o),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.target=e,this.shape=o,this.sphere=new l.Sphere(new l.Vector3(0,0,0),1),this.cacheColor=e.color.getHex(),this.cacheDistance=e.distance,this.cacheAngle=e.angle,this.cacheVector3=new l.Vector3,this.onBeforeRender=()=>{const d=this.target,p=this.shape;let f=!1;if(d.distance!==this.cacheDistance&&(this.cacheDistance=d.distance,p.scale.z=d.distance,f=!0),d.angle!==this.cacheAngle&&(this.cacheAngle=d.angle,f=!0),f){const m=d.distance*Math.tan(d.angle);p.scale.set(m,m,d.distance)}d.color.getHex()!==this.cacheColor&&(p.material.color.copy(d.color).multiplyScalar(d.intensity),this.cacheColor=d.color.getHex()),p.lookAt(d.target.position)}}raycast(e,t){const s=this.target,r=s.matrixWorld,i=this.sphere;i.set(this.cacheVector3.set(0,0,0),1),i.applyMatrix4(r),e.ray.intersectsSphere(i)&&t.push({distance:e.ray.origin.distanceTo(s.position),object:s,point:s.position})}}class Oc extends l.LineSegments{constructor(e){super();h(this,"target");h(this,"type","VisCSS3DHelper");const s=e.element.getBoundingClientRect(),r=s.width,i=s.height;this.geometry=new l.EdgesGeometry(new l.PlaneBufferGeometry(r,i)),this.geometry.computeBoundingBox(),this.material=Le(),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.target=e}raycast(e,t){const s=this.target,r=s.matrixWorld,i=this.geometry.boundingBox.clone();i.applyMatrix4(r),e.ray.intersectsBox(i)&&t.push({distance:e.ray.origin.distanceTo(s.position),object:s,point:s.position})}}class Gc extends l.LineSegments{constructor(e){super();h(this,"target");h(this,"type","VisCSS3DPlaneHelper");h(this,"observer");this.geometry=new l.EdgesGeometry(new l.PlaneBufferGeometry(e.width,e.height)),this.geometry.computeBoundingBox(),this.material=Le(),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.target=e;const t=new MutationObserver(()=>{this.geometry.dispose(),this.geometry=new l.EdgesGeometry(new l.PlaneBufferGeometry(e.width,e.height)),this.geometry.computeBoundingBox()});t.observe(e.element,{attributeFilter:["style"]}),this.observer=t}dispose(){this.observer.disconnect()}}const tn=class extends l.Sprite{constructor(e){super();h(this,"target");h(this,"type","VisGroupHelper");this.target=e,this.geometry.computeBoundingBox(),this.material=new l.SpriteMaterial({map:tn.colorTexture}),this.material.depthTest=!1,this.material.depthWrite=!1,this.scale.set(5,5,5);const t=this.updateMatrixWorld.bind(this);this.updateMatrixWorld=s=>{const r=this.position,i=this.target.position;r.x=i.x,r.y=i.y,r.z=i.z,t(s)}}raycast(e,t){const s=this.matrixWorld,r=this.geometry.boundingBox.clone();if(r.applyMatrix4(s),e.ray.intersectsBox(r)){const i=this.target;t.push({distance:e.ray.origin.distanceTo(i.position),object:i,point:i.position})}}};let Rt=tn;h(Rt,"colorTexture",new l.CanvasTexture(new ze({width:512,height:512}).draw(e=>{e.beginPath(),e.fillStyle="rgba(0, 0, 0, 0)",e.fillRect(0,0,512,512),e.closePath(),e.translate(256,200),e.beginPath(),e.fillStyle="yellow",e.fillRect(-200,0,400,200),e.closePath(),e.beginPath(),e.fillStyle="yellow",e.fillRect(-200,-70,200,70),e.closePath()}).get()));const nn=class extends l.Points{constructor(e){super();h(this,"target");h(this,"cachaGeometryUUid");h(this,"type","VisLineHelper");this.target=e,this.geometry.dispose(),this.geometry.copy(e.geometry),this.cachaGeometryUUid=e.geometry.uuid,this.material=new l.PointsMaterial({color:"rgb(255, 255, 255)",alphaMap:nn.alphaTexture,transparent:!0,size:5,sizeAttenuation:!1}),this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.matrix=e.matrix,this.matrixWorld=e.matrixWorld,this.renderOrder=-1,this.raycast=()=>{},this.onBeforeRender=()=>{const t=this.target;t.geometry.uuid!==this.cachaGeometryUUid&&(this.geometry.dispose(),this.geometry=t.geometry.clone(),this.cachaGeometryUUid=t.geometry.uuid)}}};let Vt=nn;h(Vt,"alphaTexture",new l.CanvasTexture(new ze({width:512,height:512,bgColor:"rgb(0, 0, 0)"}).draw(e=>{e.beginPath(),e.fillStyle="rgb(255, 255, 255)",e.arc(256,256,200,0,Math.PI*2),e.fill(),e.closePath()}).getDom()));class bc extends l.LineSegments{constructor(e){super();h(this,"target");h(this,"type","VisMeshHelper");h(this,"cachaGeometryUUid");const t=1;this.target=e,this.geometry=new l.EdgesGeometry(e.geometry,t),this.cachaGeometryUUid=e.geometry.uuid,this.material=Le(),this.raycast=()=>{},this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.matrix=e.matrix,this.matrixWorld=e.matrixWorld,this.onBeforeRender=()=>{const s=this.target;s.geometry.uuid!==this.cachaGeometryUUid&&(this.geometry.dispose(),this.geometry=new l.EdgesGeometry(s.geometry,t),this.cachaGeometryUUid=s.geometry.uuid)}}}const sn=class extends l.Points{constructor(e){super();h(this,"target");h(this,"type","VisPointsHelper");this.target=e,this.geometry.dispose(),this.geometry.copy(e.geometry),this.material.dispose(),this.material=new l.PointsMaterial({color:"rgb(255, 255, 255)",alphaMap:sn.alphaTexture,transparent:!0});const t=Array.isArray(e.material)?e.material[0]:e.material;t instanceof l.PointsMaterial&&(this.material.size=t.size,this.material.sizeAttenuation=t.sizeAttenuation),this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.matrix=e.matrix,this.matrixWorld=e.matrixWorld,this.raycast=()=>{}}};let Xt=sn;h(Xt,"alphaTexture",new l.CanvasTexture(new ze({width:512,height:512,bgColor:"rgb(0, 0, 0)"}).draw(e=>{e.beginPath(),e.strokeStyle="rgb(255, 255, 255)",e.lineWidth=4,e.strokeRect(0,0,512,512),e.closePath()}).get()));const rn=class extends l.Sprite{constructor(e){super();h(this,"target");h(this,"type","VisSpriteHelper");this.target=e,this.material.dispose(),this.material=new l.SpriteMaterial({color:"rgb(255, 255, 255)",alphaMap:rn.alphaTexture,transparent:!0,depthWrite:!1}),this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.matrix=e.matrix,this.matrixWorld=e.matrixWorld,this.raycast=()=>{}}};let zt=rn;h(zt,"alphaTexture",new l.CanvasTexture(new ze({width:512,height:512,bgColor:"rgb(0, 0, 0)"}).draw(e=>{e.beginPath(),e.strokeStyle="rgb(255, 255, 255)",e.lineWidth=4,e.strokeRect(0,0,512,512),e.closePath()}).get()));class Ic extends re{constructor(e={}){super();h(this,"helperGenerator",{[a.CONFIGTYPE.POINTLIGHT]:ds,[a.CONFIGTYPE.SPOTLIGHT]:hs,[a.CONFIGTYPE.DIRECTIONALLIGHT]:us,[a.CONFIGTYPE.PERSPECTIVECAMERA]:Qt,[a.CONFIGTYPE.ORTHOGRAPHICCAMERA]:Qt,[a.CONFIGTYPE.MESH]:bc,[a.CONFIGTYPE.GROUP]:Rt,[a.CONFIGTYPE.SPRITE]:zt,[a.CONFIGTYPE.POINTS]:Xt,[a.CONFIGTYPE.LINE]:Vt,[a.CONFIGTYPE.CSS3DOBJECT]:Oc,[a.CONFIGTYPE.CSS3DPLANE]:Gc});h(this,"helperFilter",{AmbientLight:!0,Object3D:!0,TransformControls:!0,Scene:!0});h(this,"objectFilter",new Set);h(this,"objectHelperMap",new Map);e.helperGenerator&&(this.helperGenerator=Object.assign(this.helperGenerator,e.helperGenerator)),e.helperFilter&&(this.helperFilter=Object.assign(this.helperFilter,e.helperFilter)),e.objectFilter&&(this.objectFilter=new Set(e.objectFilter.concat(Array.from(this.objectFilter))))}addFilteredObject(...e){for(const t of e)this.objectFilter.add(t);return this}addObjectHelper(e){if(this.objectFilter.has(e)||this.objectHelperMap.has(e)||this.helperFilter[e.type]||e.type.toLocaleLowerCase().includes("helper"))return null;if(!this.helperGenerator[e.type])return console.warn(`object helper can not support this type object: '${e.type}'`),null;const t=new this.helperGenerator[e.type](e);return this.objectHelperMap.set(e,t),t}disposeObjectHelper(e){if(this.objectFilter.has(e)||this.helperFilter[e.type]||e.type.toLocaleLowerCase().includes("helper"))return null;if(!this.objectHelperMap.has(e))return console.warn("object helper manager can not found this object`s helper: ",e),null;const t=this.objectHelperMap.get(e);return t.geometry&&t.geometry.dispose(),t.material&&(t.material instanceof l.Material?t.material.dispose():t.material.forEach(s=>{s.dispose()})),this.objectHelperMap.delete(e),t}}const Lc=function(n={}){if(!this.scene)return console.error("must install some scene plugin before ObjectHelper plugin."),!1;n.interact===void 0&&(n.interact=!0),n.interact&&(this.eventManager||(console.warn("must install eventManager plugin that can use interact function."),n.interact=!1));const e=new Ic,t=new Map,s=new Map,r=new Map,i=e.objectHelperMap;this.objectHelperManager=e,!n.activeColor&&(n.activeColor="rgb(230, 20, 240)"),!n.hoverColor&&(n.hoverColor="rgb(255, 158, 240)"),!n.defaultColor&&(n.defaultColor="rgb(255, 255, 255)"),!n.selectedColor&&(n.selectedColor=n.activeColor);const o=new l.Color(n.defaultColor).getHex(),c=new l.Color(n.activeColor).getHex(),u=new l.Color(n.hoverColor).getHex(),d=new l.Color(n.selectedColor).getHex(),p=new WeakSet,f=M=>{const T=M.objects;for(const C of T){const S=e.addObjectHelper(C);if(!!S&&(S.material.color.setHex(o),this.scene.add(S),n.interact)){const y=()=>{var B;((B=this.transformControls)==null?void 0:B.dragging)||this.selectionBox&&this.selectionBox.has(C)||S.material.color.setHex(u)},R=()=>{var B;((B=this.transformControls)==null?void 0:B.dragging)||this.selectionBox&&this.selectionBox.has(C)||S.material.color.setHex(o)},P=()=>{var B;((B=this.transformControls)==null?void 0:B.dragging)||this.selectionBox&&this.selectionBox.has(C)||S.material.color.setHex(c)};C.addEventListener("pointerenter",y),C.addEventListener("pointerleave",R),C.addEventListener("click",P),t.set(C,y),s.set(C,R),r.set(C,P)}}},m=M=>{const T=M.objects;for(const C of T){const S=e.disposeObjectHelper(C);!S||(this.scene.remove(S),n.interact&&(C.removeEventListener("pointerenter",t.get(C)),C.removeEventListener("pointerleave",s.get(C)),C.removeEventListener("click",r.get(C)),t.delete(C),s.delete(C),r.delete(C)))}},E=M=>{p.has(M)||(M.traverse(T=>{const C=e.addObjectHelper(T);C&&M.add(C)}),p.add(M))};this.scene.addEventListener("afterAdd",f),this.scene.addEventListener("afterRemove",m),this.setObjectHelper=function(M){return M.show?this.scene.traverse(T=>{i.has(T)&&this.scene.add(i.get(T))}):this.scene.traverse(T=>{i.has(T)&&this.scene.remove(i.get(T))}),this},this.addEventListener("setScene",M=>{const T=M.scene;!p.has(T)&&E(T),T.hasEventListener("afterAdd",f)||T.addEventListener("afterAdd",f),T.hasEventListener("afterRemove",m)||T.addEventListener("afterRemove",m)});const A=new Set;return this.completeSet.add(()=>{this.selectionBox&&this.addEventListener("selected",M=>{A.forEach(T=>{T.material.color.setHex(o)}),A.clear();for(const T of M.objects)if(i.has(T)){const C=i.get(T);C.material.color.setHex(d),A.add(C)}})}),!0},Pc=function(n={}){if(this.selectionBox)return console.warn("engine has installed selection plugin."),!1;if(!this.eventManager)return console.warn("must install eventManager plugin before Selection plugin."),!1;this.selectionBox=new Set;const e=()=>{const t=[];this.IS_ENGINESUPPORT&&this.selectionBox.forEach(s=>{const r=this.compilerManager.getObjectSymbol(s);r?t.push(r):console.warn("selection plugin can not font vid in compilerManager.",s)}),this.dispatchEvent({type:"selected",objects:[...this.selectionBox],objectSymbols:t})};return this.setSelectionBox=function(t){this.selectionBox.clear();for(const s of t.objects)this.selectionBox.add(s);return e(),this},this.eventManager.addEventListener("click",t=>{var r,i,o;if(this.transing){this.transing=!1;return}const s=t.intersections;if(t.ctrlKey||this.selectionBox.clear(),this.eventManager.penetrate)for(const c of s){if(t.ctrlKey&&((r=this.selectionBox)==null?void 0:r.has(c.object))){this.selectionBox.delete(c.object);continue}this.selectionBox.add(c.object)}else if(s.length){const c=s[0].object;if(t.ctrlKey&&((i=this.selectionBox)==null?void 0:i.has(c))){this.selectionBox.delete(c);return}(o=this.selectionBox)==null||o.add(c)}e()}),!0},Dc=function(n={}){if(this.css3DRenderer)return console.warn("this has installed css3DRenderer plugin."),!1;this.css3DRenderer=new we.CSS3DRenderer;const e=this.css3DRenderer.domElement;if(e.classList.add("vis-css3D"),e.style.position="absolute",e.style.top="0",e.style.left="0",this.addEventListener("setDom",t=>{t.dom.appendChild(this.css3DRenderer.domElement)}),this.addEventListener("setSize",t=>{this.css3DRenderer.setSize(t.width,t.height)}),this.addEventListener("setScene",t=>{t.oldScene.traverse(r=>{r instanceof we.CSS3DObject&&(r.element.style.display="none")})}),this.renderManager)this.renderManager.removeEventListener("render",this.render),this.renderManager.addEventListener("render",t=>{this.css3DRenderer.render(this.scene,this.camera)});else if(this.webGLRenderer){const t=this.render.bind(this);this.render=function(){return t(),this.webGLRenderer.render(this.scene,this.camera),this}}else this.render=function(){return this.webGLRenderer.render(this.scene,this.camera),this};return!0};a.ENGINEPLUGIN=void 0,function(n){n.WEBGLRENDERER="WebGLRenderer",n.CSS3DRENDERER="CSS3DRenderer",n.SCENE="Scene",n.MODELINGSCENE="ModelingScene",n.RENDERMANAGER="RenderManager",n.ORBITCONTROLS="OrbitControls",n.STATS="Stats",n.EFFECTCOMPOSER="EffectComposer",n.POINTERMANAGER="PointerManager",n.EVENTMANAGER="EventManager",n.TRANSFORMCONTROLS="TransformControls",n.LOADERMANAGER="LoaderManager",n.RESOURCEMANAGER="ResourceManager",n.DATASUPPORTMANAGER="DataSupportManager",n.COMPILERMANAGER="CompilerManager",n.KEYBOARDMANAGER="KeyboardManager",n.AXESHELPER="AxesHelper",n.GRIDHELPER="GridHelper",n.VIEWPOINT="Viewpoint",n.DISPLAYMODE="DisplayMode",n.OBJECTHELPER="ObjectHelper",n.SELECTION="Selection"}(a.ENGINEPLUGIN||(a.ENGINEPLUGIN={}));const Pe=class extends re{constructor(){super();h(this,"completeSet");h(this,"camera",new l.PerspectiveCamera);h(this,"scene",new l.Scene);h(this,"IS_ENGINESUPPORT",!1);h(this,"dom");h(this,"webGLRenderer");h(this,"css3DRenderer");h(this,"orbitControls");h(this,"transformControls");h(this,"effectComposer");h(this,"renderManager");h(this,"pointerManager");h(this,"eventManager");h(this,"loaderManager");h(this,"resourceManager");h(this,"dataSupportManager");h(this,"compilerManager");h(this,"keyboardManager");h(this,"objectHelperManager");h(this,"transing");h(this,"stats");h(this,"displayMode");h(this,"selectionBox");h(this,"getScreenshot");h(this,"setStats");h(this,"setTransformControls");h(this,"setViewpoint");h(this,"setDisplayMode");h(this,"setAxesHelper");h(this,"setGridHelper");h(this,"setObjectHelper");h(this,"setSelectionBox");h(this,"loadResources");h(this,"loadResourcesAsync");h(this,"registerResources");h(this,"toJSON");h(this,"exportConfig");h(this,"applyConfig");h(this,"reactiveConfig");h(this,"getConfigBySymbol");h(this,"removeConfigBySymbol");h(this,"getObjectSymbol");h(this,"getObjectBySymbol");h(this,"play");h(this,"stop");h(this,"render");this.completeSet=new Set,this.render=function(){return console.warn("can not install some plugin"),this},this.camera.position.set(50,50,50),this.addEventListener("setSize",e=>{this.camera.aspect=e.width/e.height,this.camera.updateProjectionMatrix()})}optimizeMemory(){Object.keys(this).forEach(e=>{this[e]===void 0&&delete this[e]})}install(e,t){return Pe.pluginHandler.has(e)?Pe.pluginHandler.get(e).call(this,t):console.error(`engine can not support ${e} plugin.`),this}complete(){return this.completeSet.forEach(e=>{e(this)}),this.completeSet.clear(),this}dispose(){return this.dispatchEvent({type:"dispose"}),this}setDom(e){return this.dom=e,this.dispatchEvent({type:"setDom",dom:e}),this}setSize(e,t){var s,r;return e&&e<=0||t&&t<=0?(console.warn(`you must be input width and height bigger then zero, width: ${e}, height: ${t}`),this):(!e&&(e=((s=this.dom)==null?void 0:s.offsetWidth)||window.innerWidth),!t&&(t=((r=this.dom)==null?void 0:r.offsetHeight)||window.innerHeight),this.dispatchEvent({type:"setSize",width:e,height:t}),this)}setCamera(e,t){if(typeof e=="object"&&e instanceof l.Camera)this.camera=e,this.dispatchEvent({type:"setCamera",camera:e,options:Object.assign({orbitControls:!0,transformControls:!0},t||{})});else if(this.IS_ENGINESUPPORT){const s=this.compilerManager.getObjectBySymbol(e);s?(this.camera=s,this.dispatchEvent({type:"setCamera",camera:s,options:Object.assign({orbitControls:!0,transformControls:!0},t||{})})):console.warn(`can not found camera in compilerManager: ${e}`)}else console.warn("engine is not a Engine support but use symbol to found camera.");return this}setScene(e){if(typeof e=="object"&&e instanceof l.Scene)this.dispatchEvent({type:"setScene",scene:e,oldScene:this.scene}),this.scene=e;else if(this.IS_ENGINESUPPORT){const t=this.compilerManager.getObjectBySymbol(e);t?(this.dispatchEvent({type:"setScene",scene:t,oldScene:this.scene}),this.scene=t):console.warn(`can not found scene in compilerManager: ${e}`)}else console.warn("engine is not a Engine support but use symbol to found scene.");return this}};let N=Pe;h(N,"pluginHandler",new Map),h(N,"register",function(e,t){return Pe.pluginHandler&&Pe.pluginHandler.set(e,t),Pe}),h(N,"dispose",function(){Pe.pluginHandler=void 0}),N.register(a.ENGINEPLUGIN.WEBGLRENDERER,ks),N.register(a.ENGINEPLUGIN.CSS3DRENDERER,Dc),N.register(a.ENGINEPLUGIN.EFFECTCOMPOSER,Us),N.register(a.ENGINEPLUGIN.RENDERMANAGER,Ds),N.register(a.ENGINEPLUGIN.POINTERMANAGER,xs),N.register(a.ENGINEPLUGIN.EVENTMANAGER,js),N.register(a.ENGINEPLUGIN.LOADERMANAGER,Or),N.register(a.ENGINEPLUGIN.RESOURCEMANAGER,Yi),N.register(a.ENGINEPLUGIN.DATASUPPORTMANAGER,ho),N.register(a.ENGINEPLUGIN.COMPILERMANAGER,Tc),N.register(a.ENGINEPLUGIN.KEYBOARDMANAGER,Bc),N.register(a.ENGINEPLUGIN.ORBITCONTROLS,ws),N.register(a.ENGINEPLUGIN.TRANSFORMCONTROLS,Js),N.register(a.ENGINEPLUGIN.AXESHELPER,yc),N.register(a.ENGINEPLUGIN.GRIDHELPER,Sc),N.register(a.ENGINEPLUGIN.OBJECTHELPER,Lc),N.register(a.ENGINEPLUGIN.DISPLAYMODE,Rc),N.register(a.ENGINEPLUGIN.VIEWPOINT,Fs),N.register(a.ENGINEPLUGIN.STATS,vs),N.register(a.ENGINEPLUGIN.SELECTION,Pc);class Fc extends N{constructor(){super();this.install(a.ENGINEPLUGIN.WEBGLRENDERER,{antialias:!0,alpha:!0}).install(a.ENGINEPLUGIN.RENDERMANAGER).install(a.ENGINEPLUGIN.EFFECTCOMPOSER,{WebGLMultisampleRenderTarget:!0}).install(a.ENGINEPLUGIN.ORBITCONTROLS).install(a.ENGINEPLUGIN.POINTERMANAGER).install(a.ENGINEPLUGIN.EVENTMANAGER).complete()}}class wc extends N{constructor(){super();this.install(a.ENGINEPLUGIN.RENDERMANAGER).install(a.ENGINEPLUGIN.WEBGLRENDERER,{antialias:!0,alpha:!0}).install(a.ENGINEPLUGIN.POINTERMANAGER).install(a.ENGINEPLUGIN.EVENTMANAGER).install(a.ENGINEPLUGIN.EFFECTCOMPOSER,{WebGLMultisampleRenderTarget:!0}).install(a.ENGINEPLUGIN.SELECTION).install(a.ENGINEPLUGIN.AXESHELPER).install(a.ENGINEPLUGIN.GRIDHELPER).install(a.ENGINEPLUGIN.OBJECTHELPER).install(a.ENGINEPLUGIN.VIEWPOINT).install(a.ENGINEPLUGIN.DISPLAYMODE).install(a.ENGINEPLUGIN.STATS).install(a.ENGINEPLUGIN.ORBITCONTROLS).install(a.ENGINEPLUGIN.KEYBOARDMANAGER).install(a.ENGINEPLUGIN.TRANSFORMCONTROLS).complete()}}class Nc{constructor(){h(this,"supportData");h(this,"supportDataType")}create(e){return e?(this.supportData={},this.supportDataType=e,this):(console.warn("you must give a module type in create params"),this)}add(e){return!this.supportData||!this.supportDataType?(console.warn("you must call 'create' method before the 'add' method"),this):e.type?ke(e.type)!==this.supportDataType?(console.warn(`current generator create config which module is in: ${this.supportDataType}, but you provide type is '${e.type}'`),this):(this.supportData[e.vid]=X(e.type,e),this):(console.warn("config can not found attribute 'type'"),this)}get(){return this.supportDataType=void 0,this.supportData?this.supportData:{}}}const Zt=new l.PointLight("rgb(255, 255, 255)",.5,200,1);Zt.position.set(-30,5,20),Zt.castShadow=!0;const Ot=new l.Mesh(new l.BoxBufferGeometry(80,2,80),new l.MeshStandardMaterial({color:"rgb(255, 255, 255)"}));Ot.position.set(0,-11,0),Ot.receiveShadow=!0,Ot.castShadow=!0;const de=class{constructor(e){h(this,"material");h(this,"dom");h(this,"renderer");h(this,"scene");h(this,"camera");h(this,"object");const t=new l.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0});t.setPixelRatio(window.devicePixelRatio),t.setClearColor("rgb(150, 150, 150)"),t.shadowMap.enabled=!0,t.shadowMap.type=l.PCFSoftShadowMap;const s=new l.Scene,r=new l.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,500);r.position.set(0,0,35),r.up.x=0,r.up.y=1,r.up.z=0,r.lookAt(new l.Vector3(0,0,0)),s.add(de.ambientLight),s.add(de.pointLight),s.add(de.plane),this.scene=s,this.renderer=t,this.camera=r,this.object=new l.Object3D,(e==null?void 0:e.material)&&this.setMaterial(e.material),(e==null?void 0:e.dom)&&this.setDom(e.dom)}setMaterial(e){if(this.scene.remove(this.object),this.material=e,e.type.includes("Mesh"))this.object=new l.Mesh(de.geometry,e);else if(e.type.includes("Line"))this.object=new l.Line(de.geometry,e);else if(e.type.includes("Ponits"))this.object=new l.Points(de.geometry,e);else if(e.type.includes("Sprite"))this.object=new l.Sprite(e);else return console.warn(`material displayer can not support this type material: '${e.type}'`),this;return this.object.castShadow=!0,this.object.receiveShadow=!0,this.scene.add(this.object),this}setDom(e){return this.dom=e,this.setSize(),e.appendChild(this.renderer.domElement),this}setSize(e,t){if(e&&t)this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t,!0);else{if(!this.dom)return console.warn("material displayer must set dom before setSize with empty parameters"),this;const s=this.dom;this.camera.aspect=s.offsetWidth/s.offsetHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(s.offsetWidth,s.offsetHeight,!0)}return this}render(){this.renderer.render(this.scene,this.camera)}getDataURL(e){return this.renderer.domElement.toDataURL(e||"image/png")}dispose(){this.renderer.dispose()}};let Je=de;h(Je,"ambientLight",new l.AmbientLight("rgb(255, 255, 255)",.7)),h(Je,"pointLight",Zt),h(Je,"geometry",new l.SphereBufferGeometry(10,12,12)),h(Je,"plane",Ot),h(Je,"dispose",()=>{de.geometry.dispose(),de.plane.geometry.dispose()});const on=class{constructor(e){h(this,"dom");h(this,"texture");h(this,"renderer");h(this,"scene");h(this,"camera");const t=new l.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0});t.setPixelRatio(window.devicePixelRatio),t.setClearColor("rgb(150, 150, 150)"),t.shadowMap.enabled=!0,t.shadowMap.type=l.PCFSoftShadowMap;const s=new l.Scene,r=new l.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,500);r.position.set(0,0,35),r.up.x=0,r.up.y=1,r.up.z=0,r.lookAt(new l.Vector3(0,0,0)),s.add(on.ambientLight),this.scene=s,this.renderer=t,this.camera=r,(e==null?void 0:e.texture)&&this.setTexture(e.texture),(e==null?void 0:e.dom)&&this.setDom(e.dom)}setTexture(e){return this.scene.background=e,this}setDom(e){return this.dom=e,this.setSize(),e.appendChild(this.renderer.domElement),this}setSize(e,t){if(e&&t)this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t,!0);else{if(!this.dom)return console.warn("texture displayer must set dom before setSize with empty parameters"),this;const s=this.dom;this.camera.aspect=s.offsetWidth/s.offsetHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(s.offsetWidth,s.offsetHeight,!0)}return this}render(){this.renderer.render(this.scene,this.camera)}getDataURL(e){return this.renderer.domElement.toDataURL(e||"image/png")}dispose(){this.renderer.dispose()}};let $t=on;h($t,"ambientLight",new l.AmbientLight("rgb(255, 255, 255)",1));class qt extends N{constructor(e={},t={}){super();h(this,"IS_ENGINESUPPORT",!0);this.install(a.ENGINEPLUGIN.LOADERMANAGER).install(a.ENGINEPLUGIN.RESOURCEMANAGER,{resources:t}).install(a.ENGINEPLUGIN.POINTERMANAGER).install(a.ENGINEPLUGIN.EVENTMANAGER).install(a.ENGINEPLUGIN.RENDERMANAGER).install(a.ENGINEPLUGIN.DATASUPPORTMANAGER,e).install(a.ENGINEPLUGIN.COMPILERMANAGER)}loadLifeCycle(e){const t=this.dataSupportManager;e.texture&&t.load({texture:e.texture}),e.material&&t.load({material:e.material}),delete e.texture,delete e.material,t.load(e)}removeLifeCycle(e){const t=this.dataSupportManager,s=e[a.MODULETYPE.TEXTURE]||{},r=e[a.MODULETYPE.MATERIAL]||{},i=e.assets||[];delete e.texture,delete e.material,delete e.assets,t.remove(e),t.remove({[a.MODULETYPE.MATERIAL]:r}),t.remove({[a.MODULETYPE.TEXTURE]:s});const o=this.resourceManager,c=this.loaderManager;i.forEach(u=>{o.remove(u),c.remove(u)})}loadConfig(e,t){const s=this.renderManager.hasRendering();if(s&&this.renderManager.stop(),e.assets&&e.assets.length){const r=i=>{delete e.assets,this.loadLifeCycle(e),this.resourceManager.removeEventListener("mapped",r),t&&t(i),s?this.renderManager.play():this.renderManager.render()};this.resourceManager.addEventListener("mapped",r),this.loaderManager.reset().load(e.assets)}else this.loadLifeCycle(e),t&&t(),s?this.renderManager.play():this.renderManager.render();return this}loadConfigAsync(e){return new Promise((t,s)=>{const r=this.renderManager.hasRendering();if(r&&this.renderManager.stop(),e.assets&&e.assets.length){const i=o=>{delete e.assets,this.loadLifeCycle(e),this.resourceManager.removeEventListener("mapped",i),r?this.renderManager.play():this.renderManager.render(),t(o)};this.resourceManager.addEventListener("mapped",i),this.loaderManager.reset().load(e.assets)}else this.loadLifeCycle(e),r?this.renderManager.play():this.renderManager.render(),t(void 0)})}removeConfig(e){this.removeLifeCycle(e)}getObjectConfig(e){const t=this.getObjectSymbol(e);return t?this.getConfigBySymbol(t):null}}class vc extends qt{constructor(e){super(e);h(this,"IS_ENGINESUPPORT",!0);this.install(a.ENGINEPLUGIN.WEBGLRENDERER,{antialias:!0,alpha:!0}).install(a.ENGINEPLUGIN.EFFECTCOMPOSER,{WebGLMultisampleRenderTarget:!0}).install(a.ENGINEPLUGIN.SELECTION).install(a.ENGINEPLUGIN.AXESHELPER).install(a.ENGINEPLUGIN.GRIDHELPER).install(a.ENGINEPLUGIN.OBJECTHELPER).install(a.ENGINEPLUGIN.VIEWPOINT).install(a.ENGINEPLUGIN.DISPLAYMODE).install(a.ENGINEPLUGIN.STATS).install(a.ENGINEPLUGIN.ORBITCONTROLS).install(a.ENGINEPLUGIN.KEYBOARDMANAGER).install(a.ENGINEPLUGIN.TRANSFORMCONTROLS).complete()}}class Uc extends qt{constructor(e){super(e);this.install(a.ENGINEPLUGIN.WEBGLRENDERER,{antialias:!0,alpha:!0}).install(a.ENGINEPLUGIN.EFFECTCOMPOSER,{WebGLMultisampleRenderTarget:!0}).install(a.ENGINEPLUGIN.ORBITCONTROLS).complete()}}class Hc{constructor(e){h(this,"visible",!0);e.visible&&(this.visible=e.visible)}}class xc extends Hc{constructor(e){super(e);h(this,"source");h(this,"target");h(this,"mode");h(this,"cacheSourceMatrix");h(this,"cacheTargetMatrix");h(this,"cacheSoruceGeometryUuid");h(this,"cacheTargetGeometryUuid");h(this,"originalGeometry");h(this,"modifiedGeometry");this.source=e.source,this.target=e.target,this.mode=e.mode||"subtract",this.cacheSourceMatrix=this.source.matrix.clone(),this.cacheTargetMatrix=this.target.matrix.clone(),this.cacheSoruceGeometryUuid=this.source.geometry.uuid,this.cacheTargetGeometryUuid=this.target.geometry.uuid,this.originalGeometry=this.source.geometry,this.modifiedGeometry=new l.BufferGeometry,this.modify(),this.source.geometry=this.modifiedGeometry}async modify(){const e=this.source,t={geometry:this.originalGeometry,matrix:this.source.matrix},s=Dt.CSG.fromMesh(t),r=Dt.CSG.fromMesh(this.target),i=Dt.CSG.toGeometry(s[this.mode](r),e.matrix);this.modifiedGeometry.copy(i),this.modifiedGeometry.uuid=i.uuid}render(){if(this.visible){if(!this.cacheSourceMatrix.equals(this.source.matrix)){this.modify(),this.cacheSourceMatrix.copy(this.source.matrix);return}if(!this.cacheTargetMatrix.equals(this.target.matrix)){this.modify(),this.cacheTargetMatrix.copy(this.target.matrix);return}if(this.originalGeometry.uuid!==this.cacheSoruceGeometryUuid){this.modify(),this.cacheSoruceGeometryUuid=this.originalGeometry.uuid;return}if(this.target.geometry.uuid!==this.cacheTargetGeometryUuid){this.modify(),this.cacheTargetGeometryUuid=this.target.geometry.uuid;return}}else this.modifiedGeometry.copy(this.originalGeometry)}apply(){this.originalGeometry.copy(this.modifiedGeometry),this.originalGeometry.uuid=this.modifiedGeometry.uuid,this.source.geometry=this.originalGeometry}dispose(){this.source.geometry=this.originalGeometry,this.modifiedGeometry.dispose()}}class Yc{next(){console.warn(`this action can not set next function: ${this.constructor.name}`)}prev(){console.warn(`this action can not set prev function: ${this.constructor.name}`)}}class jc{constructor(e){h(this,"actionList",[]);h(this,"index",-1);h(this,"step",50);this.step=e||50}do(e){this.actionList[this.index][e]()}apply(e,t=!1){const s=this.actionList;this.index===s.length-1&&s.length>=this.step?(s.shift(),this.index=this.actionList.length-1):this.index!==-1?s.splice(this.index+1,s.length-1):this.index===-1&&(this.actionList=[]),this.actionList.push(e),t?this.redo():this.index+=1}redo(){if(this.index+=1,this.index>this.actionList.length-1){this.index=this.actionList.length-1;return}this.do("next")}undo(){this.index<0||(this.do("prev"),this.index-=1)}clear(){this.actionList=[]}}const Jc="0.2.3";window.__THREE__||console.error("vis-three dependent on three.js module, pleace run 'npm i three' first."),window.__VIS__?console.warn("Duplicate vis-three frames are introduced"):window.__VIS__=Jc,l.Scene.prototype.add=function(...n){if(!arguments.length)return this;if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}const e=n[0];if(e===this)return console.error("THREE.Object3D.add: object can't be added as a child of itself.",n),this;if(e&&e.isObject3D){if(e.parent!==null){const t=this.children.indexOf(e);t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent({type:"removed"}))}e.parent=this,this.children.push(e),e.dispatchEvent({type:"added"})}else console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",n);return this};const kc=l.Scene.prototype.add,_c=l.Scene.prototype.remove;l.Scene.prototype.add=function(...n){return kc.call(this,...n),this.dispatchEvent({type:"afterAdd",objects:n}),this},l.Scene.prototype.remove=function(...n){return _c.call(this,...n),this.dispatchEvent({type:"afterRemove",objects:n}),this};const en=new Ls.LightShadow(new l.OrthographicCamera(-256,256,256,-256));en.autoUpdate=!1,en.needsUpdate=!1,l.AmbientLight.prototype.shadow=en,a.Action=Yc,a.AniScriptLibrary=Se,a.AnimationDataSupport=zn,a.BooleanModifier=xc,a.CONFIGMODULE=Gr,a.CSS3DDataSupport=Zn,a.CSS3DPlane=ns,a.CameraDataSupport=Yn,a.CameraHelper=Qt,a.CanvasGenerator=ze,a.ControlsDataSupport=kn,a.DataSupportManager=$n,a.DirectionalLightHelper=us,a.DisplayEngine=Fc,a.DisplayEngineSupport=Uc,a.Engine=N,a.EngineSupport=qt,a.EventDispatcher=re,a.EventLibrary=v,a.GeometryDataSupport=xn,a.GroupDataSupport=Vn,a.GroupHelper=Rt,a.History=jc,a.JSONHandler=ji,a.KeyboardManager=ls,a.LightDataSupport=Hn,a.LineDataSupport=Kn,a.LoaderManager=On,a.MaterialDataSupport=Un,a.MaterialDisplayer=Je,a.MeshDataSupport=Wn,a.ModelingEngine=wc,a.ModelingEngineSupport=vc,a.PassDataSupport=Xn,a.PointLightHelper=ds,a.PointsDataSupport=Qn,a.ProxyBroadcast=_e,a.RenderManager=fn,a.RendererDataSupport=jn,a.ResourceManager=Fn,a.SceneDataSupport=Jn,a.SelectiveBloomPass=rt,a.ShaderLibrary=ee,a.SpotLightHelper=hs,a.SpriteDataSupport=_n,a.SupportDataGenerator=Nc,a.TextureDataSupport=vn,a.TextureDisplayer=$t,a.Translater=Nn,a.Utils=vi,a.VideoLoader=Ne,a.generateConfig=X,a.getModule=ke,Object.defineProperty(a,"__esModule",{value:!0}),a[Symbol.toStringTag]="Module"});
