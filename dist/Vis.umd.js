var wa=Object.defineProperty,Ia=Object.defineProperties;var Ra=Object.getOwnPropertyDescriptors;var Bn=Object.getOwnPropertySymbols;var Na=Object.prototype.hasOwnProperty,Ga=Object.prototype.propertyIsEnumerable;var Bt=(r,u,k)=>u in r?wa(r,u,{enumerable:!0,configurable:!0,writable:!0,value:k}):r[u]=k,Y=(r,u)=>{for(var k in u||(u={}))Na.call(u,k)&&Bt(r,k,u[k]);if(Bn)for(var k of Bn(u))Ga.call(u,k)&&Bt(r,k,u[k]);return r},Ht=(r,u)=>Ia(r,Ra(u));var a=(r,u,k)=>(Bt(r,typeof u!="symbol"?u+"":u,k),k);(function(r,u){typeof exports=="object"&&typeof module!="undefined"?u(exports,require("three"),require("three/examples/jsm/libs/stats.module"),require("three/examples/jsm/postprocessing/EffectComposer"),require("three/examples/jsm/postprocessing/RenderPass"),require("three/examples/jsm/controls/TransformControls"),require("three/examples/jsm/loaders/OBJLoader"),require("three/examples/jsm/loaders/MTLLoader"),require("uuid"),require("three/examples/jsm/renderers/CSS3DRenderer"),require("@tweenjs/tween.js"),require("three/examples/jsm/postprocessing/SMAAPass"),require("three/examples/jsm/postprocessing/UnrealBloomPass"),require("three/examples/jsm/postprocessing/Pass"),require("three/examples/jsm/shaders/LuminosityHighPassShader"),require("keyboardjs"),require("three-csg-ts"),require("three/src/lights/LightShadow")):typeof define=="function"&&define.amd?define(["exports","three","three/examples/jsm/libs/stats.module","three/examples/jsm/postprocessing/EffectComposer","three/examples/jsm/postprocessing/RenderPass","three/examples/jsm/controls/TransformControls","three/examples/jsm/loaders/OBJLoader","three/examples/jsm/loaders/MTLLoader","uuid","three/examples/jsm/renderers/CSS3DRenderer","@tweenjs/tween.js","three/examples/jsm/postprocessing/SMAAPass","three/examples/jsm/postprocessing/UnrealBloomPass","three/examples/jsm/postprocessing/Pass","three/examples/jsm/shaders/LuminosityHighPassShader","keyboardjs","three-csg-ts","three/src/lights/LightShadow"],u):(r=typeof globalThis!="undefined"?globalThis:r||self,u(r.Vis={},r.three,r.Stats,r.EffectComposer,r.RenderPass,r.TransformControls,r.OBJLoader,r.MTLLoader,r.uuid,r.CSS3DRenderer,r.tween_js,r.SMAAPass,r.UnrealBloomPass,r.Pass,r.LuminosityHighPassShader,r.keyboardjs,r.threeCsgTs,r.LightShadow))})(this,function(r,u,k,lt,ut,Hn,xn,zn,Z,Ye,N,kn,Vn,xt,zt,$n,dt,Wn){"use strict";function kt(n){return n&&typeof n=="object"&&"default"in n?n:{default:n}}var _n=kt(k),Ve=kt($n);class J{constructor(){a(this,"listeners",new Map)}addEventListener(e,t){const i=this.listeners;i.has(e)||i.set(e,new Set),i.get(e).add(t)}hasEventListener(e,t){const i=this.listeners;return i.has(e)?i.get(e).has(t):!1}removeEventListener(e,t){const i=this.listeners;!i.has(e)||!i.get(e).has(t)||i.get(e).delete(t)}dispatchEvent(e){var o;const t=e.type,i=this.listeners;if(i.has(t))try{(o=i.get(t))==null||o.forEach(s=>{s.call(this,e)})}catch(s){console.error(s)}}clear(){this.listeners=new Map}useful(){return Boolean([...this.listeners.keys()].length)}}class Vt extends J{constructor(e=0){super();a(this,"clock",new u.Clock);a(this,"animationFrame",-1);a(this,"fps",0);a(this,"timer",null);a(this,"playFun",()=>{});a(this,"render",()=>{this.dispatchEvent({type:"render",delta:this.clock.getDelta(),total:this.clock.getElapsedTime()})});a(this,"play",()=>{if(this.hasRendering()){console.warn("render manager is rendering.");return}this.dispatchEvent({type:"play"}),this.playFun()});a(this,"stop",()=>{this.animationFrame!==-1&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=-1),this.timer&&(clearTimeout(this.timer),this.timer=null),this.dispatchEvent({type:"stop"})});a(this,"hasRendering",()=>Boolean(this.animationFrame!==-1||this.timer));a(this,"hasVaildRender",()=>this.useful());this.setFPS(e)}setFPS(e){return this.animationFrame!==-1&&cancelAnimationFrame(this.animationFrame),this.timer&&clearTimeout(this.timer),this.fps=e,e<=0?(this.fps=0,this.playFun=()=>{this.render(),this.animationFrame=requestAnimationFrame(this.playFun)}):this.playFun=()=>{this.timer=setTimeout(()=>{this.playFun()},e),this.render()},this.playFun(),this}dispose(){this.hasRendering()&&this.stop(),this.clear()}}const Qn=function(){return this.renderManager?(console.warn("has installed render manager plugin."),!1):(this.renderManager=new Vt,this.render=function(){return this.renderManager.render(),this},this.play=function(){return this.renderManager.play(),this},this.stop=function(){return this.renderManager.stop(),this},this.addEventListener("dispose",()=>{this.renderManager.dispose()}),!0)};class Xn extends J{constructor(e,t){super();a(this,"object");a(this,"domElement");a(this,"enabled",!0);a(this,"target",new u.Vector3);a(this,"minDistance",0);a(this,"maxDistance",1/0);a(this,"minZoom",0);a(this,"maxZoom",1/0);a(this,"minPolarAngle",0);a(this,"maxPolarAngle",Math.PI);a(this,"minAzimuthAngle",-1/0);a(this,"maxAzimuthAngle",1/0);a(this,"enableDamping",!1);a(this,"dampingFactor",.05);a(this,"enableZoom",!0);a(this,"zoomSpeed",1);a(this,"enableRotate",!0);a(this,"rotateSpeed",1);a(this,"enablePan",!0);a(this,"panSpeed",1);a(this,"screenSpacePanning",!0);a(this,"keyPanSpeed",7);a(this,"autoRotate",!1);a(this,"autoRotateSpeed",2);a(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"});a(this,"mouseButtons",{LEFT:null,MIDDLE:u.MOUSE.DOLLY,RIGHT:u.MOUSE.ROTATE});a(this,"touches",{ONE:u.TOUCH.ROTATE,TWO:u.TOUCH.DOLLY_PAN});a(this,"target0");a(this,"position0");a(this,"zoom0");a(this,"_domElementKeyEvents",null);a(this,"spherical");a(this,"reset");a(this,"update");a(this,"onContextMenu");a(this,"onPointerDown");a(this,"onPointerCancel");a(this,"onMouseWheel");a(this,"onPointerMove");a(this,"onPointerUp");a(this,"onKeyDown");this.object=e||new u.PerspectiveCamera,this.domElement=t||document.createElement("div"),this.domElement.style.touchAction="none",this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.update=(()=>{const p=new u.Vector3,S=new u.Quaternion().setFromUnitVectors(this.object.up,new u.Vector3(0,1,0)),F=S.clone().invert(),z=new u.Vector3,Ee=new u.Quaternion,ye=2*Math.PI;return()=>{const jn=this.object.position;p.copy(jn).sub(this.target),p.applyQuaternion(S),c.setFromVector3(p),this.autoRotate&&o===i.NONE&&w(E()),this.enableDamping?(c.theta+=l.theta*this.dampingFactor,c.phi+=l.phi*this.dampingFactor):(c.theta+=l.theta,c.phi+=l.phi);let ae=this.minAzimuthAngle,ce=this.maxAzimuthAngle;return isFinite(ae)&&isFinite(ce)&&(ae<-Math.PI?ae+=ye:ae>Math.PI&&(ae-=ye),ce<-Math.PI?ce+=ye:ce>Math.PI&&(ce-=ye),ae<=ce?c.theta=Math.max(ae,Math.min(ce,c.theta)):c.theta=c.theta>(ae+ce)/2?Math.max(ae,c.theta):Math.min(ce,c.theta)),c.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,c.phi)),c.makeSafe(),c.radius*=h,c.radius=Math.max(this.minDistance,Math.min(this.maxDistance,c.radius)),this.enableDamping===!0?this.target.addScaledVector(d,this.dampingFactor):this.target.add(d),p.setFromSpherical(c),p.applyQuaternion(F),jn.copy(this.target).add(p),this.object.lookAt(this.target),this.enableDamping===!0?(l.theta*=1-this.dampingFactor,l.phi*=1-this.dampingFactor,d.multiplyScalar(1-this.dampingFactor)):(l.set(0,0,0),d.set(0,0,0)),h=1,m||z.distanceToSquared(this.object.position)>s||8*(1-Ee.dot(this.object.quaternion))>s?(this.dispatchEvent({type:"change"}),z.copy(this.object.position),Ee.copy(this.object.quaternion),m=!1,!0):!1}})();const i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let o=i.NONE;const s=1e-6,c=new u.Spherical,l=new u.Spherical;let h=1;const d=new u.Vector3;let m=!1;const f=new u.Vector2,y=new u.Vector2,g=new u.Vector2,M=new u.Vector2,C=new u.Vector2,O=new u.Vector2,T=new u.Vector2,P=new u.Vector2,R=new u.Vector2,L=[],H={},E=()=>2*Math.PI/60/60*this.autoRotateSpeed,x=()=>Math.pow(.95,this.zoomSpeed),w=p=>{l.theta-=p},v=p=>{l.phi-=p},Ln=function(){const p=new u.Vector3;return function(F,z){p.setFromMatrixColumn(z,0),p.multiplyScalar(-F),d.add(p)}}(),vn=(()=>{const p=new u.Vector3;return(S,F)=>{this.screenSpacePanning===!0?p.setFromMatrixColumn(F,1):(p.setFromMatrixColumn(F,0),p.crossVectors(this.object.up,p)),p.multiplyScalar(S),d.add(p)}})(),Fe=(()=>{const p=new u.Vector3;return(S,F)=>{const z=this.domElement;if(this.object instanceof u.PerspectiveCamera){const Ee=this.object.position;p.copy(Ee).sub(this.target);let ye=p.length();ye*=Math.tan(this.object.fov/2*Math.PI/180),Ln(2*S*ye/z.clientHeight,this.object.matrix),vn(2*F*ye/z.clientHeight,this.object.matrix)}else this.object instanceof u.OrthographicCamera?(Ln(S*(this.object.right-this.object.left)/this.object.zoom/z.clientWidth,this.object.matrix),vn(F*(this.object.top-this.object.bottom)/this.object.zoom/z.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}})(),Ft=p=>{this.object instanceof u.PerspectiveCamera?h/=p:this.object instanceof u.OrthographicCamera?(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*p)),this.object.updateProjectionMatrix(),m=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)},Pn=p=>{this.object instanceof u.PerspectiveCamera?h*=p:this.object instanceof u.OrthographicCamera?(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/p)),this.object.updateProjectionMatrix(),m=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)};function wn(p){f.set(p.clientX,p.clientY)}function da(p){T.set(p.clientX,p.clientY)}function In(p){M.set(p.clientX,p.clientY)}const ha=p=>{y.set(p.clientX,p.clientY),g.subVectors(y,f).multiplyScalar(this.rotateSpeed);const S=this.domElement;w(2*Math.PI*g.x/S.clientHeight),v(2*Math.PI*g.y/S.clientHeight),f.copy(y),this.update()},pa=p=>{P.set(p.clientX,p.clientY),R.subVectors(P,T),R.y>0?Ft(x()):R.y<0&&Pn(x()),T.copy(P),this.update()},ma=p=>{C.set(p.clientX,p.clientY),O.subVectors(C,M).multiplyScalar(this.panSpeed),Fe(O.x,O.y),M.copy(C),this.update()},fa=p=>{p.deltaY<0?Pn(x()):p.deltaY>0&&Ft(x()),this.update()},ga=p=>{let S=!1;switch(p.code){case this.keys.UP:Fe(0,this.keyPanSpeed),S=!0;break;case this.keys.BOTTOM:Fe(0,-this.keyPanSpeed),S=!0;break;case this.keys.LEFT:Fe(this.keyPanSpeed,0),S=!0;break;case this.keys.RIGHT:Fe(-this.keyPanSpeed,0),S=!0;break}S&&(p.preventDefault(),this.update())};function Rn(){if(L.length===1)f.set(L[0].pageX,L[0].pageY);else{const p=.5*(L[0].pageX+L[1].pageX),S=.5*(L[0].pageY+L[1].pageY);f.set(p,S)}}function Nn(){if(L.length===1)M.set(L[0].pageX,L[0].pageY);else{const p=.5*(L[0].pageX+L[1].pageX),S=.5*(L[0].pageY+L[1].pageY);M.set(p,S)}}function Gn(){const p=L[0].pageX-L[1].pageX,S=L[0].pageY-L[1].pageY,F=Math.sqrt(p*p+S*S);T.set(0,F)}const Ea=()=>{this.enableZoom&&Gn(),this.enablePan&&Nn()},ya=()=>{this.enableZoom&&Gn(),this.enableRotate&&Rn()},An=p=>{if(L.length==1)y.set(p.pageX,p.pageY);else{const F=jt(p),z=.5*(p.pageX+F.x),Ee=.5*(p.pageY+F.y);y.set(z,Ee)}g.subVectors(y,f).multiplyScalar(this.rotateSpeed);const S=this.domElement;w(2*Math.PI*g.x/S.clientHeight),v(2*Math.PI*g.y/S.clientHeight),f.copy(y)},Dn=p=>{if(L.length===1)C.set(p.pageX,p.pageY);else{const S=jt(p),F=.5*(p.pageX+S.x),z=.5*(p.pageY+S.y);C.set(F,z)}O.subVectors(C,M).multiplyScalar(this.panSpeed),Fe(O.x,O.y),M.copy(C)},Un=p=>{const S=jt(p),F=p.pageX-S.x,z=p.pageY-S.y,Ee=Math.sqrt(F*F+z*z);P.set(0,Ee),R.set(0,Math.pow(P.y/T.y,this.zoomSpeed)),Ft(R.y),T.copy(P)},Ma=p=>{this.enableZoom&&Un(p),this.enablePan&&Dn(p)},Ta=p=>{this.enableZoom&&Un(p),this.enableRotate&&An(p)};this.onPointerDown=p=>{this.enabled!==!1&&(L.length===0&&(this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp)),Pa(p),p.pointerType==="touch"?ba(p):Sa(p))};let Yt=!1;this.onPointerMove=p=>{this.enabled!==!1&&(Yt||(this.domElement.setPointerCapture(p.pointerId),Yt=!0),p.pointerType==="touch"?La(p):Oa(p))},this.onPointerUp=p=>{this.enabled!==!1&&(Yt=!1,p.pointerType==="touch"?va():Ca(p),Fn(p),L.length===0&&(this.domElement.releasePointerCapture(p.pointerId),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)))},this.onPointerCancel=p=>{Fn(p)};const Sa=p=>{let S;switch(p.button){case 0:S=this.mouseButtons.LEFT;break;case 1:S=this.mouseButtons.MIDDLE;break;case 2:S=this.mouseButtons.RIGHT;break;default:S=-1}switch(S){case u.MOUSE.DOLLY:if(this.enableZoom===!1)return;da(p),o=i.DOLLY;break;case u.MOUSE.ROTATE:if(p.ctrlKey||p.metaKey||p.shiftKey){if(this.enablePan===!1)return;In(p),o=i.PAN}else{if(this.enableRotate===!1)return;wn(p),o=i.ROTATE}break;case u.MOUSE.PAN:if(p.ctrlKey||p.metaKey||p.shiftKey){if(this.enableRotate===!1)return;wn(p),o=i.ROTATE}else{if(this.enablePan===!1)return;In(p),o=i.PAN}break;default:o=i.NONE}o!==i.NONE&&this.dispatchEvent({type:"start"})},Oa=p=>{if(this.enabled!==!1)switch(o){case i.ROTATE:if(this.enableRotate===!1)return;ha(p);break;case i.DOLLY:if(this.enableZoom===!1)return;pa(p);break;case i.PAN:if(this.enablePan===!1)return;ma(p);break}},Ca=p=>{this.dispatchEvent({type:"end"}),o=i.NONE};this.onMouseWheel=p=>{this.enabled===!1||this.enableZoom===!1||o!==i.NONE||(p.preventDefault(),this.dispatchEvent({type:"start"}),fa(p),this.dispatchEvent({type:"end"}))},this.onKeyDown=p=>{this.enabled===!1||this.enablePan===!1||ga(p)};const ba=p=>{switch(Yn(p),L.length){case 1:switch(this.touches.ONE){case u.TOUCH.ROTATE:if(this.enableRotate===!1)return;Rn(),o=i.TOUCH_ROTATE;break;case u.TOUCH.PAN:if(this.enablePan===!1)return;Nn(),o=i.TOUCH_PAN;break;default:o=i.NONE}break;case 2:switch(this.touches.TWO){case u.TOUCH.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;Ea(),o=i.TOUCH_DOLLY_PAN;break;case u.TOUCH.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;ya(),o=i.TOUCH_DOLLY_ROTATE;break;default:o=i.NONE}break;default:o=i.NONE}o!==i.NONE&&this.dispatchEvent({type:"start"})},La=p=>{switch(Yn(p),o){case i.TOUCH_ROTATE:if(this.enableRotate===!1)return;An(p),this.update();break;case i.TOUCH_PAN:if(this.enablePan===!1)return;Dn(p),this.update();break;case i.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;Ma(p),this.update();break;case i.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;Ta(p),this.update();break;default:o=i.NONE}},va=p=>{this.dispatchEvent({type:"end"}),o=i.NONE};this.onContextMenu=p=>{this.enabled!==!1&&p.preventDefault()};function Pa(p){L.push(p)}const Fn=p=>{delete H[p.pointerId];for(let S=0;S<L.length;S++)if(L[S].pointerId==p.pointerId){L.splice(S,1);return}};function Yn(p){let S=H[p.pointerId];S===void 0&&(S=new u.Vector2,H[p.pointerId]=S),S.set(p.pageX,p.pageY)}function jt(p){const S=p.pointerId===L[0].pointerId?L[1]:L[0];return H[S.pointerId]}this.spherical=c,this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),this.domElement.addEventListener("wheel",this.onMouseWheel,{passive:!1}),this.reset=()=>{this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent({type:"change"}),this.update(),o=i.NONE},this.update()}getPolarAngle(){return this.spherical.phi}getAzimuthalAngle(){return this.spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this.onKeyDown),this._domElementKeyEvents=e}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}setCamera(e){this.object=e}setDom(e){this.dispose(),this.domElement=e,this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),this.domElement.addEventListener("wheel",this.onMouseWheel,{passive:!1})}dispose(){this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("pointercancel",this.onPointerCancel),this.domElement.removeEventListener("wheel",this.onMouseWheel),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp),this._domElementKeyEvents!==null&&this._domElementKeyEvents.removeEventListener("keydown",this.onKeyDown)}}r.VIEWPOINT=void 0,function(n){n.DEFAULT="default",n.TOP="top",n.BOTTOM="bottom",n.LEFT="left",n.RIGHT="right",n.FRONT="front",n.BACK="back"}(r.VIEWPOINT||(r.VIEWPOINT={}));const Kn=function(n={}){var o;if(!this.webGLRenderer)return console.error("must install some renderer before BasicViewpoint plugin."),!1;!n.viewpoint&&(n.viewpoint=r.VIEWPOINT.DEFAULT),!n.perspective&&(n.perspective={}),!n.perspective.position&&(n.perspective.position={x:60,y:60,z:60}),!n.perspective.lookAt&&(n.perspective.lookAt={x:0,y:0,z:0}),!n.perspective.up&&(n.perspective.up={x:0,y:1,z:0}),!n.orthograpbic&&(n.orthograpbic={}),!n.orthograpbic.up&&(n.orthograpbic.up={x:0,y:1,z:0});const e=new u.PerspectiveCamera;e.position.set(n.perspective.position.x,n.perspective.position.y,n.perspective.position.z),e.lookAt(n.perspective.lookAt.x,n.perspective.lookAt.y,n.perspective.lookAt.z),e.up.set(n.perspective.up.x,n.perspective.up.y,n.perspective.up.z);const t=n.orthograpbic.distance||1e4,i=new u.OrthographicCamera(-window.innerWidth/8,window.innerWidth/8,-window.innerHeight/8,window.innerHeight/8,0,t);return i.up.set(n.perspective.up.x,n.perspective.up.y,n.perspective.up.z),this.setViewpoint=function(s){return this.dispatchEvent({type:"setViewpoint",viewpoint:s}),this},this.addEventListener("setSize",s=>{const c=s.width,l=s.height,h=c/l;e.aspect=h,e.updateProjectionMatrix(),i.left=-t*h,i.right=t*h,i.top=t,i.bottom=-t,i.zoom=t/l*5,i.updateProjectionMatrix()}),(o=n.orthograpbic.allowRotate)!=null,this.addEventListener("setViewpoint",s=>{const c=s.viewpoint;if(c===r.VIEWPOINT.DEFAULT){this.setCamera(e);return}c===r.VIEWPOINT.TOP?i.position.set(0,t/2,0):c===r.VIEWPOINT.BOTTOM?i.position.set(0,-t/2,0):c===r.VIEWPOINT.RIGHT?i.position.set(t/2,0,0):c===r.VIEWPOINT.LEFT?i.position.set(-t/2,0,0):c===r.VIEWPOINT.FRONT?i.position.set(0,0,t/2):c===r.VIEWPOINT.BACK&&i.position.set(0,0,-t/2),this.setCamera(i)}),this.completeSet.add(()=>{n.viewpoint===r.VIEWPOINT.DEFAULT?this.setCamera(e):this.setCamera(i),this.objectHelperManager&&this.objectHelperManager.addFilteredObject(e,i)}),!0},Zn=function(n){return this.orbitControls?(console.warn("this has installed orbitControls plugin."),!1):this.renderManager?(this.orbitControls=new Xn(this.camera,this.dom),this.addEventListener("setCamera",e=>{e.options.orbitControls&&this.orbitControls.setCamera(e.camera)}),this.addEventListener("setDom",e=>{this.orbitControls.setDom(e.dom)}),this.renderManager.addEventListener("render",()=>{this.orbitControls.update()}),this.completeSet.add(()=>{this.setViewpoint&&this.addEventListener("setViewpoint",e=>{const t=e.viewpoint;this.orbitControls.target.set(0,0,0),t===r.VIEWPOINT.DEFAULT?this.orbitControls.enableRotate=!0:t===r.VIEWPOINT.TOP?this.orbitControls.enableRotate=!1:t===r.VIEWPOINT.BOTTOM?this.orbitControls.enableRotate=!1:t===r.VIEWPOINT.RIGHT?this.orbitControls.enableRotate=!1:t===r.VIEWPOINT.LEFT?this.orbitControls.enableRotate=!1:t===r.VIEWPOINT.FRONT?this.orbitControls.enableRotate=!1:t===r.VIEWPOINT.BACK&&(this.orbitControls.enableRotate=!1)})}),!0):(console.warn("this must install renderManager before install orbitControls plugin."),!1)};class Jn{constructor(e){a(this,"REVISION");a(this,"dom");a(this,"addPanel");a(this,"showPanel");a(this,"begin");a(this,"end");a(this,"update");a(this,"domElement");a(this,"setMode");const t=_n.default();this.REVISION=t.REVISION,this.dom=t.dom,this.domElement=t.domElement,this.begin=t.begin.bind(t),this.end=t.end.bind(t),this.update=t.update.bind(t),this.addPanel=t.addPanel.bind(t),this.showPanel=t.showPanel.bind(t),this.setMode=t.setMode.bind(t);const i=this.domElement;i.style.position="absolute",i.style.top="0",i.style.left="35px",e&&(i.style.top=`${e.top}px`,i.style.left=`${e.left}px`,i.style.right=`${e.right}px`,i.style.bottom=`${e.bottom}px`)}}const qn=function(n){if(this.stats)return console.warn("this has installed stats plugin."),!1;if(!this.renderManager)return console.warn("this must install renderManager before install stats plugin."),!1;const e=new Jn(n);this.stats=e;const t=()=>{this.stats.update()};return this.setStats=function(i){if(i)this.dom.appendChild(this.stats.domElement),this.renderManager.addEventListener("render",t);else try{this.dom.removeChild(this.stats.domElement),this.renderManager.removeEventListener("render",t)}catch{}return this},!0},ei=function(n={}){if(this.effectComposer)return console.warn("this has installed effect composer plugin."),!1;if(!this.webGLRenderer)return console.error("must install some renderer before this plugin."),!1;let e;if(n.WebGLMultisampleRenderTarget||n.MSAA){const i=this.webGLRenderer,o=i.getPixelRatio(),s=i.getDrawingBufferSize(new u.Vector2);Number(window.__THREE__)>137?e=new lt.EffectComposer(i,new u.WebGLRenderTarget(s.width*o,s.height*o,{format:n.format||u.RGBAFormat,samples:n.samples||4})):e=new lt.EffectComposer(i,new u.WebGLMultisampleRenderTarget(s.width*o,s.height*o,{format:n.format||u.RGBAFormat}))}else e=new lt.EffectComposer(this.webGLRenderer);this.effectComposer=e;let t;return this.scene&&this.camera&&(t=new ut.RenderPass(this.scene,this.camera),e.addPass(t)),this.addEventListener("setCamera",i=>{if(!t&&this.scene){t=new ut.RenderPass(this.scene,i.camera),e.addPass(t);return}else t&&(t.camera=i.camera)}),this.addEventListener("setScene",i=>{if(!t&&this.camera){t=new ut.RenderPass(i.scene,this.camera),e.addPass(t);return}else t&&(t.scene=i.scene)}),this.addEventListener("setSize",i=>{e.setSize(i.width,i.height)}),this.renderManager?(this.renderManager.removeEventListener("render",this.render),this.renderManager.addEventListener("render",i=>{this.effectComposer.render(i.delta)})):this.render=function(){return this.effectComposer.render(),this},!0};class ti extends J{constructor(e){super();a(this,"dom");a(this,"mouse");a(this,"canMouseMove");a(this,"mouseEventTimer");a(this,"throttleTime");a(this,"pointerDownHandler");a(this,"pointerMoveHandler");a(this,"pointerUpHandler");a(this,"mouseDownHandler");a(this,"mouseUpHandler");a(this,"clickHandler");a(this,"dblclickHandler");a(this,"contextmenuHandler");this.dom=e.dom,this.mouse=new u.Vector2,this.canMouseMove=!0,this.mouseEventTimer=null,this.throttleTime=e.throttleTime||1e3/60;const t=o=>{const s={mouse:{x:this.mouse.x,y:this.mouse.y}};for(const c in o)s[c]=o[c];return s},i=o=>{this.dispatchEvent(t(o))};this.pointerMoveHandler=o=>{!this.canMouseMove||(this.canMouseMove=!1,this.mouseEventTimer=window.setTimeout(()=>{const s=this.mouse,c=this.dom,l=c.getBoundingClientRect();s.x=(o.clientX-l.left)/c.offsetWidth*2-1,s.y=-((o.clientY-l.top)/c.offsetHeight)*2+1,this.canMouseMove=!0,this.dispatchEvent(t(o))},this.throttleTime))},this.mouseDownHandler=i,this.mouseUpHandler=i,this.pointerDownHandler=i,this.pointerUpHandler=i,this.clickHandler=i,this.dblclickHandler=i,this.contextmenuHandler=i}setDom(e){if(this.dom){const t=this.dom;t.removeEventListener("mousedown",this.mouseDownHandler),t.removeEventListener("mouseup",this.mouseUpHandler),t.removeEventListener("pointerdown",this.pointerDownHandler),t.removeEventListener("pointermove",this.pointerMoveHandler),t.removeEventListener("pointerup",this.pointerUpHandler),t.removeEventListener("click",this.clickHandler),t.removeEventListener("dblclick",this.dblclickHandler),t.removeEventListener("contextmenu",this.contextmenuHandler)}return e.addEventListener("mousedown",this.mouseDownHandler),e.addEventListener("mouseup",this.mouseUpHandler),e.addEventListener("pointerdown",this.pointerDownHandler),e.addEventListener("pointermove",this.pointerMoveHandler),e.addEventListener("pointerup",this.pointerUpHandler),e.addEventListener("click",this.clickHandler),e.addEventListener("dblclick",this.dblclickHandler),e.addEventListener("contextmenu",this.contextmenuHandler),this.dom=e,this}getNormalMouse(){return this.mouse}}const ni=function(n){if(this.pointerManager)return console.warn("this has installed pointerManager plugin."),!1;const e=new ti(Object.assign(n||{},{dom:this.dom}));return this.addEventListener("setDom",t=>{e.setDom(t.dom)}),this.pointerManager=e,!0};r.EVENTNAME=void 0,function(n){n.POINTERDOWN="pointerdown",n.POINTERUP="pointerup",n.POINTERMOVE="pointermove",n.POINTERENTER="pointerenter",n.POINTERLEAVE="pointerleave",n.CLICK="click",n.DBLCLICK="dblclick",n.CONTEXTMENU="contextmenu"}(r.EVENTNAME||(r.EVENTNAME={}));class ii extends J{constructor(e){super();a(this,"raycaster");a(this,"scene");a(this,"camera");a(this,"filter",new Set);a(this,"recursive",!1);a(this,"penetrate",!1);a(this,"propagation",!1);a(this,"delegation",!1);this.raycaster=new u.Raycaster,this.camera=e.camera,this.scene=e.scene,e.recursive&&(this.recursive=e.recursive),e.penetrate&&(this.penetrate=e.penetrate)}setScene(e){return this.scene=e,this}setCamera(e){return this.camera=e,this}addFilterObject(e){return this.filter.add(e),this}removeFilterObject(e){return this.filter.delete(e),this}intersectObject(e){this.raycaster.setFromCamera(e,this.camera);const t=this.filter,i=this.scene.children.filter(o=>!t.has(o));return this.raycaster.intersectObjects(i,this.recursive)}use(e){const t=function(l,h){return Object.assign({},l,h)},i=(l,h)=>{const d=this.intersectObject(l.mouse);if(d.length)if(this.penetrate)for(const m of d)m.object.dispatchEvent(t(l,{type:h,intersection:m}));else{const m=d[0];m.object.dispatchEvent(t(l,{type:h,intersection:m}))}this.dispatchEvent(t(l,{type:h,intersections:d}))},o=["pointerdown","pointerup","mousedown","mouseup","pointermove","click","dblclick","contextmenu"];for(const l of o)e.addEventListener(l,h=>{i(h,l)});const s=new Map;let c=null;return e.addEventListener("pointermove",l=>{const h=this.intersectObject(l.mouse);if(this.penetrate){if(!h.length){s.forEach(d=>{d.object.dispatchEvent(t(l,{type:"pointerleave",intersection:d})),d.object.dispatchEvent(t(l,{type:"mouseleave",intersection:d}))}),s.clear();return}for(const d of h)s.has(d.object)?(d.object.dispatchEvent(t(l,{type:"pointermove",intersection:d})),d.object.dispatchEvent(t(l,{type:"mousemove",intersection:d})),s.delete(d.object)):(d.object.dispatchEvent(t(l,{type:"pointerenter",intersection:d})),d.object.dispatchEvent(t(l,{type:"mouseenter",intersection:d})));for(const d of s.values())d.object.dispatchEvent(t(l,{type:"pointerleave",intersection:d})),d.object.dispatchEvent(t(l,{type:"mouseleave",intersection:d}));s.clear();for(const d of h)s.set(d.object,d)}else{if(!h.length){c&&(c.object.dispatchEvent(t(l,{type:"pointerleave",intersection:c})),c.object.dispatchEvent(t(l,{type:"mouseleave",intersection:c})),c=null);return}const d=h[0];if(!c){d.object.dispatchEvent(t(l,{type:"pointerenter",intersection:d})),d.object.dispatchEvent(t(l,{type:"mouseenter",intersection:d})),c=d;return}if(d.object!==c.object){c.object.dispatchEvent(t(l,{type:"pointerleave",intersection:d})),c.object.dispatchEvent(t(l,{type:"mouseleave",intersection:d})),d.object.dispatchEvent(t(l,{type:"pointerenter",intersection:d})),d.object.dispatchEvent(t(l,{type:"mouseenter",intersection:d})),c=d;return}d.object===c.object&&(d.object.dispatchEvent(t(l,{type:"pointermove",intersection:d})),d.object.dispatchEvent(t(l,{type:"mousemove",intersection:d})))}this.dispatchEvent(t(l,{type:"pointermove",intersections:h})),this.dispatchEvent(t(l,{type:"mousemove",intersections:h}))}),this}}const ri=function(n){if(this.eventManager)return console.warn("engine has installed eventManager plugin."),!1;if(!this.pointerManager)return console.error("must install pointerManager before this plugin."),!1;const e=new ii(Object.assign({scene:this.scene,camera:this.camera},n));return e.use(this.pointerManager),this.eventManager=e,this.addEventListener("setCamera",t=>{this.eventManager.setCamera(t.camera)}),this.addEventListener("setScene",t=>{this.eventManager.setScene(t.scene)}),!0};var $e;(function(n){n.OBJECTCHANGED="objectChanged"})($e||($e={}));class oi extends Hn.TransformControls{constructor(e,t){!e&&(e=new u.PerspectiveCamera),!t&&(t=document.body);super(e,t);a(this,"target");a(this,"transObjectSet");this.domElement.removeEventListener("pointerdown",this._onPointerDown),this._onPointerDown=h=>{var d;!this.enabled||!((d=this.object)==null?void 0:d.parent)||(this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(h)),this.pointerDown(this._getPointer(h)))},this.domElement.addEventListener("pointerdown",this._onPointerDown),this.target=new u.Object3D,this.transObjectSet=new Set;let i="";const o=this.target,s=this.transObjectSet,c={x:0,y:0,z:0},l=new WeakMap;this.addEventListener("mouseDown",h=>{i=h.target.mode,i==="translate"&&(i="position"),i==="rotate"&&(i="rotation"),c.x=o[i].x,c.y=o[i].y,c.z=o[i].z,s.forEach(d=>{l.set(d,d.matrixAutoUpdate),d.matrixAutoUpdate=!1})}),this.addEventListener("objectChange",h=>{const d=o[i].x-c.x,m=o[i].y-c.y,f=o[i].z-c.z;c.x=o[i].x,c.y=o[i].y,c.z=o[i].z,s.forEach(y=>{y[i].x+=d,y[i].y+=m,y[i].z+=f,y.updateMatrix(),y.updateMatrixWorld()}),this.dispatchEvent({type:$e.OBJECTCHANGED,transObjectSet:s,mode:i,target:o})}),this.addEventListener("mouseUp",h=>{s.forEach(d=>{d.matrixAutoUpdate=l.get(d),l.delete(d)})})}setDom(e){return this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),e.addEventListener("pointerdown",this._onPointerDown),e.addEventListener("pointermove",this._onPointerHover),e.addEventListener("pointerup",this._onPointerUp),this.domElement=e,this}setCamera(e){return this.camera=e,this}getTarget(){return this.target}getTransObjectSet(){return this.transObjectSet}setAttach(...e){if(this.transObjectSet.clear(),!e.length||!e[0])return this.detach(),this;this.attach(this.target);const t=this.target;if(e.length===1){const c=e[0];return c.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.updateMatrix(),t.updateMatrixWorld(),this.transObjectSet.add(c),this}const i=[],o=[],s=[];return e.forEach(c=>{i.push(c.matrixWorld.elements[12]),o.push(c.matrixWorld.elements[13]),s.push(c.matrixWorld.elements[14])}),t.rotation.set(0,0,0),t.scale.set(0,0,0),t.position.x=(Math.max(...i)-Math.min(...i))/2+Math.min(...i),t.position.y=(Math.max(...o)-Math.min(...o))/2+Math.min(...o),t.position.z=(Math.max(...s)-Math.min(...s))/2+Math.min(...s),t.updateMatrix(),t.updateMatrixWorld(),e.forEach(c=>{this.transObjectSet.add(c)}),this}}const si=function(n){if(this.transformControls)return console.warn("this has installed transformControls plugin."),!1;if(!this.pointerManager)return console.warn("this must install pointerManager before install transformControls plugin."),!1;if(!this.eventManager)return console.warn("this must install eventManager before install transformControls plugin."),!1;const e=new oi(this.camera,this.dom);return e.detach(),this.transformControls=e,this.scene.add(this.transformControls),this.scene.add(this.transformControls.target),this.transformControls.addEventListener("mouseDown",()=>{this.transing=!0}),this.setTransformControls=function(t){return t?this.scene.add(this.transformControls):this.scene.remove(this.transformControls),this},this.addEventListener("setCamera",t=>{t.options.transformControls&&e.setCamera(t.camera)}),this.addEventListener("setDom",t=>{e.setDom(t.dom)}),this.addEventListener("setScene",t=>{const i=t.scene;i.add(this.transformControls.target),i.add(this.transformControls)}),this.selectionBox?this.addEventListener("selected",t=>{e.setAttach(...t.objects)}):this.eventManager.addEventListener("click",t=>{if(this.transing){this.transing=!1;return}if(t.button===0){const o=t.intersections.map(s=>s.object)[0]||null;o?e.setAttach(o):e.detach()}}),this.eventManager.addFilterObject(e),this.completeSet.add(()=>{if(this.IS_ENGINESUPPORT){const t=s=>{const c=this.compilerManager.getObjectSymbol(s);return c?this.dataSupportManager.getConfigBySymbol(c):null};let i=null,o;e.addEventListener($e.OBJECTCHANGED,s=>{const c=s;c.transObjectSet.forEach(l=>{i=t(l),o=c.mode,i&&(i[o].x=l[o].x,i[o].y=l[o].y,i[o].z=l[o].z)})})}}),!0},ai=function(n={}){if(this.webGLRenderer)return console.warn("this has installed webglRenderer plugin."),!1;this.webGLRenderer=new u.WebGLRenderer(n);const e=this.webGLRenderer.domElement;return e.style.position="absolute",e.style.top="0",e.style.left="0",e.classList.add("vis-webgl"),this.getScreenshot=async function(t={}){const i={width:this.dom.offsetWidth,height:this.dom.offsetHeight};!t.width&&(t.width=this.dom.offsetWidth),!t.height&&(t.height=this.dom.offsetHeight),!t.mine&&(t.mine="image/png");let o=!1;this.renderManager.hasRendering()&&(this.renderManager.stop(),o=!0);let s="";const c=this.webGLRenderer.getContext(),h=c.getParameter(c.MAX_RENDERBUFFER_SIZE)/4;if(t.width>h||t.height>h){const d=[],m=Math.ceil(t.width/h),f=Math.ceil(t.height/h),y=t.width/m,g=t.height/f,M=document.createElement("canvas");M.setAttribute("width",t.width.toString()),M.setAttribute("height",t.height.toString());const C=M.getContext("2d");if(!C)return console.warn("can not support canvas 2d;"),s;this.setSize(y,g);for(let T=0;T<m;T+=1)for(let P=0;P<f;P+=1)d.push({x:y*T,y:g*P});const O=[];d.forEach(T=>{this.camera.setViewOffset(t.width,t.height,T.x,T.y,y,g),this.renderManager.render();const P=this.webGLRenderer.domElement.toDataURL(t.mine);O.push(new Promise((R,L)=>{const H=new Image;H.src=P,H.onload=()=>{C.drawImage(H,T.x,T.y,y,g),R(null)}}))}),this.setSize(i.width,i.height),await Promise.all(O).catch(T=>{console.warn(T)}),s=M.toDataURL(t.mine),this.camera.clearViewOffset()}else this.setSize(t.width,t.height),this.renderManager.render(),s=this.webGLRenderer.domElement.toDataURL(t.mine),this.setSize(i.width,i.height);return o&&this.renderManager.play(),s},this.addEventListener("setDom",t=>{t.dom.appendChild(this.webGLRenderer.domElement)}),this.addEventListener("setSize",t=>{this.webGLRenderer.setSize(t.width,t.height,!0)}),this.addEventListener("dispose",()=>{this.webGLRenderer.dispose()}),this.renderManager?(this.renderManager.removeEventListener("render",this.render),this.renderManager.addEventListener("render",t=>{this.webGLRenderer.render(this.scene,this.camera)})):this.render=function(){return this.webGLRenderer.render(this.scene,this.camera),this},!0},Ue=class extends u.Loader{constructor(e){super(e)}load(e,t,i,o){this.path!==void 0&&(e=this.path+e),this.manager.itemStart(e),e=this.manager.resolveURL(e);const s=u.Cache.get(e);if(s!==void 0)return setTimeout(()=>{t&&t(s),this.manager.itemEnd(e)},0),s;const c=document.createElement("video");return c.preload=Ue.preload,c.autoplay=Ue.autoplay,c.loop=Ue.loop,c.muted=Ue.muted,c.src=e,c.style.position="fixed",c.style.top="0",c.style.left="0",c.style.zIndex="-1",document.body.appendChild(c),c.oncanplay=()=>{u.Cache.add(e,c),this.manager.itemEnd(e),t&&t(c)},c.onerror=l=>{this.manager.itemEnd(e),o&&o(l)},c}};let Me=Ue;a(Me,"autoplay",!0),a(Me,"preload","auto"),a(Me,"muted",!0),a(Me,"loop",!0);var V;(function(n){n.BEFORELOAD="beforeLoad",n.LOADING="loading",n.DETAILLOADING="detailLoading",n.DETAILLOADED="detailLoaded",n.LOADED="loaded"})(V||(V={}));class $t extends J{constructor(e){super();a(this,"resourceMap");a(this,"loaderMap");a(this,"loadTotal");a(this,"loadSuccess");a(this,"loadError");a(this,"isError");a(this,"isLoading");a(this,"isLoaded");a(this,"loadDetailMap");a(this,"path","");this.resourceMap=new Map,this.loadTotal=0,this.loadSuccess=0,this.loadError=0,this.isError=!1,this.isLoading=!1,this.isLoaded=!1,this.loadDetailMap={};const t=new u.ImageLoader,i=new Me;this.loaderMap={jpg:t,png:t,jpeg:t,obj:new xn.OBJLoader,mtl:new zn.MTLLoader,mp4:i,webm:i,ogg:i},e&&(this.loaderMap=Object.assign(this.loaderMap,e.loaderExtends))}loaded(){return this.dispatchEvent({type:V.LOADED,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError,resourceMap:this.resourceMap}),this}checkLoaded(){return this.loadTotal===this.loadSuccess+this.loadError&&(this.isError=!0,this.isLoaded=!0,this.isLoading=!1,this.loaded()),this}setPath(e){const t=this.loaderMap;return Object.keys(t).forEach(i=>{t[i].setPath(e)}),this.path=e,this}load(e){var s;if(this.reset(),this.isLoading=!0,this.dispatchEvent({type:V.BEFORELOAD,urlList:[...e]}),e.length<=0)return this.checkLoaded(),console.warn("url list is empty."),this;this.loadTotal+=e.length;const t=this.resourceMap,i=this.loaderMap,o=this.loadDetailMap;for(const c of e){let l,h;typeof c=="string"?(l=c,h=((s=l.split(".").pop())==null?void 0:s.toLocaleLowerCase())||""):(l=c.url,h=c.ext.toLocaleLowerCase());const d={url:l,progress:0,error:!1,message:l};if(o[l]=d,t.has(l)){d.progress=1,this.loadSuccess+=1,this.dispatchEvent({type:V.DETAILLOADED,detail:d}),this.dispatchEvent({type:V.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded();continue}if(!h){d.message=`url: ${l} \u5730\u5740\u6709\u8BEF\uFF0C\u65E0\u6CD5\u83B7\u53D6\u6587\u4EF6\u683C\u5F0F\u3002`,console.warn(d.message),d.error=!0,this.isError=!0,this.loadError+=1,this.dispatchEvent({type:V.DETAILLOADED,detail:d}),this.dispatchEvent({type:V.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError});continue}const m=i[h];if(!m){d.message=`url: ${l} \u4E0D\u652F\u6301\u6B64\u6587\u4EF6\u683C\u5F0F\u52A0\u8F7D\u3002`,console.warn(d.message),d.error=!0,this.isError=!0,this.loadError+=1,this.dispatchEvent({type:V.DETAILLOADED,detail:d}),this.dispatchEvent({type:V.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError});continue}m.loadAsync(l,f=>{d.progress=Number((f.loaded/f.total).toFixed(2)),this.dispatchEvent({type:V.DETAILLOADING,detail:d})}).then(f=>{d.progress=1,this.loadSuccess+=1,this.resourceMap.set(l,f),this.dispatchEvent({type:V.DETAILLOADED,detail:d}),this.dispatchEvent({type:V.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded()}).catch(f=>{d.error=!0,d.message=JSON.stringify(f),this.loadError+=1,this.dispatchEvent({type:V.DETAILLOADED,detail:d}),this.dispatchEvent({type:V.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded()})}return this}reset(){return this.loadTotal=0,this.loadSuccess=0,this.loadError=0,this.isError=!1,this.isLoading=!1,this.isLoaded=!1,this.loadDetailMap={},this}register(e,t){return this.loaderMap[e]=t,this}hasLoaded(e){return this.resourceMap.has(e)}getResource(e){return this.resourceMap.get(e)}getLoadDetailMap(){return this.loadDetailMap}setLoadDetailMap(e){return this.loadDetailMap=e,this}remove(e){}toJSON(){const e=[];return this.resourceMap.forEach((t,i)=>{e.push(i)}),JSON.stringify(e)}exportConfig(){const e=[];return this.resourceMap.forEach((t,i)=>{e.push(i)}),e}dispose(){return this.resourceMap.clear(),this}}const ci=function(n){if(this.loaderManager)return console.warn("engine has installed loaderManager plugin."),!1;const e=new $t(n);return this.loaderManager=e,this.loadResources=(t,i)=>{if(this.resourceManager){const o=s=>{i(void 0,s),this.resourceManager.removeEventListener("mapped",o)};try{this.resourceManager.addEventListener("mapped",o)}catch(s){i(s)}}else{const o=s=>{i(void 0,s),this.loaderManager.removeEventListener("loaded",o)};try{this.loaderManager.addEventListener("loaded",o)}catch(s){i(s)}}return this.loaderManager.load(t),this},this.loadResourcesAsync=t=>new Promise((i,o)=>{if(this.resourceManager){const s=c=>{i(c),this.resourceManager.removeEventListener("mapped",s)};try{this.resourceManager.addEventListener("mapped",s)}catch(c){o(c)}}else{const s=c=>{i(c),this.loaderManager.removeEventListener("loaded",s)};try{this.loaderManager.addEventListener("loaded",s)}catch(c){o(c)}}this.loaderManager.load(t)}),!0},li={name:"uvPulseShader",uniforms:{time:{value:0},width:{value:.5},color:{value:{r:1,g:0,b:0}},center:{value:{x:.5,y:.5}}},vertexShader:`
    varying vec2 vUv;

    void main () {

      vUv = uv;

      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }`,fragmentShader:`
    uniform float width;
    uniform float time;
    uniform vec3 color;
    uniform vec2 center;

    varying vec2 vUv;

    void main () {
      // \u6839\u636EuTime\u6C42\u51FA\u767E\u5206\u6BD4
      float deg = mod(degrees(time), 360.0);
      if (deg > 0.0 && deg < 180.0) {
        discard;
      }

      float percent = cos(time);
      float distancePercent = distance(center, vUv);

      // \u4ECE\u5916\u5411\u91CC
      if (distancePercent > 0.5) {
        discard;
      }

      if (distancePercent < percent) {
        discard;
      }

      if (distancePercent - percent > width) {
        discard;
      }

      float opacity =  (width - (distancePercent - percent)) / width;

      // float opacity = distancePercent;
      gl_FragColor = vec4(color, opacity);
    }`},ui={name:"fragCoordTestingShader",uniforms:{resolution:{value:{x:1920,y:1080}}},vertexShader:`
  void main () {
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }`,fragmentShader:`
    uniform vec2 resolution;

    void main () {
      vec2 st = gl_FragCoord.xy / resolution;
      gl_FragColor = vec4(st.x,st.y,0.0,1.0);
    }`},di={name:"colorMixShader",uniforms:{colorA:{value:{r:1,g:0,b:0}},colorB:{value:{r:0,g:1,b:0}},percent:{value:.5}},vertexShader:`
  void main () {
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }`,fragmentShader:`
    uniform vec3 colorA;
    uniform vec3 colorB;
    uniform float percent;

    void main () {
      gl_FragColor = vec4(mix(colorA, colorB, percent), 1.0);
    }`},hi={name:"BloomShader",uniforms:{brightness:{value:.5},width:{value:5},color:{value:{r:1,g:1,b:1}}},vertexShader:`
  uniform float width;

  varying vec3 vNormal; // \u6CD5\u7EBF
  varying vec3 vPositionNormal;
  void main () {
    vec3 vNormal = normalize( normalMatrix * normal ); // \u8F6C\u6362\u5230\u89C6\u56FE\u7A7A\u95F4
    vec3 vPositionNormal = normalize(normalMatrix * -cameraPosition);
    gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position + normalize(position) * width, 1.0);
    // gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.0);
  }`,fragmentShader:`
    uniform vec3 color;
    uniform float brightness;

    varying vec3 vNormal;
    varying vec3 vPositionNormal;
    
    void main () {
      float a = dot(vNormal, vPositionNormal);
      gl_FragColor = vec4(color, a);
    }`},se=class{static getShader(e){return se.library.has(e)?se.cloneShader(se.library.get(e)):(console.warn(`con not found shader in shader library: ${e}`),null)}static generateConfig(e){if(!se.library.has(e))return console.warn(`con not found shader in shader library: ${e}`),{};const t=se.library.get(e),i={shader:e,uniforms:{}};return t.uniforms&&(i.uniforms=JSON.parse(JSON.stringify(t.uniforms))),i}static cloneShader(e){const t={name:e.name};return e.vertexShader&&(t.vertexShader=e.vertexShader),e.fragmentShader&&(t.fragmentShader=e.fragmentShader),e.uniforms&&(t.uniforms=JSON.parse(JSON.stringify(e.uniforms))),t}};let _=se;a(_,"library",new Map),a(_,"reigster",function(e){se.library.has(e.name)&&console.warn(`shader library has exist shader: ${e.name} that will be cover.`),se.library.set(e.name,e)});const pi={name:"defaultShader"};_.reigster(pi),_.reigster(li),_.reigster(ui),_.reigster(di),_.reigster(hi),r.CONFIGTYPE=void 0,function(n){n.BOXGEOMETRY="BoxGeometry",n.SPHEREGEOMETRY="SphereGeometry",n.LOADGEOMETRY="LoadGeometry",n.PLANEGEOMETRY="PlaneGeometry",n.CIRCLEGEOMETRY="CircleGeometry",n.CONEGEOMETRY="ConeGeometry",n.CYLINDERGEOMETRY="CylinderGeometry",n.DODECAHEDRONGEOMETRY="DodecahedronGeometry",n.TORUSGEOMETRY="TorusGeometry",n.RINGGEOMETRY="RingGeometry",n.EDGESGEOMETRY="EdgesGeometry",n.LINECURVEGEOMETRY="LineCurveGeometry",n.SPLINECURVEGEOMETRY="SplineCurveGeometry",n.CUBICBEZIERCURVEGEOMETRY="CubicBezierCurveGeometry",n.QUADRATICBEZIERCURVEGEOMETRY="QuadraticBezierCurveGeometry",n.CUSTOMGEOMETRY="CustomGeometry",n.LINETUBEGEOMETRY="LineTubeGeometry",n.SPLINETUBEGEOMETRY="SplineTubeGeometry",n.LINESHAPEGEOMETRY="LineShapeGeometry",n.MESH="Mesh",n.LINE="Line",n.POINTS="Points",n.SPRITE="Sprite",n.GROUP="Group",n.CSS3DOBJECT="CSS3DObject",n.CSS3DSPRITE="CSS3DSprite",n.CSS3DPLANE="CSS3DPlane",n.IMAGETEXTURE="ImageTexture",n.CUBETEXTURE="CubeTexture",n.CANVASTEXTURE="CanvasTexture",n.VIDEOTEXTURE="VideoTexture",n.MESHBASICMATERIAL="MeshBasicMaterial",n.MESHSTANDARDMATERIAL="MeshStandardMaterial",n.MESHPHONGMATERIAL="MeshPhongMaterial",n.SPRITEMATERIAL="SpriteMaterial",n.LINEBASICMATERIAL="LineBasicMaterial",n.POINTSMATERIAL="PointsMaterial",n.SHADERMATERIAL="ShaderMaterial",n.AMBIENTLIGHT="AmbientLight",n.SPOTLIGHT="SpotLight",n.POINTLIGHT="PointLight",n.DIRECTIONALLIGHT="DirectionalLight",n.HEMISPHERELIGHT="HemisphereLight",n.PERSPECTIVECAMERA="PerspectiveCamera",n.ORTHOGRAPHICCAMERA="OrthographicCamera",n.WEBGLRENDERER="WebGLRenderer",n.CSS3DRENDERER="CSS3DRenderer",n.SCENE="Scene",n.TRNASFORMCONTROLS="TransformControls",n.ORBITCONTROLS="OrbitControls",n.SMAAPASS="SMAAPass",n.UNREALBLOOMPASS="UnrealBloomPass",n.SELECTIVEBLOOMPASS="SelectiveBloomPass",n.SCRIPTANIMATION="ScriptAnimation",n.KEYFRAMEANIMATION="KeyframeAnimation"}(r.CONFIGTYPE||(r.CONFIGTYPE={}));const le=()=>({vid:"",name:"",type:"Object3D",castShadow:!0,receiveShadow:!0,lookAt:"",visible:!0,matrixAutoUpdate:!0,renderOrder:0,position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},up:{x:0,y:1,z:0},parent:"",children:[],pointerdown:[],pointermove:[],pointerup:[],pointerenter:[],pointerleave:[],click:[],dblclick:[],contextmenu:[]}),We=function(){return Object.assign(le(),{type:"Light",color:"rgb(255, 255, 255)",intensity:1})},mi=function(){return Object.assign(le(),{type:r.CONFIGTYPE.AMBIENTLIGHT,color:"rgb(255, 255, 255)",intensity:1})},fi=function(){return Object.assign(We(),{type:r.CONFIGTYPE.POINTLIGHT,distance:30,decay:.01})},gi=function(){return Object.assign(We(),{type:r.CONFIGTYPE.SPOTLIGHT,distance:30,angle:Math.PI/180*45,penumbra:.01,decay:.01})},Ei=function(){return Object.assign(We(),{type:r.CONFIGTYPE.DIRECTIONALLIGHT,shadow:{mapSize:{width:512,height:512},camera:{near:.5,far:500}}})},yi=function(){return Object.assign(We(),{type:r.CONFIGTYPE.HEMISPHERELIGHT,color:"rgb(255, 255, 255)",groundColor:"rgb(0, 0, 0)"})},$=function(){return{vid:"",type:"Geometry",position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},groups:[]}},Mi=function(){return Object.assign($(),{type:r.CONFIGTYPE.BOXGEOMETRY,width:5,height:5,depth:5,widthSegments:1,heightSegments:1,depthSegments:1})},Ti=function(){return Object.assign($(),{type:r.CONFIGTYPE.SPHEREGEOMETRY,radius:3,widthSegments:32,heightSegments:32,phiStart:0,phiLength:Math.PI*2,thetaStart:0,thetaLength:Math.PI})},Si=function(){return Object.assign($(),{type:r.CONFIGTYPE.PLANEGEOMETRY,width:5,height:5,widthSegments:1,heightSegments:1})},Oi=function(){return Object.assign($(),{type:r.CONFIGTYPE.CIRCLEGEOMETRY,radius:3,segments:8,thetaStart:0,thetaLength:Math.PI*2})},Ci=function(){return Object.assign($(),{type:r.CONFIGTYPE.CONEGEOMETRY,radius:3,height:5,radialSegments:8,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:Math.PI*2})},bi=function(){return Object.assign($(),{type:r.CONFIGTYPE.TORUSGEOMETRY,radius:3,tube:.4,radialSegments:8,tubularSegments:6,arc:Math.PI*2})},Li=function(){return Object.assign($(),{type:r.CONFIGTYPE.RINGGEOMETRY,innerRadius:2,outerRadius:3,thetaSegments:8,phiSegments:8,thetaStart:0,thetaLength:Math.PI*2})},vi=function(){return Object.assign($(),{type:r.CONFIGTYPE.LOADGEOMETRY,url:""})},Pi=function(){return Object.assign($(),{type:r.CONFIGTYPE.CUSTOMGEOMETRY,attribute:{position:[],color:[],index:[],normal:[],uv:[],uv2:[]}})},wi=function(){return Object.assign($(),{type:r.CONFIGTYPE.CYLINDERGEOMETRY,radiusTop:3,radiusBottom:3,height:5,radialSegments:8,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:Math.PI*2})},Ii=function(){return Object.assign($(),{type:"",radius:3,detail:0})},Ri=function(){return Object.assign($(),{type:r.CONFIGTYPE.LOADGEOMETRY,url:"",thresholdAngle:1})},_e=function(){return Object.assign($(),{path:[],divisions:36,space:!0})},Ni=function(){return Object.assign(_e(),{type:r.CONFIGTYPE.LINECURVEGEOMETRY})},Gi=function(){return Object.assign(_e(),{type:r.CONFIGTYPE.SPLINECURVEGEOMETRY})},Ai=function(){return Object.assign(_e(),{type:r.CONFIGTYPE.CUBICBEZIERCURVEGEOMETRY})},Di=function(){return Object.assign(_e(),{type:r.CONFIGTYPE.QUADRATICBEZIERCURVEGEOMETRY})},Wt=function(){return Object.assign($(),{type:"TubeGeometry",path:[],tubularSegments:64,radius:1,radialSegments:8,closed:!1})},Ui=function(){return Object.assign(Wt(),{type:r.CONFIGTYPE.LINETUBEGEOMETRY})},Fi=function(){return Object.assign(Wt(),{type:r.CONFIGTYPE.SPLINETUBEGEOMETRY})},Yi=function(){return Object.assign($(),{path:[],curveSegments:12})},ji=function(){return Object.assign(Yi(),{type:r.CONFIGTYPE.LINESHAPEGEOMETRY})},Qe=function(){return{vid:"",type:"Texture",name:"",mapping:u.UVMapping,wrapS:u.ClampToEdgeWrapping,wrapT:u.ClampToEdgeWrapping,magFilter:u.LinearFilter,minFilter:u.LinearMipmapLinearFilter,anisotropy:1,format:u.RGBAFormat,offset:{x:0,y:0},repeat:{x:1,y:1},rotation:0,center:{x:0,y:0},matrixAutoUpdate:!0,encoding:u.LinearEncoding,needsUpdate:!1}},Bi=function(){return Object.assign(Qe(),{type:r.CONFIGTYPE.IMAGETEXTURE,url:""})},Hi=function(){return Object.assign(Qe(),{type:r.CONFIGTYPE.VIDEOTEXTURE,url:"",minFilter:u.LinearFilter})},xi=function(){return Object.assign(Qe(),{type:r.CONFIGTYPE.CUBETEXTURE,cube:{nx:"",ny:"",nz:"",px:"",py:"",pz:""},mapping:u.CubeReflectionMapping,flipY:!1})},zi=function(){return Object.assign(Qe(),{type:r.CONFIGTYPE.CANVASTEXTURE,url:"",needsUpdate:!1})},Te=function(){return{vid:"",type:"Material",alphaTest:0,colorWrite:!0,depthTest:!0,depthWrite:!0,fog:!0,name:"",needsUpdate:!1,opacity:1,dithering:!1,shadowSide:null,side:u.FrontSide,toneMapped:!0,transparent:!1,visible:!0,blendDst:u.OneMinusSrcAlphaFactor,blendDstAlpha:null,blendEquation:u.AddEquation,blendEquationAlpha:null,blending:u.NormalBlending,blendSrc:u.SrcAlphaFactor,blendSrcAlpha:null,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0}},ki=function(){return Object.assign(Te(),{type:r.CONFIGTYPE.MESHBASICMATERIAL,color:"rgb(255, 255, 255)",combine:u.MultiplyOperation,aoMapIntensity:1,fog:!0,lightMapIntensity:1,reflectivity:1,refractionRatio:.98,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",wireframeLinewidth:1,map:"",envMap:"",alphaMap:"",aoMap:"",lightMap:"",specularMap:""})},Vi=function(){return Object.assign(Te(),{type:r.CONFIGTYPE.MESHSTANDARDMATERIAL,aoMapIntensity:1,bumpScale:1,color:"rgb(255, 255, 255)",displacementScale:1,displacementBias:0,emissive:"rgb(0, 0, 0)",emissiveIntensity:1,envMapIntensity:1,flatShading:!1,lightMapIntensity:1,metalness:0,normalMapType:u.TangentSpaceNormalMap,refractionRatio:.98,roughness:1,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",roughnessMap:"",normalMap:"",metalnessMap:"",map:"",lightMap:"",envMap:"",emissiveMap:"",displacementMap:"",bumpMap:"",alphaMap:"",aoMap:""})},$i=function(){return Object.assign(Te(),{type:r.CONFIGTYPE.MESHPHONGMATERIAL,aoMapIntensity:1,bumpScale:1,color:"rgb(255, 255, 255)",displacementScale:1,displacementBias:0,emissive:"rgb(0, 0, 0)",emissiveIntensity:1,envMapIntensity:1,flatShading:!1,lightMapIntensity:1,normalMapType:u.TangentSpaceNormalMap,refractionRatio:.98,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",specular:"rgb(17, 17, 17)",shininess:30,combine:u.MultiplyOperation,normalMap:"",map:"",lightMap:"",envMap:"",emissiveMap:"",displacementMap:"",bumpMap:"",alphaMap:"",aoMap:"",specularMap:""})},Wi=function(){return Object.assign(Te(),{type:r.CONFIGTYPE.SPRITEMATERIAL,color:"rgb(255, 255, 255)",rotation:0,map:"",alphaMap:"",sizeAttenuation:!0})},_i=function(){return Object.assign(Te(),{type:r.CONFIGTYPE.LINEBASICMATERIAL,color:"rgb(255, 255, 255)",linecap:"round",linejoin:"round",linewidth:1})},Qi=function(){return Object.assign(Te(),{type:r.CONFIGTYPE.POINTSMATERIAL,map:"",alphaMap:"",color:"rgb(255, 255, 255)",sizeAttenuation:!0,size:1})},Xi=function(){return Object.assign(Te(),{type:r.CONFIGTYPE.SHADERMATERIAL,shader:"defaultShader",uniforms:{}})},Ki=function(){return Object.assign(le(),{type:r.CONFIGTYPE.PERSPECTIVECAMERA,adaptiveWindow:!1,fov:45,aspect:1920/1080,near:5,far:50})},Zi=function(){return Object.assign(le(),{type:r.CONFIGTYPE.ORTHOGRAPHICCAMERA,adaptiveWindow:!1,left:-window.innerWidth,right:window.innerWidth,top:window.innerHeight,bottom:-window.innerHeight,near:5,far:50,zoom:1})},_t=function(){return{vid:"",type:"Renderer",size:null}},Ji=function(){return Object.assign(_t(),{vid:r.CONFIGTYPE.WEBGLRENDERER,type:r.CONFIGTYPE.WEBGLRENDERER,clearColor:"rgba(0, 0, 0, 0)",outputEncoding:u.LinearEncoding,physicallyCorrectLights:!1,shadowMap:{enabled:!1,autoUpdate:!0,needsUpdate:!1,type:u.PCFShadowMap},toneMapping:u.NoToneMapping,toneMappingExposure:1,pixelRatio:window.devicePixelRatio,adaptiveCamera:!1,viewport:null,scissor:null})},qi=function(){return Object.assign(_t(),{vid:r.CONFIGTYPE.CSS3DRENDERER,type:r.CONFIGTYPE.CSS3DRENDERER})},er=function(){return Object.assign(le(),{vid:r.CONFIGTYPE.SCENE,type:r.CONFIGTYPE.SCENE,background:"",environment:"",fog:{type:"",color:"rgb(150, 150, 150)",near:1,far:200,density:.003}})},tr=function(){return{vid:r.CONFIGTYPE.TRNASFORMCONTROLS,type:r.CONFIGTYPE.TRNASFORMCONTROLS,axis:"XYZ",enabled:!0,mode:"translate",snapAllow:!1,rotationSnap:Math.PI/180*10,translationSnap:5,scaleSnap:.1,showX:!0,showY:!0,showZ:!0,size:1,space:"world"}},nr=function(){return{vid:r.CONFIGTYPE.ORBITCONTROLS,type:r.CONFIGTYPE.ORBITCONTROLS,autoRotate:!1,autoRotateSpeed:2,enableDamping:!1,dampingFactor:.05,enabled:!0,enablePan:!0,enableRotate:!0,enableZoom:!0,maxAzimuthAngle:1/0,maxDistance:1/0,maxPolarAngle:Math.PI,maxZoom:1/0,minAzimuthAngle:-1/0,minDistance:0,minPolarAngle:0,minZoom:0,panSpeed:1,rotateSpeed:1,zoomSpeed:1,screenSpacePanning:!0,target:null}},Xe=function(){return Object.assign(le(),{material:"",geometry:""})},ir=function(){return Object.assign(Xe(),{type:"Sprite",material:"",center:{x:.5,y:.5}})},rr=function(){return Object.assign(Xe(),{type:r.CONFIGTYPE.MESH,geometry:"",material:""})},or=function(){return Object.assign(Xe(),{type:r.CONFIGTYPE.POINTS,geometry:"",material:""})},sr=function(){return Object.assign(Xe(),{type:r.CONFIGTYPE.LINE,geometry:"",material:""})},ar=function(){return Object.assign(le(),{type:r.CONFIGTYPE.GROUP,children:[]})},ht=function(){return{vid:"",type:"Pass"}},cr=function(){return Object.assign(ht(),{type:r.CONFIGTYPE.SMAAPASS})},lr=function(){return Object.assign(ht(),{type:r.CONFIGTYPE.UNREALBLOOMPASS,resolution:{x:window.innerWidth,y:window.innerHeight},strength:1.5,threshold:0,radius:0})},ur=function(){return Object.assign(ht(),{type:r.CONFIGTYPE.SELECTIVEBLOOMPASS,resolution:{x:window.innerWidth,y:window.innerHeight},strength:1,threshold:0,radius:0,renderScene:"",renderCamera:"",selectedObjects:[]})},Qt=function(){return{vid:"",type:"",name:"",target:"",attribute:"",play:!0}},dr=function(){return Object.assign(Qt(),{type:r.CONFIGTYPE.SCRIPTANIMATION,script:{name:""}})},hr=function(){return Object.assign(Qt(),{type:r.CONFIGTYPE.KEYFRAMEANIMATION,script:{name:""}})},pt=function(){return Object.assign(le(),{type:r.CONFIGTYPE.CSS3DOBJECT,element:"",width:50,height:50})},pr=function(){return Object.assign(pt(),{type:r.CONFIGTYPE.CSS3DPLANE})},mr=function(){return Object.assign(pt(),{type:r.CONFIGTYPE.CSS3DSPRITE,rotation2D:0})},Pe={[r.CONFIGTYPE.IMAGETEXTURE]:Bi,[r.CONFIGTYPE.CUBETEXTURE]:xi,[r.CONFIGTYPE.CANVASTEXTURE]:zi,[r.CONFIGTYPE.VIDEOTEXTURE]:Hi,[r.CONFIGTYPE.MESHBASICMATERIAL]:ki,[r.CONFIGTYPE.MESHSTANDARDMATERIAL]:Vi,[r.CONFIGTYPE.MESHPHONGMATERIAL]:$i,[r.CONFIGTYPE.SPRITEMATERIAL]:Wi,[r.CONFIGTYPE.LINEBASICMATERIAL]:_i,[r.CONFIGTYPE.POINTSMATERIAL]:Qi,[r.CONFIGTYPE.SHADERMATERIAL]:Xi,[r.CONFIGTYPE.AMBIENTLIGHT]:mi,[r.CONFIGTYPE.SPOTLIGHT]:gi,[r.CONFIGTYPE.POINTLIGHT]:fi,[r.CONFIGTYPE.DIRECTIONALLIGHT]:Ei,[r.CONFIGTYPE.HEMISPHERELIGHT]:yi,[r.CONFIGTYPE.BOXGEOMETRY]:Mi,[r.CONFIGTYPE.SPHEREGEOMETRY]:Ti,[r.CONFIGTYPE.LOADGEOMETRY]:vi,[r.CONFIGTYPE.CUSTOMGEOMETRY]:Pi,[r.CONFIGTYPE.PLANEGEOMETRY]:Si,[r.CONFIGTYPE.CIRCLEGEOMETRY]:Oi,[r.CONFIGTYPE.CONEGEOMETRY]:Ci,[r.CONFIGTYPE.CYLINDERGEOMETRY]:wi,[r.CONFIGTYPE.EDGESGEOMETRY]:Ri,[r.CONFIGTYPE.LINECURVEGEOMETRY]:Ni,[r.CONFIGTYPE.SPLINECURVEGEOMETRY]:Gi,[r.CONFIGTYPE.CUBICBEZIERCURVEGEOMETRY]:Ai,[r.CONFIGTYPE.QUADRATICBEZIERCURVEGEOMETRY]:Di,[r.CONFIGTYPE.DODECAHEDRONGEOMETRY]:Ii,[r.CONFIGTYPE.SPLINETUBEGEOMETRY]:Fi,[r.CONFIGTYPE.LINETUBEGEOMETRY]:Ui,[r.CONFIGTYPE.TORUSGEOMETRY]:bi,[r.CONFIGTYPE.RINGGEOMETRY]:Li,[r.CONFIGTYPE.LINESHAPEGEOMETRY]:ji,[r.CONFIGTYPE.SPRITE]:ir,[r.CONFIGTYPE.LINE]:sr,[r.CONFIGTYPE.MESH]:rr,[r.CONFIGTYPE.POINTS]:or,[r.CONFIGTYPE.GROUP]:ar,[r.CONFIGTYPE.CSS3DOBJECT]:pt,[r.CONFIGTYPE.CSS3DSPRITE]:mr,[r.CONFIGTYPE.CSS3DPLANE]:pr,[r.CONFIGTYPE.PERSPECTIVECAMERA]:Ki,[r.CONFIGTYPE.ORTHOGRAPHICCAMERA]:Zi,[r.CONFIGTYPE.WEBGLRENDERER]:Ji,[r.CONFIGTYPE.CSS3DRENDERER]:qi,[r.CONFIGTYPE.SCENE]:er,[r.CONFIGTYPE.TRNASFORMCONTROLS]:tr,[r.CONFIGTYPE.ORBITCONTROLS]:nr,[r.CONFIGTYPE.SMAAPASS]:cr,[r.CONFIGTYPE.UNREALBLOOMPASS]:lr,[r.CONFIGTYPE.SELECTIVEBLOOMPASS]:ur,[r.CONFIGTYPE.SCRIPTANIMATION]:dr,[r.CONFIGTYPE.KEYFRAMEANIMATION]:hr};r.MODULETYPE=void 0,function(n){n.CAMERA="camera",n.LIGHT="light",n.GEOMETRY="geometry",n.TEXTURE="texture",n.MATERIAL="material",n.RENDERER="renderer",n.SCENE="scene",n.SPRITE="sprite",n.CONTROLS="controls",n.LINE="line",n.MESH="mesh",n.POINTS="points",n.GROUP="group",n.CSS3D="css3D",n.PASS="pass",n.MODIFIER="modifier",n.ANIMATION="animation"}(r.MODULETYPE||(r.MODULETYPE={})),r.OBJECTMODULE=void 0,function(n){n[n.CAMERA=r.MODULETYPE.CAMERA]="CAMERA",n[n.LIGHT=r.MODULETYPE.LIGHT]="LIGHT",n[n.SCENE=r.MODULETYPE.SCENE]="SCENE",n[n.SPRITE=r.MODULETYPE.SPRITE]="SPRITE",n[n.LINE=r.MODULETYPE.LINE]="LINE",n[n.MESH=r.MODULETYPE.MESH]="MESH",n[n.POINTS=r.MODULETYPE.POINTS]="POINTS",n[n.GROUP=r.MODULETYPE.GROUP]="GROUP",n[n.CSS3D=r.MODULETYPE.CSS3D]="CSS3D"}(r.OBJECTMODULE||(r.OBJECTMODULE={}));const mt={[r.CONFIGTYPE.IMAGETEXTURE]:r.MODULETYPE.TEXTURE,[r.CONFIGTYPE.CUBETEXTURE]:r.MODULETYPE.TEXTURE,[r.CONFIGTYPE.CANVASTEXTURE]:r.MODULETYPE.TEXTURE,[r.CONFIGTYPE.VIDEOTEXTURE]:r.MODULETYPE.TEXTURE,[r.CONFIGTYPE.MESHBASICMATERIAL]:r.MODULETYPE.MATERIAL,[r.CONFIGTYPE.MESHSTANDARDMATERIAL]:r.MODULETYPE.MATERIAL,[r.CONFIGTYPE.MESHPHONGMATERIAL]:r.MODULETYPE.MATERIAL,[r.CONFIGTYPE.SPRITEMATERIAL]:r.MODULETYPE.MATERIAL,[r.CONFIGTYPE.LINEBASICMATERIAL]:r.MODULETYPE.MATERIAL,[r.CONFIGTYPE.POINTSMATERIAL]:r.MODULETYPE.MATERIAL,[r.CONFIGTYPE.SHADERMATERIAL]:r.MODULETYPE.MATERIAL,[r.CONFIGTYPE.AMBIENTLIGHT]:r.MODULETYPE.LIGHT,[r.CONFIGTYPE.SPOTLIGHT]:r.MODULETYPE.LIGHT,[r.CONFIGTYPE.POINTLIGHT]:r.MODULETYPE.LIGHT,[r.CONFIGTYPE.DIRECTIONALLIGHT]:r.MODULETYPE.LIGHT,[r.CONFIGTYPE.BOXGEOMETRY]:r.MODULETYPE.GEOMETRY,[r.CONFIGTYPE.SPHEREGEOMETRY]:r.MODULETYPE.GEOMETRY,[r.CONFIGTYPE.LOADGEOMETRY]:r.MODULETYPE.GEOMETRY,[r.CONFIGTYPE.CUSTOMGEOMETRY]:r.MODULETYPE.GEOMETRY,[r.CONFIGTYPE.PLANEGEOMETRY]:r.MODULETYPE.GEOMETRY,[r.CONFIGTYPE.CIRCLEGEOMETRY]:r.MODULETYPE.GEOMETRY,[r.CONFIGTYPE.CONEGEOMETRY]:r.MODULETYPE.GEOMETRY,[r.CONFIGTYPE.CIRCLEGEOMETRY]:r.MODULETYPE.GEOMETRY,[r.CONFIGTYPE.EDGESGEOMETRY]:r.MODULETYPE.GEOMETRY,[r.CONFIGTYPE.CYLINDERGEOMETRY]:r.MODULETYPE.GEOMETRY,[r.CONFIGTYPE.LINECURVEGEOMETRY]:r.MODULETYPE.GEOMETRY,[r.CONFIGTYPE.SPLINECURVEGEOMETRY]:r.MODULETYPE.GEOMETRY,[r.CONFIGTYPE.CUBICBEZIERCURVEGEOMETRY]:r.MODULETYPE.GEOMETRY,[r.CONFIGTYPE.QUADRATICBEZIERCURVEGEOMETRY]:r.MODULETYPE.GEOMETRY,[r.CONFIGTYPE.LINETUBEGEOMETRY]:r.MODULETYPE.GEOMETRY,[r.CONFIGTYPE.SPLINETUBEGEOMETRY]:r.MODULETYPE.GEOMETRY,[r.CONFIGTYPE.TORUSGEOMETRY]:r.MODULETYPE.GEOMETRY,[r.CONFIGTYPE.RINGGEOMETRY]:r.MODULETYPE.GEOMETRY,[r.CONFIGTYPE.LINESHAPEGEOMETRY]:r.MODULETYPE.GEOMETRY,[r.CONFIGTYPE.SPRITE]:r.MODULETYPE.SPRITE,[r.CONFIGTYPE.LINE]:r.MODULETYPE.LINE,[r.CONFIGTYPE.MESH]:r.MODULETYPE.MESH,[r.CONFIGTYPE.POINTS]:r.MODULETYPE.POINTS,[r.CONFIGTYPE.GROUP]:r.MODULETYPE.GROUP,[r.CONFIGTYPE.CSS3DOBJECT]:r.MODULETYPE.CSS3D,[r.CONFIGTYPE.CSS3DSPRITE]:r.MODULETYPE.CSS3D,[r.CONFIGTYPE.CSS3DPLANE]:r.MODULETYPE.CSS3D,[r.CONFIGTYPE.PERSPECTIVECAMERA]:r.MODULETYPE.CAMERA,[r.CONFIGTYPE.ORTHOGRAPHICCAMERA]:r.MODULETYPE.CAMERA,[r.CONFIGTYPE.WEBGLRENDERER]:r.MODULETYPE.RENDERER,[r.CONFIGTYPE.SCENE]:r.MODULETYPE.SCENE,[r.CONFIGTYPE.TRNASFORMCONTROLS]:r.MODULETYPE.CONTROLS,[r.CONFIGTYPE.ORBITCONTROLS]:r.MODULETYPE.CONTROLS,[r.CONFIGTYPE.SMAAPASS]:r.MODULETYPE.PASS,[r.CONFIGTYPE.UNREALBLOOMPASS]:r.MODULETYPE.PASS,[r.CONFIGTYPE.SCRIPTANIMATION]:r.MODULETYPE.ANIMATION,[r.CONFIGTYPE.KEYFRAMEANIMATION]:r.MODULETYPE.ANIMATION},ft=n=>{const e=t=>n.toLocaleLowerCase().includes(t.toLocaleLowerCase());for(const t of Object.values(r.MODULETYPE))if(e(t))return t;return null},A=function(n,e,t=!0,i=!0){if(!Pe[n])return console.error(`type: ${n} can not be found in configList.`),{vid:"",type:n};const o=(c,l)=>{for(const h in l){if(c[h]===void 0){!t&&(c[h]=l[h]),t&&i&&console.warn(`'${n}' config can not set key: ${h}`);continue}typeof l[h]=="object"&&l[h]!==null&&!Array.isArray(l[h])?(c[h]===null&&(c[h]=Y({},l[h])),o(c[h],l[h])):c[h]=l[h]}},s=Pe[n]();if([r.CONFIGTYPE.SHADERMATERIAL].includes(n)){const c=_.generateConfig((e==null?void 0:e.shader)||"defaultShader"),l=t;t=!1,o(s,c),t=l}if([r.CONFIGTYPE.SCRIPTANIMATION,r.CONFIGTYPE.KEYFRAMEANIMATION].includes(n)&&(t=!1),s.vid===""&&(s.vid=Z.v4()),e&&o(s,e),A.autoInject&&A.injectEngine){const c=A.injectEngine,l=c.reactiveConfig(s);if(A.injectScene&&ft(s.type)in r.OBJECTMODULE&&s.type!==r.CONFIGTYPE.SCENE){let h=null;typeof A.injectScene=="boolean"?h=c.getObjectConfig(c.scene):typeof A.injectScene=="string"&&(h=c.getConfigBySymbol(A.injectScene)),h?h.children.push(s.vid):console.warn("current engine scene can not found it config",c,c.scene)}return l}return s};A.autoInject=!0,A.injectScene=!1,A.injectEngine=null;const we=(n,e)=>e===1/0?"Infinity":e===-1/0?"-Infinity":e,gt=(n,e)=>e==="Infinity"?1/0:e==="-Infinity"?-1/0:e,je=n=>JSON.parse(JSON.stringify(n,we),gt);var fr=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",stringify:we,parse:gt,clone:je});r.RESOURCEEVENTTYPE=void 0,function(n){n.MAPPED="mapped"}(r.RESOURCEEVENTTYPE||(r.RESOURCEEVENTTYPE={}));class Xt extends J{constructor(e={}){super();a(this,"structureMap",new Map);a(this,"configMap",new Map);a(this,"resourceMap",new Map);a(this,"configModuleMap",mt);a(this,"mappingHandler",new Map);const t=this.mappingHandler;t.set(HTMLImageElement,this.HTMLImageElementHandler),t.set(HTMLCanvasElement,this.HTMLCanvasElementHandler),t.set(HTMLVideoElement,this.HTMLVideoElementHandler),t.set(u.Object3D,this.Object3DHandler),t.set(HTMLDivElement,this.HTMLDivElementHandler),t.set(HTMLSpanElement,this.HTMLSpanElementHandler);const i=new Map;for(const o in e)i.has(o)&&console.warn(`resourceManager construct params rescource already exist: ${o}, that will be cover.`),i.set(o,e[o]);this.mappingResource(i)}Object3DHandler(e,t){const i=this.structureMap,o=this.configMap,s=this.resourceMap,c=function(l,h){let d=l;s.set(d,h);const m=A(h.type,h,!0,!1);o.set(d,m);const f={type:`${h.type}`,url:d};if(h.geometry){const y=h.geometry;y.computeBoundingBox();const g=y.boundingBox,M=g.getCenter(new u.Vector3);d=`${l}.geometry`,s.set(d,y);const C=A(r.CONFIGTYPE.LOADGEOMETRY,{url:d,position:{x:M.x/(g.max.x-g.min.x)*2,y:M.y/(g.max.y-g.min.y)*2,z:M.z/(g.max.z-g.min.z)*2}});o.set(d,C),f.geometry=d,m.geometry=C.vid}if(h.material){const y=h.material;if(y instanceof Array)f.material=[],m.material=[],y.forEach((g,M,C)=>{d=`${l}.material.${M}`,s.set(d,g);const O=A(g.type,g,!0,!1);o.set(d,O),f.material[M]=d,m.material.push(O.vid)});else{d=`${l}.material`,s.set(d,y);const g=A(y.type,y,!0,!1);o.set(d,g),f.material=d,m.material=g.vid}}if([r.CONFIGTYPE.GROUP,r.CONFIGTYPE.SCENE].includes(h.type)&&(o.get(f.url).children=[]),h.children.length)if(f.children=[],[r.CONFIGTYPE.GROUP,r.CONFIGTYPE.SCENE].includes(h.type)){const y=o.get(f.url);h.children.forEach((g,M,C)=>{d=`${l}.children.${M}`,y.children.push(d),f.children[M]=c(d,g)})}else h.children.forEach((y,g,M)=>{d=`${l}.children.${g}`,f.children[g]=c(d,y)});return f};return i.set(e,c(e,t)),this}HTMLImageElementHandler(e,t){return this.resourceMap.set(e,t),this.configMap.set(e,A(r.CONFIGTYPE.IMAGETEXTURE,{url:e})),this.structureMap.set(e,e),this}HTMLCanvasElementHandler(e,t){return this.resourceMap.set(e,t),this.configMap.set(e,A(r.CONFIGTYPE.CANVASTEXTURE,{url:e})),this.structureMap.set(e,e),this}HTMLVideoElementHandler(e,t){return this.resourceMap.set(e,t),this.configMap.set(e,A(r.CONFIGTYPE.VIDEOTEXTURE,{url:e})),this.structureMap.set(e,e),this}HTMLDivElementHandler(e,t){return this.resourceMap.set(e,t),this.configMap.set(e,A(r.CONFIGTYPE.CSS3DOBJECT,{element:e})),this.structureMap.set(e,e),this}HTMLSpanElementHandler(e,t){return this.resourceMap.set(e,t),this.configMap.set(e,A(r.CONFIGTYPE.CSS3DSPRITE,{element:e})),this.structureMap.set(e,e),this}mappingResource(e){const t=this.structureMap,i=this.configMap,o=this.resourceMap,s=this.mappingHandler,c=(d,m,f)=>Object.getPrototypeOf(f)?s.has(Object.getPrototypeOf(f).constructor)?(s.get(Object.getPrototypeOf(f).constructor).call(this,d,m),!0):c(d,m,Object.getPrototypeOf(f)):!1,l=A.autoInject;A.autoInject=!1;const h={};return e.forEach((d,m)=>{c(m,d,d)?h[m]=this.getResourceConfig(m):(o.set(m,d),t.set(m,m),console.warn("resource manager can not support this resource to generate config",d))}),A.autoInject=l,this.dispatchEvent({type:"mapped",structureMap:t,configMap:i,resourceMap:o,resourceConfig:h}),this}getResourceConfig(e){if(this.structureMap.has(e))if(this.structureMap.get(e)===e){const t=this.configMap.get(e);return t?{[this.configModuleMap[t.type]]:{[t.vid]:je(t)}}:{}}else{const t={},i=this.configMap,o=this.configModuleMap,s=this.structureMap.get(e),c=l=>{let h=i.get(l.url),d=o[h.type];if(t[d]||(t[d]={}),t[d][h.vid]=je(h),l.geometry&&(h=i.get(l.geometry),d=o[h.type],t[d]||(t[d]={}),t[d][h.vid]=je(h)),l.material&&(h=i.get(l.material),d=o[h.type],t[d]||(t[d]={}),t[d][h.vid]=je(h)),l.children&&l.children.length)for(const m of l.children)c(m)};return c(s),t}else return console.warn(`resource manager can not found this url resource: ${e}`),{}}hasResource(e){return this.resourceMap.has(e)}remove(e){if(this.structureMap.has(e))if(this.structureMap.get(e)===e){this.structureMap.delete(e),this.configMap.delete(e);const t=this.resourceMap.get(e);return(t==null?void 0:t.dispose)&&t.dispose(),this.resourceMap.delete(e),this}else{const t=this.configMap,i=this.resourceMap,o=this.structureMap.get(e),s=c=>{if(t.delete(c.url),i.delete(c.url),c.geometry&&(t.delete(c.geometry),i.delete(c.geometry)),c.material&&(t.delete(c.material),i.delete(c.material)),c.children&&c.children.length)for(const l of c.children)s(l)};return s(o),this}else return console.warn(`resource manager can not found this url resource: ${e}`),this}dispose(){this.resourceMap.forEach((e,t)=>{e.dispose&&e.dispose()}),this.resourceMap.clear(),this.configMap.clear(),this.structureMap.clear()}}const gr=function(n){if(this.resourceManager)return console.warn("engine has installed resourceManager plugin."),!1;const e=new Xt(n.resources);return this.resourceManager=e,this.loaderManager&&this.loaderManager.addEventListener("loaded",t=>{this.resourceManager.mappingResource(t.resourceMap)}),this.registerResources=t=>{const i=new Map;return Object.keys(t).forEach(o=>{i.set(o,t[o])}),this.resourceManager.mappingResource(i),this},this.addEventListener("dispose",()=>{this.resourceManager.dispose()}),!0};function Er(n,e){return n in e}function ue(n,e,t,i){const o=(s,c,l)=>{for(const h in s)if(!(l&&l[h])){if(typeof s[h]=="object"&&typeof s[h]!==null){l&&typeof l[h]=="object"&&typeof l[h]!==null?o(s[h],c[h],l[h]):o(s[h],c[h]);continue}c[h]=s[h]}};o(n,e,t),i&&i()}const X=class extends J{constructor(e){super();a(this,"ignoreAttribute");this.ignoreAttribute=e||{}}static proxyGetter(e,t,i){return Reflect.get(e,t,i)}static proxySetter(e,t,i,o,s,c){if(typeof t=="symbol")return Reflect.set(e,t,i,o);let l;if(e[t]===void 0){if(typeof i=="object"&&i!==null&&!X.proxyWeakSet.has(i)&&!s.ignoreAttribute[t]){const h=c.concat([t]);i=s.proxyExtends(i,h)}l=Reflect.set(e,t,i),s.broadcast({operate:"add",path:c.concat([]),key:t,value:i})}else{if(typeof i=="object"&&i!==null&&!X.proxyWeakSet.has(i)&&!s.ignoreAttribute[t]){const h=c.concat([t]);i=s.proxyExtends(i,h)}if(l=Reflect.set(e,t,i),Array.isArray(e)&&t==="length"){const h=e[Symbol.for(X.arraySymobl)],d=h.length-e.length;if(d>0){let m=0,f=0;for(const y of h)if(!e.includes(y)&&(s.broadcast({operate:"delete",path:c.concat([]),key:f.toString(),value:y}),m+=1,f+=1,m===d))break}return e[Symbol.for(this.arraySymobl)]=e.concat([]),l}s.broadcast({operate:"set",path:c.concat([]),key:t,value:i})}return l}static proxyDeleter(e,t,i,o){const s=e[t],c=Reflect.deleteProperty(e,t);return Array.isArray(e)||typeof t=="symbol"||i.broadcast({operate:"delete",path:o.concat([]),key:t,value:s}),c}proxyExtends(e,t=[]){if(X.proxyWeakSet.has(e)||typeof e!="object")return e;const i={get:X.proxyGetter,set:(s,c,l,h)=>X.proxySetter(s,c,l,h,this,t),deleteProperty:(s,c)=>X.proxyDeleter(s,c,this,t)};if(typeof e=="object"&&e!==null)for(const s in e){const c=t.concat([s]);let l=this.ignoreAttribute,h=!1;for(const d of c.slice(1)){if(l[d]===!0){h=!0;break}l[d]&&(l=l[d])}h||Er(s,e)&&typeof e[s]=="object"&&e[s]!==null&&(Array.isArray(e[s])&&(e[s][Symbol.for(X.arraySymobl)]=e[s].concat([])),e[s]=this.proxyExtends(e[s],c))}const o=new Proxy(e,i);return X.proxyWeakSet.add(o),o}broadcast({operate:e,path:t,key:i,value:o}){return{__poto__:!0,length:!0}[i]?this:(this.dispatchEvent({type:"broadcast",notice:{operate:e,path:t,key:i,value:o}}),this)}};let Be=X;a(Be,"proxyWeakSet",new WeakSet),a(Be,"arraySymobl","vis.array");class Kt{constructor(){a(this,"rule");a(this,"memberSet");this.rule=function(){},this.memberSet=new Set}apply(e){return this.memberSet.add(e),this}cancel(e){return this.memberSet.delete(e),this}setRule(e){return this.rule=e,this}translate(e){const t=this.rule;return this.memberSet.forEach(i=>{t(e,i)}),this}}class q{constructor(e,t,i){a(this,"data");a(this,"broadcast");a(this,"translater");this.translater=new Kt().setRule(e),this.broadcast=new Be(i),this.data=this.broadcast.proxyExtends(t),this.broadcast.addEventListener("broadcast",o=>{this.translater.translate(o.notice)})}getData(){return this.data}setData(e){return this.data=e,this}proxyData(e){return this.data=this.broadcast.proxyExtends(e),this.data}existSymbol(e){return Boolean(this.data[e])}addConfig(e){return this.data[e.vid]=e,this}getConfig(e){return this.data[e]}removeConfig(e){const t=this.data;t[e]!==void 0&&delete t[e]}addCompiler(e){return e.setTarget(this.data),e.compileAll(),this.translater.apply(e),this}toJSON(e=!0){return e?JSON.stringify(this.exportConfig(),we):JSON.stringify(this.data,we)}exportConfig(e=!0){if(e){const t=this.data,i={},o={},s=(c,l,h={})=>{for(const d in c){if(["vid","type"].includes(d)){h[d]=c[d];continue}if(typeof c[d]=="object"&&c[d]!==null){if(Array.isArray(c[d])){if(!c[d].length)continue;h[d]=c[d].map(m=>typeof m=="object"&&m!==null?JSON.parse(JSON.stringify(m)):m);continue}h[d]={},l[d]?(s(c[d],l[d],h[d]),Object.keys(h[d]).length===0&&delete h[d]):h[d]=JSON.parse(JSON.stringify(c[d]))}else l[d]!==c[d]&&(h[d]=c[d])}};for(const c of Object.values(t)){if(!o[c.type]){if(!Pe[c.type]){console.error(`can not font some config with: ${c.type}`);continue}o[c.type]=Pe[c.type]()}i[c.vid]={},s(c,o[c.type],i[c.vid])}return i}else return JSON.parse(JSON.stringify(this.data,we),gt)}load(e){const t=this.data,i={},o=(s,c)=>{for(const l in c)typeof s[l]=="object"&&s[l]!==null&&typeof c[l]=="object"&&c[l]!==null?o(s[l],c[l]):s[l]===void 0&&(s[l]=c[l])};for(const s in e){const c=e[s];if(!i[c.type]){if(!Pe[c.type]){console.error(`can not font some config with: ${c.type}`);continue}i[c.type]=Pe[c.type]()}o(c,i[c.type]),t[s]=c}return this}remove(e){const t=this.data;for(const i in e)t[i]!==void 0&&delete t[i];return this}getModule(){return this.MODULE}}const He=(n,e)=>{const{operate:t,key:i,path:o,value:s}=n;let c=i;const l=[].concat(o);if(o.length&&(c=l.shift()),!Z.validate(c)){console.warn(`${e.MODULE} Rule: vid is illeage: ${c}`);return}if(t==="add"&&!l.length){e.add(s);return}if(n.operate==="delete"&&!l.length){e.remove(s);return}if(n.operate==="set"&&!l.length&&!i){e.cover(s);return}e.compile(c,{operate:t,key:i,path:l,value:s})},yr=function(n,e){He(n,e)};class Zt extends q{constructor(e,t){!e&&(e={});super(yr,e,t);a(this,"MODULE",r.MODULETYPE.TEXTURE)}}const Mr=function(n,e){He(n,e)};class Jt extends q{constructor(e,t){!e&&(e={});super(Mr,e,t);a(this,"MODULE",r.MODULETYPE.MATERIAL)}}class xe extends q{constructor(e,t,i){!t&&(t=Object.create(Object.prototype));super(e,t,i);a(this,"MODULE",r.MODULETYPE.GROUP)}}const de=function(n,e){n.key!=="parent"&&He(n,e)},Tr=function(n,e){de(n,e)};class qt extends xe{constructor(e,t){!e&&(e={});super(Tr,e,t);a(this,"MODULE",r.MODULETYPE.LIGHT)}}const Sr=function(n,e){He(n,e)};class en extends q{constructor(e,t){!e&&(e={});super(Sr,e,t);a(this,"MODULE",r.MODULETYPE.GEOMETRY)}}const Or=function(n,e){de(n,e)};class tn extends xe{constructor(e,t){!e&&(e={});super(Or,e,t);a(this,"MODULE",r.MODULETYPE.CAMERA)}}const Cr=function(n,e){const{operate:t,key:i,value:o}=n,s=n.path.concat([]);if(t==="add"){e.add(o);return}if(t==="set"){if(Z.validate(i)||i===r.CONFIGTYPE.WEBGLRENDERER){e.add(o);return}let c=i;s.length&&(c=s.shift()),Z.validate(c)||c===r.CONFIGTYPE.WEBGLRENDERER?e.assembly(c,l=>{l.process({path:s.concat([]),key:i,value:o})}):console.warn(`renderer rule can not support this vid: ${c}`);return}};class nn extends q{constructor(e,t){!e&&(e={});super(Cr,e,t);a(this,"MODULE",r.MODULETYPE.RENDERER)}}const br=function(n,e){const{operate:t,key:i,path:o,value:s}=n;let c=i;const l=[].concat(o);if(o.length&&(c=l.shift()),!Z.validate(c)&&c!==r.CONFIGTYPE.SCENE){console.warn(`${e.MODULE} Rule: vid is illeage: ${c}`);return}if(t==="add"&&!l.length){e.add(s);return}if(n.operate==="delete"&&!l.length){e.remove(s);return}if(n.operate==="set"&&!l.length&&!i){e.cover(s);return}e.compile(c,{operate:t,key:i,path:l,value:s})};class rn extends xe{constructor(e,t){!e&&(e={});super(br,e,t);a(this,"MODULE",r.MODULETYPE.SCENE)}}const Lr=function(n,e){const{operate:t,key:i,path:o,value:s}=n;if(t==="set"){const c=o.concat([]),l=c.shift();l?e.set(l,c,i,s):i?e.setAll(i):console.warn(`controls rule can not found controls type in set operate: ${l}`)}};class on extends q{constructor(e,t){!e&&(e={});super(Lr,e,t);a(this,"MODULE",r.MODULETYPE.CONTROLS)}}class Ke extends q{constructor(e,t,i){!t&&(t=Object.create(Object.prototype));super(e,t,i);a(this,"MODULE",r.MODULETYPE.MESH)}}const vr=function(n,e){n.key!=="geometry"&&de(n,e)};class sn extends Ke{constructor(e,t){!e&&(e={});super(vr,e,t);a(this,"MODULE",r.MODULETYPE.SPRITE)}}const Pr=function(n,e){de(n,e)};class an extends Ke{constructor(e,t){!e&&(e={});super(Pr,e,t);a(this,"MODULE",r.MODULETYPE.LINE)}}const wr=function(n,e){de(n,e)};class cn extends Ke{constructor(e,t){!e&&(e={});super(wr,e,t);a(this,"MODULE",r.MODULETYPE.MESH)}}const Ir=function(n,e){de(n,e)};class ln extends Ke{constructor(e,t){!e&&(e={});super(Ir,e,t);a(this,"MODULE",r.MODULETYPE.POINTS)}}const Rr=function(n,e){de(n,e)};class un extends xe{constructor(e,t){!e&&(e={});super(Rr,e,t);a(this,"MODULE",r.MODULETYPE.GROUP)}}const Nr=function(n,e){He(n,e)};class dn extends q{constructor(e,t){!e&&(e={});super(Nr,e,t);a(this,"MODULE",r.MODULETYPE.PASS)}}const Gr=function(n,e){const{operate:t,key:i,path:o,value:s}=n;if(!(i==="name"&&o.length===1)){if(t==="add"){Z.validate(i)?e.add(i,s):console.warn(`animation rule vid is illeage: '${i}'`);return}if(t==="set"){const c=o.concat([]),l=c.shift();l&&Z.validate(l)?e.update(l,c,i,s):console.warn(`animation rule vid is illeage: '${l}'`);return}if(t==="delete"||t==="set"&&i==="play"&&s==="false"){Z.validate(i)?e.remove(s):console.warn(`animation rule vid is illeage: '${i}'`);return}}};class hn extends q{constructor(e,t){!e&&(e={});super(Gr,e,t);a(this,"MODULE",r.MODULETYPE.ANIMATION)}}const Ar=function(n,e){de(n,e)};class pn extends xe{constructor(e,t){!e&&(e={});super(Ar,e,t);a(this,"MODULE",r.MODULETYPE.CSS3D)}}class mn{constructor(e){a(this,"cameraDataSupport",new tn);a(this,"lightDataSupport",new qt);a(this,"geometryDataSupport",new en);a(this,"textureDataSupport",new Zt);a(this,"materialDataSupport",new Jt);a(this,"rendererDataSupport",new nn);a(this,"sceneDataSupport",new rn);a(this,"controlsDataSupport",new on);a(this,"spriteDataSupport",new sn);a(this,"lineDataSupport",new an);a(this,"meshDataSupport",new cn);a(this,"pointsDataSupport",new ln);a(this,"groupDataSupport",new un);a(this,"css3DDataSupport",new pn);a(this,"passDataSupport",new dn);a(this,"animationDataSupport",new hn);a(this,"dataSupportMap");e&&Object.keys(e).forEach(i=>{this[i]!==void 0&&(this[i]=e[i])});const t=new Map;Object.keys(this).forEach(i=>{const o=this[i];o instanceof q&&t.set(o.MODULE,o)}),this.dataSupportMap=t}getDataSupport(e){return this.dataSupportMap.has(e)?this.dataSupportMap.get(e):(console.warn(`can not found this type in dataSupportManager: ${e}`),null)}getSupportData(e){return this.dataSupportMap.has(e)?this.dataSupportMap.get(e).getData():(console.warn(`can not found this type in dataSupportManager: ${e}`),null)}setSupportData(e,t){return this.dataSupportMap.has(e)?this.dataSupportMap.get(e).setData(t):console.warn(`can not found this type in dataSupportManager: ${e}`),this}getConfigBySymbol(e){const t=this.dataSupportMap.values();for(const i of t){const o=i.getConfig(e);if(o)return o}return null}removeConfigBySymbol(...e){const t=this.dataSupportMap.values();for(const i of e)for(const o of t)if(o.existSymbol(i)){o.removeConfig(i);break}return this}getModuleBySymbol(e){const t=this.dataSupportMap.values();for(const i of t)if(i.existSymbol(e))return i.MODULE;return null}applyConfig(...e){for(const t of e){const i=ft(t.type);i?this.dataSupportMap.get(i).addConfig(t):console.warn(`dataSupportManager can not found this config module: ${t.type}`)}return this}reactiveConfig(e){const t=ft(e.type);return t?this.dataSupportMap.get(t).addConfig(e).getConfig(e.vid):(console.warn(`dataSupportManager can not found this config module: ${e.type}`),e)}load(e){return this.dataSupportMap.forEach((i,o)=>{e[o]&&i.load(e[o])}),this}remove(e){return this.dataSupportMap.forEach((i,o)=>{e[o]&&i.remove(e[o])}),this}toJSON(e={},t=!0){return JSON.stringify(this.exportConfig(e,t),we)}exportConfig(e={},t=!0){return this.dataSupportMap.forEach((o,s)=>{e[s]=o.exportConfig(t)}),e}}const Dr=function(n){if(this.dataSupportManager)return console.warn("engine has installed dataSupportManager plugin."),!1;const e=new mn(n);return this.dataSupportManager=e,this.applyConfig=function(...t){return this.dataSupportManager.applyConfig(...t),this},this.reactiveConfig=function(t){return this.dataSupportManager.reactiveConfig(t)},this.getConfigBySymbol=function(t){return this.dataSupportManager.getConfigBySymbol(t)},this.removeConfigBySymbol=function(...t){return this.dataSupportManager.removeConfigBySymbol(...t),this},this.toJSON=function(){if(this.loaderManager){const t={assets:JSON.parse(this.loaderManager.toJSON())};return this.dataSupportManager.toJSON(t)}return this.dataSupportManager.toJSON()},this.exportConfig=function(){let t={};return this.loaderManager&&(t={assets:this.loaderManager.exportConfig()}),this.dataSupportManager.exportConfig(t)},this.completeSet.add(()=>{const t=this.dataSupportManager.getDataSupport(r.MODULETYPE.RENDERER).getData();t.WebGLRenderer||(t.WebGLRenderer=A(r.CONFIGTYPE.WEBGLRENDERER));const i=this.dataSupportManager.getDataSupport(r.MODULETYPE.CONTROLS).getData();this.transformControls&&(i[r.CONFIGTYPE.TRNASFORMCONTROLS]||(i[r.CONFIGTYPE.TRNASFORMCONTROLS]=A(r.CONFIGTYPE.TRNASFORMCONTROLS))),this.orbitControls&&(i[r.CONFIGTYPE.ORBITCONTROLS]||(i[r.CONFIGTYPE.ORBITCONTROLS]=A(r.CONFIGTYPE.ORBITCONTROLS)))}),!0},K=class{constructor(){a(this,"target",{});a(this,"map",new Map);a(this,"weakMap",new WeakMap);a(this,"engine");a(this,"cacheCompile")}getMap(){return this.map}useEngine(e){return this.engine=e,this}setTarget(e){return this.target=e,this}add(e){if(!K.processors.has(e.type))return console.warn(`${this.MODULE} compiler can not support this type: ${e.type}`),null;const i=K.processors.get(e.type).create(e,this.engine);return this.map.set(e.vid,i),this.weakMap.set(i,e.vid),i}remove(e){const t=e.vid;if(!this.map.has(t))return console.warn(`${this.MODULE} compiler can not found this vid object: ${t}.`),this;if(!K.processors.has(e.type))return console.warn(`${this.MODULE} compiler can not support this type: ${e.type}`),this;const i=this.map.get(t);return K.processors.get(e.type).dispose(i),this.map.delete(t),this.weakMap.delete(i),this}cover(e){const t=e.vid;if(!this.map.has(t))return console.warn(`${this.MODULE} compiler can not found this vid object: ${t}.`),this;const i=this.map.get(t);return ue(e,i,{vid:!0,type:!0}),this}compile(e,t){const i=this.cacheCompile;let o,s,c;if(i&&i.vid===e)o=i.target,s=i.config,c=i.processor;else{if(!this.map.has(e))return console.warn(`${this.MODULE} compiler set function: can not found object which vid is: '${e}'`),this;if(!this.target[e])return console.warn(`${this.MODULE} compiler set function: can not found config which vid is: '${e}'`),this;if(o=this.map.get(e),s=this.target[e],!K.processors.has(s.type))return console.warn(`PassCompiler can not support this type: ${s.type}`),this;c=K.processors.get(s.type),this.cacheCompile={target:o,config:s,processor:c,vid:e}}return c.process(Y({config:s,target:o,engine:this.engine,processor:c},t)),this}compileAll(){const e=this.target;for(const t of Object.values(e))this.add(t);return this}dispose(){this.cacheCompile&&(this.cacheCompile=void 0);for(const e of Object.values(this.target)){if(!this.map.has(e.vid)){console.warn(`${this.MODULE} compiler set function: can not found object which vid is: '${e.vid}'`);continue}const t=this.map.get(e.vid);if(!K.processors.has(e.type)){console.warn(`${this.MODULE}  can not support this type: ${e.type}`);continue}K.processors.get(e.type).dispose(t)}return this.map.clear(),this.target={},this}getObjectSymbol(e){return this.weakMap.get(e)||null}getObjectBySymbol(e){return this.map.get(e)||null}};let b=K;a(b,"processors",new Map),a(b,"processor",function(e){K.processors.set(e.configType,e)});const Ur={name:"linearTime",multiply:1},Fr=function(n,e,t,i){return e[t]===void 0?(console.warn(`object not exist attribute: ${t}`,e),o=>{}):typeof e[t]!="number"?(console.warn("object attribute is not typeof number.",e,t),o=>{}):o=>{e[t]+=o.delta*i.multiply}},Yr={name:"sinWave",wavelength:1,offset:0,amplitude:1,speed:1},jr=function(n,e,t,i){if(e[t]===void 0)return console.warn(`object not exist attribute: ${t}`,e),s=>{};if(typeof e[t]!="number")return console.warn("object attribute is not typeof number.",e,t),s=>{};const o=e[t];return s=>{e[t]=o+i.amplitude*Math.sin(s.total*i.speed/i.wavelength)+i.offset}},te=class{static generateConfig(e,t){if(!te.configLibrary.has(e))return console.warn(`event library can not found config by name: ${e}`),{name:""};const i=(s,c)=>{for(const l in c)s[l]!==void 0&&(typeof c[l]=="object"&&c[l]!==null&&!Array.isArray(c[l])?i(s[l],c[l]):s[l]=c[l])},o=JSON.parse(JSON.stringify(te.configLibrary.get(e)));return i(o,t),o}static generateScript(e,t,i,o){return te.generatorLibrary.has(o.name)?te.generatorLibrary.get(o.name)(e,t,i,o):(console.error(`event library can not found generator by name: ${o.name}`),()=>{})}static has(e){return te.configLibrary.has(e)}};let he=te;a(he,"configLibrary",new Map),a(he,"generatorLibrary",new Map),a(he,"register",function(e,t){te.configLibrary.has(e.name)&&console.warn(`EventLibrary has already exist this event generator: ${e.name}, that will be cover.`),te.configLibrary.set(e.name,JSON.parse(JSON.stringify(e))),te.generatorLibrary.set(e.name,t)}),he.register(Ur,Fr),he.register(Yr,jr);class Br extends b{constructor(){super();a(this,"MODULE",r.MODULETYPE.ANIMATION);a(this,"target",{});a(this,"engine");a(this,"objectMapSet",new Set);a(this,"scriptAniSymbol","vis.scriptAni")}linkObjectMap(...e){for(const t of e)this.objectMapSet.has(t)||this.objectMapSet.add(t);return this}linkTextureMap(e){return this.objectMapSet.add(e),this}linkMaterialMap(e){return this.objectMapSet.add(e),this}getObject(e){for(const t of this.objectMapSet)if(t.has(e))return t.get(e);return console.error(`animation compiler can not found object which vid: ${e}`),{}}add(e,t){const i=this.engine.renderManager;let o=this.getObject(t.target);const s=t.attribute.split(".");s.shift();const c=s.pop();for(const l of s){if(o[l]===void 0){console.error(`animaton compiler: target object can not found key: ${l}`,o);break}o=o[l]}if(t.type===r.CONFIGTYPE.SCRIPTANIMATION){const l=he.generateScript(this.engine,o,c,t.script);t[Symbol.for(this.scriptAniSymbol)]=l,t.play&&i.addEventListener("render",l)}else console.warn(`animation compiler can not support this type config: ${t.type}`);return this}update(e,t,i,o){if(!this.target[e])return console.warn(`AnimationCompiler can not found vid config: ${e}`),this;const s=this.target[e];if(s.type===r.CONFIGTYPE.SCRIPTANIMATION){const c=this.engine.renderManager,l=s[Symbol.for(this.scriptAniSymbol)];if(l===void 0)return console.warn(`AnimationCompiler can not found function in update fun: ${e}`),this;if(i==="play"&&o)return c.hasEventListener("render",l)||c.addEventListener("render",l),this;if(i==="play"&&!o)return c.removeEventListener("render",l),this}return this.remove(this.target[e]).add(e,this.target[e])}remove(e){if(e.type===r.CONFIGTYPE.SCRIPTANIMATION){this.engine.renderManager.removeEventListener("render",e[Symbol.for(this.scriptAniSymbol)]);let t=this.engine.getConfigBySymbol(e.target);if(!t)return console.warn(`AnimationCompiler can not found vid object: ${e.target}`),this;const i=e.attribute.split(".");i.shift();const o=i.pop();for(const s of i){if(t[s]===void 0)return console.warn(`animaton compiler: target object can not found key: ${s}`,t),this;t=t[s]}t[o]=t[o]}return this}setTarget(e){return this.target=e,this}useEngine(e){return this.engine=e,this}compileAll(){for(const e of Object.values(this.target))this.add(e.vid,e);return this}dispose(e){for(const t of Object.values(this.target))this.remove(t);return this}getObjectSymbol(e){return null}getObjectBySymbol(e){return null}}class Se extends b{constructor(){super();a(this,"IS_OBJECTCOMPILER",!0)}}class Et{constructor(){a(this,"filterMap",{});a(this,"assembly",!1);this.filterMap=Object.assign({vid:!0,type:!0},this.filterMap)}mergeAttribute(e,t,i){if(this.filterMap[e.concat([t]).join(".")])return;let o=this.target;if(e.length)for(const s of e)o=o[s];o[t]=i}mergeObject(e){const t=(i,o)=>{for(const s in i)if(!this.filterMap[s]){if(typeof i[s]=="object"&&typeof i[s]!==null){t(i[s],o[s]);continue}o[s]=i[s]}};t(this.config,this.target),e&&e()}processAll(){const e=(t,i)=>{for(const o in t)if(!this.filterMap[i.concat([o]).join(".")]){if(typeof t[o]=="object"&&typeof t[o]!==null){e(t[o],i.concat([o]));continue}this.process({path:i,key:o,value:t[o]})}};return e(this.config,[]),this}}class Hr{constructor(e){a(this,"configType");a(this,"commands");a(this,"create");a(this,"dispose");this.configType=e.configType,this.commands=e.commands,this.create=e.create,this.dispose=e.dispose}process(e){if(!this.commands||!this.commands[e.operate]){this[e.operate](e);return}let t=this.commands[e.operate];for(const i of[].concat(e.path,e.key))if(!t[i]&&!t.$reg){this[e.operate](e);return}else if(t[i])if(typeof t[i]=="function"){t[i](e);return}else t=t[i];else if(t.$reg){for(const o of t.$reg)if(o.reg.test(i)){o.handler(e);return}}this[e.operate](e)}add(e){let t=e.target;const i=e.path;for(const o of i)if(typeof t[o]!==void 0)t=t[o];else{console.warn("processor can not exec default add operate.",e);return}t[e.key]=e.value}set(e){let t=e.target;const i=e.path;for(const o of i)if(typeof t[o]!==void 0)t=t[o];else{console.warn("processor can not exec default set operate.",e);return}t[e.key]=e.value}delete(e){let t=e.target;const i=e.path;for(const o of i)if(typeof t[o]!==void 0)t=t[o];else{console.warn("processor can not exec default delete operate.",e);return}delete t[e.key]}}const I=n=>new Hr(n),xr={name:"openWindow",params:{url:""}},zr=function(n,e){return()=>{window.open(e.params.url)}},kr={name:"visibleObject",params:{target:"",visible:!0,delay:0}},Vr=function(n,e){const t=e.params,i=n.getObjectBySymbol(t.target);return i?()=>{setTimeout(()=>{i.visible=t.visible},t.delay)}:(console.warn(`basic event visibleObject: can not found vid object: ${t.target}`),()=>{})},$r={name:"addClass",params:{target:"",className:"",delay:0}},Wr=function(n,e){const t=e.params,i=[];if(t.target==="all")n.scene.traverse(o=>{o instanceof Ye.CSS3DObject&&i.push(o)});else if(Array.isArray(t.target))t.target.forEach(o=>{const s=n.getObjectBySymbol(o);s?i.push(s):console.warn(`basic event AddClass: can not found vid object: ${t.target}`)});else{const o=n.getObjectBySymbol(t.target);if(!o)return console.warn(`basic event AddClass: can not found vid object: ${t.target}`),()=>{};if(!(o instanceof Ye.CSS3DObject))return console.warn("basic event AddClass: object is not a CSS3DObject."),()=>{};i.push(o)}return i.length?()=>{setTimeout(()=>{i.forEach(o=>{o.element.classList.add(t.className)})},t.delay)}:(console.warn(`basic event AddClass: can not found vid object: ${t.target}`),()=>{})},_r={name:"changeScene",params:{scene:"Scene",delay:0}},Qr=function(n,e){const t=e.params;return()=>{setTimeout(()=>{n.setScene(t.scene)},t.delay)}},Xr={name:"changeCamera",params:{camera:"",delay:0}},Kr=function(n,e){const t=e.params;return()=>{setTimeout(()=>{n.setCamera(t.camera)},t.delay)}},Zr={name:"switchAnimate",params:{target:"",toggle:"auto",delay:0}},Jr=function(n,e){const t=e.params,i=n.getConfigBySymbol(t.target);return i?()=>{setTimeout(()=>{if(t.toggle==="auto"){i.play!=i.play;return}if(t.toggle==="off"){i.play=!1;return}if(t.toggle==="on"){i.play=!0;return}},t.delay)}:(console.warn(`basic event switchAnimate: can not found vid config: ${t.target}`),()=>{})};r.TIMINGFUNCTION=void 0,function(n){n.ELN="ELN",n.EQI="EQI",n.EQO="EQO",n.EASING_LINEAR_NONE="EASING_LINEAR_NONE",n.EASING_QUARTIC_IN="EASING_QUARTIC_IN",n.EASING_QUARTIC_OUT="EASING_QUARTIC_OUT",n.EASING_QUARTIC_INOUT="EASING_QUARTIC_INOUT",n.EASING_QUADRATIC_IN="EASING_QUADRATIC_IN",n.EASING_QUADRATIC_OUT="EASING_QUADRATIC_OUT",n.EASING_QUADRATIC_INOUT="EASING_QUADRATIC_INOUT"}(r.TIMINGFUNCTION||(r.TIMINGFUNCTION={}));const U={ELN:N.Easing.Linear.None,EQI:N.Easing.Quartic.In,EQO:N.Easing.Quartic.Out,EASING_LINEAR_NONE:N.Easing.Linear.None,EASING_QUARTIC_IN:N.Easing.Quartic.In,EASING_QUARTIC_OUT:N.Easing.Quartic.Out,EASING_QUARTIC_INOUT:N.Easing.Quartic.InOut,EASING_QUADRATIC_IN:N.Easing.Quadratic.In,EASING_QUADRATIC_OUT:N.Easing.Quadratic.Out,EASING_QUADRATIC_INOUT:N.Easing.Quadratic.InOut},qr={name:"moveTo",params:{target:"",position:{x:0,y:0,z:0},delay:0,duration:1e3,timingFunction:r.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},eo=function(n,e){const t=e.params,o=n.compilerManager.getObjectBySymbol(t.target);if(!o)return console.warn(`real time animation moveTO: can not found vid object: ${t.target}`),()=>{};const s=n.renderManager,c=n.dataSupportManager.getConfigBySymbol(t.target);if(!c)return console.warn(`can not found object config: ${t.target}`),()=>{};let l=!1;return()=>{if(l)return;l=!0;const h=new N.Tween(o.position).to(t.position).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start(),d=m=>{h.update()};s.addEventListener("render",d),h.onComplete(()=>{s.removeEventListener("render",d),c.position.x=t.position.x,c.position.y=t.position.y,c.position.z=t.position.z,l=!1})}},to={name:"rotationTo",params:{target:"",rotation:{x:0,y:0,z:0},delay:0,duration:1e3,timingFunction:r.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},no=function(n,e){const t=e.params,o=n.compilerManager.getObjectBySymbol(t.target);if(!o)return console.warn(`real time animation moveTO: can not found vid object: ${t.target}`),()=>{};const s=n.renderManager,c=n.dataSupportManager.getConfigBySymbol(t.target);if(!c)return console.warn(`can not found object config: ${t.target}`),()=>{};let l=!1;return()=>{if(l)return;l=!0;const h=new N.Tween(o.rotation).to(t.rotation).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start(),d=m=>{h.update()};s.addEventListener("render",d),h.onComplete(()=>{s.removeEventListener("render",d),c.rotation.x=t.rotation.x,c.rotation.y=t.rotation.y,c.rotation.z=t.rotation.z,l=!1})}},io={name:"upTo",params:{target:"",up:{x:0,y:1,z:0},delay:0,duration:1e3,timingFunction:r.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},ro=function(n,e){const t=e.params,o=n.compilerManager.getObjectBySymbol(t.target);if(!o)return console.warn(`real time animation upTo: can not found vid object: ${t.target}`),()=>{};const s=n.renderManager,c=n.dataSupportManager.getConfigBySymbol(t.target);if(!c)return console.warn(`can not found object config: ${t.target}`),()=>{};let l=!1;return()=>{if(l)return;l=!0;const h=new N.Tween(o.up).to(t.up).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start(),d=m=>{h.update()};s.addEventListener("render",d),h.onComplete(()=>{s.removeEventListener("render",d),c.up.x=t.up.x,c.up.y=t.up.y,c.up.z=t.up.z,l=!1})}},oo={name:"moveFromTo",params:{target:"",from:{x:0,y:0,z:0},to:{x:10,y:10,z:10},delay:0,duration:1e3,timingFunction:r.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},so=function(n,e){const t=e.params,o=n.compilerManager.getObjectBySymbol(t.target);if(!o)return console.warn(`real time animation moveTO: can not found vid object: ${t.target}`),()=>{};const s=n.renderManager,c=n.dataSupportManager.getConfigBySymbol(t.target);if(!c)return console.warn(`can not found object config: ${t.target}`),()=>{};let l=!1;return()=>{if(l)return;l=!0,o.position.set(t.from.x,t.from.y,t.from.z),o.updateMatrix(),o.updateMatrixWorld();const h=new N.Tween(o.position).to(t.to).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start(),d=m=>{h.update()};s.addEventListener("render",d),h.onComplete(()=>{s.removeEventListener("render",d),c.position.x=t.to.x,c.position.y=t.to.y,c.position.z=t.to.z,l=!1})}},ao={name:"moveSpacing",params:{target:"",spacing:{x:10,y:10,z:10},delay:0,duration:1e3,timingFunction:r.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},co=function(n,e){const t=e.params,i=n.getObjectBySymbol(t.target);if(!i)return console.warn(`can not found vid object: ${t.target}`),()=>{};if(!(i instanceof u.Object3D))return console.warn(`object is not instanceof Object3D: ${t.target}`),()=>{};const o=n.renderManager,s=n.getConfigBySymbol(t.target);let c=!1;return()=>{if(c)return;c=!0;const l={x:i.position.x+t.spacing.x,y:i.position.y+t.spacing.y,z:i.position.z+t.spacing.z},h=new N.Tween(i.position).to(l).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start(),d=m=>{h.update()};o.addEventListener("render",d),h.onComplete(()=>{o.removeEventListener("render",d),s.position.x=l.x,s.position.y=l.y,s.position.z=l.z,c=!1})}},lo={name:"moveToObject",params:{target:"",to:"",offset:{x:0,y:0,z:0},delay:0,duration:1e3,timingFunction:r.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},uo=function(n,e){const t=e.params,i=n.compilerManager,o=i.getObjectBySymbol(t.target),s=i.getObjectBySymbol(t.to);if(!o)return console.warn(`real time animation MoveToObject: can not found vid object: ${t.target}`),()=>{};if(!s)return console.warn(`real time animation MoveToObject: can not found vid object: ${t.target}`),()=>{};const c=n.renderManager,l=n.dataSupportManager.getConfigBySymbol(t.target);if(!l)return console.warn(`can not found object config: ${t.target}`),()=>{};let h=!1;return()=>{if(h)return;h=!0;const d={x:s.position.x+t.offset.x,y:s.position.y+t.offset.y,z:s.position.z+t.offset.z},m=new N.Tween(o.position).to(d).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start(),f=y=>{m.update()};c.addEventListener("render",f),m.onComplete(()=>{c.removeEventListener("render",f),l.position.x=d.x,l.position.y=d.y,l.position.z=d.z,h=!1})}},ho={name:"vector3To",params:{target:"",attribute:".position",props:{x:"x",y:"y",z:"z"},delay:0,duration:500,to:{},timingFunction:r.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},po=function(n,e){var f,y,g;const t=e.params,i=n.compilerManager.getObjectBySymbol(t.target);if(!i)return console.warn(`real time animation vector3To: can not found vid object: ${t.target}`),()=>{};const o=n.renderManager;let s=n.dataSupportManager.getConfigBySymbol(t.target);if(!s)return console.warn(`real time animation vector3To: can not found object config: ${t.target}`),()=>{};const c=t.attribute.split(".");c.shift();let l=i;for(const M of c){if(l[M]===void 0)return console.error(`real time animation vector3To: object can not support key: ${M}`,i),()=>{};l=l[M],s=s[M]}const h=t.props;if(!(h.x in l)||!(h.y in l)||!(h.z in l))return console.error("real time animation vector3To: object can not support props:",l,h),()=>{};if(!(h.x in s)||!(h.y in s)||!(h.z in s))return console.error("real time animation vector3To: config can not support props:",s,h),()=>{};const d={x:(f=t.to.x)!=null?f:l[h.x],y:(y=t.to.y)!=null?y:l[h.y],z:(g=t.to.z)!=null?g:l[h.z]};let m=!1;return()=>{if(m)return;m=!0;const M=new N.Tween(l).to(d).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start(),C=O=>{M.update()};o.addEventListener("render",C),M.onComplete(()=>{o.removeEventListener("render",C),s[h.x]=d.x,s[h.y]=d.y,s[h.z]=d.z,m=!1})}},mo={name:"focusObject",params:{target:"",camera:"",space:"world",offset:{x:0,y:0,z:20},delay:0,duration:1e3,timingFunction:r.TIMINGFUNCTION.EASING_QUADRATIC_INOUT,back:!0}},fo=function(n,e){const t=e.params,i=n.getObjectBySymbol(t.target),o=n.orbitControls.target;if(!i)return console.warn(`real time animation focusObject: can not found vid object: ${t.target}`),()=>{};if(!(i instanceof u.Object3D))return console.warn(`real time animation focusObject: vid object is not a class of THREE.Object3D: ${t.target}`),()=>{};let s=!1;const c=new u.Euler;return()=>{if(s)return;s=!0;let l=n.camera;t.camera&&(l=n.getObjectBySymbol(t.camera),l||(l=n.camera,console.warn(`real time animation focusObject: can not found camera config: ${t.camera}`)));const h=n.getObjectConfig(l),d=n.orbitControls&&n.orbitControls.object===l;h||console.warn("engine current camera can not found config.");const m=n.renderManager;let f={x:i.matrixWorld.elements[12]+t.offset.x,y:i.matrixWorld.elements[13]+t.offset.y,z:i.matrixWorld.elements[14]+t.offset.z};const y={x:l.position.x,y:l.position.y,z:l.position.z};if(t.space==="local"){const R=new u.Vector3(t.offset.x,t.offset.y,t.offset.z).applyEuler(c.setFromRotationMatrix(i.matrixWorld));f={x:i.matrixWorld.elements[12]+R.x,y:i.matrixWorld.elements[13]+R.y,z:i.matrixWorld.elements[14]+R.z}}const g=new N.Tween(l.position).to(f).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start();let M;const C={x:l.up.x,y:l.up.y,z:l.up.z};if(t.space==="local"){const R=new u.Vector3(0,1,0).applyEuler(c.setFromRotationMatrix(i.matrixWorld));M=new N.Tween(l.up).to({x:R.x,y:R.y,z:R.z}).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start()}let O;const T={x:o.x,y:o.y,z:o.z};d&&(O=new N.Tween(o).to({x:i.matrixWorld.elements[12],y:i.matrixWorld.elements[13],z:i.matrixWorld.elements[14]}).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start());let P;d&&t.space==="local"?P=R=>{g.update(),M.update(),O.update()}:d?P=R=>{g.update(),O.update()}:t.space==="local"?P=R=>{g.update(),M.update()}:P=R=>{g.update()},m.addEventListener("render",P),g.onComplete(()=>{if(m.removeEventListener("render",P),h&&(h.position.x=f.x,h.position.y=f.y,h.position.z=f.z),s=!1,t.back){const R=()=>{const L=new N.Tween(l.position).to(y).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start();let H;t.space==="local"&&(H=new N.Tween(l.up).to(C).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start());let E;d&&(E=new N.Tween(o).to(T).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start());const x=w=>{L.update(),H&&H.update(),E&&E.update()};L.onComplete(()=>{m.removeEventListener("render",x)}),m.addEventListener("render",x),document.removeEventListener("dblclick",R)};document.addEventListener("dblclick",R)}})}},go={name:"fadeObject",params:{target:"",direction:"out",delay:0,duration:300,timingFunction:r.TIMINGFUNCTION.EASING_QUADRATIC_INOUT,visible:!0}},Eo=function(n,e){const t=e.params,i=n.getObjectBySymbol(t.target);if(!i)return console.warn(`real time animation fadeObject: can not found vid object: ${t.target}`),()=>{};const o=n.getObjectConfig(i);if(!o.material)return console.warn(`real time animation fadeObject: target can not support fade: ${t.target}`),()=>{};const s=[],c=[],l=Array.isArray(o.material)?[].concat(o.material):[o.material];for(const d of l){const m=n.getObjectBySymbol(d),f=n.getConfigBySymbol(d);if(!(m instanceof u.Material)){console.error(`real time animation fadeObject: object config material is not instanceof Material: ${d}`);continue}if(!f){console.error(`real time animation fadeObject: object config material can not found config: ${d}`);continue}s.push(m),c.push(f)}let h=!1;return()=>{if(h)return;h=!0;const d=n.renderManager;o.visible=!0,s.forEach((m,f,y)=>{m.visible=!0,m.transparent=!0,m.opacity=t.direction==="in"?0:1,m.needsUpdate=!0;const g=new N.Tween(m).to({opacity:t.direction==="in"?1:0}).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start(),M=C=>{g.update()};d.addEventListener("render",M),g.onComplete(()=>{d.removeEventListener("render",M),t.direction==="out"&&t.visible?(c[f].visible=!1,o.visible=!1):t.direction==="in"&&t.visible&&(c[f].visible=!0,o.visible=!0),c[f].opacity=t.direction==="in"?1:0,h=!1})})}},yo={name:"showToCamera",params:{target:"",offset:{x:0,y:0,z:-30},delay:0,duration:1e3,timingFunction:r.TIMINGFUNCTION.EASING_QUADRATIC_INOUT,back:!0}},Mo=function(n,e){const t=e.params,i=n.getObjectBySymbol(t.target),o=n.getConfigBySymbol(t.target),s=n.camera;if(!i)return console.warn(`real time animation showToCamera: can not found vid object: ${t.target}`),()=>{};if(!i)return console.warn(`real time animation showToCamera: can not found vid config: ${t.target}`),()=>{};if(!(i instanceof u.Object3D))return console.warn(`real time animation showToCamera: vid object is not a class of THREE.Object3D: ${t.target}`),()=>{};const c=new u.Matrix4,l=new u.Euler,h=new u.Vector3;let d=!1;return()=>{if(d)return;d=!0;const m=n.renderManager;h.set(t.offset.x,t.offset.y,t.offset.z).applyEuler(s.rotation),h.set(s.position.x+h.x,s.position.y+h.y,s.position.z+h.z),c.lookAt(s.position,h,s.up),l.setFromRotationMatrix(c);const f={x:i.position.x,y:i.position.y,z:i.position.z},y={x:i.rotation.x,y:i.rotation.y,z:i.rotation.z},g=new N.Tween(i.position).to({x:h.x,y:h.y,z:h.z}).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start(),M=new N.Tween(i.rotation).to({x:l.x,y:l.y,z:l.z}).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start(),C=O=>{g.update(),M.update()};m.addEventListener("render",C),g.onComplete(()=>{if(m.removeEventListener("render",C),o.position.x=h.x,o.position.y=h.y,o.position.z=h.z,o.rotation.x=l.x,o.rotation.y=l.y,o.rotation.z=l.z,d=!1,t.back){const O=()=>{const T=new N.Tween(i.position).to(f).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start(),P=new N.Tween(i.rotation).to(y).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start(),R=L=>{T.update(),P.update()};T.onComplete(()=>{m.removeEventListener("render",R),o.position.x=f.x,o.position.y=f.y,o.position.z=f.z,o.rotation.x=y.x,o.rotation.y=y.y,o.rotation.z=y.z}),m.addEventListener("render",R),document.removeEventListener("dblclick",O)};document.addEventListener("dblclick",O)}})}},To={name:"colorChange",params:{target:"",attribute:"color",color:"rgb(255, 255, 255)",delay:0,duration:500,timingFunction:r.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},So=function(n,e){const t=e.params,i=n.getObjectBySymbol(t.target);if(!i)return console.warn(`real time animation ColorChange: can not found vid material: ${t.target}`),()=>{};if(!i[t.attribute]||!(i[t.attribute]instanceof u.Color))return console.warn(`real time animation ColorChange: material attribute is illeage: ${t.attribute}`),()=>{};const o=n.getConfigBySymbol(t.target);if(!o)return console.warn(`real time animation ColorChange: can not found material config: ${t.target}`),()=>{};const s=new u.Color(t.color),c=n.renderManager;let l=!1;return()=>{if(l)return;l=!0;const h=new N.Tween(i[t.attribute]).to({r:s.r,g:s.g,b:s.b}).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start(),d=m=>{h.update()};c.addEventListener("render",d),h.onComplete(()=>{c.removeEventListener("render",d),o[t.attribute]=t.color,l=!1})}},Oo={name:"orbitTargetMove",params:{target:"",offset:{x:0,y:0,z:0},delay:0,duration:1e3,timingFunction:r.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},Co=function(n,e){const t=e.params;if(n.compilerManager,!n.orbitControls)return console.warn("real time animation orbitTargetMove: engine can not install orbitControls."),()=>{};const i=n.renderManager;let o=!1;return()=>{if(o)return;o=!0;let s=t.offset;if(t.target){const h=n.getObjectBySymbol(t.target);h?s={x:h.matrixWorld.elements[12]+s.x,y:h.matrixWorld.elements[13]+s.y,z:h.matrixWorld.elements[14]+s.z}:console.warn(`real time animation orbitTargetMove: can not found vid object: ${t.target}`)}const c=new N.Tween(n.orbitControls.target).to(s).duration(t.duration).delay(t.delay).easing(U[t.timingFunction]).start(),l=h=>{c.update()};i.addEventListener("render",l),c.onComplete(()=>{i.removeEventListener("render",l),o=!1})}},ne=class{static generateConfig(e,t){if(!ne.configLibrary.has(e))return console.warn(`event library can not found config by name: ${e}`),{name:""};const i=(s,c)=>{for(const l in c)typeof c[l]=="object"&&c[l]!==null&&!Array.isArray(c[l])?i(s[l],c[l]):s[l]=c[l]},o=JSON.parse(JSON.stringify(ne.configLibrary.get(e)));return i(o,t),o}static generateEvent(e,t){return ne.generatorLibrary.has(e.name)?ne.generatorLibrary.get(e.name)(t,e):(console.error(`event library can not found generator by name: ${e.name}`),()=>{})}static has(e){return ne.configLibrary.has(e)}};let D=ne;a(D,"configLibrary",new Map),a(D,"generatorLibrary",new Map),a(D,"register",function(e,t){ne.configLibrary.has(e.name)&&console.warn(`EventLibrary has already exist this event generator: ${e.name}, that will be cover.`),ne.configLibrary.set(e.name,JSON.parse(JSON.stringify(e))),ne.generatorLibrary.set(e.name,t)}),D.register(xr,zr),D.register(kr,Vr),D.register($r,Wr),D.register(_r,Qr),D.register(Xr,Kr),D.register(Zr,Jr),D.register(qr,eo),D.register(to,no),D.register(io,ro),D.register(oo,so),D.register(ao,co),D.register(lo,uo),D.register(ho,po),D.register(mo,fo),D.register(go,Eo),D.register(yo,Mo),D.register(To,So),D.register(Oo,Co);const fn=new WeakMap,gn=function({target:n,config:e,value:t,engine:i}){if(e.vid===t){console.warn("can not set object lookAt itself.");return}let o=fn.get(n);if(o||(o={lookAtTarget:null,updateMatrixWorldFun:null},fn.set(n,o)),!t){if(!o.updateMatrixWorldFun)return;n.updateMatrixWorld=o.updateMatrixWorldFun,o.lookAtTarget=null,o.updateMatrixWorldFun=null;return}const s=i.compilerManager.getObject3D(t);if(!s){console.warn(`lookAt handler can not found this vid mapping object: '${t}'`);return}const c=n.updateMatrixWorld;o.updateMatrixWorldFun=c,o.lookAtTarget=s.position,n.updateMatrixWorld=l=>{c.call(n,l),n.lookAt(o.lookAtTarget)}},ze="vis.event",re=function({target:n,path:e,value:t,engine:i}){const o=e[0];if(!D.has(t.name)){console.warn(`EventLibrary: can not support this event: ${t.name}`);return}const s=D.generateEvent(t,i),c=Symbol.for(ze);t[c]=s,n.addEventListener(o,s)},pe=function({target:n,path:e,value:t}){const i=e[0],o=t[Symbol.for(ze)];if(!o){console.warn("event remove can not fun found event in config",t);return}n.removeEventListener(i,o),delete t[Symbol.for(ze)]},me=function({target:n,config:e,path:t,engine:i}){const o=t[0],s=e[t[0]][t[1]],c=s[Symbol.for(ze)];if(!c){console.warn("event remove can not fun found event in config",s);return}n.removeEventListener(o,c);const l=D.generateEvent(e,i);s[ze]=l,n.addEventListener(o,l)},En=function({target:n,config:e,value:t,engine:i}){const o=i.getConfigBySymbol(t);if(!o){console.warn(` can not foud object parent config in engine: ${t}`);return}if(o.parent&&o.parent!==e.vid){const c=i.getConfigBySymbol(o.parent);if(!c){console.warn(` can not foud object parent config in engine: ${o.parent}`);return}c.children.splice(c.children.indexOf(t),1)}o.parent=e.vid;const s=i.compilerManager.getObject3D(t);if(!s){console.warn(`can not found this vid in engine: ${t}.`);return}n.add(s)},bo=function({target:n,config:e,value:t,engine:i}){const o=i.compilerManager.getObject3D(t);if(!o){console.warn(`can not found this vid in engine: ${t}.`);return}n.remove(o);const s=i.getConfigBySymbol(t);if(!s){console.warn(`can not found this vid in engine: ${t}.`);return}s.parent=""},Oe=function(n,e,t={},i){return Promise.resolve().then(()=>{!t.lookAt&&gn({target:n,config:e,engine:i,value:e.lookAt}),e.children.forEach(s=>{En({target:n,config:e,value:s,engine:i})});for(const s of Object.values(r.EVENTNAME))e[s].forEach((c,l)=>{re({target:n,path:[s,l.toString()],value:c,engine:i})})}),ue(e,n,Y({type:!0,lookAt:!0,parent:!0,children:!0,pointerdown:!0,pointermove:!0,pointerup:!0,pointerenter:!0,pointerleave:!0,click:!0,dblclick:!0,contextmenu:!0},t)),n},ee=function(n){n._listener={}},j={add:{pointerdown:re,pointerup:re,pointermove:re,pointerenter:re,pointerleave:re,click:re,dblclick:re,contextmenu:re,children:En},set:{lookAt:gn,pointerdown:me,pointerup:me,pointermove:me,pointerenter:me,pointerleave:me,click:me,dblclick:me,contextmenu:me},delete:{pointerdown:pe,pointerup:pe,pointermove:pe,pointerenter:pe,pointerleave:pe,click:pe,dblclick:pe,contextmenu:pe,children:bo}},Q=new WeakMap;var Lo=I({configType:r.CONFIGTYPE.PERSPECTIVECAMERA,commands:{add:Y({scale(){}},j.add),set:Ht(Y({scale(){},adaptiveWindow({target:n,value:e,engine:t}){if(e){if(!Q.has(e)){const i=o=>{n.aspect=o.width/o.height,n.updateProjectionMatrix()};Q.set(n,i),t.addEventListener("setSize",i),i({type:"setSize",width:t.dom.offsetWidth,height:t.dom.offsetHeight})}}else{const i=Q.get(n);i&&(t.removeEventListener("setSize",i),Q.delete(n))}}},j.set),{$reg:[{reg:new RegExp("fov|aspect|near|far"),handler({target:n,key:e,value:t}){n[e]=t,n.updateProjectionMatrix()}}]}),delete:Y({scale(){}},j.delete)},create(n,e){const t=new u.PerspectiveCamera;if(Oe(t,n,{scale:!0,adaptiveWindow:!0},e),t.updateProjectionMatrix(),n.adaptiveWindow){const i=o=>{t.aspect=o.width/o.height,t.updateProjectionMatrix()};Q.set(t,i),e.addEventListener("setSize",i),i({type:"setSize",width:e.dom.offsetWidth,height:e.dom.offsetHeight})}return t},dispose(n){Q.delete(n),ee(n)}}),vo=I({configType:r.CONFIGTYPE.ORTHOGRAPHICCAMERA,commands:{add:Y({scale(){}},j.add),set:Ht(Y({scale(){},adaptiveWindow({target:n,value:e,engine:t}){if(e){if(!Q.has(e)){const i=o=>{const s=o.width,c=o.height;n.left=-s,n.right=s,n.top=c,n.bottom=-c,n.updateProjectionMatrix()};Q.set(n,i),t.addEventListener("setSize",i),i({type:"setSize",width:t.dom.offsetWidth,height:t.dom.offsetHeight})}}else{const i=Q.get(n);i&&(t.removeEventListener("setSize",i),Q.delete(n))}}},j.set),{$reg:[{reg:new RegExp("left|right|top|bottom|near|far|zoom"),handler({target:n,key:e,value:t}){n[e]=t,n.updateProjectionMatrix()}}]}),delete:Y({scale(){}},j.delete)},create(n,e){const t=new u.OrthographicCamera(-50,50,50,-50);if(Oe(t,n,{scale:!0,adaptiveWindow:!0},e),t.updateProjectionMatrix(),n.adaptiveWindow){const i=o=>{const s=o.width,c=o.height;t.left=-s,t.right=s,t.top=c,t.bottom=-c,t.updateProjectionMatrix()};Q.set(t,i),e.addEventListener("setSize",i),i({type:"setSize",width:e.dom.offsetWidth,height:e.dom.offsetHeight})}return t},dispose(n){Q.delete(n),ee(n)}});class Po extends Se{constructor(){super();a(this,"MODULE",r.MODULETYPE.CAMERA)}}b.processor(Lo),b.processor(vo);class wo extends Et{constructor(){super();a(this,"config");a(this,"target");a(this,"engine")}assemble(e){return this.config=e.config,this.target=e.control,this.engine=e.engine,this.assembly=!0,this}process(e){return this.assembly?e.key==="target"||e.path.length&&e.path[0]==="target"?(this.setTarget(this.config.target),this):(this.mergeAttribute([],e.key,e.value),this):(console.warn("OrbitControls Processor unassembled"),this)}setTarget(e){typeof e=="object"&&e!==null&&(this.target.target=new u.Vector3(e.x,e.y,e.z))}dispose(){return this.config=void 0,this.target=void 0,this.assembly=!1,this}}class Io extends Et{constructor(){super();a(this,"config");a(this,"target");a(this,"filterMap",{translationSnap:!0,rotationSnap:!0,scaleSnap:!0})}assemble(e){return this.config=e.config,this.target=e.control,this.assembly=!0,this}process(e){return this.assembly?this.filterMap[e.key]?this:this[e.key]?(this[e.key](e.value),this):(this.mergeAttribute([],e.key,e.value),this):(console.warn("transformControls Processor unassembled"),this)}dispose(){return this.config=void 0,this.target=void 0,this}snapAllow(e){const t=this.config,i=this.target;return e?(i.translationSnap=t.translationSnap,i.rotationSnap=t.rotationSnap,i.scaleSnap=t.scaleSnap):(i.translationSnap=null,i.rotationSnap=null,i.scaleSnap=null),!0}}class Ro extends b{constructor(){super();a(this,"MODULE",r.MODULETYPE.CONTROLS);a(this,"target",{});a(this,"map",new Map);a(this,"weakMap",new Map);a(this,"engine");a(this,"processorMap",{[r.CONFIGTYPE.TRNASFORMCONTROLS]:new Io,[r.CONFIGTYPE.ORBITCONTROLS]:new wo})}getAssembly(e){const t=this.target[e];if(!t)return console.warn(`controls compiler can not found this config: '${e}'`),null;const i=this.processorMap[t.type];if(!i)return console.warn(`controls compiler can not support this controls: '${e}'`),null;const o=this.map.get(t.type);return o?{config:t,processer:i,control:o}:(console.warn(`controls compiler can not found type of control: '${t.type}'`),null)}set(e,t,i,o){const s=this.getAssembly(e);return s?(s.processer.assemble({config:s.config,control:s.control,engine:this.engine}).process({key:i,path:t,value:o}),this):this}setAll(e){const t=this.getAssembly(e);return t?(t.processer.assemble({config:t.config,control:t.control,engine:this.engine}).processAll().dispose(),this):this}setTarget(e){return this.target=e,this}useEngine(e){return e.transformControls&&(this.map.set(r.CONFIGTYPE.TRNASFORMCONTROLS,e.transformControls),this.weakMap.set(e.transformControls,r.CONFIGTYPE.TRNASFORMCONTROLS)),e.orbitControls&&(this.map.set(r.CONFIGTYPE.ORBITCONTROLS,e.orbitControls),this.weakMap.set(e.orbitControls,r.CONFIGTYPE.ORBITCONTROLS)),this.engine=e,this}compileAll(){for(const e of Object.keys(this.target)){const t=this.getAssembly(e);!t||t.processer.assemble({config:t.config,control:t.control,engine:this.engine}).processAll().dispose()}return this}dispose(){return this.map.forEach(e=>{e.dispose&&e.dispose()}),this.map.clear(),this}getObjectSymbol(e){return this.weakMap.get(e)||null}getObjectBySymbol(e){return this.map.get(e)||null}}class No extends Ye.CSS3DObject{constructor(e=document.createElement("div")){const t=document.createElement("div"),i=50,o=50;t.style.width=`${i}px`,t.style.height=`${o}px`,t.appendChild(e);super(t);a(this,"geometry");a(this,"_width");a(this,"_height");a(this,"cacheBox",new u.Box3);this.geometry=new u.PlaneBufferGeometry(i,o),this.geometry.computeBoundingBox(),this._width=i,this._height=o}get width(){return this._width}set width(e){this.geometry.dispose(),this.geometry=new u.PlaneBufferGeometry(e,this._height),this.geometry.computeBoundingBox(),this.element.style.width=`${e}px`,this._width=e}get height(){return this._height}set height(e){this.geometry.dispose(),this.geometry=new u.PlaneBufferGeometry(this._width,e),this.geometry.computeBoundingBox(),this.element.style.height=`${e}px`,this._height=e}}class Go extends No{constructor(e=document.createElement("div")){super(e);this.element.classList.add("vis-css3d-plane")}raycast(e,t){const i=this.cacheBox.copy(this.geometry.boundingBox);i.applyMatrix4(this.matrixWorld),e.ray.intersectsBox(i)&&t.push({distance:e.ray.origin.distanceTo(this.position),object:this,point:this.position})}}const yn=function(n,e){const t=e.resourceManager.resourceMap;if(!t.has(n))return console.warn(`css3D compiler: can not found resource element: ${n}`),document.createElement("div");const i=t.get(n);return i instanceof HTMLElement?i:(console.warn("css3D compiler can not suport render this resource type.",i.constructor,n),document.createElement("div"))};var Ao=I({configType:r.CONFIGTYPE.CSS3DPLANE,commands:{add:j.add,set:Y({element({target:n,value:e,engine:t}){n.element=yn(e,t)}},j.set),delete:j.delete},create(n,e){return Oe(new Go(yn(n.element,e)),n,{element:!0},e)},dispose:ee});class Do extends Se{constructor(){super();a(this,"MODULE",r.MODULETYPE.CSS3D)}}b.processor(Ao);class Ie extends u.BufferGeometry{constructor(e=[],t=36,i=!0){super();a(this,"parameters");this.type="CurveGeometry",this.parameters={path:e.map(o=>o.clone()),space:i,divisions:t}}}class Uo extends Ie{constructor(e=[],t=36,i=!0){super(e,t,i);this.type="QuadraticBezierCurveGeometry";const o=new u.CurvePath;if(e.length<3){console.warn("QuadraticBezierCurveGeometry path length at least 3.");return}const s=3+(e.length-3)-(e.length-3)%2;for(let l=1;l<s;l+=2)o.add(new u.QuadraticBezierCurve3(e[l-1],e[l],e[l+1]));const c=o.curves.reduce((l,h)=>l+=h.arcLengthDivisions,0);if(t>c){const l=Math.ceil((t-c)/o.curves.length);o.curves.forEach(h=>{h.arcLengthDivisions=h.arcLengthDivisions*(l+1),h.updateArcLengths()})}this.setFromPoints(i?o.getSpacedPoints(t):o.getPoints(t))}}class Fo extends Ie{constructor(e=[],t=36,i=!0){super(e,t,i);this.type="CubicBezierCurveGeometry";const o=new u.CurvePath;if(e.length<4){console.warn("CubicBezierCurveGeometry path length at least 4.");return}const s=4+(e.length-4)-(e.length-4)%3;for(let l=2;l<s;l+=3)o.add(new u.CubicBezierCurve3(e[l-2],e[l-1],e[l],e[l+1]));const c=o.curves.reduce((l,h)=>l+=h.arcLengthDivisions,0);if(t>c){const l=Math.ceil((t-c)/o.curves.length);o.curves.forEach(h=>{h.arcLengthDivisions=h.arcLengthDivisions*(l+1),h.updateArcLengths()})}this.setFromPoints(i?o.getSpacedPoints(t):o.getPoints(t))}}class Yo extends Ie{constructor(e=[],t=36,i=!0){super(e,t,i);if(this.type="LineCurveGeometry",!e.length){console.warn("LineCurveGeometry path length at least 1.");return}const o=new u.CurvePath;for(let c=1;c<e.length;c+=1)o.add(new u.LineCurve3(e[c-1],e[c]));const s=o.curves.reduce((c,l)=>c+=l.arcLengthDivisions,0);if(t>s){const c=Math.ceil((t-s)/o.curves.length);o.curves.forEach(l=>{l.arcLengthDivisions=l.arcLengthDivisions*(c+1),l.updateArcLengths()})}this.setFromPoints(i?o.getSpacedPoints(t):o.getPoints(t))}}class jo extends Ie{constructor(e=[],t=36,i=!0){super(e,t,i);if(this.type="SplineCurveGeometry",!e.length){console.warn("SplineCurveGeometry path length at least 1.");return}const o=new u.CatmullRomCurve3(e);this.setFromPoints(i?o.getSpacedPoints(t):o.getPoints(t))}}class Bo extends u.TubeGeometry{constructor(e=[],t=64,i=1,o=8,s=!1){if(!e.length){console.warn("LineTubeGeometry path length at least 1.");return}const c=new u.CurvePath;for(let l=1;l<e.length;l+=1)c.add(new u.LineCurve3(e[l-1],e[l]));super(c,t,i,o,s);this.type="LineTubeGeometry"}}class Ho extends u.TubeGeometry{constructor(e=[],t=64,i=1,o=8,s=!1){if(!e.length){console.warn("SplineTubeGeometry path length at least 1.");return}const c=new u.CatmullRomCurve3(e);super(c,t,i,o,s);this.type="SplineTubeGeometry"}}class xo extends u.ShapeBufferGeometry{constructor(e=[new u.Vector2(0,0)],t=12){const i=new u.Shape,o=e[0];if(o){i.moveTo(o.x,o.y);for(let s=1;s<e.length;s+=1)i.lineTo(e[s].x,e[s].y)}super(i,t);this.type="LineShapeGeometry"}}const zo=function(n,e){!(n instanceof Ie)&&!(n instanceof u.TubeGeometry)&&!(n instanceof u.ShapeGeometry)&&n.center(),n.computeBoundingBox();const t=n.boundingBox,i=e.position,o=e.rotation,s=e.scale,c=new u.Quaternion().setFromEuler(new u.Euler(o.x,o.y,o.z,"XYZ"));return n.applyQuaternion(c),n.scale(s.x,s.y,s.z),!(n instanceof Ie)&&!(n instanceof u.TubeGeometry)&&!(n instanceof u.ShapeGeometry)&&n.center(),n.computeBoundingBox(),n.translate((t.max.x-t.min.x)/2*i.x,(t.max.y-t.min.y)/2*i.y,(t.max.z-t.min.z)/2*i.z),n},yt={reg:new RegExp(".*"),handler({config:n,target:e,processor:t,engine:i}){const o=t.create(n,i);e.copy(o),e.dispatchEvent({type:"update"}),e.uuid=o.uuid,o.dispose()}},Ze={add:{groups({target:n,value:e}){n.addGroup(e.start,e.count,e.materialIndex)},$reg:[yt]},set:{groups(n){const{path:e,target:t,config:i}=n;if(e[1]!==void 0){t.groups.splice(Number(n.path[1]),1);const o=i.groups[e[1]];t.addGroup(o.start,o.count,o.materialIndex)}else console.warn("geometry processor can not set group",n)},$reg:[yt]},delete:{groups({target:n,key:e}){n.groups.splice(Number(e),1)},$reg:[yt]}},Je=function(n,e){n.clearGroups();for(const t of e.groups)n.addGroup(t.start,t.count,t.materialIndex);return zo(n,e)},B=new Map;B.set(r.CONFIGTYPE.BOXGEOMETRY,n=>new u.BoxBufferGeometry(n.width,n.height,n.depth,n.widthSegments,n.heightSegments,n.depthSegments)),B.set(r.CONFIGTYPE.SPHEREGEOMETRY,n=>new u.SphereBufferGeometry(n.radius,n.widthSegments,n.heightSegments,n.phiStart,n.phiLength,n.thetaStart,n.thetaLength)),B.set(r.CONFIGTYPE.PLANEGEOMETRY,n=>new u.PlaneBufferGeometry(n.width,n.height,n.widthSegments,n.heightSegments)),B.set(r.CONFIGTYPE.CIRCLEGEOMETRY,n=>new u.CircleBufferGeometry(n.radius,n.segments,n.thetaStart,n.thetaLength)),B.set(r.CONFIGTYPE.CONEGEOMETRY,n=>new u.ConeBufferGeometry(n.radius,n.height,n.radialSegments,n.heightSegments,n.openEnded,n.thetaStart,n.thetaLength)),B.set(r.CONFIGTYPE.CYLINDERGEOMETRY,n=>new u.CylinderBufferGeometry(n.radiusTop,n.radiusBottom,n.height,n.radialSegments,n.heightSegments,n.openEnded,n.thetaStart,n.thetaLength)),B.set(r.CONFIGTYPE.LINECURVEGEOMETRY,n=>new Yo(n.path.map(e=>new u.Vector3(e.x,e.y,e.z)),n.divisions,n.space)),B.set(r.CONFIGTYPE.SPLINECURVEGEOMETRY,n=>new jo(n.path.map(e=>new u.Vector3(e.x,e.y,e.z)),n.divisions,n.space)),B.set(r.CONFIGTYPE.CUBICBEZIERCURVEGEOMETRY,n=>new Fo(n.path.map(e=>new u.Vector3(e.x,e.y,e.z)),n.divisions,n.space)),B.set(r.CONFIGTYPE.QUADRATICBEZIERCURVEGEOMETRY,n=>new Uo(n.path.map(e=>new u.Vector3(e.x,e.y,e.z)),n.divisions,n.space)),B.set(r.CONFIGTYPE.LINETUBEGEOMETRY,n=>new Bo(n.path.map(e=>new u.Vector3(e.x,e.y,e.z)),n.tubularSegments,n.radius,n.radialSegments,n.closed)),B.set(r.CONFIGTYPE.SPLINETUBEGEOMETRY,n=>new Ho(n.path.map(e=>new u.Vector3(e.x,e.y,e.z)),n.tubularSegments,n.radius,n.radialSegments,n.closed)),B.set(r.CONFIGTYPE.TORUSGEOMETRY,n=>new u.TorusGeometry(n.radius,n.tube,n.radialSegments,n.tubularSegments,n.arc)),B.set(r.CONFIGTYPE.RINGGEOMETRY,n=>new u.RingBufferGeometry(n.innerRadius,n.outerRadius,n.thetaSegments,n.phiSegments,n.thetaStart,n.thetaLength)),B.set(r.CONFIGTYPE.LINESHAPEGEOMETRY,n=>new xo(n.path.map(e=>new u.Vector2(e.x,e.y)),n.curveSegments));const ko=function(n){return B.has(n.type)?Je(B.get(n.type)(n),n):(console.error(`parametric geometry can not support this type config: ${n.type}`),new u.BufferGeometry)},Vo=function(n){n.dispose()},$o=function(n){return I({configType:n,commands:Ze,create:ko,dispose:Vo})},Wo=[r.CONFIGTYPE.BOXGEOMETRY,r.CONFIGTYPE.SPHEREGEOMETRY,r.CONFIGTYPE.PLANEGEOMETRY,r.CONFIGTYPE.CIRCLEGEOMETRY,r.CONFIGTYPE.CONEGEOMETRY,r.CONFIGTYPE.CYLINDERGEOMETRY,r.CONFIGTYPE.LINECURVEGEOMETRY,r.CONFIGTYPE.SPLINECURVEGEOMETRY,r.CONFIGTYPE.CUBICBEZIERCURVEGEOMETRY,r.CONFIGTYPE.QUADRATICBEZIERCURVEGEOMETRY,r.CONFIGTYPE.LINETUBEGEOMETRY,r.CONFIGTYPE.SPLINETUBEGEOMETRY,r.CONFIGTYPE.TORUSGEOMETRY,r.CONFIGTYPE.RINGGEOMETRY,r.CONFIGTYPE.LINESHAPEGEOMETRY].map(n=>$o(n));class _o extends u.BufferGeometry{constructor(e){super();a(this,"type","LoadBufferGeometry");e&&this.copy(e)}}var Qo=I({configType:r.CONFIGTYPE.LOADGEOMETRY,commands:Ze,create(n,e){const t=e.resourceManager.resourceMap.get(n.url);return!t&&!(t instanceof u.BufferGeometry)?(console.error(`engine rescoure can not found url: ${n.url}`),new u.BoxBufferGeometry(5,5,5)):Je(new _o(t),n)},dispose(n){n.dispose()}});const Xo=function(n){const e=new u.BufferGeometry;return n.position.length&&e.setAttribute("position",new u.Float32BufferAttribute(n.position,3)),n.color.length&&e.setAttribute("color",new u.Float32BufferAttribute(n.color,3)),n.normal.length&&e.setAttribute("normal",new u.Float32BufferAttribute(n.normal,3)),n.uv.length&&e.setAttribute("uv",new u.Float32BufferAttribute(n.uv,2)),n.uv2.length&&e.setAttribute("uv2",new u.Float32BufferAttribute(n.uv2,2)),n.index.length&&e.setIndex(n.index),e};var Ko=I({configType:r.CONFIGTYPE.CUSTOMGEOMETRY,commands:Ze,create(n){return Je(Xo(n.attribute),n)},dispose(n){n.dispose()}}),Zo=I({configType:r.CONFIGTYPE.EDGESGEOMETRY,commands:Ze,create(n,e){const t=e.compilerManager.getObjectBySymbol(n.url);return!t||!(t instanceof u.BufferGeometry)?(console.error(`engine rescoure can not found url: ${n.url}`),new u.EdgesGeometry(new u.BoxBufferGeometry(5,5,5))):Je(new u.EdgesGeometry(t),n)},dispose(n){n.dispose()}});class Jo extends b{constructor(){super();a(this,"MODULE",r.MODULETYPE.GEOMETRY)}}Wo.forEach(n=>{b.processor(n)}),b.processor(Qo),b.processor(Ko),b.processor(Zo);var qo=I({configType:r.CONFIGTYPE.GROUP,commands:j,create(n,e){return Oe(new u.Group,n,{},e)},dispose:ee});class es extends Se{constructor(){super();a(this,"MODULE",r.MODULETYPE.GROUP)}}b.processor(qo);const ts=function({target:n,value:e}){n.color.copy(new u.Color(e))},Mt=function({}){},qe=function(n,e,t={},i){return n.color.copy(new u.Color(e.color)),Oe(n,e,Y({color:!0,scale:!0,rotation:!0,lookAt:!0},t),i)},et=Object.assign({},j,{set:{color:ts,scale:Mt,rotation:Mt,lookAt:Mt}});var ns=I({configType:r.CONFIGTYPE.AMBIENTLIGHT,commands:et,create(n,e){return qe(new u.AmbientLight,n,{},e)},dispose:ee}),is=I({configType:r.CONFIGTYPE.DIRECTIONALLIGHT,commands:et,create(n,e){return qe(new u.DirectionalLight,n,{},e)},dispose:ee}),rs=I({configType:r.CONFIGTYPE.POINTLIGHT,commands:et,create(n,e){return qe(new u.PointLight,n,{},e)},dispose:ee}),os=I({configType:r.CONFIGTYPE.SPOTLIGHT,commands:et,create(n,e){return qe(new u.SpotLight,n,{},e)},dispose:ee});class ss extends Se{constructor(){super();a(this,"MODULE",r.MODULETYPE.LIGHT)}}b.processor(ns),b.processor(is),b.processor(rs),b.processor(os);class tt extends Se{constructor(){super();a(this,"IS_SOLIDOBJECTCOMPILER",!0)}}const nt=new u.ShaderMaterial({fragmentShader:`
  void main () {
    gl_FragColor = vec4(0.5, 0.5, 0.5, 1.0);
  }
  `}),Mn=new u.BoxBufferGeometry(10,10,10),as=function({target:n,value:e,engine:t}){const i=t.compilerManager.getGeometry(e);if(!i){console.warn(`can not found geometry by vid in engine: ${e}`),n.geometry=Mn;return}n.geometry=i},Tt=function({target:n,config:e,engine:t}){let i;typeof e.material=="string"?i=t.compilerManager.getMaterial(e.material)||nt:i=e.material.map(o=>t.compilerManager.getMaterial(o)||nt),n.material=i},it=function(n,e,t={},i){if(!n.isSprite){let s=i.getObjectBySymbol(e.geometry);s instanceof u.BufferGeometry||(console.warn(`geometry vid in engine is not instance of BufferGeometry: ${e.geometry}`,s),s=Mn),n.geometry.dispose(),n.geometry=s}let o;return typeof e.material=="string"?o=i.compilerManager.getMaterial(e.material)||nt:o=e.material.map(s=>i.compilerManager.getMaterial(s)||nt),n.material=o,Oe(n,e,Y({geometry:!0,material:!0},t),i)},rt=function(n){ee(n)},Re={add:Y({material:Tt},j.add),set:Y({geometry:as,material:Tt},j.set),delete:Y({material:Tt},j.delete)};var cs=I({configType:r.CONFIGTYPE.LINE,commands:Re,create(n,e){return it(new u.Line,n,{},e)},dispose:rt});class ls extends tt{constructor(){super();a(this,"MODULE",r.MODULETYPE.LINE)}}b.processor(cs);const Ce={reg:new RegExp("transparent|sizeAttenuation"),handler({target:n,key:e,value:t,engine:i}){n[e]=t,n.needsUpdate=!0}},Ne={reg:new RegExp("map$","i"),handler({target:n,key:e,value:t,engine:i}){const o=i.resourceManager.resourceMap.get(t);o instanceof u.Texture||console.warn(`this url resource is not instance of Texture: ${e}`,t,o),n[e]=o,n.needsUpdate=!0}},oe=function({target:n,key:e,value:t}){n[e].copy(new u.Color(t))},Ge=function(n,e,t){const i={};for(const o of Object.keys(e))if(o.toLocaleLowerCase().endsWith("map")&&e[o]){const s=t.compilerManager.getObjectBySymbol(e[o]);if(!(s instanceof u.Texture)){console.warn(`this url resource is not instance of Texture: ${o}`,e[o],s);continue}n[o]=s,i[o]=!0}else["color","emissive","specular"].includes(o)&&(n[o]=new u.Color(e[o]),i[o]=!0);return ue(e,n,i),n.needsUpdate=!0,n},be=function(n){n.dispose()};var Tn=I({configType:r.CONFIGTYPE.LINEBASICMATERIAL,commands:{set:{color:oe,$reg:[Ne,Ce]}},create:function(n,e){return Ge(new u.LineBasicMaterial,n,e)},dispose:be}),us=I({configType:r.CONFIGTYPE.MESHBASICMATERIAL,commands:{set:{color:oe,$reg:[Ne,Ce]}},create:function(n,e){return Ge(new u.MeshBasicMaterial,n,e)},dispose:be}),ds=I({configType:r.CONFIGTYPE.MESHPHONGMATERIAL,commands:{set:{color:oe,emissive:oe,specular:oe,$reg:[Ne,Ce]}},create:function(n,e){return Ge(new u.MeshPhongMaterial,n,e)},dispose:be}),hs=I({configType:r.CONFIGTYPE.MESHSTANDARDMATERIAL,commands:{set:{color:oe,emissive:oe,$reg:[Ne,Ce]}},create:function(n,e){return Ge(new u.MeshStandardMaterial,n,e)},dispose:be}),ps=I({configType:r.CONFIGTYPE.POINTSMATERIAL,commands:{set:{color:oe,$reg:[Ne,Ce]}},create:function(n,e){return Ge(new u.PointsMaterial,n,e)},dispose:be}),ms=I({configType:r.CONFIGTYPE.SHADERMATERIAL,commands:{set:{shader({target:n,value:e}){const t=_.getShader(e);(t==null?void 0:t.vertexShader)&&(n.vertexShader=t.vertexShader),(t==null?void 0:t.fragmentShader)&&(n.fragmentShader=t.fragmentShader),(t==null?void 0:t.uniforms)&&(n.uniforms=t.uniforms),(t==null?void 0:t.defines)&&(n.defines=t.defines),n.needsUpdate=!0},$reg:[Ce]}},create:function(n,e){const t=new u.ShaderMaterial,i=_.getShader(n.shader);return(i==null?void 0:i.vertexShader)&&(t.vertexShader=i.vertexShader),(i==null?void 0:i.fragmentShader)&&(t.fragmentShader=i.fragmentShader),(i==null?void 0:i.uniforms)&&(t.uniforms=i.uniforms),(i==null?void 0:i.defines)&&(t.defines=i.defines),ue(n,t,{type:!0,shader:!0}),t.needsUpdate=!0,t},dispose:be}),fs=I({configType:r.CONFIGTYPE.SPRITEMATERIAL,commands:{set:{color:oe,$reg:[Ne,Ce]}},create:function(n,e){return Ge(new u.SpriteMaterial,n,e)},dispose:be});class gs extends b{constructor(){super();a(this,"MODULE",r.MODULETYPE.MATERIAL)}}b.processor(us),b.processor(hs),b.processor(ds),b.processor(Tn),b.processor(ps),b.processor(fs),b.processor(Tn),b.processor(ms);var Es=I({configType:r.CONFIGTYPE.MESH,commands:Re,create(n,e){return it(new u.Mesh,n,{},e)},dispose:rt});class ys extends tt{constructor(){super();a(this,"MODULE",r.MODULETYPE.MESH)}}b.processor(Es);var Ms=I({configType:r.CONFIGTYPE.SMAAPASS,create(n,e){return new kn.SMAAPass(e.dom.offsetWidth,e.dom.offsetHeight)},dispose(n){}}),Ts=I({configType:r.CONFIGTYPE.UNREALBLOOMPASS,create(n){return new Vn.UnrealBloomPass(new u.Vector2(n.resolution.x,n.resolution.y),n.strength,n.radius,n.threshold)},dispose(n){n.dispose()}});const ct=class extends xt.Pass{constructor(e=new u.Vector2(256,256),t=1,i=0,o=0,s=new u.Scene,c=new u.PerspectiveCamera,l){super();a(this,"resolution");a(this,"strength");a(this,"radius");a(this,"threshold");a(this,"selectedObjects",[]);a(this,"renderScene");a(this,"renderCamera");a(this,"clearColor",new u.Color(0,0,0));a(this,"renderTargetsHorizontal",[]);a(this,"renderTargetsVertical",[]);a(this,"nMips",5);a(this,"selectRenderTarget");a(this,"renderTargetBright");a(this,"highPassUniforms");a(this,"materialHighPassFilter");a(this,"separableBlurMaterials",[]);a(this,"compositeMaterial");a(this,"bloomTintColors");a(this,"mixMaterial");a(this,"enabled",!0);a(this,"needsSwap",!1);a(this,"_oldClearColor",new u.Color);a(this,"oldClearAlpha",1);a(this,"basic",new u.MeshBasicMaterial);a(this,"fsQuad",new xt.FullScreenQuad);a(this,"materialCache",new Map);a(this,"sceneBackgroundCache",null);a(this,"overrideBackground",new u.Color("black"));a(this,"overrideMeshMaterial",new u.MeshStandardMaterial({color:"black"}));a(this,"overrideLineMaterial",new u.LineBasicMaterial({color:"black"}));a(this,"overridePointsMaterial",new u.PointsMaterial({color:"black"}));a(this,"overrideSpriteMaterial",new u.SpriteMaterial({color:"black"}));this.resolution=e,this.strength=t,this.radius=i,this.threshold=o,this.renderScene=s,this.renderCamera=c,this.selectedObjects=l;let h=Math.round(this.resolution.x/2),d=Math.round(this.resolution.y/2);this.selectRenderTarget=new u.WebGLRenderTarget(h,d),this.selectRenderTarget.texture.name="UnrealBloomPass.selected",this.selectRenderTarget.texture.generateMipmaps=!1,this.renderTargetBright=new u.WebGLRenderTarget(h,d),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let g=0;g<this.nMips;g++){const M=new u.WebGLRenderTarget(h,d);M.texture.name="UnrealBloomPass.h"+g,M.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(M);const C=new u.WebGLRenderTarget(h,d);C.texture.name="UnrealBloomPass.v"+g,C.texture.generateMipmaps=!1,this.renderTargetsVertical.push(C),h=Math.round(h/2),d=Math.round(d/2)}zt.LuminosityHighPassShader===void 0&&console.error("THREE.UnrealBloomPass relies on LuminosityHighPassShader");const m=zt.LuminosityHighPassShader;this.highPassUniforms=u.UniformsUtils.clone(m.uniforms),this.highPassUniforms.luminosityThreshold.value=o,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new u.ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,defines:{}});const f=[3,5,7,9,11];h=Math.round(this.resolution.x/2),d=Math.round(this.resolution.y/2);for(let g=0;g<this.nMips;g++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(f[g])),this.separableBlurMaterials[g].uniforms.texSize.value=new u.Vector2(h,d),h=Math.round(h/2),d=Math.round(d/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;const y=[1,.8,.6,.4,.2];this.compositeMaterial.uniforms.bloomFactors.value=y,this.bloomTintColors=[new u.Vector3(1,1,1),new u.Vector3(1,1,1),new u.Vector3(1,1,1),new u.Vector3(1,1,1),new u.Vector3(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,this.mixMaterial=this.getMixMaterial()}dispose(){for(let e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose()}setSize(e,t){let i=Math.round(e/2),o=Math.round(t/2);this.selectRenderTarget.setSize(i,o),this.renderTargetBright.setSize(i,o);for(let s=0;s<this.nMips;s++)this.renderTargetsHorizontal[s].setSize(i,o),this.renderTargetsVertical[s].setSize(i,o),this.separableBlurMaterials[s].uniforms.texSize.value=new u.Vector2(i,o),i=Math.round(i/2),o=Math.round(o/2)}render(e,t,i,o,s){if(!this.selectedObjects.length){this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=i.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e));return}e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const c=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),s&&e.state.buffers.stencil.setTest(!1);const l=new Map;for(const m of this.selectedObjects)l.set(m,!0);const h=this.materialCache;this.renderScene.background&&(this.sceneBackgroundCache=this.renderScene.background,this.renderScene.background=this.overrideBackground),this.renderScene.traverse(m=>{!l.has(m)&&!m.isLight&&m.visible&&(h.set(m,m.material),m instanceof u.Mesh?m.material=this.overrideMeshMaterial:m instanceof u.Line?m.material=this.overrideLineMaterial:m instanceof u.Points?m.material=this.overridePointsMaterial:m instanceof u.Sprite&&(m.material=this.overrideSpriteMaterial))}),e.setRenderTarget(this.selectRenderTarget),e.clear(),e.render(this.renderScene,this.renderCamera),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=this.selectRenderTarget.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=this.selectRenderTarget.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);let d=this.renderTargetBright;for(let m=0;m<this.nMips;m++)this.fsQuad.material=this.separableBlurMaterials[m],this.separableBlurMaterials[m].uniforms.colorTexture.value=d.texture,this.separableBlurMaterials[m].uniforms.direction.value=ct.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[m]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[m].uniforms.colorTexture.value=this.renderTargetsHorizontal[m].texture,this.separableBlurMaterials[m].uniforms.direction.value=ct.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[m]),e.clear(),this.fsQuad.render(e),d=this.renderTargetsVertical[m];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.mixMaterial,this.mixMaterial.uniforms.bloom.value=this.renderTargetsHorizontal[0].texture,this.mixMaterial.uniforms.origin.value=i.texture,s&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(i),this.fsQuad.render(e)),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=c;for(const m of h.entries())m[0].material=m[1];h.clear(),this.sceneBackgroundCache&&(this.renderScene.background=this.sceneBackgroundCache,this.sceneBackgroundCache=null)}getMixMaterial(){return new u.ShaderMaterial({blending:u.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0,uniforms:{bloom:{value:null},origin:{value:null}},vertexShader:`
    
        varying vec2 vUv;
    
        void main() {
    
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
    
        }`,fragmentShader:`
        uniform sampler2D bloom;
        uniform sampler2D origin;
    
        varying vec2 vUv;
    
        void main() {
          vec3 bloomColor = texture2D(bloom, vUv).rgb;
          vec3 originColor = texture2D(origin, vUv).rgb;
          gl_FragColor = vec4(originColor + bloomColor, 1.0);
        }`})}getSeperableBlurMaterial(e){return new u.ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new u.Vector2(.5,.5)},direction:{value:new u.Vector2(.5,.5)}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 texSize;
				uniform vec2 direction;

				float gaussianPdf(in float x, in float sigma) {
					return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;
				}
				void main() {
					vec2 invSize = 1.0 / texSize;
					float fSigma = float(SIGMA);
					float weightSum = gaussianPdf(0.0, fSigma);
					vec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;
					for( int i = 1; i < KERNEL_RADIUS; i ++ ) {
						float x = float(i);
						float w = gaussianPdf(x, fSigma);
						vec2 uvOffset = direction * invSize * x;
						vec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;
						vec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;
						diffuseSum += (sample1 + sample2) * w;
						weightSum += 2.0 * w;
					}
					gl_FragColor = vec4(diffuseSum/weightSum, 1.0);
				}`})}getCompositeMaterial(e){return new u.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;
				uniform sampler2D blurTexture1;
				uniform sampler2D blurTexture2;
				uniform sampler2D blurTexture3;
				uniform sampler2D blurTexture4;
				uniform sampler2D blurTexture5;
				uniform float bloomStrength;
				uniform float bloomRadius;
				uniform float bloomFactors[NUM_MIPS];
				uniform vec3 bloomTintColors[NUM_MIPS];

				float lerpBloomFactor(const in float factor) {
					float mirrorFactor = 1.2 - factor;
					return mix(factor, mirrorFactor, bloomRadius);
				}

				void main() {
					gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +
						lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +
						lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +
						lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +
						lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );
				}`})}};let ke=ct;a(ke,"BlurDirectionX",new u.Vector2(1,0)),a(ke,"BlurDirectionY",new u.Vector2(0,1));var Ss=I({configType:r.CONFIGTYPE.SELECTIVEBLOOMPASS,commands:{add:{selectedObjects({target:n,engine:e,value:t}){const i=e.compilerManager.getObject3D(t);i?n.selectedObjects.push(i):console.warn(`selectiveBloomPassProcessor: can not found vid in engine: ${t}`)}},set:{renderScene({target:n,engine:e,value:t}){const i=e.compilerManager.getObject3D(t);i instanceof u.Scene&&(n.renderScene=i)},renderCamera({target:n,engine:e,value:t}){const i=e.compilerManager.getObject3D(t);i instanceof u.Camera&&(n.renderCamera=i)}},delete:{selectedObjects({target:n,engine:e,value:t}){const i=e.compilerManager.getObject3D(t);i?n.selectedObjects.includes(i)&&n.selectedObjects.splice(n.selectedObjects.indexOf(i),1):console.warn(`selectiveBloomPassProcessor: can not found vid in engine: ${t}`)}}},create(n,e){const t=[];for(const o of n.selectedObjects){const s=e.compilerManager.getObject3D(o);s&&t.push(s)}return new ke(new u.Vector2(n.resolution.x,n.resolution.y),n.strength,n.radius,n.threshold,n.renderScene&&e.compilerManager.getObject3D(n.renderScene)||void 0,n.renderCamera&&e.compilerManager.getObject3D(n.renderCamera)||void 0,t)},dispose(n){n.dispose()}});class Os extends b{constructor(){super();a(this,"MODULE",r.MODULETYPE.PASS);a(this,"composer")}useEngine(e){return super.useEngine(e),e.effectComposer?(this.composer=e.effectComposer,this):(console.warn("engine need install effectComposer plugin that can use pass compiler."),this)}add(e){const t=super.add(e);return t&&this.composer.addPass(t),t}remove(e){if(!this.map.has(e.vid))return console.warn(`PassCompiler can not found this vid pass: ${e.vid}.`),this;const t=this.map.get(e.vid);return this.composer.removePass(t),super.remove(e),this}}b.processor(Ms),b.processor(Ts),b.processor(Ss);var Cs=I({configType:r.CONFIGTYPE.POINTS,commands:Re,create(n,e){return it(new u.Points,n,{},e)},dispose:rt});class bs extends tt{constructor(){super();a(this,"MODULE",r.MODULETYPE.POINTS)}}b.processor(Cs);class Ls extends Et{constructor(){super();a(this,"target");a(this,"config");a(this,"engine");a(this,"rendererCacheData");this.rendererCacheData={}}assemble(e){return this.target=e.renderer,this.config=e.config,this.engine=e.engine,this.assembly=!0,this}process(e){return this.assembly?this[e.key]?(this[e.key](e.value),this):e.path.length&&this[e.path[0]]?(this[e.path[0]](e.value),this):(this.mergeAttribute(e.path,e.key,e.value),this):(console.warn("webGLRenderer Processor unassembled"),this)}dispose(){return this.target=void 0,this.config=void 0,this.engine=void 0,this.assembly=!1,this}clearColor(e){const t=Number(e.slice(0,-1).split(",").pop().trim());return this.target.setClearColor(e,t),this.target.clear(),this}pixelRatio(e){return this.target.setPixelRatio(e),this.target.clear(),this}size(){const e=this.target,t=this.config.size;if(t)e.setSize(t.x,t.y);else{const i=e.domElement;e.setSize(i.offsetWidth,i.offsetHeight)}return this}viewport(){const e=this.target,t=this.config.viewport;if(t)e.setViewport(t.x,t.y,t.width,t.height);else{const i=e.domElement;e.setViewport(0,0,i.offsetWidth,i.offsetHeight)}return this}scissor(){const e=this.target,t=this.config.scissor;if(t)e.setScissorTest(!0),e.setScissor(t.x,t.y,t.width,t.height);else{e.setScissorTest(!1);const i=e.domElement;e.setScissor(0,0,i.offsetWidth,i.offsetHeight)}return this}adaptiveCamera(e){if(!this.engine)return console.warn("renderer compiler is not set engine."),this;const t=this.target,i=this.engine,o=i.renderManager;if(!e){if(!this.rendererCacheData.adaptiveCameraFun)return this;if(this.rendererCacheData.adaptiveCameraFun)return o.removeEventListener("render",this.rendererCacheData.adaptiveCameraFun),this.rendererCacheData.adaptiveCameraFun=void 0,this}if(e){if(this.rendererCacheData.adaptiveCameraFun)return o.addEventListener("render",this.rendererCacheData.adaptiveCameraFun),this;const s=c=>{const l=i.camera,h=t.domElement.offsetWidth,d=t.domElement.offsetHeight;let m=0,f=0,y=0,g=0,M=0;if(l instanceof u.PerspectiveCamera)M=l.aspect;else if(l instanceof u.OrthographicCamera)m=l.right-l.left,f=l.top-l.bottom,M=m/f;else{console.warn("renderer compiler can not support this camera",l);return}M>=1?(m=h,f=m/M,g=d/2-f/2):(f=d,m=f*M,y=h/2-m/2),t.setScissor(y,g,m,f),t.setViewport(y,g,m,f),t.setScissorTest(!0)};this.rendererCacheData.adaptiveCameraFun=s,o.addEventListener("render",this.rendererCacheData.adaptiveCameraFun)}return this}}class vs extends b{constructor(e){super();a(this,"MODULE",r.MODULETYPE.RENDERER);a(this,"target");a(this,"engine");a(this,"processorMap",{[r.CONFIGTYPE.WEBGLRENDERER]:new Ls});a(this,"map",new Map);e?(e.target&&(this.target=e.target),e.engine&&(this.engine=e.engine)):(this.target={},this.engine=new G)}assembly(e,t){const i=this.target[e];if(!i){console.warn(`controls compiler can not found this config: '${e}'`);return}const o=this.processorMap[i.type];if(!o){console.warn(`renderer compiler can not support this renderer: '${e}'`);return}const s=this.map.get(e);if(!s){console.warn(`renderer compiler can not found type of renderer: '${i.type}'`);return}o.dispose().assemble({config:i,renderer:s,processer:o,engine:this.engine}),t(o)}add(e){e.type===r.CONFIGTYPE.WEBGLRENDERER&&this.map.set(e.vid,this.engine.webGLRenderer),this.assembly(e.vid,t=>{t.processAll().dispose()})}setTarget(e){return this.target=e,this}useEngine(e){return e.webGLRenderer&&this.map.set(r.CONFIGTYPE.WEBGLRENDERER,e.webGLRenderer),this.engine=e,this}compileAll(){const e=this.target;for(const t of Object.values(e))this.add(t);return this}dispose(){return this.map.forEach((e,t)=>{e.dispose&&e.dispose()}),this}getObjectSymbol(e){let t=null;return this.map.forEach((i,o)=>{i===e&&(t=o)}),t}getObjectBySymbol(e){return this.map.get(e)||null}}const Ps=function(n,e,t){if(!e){n.background=null;return}if(Z.validate(e)){const i=t.compilerManager.getTexture(e);i?n.background=i:console.warn(`engine can not found this vid texture : '${e}'`)}else n.background=new u.Color(e)},ws=function(n,e,t){if(!e){n.environment=null;return}if(Z.validate(e)){const i=t.compilerManager.getTexture(e);i?n.environment=i:console.warn(`engine can not found this vid texture : '${e}'`)}else console.warn(`scene environment is illeage: ${e}`)};var Is=I({configType:r.CONFIGTYPE.SCENE,commands:{add:j.add,set:Y({lookAt(){},fog({target:n,config:e,key:t,value:i}){const o=e.fog;o.type?o.type==="Fog"?!n.fog||!(n.fog instanceof u.Fog)?n.fog=new u.Fog(o.color,o.near,o.far):t==="color"?n.fog.color.copy(new u.Color(o.color)):n.fog[t]&&(n.fog[t]=i):o.type==="FogExp2"&&(!n.fog||!(n.fog instanceof u.FogExp2)?n.fog=new u.FogExp2(o.color,o.density):t==="color"?n.fog.color.copy(new u.Color(o.color)):n.fog[t]&&(n.fog[t]=i)):n.fog=null}},j.set),delete:j.delete},create(n,e){const t=new u.Scene;if(Ps(t,n.background,e),ws(t,n.environment,e),n.fog.type){const i=n.fog;i.type==="Fog"?t.fog=new u.Fog(i.color,i.near,i.far):i.type==="FogExp2"?t.fog=new u.FogExp2(i.color,i.density):console.warn(`scene processor can not support this type fog:'${n.type}'`)}return Oe(new u.Scene,n,{lookAt:!0,background:!0,environment:!0,fog:!0},e)},dispose:ee});class Rs extends Se{constructor(){super();a(this,"MODULE",r.MODULETYPE.SCENE)}}b.processor(Is);var Ns=I({configType:r.CONFIGTYPE.LINE,commands:{add:Re.add,set:Y({lookAt(){}},Re.set),delete:Re.add},create(n,e){return it(new u.Sprite,n,{geometry:!0,lookAt:!0},e)},dispose:rt});class Gs extends tt{constructor(){super();a(this,"MODULE",r.MODULETYPE.SPRITE)}}b.processor(Ns);class As extends u.Texture{constructor(e,t,i,o,s,c,l,h,d,m){super(e,t,i,o,s,c,l,h,d,m)}}class Ae{constructor(e){a(this,"canvas");this.canvas=document.createElement("canvas");const t=window.devicePixelRatio;this.canvas.width=((e==null?void 0:e.width)||512)*t,this.canvas.height=((e==null?void 0:e.height)||512)*t,this.canvas.style.backgroundColor=(e==null?void 0:e.bgColor)||"rgb(255, 255, 255)";const i=this.canvas.getContext("2d");i&&i.scale(window.devicePixelRatio,window.devicePixelRatio)}get(){return this.canvas}getDom(){return this.canvas}clear(e=0,t=0,i,o){!i&&(i=this.canvas.width),!o&&(o=this.canvas.height);const s=this.canvas.getContext("2d");return s?(s.clearRect(e,t,i,o),this):(console.warn("you browser can not support canvas 2d"),this)}draw(e){const t=this.canvas.getContext("2d");return t?(e(t),this):(console.warn("you browser can not support canvas 2d"),this)}preview(e){const t=this.canvas;return t.style.position="fixed",t.style.top=(e==null?void 0:e.top)||"5%",t.style.left=(e==null?void 0:e.left)||"5%",t.style.right=(e==null?void 0:e.right)||"unset",t.style.bottom=(e==null?void 0:e.bottom)||"unset",(e==null?void 0:e.scale)&&(t.style.transform=`scale(${e.scale})`),document.body.appendChild(this.canvas),this}}const ot=new Ae({width:512,height:512}).draw(n=>{n.translate(256,256),n.font="72px",n.fillStyle="white",n.fillText("\u6682\u65E0\u56FE\u7247",0,0)}).getDom(),W=function(n,e,t){const i=e.resourceManager.resourceMap;if(!i.has(n))return console.warn(`engine resourceManager can not found this url: ${n}`),ot;const o=i.get(n);if(Array.isArray(t)){for(const s of t)if(o instanceof s)return o;return console.warn(`this url mapping resource is not a texture image class: ${n}`,o),ot}else return o instanceof t?o:(console.warn(`this url mapping resource is not a texture image class: ${n}`,o),ot)},Ds={reg:new RegExp("wrapS|wrapT|format|encoding|anisotropy|magFilter|minFilter"),handler({target:n,key:e,value:t}){n[e]=t,n.needsUpdate=!0}};var Us=I({configType:r.CONFIGTYPE.IMAGETEXTURE,commands:{set:{url({target:n,value:e,engine:t}){n.image=W(e,t,HTMLImageElement),n.needsUpdate=!0},$reg:[Ds]}},create(n,e){const t=new As;return n.url&&(t.image=W(n.url,e,HTMLImageElement)),ue(n,t,{type:!0,url:!0}),t.needsUpdate=!0,t},dispose(n){n.dispose()}}),Fs=I({configType:r.CONFIGTYPE.CANVASTEXTURE,commands:{set:{url({target:n,value:e,engine:t}){n.image=W(e,t,HTMLCanvasElement),n.needsUpdate=!0}}},create(n,e){const t=new u.CanvasTexture(ot);return n.url&&(t.image=W(n.url,e,HTMLCanvasElement)),ue(n,t,{type:!0,url:!0}),t.needsUpdate=!0,t},dispose(n){n.dispose()}});const Le=[HTMLImageElement,HTMLVideoElement,HTMLCanvasElement],De=function({target:n,index:e,value:t,engine:i}){n.images[e]=W(t,i,Le),n.needsUpdate=!0};var Ys=I({configType:r.CONFIGTYPE.CUBETEXTURE,commands:{set:{cube:{px({target:n,value:e,engine:t}){De({target:n,value:e,engine:t,index:0})},nx({target:n,value:e,engine:t}){De({target:n,value:e,engine:t,index:1})},py({target:n,value:e,engine:t}){De({target:n,value:e,engine:t,index:2})},ny({target:n,value:e,engine:t}){De({target:n,value:e,engine:t,index:3})},pz({target:n,value:e,engine:t}){De({target:n,value:e,engine:t,index:4})},nz({target:n,value:e,engine:t}){De({target:n,value:e,engine:t,index:5})}}}},create(n,e){const t=new u.CubeTexture,i=n.cube,o=[W(i.px,e,Le),W(i.nx,e,Le),W(i.py,e,Le),W(i.ny,e,Le),W(i.pz,e,Le),W(i.nz,e,Le)];return t.image=o,ue(n,t,{type:!0,cube:!0}),t.needsUpdate=!0,t},dispose(n){n.dispose()}});class js extends u.Texture{constructor(e,t,i,o,s,c,l,h,d){super(e,t,i,o,s,c,l,h,d);a(this,"isVideoTexture",!0);this.format=l!==void 0?l:u.RGBFormat,this.minFilter=c!==void 0?c:u.LinearFilter,this.magFilter=s!==void 0?s:u.LinearFilter,this.generateMipmaps=!1}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image,t="requestVideoFrameCallback"in e;t?this.needsUpdate=!0:t===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}var Bs=I({configType:r.CONFIGTYPE.VIDEOTEXTURE,commands:{set:{url({target:n,value:e,engine:t}){n.image=W(e,t,HTMLVideoElement),n.needsUpdate=!0}}},create(n,e){const t=new js(document.createElement("video"));return n.url&&(t.image=W(n.url,e,HTMLVideoElement)),ue(n,t,{type:!0,url:!0}),t.needsUpdate=!0,t},dispose(n){n.dispose()}});class Hs extends b{constructor(){super();a(this,"MODULE",r.MODULETYPE.TEXTURE)}}b.processor(Us),b.processor(Fs),b.processor(Ys),b.processor(Bs);class xs{constructor(e){a(this,"cameraCompiler",new Po);a(this,"lightCompiler",new ss);a(this,"geometryCompiler",new Jo);a(this,"textureCompiler",new Hs);a(this,"materialCompiler",new gs);a(this,"rendererCompiler",new vs);a(this,"sceneCompiler",new Rs);a(this,"controlsCompiler",new Ro);a(this,"spriteCompiler",new Gs);a(this,"lineCompiler",new ls);a(this,"meshCompiler",new ys);a(this,"pointsCompiler",new bs);a(this,"groupCompiler",new es);a(this,"css3DCompiler",new Do);a(this,"passCompiler",new Os);a(this,"animationCompiler",new Br);a(this,"compilerMap");a(this,"object3DMapSet",new Set);e&&Object.keys(e).forEach(l=>{this[l]=e[l]});const t=this.textureCompiler.getMap();this.animationCompiler.linkTextureMap(t),this.geometryCompiler.getMap();const i=this.materialCompiler.getMap(),s=Object.values(this).filter(l=>l instanceof Se).map(l=>{const h=l.getMap();return this.object3DMapSet.add(h),h});this.animationCompiler.linkObjectMap(...s).linkMaterialMap(i);const c=new Map;Object.keys(this).forEach(l=>{const h=this[l];h instanceof b&&c.set(h.MODULE,h)}),this.compilerMap=c}support(e){this.compilerMap.forEach(i=>{i.useEngine(e)});const t=e.dataSupportManager;return t.textureDataSupport.addCompiler(this.textureCompiler),t.materialDataSupport.addCompiler(this.materialCompiler),t.geometryDataSupport.addCompiler(this.geometryCompiler),t.rendererDataSupport.addCompiler(this.rendererCompiler),t.controlsDataSupport.addCompiler(this.controlsCompiler),t.passDataSupport.addCompiler(this.passCompiler),t.cameraDataSupport.addCompiler(this.cameraCompiler),t.lightDataSupport.addCompiler(this.lightCompiler),t.spriteDataSupport.addCompiler(this.spriteCompiler),t.lineDataSupport.addCompiler(this.lineCompiler),t.meshDataSupport.addCompiler(this.meshCompiler),t.pointsDataSupport.addCompiler(this.pointsCompiler),t.css3DDataSupport.addCompiler(this.css3DCompiler),t.groupDataSupport.addCompiler(this.groupCompiler),t.sceneDataSupport.addCompiler(this.sceneCompiler),t.animationDataSupport.addCompiler(this.animationCompiler),this}getObjectSymbol(e){for(const t of this.compilerMap.values()){const i=t.getObjectSymbol(e);if(i)return i}return null}getObjectBySymbol(e){for(const t of this.compilerMap.values()){const i=t.getObjectBySymbol(e);if(i)return i}return null}getObject3D(e){for(const t of this.object3DMapSet)if(t.has(e))return t.get(e);return null}getMaterial(e){return this.materialCompiler.map.get(e)||null}getTexture(e){return this.textureCompiler.map.get(e)||null}dispose(){for(const e of this.compilerMap.values())e.dispose();return this.compilerMap.clear(),this}}const zs=function(n){if(this.compilerManager)return console.warn("engine has installed compilerManager plugin."),!1;if(!this.dataSupportManager)return console.warn("must install dataSupportManager before compilerManager plugin."),!1;if(!this.renderManager)return console.warn("must install renderManager before compilerManager plugin."),!1;const e=new xs;return this.compilerManager=e,this.getObjectSymbol=function(t){return this.compilerManager.getObjectSymbol(t)},this.getObjectBySymbol=function(t){return this.compilerManager.getObjectBySymbol(t)},this.addEventListener("dispose",()=>{this.compilerManager.dispose()}),this.completeSet.add(()=>{this.compilerManager.support(this)}),!0};class Sn extends J{constructor(){super();a(this,"map",new Map)}generateSymbol(e){return Array.isArray(e)?e.join(" + "):e.shortcutKey.join(" + ")}watch(e){return e?Ve.default.watch(void 0,e):Ve.default.watch(),this}register(e){const t=this.generateSymbol(e);return this.map.has(t)?(console.warn(`KeyboardManager: shortcutKey already exist: ${t}. desp: ${this.map.get(t).desp}`),this):(Ve.default.bind(t,e.keydown||null,e.keyup),this.map.set(t,e),this)}update(e){const t=this.generateSymbol(e);return this.map.has(t)?(this.cancel(e.shortcutKey),this.register(e),this):(console.warn("KeyboardManager: shortcutKey unregister then exec register function"),this.register(e),this)}cancel(e){const t=this.generateSymbol(e);if(this.map.has(t)){const i=this.map.get(t);Ve.default.unbind(t,i.keydown||null,i.keyup),this.map.delete(t)}return this}checkRepeat(e){const t=this.generateSymbol(e);return this.map.has(t)}}const ks=function(n){if(this.keyboardManager)return console.warn("engine has installed keyboardManager plugin."),!1;const e=new Sn;return this.keyboardManager=e,this.completeSet.add(()=>{if(this.transformControls)if(this.IS_ENGINESUPPORT){const t=this.dataSupportManager.controlsDataSupport.getData()[r.CONFIGTYPE.TRNASFORMCONTROLS];e.register({shortcutKey:["r"],desp:"tranformControls rotate mode",keyup:i=>{i==null||i.preventDefault(),t.mode="rotate"}}).register({shortcutKey:["t"],desp:"tranformControls translate mode",keyup:i=>{i==null||i.preventDefault(),t.mode="translate"}}).register({shortcutKey:["e"],desp:"tranformControls scale mode",keyup:i=>{i==null||i.preventDefault(),t.mode="scale"}}).register({shortcutKey:["x"],desp:"tranformControls switch x axis",keyup:i=>{i==null||i.preventDefault(),t.showX=!t.showX}}).register({shortcutKey:["y"],desp:"tranformControls switch y axis",keyup:i=>{i==null||i.preventDefault(),!(i==null?void 0:i.ctrlKey)&&(t.showY=!t.showY)}}).register({shortcutKey:["z"],desp:"tranformControls switch z axis",keyup:i=>{i==null||i.preventDefault(),!(i==null?void 0:i.ctrlKey)&&(t.showZ=!t.showZ)}}).register({shortcutKey:["space"],desp:"tranformControls switch coordinate space",keyup:i=>{i==null||i.preventDefault(),t.space=t.space==="local"?"world":"local"}}).register({shortcutKey:["shift"],desp:"tranformControls switch tranform numeric value",keyup:i=>{i==null||i.preventDefault(),t.snapAllow=!1},keydown:i=>{i==null||i.preventDefault(),i==null||i.preventRepeat(),t.snapAllow=!0}})}else{const t=this.transformControls;e.register({shortcutKey:["r"],desp:"tranformControls rotate mode",keyup:i=>{i==null||i.preventDefault(),t.mode="rotate"}}).register({shortcutKey:["t"],desp:"tranformControls translate mode",keyup:i=>{i==null||i.preventDefault(),t.mode="translate"}}).register({shortcutKey:["e"],desp:"tranformControls scale mode",keyup:i=>{i==null||i.preventDefault(),t.mode="scale"}}).register({shortcutKey:["x"],desp:"tranformControls switch x axis",keyup:i=>{i==null||i.preventDefault(),t.showX=!t.showX}}).register({shortcutKey:["y"],desp:"tranformControls switch y axis",keyup:i=>{i==null||i.preventDefault(),!(i==null?void 0:i.ctrlKey)&&(t.showY=!t.showY)}}).register({shortcutKey:["z"],desp:"tranformControls switch z axis",keyup:i=>{i==null||i.preventDefault(),!(i==null?void 0:i.ctrlKey)&&(t.showZ=!t.showZ)}}).register({shortcutKey:["space"],desp:"tranformControls switch coordinate space",keyup:i=>{i==null||i.preventDefault(),t.space=t.space==="local"?"world":"local"}}).register({shortcutKey:["shift"],desp:"tranformControls switch tranform numeric value",keyup:i=>{i==null||i.preventDefault(),t.translationSnap=null,t.rotationSnap=null,t.scaleSnap=null},keydown:i=>{i==null||i.preventDefault(),i==null||i.preventRepeat(),t.translationSnap=5,t.rotationSnap=Math.PI/180*10,t.scaleSnap=.1}})}}),!0},Vs=function(n={}){if(!this.scene)return console.error("must install some scene plugin before BasicViewpoint plugin."),!1;const e=new u.AxesHelper(n.length||500);return e.matrixAutoUpdate=!1,e.raycast=()=>{},this.scene.add(e),this.setAxesHelper=function(t){return t.show?this.scene.add(e):this.scene.remove(e),this},this.addEventListener("setScene",t=>{t.scene.add(e)}),!0},$s=function(n={}){if(!this.scene)return console.error("must install some scene before BasicViewpoint plugin."),!1;const e=new u.GridHelper(n.range||500,n.spacing||50,n.axesColor||"rgb(130, 130, 130)",n.cellColor||"rgb(70, 70, 70)");if(n.opacity!==1){const t=e.material;t.transparent=!0,t.opacity=n.opacity||.5,t.needsUpdate=!0}return e.matrixAutoUpdate=!1,e.raycast=()=>{},this.scene.add(e),this.setGridHelper=function(t){return t.show?this.scene.add(e):this.scene.remove(e),this},this.addEventListener("setScene",t=>{t.scene.add(e)}),this.completeSet.add(()=>{this.setViewpoint&&this.addEventListener("setViewpoint",t=>{const i=t.viewpoint;i===r.VIEWPOINT.DEFAULT||i===r.VIEWPOINT.TOP||i===r.VIEWPOINT.BOTTOM?e.rotation.set(0,0,0):i===r.VIEWPOINT.RIGHT||i===r.VIEWPOINT.LEFT?e.rotation.set(0,0,Math.PI/2):(i===r.VIEWPOINT.FRONT||i===r.VIEWPOINT.BACK)&&e.rotation.set(Math.PI/2,0,0),e.updateMatrix(),e.updateMatrixWorld()})}),!0};r.DISPLAYMODE=void 0,function(n){n.GEOMETRY="geometry",n.MATERIAL="material",n.LIGHT="light",n.ENV="env"}(r.DISPLAYMODE||(r.DISPLAYMODE={}));const Ws=function(n={}){if(!this.webGLRenderer)return console.error("must install some renderer before DisplayModel plugin."),!1;if(!this.scene)return console.error("must install some scene before DisplayModel plugin."),!1;!n.overrideColor&&(n.overrideColor="rgb(250, 250, 250)"),!n.defaultAmbientLightSetting&&(n.defaultAmbientLightSetting={}),!n.defaultAmbientLightSetting.color&&(n.defaultAmbientLightSetting.color="rgb(255, 255, 255)"),!n.defaultAmbientLightSetting.intensity&&(n.defaultAmbientLightSetting.intensity=.5);const e=new u.AmbientLight(n.defaultAmbientLightSetting.color,n.defaultAmbientLightSetting.intensity);e.matrixAutoUpdate=!1,!n.defaultDirectionalLightSetting&&(n.defaultDirectionalLightSetting={}),!n.defaultDirectionalLightSetting.color&&(n.defaultDirectionalLightSetting.color="rgb(255, 255, 255)"),!n.defaultDirectionalLightSetting.intensity&&(n.defaultDirectionalLightSetting.intensity=.5),!n.defaultDirectionalLightSetting.position&&(n.defaultDirectionalLightSetting.position={x:-100,y:100,z:100});const t=new u.DirectionalLight(n.defaultDirectionalLightSetting.color,n.defaultDirectionalLightSetting.intensity);t.castShadow=!1,t.position.set(n.defaultDirectionalLightSetting.position.x,n.defaultDirectionalLightSetting.position.y,n.defaultDirectionalLightSetting.position.z),t.updateMatrix(),t.updateMatrixWorld(),t.matrixAutoUpdate=!1,!n.mode&&(n.mode=r.DISPLAYMODE.ENV),this.displayMode=n.mode;const i=new u.MeshLambertMaterial({color:n.overrideColor}),o=new u.LineBasicMaterial({color:n.overrideColor}),s=new u.PointsMaterial({color:n.overrideColor,size:5,sizeAttenuation:!1}),c=new u.SpriteMaterial({color:n.overrideColor}),l=new WeakMap,h=new Set,d=new Set,m=new Set,f=new Set,y=new Set;let g,M;const C={Object3D:!0,Group:!0};this.scene.addEventListener("afterAdd",E=>{const x=this.displayMode,w=E.objects;for(const v of w)if(!C[v.type])if(v instanceof u.Mesh&&v.type==="Mesh")d.add(v),x===r.DISPLAYMODE.GEOMETRY&&(l.set(v,v.material),v.material=i);else if(v instanceof u.Line&&v.type.includes("Line"))m.add(v),x===r.DISPLAYMODE.GEOMETRY&&(l.set(v,v.material),v.material=o);else if(v instanceof u.Light&&v.type.includes("Light")){if(v===e||v===t)continue;h.has(v)||h.add(v),x!==r.DISPLAYMODE.ENV&&x!==r.DISPLAYMODE.LIGHT&&this.scene.remove(v)}else v instanceof u.Points&&v.type==="Points"?(f.add(v),x===r.DISPLAYMODE.GEOMETRY&&(l.set(v,v.material),v.material=s)):v instanceof u.Sprite&&v.type==="Sprite"&&(y.add(v),x===r.DISPLAYMODE.GEOMETRY&&(l.set(v,v.material),v.material=c))}),this.scene.addEventListener("afterRemove",E=>{const x=E.objects;for(const w of x)if(!C[w.type])if(w instanceof u.Mesh&&w.type==="Mesh")d.delete(w),l.has(w)&&l.delete(w);else if(w instanceof u.Line&&w.type.includes("Line"))m.delete(w),l.has(w)&&l.delete(w);else if(w instanceof u.Light&&w.type.includes("Light")){if(w===e||w===t)continue;h.delete(w)}else w instanceof u.Points&&w.type==="Points"?(f.delete(w),l.has(w)&&l.delete(w)):w instanceof u.Sprite&&w.type==="Sprite"&&(y.delete(w),l.has(w)&&l.delete(w))});const O=()=>{for(const E of d)E.material!==i&&(l.set(E,E.material),E.material=i);for(const E of m)E.material!==o&&(l.set(E,E.material),E.material=o);for(const E of f)E.material!==s&&(l.set(E,E.material),E.material=s);for(const E of y)E.material!==c&&(l.set(E,E.material),E.material=c)},T=()=>{d.forEach(E=>{l.has(E)&&(E.material=l.get(E),l.delete(E))}),m.forEach(E=>{l.has(E)&&(E.material=l.get(E),l.delete(E))}),f.forEach(E=>{l.has(E)&&(E.material=l.get(E),l.delete(E))}),y.forEach(E=>{l.has(E)&&(E.material=l.get(E),l.delete(E))})},P=()=>{h.forEach(E=>{E.visible=!1}),this.scene.add(e),this.scene.add(t)},R=()=>{h.forEach(E=>{E.visible=!0}),this.scene.remove(e),this.scene.remove(t)},L=()=>{this.scene.background instanceof u.Texture&&(g=this.scene.background,this.scene.background=null),this.scene.environment instanceof u.Texture&&(M=this.scene.environment,this.scene.environment=null)},H=()=>{g&&(this.scene.background=g,g=void 0),M&&(this.scene.environment=M,M=void 0)};return this.setDisplayMode=function(E){return this.displayMode=E||r.DISPLAYMODE.ENV,E===r.DISPLAYMODE.GEOMETRY?(O(),L(),P()):E===r.DISPLAYMODE.MATERIAL?(T(),L(),P()):E===r.DISPLAYMODE.LIGHT?(T(),L(),R()):E===r.DISPLAYMODE.ENV?(T(),H(),R()):console.warn(`displayMode plugin can not set this mode: ${E}`),this},this.completeSet.add(()=>{this.objectHelperManager&&this.objectHelperManager.addFilteredObject(t)}),!0},fe=()=>new u.LineBasicMaterial({color:"rgb(255, 255, 255)"});class St extends u.LineSegments{constructor(e){super();a(this,"shape");a(this,"target");a(this,"type","CameraHelper");a(this,"cachaData");const t=new u.BufferGeometry,i=[0,0,0,-1,1,-1,0,0,0,-1,1,1,0,0,0,-1,-1,-1,0,0,0,-1,-1,1,-1,-1,1,-1,-1,-1,-1,-1,-1,-1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,-1,1,0,0,0,0,1,1,0,0,0,0,1,-1,0,0,0,0,-1,-1,0,0,0,0,-1,1,0,1,1,0,1,-1,0,1,-1,0,-1,-1,0,-1,-1,0,-1,1,0,-1,1,0,1,1,0,-1,1,2,-1,1,0,1,-1,2,1,-1,0,-1,-1,2,-1,-1,0,1,1,2,1,1,2,1,1,2,-1,1,2,-1,1,2,-1,-1,2,-1,-1,2,1,-1,2,1,-1,2,1,1];t.setAttribute("position",new u.Float32BufferAttribute(i,3)),t.rotateY(-90*Math.PI/180),t.computeBoundingBox();const o=new u.CameraHelper(e);o.matrix=new u.Matrix4,o.matrixAutoUpdate=!0,o.raycast=()=>{},this.add(o),this.shape=o,this.geometry=t,this.material=fe(),this.target=e,this.matrixAutoUpdate=!1,this.matrix=e.matrix,e instanceof u.PerspectiveCamera?this.cachaData={fov:e.fov,aspect:e.aspect,near:e.near,far:e.far}:e instanceof u.OrthographicCamera?this.cachaData={left:e.left,right:e.right,top:e.top,bottom:e.bottom,near:e.near,far:e.far}:this.cachaData={},this.onBeforeRender=()=>{let s=!1;const c=this.cachaData;Object.keys(c).forEach(l=>{c[l]!==e[l]&&(c[l]=e[l],s=!0)}),s&&this.shape.update()}}raycast(e,t){const i=this.matrixWorld,o=this.geometry.boundingBox.clone();if(o.applyMatrix4(i),e.ray.intersectsBox(o)){const s=this.target;t.push({distance:e.ray.origin.distanceTo(s.position),object:s,point:s.position})}}}class On extends u.LineSegments{constructor(e){super();a(this,"sphere");a(this,"target");a(this,"shape");a(this,"type","VisDirectionalLightHelper");a(this,"cacheColor");a(this,"cacheVector3");this.geometry=new u.BufferGeometry;const t=[-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,0,0,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,-.707,0,-.707,.707,0,.707,.707,0,-.707,-.707,0,.707];this.geometry.setAttribute("position",new u.Float32BufferAttribute(t,3)),this.material=fe(),this.geometry.boundingSphere;const i=new u.Color().copy(e.color).multiplyScalar(e.intensity),o=new u.PlaneBufferGeometry(20,20);o.dispose();const s=new u.LineSegments(new u.EdgesGeometry(o),new u.LineBasicMaterial({color:i}));s.raycast=()=>{},this.shape=s,this.target=e,this.sphere=new u.Sphere(new u.Vector3(0,0,0),1),this.cacheColor=e.color.getHex(),this.cacheVector3=new u.Vector3,this.add(this.shape),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.onBeforeRender=()=>{const c=this.target,l=this.shape;c.color.getHex()!==this.cacheColor&&(l.material.color.copy(c.color).multiplyScalar(c.intensity),this.cacheColor=c.color.getHex()),l.lookAt(c.target.position)}}raycast(e,t){const i=this.target,o=i.matrixWorld,s=this.sphere;s.set(this.cacheVector3.set(0,0,0),1),s.applyMatrix4(o),e.ray.intersectsSphere(s)&&t.push({distance:e.ray.origin.distanceTo(i.position),object:i,point:i.position})}}class Cn extends u.LineSegments{constructor(e){super();a(this,"sphere");a(this,"target");a(this,"shape");a(this,"type","VisPointLightHelper");a(this,"cacheColor");a(this,"cacheDistance");a(this,"cacheVector3");this.geometry=new u.BufferGeometry;const t=[-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,0,0,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,-.707,0,-.707,.707,0,.707,.707,0,-.707,-.707,0,.707];this.geometry.setAttribute("position",new u.Float32BufferAttribute(t,3)),this.material=fe(),this.geometry.boundingSphere;const i=new u.Color().copy(e.color).multiplyScalar(e.intensity),o=new u.Mesh(new u.OctahedronBufferGeometry(e.distance,0),new u.MeshBasicMaterial({color:i,wireframe:!0}));o.raycast=()=>{},o.matrixAutoUpdate=!1,this.shape=o,this.target=e,this.sphere=new u.Sphere(new u.Vector3(0,0,0),1),this.cacheColor=e.color.getHex(),this.cacheDistance=e.distance,this.cacheVector3=new u.Vector3,this.add(this.shape),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.onBeforeRender=()=>{const s=this.target,c=this.shape;s.distance!==this.cacheDistance&&(c.geometry.dispose(),c.geometry=new u.OctahedronBufferGeometry(s.distance,0),this.cacheDistance=s.distance),s.color.getHex()!==this.cacheColor&&(c.material.color.copy(s.color).multiplyScalar(s.intensity),this.cacheColor=s.color.getHex())}}raycast(e,t){const i=this.target,o=i.matrixWorld,s=this.sphere;s.set(this.cacheVector3.set(0,0,0),1),s.applyMatrix4(o),e.ray.intersectsSphere(s)&&t.push({distance:e.ray.origin.distanceTo(i.position),object:i,point:i.position})}}class bn extends u.LineSegments{constructor(e){super();a(this,"sphere");a(this,"target");a(this,"shape");a(this,"type","VisSpotLightHelper");a(this,"cacheVector3");a(this,"cacheColor");a(this,"cacheAngle");a(this,"cacheDistance");this.geometry=new u.BufferGeometry;const t=[-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,0,0,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,-.707,0,-.707,.707,0,.707,.707,0,-.707,-.707,0,.707];this.geometry.setAttribute("position",new u.Float32BufferAttribute(t,3)),this.material=fe(),this.geometry.boundingSphere;const i=new u.BufferGeometry,o=[0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let d=0,m=1,f=32;d<f;d++,m++){const y=d/f*Math.PI*2,g=m/f*Math.PI*2;o.push(Math.cos(y),Math.sin(y),1,Math.cos(g),Math.sin(g),1)}i.setAttribute("position",new u.Float32BufferAttribute(o,3));const s=fe(),c=new u.LineSegments(i,s);c.material.color.copy(e.color).multiplyScalar(e.intensity);const l=e.distance?e.distance:1e3,h=l*Math.tan(e.angle);c.scale.set(h,h,l),c.raycast=()=>{},this.add(c),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.target=e,this.shape=c,this.sphere=new u.Sphere(new u.Vector3(0,0,0),1),this.cacheColor=e.color.getHex(),this.cacheDistance=e.distance,this.cacheAngle=e.angle,this.cacheVector3=new u.Vector3,this.onBeforeRender=()=>{const d=this.target,m=this.shape;let f=!1;if(d.distance!==this.cacheDistance&&(this.cacheDistance=d.distance,m.scale.z=d.distance,f=!0),d.angle!==this.cacheAngle&&(this.cacheAngle=d.angle,f=!0),f){const y=d.distance*Math.tan(d.angle);m.scale.set(y,y,d.distance)}d.color.getHex()!==this.cacheColor&&(m.material.color.copy(d.color).multiplyScalar(d.intensity),this.cacheColor=d.color.getHex()),m.lookAt(d.target.position)}}raycast(e,t){const i=this.target,o=i.matrixWorld,s=this.sphere;s.set(this.cacheVector3.set(0,0,0),1),s.applyMatrix4(o),e.ray.intersectsSphere(s)&&t.push({distance:e.ray.origin.distanceTo(i.position),object:i,point:i.position})}}class _s extends u.LineSegments{constructor(e){super();a(this,"target");a(this,"type","VisCSS3DHelper");const i=e.element.getBoundingClientRect(),o=i.width,s=i.height;this.geometry=new u.EdgesGeometry(new u.PlaneBufferGeometry(o,s)),this.geometry.computeBoundingBox(),this.material=fe(),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.target=e}raycast(e,t){const i=this.target,o=i.matrixWorld,s=this.geometry.boundingBox.clone();s.applyMatrix4(o),e.ray.intersectsBox(s)&&t.push({distance:e.ray.origin.distanceTo(i.position),object:i,point:i.position})}}class Qs extends u.LineSegments{constructor(e){super();a(this,"target");a(this,"type","VisCSS3DPlaneHelper");a(this,"observer");this.geometry=new u.EdgesGeometry(new u.PlaneBufferGeometry(e.width,e.height)),this.geometry.computeBoundingBox(),this.material=fe(),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.target=e;const t=new MutationObserver(()=>{this.geometry.dispose(),this.geometry=new u.EdgesGeometry(new u.PlaneBufferGeometry(e.width,e.height)),this.geometry.computeBoundingBox()});t.observe(e.element,{attributeFilter:["style"]}),this.observer=t}dispose(){this.observer.disconnect()}}const Rt=class extends u.Sprite{constructor(e){super();a(this,"target");a(this,"type","VisGroupHelper");this.target=e,this.geometry.computeBoundingBox(),this.material=new u.SpriteMaterial({map:Rt.colorTexture}),this.material.depthTest=!1,this.material.depthWrite=!1,this.scale.set(5,5,5);const t=this.updateMatrixWorld.bind(this);this.updateMatrixWorld=i=>{const o=this.position,s=this.target.position;o.x=s.x,o.y=s.y,o.z=s.z,t(i)}}raycast(e,t){const i=this.matrixWorld,o=this.geometry.boundingBox.clone();if(o.applyMatrix4(i),e.ray.intersectsBox(o)){const s=this.target;t.push({distance:e.ray.origin.distanceTo(s.position),object:s,point:s.position})}}};let st=Rt;a(st,"colorTexture",new u.CanvasTexture(new Ae({width:512,height:512}).draw(e=>{e.beginPath(),e.fillStyle="rgba(0, 0, 0, 0)",e.fillRect(0,0,512,512),e.closePath(),e.translate(256,200),e.beginPath(),e.fillStyle="yellow",e.fillRect(-200,0,400,200),e.closePath(),e.beginPath(),e.fillStyle="yellow",e.fillRect(-200,-70,200,70),e.closePath()}).get()));const Nt=class extends u.Points{constructor(e){super();a(this,"target");a(this,"cachaGeometryUUid");a(this,"type","VisLineHelper");this.target=e,this.geometry.dispose(),this.geometry.copy(e.geometry),this.cachaGeometryUUid=e.geometry.uuid,this.material=new u.PointsMaterial({color:"rgb(255, 255, 255)",alphaMap:Nt.alphaTexture,transparent:!0,size:5,sizeAttenuation:!1}),this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.matrix=e.matrix,this.matrixWorld=e.matrixWorld,this.renderOrder=-1,this.raycast=()=>{},this.onBeforeRender=()=>{const t=this.target;t.geometry.uuid!==this.cachaGeometryUUid&&(this.geometry.dispose(),this.geometry=t.geometry.clone(),this.cachaGeometryUUid=t.geometry.uuid)}}};let Ot=Nt;a(Ot,"alphaTexture",new u.CanvasTexture(new Ae({width:512,height:512,bgColor:"rgb(0, 0, 0)"}).draw(e=>{e.beginPath(),e.fillStyle="rgb(255, 255, 255)",e.arc(256,256,200,0,Math.PI*2),e.fill(),e.closePath()}).getDom()));class Xs extends u.LineSegments{constructor(e){super();a(this,"target");a(this,"type","VisMeshHelper");a(this,"cachaGeometryUUid");const t=1;this.target=e,this.geometry=new u.EdgesGeometry(e.geometry,t),this.cachaGeometryUUid=e.geometry.uuid,this.material=fe(),this.raycast=()=>{},this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.matrix=e.matrix,this.matrixWorld=e.matrixWorld,this.onBeforeRender=()=>{const i=this.target;i.geometry.uuid!==this.cachaGeometryUUid&&(this.geometry.dispose(),this.geometry=new u.EdgesGeometry(i.geometry,t),this.cachaGeometryUUid=i.geometry.uuid)}}}const Gt=class extends u.Points{constructor(e){super();a(this,"target");a(this,"type","VisPointsHelper");this.target=e,this.geometry.dispose(),this.geometry.copy(e.geometry),this.material.dispose(),this.material=new u.PointsMaterial({color:"rgb(255, 255, 255)",alphaMap:Gt.alphaTexture,transparent:!0});const t=Array.isArray(e.material)?e.material[0]:e.material;t instanceof u.PointsMaterial&&(this.material.size=t.size,this.material.sizeAttenuation=t.sizeAttenuation),this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.matrix=e.matrix,this.matrixWorld=e.matrixWorld,this.raycast=()=>{}}};let Ct=Gt;a(Ct,"alphaTexture",new u.CanvasTexture(new Ae({width:512,height:512,bgColor:"rgb(0, 0, 0)"}).draw(e=>{e.beginPath(),e.strokeStyle="rgb(255, 255, 255)",e.lineWidth=4,e.strokeRect(0,0,512,512),e.closePath()}).get()));const At=class extends u.Sprite{constructor(e){super();a(this,"target");a(this,"type","VisSpriteHelper");this.target=e,this.material.dispose(),this.material=new u.SpriteMaterial({color:"rgb(255, 255, 255)",alphaMap:At.alphaTexture,transparent:!0,depthWrite:!1}),this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.matrix=e.matrix,this.matrixWorld=e.matrixWorld,this.raycast=()=>{}}};let bt=At;a(bt,"alphaTexture",new u.CanvasTexture(new Ae({width:512,height:512,bgColor:"rgb(0, 0, 0)"}).draw(e=>{e.beginPath(),e.strokeStyle="rgb(255, 255, 255)",e.lineWidth=4,e.strokeRect(0,0,512,512),e.closePath()}).get()));class Ks extends J{constructor(e={}){super();a(this,"helperGenerator",{[r.CONFIGTYPE.POINTLIGHT]:Cn,[r.CONFIGTYPE.SPOTLIGHT]:bn,[r.CONFIGTYPE.DIRECTIONALLIGHT]:On,[r.CONFIGTYPE.PERSPECTIVECAMERA]:St,[r.CONFIGTYPE.ORTHOGRAPHICCAMERA]:St,[r.CONFIGTYPE.MESH]:Xs,[r.CONFIGTYPE.GROUP]:st,[r.CONFIGTYPE.SPRITE]:bt,[r.CONFIGTYPE.POINTS]:Ct,[r.CONFIGTYPE.LINE]:Ot,[r.CONFIGTYPE.CSS3DOBJECT]:_s,[r.CONFIGTYPE.CSS3DPLANE]:Qs});a(this,"helperFilter",{AmbientLight:!0,Object3D:!0,TransformControls:!0,Scene:!0});a(this,"objectFilter",new Set);a(this,"objectHelperMap",new Map);e.helperGenerator&&(this.helperGenerator=Object.assign(this.helperGenerator,e.helperGenerator)),e.helperFilter&&(this.helperFilter=Object.assign(this.helperFilter,e.helperFilter)),e.objectFilter&&(this.objectFilter=new Set(e.objectFilter.concat(Array.from(this.objectFilter))))}addFilteredObject(...e){for(const t of e)this.objectFilter.add(t);return this}addObjectHelper(e){if(this.objectFilter.has(e)||this.objectHelperMap.has(e)||this.helperFilter[e.type]||e.type.toLocaleLowerCase().includes("helper"))return null;if(!this.helperGenerator[e.type])return console.warn(`object helper can not support this type object: '${e.type}'`),null;const t=new this.helperGenerator[e.type](e);return this.objectHelperMap.set(e,t),t}disposeObjectHelper(e){if(this.objectFilter.has(e)||this.helperFilter[e.type]||e.type.toLocaleLowerCase().includes("helper"))return null;if(!this.objectHelperMap.has(e))return console.warn("object helper manager can not found this object`s helper: ",e),null;const t=this.objectHelperMap.get(e);return t.geometry&&t.geometry.dispose(),t.material&&(t.material instanceof u.Material?t.material.dispose():t.material.forEach(i=>{i.dispose()})),this.objectHelperMap.delete(e),t}}const Zs=function(n={}){if(!this.scene)return console.error("must install some scene plugin before ObjectHelper plugin."),!1;n.interact===void 0&&(n.interact=!0),n.interact&&(this.eventManager||(console.warn("must install eventManager plugin that can use interact function."),n.interact=!1));const e=new Ks,t=new Map,i=new Map,o=new Map,s=e.objectHelperMap;this.objectHelperManager=e,!n.activeColor&&(n.activeColor="rgb(230, 20, 240)"),!n.hoverColor&&(n.hoverColor="rgb(255, 158, 240)"),!n.defaultColor&&(n.defaultColor="rgb(255, 255, 255)"),!n.selectedColor&&(n.selectedColor=n.activeColor);const c=new u.Color(n.defaultColor).getHex(),l=new u.Color(n.activeColor).getHex(),h=new u.Color(n.hoverColor).getHex(),d=new u.Color(n.selectedColor).getHex(),m=new WeakSet,f=C=>{const O=C.objects;for(const T of O){const P=e.addObjectHelper(T);if(!!P&&(P.material.color.setHex(c),this.scene.add(P),n.interact)){const R=()=>{var E;((E=this.transformControls)==null?void 0:E.dragging)||this.selectionBox&&this.selectionBox.has(T)||P.material.color.setHex(h)},L=()=>{var E;((E=this.transformControls)==null?void 0:E.dragging)||this.selectionBox&&this.selectionBox.has(T)||P.material.color.setHex(c)},H=()=>{var E;((E=this.transformControls)==null?void 0:E.dragging)||this.selectionBox&&this.selectionBox.has(T)||P.material.color.setHex(l)};T.addEventListener("pointerenter",R),T.addEventListener("pointerleave",L),T.addEventListener("click",H),t.set(T,R),i.set(T,L),o.set(T,H)}}},y=C=>{const O=C.objects;for(const T of O){const P=e.disposeObjectHelper(T);!P||(this.scene.remove(P),n.interact&&(T.removeEventListener("pointerenter",t.get(T)),T.removeEventListener("pointerleave",i.get(T)),T.removeEventListener("click",o.get(T)),t.delete(T),i.delete(T),o.delete(T)))}},g=C=>{m.has(C)||(C.traverse(O=>{const T=e.addObjectHelper(O);T&&C.add(T)}),m.add(C))};this.scene.addEventListener("afterAdd",f),this.scene.addEventListener("afterRemove",y),this.setObjectHelper=function(C){return C.show?this.scene.traverse(O=>{s.has(O)&&this.scene.add(s.get(O))}):this.scene.traverse(O=>{s.has(O)&&this.scene.remove(s.get(O))}),this},this.addEventListener("setScene",C=>{const O=C.scene;!m.has(O)&&g(O),O.hasEventListener("afterAdd",f)||O.addEventListener("afterAdd",f),O.hasEventListener("afterRemove",y)||O.addEventListener("afterRemove",y)});const M=new Set;return this.completeSet.add(()=>{this.selectionBox&&this.addEventListener("selected",C=>{M.forEach(O=>{O.material.color.setHex(c)}),M.clear();for(const O of C.objects)if(s.has(O)){const T=s.get(O);T.material.color.setHex(d),M.add(T)}})}),!0},Js=function(n={}){if(this.selectionBox)return console.warn("engine has installed selection plugin."),!1;if(!this.eventManager)return console.warn("must install eventManager plugin before Selection plugin."),!1;this.selectionBox=new Set;const e=()=>{const t=[];this.IS_ENGINESUPPORT&&this.selectionBox.forEach(i=>{const o=this.compilerManager.getObjectSymbol(i);o?t.push(o):console.warn("selection plugin can not font vid in compilerManager.",i)}),this.dispatchEvent({type:"selected",objects:[...this.selectionBox],objectSymbols:t})};return this.setSelectionBox=function(t){this.selectionBox.clear();for(const i of t.objects)this.selectionBox.add(i);return e(),this},this.eventManager.addEventListener("click",t=>{var o,s,c;if(this.transing){this.transing=!1;return}const i=t.intersections;if(t.ctrlKey||this.selectionBox.clear(),this.eventManager.penetrate)for(const l of i){if(t.ctrlKey&&((o=this.selectionBox)==null?void 0:o.has(l.object))){this.selectionBox.delete(l.object);continue}this.selectionBox.add(l.object)}else if(i.length){const l=i[0].object;if(t.ctrlKey&&((s=this.selectionBox)==null?void 0:s.has(l))){this.selectionBox.delete(l);return}(c=this.selectionBox)==null||c.add(l)}e()}),!0},qs=function(n={}){if(this.css3DRenderer)return console.warn("this has installed css3DRenderer plugin."),!1;this.css3DRenderer=new Ye.CSS3DRenderer;const e=this.css3DRenderer.domElement;if(e.classList.add("vis-css3D"),e.style.position="absolute",e.style.top="0",e.style.left="0",this.addEventListener("setDom",t=>{t.dom.appendChild(this.css3DRenderer.domElement)}),this.addEventListener("setSize",t=>{this.css3DRenderer.setSize(t.width,t.height)}),this.addEventListener("setScene",t=>{t.oldScene.traverse(o=>{o instanceof Ye.CSS3DObject&&(o.element.style.display="none")})}),this.renderManager)this.renderManager.removeEventListener("render",this.render),this.renderManager.addEventListener("render",t=>{this.css3DRenderer.render(this.scene,this.camera)});else if(this.webGLRenderer){const t=this.render.bind(this);this.render=function(){return t(),this.webGLRenderer.render(this.scene,this.camera),this}}else this.render=function(){return this.webGLRenderer.render(this.scene,this.camera),this};return!0};r.ENGINEPLUGIN=void 0,function(n){n.WEBGLRENDERER="WebGLRenderer",n.CSS3DRENDERER="CSS3DRenderer",n.SCENE="Scene",n.MODELINGSCENE="ModelingScene",n.RENDERMANAGER="RenderManager",n.ORBITCONTROLS="OrbitControls",n.STATS="Stats",n.EFFECTCOMPOSER="EffectComposer",n.POINTERMANAGER="PointerManager",n.EVENTMANAGER="EventManager",n.TRANSFORMCONTROLS="TransformControls",n.LOADERMANAGER="LoaderManager",n.RESOURCEMANAGER="ResourceManager",n.DATASUPPORTMANAGER="DataSupportManager",n.COMPILERMANAGER="CompilerManager",n.KEYBOARDMANAGER="KeyboardManager",n.AXESHELPER="AxesHelper",n.GRIDHELPER="GridHelper",n.VIEWPOINT="Viewpoint",n.DISPLAYMODE="DisplayMode",n.OBJECTHELPER="ObjectHelper",n.SELECTION="Selection"}(r.ENGINEPLUGIN||(r.ENGINEPLUGIN={}));const ge=class extends J{constructor(){super();a(this,"completeSet");a(this,"camera",new u.PerspectiveCamera);a(this,"scene",new u.Scene);a(this,"IS_ENGINESUPPORT",!1);a(this,"dom");a(this,"webGLRenderer");a(this,"css3DRenderer");a(this,"orbitControls");a(this,"transformControls");a(this,"effectComposer");a(this,"renderManager");a(this,"pointerManager");a(this,"eventManager");a(this,"loaderManager");a(this,"resourceManager");a(this,"dataSupportManager");a(this,"compilerManager");a(this,"keyboardManager");a(this,"objectHelperManager");a(this,"transing");a(this,"stats");a(this,"displayMode");a(this,"selectionBox");a(this,"getScreenshot");a(this,"setStats");a(this,"setTransformControls");a(this,"setViewpoint");a(this,"setDisplayMode");a(this,"setAxesHelper");a(this,"setGridHelper");a(this,"setObjectHelper");a(this,"setSelectionBox");a(this,"loadResources");a(this,"loadResourcesAsync");a(this,"registerResources");a(this,"toJSON");a(this,"exportConfig");a(this,"applyConfig");a(this,"reactiveConfig");a(this,"getConfigBySymbol");a(this,"removeConfigBySymbol");a(this,"getObjectSymbol");a(this,"getObjectBySymbol");a(this,"play");a(this,"stop");a(this,"render");this.completeSet=new Set,this.render=function(){return console.warn("can not install some plugin"),this},this.camera.position.set(50,50,50),this.addEventListener("setSize",e=>{this.camera.aspect=e.width/e.height,this.camera.updateProjectionMatrix()})}optimizeMemory(){Object.keys(this).forEach(e=>{this[e]===void 0&&delete this[e]})}install(e,t){return ge.pluginHandler.has(e)?ge.pluginHandler.get(e).call(this,t):console.error(`engine can not support ${e} plugin.`),this}complete(){return this.completeSet.forEach(e=>{e(this)}),this.completeSet.clear(),this}dispose(){return this.dispatchEvent({type:"dispose"}),this}setDom(e){return this.dom=e,this.dispatchEvent({type:"setDom",dom:e}),this}setSize(e,t){var i,o;return e&&e<=0||t&&t<=0?(console.warn(`you must be input width and height bigger then zero, width: ${e}, height: ${t}`),this):(!e&&(e=((i=this.dom)==null?void 0:i.offsetWidth)||window.innerWidth),!t&&(t=((o=this.dom)==null?void 0:o.offsetHeight)||window.innerHeight),this.dispatchEvent({type:"setSize",width:e,height:t}),this)}setCamera(e,t){if(typeof e=="object"&&e instanceof u.Camera)this.camera=e,this.dispatchEvent({type:"setCamera",camera:e,options:Object.assign({orbitControls:!0,transformControls:!0},t||{})});else if(this.IS_ENGINESUPPORT){const i=this.compilerManager.getObjectBySymbol(e);i?(this.camera=i,this.dispatchEvent({type:"setCamera",camera:i,options:Object.assign({orbitControls:!0,transformControls:!0},t||{})})):console.warn(`can not found camera in compilerManager: ${e}`)}else console.warn("engine is not a Engine support but use symbol to found camera.");return this}setScene(e){if(typeof e=="object"&&e instanceof u.Scene)this.dispatchEvent({type:"setScene",scene:e,oldScene:this.scene}),this.scene=e;else if(this.IS_ENGINESUPPORT){const t=this.compilerManager.getObjectBySymbol(e);t?(this.dispatchEvent({type:"setScene",scene:t,oldScene:this.scene}),this.scene=t):console.warn(`can not found scene in compilerManager: ${e}`)}else console.warn("engine is not a Engine support but use symbol to found scene.");return this}};let G=ge;a(G,"pluginHandler",new Map),a(G,"register",function(e,t){return ge.pluginHandler&&ge.pluginHandler.set(e,t),ge}),a(G,"dispose",function(){ge.pluginHandler=void 0}),G.register(r.ENGINEPLUGIN.WEBGLRENDERER,ai),G.register(r.ENGINEPLUGIN.CSS3DRENDERER,qs),G.register(r.ENGINEPLUGIN.EFFECTCOMPOSER,ei),G.register(r.ENGINEPLUGIN.RENDERMANAGER,Qn),G.register(r.ENGINEPLUGIN.POINTERMANAGER,ni),G.register(r.ENGINEPLUGIN.EVENTMANAGER,ri),G.register(r.ENGINEPLUGIN.LOADERMANAGER,ci),G.register(r.ENGINEPLUGIN.RESOURCEMANAGER,gr),G.register(r.ENGINEPLUGIN.DATASUPPORTMANAGER,Dr),G.register(r.ENGINEPLUGIN.COMPILERMANAGER,zs),G.register(r.ENGINEPLUGIN.KEYBOARDMANAGER,ks),G.register(r.ENGINEPLUGIN.ORBITCONTROLS,Zn),G.register(r.ENGINEPLUGIN.TRANSFORMCONTROLS,si),G.register(r.ENGINEPLUGIN.AXESHELPER,Vs),G.register(r.ENGINEPLUGIN.GRIDHELPER,$s),G.register(r.ENGINEPLUGIN.OBJECTHELPER,Zs),G.register(r.ENGINEPLUGIN.DISPLAYMODE,Ws),G.register(r.ENGINEPLUGIN.VIEWPOINT,Kn),G.register(r.ENGINEPLUGIN.STATS,qn),G.register(r.ENGINEPLUGIN.SELECTION,Js);class ea extends G{constructor(){super();this.install(r.ENGINEPLUGIN.WEBGLRENDERER,{antialias:!0,alpha:!0}).install(r.ENGINEPLUGIN.RENDERMANAGER).install(r.ENGINEPLUGIN.EFFECTCOMPOSER,{WebGLMultisampleRenderTarget:!0}).install(r.ENGINEPLUGIN.ORBITCONTROLS).install(r.ENGINEPLUGIN.POINTERMANAGER).install(r.ENGINEPLUGIN.EVENTMANAGER).complete()}}class ta extends G{constructor(){super();this.install(r.ENGINEPLUGIN.RENDERMANAGER).install(r.ENGINEPLUGIN.WEBGLRENDERER,{antialias:!0,alpha:!0}).install(r.ENGINEPLUGIN.POINTERMANAGER).install(r.ENGINEPLUGIN.EVENTMANAGER).install(r.ENGINEPLUGIN.EFFECTCOMPOSER,{WebGLMultisampleRenderTarget:!0}).install(r.ENGINEPLUGIN.SELECTION).install(r.ENGINEPLUGIN.AXESHELPER).install(r.ENGINEPLUGIN.GRIDHELPER).install(r.ENGINEPLUGIN.OBJECTHELPER).install(r.ENGINEPLUGIN.VIEWPOINT).install(r.ENGINEPLUGIN.DISPLAYMODE).install(r.ENGINEPLUGIN.STATS).install(r.ENGINEPLUGIN.ORBITCONTROLS).install(r.ENGINEPLUGIN.KEYBOARDMANAGER).install(r.ENGINEPLUGIN.TRANSFORMCONTROLS).complete()}}const Dt=class{constructor(){a(this,"supportData");a(this,"supportDataType")}create(e){return e?(this.supportData={},this.supportDataType=e,this):(console.warn("you must give a module type in create params"),this)}add(e){return!this.supportData||!this.supportDataType?(console.warn("you must call 'create' method before the 'add' method"),this):e.type?Dt.configModelMap[e.type]!==this.supportDataType?(console.warn(`current generator create config which module is in: ${this.supportDataType}, but you provide type is '${e.type}'`),this):(this.supportData[e.vid]=A(e.type,e),this):(console.warn("config can not found attribute 'type'"),this)}get(){return this.supportDataType=void 0,this.supportData?this.supportData:{}}};let Lt=Dt;a(Lt,"configModelMap",mt);const vt=new u.PointLight("rgb(255, 255, 255)",.5,200,1);vt.position.set(-30,5,20),vt.castShadow=!0;const at=new u.Mesh(new u.BoxBufferGeometry(80,2,80),new u.MeshStandardMaterial({color:"rgb(255, 255, 255)"}));at.position.set(0,-11,0),at.receiveShadow=!0,at.castShadow=!0;const ie=class{constructor(e){a(this,"material");a(this,"dom");a(this,"renderer");a(this,"scene");a(this,"camera");a(this,"object");const t=new u.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0});t.setPixelRatio(window.devicePixelRatio),t.setClearColor("rgb(150, 150, 150)"),t.shadowMap.enabled=!0,t.shadowMap.type=u.PCFSoftShadowMap;const i=new u.Scene,o=new u.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,500);o.position.set(0,0,35),o.up.x=0,o.up.y=1,o.up.z=0,o.lookAt(new u.Vector3(0,0,0)),i.add(ie.ambientLight),i.add(ie.pointLight),i.add(ie.plane),this.scene=i,this.renderer=t,this.camera=o,this.object=new u.Object3D,(e==null?void 0:e.material)&&this.setMaterial(e.material),(e==null?void 0:e.dom)&&this.setDom(e.dom)}setMaterial(e){if(this.scene.remove(this.object),this.material=e,e.type.includes("Mesh"))this.object=new u.Mesh(ie.geometry,e);else if(e.type.includes("Line"))this.object=new u.Line(ie.geometry,e);else if(e.type.includes("Ponits"))this.object=new u.Points(ie.geometry,e);else if(e.type.includes("Sprite"))this.object=new u.Sprite(e);else return console.warn(`material displayer can not support this type material: '${e.type}'`),this;return this.object.castShadow=!0,this.object.receiveShadow=!0,this.scene.add(this.object),this}setDom(e){return this.dom=e,this.setSize(),e.appendChild(this.renderer.domElement),this}setSize(e,t){if(e&&t)this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t,!0);else{if(!this.dom)return console.warn("material displayer must set dom before setSize with empty parameters"),this;const i=this.dom;this.camera.aspect=i.offsetWidth/i.offsetHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(i.offsetWidth,i.offsetHeight,!0)}return this}render(){this.renderer.render(this.scene,this.camera)}getDataURL(e){return this.renderer.domElement.toDataURL(e||"image/png")}dispose(){this.renderer.dispose()}};let ve=ie;a(ve,"ambientLight",new u.AmbientLight("rgb(255, 255, 255)",.7)),a(ve,"pointLight",vt),a(ve,"geometry",new u.SphereBufferGeometry(10,12,12)),a(ve,"plane",at),a(ve,"dispose",()=>{ie.geometry.dispose(),ie.plane.geometry.dispose()});const Ut=class{constructor(e){a(this,"dom");a(this,"texture");a(this,"renderer");a(this,"scene");a(this,"camera");const t=new u.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0});t.setPixelRatio(window.devicePixelRatio),t.setClearColor("rgb(150, 150, 150)"),t.shadowMap.enabled=!0,t.shadowMap.type=u.PCFSoftShadowMap;const i=new u.Scene,o=new u.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,500);o.position.set(0,0,35),o.up.x=0,o.up.y=1,o.up.z=0,o.lookAt(new u.Vector3(0,0,0)),i.add(Ut.ambientLight),this.scene=i,this.renderer=t,this.camera=o,(e==null?void 0:e.texture)&&this.setTexture(e.texture),(e==null?void 0:e.dom)&&this.setDom(e.dom)}setTexture(e){return this.scene.background=e,this}setDom(e){return this.dom=e,this.setSize(),e.appendChild(this.renderer.domElement),this}setSize(e,t){if(e&&t)this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t,!0);else{if(!this.dom)return console.warn("texture displayer must set dom before setSize with empty parameters"),this;const i=this.dom;this.camera.aspect=i.offsetWidth/i.offsetHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(i.offsetWidth,i.offsetHeight,!0)}return this}render(){this.renderer.render(this.scene,this.camera)}getDataURL(e){return this.renderer.domElement.toDataURL(e||"image/png")}dispose(){this.renderer.dispose()}};let Pt=Ut;a(Pt,"ambientLight",new u.AmbientLight("rgb(255, 255, 255)",1));class wt extends G{constructor(e={},t={}){super();a(this,"IS_ENGINESUPPORT",!0);this.install(r.ENGINEPLUGIN.LOADERMANAGER).install(r.ENGINEPLUGIN.RESOURCEMANAGER,{resources:t}).install(r.ENGINEPLUGIN.POINTERMANAGER).install(r.ENGINEPLUGIN.EVENTMANAGER).install(r.ENGINEPLUGIN.RENDERMANAGER).install(r.ENGINEPLUGIN.DATASUPPORTMANAGER,e).install(r.ENGINEPLUGIN.COMPILERMANAGER)}loadLifeCycle(e){const t=this.dataSupportManager;e.texture&&t.load({texture:e.texture}),e.material&&t.load({material:e.material}),delete e.texture,delete e.material,t.load(e)}removeLifeCycle(e){const t=this.dataSupportManager,i=e[r.MODULETYPE.TEXTURE]||{},o=e[r.MODULETYPE.MATERIAL]||{},s=e.assets||[];delete e.texture,delete e.material,delete e.assets,t.remove(e),t.remove({[r.MODULETYPE.MATERIAL]:o}),t.remove({[r.MODULETYPE.TEXTURE]:i});const c=this.resourceManager,l=this.loaderManager;s.forEach(h=>{c.remove(h),l.remove(h)})}loadConfig(e,t){const i=this.renderManager.hasRendering();if(i&&this.renderManager.stop(),e.assets&&e.assets.length){const o=s=>{delete e.assets,this.loadLifeCycle(e),this.resourceManager.removeEventListener("mapped",o),t&&t(s),i?this.renderManager.play():this.renderManager.render()};this.resourceManager.addEventListener("mapped",o),this.loaderManager.reset().load(e.assets)}else this.loadLifeCycle(e),t&&t(),i?this.renderManager.play():this.renderManager.render();return this}loadConfigAsync(e){return new Promise((t,i)=>{const o=this.renderManager.hasRendering();if(o&&this.renderManager.stop(),e.assets&&e.assets.length){const s=c=>{delete e.assets,this.loadLifeCycle(e),this.resourceManager.removeEventListener("mapped",s),o?this.renderManager.play():this.renderManager.render(),t(c)};this.resourceManager.addEventListener("mapped",s),this.loaderManager.reset().load(e.assets)}else this.loadLifeCycle(e),o?this.renderManager.play():this.renderManager.render(),t(void 0)})}removeConfig(e){this.removeLifeCycle(e)}getObjectConfig(e){const t=this.getObjectSymbol(e);return t?this.getConfigBySymbol(t):null}}class na extends wt{constructor(e){super(e);a(this,"IS_ENGINESUPPORT",!0);this.install(r.ENGINEPLUGIN.WEBGLRENDERER,{antialias:!0,alpha:!0}).install(r.ENGINEPLUGIN.EFFECTCOMPOSER,{WebGLMultisampleRenderTarget:!0}).install(r.ENGINEPLUGIN.SELECTION).install(r.ENGINEPLUGIN.AXESHELPER).install(r.ENGINEPLUGIN.GRIDHELPER).install(r.ENGINEPLUGIN.OBJECTHELPER).install(r.ENGINEPLUGIN.VIEWPOINT).install(r.ENGINEPLUGIN.DISPLAYMODE).install(r.ENGINEPLUGIN.STATS).install(r.ENGINEPLUGIN.ORBITCONTROLS).install(r.ENGINEPLUGIN.KEYBOARDMANAGER).install(r.ENGINEPLUGIN.TRANSFORMCONTROLS).complete()}}class ia extends wt{constructor(e){super(e);this.install(r.ENGINEPLUGIN.WEBGLRENDERER,{antialias:!0,alpha:!0}).install(r.ENGINEPLUGIN.EFFECTCOMPOSER,{WebGLMultisampleRenderTarget:!0}).install(r.ENGINEPLUGIN.ORBITCONTROLS).complete()}}class ra{constructor(e){a(this,"visible",!0);e.visible&&(this.visible=e.visible)}}class oa extends ra{constructor(e){super(e);a(this,"source");a(this,"target");a(this,"mode");a(this,"cacheSourceMatrix");a(this,"cacheTargetMatrix");a(this,"cacheSoruceGeometryUuid");a(this,"cacheTargetGeometryUuid");a(this,"originalGeometry");a(this,"modifiedGeometry");this.source=e.source,this.target=e.target,this.mode=e.mode||"subtract",this.cacheSourceMatrix=this.source.matrix.clone(),this.cacheTargetMatrix=this.target.matrix.clone(),this.cacheSoruceGeometryUuid=this.source.geometry.uuid,this.cacheTargetGeometryUuid=this.target.geometry.uuid,this.originalGeometry=this.source.geometry,this.modifiedGeometry=new u.BufferGeometry,this.modify(),this.source.geometry=this.modifiedGeometry}async modify(){const e=this.source,t={geometry:this.originalGeometry,matrix:this.source.matrix},i=dt.CSG.fromMesh(t),o=dt.CSG.fromMesh(this.target),s=dt.CSG.toGeometry(i[this.mode](o),e.matrix);this.modifiedGeometry.copy(s),this.modifiedGeometry.uuid=s.uuid}render(){if(this.visible){if(!this.cacheSourceMatrix.equals(this.source.matrix)){this.modify(),this.cacheSourceMatrix.copy(this.source.matrix);return}if(!this.cacheTargetMatrix.equals(this.target.matrix)){this.modify(),this.cacheTargetMatrix.copy(this.target.matrix);return}if(this.originalGeometry.uuid!==this.cacheSoruceGeometryUuid){this.modify(),this.cacheSoruceGeometryUuid=this.originalGeometry.uuid;return}if(this.target.geometry.uuid!==this.cacheTargetGeometryUuid){this.modify(),this.cacheTargetGeometryUuid=this.target.geometry.uuid;return}}else this.modifiedGeometry.copy(this.originalGeometry)}apply(){this.originalGeometry.copy(this.modifiedGeometry),this.originalGeometry.uuid=this.modifiedGeometry.uuid,this.source.geometry=this.originalGeometry}dispose(){this.source.geometry=this.originalGeometry,this.modifiedGeometry.dispose()}}class sa{next(){console.warn(`this action can not set next function: ${this.constructor.name}`)}prev(){console.warn(`this action can not set prev function: ${this.constructor.name}`)}}class aa{constructor(e){a(this,"actionList",[]);a(this,"index",-1);a(this,"step",50);this.step=e||50}do(e){this.actionList[this.index][e]()}apply(e,t=!1){const i=this.actionList;this.index===i.length-1&&i.length>=this.step?(i.shift(),this.index=this.actionList.length-1):this.index!==-1?i.splice(this.index+1,i.length-1):this.index===-1&&(this.actionList=[]),this.actionList.push(e),t?this.redo():this.index+=1}redo(){if(this.index+=1,this.index>this.actionList.length-1){this.index=this.actionList.length-1;return}this.do("next")}undo(){this.index<0||(this.do("prev"),this.index-=1)}clear(){this.actionList=[]}}const ca="0.2.0";window.__THREE__||console.error("vis-three dependent on three.js module, pleace run 'npm i three' first."),window.__VIS__?console.warn("Duplicate vis-three frames are introduced"):window.__VIS__=ca,u.Scene.prototype.add=function(...n){if(!arguments.length)return this;if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}const e=n[0];if(e===this)return console.error("THREE.Object3D.add: object can't be added as a child of itself.",n),this;if(e&&e.isObject3D){if(e.parent!==null){const t=this.children.indexOf(e);t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent({type:"removed"}))}e.parent=this,this.children.push(e),e.dispatchEvent({type:"added"})}else console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",n);return this};const la=u.Scene.prototype.add,ua=u.Scene.prototype.remove;u.Scene.prototype.add=function(...n){return la.call(this,...n),this.dispatchEvent({type:"afterAdd",objects:n}),this},u.Scene.prototype.remove=function(...n){return ua.call(this,...n),this.dispatchEvent({type:"afterRemove",objects:n}),this};const It=new Wn.LightShadow(new u.OrthographicCamera(-256,256,256,-256));It.autoUpdate=!1,It.needsUpdate=!1,u.AmbientLight.prototype.shadow=It,r.Action=sa,r.AniScriptLibrary=he,r.AnimationDataSupport=hn,r.BooleanModifier=oa,r.CONFIGMODULE=mt,r.CSS3DDataSupport=pn,r.CameraDataSupport=tn,r.CameraHelper=St,r.CanvasGenerator=Ae,r.ControlsDataSupport=on,r.DataSupportManager=mn,r.DirectionalLightHelper=On,r.DisplayEngine=ea,r.DisplayEngineSupport=ia,r.Engine=G,r.EngineSupport=wt,r.EventLibrary=D,r.GeometryDataSupport=en,r.GroupDataSupport=un,r.GroupHelper=st,r.History=aa,r.JSONHandler=fr,r.KeyboardManager=Sn,r.LightDataSupport=qt,r.LineDataSupport=an,r.LoaderManager=$t,r.MaterialDataSupport=Jt,r.MaterialDisplayer=ve,r.MeshDataSupport=cn,r.ModelingEngine=ta,r.ModelingEngineSupport=na,r.PassDataSupport=dn,r.PointLightHelper=Cn,r.PointsDataSupport=ln,r.ProxyBroadcast=Be,r.RenderManager=Vt,r.RendererDataSupport=nn,r.ResourceManager=Xt,r.SceneDataSupport=rn,r.SelectiveBloomPass=ke,r.ShaderLibrary=_,r.SpotLightHelper=bn,r.SpriteDataSupport=sn,r.SupportDataGenerator=Lt,r.TextureDataSupport=Zt,r.TextureDisplayer=Pt,r.Translater=Kt,r.VideoLoader=Me,r.generateConfig=A,Object.defineProperty(r,"__esModule",{value:!0}),r[Symbol.toStringTag]="Module"});
