var ll=Object.defineProperty,ul=Object.defineProperties;var dl=Object.getOwnPropertyDescriptors;var Os=Object.getOwnPropertySymbols;var hl=Object.prototype.hasOwnProperty,pl=Object.prototype.propertyIsEnumerable;var ln=(a,l,W)=>l in a?ll(a,l,{enumerable:!0,configurable:!0,writable:!0,value:W}):a[l]=W,j=(a,l)=>{for(var W in l||(l={}))hl.call(l,W)&&ln(a,W,l[W]);if(Os)for(var W of Os(l))pl.call(l,W)&&ln(a,W,l[W]);return a},at=(a,l)=>ul(a,dl(l));var h=(a,l,W)=>(ln(a,typeof l!="symbol"?l+"":l,W),W);(function(a,l){typeof exports=="object"&&typeof module!="undefined"?l(exports,require("three"),require("three/examples/jsm/libs/stats.module"),require("three/examples/jsm/postprocessing/EffectComposer"),require("three/examples/jsm/controls/TransformControls"),require("three/examples/jsm/loaders/OBJLoader"),require("three/examples/jsm/loaders/RGBELoader"),require("three/examples/jsm/loaders/DRACOLoader"),require("three/examples/jsm/libs/meshopt_decoder.module.js"),require("uuid"),require("three/examples/jsm/renderers/CSS3DRenderer"),require("@tweenjs/tween.js"),require("three/examples/jsm/postprocessing/SMAAPass"),require("three/examples/jsm/postprocessing/UnrealBloomPass"),require("three/examples/jsm/postprocessing/Pass"),require("keyboardjs"),require("three-csg-ts"),require("three/src/lights/LightShadow")):typeof define=="function"&&define.amd?define(["exports","three","three/examples/jsm/libs/stats.module","three/examples/jsm/postprocessing/EffectComposer","three/examples/jsm/controls/TransformControls","three/examples/jsm/loaders/OBJLoader","three/examples/jsm/loaders/RGBELoader","three/examples/jsm/loaders/DRACOLoader","three/examples/jsm/libs/meshopt_decoder.module.js","uuid","three/examples/jsm/renderers/CSS3DRenderer","@tweenjs/tween.js","three/examples/jsm/postprocessing/SMAAPass","three/examples/jsm/postprocessing/UnrealBloomPass","three/examples/jsm/postprocessing/Pass","keyboardjs","three-csg-ts","three/src/lights/LightShadow"],l):(a=typeof globalThis!="undefined"?globalThis:a||self,l(a.Vis={},a.three,a.Stats,a.EffectComposer,a.TransformControls,a.OBJLoader,a.RGBELoader,a.DRACOLoader,a.meshopt_decoder_module_js,a.uuid,a.CSS3DRenderer,a.tween_js,a.SMAAPass,a.UnrealBloomPass,a.Pass$1,a.keyboardjs,a.threeCsgTs,a.LightShadow))})(this,function(a,l,W,It,bs,Rs,Ls,ws,Ps,se,Oe,D,As,Is,un,vs,vt,Ns){"use strict";function dn(n){return n&&typeof n=="object"&&"default"in n?n:{default:n}}var Gs=dn(W),ct=dn(vs);class re{constructor(){h(this,"listeners",new Map)}addEventListener(e,t){const s=this.listeners;s.has(e)||s.set(e,new Set),s.get(e).add(t)}hasEventListener(e,t){const s=this.listeners;return s.has(e)?s.get(e).has(t):!1}removeEventListener(e,t){const s=this.listeners;!s.has(e)||!s.get(e).has(t)||s.get(e).delete(t)}dispatchEvent(e){var r;const t=e.type,s=this.listeners;if(s.has(t))try{(r=s.get(t))==null||r.forEach(i=>{i.call(this,e)})}catch(i){console.error(i)}}clear(){this.listeners=new Map}useful(){return Boolean([...this.listeners.keys()].length)}once(e,t){const s=function(r){t.call(this,r),this.removeEventListener(e,s)};this.addEventListener(e,s)}}class hn extends re{constructor(e=0){super();h(this,"clock",new l.Clock);h(this,"animationFrame",-1);h(this,"fps",0);h(this,"timer",null);h(this,"playFun",()=>{});h(this,"render",()=>{this.dispatchEvent({type:"render",delta:this.clock.getDelta(),total:this.clock.getElapsedTime()})});h(this,"play",()=>{if(this.hasRendering()){console.warn("render manager is rendering.");return}this.dispatchEvent({type:"play"}),this.playFun()});h(this,"stop",()=>{this.animationFrame!==-1&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=-1),this.timer&&(clearTimeout(this.timer),this.timer=null),this.dispatchEvent({type:"stop"})});h(this,"hasRendering",()=>Boolean(this.animationFrame!==-1||this.timer));h(this,"hasVaildRender",()=>this.useful());this.setFPS(e)}setFPS(e){return this.animationFrame!==-1&&cancelAnimationFrame(this.animationFrame),this.timer&&clearTimeout(this.timer),this.fps=e,e<=0?(this.fps=0,this.playFun=()=>{this.render(),this.animationFrame=requestAnimationFrame(this.playFun)}):this.playFun=()=>{this.timer=setTimeout(()=>{this.playFun()},e),this.render()},this.playFun(),this}dispose(){this.hasRendering()&&this.stop(),this.clear()}}const Ds=function(){return this.renderManager?(console.warn("has installed render manager plugin."),!1):(this.renderManager=new hn,this.render=function(){return this.renderManager.render(),this},this.play=function(){return this.renderManager.play(),this},this.stop=function(){return this.renderManager.stop(),this},this.addEventListener("dispose",()=>{this.renderManager.dispose()}),!0)};class pn extends re{constructor(e,t){super();h(this,"object");h(this,"domElement");h(this,"enabled",!0);h(this,"target",new l.Vector3);h(this,"minDistance",0);h(this,"maxDistance",1/0);h(this,"minZoom",0);h(this,"maxZoom",1/0);h(this,"minPolarAngle",0);h(this,"maxPolarAngle",Math.PI);h(this,"minAzimuthAngle",-1/0);h(this,"maxAzimuthAngle",1/0);h(this,"enableDamping",!1);h(this,"dampingFactor",.05);h(this,"enableZoom",!0);h(this,"zoomSpeed",1);h(this,"enableRotate",!0);h(this,"rotateSpeed",1);h(this,"enablePan",!0);h(this,"panSpeed",1);h(this,"screenSpacePanning",!0);h(this,"keyPanSpeed",7);h(this,"autoRotate",!1);h(this,"autoRotateSpeed",2);h(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"});h(this,"mouseButtons",{LEFT:null,MIDDLE:l.MOUSE.DOLLY,RIGHT:l.MOUSE.ROTATE});h(this,"touches",{ONE:l.TOUCH.ROTATE,TWO:l.TOUCH.DOLLY_PAN});h(this,"target0");h(this,"position0");h(this,"zoom0");h(this,"_domElementKeyEvents",null);h(this,"spherical");h(this,"reset");h(this,"update");h(this,"onContextMenu");h(this,"onPointerDown");h(this,"onPointerCancel");h(this,"onMouseWheel");h(this,"onPointerMove");h(this,"onPointerUp");h(this,"onKeyDown");this.object=e||new l.PerspectiveCamera,this.domElement=t||document.createElement("div"),this.domElement.style.touchAction="none",this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.update=(()=>{const m=new l.Vector3,w=new l.Quaternion().setFromUnitVectors(this.object.up,new l.Vector3(0,1,0)),Y=w.clone().invert(),V=new l.Vector3,Ge=new l.Quaternion,De=2*Math.PI;return()=>{const Cs=this.object.position;m.copy(Cs).sub(this.target),m.applyQuaternion(w),o.setFromVector3(m),this.autoRotate&&r===s.NONE&&I(S()),this.enableDamping?(o.theta+=c.theta*this.dampingFactor,o.phi+=c.phi*this.dampingFactor):(o.theta+=c.theta,o.phi+=c.phi);let Se=this.minAzimuthAngle,Ce=this.maxAzimuthAngle;return isFinite(Se)&&isFinite(Ce)&&(Se<-Math.PI?Se+=De:Se>Math.PI&&(Se-=De),Ce<-Math.PI?Ce+=De:Ce>Math.PI&&(Ce-=De),Se<=Ce?o.theta=Math.max(Se,Math.min(Ce,o.theta)):o.theta=o.theta>(Se+Ce)/2?Math.max(Se,o.theta):Math.min(Ce,o.theta)),o.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,o.phi)),o.makeSafe(),o.radius*=u,o.radius=Math.max(this.minDistance,Math.min(this.maxDistance,o.radius)),this.enableDamping===!0?this.target.addScaledVector(d,this.dampingFactor):this.target.add(d),m.setFromSpherical(o),m.applyQuaternion(Y),Cs.copy(this.target).add(m),this.object.lookAt(this.target),this.enableDamping===!0?(c.theta*=1-this.dampingFactor,c.phi*=1-this.dampingFactor,d.multiplyScalar(1-this.dampingFactor)):(c.set(0,0,0),d.set(0,0,0)),u=1,p||V.distanceToSquared(this.object.position)>i||8*(1-Ge.dot(this.object.quaternion))>i?(this.dispatchEvent({type:"change"}),V.copy(this.object.position),Ge.copy(this.object.quaternion),p=!1,!0):!1}})();const s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let r=s.NONE;const i=1e-6,o=new l.Spherical,c=new l.Spherical;let u=1;const d=new l.Vector3;let p=!1;const f=new l.Vector2,g=new l.Vector2,E=new l.Vector2,T=new l.Vector2,C=new l.Vector2,M=new l.Vector2,y=new l.Vector2,O=new l.Vector2,b=new l.Vector2,R=[],G={},S=()=>2*Math.PI/60/60*this.autoRotateSpeed,N=()=>Math.pow(.95,this.zoomSpeed),I=m=>{c.theta-=m},P=m=>{c.phi-=m},he=function(){const m=new l.Vector3;return function(Y,V){m.setFromMatrixColumn(V,0),m.multiplyScalar(-Y),d.add(m)}}(),pe=(()=>{const m=new l.Vector3;return(w,Y)=>{this.screenSpacePanning===!0?m.setFromMatrixColumn(Y,1):(m.setFromMatrixColumn(Y,0),m.crossVectors(this.object.up,m)),m.multiplyScalar(w),d.add(m)}})(),Q=(()=>{const m=new l.Vector3;return(w,Y)=>{const V=this.domElement;if(this.object instanceof l.PerspectiveCamera){const Ge=this.object.position;m.copy(Ge).sub(this.target);let De=m.length();De*=Math.tan(this.object.fov/2*Math.PI/180),he(2*w*De/V.clientHeight,this.object.matrix),pe(2*Y*De/V.clientHeight,this.object.matrix)}else this.object instanceof l.OrthographicCamera?(he(w*(this.object.right-this.object.left)/this.object.zoom/V.clientWidth,this.object.matrix),pe(Y*(this.object.top-this.object.bottom)/this.object.zoom/V.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}})(),z=m=>{this.object instanceof l.PerspectiveCamera?u/=m:this.object instanceof l.OrthographicCamera?(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*m)),this.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)},fe=m=>{this.object instanceof l.PerspectiveCamera?u*=m:this.object instanceof l.OrthographicCamera?(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/m)),this.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)};function ne(m){f.set(m.clientX,m.clientY)}function Pt(m){y.set(m.clientX,m.clientY)}function At(m){T.set(m.clientX,m.clientY)}const on=m=>{g.set(m.clientX,m.clientY),E.subVectors(g,f).multiplyScalar(this.rotateSpeed);const w=this.domElement;I(2*Math.PI*E.x/w.clientHeight),P(2*Math.PI*E.y/w.clientHeight),f.copy(g),this.update()},Kc=m=>{O.set(m.clientX,m.clientY),b.subVectors(O,y),b.y>0?z(N()):b.y<0&&fe(N()),y.copy(O),this.update()},Xc=m=>{C.set(m.clientX,m.clientY),M.subVectors(C,T).multiplyScalar(this.panSpeed),Q(M.x,M.y),T.copy(C),this.update()},Qc=m=>{m.deltaY<0?fe(N()):m.deltaY>0&&z(N()),this.update()},qc=m=>{let w=!1;switch(m.code){case this.keys.UP:Q(0,this.keyPanSpeed),w=!0;break;case this.keys.BOTTOM:Q(0,-this.keyPanSpeed),w=!0;break;case this.keys.LEFT:Q(this.keyPanSpeed,0),w=!0;break;case this.keys.RIGHT:Q(-this.keyPanSpeed,0),w=!0;break}w&&(m.preventDefault(),this.update())};function fs(){if(R.length===1)f.set(R[0].pageX,R[0].pageY);else{const m=.5*(R[0].pageX+R[1].pageX),w=.5*(R[0].pageY+R[1].pageY);f.set(m,w)}}function ms(){if(R.length===1)T.set(R[0].pageX,R[0].pageY);else{const m=.5*(R[0].pageX+R[1].pageX),w=.5*(R[0].pageY+R[1].pageY);T.set(m,w)}}function gs(){const m=R[0].pageX-R[1].pageX,w=R[0].pageY-R[1].pageY,Y=Math.sqrt(m*m+w*w);y.set(0,Y)}const Jc=()=>{this.enableZoom&&gs(),this.enablePan&&ms()},Zc=()=>{this.enableZoom&&gs(),this.enableRotate&&fs()},Es=m=>{if(R.length==1)g.set(m.pageX,m.pageY);else{const Y=cn(m),V=.5*(m.pageX+Y.x),Ge=.5*(m.pageY+Y.y);g.set(V,Ge)}E.subVectors(g,f).multiplyScalar(this.rotateSpeed);const w=this.domElement;I(2*Math.PI*E.x/w.clientHeight),P(2*Math.PI*E.y/w.clientHeight),f.copy(g)},Ts=m=>{if(R.length===1)C.set(m.pageX,m.pageY);else{const w=cn(m),Y=.5*(m.pageX+w.x),V=.5*(m.pageY+w.y);C.set(Y,V)}M.subVectors(C,T).multiplyScalar(this.panSpeed),Q(M.x,M.y),T.copy(C)},ys=m=>{const w=cn(m),Y=m.pageX-w.x,V=m.pageY-w.y,Ge=Math.sqrt(Y*Y+V*V);O.set(0,Ge),b.set(0,Math.pow(O.y/y.y,this.zoomSpeed)),z(b.y),y.copy(O)},el=m=>{this.enableZoom&&ys(m),this.enablePan&&Ts(m)},tl=m=>{this.enableZoom&&ys(m),this.enableRotate&&Es(m)};this.onPointerDown=m=>{this.enabled!==!1&&(R.length===0&&(this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp)),cl(m),m.pointerType==="touch"?il(m):nl(m))};let an=!1;this.onPointerMove=m=>{this.enabled!==!1&&(an||(this.domElement.setPointerCapture(m.pointerId),an=!0),m.pointerType==="touch"?ol(m):sl(m))},this.onPointerUp=m=>{this.enabled!==!1&&(an=!1,m.pointerType==="touch"?al():rl(m),Ms(m),R.length===0&&(this.domElement.releasePointerCapture(m.pointerId),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)))},this.onPointerCancel=m=>{Ms(m)};const nl=m=>{let w;switch(m.button){case 0:w=this.mouseButtons.LEFT;break;case 1:w=this.mouseButtons.MIDDLE;break;case 2:w=this.mouseButtons.RIGHT;break;default:w=-1}switch(w){case l.MOUSE.DOLLY:if(this.enableZoom===!1)return;Pt(m),r=s.DOLLY;break;case l.MOUSE.ROTATE:if(m.ctrlKey||m.metaKey||m.shiftKey){if(this.enablePan===!1)return;At(m),r=s.PAN}else{if(this.enableRotate===!1)return;ne(m),r=s.ROTATE}break;case l.MOUSE.PAN:if(m.ctrlKey||m.metaKey||m.shiftKey){if(this.enableRotate===!1)return;ne(m),r=s.ROTATE}else{if(this.enablePan===!1)return;At(m),r=s.PAN}break;default:r=s.NONE}r!==s.NONE&&this.dispatchEvent({type:"start"})},sl=m=>{if(this.enabled!==!1)switch(r){case s.ROTATE:if(this.enableRotate===!1)return;on(m);break;case s.DOLLY:if(this.enableZoom===!1)return;Kc(m);break;case s.PAN:if(this.enablePan===!1)return;Xc(m);break}},rl=m=>{this.dispatchEvent({type:"end"}),r=s.NONE};this.onMouseWheel=m=>{this.enabled===!1||this.enableZoom===!1||r!==s.NONE||(m.preventDefault(),this.dispatchEvent({type:"start"}),Qc(m),this.dispatchEvent({type:"end"}))},this.onKeyDown=m=>{this.enabled===!1||this.enablePan===!1||qc(m)};const il=m=>{switch(Ss(m),R.length){case 1:switch(this.touches.ONE){case l.TOUCH.ROTATE:if(this.enableRotate===!1)return;fs(),r=s.TOUCH_ROTATE;break;case l.TOUCH.PAN:if(this.enablePan===!1)return;ms(),r=s.TOUCH_PAN;break;default:r=s.NONE}break;case 2:switch(this.touches.TWO){case l.TOUCH.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;Jc(),r=s.TOUCH_DOLLY_PAN;break;case l.TOUCH.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;Zc(),r=s.TOUCH_DOLLY_ROTATE;break;default:r=s.NONE}break;default:r=s.NONE}r!==s.NONE&&this.dispatchEvent({type:"start"})},ol=m=>{switch(Ss(m),r){case s.TOUCH_ROTATE:if(this.enableRotate===!1)return;Es(m),this.update();break;case s.TOUCH_PAN:if(this.enablePan===!1)return;Ts(m),this.update();break;case s.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;el(m),this.update();break;case s.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;tl(m),this.update();break;default:r=s.NONE}},al=m=>{this.dispatchEvent({type:"end"}),r=s.NONE};this.onContextMenu=m=>{this.enabled!==!1&&m.preventDefault()};function cl(m){R.push(m)}const Ms=m=>{delete G[m.pointerId];for(let w=0;w<R.length;w++)if(R[w].pointerId==m.pointerId){R.splice(w,1);return}};function Ss(m){let w=G[m.pointerId];w===void 0&&(w=new l.Vector2,G[m.pointerId]=w),w.set(m.pageX,m.pageY)}function cn(m){const w=m.pointerId===R[0].pointerId?R[1]:R[0];return G[w.pointerId]}this.spherical=o,this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),this.domElement.addEventListener("wheel",this.onMouseWheel,{passive:!1}),this.reset=()=>{this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent({type:"change"}),this.update(),r=s.NONE},this.update()}getPolarAngle(){return this.spherical.phi}getAzimuthalAngle(){return this.spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this.onKeyDown),this._domElementKeyEvents=e}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}setCamera(e){this.object=e}setDom(e){this.dispose(),this.domElement=e,this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),this.domElement.addEventListener("wheel",this.onMouseWheel,{passive:!1})}dispose(){this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("pointercancel",this.onPointerCancel),this.domElement.removeEventListener("wheel",this.onMouseWheel),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp),this._domElementKeyEvents!==null&&this._domElementKeyEvents.removeEventListener("keydown",this.onKeyDown)}}a.VIEWPOINT=void 0,function(n){n.DEFAULT="default",n.TOP="top",n.BOTTOM="bottom",n.LEFT="left",n.RIGHT="right",n.FRONT="front",n.BACK="back"}(a.VIEWPOINT||(a.VIEWPOINT={}));const Fs=function(n={}){var r;if(!this.webGLRenderer)return console.error("must install some renderer before BasicViewpoint plugin."),!1;!n.viewpoint&&(n.viewpoint=a.VIEWPOINT.DEFAULT),!n.perspective&&(n.perspective={}),!n.perspective.position&&(n.perspective.position={x:60,y:60,z:60}),!n.perspective.lookAt&&(n.perspective.lookAt={x:0,y:0,z:0}),!n.perspective.up&&(n.perspective.up={x:0,y:1,z:0}),!n.orthograpbic&&(n.orthograpbic={}),!n.orthograpbic.up&&(n.orthograpbic.up={x:0,y:1,z:0});const e=new l.PerspectiveCamera;e.position.set(n.perspective.position.x,n.perspective.position.y,n.perspective.position.z),e.lookAt(n.perspective.lookAt.x,n.perspective.lookAt.y,n.perspective.lookAt.z),e.up.set(n.perspective.up.x,n.perspective.up.y,n.perspective.up.z);const t=n.orthograpbic.distance||1e4,s=new l.OrthographicCamera(-window.innerWidth/8,window.innerWidth/8,-window.innerHeight/8,window.innerHeight/8,0,t);return s.up.set(n.perspective.up.x,n.perspective.up.y,n.perspective.up.z),this.setViewpoint=function(i){return this.dispatchEvent({type:"setViewpoint",viewpoint:i}),this},this.addEventListener("setSize",i=>{const o=i.width,c=i.height,u=o/c;e.aspect=u,e.updateProjectionMatrix(),s.left=-t*u,s.right=t*u,s.top=t,s.bottom=-t,s.zoom=t/c*5,s.updateProjectionMatrix()}),(r=n.orthograpbic.allowRotate)!=null,this.addEventListener("setViewpoint",i=>{const o=i.viewpoint;if(o===a.VIEWPOINT.DEFAULT){this.setCamera(e);return}o===a.VIEWPOINT.TOP?s.position.set(0,t/2,0):o===a.VIEWPOINT.BOTTOM?s.position.set(0,-t/2,0):o===a.VIEWPOINT.RIGHT?s.position.set(t/2,0,0):o===a.VIEWPOINT.LEFT?s.position.set(-t/2,0,0):o===a.VIEWPOINT.FRONT?s.position.set(0,0,t/2):o===a.VIEWPOINT.BACK&&s.position.set(0,0,-t/2),this.setCamera(s)}),this.completeSet.add(()=>{n.viewpoint===a.VIEWPOINT.DEFAULT?this.setCamera(e):this.setCamera(s),this.objectHelperManager&&this.objectHelperManager.addFilteredObject(e,s)}),!0},xs=function(n){return this.orbitControls?(console.warn("this has installed orbitControls plugin."),!1):this.renderManager?(this.orbitControls=new pn(this.camera,this.dom),this.addEventListener("setCamera",e=>{e.options.orbitControls&&this.orbitControls.setCamera(e.camera)}),this.addEventListener("setDom",e=>{this.orbitControls.setDom(e.dom)}),this.renderManager.addEventListener("render",()=>{this.orbitControls.update()}),this.completeSet.add(()=>{this.setViewpoint&&this.addEventListener("setViewpoint",e=>{const t=e.viewpoint;this.orbitControls.target.set(0,0,0),t===a.VIEWPOINT.DEFAULT?this.orbitControls.enableRotate=!0:t===a.VIEWPOINT.TOP?this.orbitControls.enableRotate=!1:t===a.VIEWPOINT.BOTTOM?this.orbitControls.enableRotate=!1:t===a.VIEWPOINT.RIGHT?this.orbitControls.enableRotate=!1:t===a.VIEWPOINT.LEFT?this.orbitControls.enableRotate=!1:t===a.VIEWPOINT.FRONT?this.orbitControls.enableRotate=!1:t===a.VIEWPOINT.BACK&&(this.orbitControls.enableRotate=!1)})}),!0):(console.warn("this must install renderManager before install orbitControls plugin."),!1)};class Us{constructor(e){h(this,"REVISION");h(this,"dom");h(this,"addPanel");h(this,"showPanel");h(this,"begin");h(this,"end");h(this,"update");h(this,"domElement");h(this,"setMode");const t=Gs.default();this.REVISION=t.REVISION,this.dom=t.dom,this.domElement=t.domElement,this.begin=t.begin.bind(t),this.end=t.end.bind(t),this.update=t.update.bind(t),this.addPanel=t.addPanel.bind(t),this.showPanel=t.showPanel.bind(t),this.setMode=t.setMode.bind(t);const s=this.domElement;s.style.position="absolute",s.style.top="0",s.style.left="35px",e&&(s.style.top=`${e.top}px`,s.style.left=`${e.left}px`,s.style.right=`${e.right}px`,s.style.bottom=`${e.bottom}px`)}}const Bs=function(n){if(this.stats)return console.warn("this has installed stats plugin."),!1;if(!this.renderManager)return console.warn("this must install renderManager before install stats plugin."),!1;const e=new Us(n);this.stats=e;const t=()=>{this.stats.update()};return this.setStats=function(s){if(s)this.dom.appendChild(this.stats.domElement),this.renderManager.addEventListener("render",t);else try{this.dom.removeChild(this.stats.domElement),this.renderManager.removeEventListener("render",t)}catch{}return this},!0};class js{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}new l.OrthographicCamera(-1,1,1,-1,0,1);const fn=new l.BufferGeometry;fn.setAttribute("position",new l.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),fn.setAttribute("uv",new l.Float32BufferAttribute([0,2,0,0,2,0],2));class Nt extends js{constructor(e,t,s,r,i){super();this.scene=e,this.camera=t,this.overrideMaterial=s,this.clearColor=r,this.clearAlpha=i!==void 0?i:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new l.Color}render(e,t,s){const r=e.autoClear;e.autoClear=!1;let i,o;this.overrideMaterial!==void 0&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),i=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:s),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,i),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=o),e.autoClear=r}}const Ys=function(n={}){if(this.effectComposer)return console.warn("this has installed effect composer plugin."),!1;if(!this.webGLRenderer)return console.error("must install some renderer before this plugin."),!1;let e;if(n.WebGLMultisampleRenderTarget||n.MSAA){const s=this.webGLRenderer,r=s.getPixelRatio(),i=s.getDrawingBufferSize(new l.Vector2);Number(window.__THREE__)>137?e=new It.EffectComposer(s,new l.WebGLRenderTarget(i.width*r,i.height*r,{format:n.format||l.RGBAFormat,samples:n.samples||4})):e=new It.EffectComposer(s,new l.WebGLMultisampleRenderTarget(i.width*r,i.height*r,{format:n.format||l.RGBAFormat}))}else e=new It.EffectComposer(this.webGLRenderer);this.effectComposer=e;let t;return this.scene&&this.camera&&(t=new Nt(this.scene,this.camera),e.addPass(t)),this.addEventListener("setCamera",s=>{if(!t&&this.scene){t=new Nt(this.scene,s.camera),e.addPass(t);return}else t&&(t.camera=s.camera)}),this.addEventListener("setScene",s=>{if(!t&&this.camera){t=new Nt(s.scene,this.camera),e.addPass(t);return}else t&&(t.scene=s.scene)}),this.addEventListener("setSize",s=>{e.setSize(s.width,s.height)}),this.renderManager?(this.renderManager.removeEventListener("render",this.render),this.renderManager.addEventListener("render",s=>{this.effectComposer.render(s.delta)})):this.render=function(){return this.effectComposer.render(),this},!0};class _s extends re{constructor(e){super();h(this,"dom");h(this,"mouse");h(this,"canMouseMove");h(this,"mouseEventTimer");h(this,"throttleTime");h(this,"pointerDownHandler");h(this,"pointerMoveHandler");h(this,"pointerUpHandler");h(this,"mouseDownHandler");h(this,"mouseUpHandler");h(this,"clickHandler");h(this,"dblclickHandler");h(this,"contextmenuHandler");this.dom=e.dom,this.mouse=new l.Vector2,this.canMouseMove=!0,this.mouseEventTimer=null,this.throttleTime=e.throttleTime||1e3/60;const t=r=>{const i={mouse:{x:this.mouse.x,y:this.mouse.y}};for(const o in r)i[o]=r[o];return i},s=r=>{this.dispatchEvent(t(r))};this.pointerMoveHandler=r=>{!this.canMouseMove||(this.canMouseMove=!1,this.mouseEventTimer=window.setTimeout(()=>{const i=this.mouse,o=this.dom,c=o.getBoundingClientRect();i.x=(r.clientX-c.left)/o.offsetWidth*2-1,i.y=-((r.clientY-c.top)/o.offsetHeight)*2+1,this.canMouseMove=!0,this.dispatchEvent(t(r))},this.throttleTime))},this.mouseDownHandler=s,this.mouseUpHandler=s,this.pointerDownHandler=s,this.pointerUpHandler=s,this.clickHandler=s,this.dblclickHandler=s,this.contextmenuHandler=s}setDom(e){if(this.dom){const t=this.dom;t.removeEventListener("mousedown",this.mouseDownHandler),t.removeEventListener("mouseup",this.mouseUpHandler),t.removeEventListener("pointerdown",this.pointerDownHandler),t.removeEventListener("pointermove",this.pointerMoveHandler),t.removeEventListener("pointerup",this.pointerUpHandler),t.removeEventListener("click",this.clickHandler),t.removeEventListener("dblclick",this.dblclickHandler),t.removeEventListener("contextmenu",this.contextmenuHandler)}return e.addEventListener("mousedown",this.mouseDownHandler),e.addEventListener("mouseup",this.mouseUpHandler),e.addEventListener("pointerdown",this.pointerDownHandler),e.addEventListener("pointermove",this.pointerMoveHandler),e.addEventListener("pointerup",this.pointerUpHandler),e.addEventListener("click",this.clickHandler),e.addEventListener("dblclick",this.dblclickHandler),e.addEventListener("contextmenu",this.contextmenuHandler),this.dom=e,this}getNormalMouse(){return this.mouse}}const Hs=function(n){if(this.pointerManager)return console.warn("this has installed pointerManager plugin."),!1;const e=new _s(Object.assign(n||{},{dom:this.dom}));return this.addEventListener("setDom",t=>{e.setDom(t.dom)}),this.pointerManager=e,!0};a.EVENTNAME=void 0,function(n){n.POINTERDOWN="pointerdown",n.POINTERUP="pointerup",n.POINTERMOVE="pointermove",n.POINTERENTER="pointerenter",n.POINTERLEAVE="pointerleave",n.CLICK="click",n.DBLCLICK="dblclick",n.CONTEXTMENU="contextmenu"}(a.EVENTNAME||(a.EVENTNAME={}));class ks extends re{constructor(e){super();h(this,"raycaster");h(this,"scene");h(this,"camera");h(this,"filter",new Set);h(this,"recursive",!1);h(this,"penetrate",!1);h(this,"propagation",!1);h(this,"delegation",!1);this.raycaster=new l.Raycaster,this.camera=e.camera,this.scene=e.scene,e.recursive&&(this.recursive=e.recursive),e.penetrate&&(this.penetrate=e.penetrate)}setScene(e){return this.scene=e,this}setCamera(e){return this.camera=e,this}addFilterObject(e){return this.filter.add(e),this}removeFilterObject(e){return this.filter.delete(e),this}intersectObject(e){this.raycaster.setFromCamera(e,this.camera);const t=this.filter,s=this.scene.children.filter(r=>!t.has(r));return this.raycaster.intersectObjects(s,this.recursive)}use(e){const t=function(c,u){return Object.assign({},c,u)},s=(c,u)=>{const d=this.intersectObject(c.mouse);if(d.length)if(this.penetrate)for(const p of d)p.object.dispatchEvent(t(c,{type:u,intersection:p}));else{const p=d[0];p.object.dispatchEvent(t(c,{type:u,intersection:p}))}this.dispatchEvent(t(c,{type:u,intersections:d}))},r=["pointerdown","pointerup","mousedown","mouseup","pointermove","click","dblclick","contextmenu"];for(const c of r)e.addEventListener(c,u=>{s(u,c)});const i=new Map;let o=null;return e.addEventListener("pointermove",c=>{const u=this.intersectObject(c.mouse);if(this.penetrate){if(!u.length){i.forEach(d=>{d.object.dispatchEvent(t(c,{type:"pointerleave",intersection:d})),d.object.dispatchEvent(t(c,{type:"mouseleave",intersection:d}))}),i.clear();return}for(const d of u)i.has(d.object)?(d.object.dispatchEvent(t(c,{type:"pointermove",intersection:d})),d.object.dispatchEvent(t(c,{type:"mousemove",intersection:d})),i.delete(d.object)):(d.object.dispatchEvent(t(c,{type:"pointerenter",intersection:d})),d.object.dispatchEvent(t(c,{type:"mouseenter",intersection:d})));for(const d of i.values())d.object.dispatchEvent(t(c,{type:"pointerleave",intersection:d})),d.object.dispatchEvent(t(c,{type:"mouseleave",intersection:d}));i.clear();for(const d of u)i.set(d.object,d)}else{if(!u.length){o&&(o.object.dispatchEvent(t(c,{type:"pointerleave",intersection:o})),o.object.dispatchEvent(t(c,{type:"mouseleave",intersection:o})),o=null);return}const d=u[0];if(!o){d.object.dispatchEvent(t(c,{type:"pointerenter",intersection:d})),d.object.dispatchEvent(t(c,{type:"mouseenter",intersection:d})),o=d;return}if(d.object!==o.object){o.object.dispatchEvent(t(c,{type:"pointerleave",intersection:d})),o.object.dispatchEvent(t(c,{type:"mouseleave",intersection:d})),d.object.dispatchEvent(t(c,{type:"pointerenter",intersection:d})),d.object.dispatchEvent(t(c,{type:"mouseenter",intersection:d})),o=d;return}d.object===o.object&&(d.object.dispatchEvent(t(c,{type:"pointermove",intersection:d})),d.object.dispatchEvent(t(c,{type:"mousemove",intersection:d})))}this.dispatchEvent(t(c,{type:"pointermove",intersections:u})),this.dispatchEvent(t(c,{type:"mousemove",intersections:u}))}),this}}const zs=function(n){if(this.eventManager)return console.warn("engine has installed eventManager plugin."),!1;if(!this.pointerManager)return console.error("must install pointerManager before this plugin."),!1;const e=new ks(Object.assign({scene:this.scene,camera:this.camera},n));return e.use(this.pointerManager),this.eventManager=e,this.addEventListener("setCamera",t=>{this.eventManager.setCamera(t.camera)}),this.addEventListener("setScene",t=>{this.eventManager.setScene(t.scene)}),!0};var lt;(function(n){n.OBJECTCHANGED="objectChanged"})(lt||(lt={}));class mn extends bs.TransformControls{constructor(e,t){!e&&(e=new l.PerspectiveCamera),!t&&(t=document.body);super(e,t);h(this,"target");h(this,"transObjectSet");this.domElement.removeEventListener("pointerdown",this._onPointerDown),this._onPointerDown=u=>{var d;!this.enabled||!((d=this.object)==null?void 0:d.parent)||(this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(u)),this.pointerDown(this._getPointer(u)))},this.domElement.addEventListener("pointerdown",this._onPointerDown),this.target=new l.Object3D,this.transObjectSet=new Set;let s="";const r=this.target,i=this.transObjectSet,o={x:0,y:0,z:0},c=new WeakMap;this.addEventListener("mouseDown",u=>{s=u.target.mode,s==="translate"&&(s="position"),s==="rotate"&&(s="rotation"),o.x=r[s].x,o.y=r[s].y,o.z=r[s].z,i.forEach(d=>{c.set(d,d.matrixAutoUpdate),d.matrixAutoUpdate=!1})}),this.addEventListener("objectChange",u=>{const d=r[s].x-o.x,p=r[s].y-o.y,f=r[s].z-o.z;o.x=r[s].x,o.y=r[s].y,o.z=r[s].z,i.forEach(g=>{g[s].x+=d,g[s].y+=p,g[s].z+=f,g.updateMatrix(),g.updateMatrixWorld()}),this.dispatchEvent({type:lt.OBJECTCHANGED,transObjectSet:i,mode:s,target:r})}),this.addEventListener("mouseUp",u=>{i.forEach(d=>{d.matrixAutoUpdate=c.get(d),c.delete(d)})})}setDom(e){return this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),e.addEventListener("pointerdown",this._onPointerDown),e.addEventListener("pointermove",this._onPointerHover),e.addEventListener("pointerup",this._onPointerUp),this.domElement=e,this}setCamera(e){return this.camera=e,this}getTarget(){return this.target}getTransObjectSet(){return this.transObjectSet}setAttach(...e){if(this.transObjectSet.clear(),!e.length||!e[0])return this.detach(),this;this.attach(this.target);const t=this.target;if(e.length===1){const o=e[0];return o.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.updateMatrix(),t.updateMatrixWorld(),this.transObjectSet.add(o),this}const s=[],r=[],i=[];return e.forEach(o=>{s.push(o.matrixWorld.elements[12]),r.push(o.matrixWorld.elements[13]),i.push(o.matrixWorld.elements[14])}),t.rotation.set(0,0,0),t.scale.set(0,0,0),t.position.x=(Math.max(...s)-Math.min(...s))/2+Math.min(...s),t.position.y=(Math.max(...r)-Math.min(...r))/2+Math.min(...r),t.position.z=(Math.max(...i)-Math.min(...i))/2+Math.min(...i),t.updateMatrix(),t.updateMatrixWorld(),e.forEach(o=>{this.transObjectSet.add(o)}),this}}const Vs=function(n){if(this.transformControls)return console.warn("this has installed transformControls plugin."),!1;if(!this.pointerManager)return console.warn("this must install pointerManager before install transformControls plugin."),!1;if(!this.eventManager)return console.warn("this must install eventManager before install transformControls plugin."),!1;const e=new mn(this.camera,this.dom);return e.detach(),this.transformControls=e,this.scene.add(this.transformControls),this.scene.add(this.transformControls.target),this.transformControls.addEventListener("mouseDown",()=>{this.transing=!0}),this.setTransformControls=function(t){return t?this.scene.add(this.transformControls):this.scene.remove(this.transformControls),this},this.addEventListener("setCamera",t=>{t.options.transformControls&&e.setCamera(t.camera)}),this.addEventListener("setDom",t=>{e.setDom(t.dom)}),this.addEventListener("setScene",t=>{const s=t.scene;s.add(this.transformControls.target),s.add(this.transformControls)}),this.selectionBox?this.addEventListener("selected",t=>{e.setAttach(...t.objects)}):this.eventManager.addEventListener("click",t=>{if(this.transing){this.transing=!1;return}if(t.button===0){const r=t.intersections.map(i=>i.object)[0]||null;r?e.setAttach(r):e.detach()}}),this.eventManager.addFilterObject(e),this.completeSet.add(()=>{if(this.IS_ENGINESUPPORT){const t=i=>{const o=this.compilerManager.getObjectSymbol(i);return o?this.dataSupportManager.getConfigBySymbol(o):null};let s=null,r;e.addEventListener(lt.OBJECTCHANGED,i=>{const o=i;o.transObjectSet.forEach(c=>{s=t(c),r=o.mode,s&&(s[r].x=c[r].x,s[r].y=c[r].y,s[r].z=c[r].z)})})}}),!0},Ws=function(n={}){if(this.webGLRenderer)return console.warn("this has installed webglRenderer plugin."),!1;this.webGLRenderer=new l.WebGLRenderer(n);const e=this.webGLRenderer.domElement;return e.style.position="absolute",e.style.top="0",e.style.left="0",e.classList.add("vis-webgl"),this.getScreenshot=async function(t={}){const s={width:this.dom.offsetWidth,height:this.dom.offsetHeight};!t.width&&(t.width=this.dom.offsetWidth),!t.height&&(t.height=this.dom.offsetHeight),!t.mine&&(t.mine="image/png");let r=!1;this.renderManager.hasRendering()&&(this.renderManager.stop(),r=!0);let i="";const o=this.webGLRenderer.getContext(),u=o.getParameter(o.MAX_RENDERBUFFER_SIZE)/4;if(t.width>u||t.height>u){const d=[],p=Math.ceil(t.width/u),f=Math.ceil(t.height/u),g=t.width/p,E=t.height/f,T=document.createElement("canvas");T.setAttribute("width",t.width.toString()),T.setAttribute("height",t.height.toString());const C=T.getContext("2d");if(!C)return console.warn("can not support canvas 2d;"),i;this.setSize(g,E);for(let y=0;y<p;y+=1)for(let O=0;O<f;O+=1)d.push({x:g*y,y:E*O});const M=[];d.forEach(y=>{this.camera.setViewOffset(t.width,t.height,y.x,y.y,g,E),this.renderManager.render();const O=this.webGLRenderer.domElement.toDataURL(t.mine);M.push(new Promise((b,R)=>{const G=new Image;G.src=O,G.onload=()=>{C.drawImage(G,y.x,y.y,g,E),b(null)}}))}),this.setSize(s.width,s.height),await Promise.all(M).catch(y=>{console.warn(y)}),i=T.toDataURL(t.mine),this.camera.clearViewOffset()}else this.setSize(t.width,t.height),this.renderManager.render(),i=this.webGLRenderer.domElement.toDataURL(t.mine),this.setSize(s.width,s.height);return r&&this.renderManager.play(),i},this.addEventListener("setDom",t=>{t.dom.appendChild(this.webGLRenderer.domElement)}),this.addEventListener("setSize",t=>{this.webGLRenderer.setSize(t.width,t.height,!0)}),this.addEventListener("dispose",()=>{this.webGLRenderer.dispose()}),this.renderManager?(this.renderManager.removeEventListener("render",this.render),this.renderManager.addEventListener("render",t=>{this.webGLRenderer.render(this.scene,this.camera)})):this.render=function(){return this.webGLRenderer.render(this.scene,this.camera),this},!0};class $s extends l.Loader{constructor(e){super(e)}load(e,t,s,r){const i=this,o=this.path===""?l.LoaderUtils.extractUrlBase(e):this.path,c=new l.FileLoader(this.manager);c.setPath(this.path),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(u){try{t(i.parse(u,o))}catch(d){r?r(d):console.error(d),i.manager.itemError(e)}},s,r)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,t){const s=e.split(`
`);let r={};const i=/\s+/,o={};for(let u=0;u<s.length;u++){let d=s[u];if(d=d.trim(),d.length===0||d.charAt(0)==="#")continue;const p=d.indexOf(" ");let f=p>=0?d.substring(0,p):d;f=f.toLowerCase();let g=p>=0?d.substring(p+1):"";if(g=g.trim(),f==="newmtl")r={name:g},o[g]=r;else if(f==="ka"||f==="kd"||f==="ks"||f==="ke"){const E=g.split(i,3);r[f]=[parseFloat(E[0]),parseFloat(E[1]),parseFloat(E[2])]}else r[f]=g}const c=new Ks(this.resourcePath||t,this.materialOptions);return c.setCrossOrigin(this.crossOrigin),c.setManager(this.manager),c.setMaterials(o),c}}class Ks{constructor(e="",t={}){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:l.FrontSide,this.wrap=this.options.wrap!==void 0?this.options.wrap:l.RepeatWrapping}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const t={};for(const s in e){const r=e[s],i={};t[s]=i;for(const o in r){let c=!0,u=r[o];const d=o.toLowerCase();switch(d){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(u=[u[0]/255,u[1]/255,u[2]/255]),this.options&&this.options.ignoreZeroRGBs&&u[0]===0&&u[1]===0&&u[2]===0&&(c=!1);break}c&&(i[d]=u)}}return t}preload(){for(const e in this.materialsInfo)this.create(e)}getIndex(e){return this.nameLookup[e]}getAsArray(){let e=0;for(const t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray}create(e){return this.materials[e]===void 0&&this.createMaterial_(e),this.materials[e]}createMaterial_(e){const t=this,s=this.materialsInfo[e],r={name:e,side:this.side};function i(c,u){return typeof u!="string"||u===""?"":/^https?:\/\//i.test(u)?u:c+u}function o(c,u){if(r[c])return;const d=t.getTextureParams(u,r),p=t.loadTexture(i(t.baseUrl,d.url));p.repeat.copy(d.scale),p.offset.copy(d.offset),p.wrapS=t.wrap,p.wrapT=t.wrap,(c==="map"||c==="emissiveMap")&&(p.encoding=l.sRGBEncoding),r[c]=p}for(const c in s){const u=s[c];let d;if(u!=="")switch(c.toLowerCase()){case"kd":r.color=new l.Color().fromArray(u).convertSRGBToLinear();break;case"ks":r.specular=new l.Color().fromArray(u).convertSRGBToLinear();break;case"ke":r.emissive=new l.Color().fromArray(u).convertSRGBToLinear();break;case"map_kd":o("map",u);break;case"map_ks":o("specularMap",u);break;case"map_ke":o("emissiveMap",u);break;case"norm":o("normalMap",u);break;case"map_bump":case"bump":o("bumpMap",u);break;case"map_d":o("alphaMap",u),r.transparent=!0;break;case"ns":r.shininess=parseFloat(u);break;case"d":d=parseFloat(u),d<1&&(r.opacity=d,r.transparent=!0);break;case"tr":d=parseFloat(u),this.options&&this.options.invertTrProperty&&(d=1-d),d>0&&(r.opacity=1-d,r.transparent=!0);break}}return this.materials[e]=new l.MeshPhongMaterial(r),this.materials[e]}getTextureParams(e,t){const s={scale:new l.Vector2(1,1),offset:new l.Vector2(0,0)},r=e.split(/\s+/);let i;return i=r.indexOf("-bm"),i>=0&&(t.bumpScale=parseFloat(r[i+1]),r.splice(i,2)),i=r.indexOf("-s"),i>=0&&(s.scale.set(parseFloat(r[i+1]),parseFloat(r[i+2])),r.splice(i,4)),i=r.indexOf("-o"),i>=0&&(s.offset.set(parseFloat(r[i+1]),parseFloat(r[i+2])),r.splice(i,4)),s.url=r.join(" ").trim(),s}loadTexture(e,t,s,r,i){const o=this.manager!==void 0?this.manager:l.DefaultLoadingManager;let c=o.getHandler(e);c===null&&(c=new l.TextureLoader(o)),c.setCrossOrigin&&c.setCrossOrigin(this.crossOrigin);const u=c.load(e,s,r,i);return t!==void 0&&(u.mapping=t),u}}const Je=class extends l.Loader{constructor(e){super(e)}load(e,t,s,r){this.path!==void 0&&(e=this.path+e),this.manager.itemStart(e),e=this.manager.resolveURL(e);const i=l.Cache.get(e);if(i!==void 0)return setTimeout(()=>{t&&t(i),this.manager.itemEnd(e)},0),i;const o=document.createElement("video");return o.preload=Je.preload,o.autoplay=Je.autoplay,o.loop=Je.loop,o.muted=Je.muted,o.src=e,o.style.position="fixed",o.style.top="0",o.style.left="0",o.style.zIndex="-1",document.body.appendChild(o),o.oncanplay=()=>{l.Cache.add(e,o),this.manager.itemEnd(e),t&&t(o)},o.onerror=c=>{this.manager.itemEnd(e),r&&r(c)},o}};let Fe=Je;h(Fe,"autoplay",!0),h(Fe,"preload","auto"),h(Fe,"muted",!0),h(Fe,"loop",!0);class Xs extends l.Loader{constructor(e){super(e);this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new er(t)}),this.register(function(t){return new ar(t)}),this.register(function(t){return new cr(t)}),this.register(function(t){return new nr(t)}),this.register(function(t){return new sr(t)}),this.register(function(t){return new rr(t)}),this.register(function(t){return new ir(t)}),this.register(function(t){return new Zs(t)}),this.register(function(t){return new or(t)}),this.register(function(t){return new tr(t)}),this.register(function(t){return new qs(t)}),this.register(function(t){return new lr(t)})}load(e,t,s,r){const i=this;let o;this.resourcePath!==""?o=this.resourcePath:this.path!==""?o=this.path:o=l.LoaderUtils.extractUrlBase(e),this.manager.itemStart(e);const c=function(d){r?r(d):console.error(d),i.manager.itemError(e),i.manager.itemEnd(e)},u=new l.FileLoader(this.manager);u.setPath(this.path),u.setResponseType("arraybuffer"),u.setRequestHeader(this.requestHeader),u.setWithCredentials(this.withCredentials),u.load(e,function(d){try{i.parse(d,o,function(p){t(p),i.manager.itemEnd(e)},c)}catch(p){c(p)}},s,c)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,s,r){let i;const o={},c={};if(typeof e=="string")i=e;else if(l.LoaderUtils.decodeText(new Uint8Array(e,0,4))===gn){try{o[v.KHR_BINARY_GLTF]=new ur(e)}catch(f){r&&r(f);return}i=o[v.KHR_BINARY_GLTF].content}else i=l.LoaderUtils.decodeText(new Uint8Array(e));const u=JSON.parse(i);if(u.asset===void 0||u.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const d=new Or(u,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});d.fileLoader.setRequestHeader(this.requestHeader);for(let p=0;p<this.pluginCallbacks.length;p++){const f=this.pluginCallbacks[p](d);c[f.name]=f,o[f.name]=!0}if(u.extensionsUsed)for(let p=0;p<u.extensionsUsed.length;++p){const f=u.extensionsUsed[p],g=u.extensionsRequired||[];switch(f){case v.KHR_MATERIALS_UNLIT:o[f]=new Js;break;case v.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[f]=new pr;break;case v.KHR_DRACO_MESH_COMPRESSION:o[f]=new dr(u,this.dracoLoader);break;case v.KHR_TEXTURE_TRANSFORM:o[f]=new hr;break;case v.KHR_MESH_QUANTIZATION:o[f]=new fr;break;default:g.indexOf(f)>=0&&c[f]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+f+'".')}}d.setExtensions(o),d.setPlugins(c),d.parse(s,r)}parseAsync(e,t){const s=this;return new Promise(function(r,i){s.parse(e,t,r,i)})}}function Qs(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}const v={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class qs{constructor(e){this.parser=e,this.name=v.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let s=0,r=t.length;s<r;s++){const i=t[s];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const t=this.parser,s="light:"+e;let r=t.cache.get(s);if(r)return r;const i=t.json,u=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e];let d;const p=new l.Color(16777215);u.color!==void 0&&p.fromArray(u.color);const f=u.range!==void 0?u.range:0;switch(u.type){case"directional":d=new l.DirectionalLight(p),d.target.position.set(0,0,-1),d.add(d.target);break;case"point":d=new l.PointLight(p),d.distance=f;break;case"spot":d=new l.SpotLight(p),d.distance=f,u.spot=u.spot||{},u.spot.innerConeAngle=u.spot.innerConeAngle!==void 0?u.spot.innerConeAngle:0,u.spot.outerConeAngle=u.spot.outerConeAngle!==void 0?u.spot.outerConeAngle:Math.PI/4,d.angle=u.spot.outerConeAngle,d.penumbra=1-u.spot.innerConeAngle/u.spot.outerConeAngle,d.target.position.set(0,0,-1),d.add(d.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+u.type)}return d.position.set(0,0,0),d.decay=2,u.intensity!==void 0&&(d.intensity=u.intensity),d.name=t.createUniqueName(u.name||"light_"+e),r=Promise.resolve(d),t.cache.add(s,r),r}createNodeAttachment(e){const t=this,s=this.parser,i=s.json.nodes[e],c=(i.extensions&&i.extensions[this.name]||{}).light;return c===void 0?null:this._loadLight(c).then(function(u){return s._getNodeRef(t.cache,c,u)})}}class Js{constructor(){this.name=v.KHR_MATERIALS_UNLIT}getMaterialType(){return l.MeshBasicMaterial}extendParams(e,t,s){const r=[];e.color=new l.Color(1,1,1),e.opacity=1;const i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const o=i.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}i.baseColorTexture!==void 0&&r.push(s.assignTexture(e,"map",i.baseColorTexture,l.sRGBEncoding))}return Promise.all(r)}}class Zs{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=r.extensions[this.name].emissiveStrength;return i!==void 0&&(t.emissiveIntensity=i),Promise.resolve()}}class er{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const s=this.parser,r=s.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],o=r.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&i.push(s.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&i.push(s.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(i.push(s.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const c=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new l.Vector2(c,c)}return Promise.all(i)}}class tr{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const s=this.parser,r=s.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],o=r.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&i.push(s.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&i.push(s.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(i)}}class nr{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_SHEEN}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const s=this.parser,r=s.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[];t.sheenColor=new l.Color(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=r.extensions[this.name];return o.sheenColorFactor!==void 0&&t.sheenColor.fromArray(o.sheenColorFactor),o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&i.push(s.assignTexture(t,"sheenColorMap",o.sheenColorTexture,l.sRGBEncoding)),o.sheenRoughnessTexture!==void 0&&i.push(s.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(i)}}class sr{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const s=this.parser,r=s.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],o=r.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&i.push(s.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(i)}}class rr{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_VOLUME}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const s=this.parser,r=s.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],o=r.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&i.push(s.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||0;const c=o.attenuationColor||[1,1,1];return t.attenuationColor=new l.Color(c[0],c[1],c[2]),Promise.all(i)}}class ir{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_IOR}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=r.extensions[this.name];return t.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}}class or{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_SPECULAR}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const s=this.parser,r=s.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],o=r.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&i.push(s.assignTexture(t,"specularIntensityMap",o.specularTexture));const c=o.specularColorFactor||[1,1,1];return t.specularColor=new l.Color(c[0],c[1],c[2]),o.specularColorTexture!==void 0&&i.push(s.assignTexture(t,"specularColorMap",o.specularColorTexture,l.sRGBEncoding)),Promise.all(i)}}class ar{constructor(e){this.parser=e,this.name=v.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,s=t.json,r=s.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const i=r.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,i.source,o)}}class cr{constructor(e){this.parser=e,this.name=v.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,r=s.json,i=r.textures[e];if(!i.extensions||!i.extensions[t])return null;const o=i.extensions[t],c=r.images[o.source];let u=s.textureLoader;if(c.uri){const d=s.options.manager.getHandler(c.uri);d!==null&&(u=d)}return this.detectSupport().then(function(d){if(d)return s.loadTextureImage(e,o.source,u);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class lr{constructor(e){this.name=v.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,s=t.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const r=s.extensions[this.name],i=this.parser.getDependency("buffer",r.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([i,o.ready]).then(function(c){const u=r.byteOffset||0,d=r.byteLength||0,p=r.count,f=r.byteStride,g=new ArrayBuffer(p*f),E=new Uint8Array(c[0],u,d);return o.decodeGltfBuffer(new Uint8Array(g),p,f,E,r.mode,r.filter),g})}else return null}}const gn="glTF",Ze=12,En={JSON:1313821514,BIN:5130562};class ur{constructor(e){this.name=v.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,Ze);if(this.header={magic:l.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==gn)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-Ze,r=new DataView(e,Ze);let i=0;for(;i<s;){const o=r.getUint32(i,!0);i+=4;const c=r.getUint32(i,!0);if(i+=4,c===En.JSON){const u=new Uint8Array(e,Ze+i,o);this.content=l.LoaderUtils.decodeText(u)}else if(c===En.BIN){const u=Ze+i;this.body=e.slice(u,u+o)}i+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class dr{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=v.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const s=this.json,r=this.dracoLoader,i=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,c={},u={},d={};for(const p in o){const f=Ft[p]||p.toLowerCase();c[f]=o[p]}for(const p in e.attributes){const f=Ft[p]||p.toLowerCase();if(o[p]!==void 0){const g=s.accessors[e.attributes[p]],E=et[g.componentType];d[f]=E,u[f]=g.normalized===!0}}return t.getDependency("bufferView",i).then(function(p){return new Promise(function(f){r.decodeDracoFile(p,function(g){for(const E in g.attributes){const T=g.attributes[E],C=u[E];C!==void 0&&(T.normalized=C)}f(g)},c,d)})})}}class hr{constructor(){this.name=v.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return t.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Gt extends l.MeshStandardMaterial{constructor(e){super();this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),s=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),r=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),i=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),c={specular:{value:new l.Color().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=c,this.onBeforeCompile=function(u){for(const d in c)u.uniforms[d]=c[d];u.fragmentShader=u.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",s).replace("#include <roughnessmap_fragment>",r).replace("#include <metalnessmap_fragment>",i).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return c.specular.value},set:function(u){c.specular.value=u}},specularMap:{get:function(){return c.specularMap.value},set:function(u){c.specularMap.value=u,u?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return c.glossiness.value},set:function(u){c.glossiness.value=u}},glossinessMap:{get:function(){return c.glossinessMap.value},set:function(u){c.glossinessMap.value=u,u?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class pr{constructor(){this.name=v.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return Gt}extendParams(e,t,s){const r=t.extensions[this.name];e.color=new l.Color(1,1,1),e.opacity=1;const i=[];if(Array.isArray(r.diffuseFactor)){const o=r.diffuseFactor;e.color.fromArray(o),e.opacity=o[3]}if(r.diffuseTexture!==void 0&&i.push(s.assignTexture(e,"map",r.diffuseTexture,l.sRGBEncoding)),e.emissive=new l.Color(0,0,0),e.glossiness=r.glossinessFactor!==void 0?r.glossinessFactor:1,e.specular=new l.Color(1,1,1),Array.isArray(r.specularFactor)&&e.specular.fromArray(r.specularFactor),r.specularGlossinessTexture!==void 0){const o=r.specularGlossinessTexture;i.push(s.assignTexture(e,"glossinessMap",o)),i.push(s.assignTexture(e,"specularMap",o,l.sRGBEncoding))}return Promise.all(i)}createMaterial(e){const t=new Gt(e);return t.fog=!0,t.color=e.color,t.map=e.map===void 0?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=e.aoMap===void 0?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=e.emissiveIntensity===void 0?1:e.emissiveIntensity,t.emissiveMap=e.emissiveMap===void 0?null:e.emissiveMap,t.bumpMap=e.bumpMap===void 0?null:e.bumpMap,t.bumpScale=1,t.normalMap=e.normalMap===void 0?null:e.normalMap,t.normalMapType=l.TangentSpaceNormalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=e.specularMap===void 0?null:e.specularMap,t.specular=e.specular,t.glossinessMap=e.glossinessMap===void 0?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=e.envMap===void 0?null:e.envMap,t.envMapIntensity=1,t}}class fr{constructor(){this.name=v.KHR_MESH_QUANTIZATION}}class Dt extends l.Interpolant{constructor(e,t,s,r){super(e,t,s,r)}copySampleValue_(e){const t=this.resultBuffer,s=this.sampleValues,r=this.valueSize,i=e*r*3+r;for(let o=0;o!==r;o++)t[o]=s[i+o];return t}}Dt.prototype.interpolate_=function(n,e,t,s){const r=this.resultBuffer,i=this.sampleValues,o=this.valueSize,c=o*2,u=o*3,d=s-e,p=(t-e)/d,f=p*p,g=f*p,E=n*u,T=E-u,C=-2*g+3*f,M=g-f,y=1-C,O=M-f+p;for(let b=0;b!==o;b++){const R=i[T+b+o],G=i[T+b+c]*d,S=i[E+b+o],N=i[E+b]*d;r[b]=y*R+O*G+C*S+M*N}return r};const mr=new l.Quaternion;class gr extends Dt{interpolate_(e,t,s,r){const i=super.interpolate_(e,t,s,r);return mr.fromArray(i).normalize().toArray(i),i}}const me={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},et={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Tn={9728:l.NearestFilter,9729:l.LinearFilter,9984:l.NearestMipmapNearestFilter,9985:l.LinearMipmapNearestFilter,9986:l.NearestMipmapLinearFilter,9987:l.LinearMipmapLinearFilter},yn={33071:l.ClampToEdgeWrapping,33648:l.MirroredRepeatWrapping,10497:l.RepeatWrapping},Mn={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ft={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},be={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Er={CUBICSPLINE:void 0,LINEAR:l.InterpolateLinear,STEP:l.InterpolateDiscrete},xt={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Tr(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new l.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:l.FrontSide})),n.DefaultMaterial}function tt(n,e,t){for(const s in t.extensions)n[s]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[s]=t.extensions[s])}function xe(n,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function yr(n,e,t){let s=!1,r=!1,i=!1;for(let d=0,p=e.length;d<p;d++){const f=e[d];if(f.POSITION!==void 0&&(s=!0),f.NORMAL!==void 0&&(r=!0),f.COLOR_0!==void 0&&(i=!0),s&&r&&i)break}if(!s&&!r&&!i)return Promise.resolve(n);const o=[],c=[],u=[];for(let d=0,p=e.length;d<p;d++){const f=e[d];if(s){const g=f.POSITION!==void 0?t.getDependency("accessor",f.POSITION):n.attributes.position;o.push(g)}if(r){const g=f.NORMAL!==void 0?t.getDependency("accessor",f.NORMAL):n.attributes.normal;c.push(g)}if(i){const g=f.COLOR_0!==void 0?t.getDependency("accessor",f.COLOR_0):n.attributes.color;u.push(g)}}return Promise.all([Promise.all(o),Promise.all(c),Promise.all(u)]).then(function(d){const p=d[0],f=d[1],g=d[2];return s&&(n.morphAttributes.position=p),r&&(n.morphAttributes.normal=f),i&&(n.morphAttributes.color=g),n.morphTargetsRelative=!0,n})}function Mr(n,e){if(n.updateMorphTargets(),e.weights!==void 0)for(let t=0,s=e.weights.length;t<s;t++)n.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(n.morphTargetInfluences.length===t.length){n.morphTargetDictionary={};for(let s=0,r=t.length;s<r;s++)n.morphTargetDictionary[t[s]]=s}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Sr(n){const e=n.extensions&&n.extensions[v.KHR_DRACO_MESH_COMPRESSION];let t;return e?t="draco:"+e.bufferView+":"+e.indices+":"+Sn(e.attributes):t=n.indices+":"+Sn(n.attributes)+":"+n.mode,t}function Sn(n){let e="";const t=Object.keys(n).sort();for(let s=0,r=t.length;s<r;s++)e+=t[s]+":"+n[t[s]]+";";return e}function Ut(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Cr(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}class Or{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Qs,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const s=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,r=navigator.userAgent.indexOf("Firefox")>-1,i=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;typeof createImageBitmap=="undefined"||s||r&&i<98?this.textureLoader=new l.TextureLoader(this.options.manager):this.textureLoader=new l.ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new l.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const s=this,r=this.json,i=this.extensions;this.cache.removeAll(),this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])}).then(function(o){const c={scene:o[0][r.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:r.asset,parser:s,userData:{}};tt(i,c,r),xe(c,r),Promise.all(s._invokeAll(function(u){return u.afterRoot&&u.afterRoot(c)})).then(function(){e(c)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],s=this.json.meshes||[];for(let r=0,i=t.length;r<i;r++){const o=t[r].joints;for(let c=0,u=o.length;c<u;c++)e[o[c]].isBone=!0}for(let r=0,i=e.length;r<i;r++){const o=e[r];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(s[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,s){if(e.refs[t]<=1)return s;const r=s.clone(),i=(o,c)=>{const u=this.associations.get(o);u!=null&&this.associations.set(c,u);for(const[d,p]of o.children.entries())i(p,c.children[d])};return i(s,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let s=0;s<t.length;s++){const r=e(t[s]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const s=[];for(let r=0;r<t.length;r++){const i=e(t[r]);i&&s.push(i)}return s}getDependency(e,t){const s=e+":"+t;let r=this.cache.get(s);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this._invokeOne(function(i){return i.loadMesh&&i.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(i){return i.loadBufferView&&i.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(i){return i.loadMaterial&&i.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(i){return i.loadTexture&&i.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(i){return i.loadAnimation&&i.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(s,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const s=this,r=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(r.map(function(i,o){return s.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],s=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[v.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(i,o){s.load(l.LoaderUtils.resolveURL(t.uri,r.path),i,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(s){const r=t.byteLength||0,i=t.byteOffset||0;return s.slice(i,i+r)})}loadAccessor(e){const t=this,s=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0)return Promise.resolve(null);const i=[];return r.bufferView!==void 0?i.push(this.getDependency("bufferView",r.bufferView)):i.push(null),r.sparse!==void 0&&(i.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(i).then(function(o){const c=o[0],u=Mn[r.type],d=et[r.componentType],p=d.BYTES_PER_ELEMENT,f=p*u,g=r.byteOffset||0,E=r.bufferView!==void 0?s.bufferViews[r.bufferView].byteStride:void 0,T=r.normalized===!0;let C,M;if(E&&E!==f){const y=Math.floor(g/E),O="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+y+":"+r.count;let b=t.cache.get(O);b||(C=new d(c,y*E,r.count*E/p),b=new l.InterleavedBuffer(C,E/p),t.cache.add(O,b)),M=new l.InterleavedBufferAttribute(b,u,g%E/p,T)}else c===null?C=new d(r.count*u):C=new d(c,g,r.count*u),M=new l.BufferAttribute(C,u,T);if(r.sparse!==void 0){const y=Mn.SCALAR,O=et[r.sparse.indices.componentType],b=r.sparse.indices.byteOffset||0,R=r.sparse.values.byteOffset||0,G=new O(o[1],b,r.sparse.count*y),S=new d(o[2],R,r.sparse.count*u);c!==null&&(M=new l.BufferAttribute(M.array.slice(),M.itemSize,M.normalized));for(let N=0,I=G.length;N<I;N++){const P=G[N];if(M.setX(P,S[N*u]),u>=2&&M.setY(P,S[N*u+1]),u>=3&&M.setZ(P,S[N*u+2]),u>=4&&M.setW(P,S[N*u+3]),u>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return M})}loadTexture(e){const t=this.json,s=this.options,i=t.textures[e].source,o=t.images[i];let c=this.textureLoader;if(o.uri){const u=s.manager.getHandler(o.uri);u!==null&&(c=u)}return this.loadTextureImage(e,i,c)}loadTextureImage(e,t,s){const r=this,i=this.json,o=i.textures[e],c=i.images[t],u=(c.uri||c.bufferView)+":"+o.sampler;if(this.textureCache[u])return this.textureCache[u];const d=this.loadImageSource(t,s).then(function(p){p.flipY=!1,o.name&&(p.name=o.name);const g=(i.samplers||{})[o.sampler]||{};return p.magFilter=Tn[g.magFilter]||l.LinearFilter,p.minFilter=Tn[g.minFilter]||l.LinearMipmapLinearFilter,p.wrapS=yn[g.wrapS]||l.RepeatWrapping,p.wrapT=yn[g.wrapT]||l.RepeatWrapping,r.associations.set(p,{textures:e}),p}).catch(function(){return null});return this.textureCache[u]=d,d}loadImageSource(e,t){const s=this,r=this.json,i=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(f=>f.clone());const o=r.images[e],c=self.URL||self.webkitURL;let u=o.uri||"",d=!1;if(o.bufferView!==void 0)u=s.getDependency("bufferView",o.bufferView).then(function(f){d=!0;const g=new Blob([f],{type:o.mimeType});return u=c.createObjectURL(g),u});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const p=Promise.resolve(u).then(function(f){return new Promise(function(g,E){let T=g;t.isImageBitmapLoader===!0&&(T=function(C){const M=new l.Texture(C);M.needsUpdate=!0,g(M)}),t.load(l.LoaderUtils.resolveURL(f,i.path),T,void 0,E)})}).then(function(f){return d===!0&&c.revokeObjectURL(u),f.userData.mimeType=o.mimeType||Cr(o.uri),f}).catch(function(f){throw console.error("THREE.GLTFLoader: Couldn't load texture",u),f});return this.sourceCache[e]=p,p}assignTexture(e,t,s,r){const i=this;return this.getDependency("texture",s.index).then(function(o){if(s.texCoord!==void 0&&s.texCoord!=0&&!(t==="aoMap"&&s.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+s.texCoord+" for texture "+t+" not yet supported."),i.extensions[v.KHR_TEXTURE_TRANSFORM]){const c=s.extensions!==void 0?s.extensions[v.KHR_TEXTURE_TRANSFORM]:void 0;if(c){const u=i.associations.get(o);o=i.extensions[v.KHR_TEXTURE_TRANSFORM].extendTexture(o,c),i.associations.set(o,u)}}return r!==void 0&&(o.encoding=r),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let s=e.material;const r=t.attributes.tangent===void 0,i=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const c="PointsMaterial:"+s.uuid;let u=this.cache.get(c);u||(u=new l.PointsMaterial,l.Material.prototype.copy.call(u,s),u.color.copy(s.color),u.map=s.map,u.sizeAttenuation=!1,this.cache.add(c,u)),s=u}else if(e.isLine){const c="LineBasicMaterial:"+s.uuid;let u=this.cache.get(c);u||(u=new l.LineBasicMaterial,l.Material.prototype.copy.call(u,s),u.color.copy(s.color),this.cache.add(c,u)),s=u}if(r||i||o){let c="ClonedMaterial:"+s.uuid+":";s.isGLTFSpecularGlossinessMaterial&&(c+="specular-glossiness:"),r&&(c+="derivative-tangents:"),i&&(c+="vertex-colors:"),o&&(c+="flat-shading:");let u=this.cache.get(c);u||(u=s.clone(),i&&(u.vertexColors=!0),o&&(u.flatShading=!0),r&&(u.normalScale&&(u.normalScale.y*=-1),u.clearcoatNormalScale&&(u.clearcoatNormalScale.y*=-1)),this.cache.add(c,u),this.associations.set(u,this.associations.get(s))),s=u}s.aoMap&&t.attributes.uv2===void 0&&t.attributes.uv!==void 0&&t.setAttribute("uv2",t.attributes.uv),e.material=s}getMaterialType(){return l.MeshStandardMaterial}loadMaterial(e){const t=this,s=this.json,r=this.extensions,i=s.materials[e];let o;const c={},u=i.extensions||{},d=[];if(u[v.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const f=r[v.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];o=f.getMaterialType(),d.push(f.extendParams(c,i,t))}else if(u[v.KHR_MATERIALS_UNLIT]){const f=r[v.KHR_MATERIALS_UNLIT];o=f.getMaterialType(),d.push(f.extendParams(c,i,t))}else{const f=i.pbrMetallicRoughness||{};if(c.color=new l.Color(1,1,1),c.opacity=1,Array.isArray(f.baseColorFactor)){const g=f.baseColorFactor;c.color.fromArray(g),c.opacity=g[3]}f.baseColorTexture!==void 0&&d.push(t.assignTexture(c,"map",f.baseColorTexture,l.sRGBEncoding)),c.metalness=f.metallicFactor!==void 0?f.metallicFactor:1,c.roughness=f.roughnessFactor!==void 0?f.roughnessFactor:1,f.metallicRoughnessTexture!==void 0&&(d.push(t.assignTexture(c,"metalnessMap",f.metallicRoughnessTexture)),d.push(t.assignTexture(c,"roughnessMap",f.metallicRoughnessTexture))),o=this._invokeOne(function(g){return g.getMaterialType&&g.getMaterialType(e)}),d.push(Promise.all(this._invokeAll(function(g){return g.extendMaterialParams&&g.extendMaterialParams(e,c)})))}i.doubleSided===!0&&(c.side=l.DoubleSide);const p=i.alphaMode||xt.OPAQUE;if(p===xt.BLEND?(c.transparent=!0,c.depthWrite=!1):(c.transparent=!1,p===xt.MASK&&(c.alphaTest=i.alphaCutoff!==void 0?i.alphaCutoff:.5)),i.normalTexture!==void 0&&o!==l.MeshBasicMaterial&&(d.push(t.assignTexture(c,"normalMap",i.normalTexture)),c.normalScale=new l.Vector2(1,1),i.normalTexture.scale!==void 0)){const f=i.normalTexture.scale;c.normalScale.set(f,f)}return i.occlusionTexture!==void 0&&o!==l.MeshBasicMaterial&&(d.push(t.assignTexture(c,"aoMap",i.occlusionTexture)),i.occlusionTexture.strength!==void 0&&(c.aoMapIntensity=i.occlusionTexture.strength)),i.emissiveFactor!==void 0&&o!==l.MeshBasicMaterial&&(c.emissive=new l.Color().fromArray(i.emissiveFactor)),i.emissiveTexture!==void 0&&o!==l.MeshBasicMaterial&&d.push(t.assignTexture(c,"emissiveMap",i.emissiveTexture,l.sRGBEncoding)),Promise.all(d).then(function(){let f;return o===Gt?f=r[v.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(c):f=new o(c),i.name&&(f.name=i.name),xe(f,i),t.associations.set(f,{materials:e}),i.extensions&&tt(r,f,i),f})}createUniqueName(e){const t=l.PropertyBinding.sanitizeNodeName(e||"");let s=t;for(let r=1;this.nodeNamesUsed[s];++r)s=t+"_"+r;return this.nodeNamesUsed[s]=!0,s}loadGeometries(e){const t=this,s=this.extensions,r=this.primitiveCache;function i(c){return s[v.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(c,t).then(function(u){return On(u,c,t)})}const o=[];for(let c=0,u=e.length;c<u;c++){const d=e[c],p=Sr(d),f=r[p];if(f)o.push(f.promise);else{let g;d.extensions&&d.extensions[v.KHR_DRACO_MESH_COMPRESSION]?g=i(d):g=On(new l.BufferGeometry,d,t),r[p]={primitive:d,promise:g},o.push(g)}}return Promise.all(o)}loadMesh(e){const t=this,s=this.json,r=this.extensions,i=s.meshes[e],o=i.primitives,c=[];for(let u=0,d=o.length;u<d;u++){const p=o[u].material===void 0?Tr(this.cache):this.getDependency("material",o[u].material);c.push(p)}return c.push(t.loadGeometries(o)),Promise.all(c).then(function(u){const d=u.slice(0,u.length-1),p=u[u.length-1],f=[];for(let E=0,T=p.length;E<T;E++){const C=p[E],M=o[E];let y;const O=d[E];if(M.mode===me.TRIANGLES||M.mode===me.TRIANGLE_STRIP||M.mode===me.TRIANGLE_FAN||M.mode===void 0)y=i.isSkinnedMesh===!0?new l.SkinnedMesh(C,O):new l.Mesh(C,O),y.isSkinnedMesh===!0&&!y.geometry.attributes.skinWeight.normalized&&y.normalizeSkinWeights(),M.mode===me.TRIANGLE_STRIP?y.geometry=bn(y.geometry,l.TriangleStripDrawMode):M.mode===me.TRIANGLE_FAN&&(y.geometry=bn(y.geometry,l.TriangleFanDrawMode));else if(M.mode===me.LINES)y=new l.LineSegments(C,O);else if(M.mode===me.LINE_STRIP)y=new l.Line(C,O);else if(M.mode===me.LINE_LOOP)y=new l.LineLoop(C,O);else if(M.mode===me.POINTS)y=new l.Points(C,O);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+M.mode);Object.keys(y.geometry.morphAttributes).length>0&&Mr(y,i),y.name=t.createUniqueName(i.name||"mesh_"+e),xe(y,i),M.extensions&&tt(r,y,M),t.assignFinalMaterial(y),f.push(y)}for(let E=0,T=f.length;E<T;E++)t.associations.set(f[E],{meshes:e,primitives:E});if(f.length===1)return f[0];const g=new l.Group;t.associations.set(g,{meshes:e});for(let E=0,T=f.length;E<T;E++)g.add(f[E]);return g})}loadCamera(e){let t;const s=this.json.cameras[e],r=s[s.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return s.type==="perspective"?t=new l.PerspectiveCamera(l.MathUtils.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):s.type==="orthographic"&&(t=new l.OrthographicCamera(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),s.name&&(t.name=this.createUniqueName(s.name)),xe(t,s),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],s={joints:t.joints};return t.inverseBindMatrices===void 0?Promise.resolve(s):this.getDependency("accessor",t.inverseBindMatrices).then(function(r){return s.inverseBindMatrices=r,s})}loadAnimation(e){const s=this.json.animations[e],r=[],i=[],o=[],c=[],u=[];for(let d=0,p=s.channels.length;d<p;d++){const f=s.channels[d],g=s.samplers[f.sampler],E=f.target,T=E.node!==void 0?E.node:E.id,C=s.parameters!==void 0?s.parameters[g.input]:g.input,M=s.parameters!==void 0?s.parameters[g.output]:g.output;r.push(this.getDependency("node",T)),i.push(this.getDependency("accessor",C)),o.push(this.getDependency("accessor",M)),c.push(g),u.push(E)}return Promise.all([Promise.all(r),Promise.all(i),Promise.all(o),Promise.all(c),Promise.all(u)]).then(function(d){const p=d[0],f=d[1],g=d[2],E=d[3],T=d[4],C=[];for(let y=0,O=p.length;y<O;y++){const b=p[y],R=f[y],G=g[y],S=E[y],N=T[y];if(b===void 0)continue;b.updateMatrix(),b.matrixAutoUpdate=!0;let I;switch(be[N.path]){case be.weights:I=l.NumberKeyframeTrack;break;case be.rotation:I=l.QuaternionKeyframeTrack;break;case be.position:case be.scale:default:I=l.VectorKeyframeTrack;break}const P=b.name?b.name:b.uuid,he=S.interpolation!==void 0?Er[S.interpolation]:l.InterpolateLinear,pe=[];be[N.path]===be.weights?b.traverse(function(z){z.morphTargetInfluences&&pe.push(z.name?z.name:z.uuid)}):pe.push(P);let Q=G.array;if(G.normalized){const z=Ut(Q.constructor),fe=new Float32Array(Q.length);for(let ne=0,Pt=Q.length;ne<Pt;ne++)fe[ne]=Q[ne]*z;Q=fe}for(let z=0,fe=pe.length;z<fe;z++){const ne=new I(pe[z]+"."+be[N.path],R.array,Q,he);S.interpolation==="CUBICSPLINE"&&(ne.createInterpolant=function(At){const on=this instanceof l.QuaternionKeyframeTrack?gr:Dt;return new on(this.times,this.values,this.getValueSize()/3,At)},ne.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),C.push(ne)}}const M=s.name?s.name:"animation_"+e;return new l.AnimationClip(M,void 0,C)})}createNodeMesh(e){const t=this.json,s=this,r=t.nodes[e];return r.mesh===void 0?null:s.getDependency("mesh",r.mesh).then(function(i){const o=s._getNodeRef(s.meshCache,r.mesh,i);return r.weights!==void 0&&o.traverse(function(c){if(!!c.isMesh)for(let u=0,d=r.weights.length;u<d;u++)c.morphTargetInfluences[u]=r.weights[u]}),o})}loadNode(e){const t=this.json,s=this.extensions,r=this,i=t.nodes[e],o=i.name?r.createUniqueName(i.name):"";return function(){const c=[],u=r._invokeOne(function(d){return d.createNodeMesh&&d.createNodeMesh(e)});return u&&c.push(u),i.camera!==void 0&&c.push(r.getDependency("camera",i.camera).then(function(d){return r._getNodeRef(r.cameraCache,i.camera,d)})),r._invokeAll(function(d){return d.createNodeAttachment&&d.createNodeAttachment(e)}).forEach(function(d){c.push(d)}),Promise.all(c)}().then(function(c){let u;if(i.isBone===!0?u=new l.Bone:c.length>1?u=new l.Group:c.length===1?u=c[0]:u=new l.Object3D,u!==c[0])for(let d=0,p=c.length;d<p;d++)u.add(c[d]);if(i.name&&(u.userData.name=i.name,u.name=o),xe(u,i),i.extensions&&tt(s,u,i),i.matrix!==void 0){const d=new l.Matrix4;d.fromArray(i.matrix),u.applyMatrix4(d)}else i.translation!==void 0&&u.position.fromArray(i.translation),i.rotation!==void 0&&u.quaternion.fromArray(i.rotation),i.scale!==void 0&&u.scale.fromArray(i.scale);return r.associations.has(u)||r.associations.set(u,{}),r.associations.get(u).nodes=e,u})}loadScene(e){const t=this.json,s=this.extensions,r=this.json.scenes[e],i=this,o=new l.Group;r.name&&(o.name=i.createUniqueName(r.name)),xe(o,r),r.extensions&&tt(s,o,r);const c=r.nodes||[],u=[];for(let d=0,p=c.length;d<p;d++)u.push(Cn(c[d],o,t,i));return Promise.all(u).then(function(){const d=p=>{const f=new Map;for(const[g,E]of i.associations)(g instanceof l.Material||g instanceof l.Texture)&&f.set(g,E);return p.traverse(g=>{const E=i.associations.get(g);E!=null&&f.set(g,E)}),f};return i.associations=d(o),o})}}function Cn(n,e,t,s){const r=t.nodes[n];return s.getDependency("node",n).then(function(i){if(r.skin===void 0)return i;let o;return s.getDependency("skin",r.skin).then(function(c){o=c;const u=[];for(let d=0,p=o.joints.length;d<p;d++)u.push(s.getDependency("node",o.joints[d]));return Promise.all(u)}).then(function(c){return i.traverse(function(u){if(!u.isMesh)return;const d=[],p=[];for(let f=0,g=c.length;f<g;f++){const E=c[f];if(E){d.push(E);const T=new l.Matrix4;o.inverseBindMatrices!==void 0&&T.fromArray(o.inverseBindMatrices.array,f*16),p.push(T)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',o.joints[f])}u.bind(new l.Skeleton(d,p),u.matrixWorld)}),i})}).then(function(i){e.add(i);const o=[];if(r.children){const c=r.children;for(let u=0,d=c.length;u<d;u++){const p=c[u];o.push(Cn(p,i,t,s))}}return Promise.all(o)})}function br(n,e,t){const s=e.attributes,r=new l.Box3;if(s.POSITION!==void 0){const c=t.json.accessors[s.POSITION],u=c.min,d=c.max;if(u!==void 0&&d!==void 0){if(r.set(new l.Vector3(u[0],u[1],u[2]),new l.Vector3(d[0],d[1],d[2])),c.normalized){const p=Ut(et[c.componentType]);r.min.multiplyScalar(p),r.max.multiplyScalar(p)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const i=e.targets;if(i!==void 0){const c=new l.Vector3,u=new l.Vector3;for(let d=0,p=i.length;d<p;d++){const f=i[d];if(f.POSITION!==void 0){const g=t.json.accessors[f.POSITION],E=g.min,T=g.max;if(E!==void 0&&T!==void 0){if(u.setX(Math.max(Math.abs(E[0]),Math.abs(T[0]))),u.setY(Math.max(Math.abs(E[1]),Math.abs(T[1]))),u.setZ(Math.max(Math.abs(E[2]),Math.abs(T[2]))),g.normalized){const C=Ut(et[g.componentType]);u.multiplyScalar(C)}c.max(u)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(c)}n.boundingBox=r;const o=new l.Sphere;r.getCenter(o.center),o.radius=r.min.distanceTo(r.max)/2,n.boundingSphere=o}function On(n,e,t){const s=e.attributes,r=[];function i(o,c){return t.getDependency("accessor",o).then(function(u){n.setAttribute(c,u)})}for(const o in s){const c=Ft[o]||o.toLowerCase();c in n.attributes||r.push(i(s[o],c))}if(e.indices!==void 0&&!n.index){const o=t.getDependency("accessor",e.indices).then(function(c){n.setIndex(c)});r.push(o)}return xe(n,e),br(n,e,t),Promise.all(r).then(function(){return e.targets!==void 0?yr(n,e.targets,t):n})}function bn(n,e){let t=n.getIndex();if(t===null){const o=[],c=n.getAttribute("position");if(c!==void 0){for(let u=0;u<c.count;u++)o.push(u);n.setIndex(o),t=n.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const s=t.count-2,r=[];if(e===l.TriangleFanDrawMode)for(let o=1;o<=s;o++)r.push(t.getX(0)),r.push(t.getX(o)),r.push(t.getX(o+1));else for(let o=0;o<s;o++)o%2==0?(r.push(t.getX(o)),r.push(t.getX(o+1)),r.push(t.getX(o+2))):(r.push(t.getX(o+2)),r.push(t.getX(o+1)),r.push(t.getX(o)));r.length/3!==s&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const i=n.clone();return i.setIndex(r),i}class Rr{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const s=this.workersResolve[e];if(s&&s(t),this.queue.length){const{resolve:r,msg:i,transfer:o}=this.queue.shift();this.workersResolve[e]=r,this.workers[e].postMessage(i,o)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(s=>{const r=this._getIdleWorker();r!==-1?(this._initWorker(r),this.workerStatus|=1<<r,this.workersResolve[r]=s,this.workers[r].postMessage(e,t)):this.queue.push({resolve:s,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const Lr=2,wr=1,Bt=new WeakMap;let jt=0;class ae extends l.Loader{constructor(e){super(e);this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new Rr,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER!="undefined"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){const e=new l.FileLoader(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),s=new l.FileLoader(this.manager);s.setPath(this.transcoderPath),s.setResponseType("arraybuffer"),s.setWithCredentials(this.withCredentials);const r=s.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,r]).then(([i,o])=>{const c=ae.BasisWorker.toString(),u=["/* constants */","let _EngineFormat = "+JSON.stringify(ae.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(ae.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(ae.BasisFormat),"/* basis_transcoder.js */",i,"/* worker */",c.substring(c.indexOf("{")+1,c.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([u])),this.transcoderBinary=o,this.workerPool.setWorkerCreator(()=>{const d=new Worker(this.workerSourceURL),p=this.transcoderBinary.slice(0);return d.postMessage({type:"init",config:this.workerConfig,transcoderBinary:p},[p]),d})}),jt>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),jt++}return this.transcoderPending}load(e,t,s,r){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const i=new l.FileLoader(this.manager);i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials);const o=new l.CompressedTexture;return i.load(e,c=>{if(Bt.has(c))return Bt.get(c).promise.then(t).catch(r);this._createTexture([c]).then(function(u){o.copy(u),o.needsUpdate=!0,t&&t(o)}).catch(r)},s,r),o}_createTextureFrom(e){const{mipmaps:t,width:s,height:r,format:i,type:o,error:c,dfdTransferFn:u,dfdFlags:d}=e;if(o==="error")return Promise.reject(c);const p=new l.CompressedTexture(t,s,r,i,l.UnsignedByteType);return p.minFilter=t.length===1?l.LinearFilter:l.LinearMipmapLinearFilter,p.magFilter=l.LinearFilter,p.generateMipmaps=!1,p.needsUpdate=!0,p.encoding=u===Lr?l.sRGBEncoding:l.LinearEncoding,p.premultiplyAlpha=!!(d&wr),p}_createTexture(e,t={}){const s=t,r=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffers:e,taskConfig:s},e)).then(i=>this._createTextureFrom(i.data));return Bt.set(e[0],{promise:r}),r}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),jt--,this}}ae.BasisFormat={ETC1S:0,UASTC_4x4:1},ae.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},ae.EngineFormat={RGBAFormat:l.RGBAFormat,RGBA_ASTC_4x4_Format:l.RGBA_ASTC_4x4_Format,RGBA_BPTC_Format:l.RGBA_BPTC_Format,RGBA_ETC2_EAC_Format:l.RGBA_ETC2_EAC_Format,RGBA_PVRTC_4BPPV1_Format:l.RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT5_Format:l.RGBA_S3TC_DXT5_Format,RGB_ETC1_Format:l.RGB_ETC1_Format,RGB_ETC2_Format:l.RGB_ETC2_Format,RGB_PVRTC_4BPPV1_Format:l.RGB_PVRTC_4BPPV1_Format,RGB_S3TC_DXT1_Format:l.RGB_S3TC_DXT1_Format},ae.BasisWorker=function(){let n,e,t;const s=_EngineFormat,r=_TranscoderFormat,i=_BasisFormat;self.addEventListener("message",function(E){const T=E.data;switch(T.type){case"init":n=T.config,o(T.transcoderBinary);break;case"transcode":e.then(()=>{try{const{width:C,height:M,hasAlpha:y,mipmaps:O,format:b,dfdTransferFn:R,dfdFlags:G}=c(T.buffers[0]),S=[];for(let N=0;N<O.length;++N)S.push(O[N].data.buffer);self.postMessage({type:"transcode",id:T.id,width:C,height:M,hasAlpha:y,mipmaps:O,format:b,dfdTransferFn:R,dfdFlags:G},S)}catch(C){console.error(C),self.postMessage({type:"error",id:T.id,error:C.message})}});break}});function o(E){e=new Promise(T=>{t={wasmBinary:E,onRuntimeInitialized:T},BASIS(t)}).then(()=>{t.initializeBasis(),t.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function c(E){const T=new t.KTX2File(new Uint8Array(E));function C(){T.close(),T.delete()}if(!T.isValid())throw C(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const M=T.isUASTC()?i.UASTC_4x4:i.ETC1S,y=T.getWidth(),O=T.getHeight(),b=T.getLevels(),R=T.getHasAlpha(),G=T.getDFDTransferFunc(),S=T.getDFDFlags(),{transcoderFormat:N,engineFormat:I}=f(M,y,O,R);if(!y||!O||!b)throw C(),new Error("THREE.KTX2Loader:	Invalid texture");if(!T.startTranscoding())throw C(),new Error("THREE.KTX2Loader: .startTranscoding failed");const P=[];for(let he=0;he<b;he++){const pe=T.getImageLevelInfo(he,0,0),Q=pe.origWidth,z=pe.origHeight,fe=new Uint8Array(T.getImageTranscodedSizeInBytes(he,0,0,N));if(!T.transcodeImage(fe,he,0,0,N,0,-1,-1))throw C(),new Error("THREE.KTX2Loader: .transcodeImage failed.");P.push({data:fe,width:Q,height:z})}return C(),{width:y,height:O,hasAlpha:R,mipmaps:P,format:I,dfdTransferFn:G,dfdFlags:S}}const u=[{if:"astcSupported",basisFormat:[i.UASTC_4x4],transcoderFormat:[r.ASTC_4x4,r.ASTC_4x4],engineFormat:[s.RGBA_ASTC_4x4_Format,s.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[r.BC7_M5,r.BC7_M5],engineFormat:[s.RGBA_BPTC_Format,s.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[r.BC1,r.BC3],engineFormat:[s.RGB_S3TC_DXT1_Format,s.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[r.ETC1,r.ETC2],engineFormat:[s.RGB_ETC2_Format,s.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[r.ETC1],engineFormat:[s.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[r.PVRTC1_4_RGB,r.PVRTC1_4_RGBA],engineFormat:[s.RGB_PVRTC_4BPPV1_Format,s.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],d=u.sort(function(E,T){return E.priorityETC1S-T.priorityETC1S}),p=u.sort(function(E,T){return E.priorityUASTC-T.priorityUASTC});function f(E,T,C,M){let y,O;const b=E===i.ETC1S?d:p;for(let R=0;R<b.length;R++){const G=b[R];if(!!n[G.if]&&!!G.basisFormat.includes(E)&&!(M&&G.transcoderFormat.length<2)&&!(G.needsPowerOfTwo&&!(g(T)&&g(C))))return y=G.transcoderFormat[M?1:0],O=G.engineFormat[M?1:0],{transcoderFormat:y,engineFormat:O}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),y=r.RGBA32,O=s.RGBAFormat,{transcoderFormat:y,engineFormat:O}}function g(E){return E<=2?!0:(E&E-1)==0&&E!==0}};var $;(function(n){n.BEFORELOAD="beforeLoad",n.LOADING="loading",n.DETAILLOADING="detailLoading",n.DETAILLOADED="detailLoaded",n.LOADED="loaded"})($||($={}));class Rn extends re{constructor(e){super();h(this,"resourceMap");h(this,"loaderMap");h(this,"loadTotal");h(this,"loadSuccess");h(this,"loadError");h(this,"isError");h(this,"isLoading");h(this,"isLoaded");h(this,"loadDetailMap");h(this,"path","");this.resourceMap=new Map,this.loadTotal=0,this.loadSuccess=0,this.loadError=0,this.isError=!1,this.isLoading=!1,this.isLoaded=!1,this.loadDetailMap={};const t=new l.ImageLoader,s=new Fe,r=new Xs;r.setDRACOLoader(new ws.DRACOLoader),r.setKTX2Loader(new ae),r.setMeshoptDecoder(Ps.MeshoptDecoder),this.loaderMap={jpg:t,png:t,jpeg:t,obj:new Rs.OBJLoader,mtl:new $s,mp4:s,webm:s,ogg:s,hdr:new Ls.RGBELoader,gltf:r,glb:r},e&&(this.loaderMap=Object.assign(this.loaderMap,e.loaderExtends))}loaded(){return this.dispatchEvent({type:$.LOADED,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError,resourceMap:this.resourceMap}),this}checkLoaded(){return this.loadTotal===this.loadSuccess+this.loadError&&(this.isError=!0,this.isLoaded=!0,this.isLoading=!1,this.loaded()),this}setPath(e){return this.path=e,this}getLoader(e){return this.loaderMap[e]?this.loaderMap[e]:null}load(e){var i;if(this.reset(),this.isLoading=!0,this.dispatchEvent({type:$.BEFORELOAD,urlList:[...e]}),e.length<=0)return this.checkLoaded(),console.warn("url list is empty."),this;this.loadTotal+=e.length;const t=this.resourceMap,s=this.loaderMap,r=this.loadDetailMap;for(const o of e){let c,u;typeof o=="string"?(c=o,u=((i=c.split(".").pop())==null?void 0:i.toLocaleLowerCase())||""):(c=o.url,u=o.ext.toLocaleLowerCase());const d={url:c,progress:0,error:!1,message:c};if(r[c]=d,t.has(c)){d.progress=1,this.loadSuccess+=1,this.dispatchEvent({type:$.DETAILLOADED,detail:d}),this.dispatchEvent({type:$.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded();continue}if(!u){d.message=`url: ${c} \u5730\u5740\u6709\u8BEF\uFF0C\u65E0\u6CD5\u83B7\u53D6\u6587\u4EF6\u683C\u5F0F\u3002`,console.warn(d.message),d.error=!0,this.isError=!0,this.loadError+=1,this.dispatchEvent({type:$.DETAILLOADED,detail:d}),this.dispatchEvent({type:$.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError});continue}const p=s[u];if(!p){d.message=`url: ${c} \u4E0D\u652F\u6301\u6B64\u6587\u4EF6\u683C\u5F0F\u52A0\u8F7D\u3002`,console.warn(d.message),d.error=!0,this.isError=!0,this.loadError+=1,this.dispatchEvent({type:$.DETAILLOADED,detail:d}),this.dispatchEvent({type:$.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError});continue}const f=c.replace(/\\/g,"/").split("/"),g=f.pop(),E=this.path+f.join("/")+"/";p.setPath(E).loadAsync(g,T=>{d.progress=Number((T.loaded/T.total).toFixed(2)),this.dispatchEvent({type:$.DETAILLOADING,detail:d})}).then(T=>{d.progress=1,this.loadSuccess+=1,this.resourceMap.set(c,T),this.dispatchEvent({type:$.DETAILLOADED,detail:d}),this.dispatchEvent({type:$.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded()}).catch(T=>{d.error=!0,d.message=JSON.stringify(T),this.loadError+=1,this.dispatchEvent({type:$.DETAILLOADED,detail:d}),this.dispatchEvent({type:$.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded()})}return this}reset(){return this.loadTotal=0,this.loadSuccess=0,this.loadError=0,this.isError=!1,this.isLoading=!1,this.isLoaded=!1,this.loadDetailMap={},this}register(e,t){return this.loaderMap[e]=t,this}hasLoaded(e){return this.resourceMap.has(e)}getResource(e){return this.resourceMap.get(e)}getLoadDetailMap(){return this.loadDetailMap}setLoadDetailMap(e){return this.loadDetailMap=e,this}remove(e){}toJSON(){const e=[];return this.resourceMap.forEach((t,s)=>{e.push(s)}),JSON.stringify(e)}exportConfig(){const e=[];return this.resourceMap.forEach((t,s)=>{e.push(s)}),e}dispose(){return this.resourceMap.clear(),this}}const Pr=function(n){if(this.loaderManager)return console.warn("engine has installed loaderManager plugin."),!1;const e=new Rn(n);return this.loaderManager=e,this.loadResources=(t,s)=>{if(this.resourceManager){const r=i=>{s(void 0,i),this.resourceManager.removeEventListener("mapped",r)};try{this.resourceManager.addEventListener("mapped",r)}catch(i){s(i)}}else{const r=i=>{s(void 0,i),this.loaderManager.removeEventListener("loaded",r)};try{this.loaderManager.addEventListener("loaded",r)}catch(i){s(i)}}return this.loaderManager.load(t),this},this.loadResourcesAsync=t=>new Promise((s,r)=>{if(this.resourceManager){const i=o=>{s(o),this.resourceManager.removeEventListener("mapped",i)};try{this.resourceManager.addEventListener("mapped",i)}catch(o){r(o)}}else{const i=o=>{s(o),this.loaderManager.removeEventListener("loaded",i)};try{this.loaderManager.addEventListener("loaded",i)}catch(o){r(o)}}this.loaderManager.load(t)}),!0};a.CONFIGTYPE=void 0,function(n){n.BOXGEOMETRY="BoxGeometry",n.SPHEREGEOMETRY="SphereGeometry",n.LOADGEOMETRY="LoadGeometry",n.PLANEGEOMETRY="PlaneGeometry",n.CIRCLEGEOMETRY="CircleGeometry",n.CONEGEOMETRY="ConeGeometry",n.CYLINDERGEOMETRY="CylinderGeometry",n.DODECAHEDRONGEOMETRY="DodecahedronGeometry",n.TORUSGEOMETRY="TorusGeometry",n.RINGGEOMETRY="RingGeometry",n.EDGESGEOMETRY="EdgesGeometry",n.LINECURVEGEOMETRY="LineCurveGeometry",n.SPLINECURVEGEOMETRY="SplineCurveGeometry",n.CUBICBEZIERCURVEGEOMETRY="CubicBezierCurveGeometry",n.QUADRATICBEZIERCURVEGEOMETRY="QuadraticBezierCurveGeometry",n.CUSTOMGEOMETRY="CustomGeometry",n.LINETUBEGEOMETRY="LineTubeGeometry",n.SPLINETUBEGEOMETRY="SplineTubeGeometry",n.LINESHAPEGEOMETRY="LineShapeGeometry",n.OBJECT3D="Object3D",n.MESH="Mesh",n.LINE="Line",n.POINTS="Points",n.SPRITE="Sprite",n.GROUP="Group",n.CSS3DOBJECT="CSS3DObject",n.CSS3DSPRITE="CSS3DSprite",n.CSS3DPLANE="CSS3DPlane",n.IMAGETEXTURE="ImageTexture",n.CUBETEXTURE="CubeTexture",n.CANVASTEXTURE="CanvasTexture",n.VIDEOTEXTURE="VideoTexture",n.LOADTEXTURE="LoadTexture",n.MESHBASICMATERIAL="MeshBasicMaterial",n.MESHSTANDARDMATERIAL="MeshStandardMaterial",n.MESHPHONGMATERIAL="MeshPhongMaterial",n.SPRITEMATERIAL="SpriteMaterial",n.LINEBASICMATERIAL="LineBasicMaterial",n.POINTSMATERIAL="PointsMaterial",n.SHADERMATERIAL="ShaderMaterial",n.MESHPHYSICALMATERIAL="MeshPhysicalMaterial",n.AMBIENTLIGHT="AmbientLight",n.SPOTLIGHT="SpotLight",n.POINTLIGHT="PointLight",n.DIRECTIONALLIGHT="DirectionalLight",n.HEMISPHERELIGHT="HemisphereLight",n.PERSPECTIVECAMERA="PerspectiveCamera",n.ORTHOGRAPHICCAMERA="OrthographicCamera",n.WEBGLRENDERER="WebGLRenderer",n.CSS3DRENDERER="CSS3DRenderer",n.SCENE="Scene",n.TRNASFORMCONTROLS="TransformControls",n.ORBITCONTROLS="OrbitControls",n.SMAAPASS="SMAAPass",n.UNREALBLOOMPASS="UnrealBloomPass",n.SELECTIVEBLOOMPASS="SelectiveBloomPass",n.SCRIPTANIMATION="ScriptAnimation",n.KEYFRAMEANIMATION="KeyframeAnimation"}(a.CONFIGTYPE||(a.CONFIGTYPE={})),a.MODULETYPE=void 0,function(n){n.OBJECT3D="Object3D",n.CAMERA="camera",n.LIGHT="light",n.GEOMETRY="geometry",n.TEXTURE="texture",n.MATERIAL="material",n.RENDERER="renderer",n.SCENE="scene",n.SPRITE="sprite",n.CONTROLS="controls",n.LINE="line",n.MESH="mesh",n.POINTS="points",n.GROUP="group",n.CSS3D="css3D",n.PASS="pass",n.ANIMATION="animation"}(a.MODULETYPE||(a.MODULETYPE={})),a.OBJECTMODULE=void 0,function(n){n[n.CAMERA=a.MODULETYPE.CAMERA]="CAMERA",n[n.LIGHT=a.MODULETYPE.LIGHT]="LIGHT",n[n.SCENE=a.MODULETYPE.SCENE]="SCENE",n[n.SPRITE=a.MODULETYPE.SPRITE]="SPRITE",n[n.LINE=a.MODULETYPE.LINE]="LINE",n[n.MESH=a.MODULETYPE.MESH]="MESH",n[n.POINTS=a.MODULETYPE.POINTS]="POINTS",n[n.GROUP=a.MODULETYPE.GROUP]="GROUP",n[n.CSS3D=a.MODULETYPE.CSS3D]="CSS3D",n[n.OBJECT3D=a.MODULETYPE.OBJECT3D]="OBJECT3D"}(a.OBJECTMODULE||(a.OBJECTMODULE={}));const Ar={[a.CONFIGTYPE.IMAGETEXTURE]:a.MODULETYPE.TEXTURE,[a.CONFIGTYPE.CUBETEXTURE]:a.MODULETYPE.TEXTURE,[a.CONFIGTYPE.CANVASTEXTURE]:a.MODULETYPE.TEXTURE,[a.CONFIGTYPE.VIDEOTEXTURE]:a.MODULETYPE.TEXTURE,[a.CONFIGTYPE.MESHBASICMATERIAL]:a.MODULETYPE.MATERIAL,[a.CONFIGTYPE.MESHSTANDARDMATERIAL]:a.MODULETYPE.MATERIAL,[a.CONFIGTYPE.MESHPHONGMATERIAL]:a.MODULETYPE.MATERIAL,[a.CONFIGTYPE.SPRITEMATERIAL]:a.MODULETYPE.MATERIAL,[a.CONFIGTYPE.LINEBASICMATERIAL]:a.MODULETYPE.MATERIAL,[a.CONFIGTYPE.POINTSMATERIAL]:a.MODULETYPE.MATERIAL,[a.CONFIGTYPE.SHADERMATERIAL]:a.MODULETYPE.MATERIAL,[a.CONFIGTYPE.AMBIENTLIGHT]:a.MODULETYPE.LIGHT,[a.CONFIGTYPE.SPOTLIGHT]:a.MODULETYPE.LIGHT,[a.CONFIGTYPE.POINTLIGHT]:a.MODULETYPE.LIGHT,[a.CONFIGTYPE.DIRECTIONALLIGHT]:a.MODULETYPE.LIGHT,[a.CONFIGTYPE.BOXGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.SPHEREGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.LOADGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.CUSTOMGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.PLANEGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.CIRCLEGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.CONEGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.CIRCLEGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.EDGESGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.CYLINDERGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.LINECURVEGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.SPLINECURVEGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.CUBICBEZIERCURVEGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.QUADRATICBEZIERCURVEGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.LINETUBEGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.SPLINETUBEGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.TORUSGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.RINGGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.LINESHAPEGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.SPRITE]:a.MODULETYPE.SPRITE,[a.CONFIGTYPE.LINE]:a.MODULETYPE.LINE,[a.CONFIGTYPE.MESH]:a.MODULETYPE.MESH,[a.CONFIGTYPE.POINTS]:a.MODULETYPE.POINTS,[a.CONFIGTYPE.GROUP]:a.MODULETYPE.GROUP,[a.CONFIGTYPE.CSS3DOBJECT]:a.MODULETYPE.CSS3D,[a.CONFIGTYPE.CSS3DSPRITE]:a.MODULETYPE.CSS3D,[a.CONFIGTYPE.CSS3DPLANE]:a.MODULETYPE.CSS3D,[a.CONFIGTYPE.PERSPECTIVECAMERA]:a.MODULETYPE.CAMERA,[a.CONFIGTYPE.ORTHOGRAPHICCAMERA]:a.MODULETYPE.CAMERA,[a.CONFIGTYPE.WEBGLRENDERER]:a.MODULETYPE.RENDERER,[a.CONFIGTYPE.SCENE]:a.MODULETYPE.SCENE,[a.CONFIGTYPE.TRNASFORMCONTROLS]:a.MODULETYPE.CONTROLS,[a.CONFIGTYPE.ORBITCONTROLS]:a.MODULETYPE.CONTROLS,[a.CONFIGTYPE.SMAAPASS]:a.MODULETYPE.PASS,[a.CONFIGTYPE.UNREALBLOOMPASS]:a.MODULETYPE.PASS,[a.CONFIGTYPE.SCRIPTANIMATION]:a.MODULETYPE.ANIMATION,[a.CONFIGTYPE.KEYFRAMEANIMATION]:a.MODULETYPE.ANIMATION},ke=n=>{const e=t=>n.toLocaleLowerCase().includes(t.toLocaleLowerCase());for(const t of Object.values(a.MODULETYPE))if(e(t))return t;return null},ge=()=>({vid:"",name:"",type:a.CONFIGTYPE.OBJECT3D,castShadow:!0,receiveShadow:!0,lookAt:"",visible:!0,matrixAutoUpdate:!0,renderOrder:0,position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},up:{x:0,y:1,z:0},parent:"",children:[],pointerdown:[],pointermove:[],pointerup:[],pointerenter:[],pointerleave:[],click:[],dblclick:[],contextmenu:[]}),ut=function(){return Object.assign(ge(),{type:"Light",color:"rgb(255, 255, 255)",intensity:1})},Ir=function(){return Object.assign(ge(),{type:a.CONFIGTYPE.AMBIENTLIGHT,color:"rgb(255, 255, 255)",intensity:1})},vr=function(){return Object.assign(ut(),{type:a.CONFIGTYPE.POINTLIGHT,distance:30,decay:.01})},Nr=function(){return Object.assign(ut(),{type:a.CONFIGTYPE.SPOTLIGHT,distance:30,angle:Math.PI/180*45,penumbra:.01,decay:.01})},Gr=function(){return Object.assign(ut(),{type:a.CONFIGTYPE.DIRECTIONALLIGHT,shadow:{mapSize:{width:512,height:512},camera:{near:.5,far:500}}})},Dr=function(){return Object.assign(ut(),{type:a.CONFIGTYPE.HEMISPHERELIGHT,color:"rgb(255, 255, 255)",groundColor:"rgb(0, 0, 0)"})},K=function(){return{vid:"",type:"Geometry",position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},groups:[]}},Fr=function(){return Object.assign(K(),{type:a.CONFIGTYPE.BOXGEOMETRY,width:5,height:5,depth:5,widthSegments:1,heightSegments:1,depthSegments:1})},xr=function(){return Object.assign(K(),{type:a.CONFIGTYPE.SPHEREGEOMETRY,radius:3,widthSegments:32,heightSegments:32,phiStart:0,phiLength:Math.PI*2,thetaStart:0,thetaLength:Math.PI})},Ur=function(){return Object.assign(K(),{type:a.CONFIGTYPE.PLANEGEOMETRY,width:5,height:5,widthSegments:1,heightSegments:1})},Br=function(){return Object.assign(K(),{type:a.CONFIGTYPE.CIRCLEGEOMETRY,radius:3,segments:8,thetaStart:0,thetaLength:Math.PI*2})},jr=function(){return Object.assign(K(),{type:a.CONFIGTYPE.CONEGEOMETRY,radius:3,height:5,radialSegments:8,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:Math.PI*2})},Yr=function(){return Object.assign(K(),{type:a.CONFIGTYPE.TORUSGEOMETRY,radius:3,tube:.4,radialSegments:8,tubularSegments:6,arc:Math.PI*2})},_r=function(){return Object.assign(K(),{type:a.CONFIGTYPE.RINGGEOMETRY,innerRadius:2,outerRadius:3,thetaSegments:8,phiSegments:8,thetaStart:0,thetaLength:Math.PI*2})},Hr=function(){return Object.assign(K(),{type:a.CONFIGTYPE.LOADGEOMETRY,url:""})},kr=function(){return Object.assign(K(),{type:a.CONFIGTYPE.CUSTOMGEOMETRY,attribute:{position:[],color:[],index:[],normal:[],uv:[],uv2:[]}})},zr=function(){return Object.assign(K(),{type:a.CONFIGTYPE.CYLINDERGEOMETRY,radiusTop:3,radiusBottom:3,height:5,radialSegments:8,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:Math.PI*2})},Vr=function(){return Object.assign(K(),{type:"",radius:3,detail:0})},Wr=function(){return Object.assign(K(),{type:a.CONFIGTYPE.LOADGEOMETRY,url:"",thresholdAngle:1})},dt=function(){return Object.assign(K(),{path:[],divisions:36,space:!0})},$r=function(){return Object.assign(dt(),{type:a.CONFIGTYPE.LINECURVEGEOMETRY})},Kr=function(){return Object.assign(dt(),{type:a.CONFIGTYPE.SPLINECURVEGEOMETRY})},Xr=function(){return Object.assign(dt(),{type:a.CONFIGTYPE.CUBICBEZIERCURVEGEOMETRY})},Qr=function(){return Object.assign(dt(),{type:a.CONFIGTYPE.QUADRATICBEZIERCURVEGEOMETRY})},Ln=function(){return Object.assign(K(),{type:"TubeGeometry",path:[],tubularSegments:64,radius:1,radialSegments:8,closed:!1})},qr=function(){return Object.assign(Ln(),{type:a.CONFIGTYPE.LINETUBEGEOMETRY})},Jr=function(){return Object.assign(Ln(),{type:a.CONFIGTYPE.SPLINETUBEGEOMETRY})},Zr=function(){return Object.assign(K(),{path:[],curveSegments:12})},ei=function(){return Object.assign(Zr(),{type:a.CONFIGTYPE.LINESHAPEGEOMETRY})},nt=function(){return{vid:"",type:"Texture",name:"",mapping:l.UVMapping,wrapS:l.ClampToEdgeWrapping,wrapT:l.ClampToEdgeWrapping,magFilter:l.LinearFilter,minFilter:l.LinearMipmapLinearFilter,anisotropy:1,format:l.RGBAFormat,flipY:!0,offset:{x:0,y:0},repeat:{x:1,y:1},rotation:0,center:{x:0,y:0},matrixAutoUpdate:!0,encoding:l.LinearEncoding,needsUpdate:!1}},ti=function(){return Object.assign(nt(),{type:a.CONFIGTYPE.IMAGETEXTURE,url:""})},ni=function(){return Object.assign(nt(),{type:a.CONFIGTYPE.VIDEOTEXTURE,url:"",minFilter:l.LinearFilter})},si=function(){return Object.assign(nt(),{type:a.CONFIGTYPE.CUBETEXTURE,cube:{nx:"",ny:"",nz:"",px:"",py:"",pz:""},mapping:l.CubeReflectionMapping,flipY:!1})},ri=function(){return Object.assign(nt(),{type:a.CONFIGTYPE.CANVASTEXTURE,url:"",needsUpdate:!1})},ii=function(){return Object.assign(nt(),{type:a.CONFIGTYPE.LOADTEXTURE,url:""})},Ue=function(){return{vid:"",type:"Material",alphaTest:0,colorWrite:!0,depthTest:!0,depthWrite:!0,fog:!0,name:"",needsUpdate:!1,opacity:1,dithering:!1,shadowSide:null,side:l.FrontSide,toneMapped:!0,transparent:!1,visible:!0,blendDst:l.OneMinusSrcAlphaFactor,blendDstAlpha:null,blendEquation:l.AddEquation,blendEquationAlpha:null,blending:l.NormalBlending,blendSrc:l.SrcAlphaFactor,blendSrcAlpha:null,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0}},oi=function(){return Object.assign(Ue(),{type:a.CONFIGTYPE.MESHBASICMATERIAL,color:"rgb(255, 255, 255)",combine:l.MultiplyOperation,aoMapIntensity:1,fog:!0,lightMapIntensity:1,reflectivity:1,refractionRatio:.98,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",wireframeLinewidth:1,map:"",envMap:"",alphaMap:"",aoMap:"",lightMap:"",specularMap:""})},wn=function(){return Object.assign(Ue(),{type:a.CONFIGTYPE.MESHSTANDARDMATERIAL,aoMapIntensity:1,bumpScale:1,color:"rgb(255, 255, 255)",displacementScale:1,displacementBias:0,emissive:"rgb(0, 0, 0)",emissiveIntensity:1,envMapIntensity:1,flatShading:!1,lightMapIntensity:1,metalness:0,normalMapType:l.TangentSpaceNormalMap,refractionRatio:.98,roughness:1,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",roughnessMap:"",normalMap:"",metalnessMap:"",map:"",lightMap:"",envMap:"",emissiveMap:"",displacementMap:"",bumpMap:"",alphaMap:"",aoMap:""})},ai=function(){return Object.assign(wn(),{type:a.CONFIGTYPE.MESHPHYSICALMATERIAL,attenuationColor:"rgb(255, 255, 255)",attenuationDistance:0,clearcoat:0,clearcoatNormalScale:{x:1,y:1},clearcoatRoughness:0,ior:1.5,reflectivity:.5,sheen:0,sheenRoughness:1,sheenColor:"rgb(255, 255, 255)",specularIntensity:0,specularColor:"rgb(255, 255, 255)",thickness:0,transmission:0,clearcoatMap:"",clearcoatNormalMap:"",clearcoatRoughnessMap:"",sheenRoughnessMap:"",sheenColorMap:"",specularIntensityMap:"",specularColorMap:"",thicknessMap:"",transmissionMap:""})},ci=function(){return Object.assign(Ue(),{type:a.CONFIGTYPE.MESHPHONGMATERIAL,aoMapIntensity:1,bumpScale:1,color:"rgb(255, 255, 255)",displacementScale:1,displacementBias:0,emissive:"rgb(0, 0, 0)",emissiveIntensity:1,envMapIntensity:1,flatShading:!1,lightMapIntensity:1,normalMapType:l.TangentSpaceNormalMap,refractionRatio:.98,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",specular:"rgb(17, 17, 17)",shininess:30,combine:l.MultiplyOperation,normalMap:"",map:"",lightMap:"",envMap:"",emissiveMap:"",displacementMap:"",bumpMap:"",alphaMap:"",aoMap:"",specularMap:""})},li=function(){return Object.assign(Ue(),{type:a.CONFIGTYPE.SPRITEMATERIAL,color:"rgb(255, 255, 255)",rotation:0,map:"",alphaMap:"",sizeAttenuation:!0})},ui=function(){return Object.assign(Ue(),{type:a.CONFIGTYPE.LINEBASICMATERIAL,color:"rgb(255, 255, 255)",linecap:"round",linejoin:"round",linewidth:1})},di=function(){return Object.assign(Ue(),{type:a.CONFIGTYPE.POINTSMATERIAL,map:"",alphaMap:"",color:"rgb(255, 255, 255)",sizeAttenuation:!0,size:1})},hi=function(){return Object.assign(Ue(),{type:a.CONFIGTYPE.SHADERMATERIAL,shader:"defaultShader",uniforms:{}})},pi=function(){return Object.assign(ge(),{type:a.CONFIGTYPE.PERSPECTIVECAMERA,adaptiveWindow:!1,fov:45,aspect:1920/1080,near:5,far:50})},fi=function(){return Object.assign(ge(),{type:a.CONFIGTYPE.ORTHOGRAPHICCAMERA,adaptiveWindow:!1,left:-window.innerWidth,right:window.innerWidth,top:window.innerHeight,bottom:-window.innerHeight,near:5,far:50,zoom:1})},Pn=function(){return{vid:"",type:"Renderer",size:null}},mi=function(){return Object.assign(Pn(),{vid:a.CONFIGTYPE.WEBGLRENDERER,type:a.CONFIGTYPE.WEBGLRENDERER,clearColor:"rgba(0, 0, 0, 0)",outputEncoding:l.LinearEncoding,physicallyCorrectLights:!1,shadowMap:{enabled:!1,autoUpdate:!0,needsUpdate:!1,type:l.PCFShadowMap},toneMapping:l.NoToneMapping,toneMappingExposure:1,pixelRatio:window.devicePixelRatio,adaptiveCamera:!1,viewport:null,scissor:null})},gi=function(){return Object.assign(Pn(),{vid:a.CONFIGTYPE.CSS3DRENDERER,type:a.CONFIGTYPE.CSS3DRENDERER})},Ei=function(){return Object.assign(ge(),{vid:a.CONFIGTYPE.SCENE,type:a.CONFIGTYPE.SCENE,background:"",environment:"",fog:{type:"",color:"rgb(150, 150, 150)",near:1,far:200,density:.003}})},Ti=function(){return{vid:a.CONFIGTYPE.TRNASFORMCONTROLS,type:a.CONFIGTYPE.TRNASFORMCONTROLS,axis:"XYZ",enabled:!0,mode:"translate",snapAllow:!1,rotationSnap:Math.PI/180*10,translationSnap:5,scaleSnap:.1,showX:!0,showY:!0,showZ:!0,size:1,space:"world"}},yi=function(){return{vid:a.CONFIGTYPE.ORBITCONTROLS,type:a.CONFIGTYPE.ORBITCONTROLS,autoRotate:!1,autoRotateSpeed:2,enableDamping:!1,dampingFactor:.05,enabled:!0,enablePan:!0,enableRotate:!0,enableZoom:!0,maxAzimuthAngle:1/0,maxDistance:1/0,maxPolarAngle:Math.PI,maxZoom:1/0,minAzimuthAngle:-1/0,minDistance:0,minPolarAngle:0,minZoom:0,panSpeed:1,rotateSpeed:1,zoomSpeed:1,screenSpacePanning:!0,target:null}},ht=function(){return Object.assign(ge(),{material:"",geometry:""})},Mi=function(){return Object.assign(ht(),{type:"Sprite",material:"",center:{x:.5,y:.5}})},Si=function(){return Object.assign(ht(),{type:a.CONFIGTYPE.MESH,geometry:"",material:""})},Ci=function(){return Object.assign(ht(),{type:a.CONFIGTYPE.POINTS,geometry:"",material:""})},Oi=function(){return Object.assign(ht(),{type:a.CONFIGTYPE.LINE,geometry:"",material:""})},bi=function(){return Object.assign(ge(),{type:a.CONFIGTYPE.GROUP,children:[]})},Yt=function(){return{vid:"",type:"Pass"}},Ri=function(){return Object.assign(Yt(),{type:a.CONFIGTYPE.SMAAPASS})},Li=function(){return Object.assign(Yt(),{type:a.CONFIGTYPE.UNREALBLOOMPASS,strength:1.5,threshold:0,radius:0})},wi=function(){return Object.assign(Yt(),{type:a.CONFIGTYPE.SELECTIVEBLOOMPASS,strength:1,threshold:0,radius:0,renderScene:"",renderCamera:"",selectedObjects:[]})},An=function(){return{vid:"",type:"",name:"",target:"",attribute:"",play:!0}},Pi=function(){return Object.assign(An(),{type:a.CONFIGTYPE.SCRIPTANIMATION,script:{name:""}})},Ai=function(){return Object.assign(An(),{type:a.CONFIGTYPE.KEYFRAMEANIMATION,script:{name:""}})},_t=function(){return Object.assign(ge(),{type:a.CONFIGTYPE.CSS3DOBJECT,element:"",width:50,height:50})},Ii=function(){return Object.assign(_t(),{type:a.CONFIGTYPE.CSS3DPLANE})},vi=function(){return Object.assign(_t(),{type:a.CONFIGTYPE.CSS3DSPRITE,rotation2D:0})},_={[a.CONFIGTYPE.IMAGETEXTURE]:ti,[a.CONFIGTYPE.CUBETEXTURE]:si,[a.CONFIGTYPE.CANVASTEXTURE]:ri,[a.CONFIGTYPE.VIDEOTEXTURE]:ni,[a.CONFIGTYPE.LOADTEXTURE]:ii,[a.CONFIGTYPE.MESHBASICMATERIAL]:oi,[a.CONFIGTYPE.MESHSTANDARDMATERIAL]:wn,[a.CONFIGTYPE.MESHPHONGMATERIAL]:ci,[a.CONFIGTYPE.SPRITEMATERIAL]:li,[a.CONFIGTYPE.LINEBASICMATERIAL]:ui,[a.CONFIGTYPE.POINTSMATERIAL]:di,[a.CONFIGTYPE.SHADERMATERIAL]:hi,[a.CONFIGTYPE.MESHPHYSICALMATERIAL]:ai,[a.CONFIGTYPE.AMBIENTLIGHT]:Ir,[a.CONFIGTYPE.SPOTLIGHT]:Nr,[a.CONFIGTYPE.POINTLIGHT]:vr,[a.CONFIGTYPE.DIRECTIONALLIGHT]:Gr,[a.CONFIGTYPE.HEMISPHERELIGHT]:Dr,[a.CONFIGTYPE.BOXGEOMETRY]:Fr,[a.CONFIGTYPE.SPHEREGEOMETRY]:xr,[a.CONFIGTYPE.LOADGEOMETRY]:Hr,[a.CONFIGTYPE.CUSTOMGEOMETRY]:kr,[a.CONFIGTYPE.PLANEGEOMETRY]:Ur,[a.CONFIGTYPE.CIRCLEGEOMETRY]:Br,[a.CONFIGTYPE.CONEGEOMETRY]:jr,[a.CONFIGTYPE.CYLINDERGEOMETRY]:zr,[a.CONFIGTYPE.EDGESGEOMETRY]:Wr,[a.CONFIGTYPE.LINECURVEGEOMETRY]:$r,[a.CONFIGTYPE.SPLINECURVEGEOMETRY]:Kr,[a.CONFIGTYPE.CUBICBEZIERCURVEGEOMETRY]:Xr,[a.CONFIGTYPE.QUADRATICBEZIERCURVEGEOMETRY]:Qr,[a.CONFIGTYPE.DODECAHEDRONGEOMETRY]:Vr,[a.CONFIGTYPE.SPLINETUBEGEOMETRY]:Jr,[a.CONFIGTYPE.LINETUBEGEOMETRY]:qr,[a.CONFIGTYPE.TORUSGEOMETRY]:Yr,[a.CONFIGTYPE.RINGGEOMETRY]:_r,[a.CONFIGTYPE.LINESHAPEGEOMETRY]:ei,[a.CONFIGTYPE.OBJECT3D]:ge,[a.CONFIGTYPE.SPRITE]:Mi,[a.CONFIGTYPE.LINE]:Oi,[a.CONFIGTYPE.MESH]:Si,[a.CONFIGTYPE.POINTS]:Ci,[a.CONFIGTYPE.GROUP]:bi,[a.CONFIGTYPE.CSS3DOBJECT]:_t,[a.CONFIGTYPE.CSS3DSPRITE]:vi,[a.CONFIGTYPE.CSS3DPLANE]:Ii,[a.CONFIGTYPE.PERSPECTIVECAMERA]:pi,[a.CONFIGTYPE.ORTHOGRAPHICCAMERA]:fi,[a.CONFIGTYPE.WEBGLRENDERER]:mi,[a.CONFIGTYPE.CSS3DRENDERER]:gi,[a.CONFIGTYPE.SCENE]:Ei,[a.CONFIGTYPE.TRNASFORMCONTROLS]:Ti,[a.CONFIGTYPE.ORBITCONTROLS]:yi,[a.CONFIGTYPE.SMAAPASS]:Ri,[a.CONFIGTYPE.UNREALBLOOMPASS]:Li,[a.CONFIGTYPE.SELECTIVEBLOOMPASS]:wi,[a.CONFIGTYPE.SCRIPTANIMATION]:Pi,[a.CONFIGTYPE.KEYFRAMEANIMATION]:Ai},Ni=(n,e,t)=>{const s=(r,i)=>Object.getPrototypeOf(i)?t.has(Object.getPrototypeOf(i).constructor.name+"Parser")?t.get(Object.getPrototypeOf(i).constructor.name+"Parser"):s(r,Object.getPrototypeOf(i)):null;return s(n,e)};class Be{registHandler(){return Ni}}class Gi extends Be{parse({url:e,resource:t,configMap:s,resourceMap:r}){const i=_[a.CONFIGTYPE.IMAGETEXTURE]();i.url=e,r.set(e,t),s.set(e,i)}}class Di extends Be{parse({url:e,resource:t,configMap:s,resourceMap:r}){const i=_[a.CONFIGTYPE.CANVASTEXTURE]();i.url=e,r.set(e,t),s.set(e,i)}}class Fi extends Be{parse({url:e,resource:t,configMap:s,resourceMap:r}){const i=_[a.CONFIGTYPE.VIDEOTEXTURE]();i.url=e,r.set(e,t),s.set(e,i)}}function In(n,e){return n in e}function xi(n,e){return Object.values(n).includes(e)}function Ui(n){return e=>{const t=(s,r)=>{for(const i in r){if(s[i]===void 0){console.warn(` config can not set key: ${i}`);continue}typeof r[i]=="object"&&r[i]!==null&&!Array.isArray(r[i])?t(s[i],r[i]):s[i]=r[i]}};return e&&t(n,e),n}}function k(n,e,t,s){const r=(i,o,c)=>{for(const u in i)if(o[u]!==void 0&&!(c&&c[u])){if(typeof i[u]=="object"&&typeof i[u]!==null){c&&typeof c[u]=="object"&&typeof c[u]!==null?r(i[u],o[u],c[u]):r(i[u],o[u]);continue}o[u]=i[u]}};r(n,e,t),s&&s()}var Bi=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",isValidKey:In,isValidEnum:xi,generateConfigFunction:Ui,syncObject:k});class vn extends Be{parse(e){this.parseObject3D(e)}parseColor(e){return`rgb(${Math.round(255*e.r)}, ${Math.round(255*e.g)}, ${Math.round(255*e.b)})`}attributeEnhance(e){const t={};for(const s in e)s.startsWith("_")?t[s.slice(1)]=e[s]:t[s]=e[s];return t}parseTexture({url:e,resource:t,configMap:s,resourceMap:r}){r.set(e,t);const i=_[a.CONFIGTYPE.LOADTEXTURE]();s.set(e,i),i.vid=se.v4(),i.url=e,k(t,i,{type:!0,vid:!0,url:!0})}parseMaterial({url:e,resource:t,configMap:s,resourceMap:r}){if(r.set(e,t),!_[t.type]){console.warn("can not found support config in vis for this resource",t);return}const i=_[t.type]();s.set(e,i),i.vid=se.v4(),k(this.attributeEnhance(t),i,{type:!0,vid:!0});for(const o in t)if(!!t[o]){if(t[o].isColor)i[o]=this.parseColor(t[o]);else if(o.toLocaleLowerCase().endsWith("map")&&t[o]){const c=`${e}.${o}`;this.parseTexture({url:c,resource:t[o],configMap:s,resourceMap:r}),i[o]=s.get(c).vid}}}parseGeometry({url:e,resource:t,configMap:s,resourceMap:r}){r.set(e,t),t.computeBoundingBox();const i=t.boundingBox,o=i.getCenter(new l.Vector3),c=_[a.CONFIGTYPE.LOADGEOMETRY]();c.vid=se.v4(),c.url=e,c.position.x=o.x/(i.max.x-i.min.x)*2,c.position.y=o.y/(i.max.y-i.min.y)*2,c.position.z=o.z/(i.max.z-i.min.z)*2,s.set(e,c)}parseObject3D({url:e,resource:t,configMap:s,resourceMap:r}){if(r.set(e,t),!_[t.type]){console.warn("can not found support config in vis for this resource",t);return}const i=_[t.type]();if(i.vid=se.v4(),k(t,i,{type:!0,vid:!0,children:!0,geometry:!0,material:!0,parent:!0,lookAt:!0}),i.rotation.x=t.rotation.x,i.rotation.y=t.rotation.y,i.rotation.z=t.rotation.z,s.set(e,i),t.material)if(Array.isArray(t.material))i.material=[],t.material.forEach((o,c,u)=>{const d=`${e}.material.${c}`;this.parseMaterial({url:d,resource:o,configMap:s,resourceMap:r}),i.material.push(s.get(d).vid)});else{const o=`${e}.material`;this.parseMaterial({url:o,resource:t.material,configMap:s,resourceMap:r}),i.material=s.get(o).vid}if(t.geometry){const o=`${e}.geometry`;this.parseGeometry({url:o,resource:t.geometry,configMap:s,resourceMap:r}),i.geometry=s.get(o).vid}t.children&&t.children.length&&t.children.forEach((o,c,u)=>{const d=`${e}.children.${c}`;this.parseObject3D({url:d,resource:o,configMap:s,resourceMap:r}),i.children.push(s.get(d).vid)})}}class ji extends Be{parse({url:e,resource:t,configMap:s,resourceMap:r}){const i=_[a.CONFIGTYPE.CSS3DPLANE]();i.element=e,r.set(e,t),s.set(e,i)}}class Yi extends Be{parse({url:e,resource:t,configMap:s,resourceMap:r}){const i=_[a.CONFIGTYPE.LOADTEXTURE]();i.url=e,r.set(e,t),s.set(e,i)}}class _i extends Be{constructor(){super();h(this,"object3DParser",new vn)}parse({url:e,resource:t,configMap:s,resourceMap:r}){this.object3DParser.parse({url:`${e}.scene`,resource:t.scene,configMap:s,resourceMap:r})}registHandler(){return(e,t,s)=>t.parser.constructor.name==="GLTFParser"&&s.get(this.constructor.name)||null}}a.RESOURCEEVENTTYPE=void 0,function(n){n.MAPPED="mapped"}(a.RESOURCEEVENTTYPE||(a.RESOURCEEVENTTYPE={}));class Nn extends re{constructor(e={}){super();h(this,"structureMap",new Map);h(this,"configMap",new Map);h(this,"resourceMap",new Map);h(this,"paserMap",new Map);h(this,"handlerMap",new Map);this.addParser(new Gi,{warn:!1}).addParser(new Di,{warn:!1}).addParser(new Fi,{warn:!1}).addParser(new vn,{warn:!1}).addParser(new ji,{warn:!1}).addParser(new Yi,{warn:!1}).addParser(new _i,{warn:!1});const t=new Map;for(const s in e)t.has(s)&&console.warn(`resourceManager construct params rescource already exist: ${s}, that will be cover.`),t.set(s,e[s]);this.mappingResource(t)}addParser(e,t={warn:!0}){return this.paserMap.has(e.constructor.name)&&t.warn&&console.warn("resourceManager has already exist this parser, that will be cover",this.paserMap.get(e.constructor.name)),this.paserMap.set(e.constructor.name,e),this.addHanlder(e.registHandler(),t),this}addHanlder(e,t={warn:!0}){return this.handlerMap.has(e.name)&&t.warn&&console.warn("resourceManager has already exist this hanlder, that will be cover",e.name),this.handlerMap.set(e.name,e),this}mappingResource(e,t){const s=this.configMap,r=this.resourceMap,i={};return e.forEach((o,c)=>{if(t&&t.hanlder&&t.hanlder[c]){const u=this.handlerMap.get(t.hanlder[c]);if(!u)console.warn(`resource manager can not support this handler: ${t.hanlder[c]}`);else{const d=u(c,o,this.paserMap);d?(d.parse({url:c,resource:o,configMap:s,resourceMap:r}),i[c]=this.getResourceConfig(c)):console.warn("resource manager hanlder can not found this resource parser: ",o,u)}}else{let u=null;for(const d of this.handlerMap.values())if(u=d(c,o,this.paserMap),u)break;u?(u.parse({url:c,resource:o,configMap:s,resourceMap:r}),i[c]=this.getResourceConfig(c)):console.warn("resouce manager can not found some handler to parser this resource:",o)}}),this.dispatchEvent({type:"mapped",structureMap:this.structureMap,configMap:s,resourceMap:r,resourceConfig:i}),this}getResourceConfig(e){const t=this.configMap,s={};return[...t.keys()].filter(r=>r.startsWith(e)).some(r=>{const i=t.get(r);if(!i)console.error(`unknow error: can not found config by url: ${r}`);else{const o=ke(i.type);o?(!s[o]&&(s[o]={}),s[o][i.vid]=i):console.error(`unknow error: can not found module by type: ${i.type}`,i)}}),s}hasResource(e){return this.resourceMap.has(e)}remove(e){const t=this.configMap,s=this.resourceMap;return[...t.keys()].filter(r=>r.startsWith(e)).forEach(r=>{t.delete(r);const i=s.get(r);i.dispose&&i.dispose(),s.delete(r)}),this}dispose(){this.resourceMap.forEach((e,t)=>{e.dispose&&e.dispose()}),this.resourceMap.clear(),this.configMap.clear()}}const Hi=function(n){if(this.resourceManager)return console.warn("engine has installed resourceManager plugin."),!1;const e=new Nn(n.resources);return this.resourceManager=e,this.loaderManager&&this.loaderManager.addEventListener("loaded",t=>{this.resourceManager.mappingResource(t.resourceMap)}),this.registerResources=t=>{const s=new Map;return Object.keys(t).forEach(r=>{s.set(r,t[r])}),this.resourceManager.mappingResource(s),this},this.addEventListener("dispose",()=>{this.resourceManager.dispose()}),!0},st=(n,e)=>e===1/0?"Infinity":e===-1/0?"-Infinity":e,Gn=(n,e)=>e==="Infinity"?1/0:e==="-Infinity"?-1/0:e,pt=n=>JSON.parse(JSON.stringify(n,st),Gn);var ki=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",stringify:st,parse:Gn,clone:pt});const Z=class extends re{constructor(e){super();h(this,"ignoreAttribute");this.ignoreAttribute=e||{}}static proxyGetter(e,t,s){return Reflect.get(e,t,s)}static proxySetter(e,t,s,r,i,o){if(typeof t=="symbol")return Reflect.set(e,t,s,r);Z.cacheArray(s);let c;if(e[t]===void 0){if(typeof s=="object"&&s!==null&&!Z.proxyWeakSet.has(s)&&!i.ignoreAttribute[t]){const u=o.concat([t]);s=i.proxyExtends(s,u)}c=Reflect.set(e,t,s),i.broadcast({operate:"add",path:o.concat([]),key:t,value:s})}else{if(typeof s=="object"&&s!==null&&!Z.proxyWeakSet.has(s)&&!i.ignoreAttribute[t]){const u=o.concat([t]);s=i.proxyExtends(s,u)}if(c=Reflect.set(e,t,s),Array.isArray(e)&&t==="length"){const u=e[Symbol.for(Z.arraySymobl)],d=u.length-e.length;if(d>0){let p=0,f=0;for(const g of u){if(!e.includes(g)&&(i.broadcast({operate:"delete",path:o.concat([]),key:f.toString(),value:g}),p+=1,p===d))break;f+=1}}return e[Symbol.for(this.arraySymobl)]=e.concat([]),c}i.broadcast({operate:"set",path:o.concat([]),key:t,value:s})}return c}static proxyDeleter(e,t,s,r){const i=e[t],o=Reflect.deleteProperty(e,t);return Array.isArray(e)||typeof t=="symbol"||s.broadcast({operate:"delete",path:r.concat([]),key:t,value:i}),o}proxyExtends(e,t=[]){if(Z.proxyWeakSet.has(e)||typeof e!="object")return e;const s={get:Z.proxyGetter,set:(i,o,c,u)=>Z.proxySetter(i,o,c,u,this,t),deleteProperty:(i,o)=>Z.proxyDeleter(i,o,this,t)};if(typeof e=="object"&&e!==null)for(const i in e){const o=t.concat([i]);let c=this.ignoreAttribute,u=!1;for(const d of o.slice(1)){if(c[d]===!0){u=!0;break}c[d]&&(c=c[d])}u||In(i,e)&&typeof e[i]=="object"&&e[i]!==null&&(Z.cacheArray(e[i]),e[i]=this.proxyExtends(e[i],o))}const r=new Proxy(e,s);return Z.proxyWeakSet.add(r),r}broadcast({operate:e,path:t,key:s,value:r}){return{__poto__:!0,length:!0}[s]?this:(this.dispatchEvent({type:"broadcast",notice:{operate:e,path:t,key:s,value:r}}),this)}};let ze=Z;h(ze,"proxyWeakSet",new WeakSet),h(ze,"arraySymobl","vis.array"),h(ze,"cacheArray",function(e){Array.isArray(e)&&!e[Symbol.for(Z.arraySymobl)]&&(e[Symbol.for(Z.arraySymobl)]=e.concat([]))});class Dn{constructor(){h(this,"rule");h(this,"memberSet");this.rule=function(){},this.memberSet=new Set}apply(e){return this.memberSet.add(e),this}cancel(e){return this.memberSet.delete(e),this}setRule(e){return this.rule=e,this}translate(e){const t=this.rule;return this.memberSet.forEach(s=>{t(e,s)}),this}}class ce{constructor(e,t,s){h(this,"data");h(this,"broadcast");h(this,"translater");this.translater=new Dn().setRule(e),this.broadcast=new ze(s),this.data=this.broadcast.proxyExtends(t),this.broadcast.addEventListener("broadcast",r=>{this.translater.translate(r.notice)})}getData(){return this.data}setData(e){return this.data=e,this}proxyData(e){return this.data=this.broadcast.proxyExtends(e),this.data}existSymbol(e){return Boolean(this.data[e])}addConfig(e){return this.data[e.vid]=e,this}getConfig(e){return this.data[e]}removeConfig(e){const t=this.data;t[e]!==void 0&&delete t[e]}addCompiler(e){return e.setTarget(this.data),e.compileAll(),this.translater.apply(e),this}toJSON(e=!0){return e?JSON.stringify(this.exportConfig(),st):JSON.stringify(this.data,st)}exportConfig(e=!0){if(e){const t=this.data,s={},r={},i=(o,c,u={})=>{for(const d in o){if(["vid","type"].includes(d)){u[d]=o[d];continue}if(typeof o[d]=="object"&&o[d]!==null){if(Array.isArray(o[d])){if(!o[d].length)continue;u[d]=o[d].map(p=>typeof p=="object"&&p!==null?pt(p):p);continue}u[d]={},c[d]?(i(o[d],c[d],u[d]),Object.keys(u[d]).length===0&&delete u[d]):u[d]=pt(o[d])}else c[d]!==o[d]&&(u[d]=o[d])}};for(const o of Object.values(t)){if(!r[o.type]){if(!_[o.type]){console.error(`can not font some config with: ${o.type}`);continue}r[o.type]=_[o.type]()}s[o.vid]={},i(o,r[o.type],s[o.vid])}return s}else return pt(this.data)}load(e){const t=this.data,s={},r=(i,o)=>{for(const c in o)typeof i[c]=="object"&&i[c]!==null&&typeof o[c]=="object"&&o[c]!==null?r(i[c],o[c]):i[c]===void 0&&(i[c]=o[c])};for(const i in e){const o=e[i];if(!s[o.type]){if(!_[o.type]){console.error(`can not font some config with: ${o.type}`);continue}s[o.type]=_[o.type]()}r(o,s[o.type]),t[i]=o}return this}remove(e){const t=this.data;for(const s in e)t[s]!==void 0&&delete t[s];return this}getModule(){return this.MODULE}}const Ee=(n,e,t=se.validate)=>{const{operate:s,key:r,path:i,value:o}=n;let c=r;const u=[].concat(i);if(i.length&&(c=u.shift()),!t(c)){console.warn(`${e.MODULE} Rule: vid is illeage: ${c}`);return}if(s==="add"&&!u.length){e.add(o);return}if(n.operate==="delete"&&!u.length){e.remove(o);return}if(n.operate==="set"&&!u.length&&r===c){e.cover(o);return}e.compile(c,{operate:s,key:r,path:u,value:o})},zi=function(n,e){Ee(n,e)};class Fn extends ce{constructor(e,t){!e&&(e={});super(zi,e,t);h(this,"MODULE",a.MODULETYPE.TEXTURE)}}const Vi=function(n,e){Ee(n,e)};class xn extends ce{constructor(e,t){!e&&(e={});super(Vi,e,t);h(this,"MODULE",a.MODULETYPE.MATERIAL)}}class Ve extends ce{constructor(e,t,s){!t&&(t=Object.create(Object.prototype));super(e,t,s);h(this,"MODULE",a.MODULETYPE.GROUP)}}const Te=function(n,e){n.key!=="parent"&&Ee(n,e)},Wi=function(n,e){Te(n,e)};class Un extends Ve{constructor(e,t){!e&&(e={});super(Wi,e,t);h(this,"MODULE",a.MODULETYPE.LIGHT)}}const $i=function(n,e){Ee(n,e)};class Bn extends ce{constructor(e,t){!e&&(e={});super($i,e,t);h(this,"MODULE",a.MODULETYPE.GEOMETRY)}}const Ki=function(n,e){Te(n,e)};class jn extends Ve{constructor(e,t){!e&&(e={});super(Ki,e,t);h(this,"MODULE",a.MODULETYPE.CAMERA)}}const Xi=function(n,e){Ee(n,e,t=>se.validate(t)||[a.CONFIGTYPE.WEBGLRENDERER,a.CONFIGTYPE.CSS3DRENDERER].includes(t))};class Yn extends ce{constructor(e,t){!e&&(e={});super(Xi,e,t);h(this,"MODULE",a.MODULETYPE.RENDERER)}}const Qi=function(n,e){Ee(n,e,t=>se.validate(t)||[a.CONFIGTYPE.SCENE].includes(t))};class _n extends Ve{constructor(e,t){!e&&(e={});super(Qi,e,t);h(this,"MODULE",a.MODULETYPE.SCENE)}}const qi=function(n,e){Ee(n,e,t=>se.validate(t)||[a.CONFIGTYPE.TRNASFORMCONTROLS,a.CONFIGTYPE.ORBITCONTROLS].includes(t))};class Hn extends ce{constructor(e,t){!e&&(e={});super(qi,e,t);h(this,"MODULE",a.MODULETYPE.CONTROLS)}}class ft extends ce{constructor(e,t,s){!t&&(t=Object.create(Object.prototype));super(e,t,s);h(this,"MODULE",a.MODULETYPE.MESH)}}const Ji=function(n,e){n.key!=="geometry"&&Te(n,e)};class kn extends ft{constructor(e,t){!e&&(e={});super(Ji,e,t);h(this,"MODULE",a.MODULETYPE.SPRITE)}}const Zi=function(n,e){Te(n,e)};class zn extends ft{constructor(e,t){!e&&(e={});super(Zi,e,t);h(this,"MODULE",a.MODULETYPE.LINE)}}const eo=function(n,e){Te(n,e)};class Vn extends ft{constructor(e,t){!e&&(e={});super(eo,e,t);h(this,"MODULE",a.MODULETYPE.MESH)}}const to=function(n,e){Te(n,e)};class Wn extends ft{constructor(e,t){!e&&(e={});super(to,e,t);h(this,"MODULE",a.MODULETYPE.POINTS)}}const no=function(n,e){Te(n,e)};class $n extends Ve{constructor(e,t){!e&&(e={});super(no,e,t);h(this,"MODULE",a.MODULETYPE.GROUP)}}const so=function(n,e){Ee(n,e)};class Kn extends ce{constructor(e,t){!e&&(e={});super(so,e,t);h(this,"MODULE",a.MODULETYPE.PASS)}}const ro=function(n,e){n.key==="name"&&n.path.length===1||Ee(n,e)};class Xn extends ce{constructor(e,t){!e&&(e={});super(ro,e,t);h(this,"MODULE",a.MODULETYPE.ANIMATION)}}const io=function(n,e){Te(n,e)};class Qn extends Ve{constructor(e,t){!e&&(e={});super(io,e,t);h(this,"MODULE",a.MODULETYPE.CSS3D)}}const oo=function(n,e){Te(n,e)};class ao extends Ve{constructor(e,t){!e&&(e={});super(oo,e,t);h(this,"MODULE",a.MODULETYPE.OBJECT3D)}}class qn{constructor(e){h(this,"object3DDataSupport",new ao);h(this,"cameraDataSupport",new jn);h(this,"lightDataSupport",new Un);h(this,"geometryDataSupport",new Bn);h(this,"textureDataSupport",new Fn);h(this,"materialDataSupport",new xn);h(this,"rendererDataSupport",new Yn);h(this,"sceneDataSupport",new _n);h(this,"controlsDataSupport",new Hn);h(this,"spriteDataSupport",new kn);h(this,"lineDataSupport",new zn);h(this,"meshDataSupport",new Vn);h(this,"pointsDataSupport",new Wn);h(this,"groupDataSupport",new $n);h(this,"css3DDataSupport",new Qn);h(this,"passDataSupport",new Kn);h(this,"animationDataSupport",new Xn);h(this,"dataSupportMap");e&&Object.keys(e).forEach(s=>{this[s]!==void 0&&(this[s]=e[s])});const t=new Map;Object.keys(this).forEach(s=>{const r=this[s];r instanceof ce&&t.set(r.MODULE,r)}),this.dataSupportMap=t}getDataSupport(e){return this.dataSupportMap.has(e)?this.dataSupportMap.get(e):(console.warn(`can not found this type in dataSupportManager: ${e}`),null)}getSupportData(e){return this.dataSupportMap.has(e)?this.dataSupportMap.get(e).getData():(console.warn(`can not found this type in dataSupportManager: ${e}`),null)}setSupportData(e,t){return this.dataSupportMap.has(e)?this.dataSupportMap.get(e).setData(t):console.warn(`can not found this type in dataSupportManager: ${e}`),this}getConfigBySymbol(e){const t=this.dataSupportMap.values();for(const s of t){const r=s.getConfig(e);if(r)return r}return null}removeConfigBySymbol(...e){const t=this.dataSupportMap.values();for(const s of e)for(const r of t)if(r.existSymbol(s)){r.removeConfig(s);break}return this}getModuleBySymbol(e){const t=this.dataSupportMap.values();for(const s of t)if(s.existSymbol(e))return s.MODULE;return null}applyConfig(...e){for(const t of e){const s=ke(t.type);s?this.dataSupportMap.get(s).addConfig(t):console.warn(`dataSupportManager can not found this config module: ${t.type}`)}return this}reactiveConfig(e){const t=ke(e.type);return t?this.dataSupportMap.get(t).addConfig(e).getConfig(e.vid):(console.warn(`dataSupportManager can not found this config module: ${e.type}`),e)}load(e){return this.dataSupportMap.forEach((s,r)=>{e[r]&&s.load(e[r])}),this}remove(e){return this.dataSupportMap.forEach((s,r)=>{e[r]&&s.remove(e[r])}),this}toJSON(e={},t=!0){return JSON.stringify(this.exportConfig(e,t),st)}exportConfig(e={},t=!0){return this.dataSupportMap.forEach((r,i)=>{e[i]=r.exportConfig(t)}),e}}const co={name:"uvPulseShader",uniforms:{time:{value:0},width:{value:.5},color:{value:{r:1,g:0,b:0}},center:{value:{x:.5,y:.5}}},vertexShader:`
    varying vec2 vUv;

    void main () {

      vUv = uv;

      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }`,fragmentShader:`
    uniform float width;
    uniform float time;
    uniform vec3 color;
    uniform vec2 center;

    varying vec2 vUv;

    void main () {
      // \u6839\u636EuTime\u6C42\u51FA\u767E\u5206\u6BD4
      float deg = mod(degrees(time), 360.0);
      if (deg > 0.0 && deg < 180.0) {
        discard;
      }

      float percent = cos(time);
      float distancePercent = distance(center, vUv);

      // \u4ECE\u5916\u5411\u91CC
      if (distancePercent > 0.5) {
        discard;
      }

      if (distancePercent < percent) {
        discard;
      }

      if (distancePercent - percent > width) {
        discard;
      }

      float opacity =  (width - (distancePercent - percent)) / width;

      // float opacity = distancePercent;
      gl_FragColor = vec4(color, opacity);
    }`},lo={name:"fragCoordTestingShader",uniforms:{resolution:{value:{x:1920,y:1080}}},vertexShader:`
  void main () {
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }`,fragmentShader:`
    uniform vec2 resolution;

    void main () {
      vec2 st = gl_FragCoord.xy / resolution;
      gl_FragColor = vec4(st.x,st.y,0.0,1.0);
    }`},uo={name:"colorMixShader",uniforms:{colorA:{value:{r:1,g:0,b:0}},colorB:{value:{r:0,g:1,b:0}},percent:{value:.5}},vertexShader:`
  void main () {
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }`,fragmentShader:`
    uniform vec3 colorA;
    uniform vec3 colorB;
    uniform float percent;

    void main () {
      gl_FragColor = vec4(mix(colorA, colorB, percent), 1.0);
    }`},ho={name:"BloomShader",uniforms:{brightness:{value:.5},extend:{value:5},range:{value:10},specular:{value:.8},specularRange:{value:2},color:{value:{r:1,g:1,b:1}}},vertexShader:`
  uniform float extend;

  varying vec2 vUv;

  void main () {

    vUv = uv;

    vec3 extendPosition = position + normalize(position) * extend;

    gl_Position = projectionMatrix * modelViewMatrix * vec4(extendPosition , 1.0 );
  }`,fragmentShader:`
    uniform vec3 color;
    uniform float brightness;
    uniform float specular;
    uniform float range;
    uniform float specularRange;

    varying vec2 vUv;
    
    void main () {

      gl_FragColor = vec4(color, brightness);
    }`},Me=class{static getShader(e){return Me.library.has(e)?Me.cloneShader(Me.library.get(e)):(console.warn(`con not found shader in shader library: ${e}`),null)}static generateConfig(e){if(!Me.library.has(e))return console.warn(`con not found shader in shader library: ${e}`),{};const t=Me.library.get(e),s={shader:e,uniforms:{}};return t.uniforms&&(s.uniforms=JSON.parse(JSON.stringify(t.uniforms))),s}static cloneShader(e){const t={name:e.name};return e.vertexShader&&(t.vertexShader=e.vertexShader),e.fragmentShader&&(t.fragmentShader=e.fragmentShader),e.uniforms&&(t.uniforms=JSON.parse(JSON.stringify(e.uniforms))),t}};let ee=Me;h(ee,"library",new Map),h(ee,"reigster",function(e){Me.library.has(e.name)&&console.warn(`shader library has exist shader: ${e.name} that will be cover.`),Me.library.set(e.name,e)});const po={name:"defaultShader"};ee.reigster(po),ee.reigster(co),ee.reigster(lo),ee.reigster(uo),ee.reigster(ho);const X=function(n,e,t=!0,s=!0){if(!_[n])return console.error(`type: ${n} can not be found in configList.`),{vid:"",type:n};const r=(o,c)=>{for(const u in c){if(o[u]===void 0){!t&&(o[u]=c[u]),t&&s&&console.warn(`'${n}' config can not set key: ${u}`);continue}typeof c[u]=="object"&&c[u]!==null&&!Array.isArray(c[u])?(o[u]===null&&(o[u]=j({},c[u])),r(o[u],c[u])):o[u]=c[u]}},i=_[n]();if([a.CONFIGTYPE.SHADERMATERIAL].includes(n)){const o=ee.generateConfig((e==null?void 0:e.shader)||"defaultShader"),c=t;t=!1,r(i,o),t=c}if([a.CONFIGTYPE.SCRIPTANIMATION,a.CONFIGTYPE.KEYFRAMEANIMATION].includes(n)&&(t=!1),i.vid===""&&(i.vid=se.v4()),e&&r(i,e),X.autoInject&&X.injectEngine){const o=X.injectEngine,c=o.reactiveConfig(i);if(X.injectScene&&ke(i.type)in a.OBJECTMODULE&&i.type!==a.CONFIGTYPE.SCENE){let u=null;typeof X.injectScene=="boolean"?u=o.getObjectConfig(o.scene):typeof X.injectScene=="string"&&(u=o.getConfigBySymbol(X.injectScene)),u?u.children.push(i.vid):console.warn("current engine scene can not found it config",o,o.scene)}return c}return i};X.autoInject=!0,X.injectScene=!1,X.injectEngine=null;const fo=function(n){if(this.dataSupportManager)return console.warn("engine has installed dataSupportManager plugin."),!1;const e=new qn(n);return this.dataSupportManager=e,this.applyConfig=function(...t){return this.dataSupportManager.applyConfig(...t),this},this.reactiveConfig=function(t){return this.dataSupportManager.reactiveConfig(t)},this.getConfigBySymbol=function(t){return this.dataSupportManager.getConfigBySymbol(t)},this.removeConfigBySymbol=function(...t){return this.dataSupportManager.removeConfigBySymbol(...t),this},this.toJSON=function(){if(this.loaderManager){const t={assets:JSON.parse(this.loaderManager.toJSON())};return this.dataSupportManager.toJSON(t)}return this.dataSupportManager.toJSON()},this.exportConfig=function(){let t={};return this.loaderManager&&(t={assets:this.loaderManager.exportConfig()}),this.dataSupportManager.exportConfig(t)},this.completeSet.add(()=>{const t=this.dataSupportManager.getDataSupport(a.MODULETYPE.RENDERER).getData();t.WebGLRenderer||(t.WebGLRenderer=X(a.CONFIGTYPE.WEBGLRENDERER));const s=this.dataSupportManager.getDataSupport(a.MODULETYPE.CONTROLS).getData();this.transformControls&&(s[a.CONFIGTYPE.TRNASFORMCONTROLS]||(s[a.CONFIGTYPE.TRNASFORMCONTROLS]=X(a.CONFIGTYPE.TRNASFORMCONTROLS))),this.orbitControls&&(s[a.CONFIGTYPE.ORBITCONTROLS]||(s[a.CONFIGTYPE.ORBITCONTROLS]=X(a.CONFIGTYPE.ORBITCONTROLS)))}),!0},oe=class{constructor(){h(this,"target",{});h(this,"map",new Map);h(this,"weakMap",new WeakMap);h(this,"engine");h(this,"cacheCompile")}getMap(){return this.map}useEngine(e){return this.engine=e,this}setTarget(e){return this.target=e,this}add(e){if(!oe.processors.has(e.type))return console.warn(`${this.MODULE} compiler can not support this type: ${e.type}`),null;const s=oe.processors.get(e.type).create(e,this.engine);return this.map.set(e.vid,s),this.weakMap.set(s,e.vid),s}remove(e){const t=e.vid;if(!this.map.has(t))return console.warn(`${this.MODULE} compiler can not found this vid object: ${t}.`),this;if(!oe.processors.has(e.type))return console.warn(`${this.MODULE} compiler can not support this type: ${e.type}`),this;const s=this.map.get(t);return oe.processors.get(e.type).dispose(s),this.map.delete(t),this.weakMap.delete(s),this}cover(e){const t=e.vid;return this.map.has(t)?(Promise.resolve().then(()=>{k(e,e,{vid:!0,type:!0})}),this):(console.warn(`${this.MODULE} compiler can not found this vid object: ${t}.`),this)}compile(e,t){const s=this.cacheCompile;let r,i,o;if(s&&s.vid===e)r=s.target,i=s.config,o=s.processor;else{if(!this.map.has(e))return console.warn(`${this.MODULE} compiler set function: can not found object which vid is: '${e}'`),this;if(!this.target[e])return console.warn(`${this.MODULE} compiler set function: can not found config which vid is: '${e}'`),this;if(r=this.map.get(e),i=this.target[e],!oe.processors.has(i.type))return console.warn(`PassCompiler can not support this type: ${i.type}`),this;o=oe.processors.get(i.type),this.cacheCompile={target:r,config:i,processor:o,vid:e}}return o.process(j({config:i,target:r,engine:this.engine,processor:o,compiler:this},t)),this}compileAll(){const e=this.target;for(const t of Object.values(e))this.add(t);return this}dispose(){this.cacheCompile&&(this.cacheCompile=void 0);for(const e of Object.values(this.target)){if(!this.map.has(e.vid)){console.warn(`${this.MODULE} compiler set function: can not found object which vid is: '${e.vid}'`);continue}const t=this.map.get(e.vid);if(!oe.processors.has(e.type)){console.warn(`${this.MODULE}  can not support this type: ${e.type}`);continue}oe.processors.get(e.type).dispose(t)}return this.map.clear(),this.target={},this}getObjectSymbol(e){return this.weakMap.get(e)||null}getObjectBySymbol(e){return this.map.get(e)||null}};let L=oe;h(L,"processors",new Map),h(L,"processor",function(e){oe.processors.set(e.configType,e)});const We="vis.scriptAni";class mo{constructor(e){h(this,"configType");h(this,"commands");h(this,"create");h(this,"dispose");this.configType=e.configType,this.commands=e.commands,this.create=e.create,this.dispose=e.dispose}process(e){if(!this.commands||!this.commands[e.operate]){this[e.operate](e);return}let t=this.commands[e.operate];for(const s of[].concat(e.path,e.key))if(!t[s]&&!t.$reg){this[e.operate](e);return}else if(t[s])if(typeof t[s]=="function"){t[s](e);return}else t=t[s];else if(t.$reg){for(const r of t.$reg)if(r.reg.test(s)){r.handler(e);return}}this[e.operate](e)}add(e){let t=e.target;const s=e.path;for(const r of s)if(typeof t[r]!==void 0)t=t[r];else{console.warn("processor can not exec default add operate.",e);return}t[e.key]=e.value}set(e){let t=e.target;const s=e.path;for(const r of s)if(typeof t[r]!==void 0)t=t[r];else{console.warn("processor can not exec default set operate.",e);return}t[e.key]=e.value}delete(e){let t=e.target;const s=e.path;for(const r of s)if(typeof t[r]!==void 0)t=t[r];else{console.warn("processor can not exec default delete operate.",e);return}delete t[e.key]}}const A=n=>new mo(n),mt=function(){},go={name:"linearTime",multiply:1},Eo=function(n,e,t,s){return e[t]===void 0?(console.warn(`object not exist attribute: ${t}`,e),r=>{}):typeof e[t]!="number"?(console.warn("object attribute is not typeof number.",e,t),r=>{}):r=>{e[t]+=r.delta*s.multiply}},To={name:"sinWave",wavelength:1,offset:0,amplitude:1,speed:1},yo=function(n,e,t,s){if(e[t]===void 0)return console.warn(`object not exist attribute: ${t}`,e),i=>{};if(typeof e[t]!="number")return console.warn("object attribute is not typeof number.",e,t),i=>{};const r=e[t];return i=>{e[t]=r+s.amplitude*Math.sin(i.total*s.speed/s.wavelength)+s.offset}},le=class{static generateConfig(e,t){if(!le.configLibrary.has(e))return console.warn(`event library can not found config by name: ${e}`),{name:""};const s=(i,o)=>{for(const c in o)i[c]!==void 0&&(typeof o[c]=="object"&&o[c]!==null&&!Array.isArray(o[c])?s(i[c],o[c]):i[c]=o[c])},r=JSON.parse(JSON.stringify(le.configLibrary.get(e)));return s(r,t),r}static generateScript(e,t,s,r){return le.generatorLibrary.has(r.name)?le.generatorLibrary.get(r.name)(e,t,s,r):(console.error(`event library can not found generator by name: ${r.name}`),()=>{})}static has(e){return le.configLibrary.has(e)}};let Re=le;h(Re,"configLibrary",new Map),h(Re,"generatorLibrary",new Map),h(Re,"register",function(e,t){le.configLibrary.has(e.name)&&console.warn(`EventLibrary has already exist this event generator: ${e.name}, that will be cover.`),le.configLibrary.set(e.name,JSON.parse(JSON.stringify(e))),le.generatorLibrary.set(e.name,t)}),Re.register(go,Eo),Re.register(To,yo);const Jn=function(n,e){let t=e.compilerManager.getObjectBySymbol(n.target);t||console.error(`can not found object in enigne: ${n.target}`);const s=n.attribute.split(".");s.shift();const r=s.pop();for(const i of s){if(t[i]===void 0)return console.error(`animaton processor: target object can not found key: ${i}`,t),()=>{};t=t[i]}return Re.generateScript(e,t,r,n.script)};var Mo=A({configType:a.CONFIGTYPE.SCRIPTANIMATION,commands:{set:{play({target:n,engine:e,value:t}){t?e.renderManager.addEventListener("render",n):e.renderManager.removeEventListener("render",n)},$reg:[{reg:new RegExp(".*"),handler({config:n,engine:e}){const t=n[Symbol.for(We)];e.renderManager.removeEventListener("render",t);const s=Jn(n,e);n[Symbol.for(We)]=s,n.play&&e.renderManager.addEventListener("render",t)}}]}},create(n,e){const t=Jn(n,e);return n.play&&e.renderManager.addEventListener("render",t),n[Symbol.for(We)]=t,t},dispose(){}});class So extends L{constructor(){super();h(this,"MODULE",a.MODULETYPE.ANIMATION)}cover(e){super.cover(e);const t=this.map.get(e.vid);return e[Symbol.for(We)]=t,this}remove(e){return delete e[Symbol.for(We)],super.remove(e),this}compile(e,t){super.compile(e,t);const s=this.target[e],r=this.map.get(s.vid);return s[Symbol.for(We)]=r,this}}L.processor(Mo);class Le extends L{constructor(){super()}}const Co={name:"openWindow",params:{url:""}},Oo=function(n,e){return()=>{window.open(e.params.url)}},bo={name:"visibleObject",params:{target:"",visible:!0,delay:0}},Ro=function(n,e){const t=e.params,s=n.getObjectBySymbol(t.target);return s?()=>{setTimeout(()=>{s.visible=t.visible},t.delay)}:(console.warn(`basic event visibleObject: can not found vid object: ${t.target}`),()=>{})},Lo={name:"addClass",params:{target:"",className:"",delay:0}},wo=function(n,e){const t=e.params,s=[];if(t.target==="all")n.scene.traverse(r=>{r instanceof Oe.CSS3DObject&&s.push(r)});else if(Array.isArray(t.target))t.target.forEach(r=>{const i=n.getObjectBySymbol(r);i?s.push(i):console.warn(`basic event AddClass: can not found vid object: ${t.target}`)});else{const r=n.getObjectBySymbol(t.target);if(!r)return console.warn(`basic event AddClass: can not found vid object: ${t.target}`),()=>{};if(!(r instanceof Oe.CSS3DObject))return console.warn("basic event AddClass: object is not a CSS3DObject."),()=>{};s.push(r)}return s.length?()=>{setTimeout(()=>{s.forEach(r=>{r.element.classList.add(t.className)})},t.delay)}:(console.warn(`basic event AddClass: can not found vid object: ${t.target}`),()=>{})},Po={name:"changeScene",params:{scene:"Scene",delay:0}},Ao=function(n,e){const t=e.params;return()=>{setTimeout(()=>{n.setScene(t.scene)},t.delay)}},Io={name:"changeCamera",params:{camera:"",delay:0}},vo=function(n,e){const t=e.params;return()=>{setTimeout(()=>{n.setCamera(t.camera)},t.delay)}},No={name:"switchAnimate",params:{target:"",toggle:"auto",delay:0}},Go=function(n,e){const t=e.params,s=n.getConfigBySymbol(t.target);return s?()=>{setTimeout(()=>{if(t.toggle==="auto"){s.play!=s.play;return}if(t.toggle==="off"){s.play=!1;return}if(t.toggle==="on"){s.play=!0;return}},t.delay)}:(console.warn(`basic event switchAnimate: can not found vid config: ${t.target}`),()=>{})};a.TIMINGFUNCTION=void 0,function(n){n.ELN="ELN",n.EQI="EQI",n.EQO="EQO",n.EASING_LINEAR_NONE="EASING_LINEAR_NONE",n.EASING_QUARTIC_IN="EASING_QUARTIC_IN",n.EASING_QUARTIC_OUT="EASING_QUARTIC_OUT",n.EASING_QUARTIC_INOUT="EASING_QUARTIC_INOUT",n.EASING_QUADRATIC_IN="EASING_QUADRATIC_IN",n.EASING_QUADRATIC_OUT="EASING_QUADRATIC_OUT",n.EASING_QUADRATIC_INOUT="EASING_QUADRATIC_INOUT"}(a.TIMINGFUNCTION||(a.TIMINGFUNCTION={}));const B={ELN:D.Easing.Linear.None,EQI:D.Easing.Quartic.In,EQO:D.Easing.Quartic.Out,EASING_LINEAR_NONE:D.Easing.Linear.None,EASING_QUARTIC_IN:D.Easing.Quartic.In,EASING_QUARTIC_OUT:D.Easing.Quartic.Out,EASING_QUARTIC_INOUT:D.Easing.Quartic.InOut,EASING_QUADRATIC_IN:D.Easing.Quadratic.In,EASING_QUADRATIC_OUT:D.Easing.Quadratic.Out,EASING_QUADRATIC_INOUT:D.Easing.Quadratic.InOut},Do={name:"moveTo",params:{target:"",position:{x:0,y:0,z:0},delay:0,duration:1e3,timingFunction:a.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},Fo=function(n,e){const t=e.params,r=n.compilerManager.getObjectBySymbol(t.target);if(!r)return console.warn(`real time animation moveTO: can not found vid object: ${t.target}`),()=>{};const i=n.renderManager,o=n.dataSupportManager.getConfigBySymbol(t.target);if(!o)return console.warn(`can not found object config: ${t.target}`),()=>{};let c=!1;return()=>{if(c)return;c=!0;const u=new D.Tween(r.position).to(t.position).duration(t.duration).delay(t.delay).easing(B[t.timingFunction]).start(),d=p=>{u.update()};i.addEventListener("render",d),u.onComplete(()=>{i.removeEventListener("render",d),o.position.x=t.position.x,o.position.y=t.position.y,o.position.z=t.position.z,c=!1})}},xo={name:"rotationTo",params:{target:"",rotation:{x:0,y:0,z:0},delay:0,duration:1e3,timingFunction:a.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},Uo=function(n,e){const t=e.params,r=n.compilerManager.getObjectBySymbol(t.target);if(!r)return console.warn(`real time animation moveTO: can not found vid object: ${t.target}`),()=>{};const i=n.renderManager,o=n.dataSupportManager.getConfigBySymbol(t.target);if(!o)return console.warn(`can not found object config: ${t.target}`),()=>{};let c=!1;return()=>{if(c)return;c=!0;const u=new D.Tween(r.rotation).to(t.rotation).duration(t.duration).delay(t.delay).easing(B[t.timingFunction]).start(),d=p=>{u.update()};i.addEventListener("render",d),u.onComplete(()=>{i.removeEventListener("render",d),o.rotation.x=t.rotation.x,o.rotation.y=t.rotation.y,o.rotation.z=t.rotation.z,c=!1})}},Bo={name:"upTo",params:{target:"",up:{x:0,y:1,z:0},delay:0,duration:1e3,timingFunction:a.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},jo=function(n,e){const t=e.params,r=n.compilerManager.getObjectBySymbol(t.target);if(!r)return console.warn(`real time animation upTo: can not found vid object: ${t.target}`),()=>{};const i=n.renderManager,o=n.dataSupportManager.getConfigBySymbol(t.target);if(!o)return console.warn(`can not found object config: ${t.target}`),()=>{};let c=!1;return()=>{if(c)return;c=!0;const u=new D.Tween(r.up).to(t.up).duration(t.duration).delay(t.delay).easing(B[t.timingFunction]).start(),d=p=>{u.update()};i.addEventListener("render",d),u.onComplete(()=>{i.removeEventListener("render",d),o.up.x=t.up.x,o.up.y=t.up.y,o.up.z=t.up.z,c=!1})}},Yo={name:"moveFromTo",params:{target:"",from:{x:0,y:0,z:0},to:{x:10,y:10,z:10},delay:0,duration:1e3,timingFunction:a.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},_o=function(n,e){const t=e.params,r=n.compilerManager.getObjectBySymbol(t.target);if(!r)return console.warn(`real time animation moveTO: can not found vid object: ${t.target}`),()=>{};const i=n.renderManager,o=n.dataSupportManager.getConfigBySymbol(t.target);if(!o)return console.warn(`can not found object config: ${t.target}`),()=>{};let c=!1;return()=>{if(c)return;c=!0,r.position.set(t.from.x,t.from.y,t.from.z),r.updateMatrix(),r.updateMatrixWorld();const u=new D.Tween(r.position).to(t.to).duration(t.duration).delay(t.delay).easing(B[t.timingFunction]).start(),d=p=>{u.update()};i.addEventListener("render",d),u.onComplete(()=>{i.removeEventListener("render",d),o.position.x=t.to.x,o.position.y=t.to.y,o.position.z=t.to.z,c=!1})}},Ho={name:"moveSpacing",params:{target:"",spacing:{x:10,y:10,z:10},delay:0,duration:1e3,timingFunction:a.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},ko=function(n,e){const t=e.params,s=n.getObjectBySymbol(t.target);if(!s)return console.warn(`can not found vid object: ${t.target}`),()=>{};if(!(s instanceof l.Object3D))return console.warn(`object is not instanceof Object3D: ${t.target}`),()=>{};const r=n.renderManager,i=n.getConfigBySymbol(t.target);let o=!1;return()=>{if(o)return;o=!0;const c={x:s.position.x+t.spacing.x,y:s.position.y+t.spacing.y,z:s.position.z+t.spacing.z},u=new D.Tween(s.position).to(c).duration(t.duration).delay(t.delay).easing(B[t.timingFunction]).start(),d=p=>{u.update()};r.addEventListener("render",d),u.onComplete(()=>{r.removeEventListener("render",d),i.position.x=c.x,i.position.y=c.y,i.position.z=c.z,o=!1})}},zo={name:"moveToObject",params:{target:"",to:"",offset:{x:0,y:0,z:0},delay:0,duration:1e3,timingFunction:a.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},Vo=function(n,e){const t=e.params,s=n.compilerManager,r=s.getObjectBySymbol(t.target),i=s.getObjectBySymbol(t.to);if(!r)return console.warn(`real time animation MoveToObject: can not found vid object: ${t.target}`),()=>{};if(!i)return console.warn(`real time animation MoveToObject: can not found vid object: ${t.target}`),()=>{};const o=n.renderManager,c=n.dataSupportManager.getConfigBySymbol(t.target);if(!c)return console.warn(`can not found object config: ${t.target}`),()=>{};let u=!1;return()=>{if(u)return;u=!0;const d={x:i.position.x+t.offset.x,y:i.position.y+t.offset.y,z:i.position.z+t.offset.z},p=new D.Tween(r.position).to(d).duration(t.duration).delay(t.delay).easing(B[t.timingFunction]).start(),f=g=>{p.update()};o.addEventListener("render",f),p.onComplete(()=>{o.removeEventListener("render",f),c.position.x=d.x,c.position.y=d.y,c.position.z=d.z,u=!1})}},Wo={name:"vector3To",params:{target:"",attribute:".position",props:{x:"x",y:"y",z:"z"},delay:0,duration:500,to:{},timingFunction:a.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},$o=function(n,e){var f,g,E;const t=e.params,s=n.compilerManager.getObjectBySymbol(t.target);if(!s)return console.warn(`real time animation vector3To: can not found vid object: ${t.target}`),()=>{};const r=n.renderManager;let i=n.dataSupportManager.getConfigBySymbol(t.target);if(!i)return console.warn(`real time animation vector3To: can not found object config: ${t.target}`),()=>{};const o=t.attribute.split(".");o.shift();let c=s;for(const T of o){if(c[T]===void 0)return console.error(`real time animation vector3To: object can not support key: ${T}`,s),()=>{};c=c[T],i=i[T]}const u=t.props;if(!(u.x in c)||!(u.y in c)||!(u.z in c))return console.error("real time animation vector3To: object can not support props:",c,u),()=>{};if(!(u.x in i)||!(u.y in i)||!(u.z in i))return console.error("real time animation vector3To: config can not support props:",i,u),()=>{};const d={x:(f=t.to.x)!=null?f:c[u.x],y:(g=t.to.y)!=null?g:c[u.y],z:(E=t.to.z)!=null?E:c[u.z]};let p=!1;return()=>{if(p)return;p=!0;const T=new D.Tween(c).to(d).duration(t.duration).delay(t.delay).easing(B[t.timingFunction]).start(),C=M=>{T.update()};r.addEventListener("render",C),T.onComplete(()=>{r.removeEventListener("render",C),i[u.x]=d.x,i[u.y]=d.y,i[u.z]=d.z,p=!1})}},Ko={name:"focusObject",params:{target:"",camera:"",space:"world",offset:{x:0,y:0,z:20},delay:0,duration:1e3,timingFunction:a.TIMINGFUNCTION.EASING_QUADRATIC_INOUT,back:!0}},Xo=function(n,e){const t=e.params,s=n.getObjectBySymbol(t.target),r=n.orbitControls.target;if(!s)return console.warn(`real time animation focusObject: can not found vid object: ${t.target}`),()=>{};if(!(s instanceof l.Object3D))return console.warn(`real time animation focusObject: vid object is not a class of THREE.Object3D: ${t.target}`),()=>{};let i=!1;const o=new l.Euler;return()=>{if(i)return;i=!0;let c=n.camera;t.camera&&(c=n.getObjectBySymbol(t.camera),c||(c=n.camera,console.warn(`real time animation focusObject: can not found camera config: ${t.camera}`)));const u=n.getObjectConfig(c),d=n.orbitControls&&n.orbitControls.object===c;u||console.warn("engine current camera can not found config.");const p=n.renderManager;let f={x:s.matrixWorld.elements[12]+t.offset.x,y:s.matrixWorld.elements[13]+t.offset.y,z:s.matrixWorld.elements[14]+t.offset.z};const g={x:c.position.x,y:c.position.y,z:c.position.z};if(t.space==="local"){const b=new l.Vector3(t.offset.x,t.offset.y,t.offset.z).applyEuler(o.setFromRotationMatrix(s.matrixWorld));f={x:s.matrixWorld.elements[12]+b.x,y:s.matrixWorld.elements[13]+b.y,z:s.matrixWorld.elements[14]+b.z}}const E=new D.Tween(c.position).to(f).duration(t.duration).delay(t.delay).easing(B[t.timingFunction]).start();let T;const C={x:c.up.x,y:c.up.y,z:c.up.z};if(t.space==="local"){const b=new l.Vector3(0,1,0).applyEuler(o.setFromRotationMatrix(s.matrixWorld));T=new D.Tween(c.up).to({x:b.x,y:b.y,z:b.z}).duration(t.duration).delay(t.delay).easing(B[t.timingFunction]).start()}let M;const y={x:r.x,y:r.y,z:r.z};d&&(M=new D.Tween(r).to({x:s.matrixWorld.elements[12],y:s.matrixWorld.elements[13],z:s.matrixWorld.elements[14]}).duration(t.duration).delay(t.delay).easing(B[t.timingFunction]).start());let O;d&&t.space==="local"?O=b=>{E.update(),T.update(),M.update()}:d?O=b=>{E.update(),M.update()}:t.space==="local"?O=b=>{E.update(),T.update()}:O=b=>{E.update()},p.addEventListener("render",O),E.onComplete(()=>{if(p.removeEventListener("render",O),u&&(u.position.x=f.x,u.position.y=f.y,u.position.z=f.z),i=!1,t.back){const b=()=>{const R=new D.Tween(c.position).to(g).duration(t.duration).delay(t.delay).easing(B[t.timingFunction]).start();let G;t.space==="local"&&(G=new D.Tween(c.up).to(C).duration(t.duration).delay(t.delay).easing(B[t.timingFunction]).start());let S;d&&(S=new D.Tween(r).to(y).duration(t.duration).delay(t.delay).easing(B[t.timingFunction]).start());const N=I=>{R.update(),G&&G.update(),S&&S.update()};R.onComplete(()=>{p.removeEventListener("render",N)}),p.addEventListener("render",N),document.removeEventListener("dblclick",b)};document.addEventListener("dblclick",b)}})}},Qo={name:"fadeObject",params:{target:"",direction:"out",delay:0,duration:300,timingFunction:a.TIMINGFUNCTION.EASING_QUADRATIC_INOUT,visible:!0}},qo=function(n,e){const t=e.params,s=n.getObjectBySymbol(t.target);if(!s)return console.warn(`real time animation fadeObject: can not found vid object: ${t.target}`),()=>{};const r=n.getObjectConfig(s);if(!r.material)return console.warn(`real time animation fadeObject: target can not support fade: ${t.target}`),()=>{};const i=[],o=[],c=Array.isArray(r.material)?[].concat(r.material):[r.material];for(const d of c){const p=n.getObjectBySymbol(d),f=n.getConfigBySymbol(d);if(!(p instanceof l.Material)){console.error(`real time animation fadeObject: object config material is not instanceof Material: ${d}`);continue}if(!f){console.error(`real time animation fadeObject: object config material can not found config: ${d}`);continue}i.push(p),o.push(f)}let u=!1;return()=>{if(u)return;u=!0;const d=n.renderManager;r.visible=!0,i.forEach((p,f,g)=>{p.visible=!0,p.transparent=!0,p.opacity=t.direction==="in"?0:1,p.needsUpdate=!0;const E=new D.Tween(p).to({opacity:t.direction==="in"?1:0}).duration(t.duration).delay(t.delay).easing(B[t.timingFunction]).start(),T=C=>{E.update()};d.addEventListener("render",T),E.onComplete(()=>{d.removeEventListener("render",T),t.direction==="out"&&t.visible?(o[f].visible=!1,r.visible=!1):t.direction==="in"&&t.visible&&(o[f].visible=!0,r.visible=!0),o[f].opacity=t.direction==="in"?1:0,u=!1})})}},Jo={name:"showToCamera",params:{target:"",offset:{x:0,y:0,z:-30},delay:0,duration:1e3,timingFunction:a.TIMINGFUNCTION.EASING_QUADRATIC_INOUT,back:!0}},Zo=function(n,e){const t=e.params,s=n.getObjectBySymbol(t.target),r=n.getConfigBySymbol(t.target),i=n.camera;if(!s)return console.warn(`real time animation showToCamera: can not found vid object: ${t.target}`),()=>{};if(!s)return console.warn(`real time animation showToCamera: can not found vid config: ${t.target}`),()=>{};if(!(s instanceof l.Object3D))return console.warn(`real time animation showToCamera: vid object is not a class of THREE.Object3D: ${t.target}`),()=>{};const o=new l.Matrix4,c=new l.Euler,u=new l.Vector3;let d=!1;return()=>{if(d)return;d=!0;const p=n.renderManager;u.set(t.offset.x,t.offset.y,t.offset.z).applyEuler(i.rotation),u.set(i.position.x+u.x,i.position.y+u.y,i.position.z+u.z),o.lookAt(i.position,u,i.up),c.setFromRotationMatrix(o);const f={x:s.position.x,y:s.position.y,z:s.position.z},g={x:s.rotation.x,y:s.rotation.y,z:s.rotation.z},E=new D.Tween(s.position).to({x:u.x,y:u.y,z:u.z}).duration(t.duration).delay(t.delay).easing(B[t.timingFunction]).start(),T=new D.Tween(s.rotation).to({x:c.x,y:c.y,z:c.z}).duration(t.duration).delay(t.delay).easing(B[t.timingFunction]).start(),C=M=>{E.update(),T.update()};p.addEventListener("render",C),E.onComplete(()=>{if(p.removeEventListener("render",C),r.position.x=u.x,r.position.y=u.y,r.position.z=u.z,r.rotation.x=c.x,r.rotation.y=c.y,r.rotation.z=c.z,d=!1,t.back){const M=()=>{const y=new D.Tween(s.position).to(f).duration(t.duration).delay(t.delay).easing(B[t.timingFunction]).start(),O=new D.Tween(s.rotation).to(g).duration(t.duration).delay(t.delay).easing(B[t.timingFunction]).start(),b=R=>{y.update(),O.update()};y.onComplete(()=>{p.removeEventListener("render",b),r.position.x=f.x,r.position.y=f.y,r.position.z=f.z,r.rotation.x=g.x,r.rotation.y=g.y,r.rotation.z=g.z}),p.addEventListener("render",b),document.removeEventListener("dblclick",M)};document.addEventListener("dblclick",M)}})}},ea={name:"colorChange",params:{target:"",attribute:"color",color:"rgb(255, 255, 255)",delay:0,duration:500,timingFunction:a.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},ta=function(n,e){const t=e.params,s=n.getObjectBySymbol(t.target);if(!s)return console.warn(`real time animation ColorChange: can not found vid material: ${t.target}`),()=>{};if(!s[t.attribute]||!(s[t.attribute]instanceof l.Color))return console.warn(`real time animation ColorChange: material attribute is illeage: ${t.attribute}`),()=>{};const r=n.getConfigBySymbol(t.target);if(!r)return console.warn(`real time animation ColorChange: can not found material config: ${t.target}`),()=>{};const i=new l.Color(t.color),o=n.renderManager;let c=!1;return()=>{if(c)return;c=!0;const u=new D.Tween(s[t.attribute]).to({r:i.r,g:i.g,b:i.b}).duration(t.duration).delay(t.delay).easing(B[t.timingFunction]).start(),d=p=>{u.update()};o.addEventListener("render",d),u.onComplete(()=>{o.removeEventListener("render",d),r[t.attribute]=t.color,c=!1})}},na={name:"orbitTargetMove",params:{target:"",offset:{x:0,y:0,z:0},delay:0,duration:1e3,timingFunction:a.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},sa=function(n,e){const t=e.params;if(n.compilerManager,!n.orbitControls)return console.warn("real time animation orbitTargetMove: engine can not install orbitControls."),()=>{};const s=n.renderManager;let r=!1;return()=>{if(r)return;r=!0;let i=t.offset;if(t.target){const u=n.getObjectBySymbol(t.target);u?i={x:u.matrixWorld.elements[12]+i.x,y:u.matrixWorld.elements[13]+i.y,z:u.matrixWorld.elements[14]+i.z}:console.warn(`real time animation orbitTargetMove: can not found vid object: ${t.target}`)}const o=new D.Tween(n.orbitControls.target).to(i).duration(t.duration).delay(t.delay).easing(B[t.timingFunction]).start(),c=u=>{o.update()};s.addEventListener("render",c),o.onComplete(()=>{s.removeEventListener("render",c),r=!1})}},ue=class{static generateConfig(e,t){if(!ue.configLibrary.has(e))return console.warn(`event library can not found config by name: ${e}`),{name:""};const s=(i,o)=>{for(const c in o)typeof o[c]=="object"&&o[c]!==null&&!Array.isArray(o[c])?s(i[c],o[c]):i[c]=o[c]},r=JSON.parse(JSON.stringify(ue.configLibrary.get(e)));return s(r,t),r}static generateEvent(e,t){return ue.generatorLibrary.has(e.name)?ue.generatorLibrary.get(e.name)(t,e):(console.error(`event library can not found generator by name: ${e.name}`),()=>{})}static has(e){return ue.configLibrary.has(e)}};let x=ue;h(x,"configLibrary",new Map),h(x,"generatorLibrary",new Map),h(x,"register",function(e,t){ue.configLibrary.has(e.name)&&console.warn(`EventLibrary has already exist this event generator: ${e.name}, that will be cover.`),ue.configLibrary.set(e.name,JSON.parse(JSON.stringify(e))),ue.generatorLibrary.set(e.name,t)}),x.register(Co,Oo),x.register(bo,Ro),x.register(Lo,wo),x.register(Po,Ao),x.register(Io,vo),x.register(No,Go),x.register(Do,Fo),x.register(xo,Uo),x.register(Bo,jo),x.register(Yo,_o),x.register(Ho,ko),x.register(zo,Vo),x.register(Wo,$o),x.register(Ko,Xo),x.register(Qo,qo),x.register(Jo,Zo),x.register(ea,ta),x.register(na,sa);const Zn=new WeakMap,es=function({target:n,config:e,value:t,engine:s}){if(e.vid===t){console.warn("can not set object lookAt itself.");return}let r=Zn.get(n);if(r||(r={lookAtTarget:null,updateMatrixWorldFun:null},Zn.set(n,r)),!t){if(!r.updateMatrixWorldFun)return;n.updateMatrixWorld=r.updateMatrixWorldFun,r.lookAtTarget=null,r.updateMatrixWorldFun=null;return}const i=s.compilerManager.getObject3D(t);if(!i){console.warn(`lookAt handler can not found this vid mapping object: '${t}'`);return}const o=n.updateMatrixWorld;r.updateMatrixWorldFun=o,r.lookAtTarget=i.position,n.updateMatrixWorld=c=>{o.call(n,c),n.lookAt(r.lookAtTarget)}},rt="vis.event",ye=function({target:n,path:e,value:t,engine:s}){const r=e[0];if(!x.has(t.name)){console.warn(`EventLibrary: can not support this event: ${t.name}`);return}const i=x.generateEvent(t,s),o=Symbol.for(rt);t[o]=i,n.addEventListener(r,i)},we=function({target:n,path:e,value:t}){const s=e[0],r=t[Symbol.for(rt)];if(!r){console.warn("event remove can not fun found event in config",t);return}n.removeEventListener(s,r),delete t[Symbol.for(rt)]},Pe=function({target:n,config:e,path:t,engine:s}){const r=t[0],i=e[t[0]][t[1]],o=i[Symbol.for(rt)];if(!o){console.warn("event remove can not fun found event in config",i);return}n.removeEventListener(r,o);const c=x.generateEvent(i,s);i[Symbol.for(rt)]=c,n.addEventListener(r,c)},Ht=function({target:n,config:e,value:t,engine:s}){const r=s.getConfigBySymbol(t);if(!r){console.warn(` can not foud object config in engine: ${t}`);return}if(r.parent&&r.parent!==e.vid){const o=s.getConfigBySymbol(r.parent);if(!o){console.warn(` can not foud object parent config in engine: ${r.parent}`);return}o.children.splice(o.children.indexOf(t),1)}r.parent=e.vid;const i=s.compilerManager.getObject3D(t);if(!i){console.warn(`can not found this vid in engine: ${t}.`);return}n.add(i)},ra=function({target:n,config:e,value:t,engine:s}){const r=s.compilerManager.getObject3D(t);if(!r){console.warn(`can not found this vid in engine: ${t}.`);return}n.remove(r);const i=s.getConfigBySymbol(t);if(!i){console.warn(`can not found this vid in engine: ${t}.`);return}i.parent=""},ie=function(n,e,t,s){return Promise.resolve().then(()=>{!t.lookAt&&es({target:n,config:e,engine:s,value:e.lookAt}),e.children.forEach(i=>{Ht({target:n,config:e,value:i,engine:s})});for(const i of Object.values(a.EVENTNAME))e[i].forEach((o,c)=>{ye({target:n,path:[i,c.toString()],value:o,engine:s})})}),k(e,n,j({vid:!0,type:!0,lookAt:!0,parent:!0,children:!0,pointerdown:!0,pointermove:!0,pointerup:!0,pointerenter:!0,pointerleave:!0,click:!0,dblclick:!0,contextmenu:!0},t)),n},q=function(n){n._listener={}},U={add:{pointerdown:ye,pointerup:ye,pointermove:ye,pointerenter:ye,pointerleave:ye,click:ye,dblclick:ye,contextmenu:ye,children:Ht},set:{lookAt:es,pointerdown:Pe,pointerup:Pe,pointermove:Pe,pointerenter:Pe,pointerleave:Pe,click:Pe,dblclick:Pe,contextmenu:Pe,parent:mt,children:{$reg:[{reg:new RegExp(".*"),handler:Ht}]}},delete:{pointerdown:we,pointerup:we,pointermove:we,pointerenter:we,pointerleave:we,click:we,dblclick:we,contextmenu:we,children:ra}};A({configType:a.CONFIGTYPE.OBJECT3D,commands:U,create(n,e){return ie(new l.Object3D,n,{},e)},dispose:q});const te=new WeakMap;var ia=A({configType:a.CONFIGTYPE.PERSPECTIVECAMERA,commands:{add:j({scale(){}},U.add),set:at(j({scale(){},adaptiveWindow({target:n,value:e,engine:t}){if(e){if(!te.has(e)){const s=r=>{n.aspect=r.width/r.height,n.updateProjectionMatrix()};te.set(n,s),t.addEventListener("setSize",s),s({type:"setSize",width:t.dom.offsetWidth,height:t.dom.offsetHeight})}}else{const s=te.get(n);s&&(t.removeEventListener("setSize",s),te.delete(n))}}},U.set),{$reg:[{reg:new RegExp("fov|aspect|near|far"),handler({target:n,key:e,value:t}){n[e]=t,n.updateProjectionMatrix()}}]}),delete:j({scale(){}},U.delete)},create(n,e){const t=new l.PerspectiveCamera;if(ie(t,n,{scale:!0,adaptiveWindow:!0},e),t.updateProjectionMatrix(),n.adaptiveWindow){const s=r=>{t.aspect=r.width/r.height,t.updateProjectionMatrix()};te.set(t,s),e.addEventListener("setSize",s),s({type:"setSize",width:e.dom.offsetWidth,height:e.dom.offsetHeight})}return t},dispose(n){te.delete(n),q(n)}}),oa=A({configType:a.CONFIGTYPE.ORTHOGRAPHICCAMERA,commands:{add:j({scale(){}},U.add),set:at(j({scale(){},adaptiveWindow({target:n,value:e,engine:t}){if(e){if(!te.has(e)){const s=r=>{const i=r.width,o=r.height;n.left=-i,n.right=i,n.top=o,n.bottom=-o,n.updateProjectionMatrix()};te.set(n,s),t.addEventListener("setSize",s),s({type:"setSize",width:t.dom.offsetWidth,height:t.dom.offsetHeight})}}else{const s=te.get(n);s&&(t.removeEventListener("setSize",s),te.delete(n))}}},U.set),{$reg:[{reg:new RegExp("left|right|top|bottom|near|far|zoom"),handler({target:n,key:e,value:t}){n[e]=t,n.updateProjectionMatrix()}}]}),delete:j({scale(){}},U.delete)},create(n,e){const t=new l.OrthographicCamera(-50,50,50,-50);if(ie(t,n,{scale:!0,adaptiveWindow:!0},e),t.updateProjectionMatrix(),n.adaptiveWindow){const s=r=>{const i=r.width,o=r.height;t.left=-i,t.right=i,t.top=o,t.bottom=-o,t.updateProjectionMatrix()};te.set(t,s),e.addEventListener("setSize",s),s({type:"setSize",width:e.dom.offsetWidth,height:e.dom.offsetHeight})}return t},dispose(n){te.delete(n),q(n)}});class aa extends Le{constructor(){super();h(this,"MODULE",a.MODULETYPE.CAMERA)}}L.processor(ia),L.processor(oa);var ca=A({configType:a.CONFIGTYPE.ORBITCONTROLS,commands:{set:{target({target:n,config:e,path:t,key:s,value:r}){const i=e.target;if(!e.type){e.target=new l.Vector3(0,0,0);return}typeof e.target=="string"||(t.length>1?n.target[s]=r:n.target=new l.Vector3(i.x,i.y,i.z))}}},create(n,e){let t;return e.orbitControls?t=e.orbitControls:(t=new pn,t.setCamera(e.camera),t.setDom(e.dom)),n.target&&(typeof n.target=="string"||(t.target=new l.Vector3(n.target.x,n.target.y,n.target.z))),k(n,t,{target:!0}),t},dispose(n){n.dispose()}}),la=A({configType:a.CONFIGTYPE.TRNASFORMCONTROLS,commands:{set:{snapAllow({target:n,config:e,value:t}){t?(n.translationSnap=e.translationSnap,n.rotationSnap=e.rotationSnap,n.scaleSnap=e.scaleSnap):(n.translationSnap=null,n.rotationSnap=null,n.scaleSnap=null)},translationSnap({target:n,config:e,value:t}){e.snapAllow&&(n.translationSnap=t)},rotationSnap({target:n,config:e,value:t}){e.snapAllow&&(n.rotationSnap=t)},scaleSnap({target:n,config:e,value:t}){e.snapAllow&&(n.scaleSnap=t)}}},create(n,e){let t;return e.transformControls?t=e.transformControls:(t=new mn,t.setCamera(e.camera),t.setDom(e.dom)),n.snapAllow&&(t.translationSnap=n.translationSnap,t.rotationSnap=n.rotationSnap,t.scaleSnap=n.scaleSnap),t},dispose(n){n.dispose()}});class ua extends L{constructor(){super();h(this,"MODULE",a.MODULETYPE.CONTROLS)}useEngine(e){return e.transformControls&&(this.map.set(a.CONFIGTYPE.TRNASFORMCONTROLS,e.transformControls),this.weakMap.set(e.transformControls,a.CONFIGTYPE.TRNASFORMCONTROLS)),e.orbitControls&&(this.map.set(a.CONFIGTYPE.ORBITCONTROLS,e.orbitControls),this.weakMap.set(e.orbitControls,a.CONFIGTYPE.ORBITCONTROLS)),super.useEngine(e)}}L.processor(ca),L.processor(la);const $e=function(n,e){const t=e.resourceManager.resourceMap;if(!t.has(n))return console.warn(`css3D compiler: can not found resource element: ${n}`),document.createElement("div");const s=t.get(n);return s instanceof HTMLElement?s:(console.warn("css3D compiler can not suport render this resource type.",s.constructor,n),document.createElement("div"))};var da=A({configType:a.CONFIGTYPE.CSS3DOBJECT,commands:{add:U.add,set:j({element({target:n,value:e,engine:t}){n.element=$e(e,t)}},U.set),delete:U.delete},create(n,e){return ie(new Oe.CSS3DObject($e(n.element,e)),n,{element:!0},e)},dispose:q});class ha extends Oe.CSS3DObject{constructor(e=document.createElement("div")){const t=document.createElement("div"),s=50,r=50;t.style.width=`${s}px`,t.style.height=`${r}px`,t.appendChild(e);super(t);h(this,"geometry");h(this,"_width");h(this,"_height");this.geometry=new l.PlaneBufferGeometry(s,r),this.geometry.computeBoundingBox(),this._width=s,this._height=r}get width(){return this._width}set width(e){this.geometry.dispose(),this.geometry=new l.PlaneBufferGeometry(e,this._height),this.geometry.computeBoundingBox(),this.element.style.width=`${e}px`,this._width=e}get height(){return this._height}set height(e){this.geometry.dispose(),this.geometry=new l.PlaneBufferGeometry(this._width,e),this.geometry.computeBoundingBox(),this.element.style.height=`${e}px`,this._height=e}}class ts extends ha{constructor(e=document.createElement("div")){super(e);h(this,"cacheBox",new l.Box3);this.type="CSS3DPlane",this.element.classList.add("vis-css3d","vis-css3d-plane")}raycast(e,t){const s=this.cacheBox.copy(this.geometry.boundingBox);s.applyMatrix4(this.matrixWorld),e.ray.intersectsBox(s)&&t.push({distance:e.ray.origin.distanceTo(this.position),object:this,point:this.position})}}var pa=A({configType:a.CONFIGTYPE.CSS3DPLANE,commands:{add:U.add,set:j({element({target:n,value:e,engine:t}){n.element.innerHTML="",n.element.appendChild($e(e,t))}},U.set),delete:U.delete},create(n,e){return ie(new ts($e(n.element,e)),n,{element:!0},e)},dispose:q});class fa extends Oe.CSS3DSprite{constructor(e=document.createElement("div")){const t=document.createElement("div"),s=50,r=50;t.style.width=`${s}px`,t.style.height=`${r}px`,t.appendChild(e),e.classList.add("vis-css3d","vis-css3d-sprite");super(t);h(this,"geometry");h(this,"_width");h(this,"_height");h(this,"cacheBox",new l.Box3);h(this,"cachePosition",new l.Vector3);h(this,"cacheQuaternion",new l.Quaternion);h(this,"cacheScale",new l.Vector3);h(this,"cacheMatrix4",new l.Matrix4);h(this,"rotateMatrix4",new l.Matrix4);this.geometry=new l.PlaneBufferGeometry(s,r),this.geometry.computeBoundingBox(),this._width=s,this._height=r,this.type="CSS3DSprite"}get width(){return this._width}set width(e){this.geometry.dispose(),this.geometry=new l.PlaneBufferGeometry(e,this._height),this.geometry.computeBoundingBox(),this.element.style.width=`${e}px`,this._width=e}get height(){return this._height}set height(e){this.geometry.dispose(),this.geometry=new l.PlaneBufferGeometry(this._width,e),this.geometry.computeBoundingBox(),this.element.style.height=`${e}px`,this._height=e}raycast(e,t){const s=this.cacheBox.copy(this.geometry.boundingBox);this.matrixWorld.decompose(this.cachePosition,this.cacheQuaternion,this.cacheScale);const r=this.rotateMatrix4.lookAt(this.position,e.camera.position,this.up);this.cacheQuaternion.setFromRotationMatrix(r),this.cacheMatrix4.compose(this.cachePosition,this.cacheQuaternion,this.cacheScale),s.applyMatrix4(this.cacheMatrix4),e.ray.intersectsBox(s)&&t.push({distance:e.ray.origin.distanceTo(this.position),object:this,point:this.position})}}var ma=A({configType:a.CONFIGTYPE.CSS3DSPRITE,commands:{add:U.add,set:j({element({target:n,value:e,engine:t}){n.element.innerHTML="",n.element.appendChild($e(e,t))}},U.set),delete:U.delete},create(n,e){return ie(new fa($e(n.element,e)),n,{element:!0},e)},dispose:q});class ga extends Le{constructor(){super();h(this,"MODULE",a.MODULETYPE.CSS3D)}}L.processor(pa),L.processor(da),L.processor(ma);class Ke extends l.BufferGeometry{constructor(e=[],t=36,s=!0){super();h(this,"parameters");this.type="CurveGeometry",this.parameters={path:e.map(r=>r.clone()),space:s,divisions:t}}}class Ea extends Ke{constructor(e=[],t=36,s=!0){super(e,t,s);this.type="QuadraticBezierCurveGeometry";const r=new l.CurvePath;if(e.length<3){console.warn("QuadraticBezierCurveGeometry path length at least 3.");return}const i=3+(e.length-3)-(e.length-3)%2;for(let c=1;c<i;c+=2)r.add(new l.QuadraticBezierCurve3(e[c-1],e[c],e[c+1]));const o=r.curves.reduce((c,u)=>c+=u.arcLengthDivisions,0);if(t>o){const c=Math.ceil((t-o)/r.curves.length);r.curves.forEach(u=>{u.arcLengthDivisions=u.arcLengthDivisions*(c+1),u.updateArcLengths()})}this.setFromPoints(s?r.getSpacedPoints(t):r.getPoints(t))}}class Ta extends Ke{constructor(e=[],t=36,s=!0){super(e,t,s);this.type="CubicBezierCurveGeometry";const r=new l.CurvePath;if(e.length<4){console.warn("CubicBezierCurveGeometry path length at least 4.");return}const i=4+(e.length-4)-(e.length-4)%3;for(let c=2;c<i;c+=3)r.add(new l.CubicBezierCurve3(e[c-2],e[c-1],e[c],e[c+1]));const o=r.curves.reduce((c,u)=>c+=u.arcLengthDivisions,0);if(t>o){const c=Math.ceil((t-o)/r.curves.length);r.curves.forEach(u=>{u.arcLengthDivisions=u.arcLengthDivisions*(c+1),u.updateArcLengths()})}this.setFromPoints(s?r.getSpacedPoints(t):r.getPoints(t))}}class ya extends Ke{constructor(e=[],t=36,s=!0){super(e,t,s);if(this.type="LineCurveGeometry",!e.length){console.warn("LineCurveGeometry path length at least 1.");return}const r=new l.CurvePath;for(let o=1;o<e.length;o+=1)r.add(new l.LineCurve3(e[o-1],e[o]));const i=r.curves.reduce((o,c)=>o+=c.arcLengthDivisions,0);if(t>i){const o=Math.ceil((t-i)/r.curves.length);r.curves.forEach(c=>{c.arcLengthDivisions=c.arcLengthDivisions*(o+1),c.updateArcLengths()})}this.setFromPoints(s?r.getSpacedPoints(t):r.getPoints(t))}}class Ma extends Ke{constructor(e=[],t=36,s=!0){super(e,t,s);if(this.type="SplineCurveGeometry",!e.length){console.warn("SplineCurveGeometry path length at least 1.");return}const r=new l.CatmullRomCurve3(e);this.setFromPoints(s?r.getSpacedPoints(t):r.getPoints(t))}}class Sa extends l.TubeGeometry{constructor(e=[],t=64,s=1,r=8,i=!1){if(!e.length){console.warn("LineTubeGeometry path length at least 1.");return}const o=new l.CurvePath;for(let c=1;c<e.length;c+=1)o.add(new l.LineCurve3(e[c-1],e[c]));super(o,t,s,r,i);this.type="LineTubeGeometry"}}class Ca extends l.TubeGeometry{constructor(e=[],t=64,s=1,r=8,i=!1){if(!e.length){console.warn("SplineTubeGeometry path length at least 1.");return}const o=new l.CatmullRomCurve3(e);super(o,t,s,r,i);this.type="SplineTubeGeometry"}}class Oa extends l.ShapeBufferGeometry{constructor(e=[new l.Vector2(0,0)],t=12){const s=new l.Shape,r=e[0];if(r){s.moveTo(r.x,r.y);for(let i=1;i<e.length;i+=1)s.lineTo(e[i].x,e[i].y)}super(s,t);this.type="LineShapeGeometry"}}const ba=function(n,e){!(n instanceof Ke)&&!(n instanceof l.TubeGeometry)&&!(n instanceof l.ShapeGeometry)&&n.center(),n.computeBoundingBox();const t=n.boundingBox,s=e.position,r=e.rotation,i=e.scale,o=new l.Quaternion().setFromEuler(new l.Euler(r.x,r.y,r.z,"XYZ"));return n.applyQuaternion(o),n.scale(i.x,i.y,i.z),!(n instanceof Ke)&&!(n instanceof l.TubeGeometry)&&!(n instanceof l.ShapeGeometry)&&n.center(),n.computeBoundingBox(),n.translate((t.max.x-t.min.x)/2*s.x,(t.max.y-t.min.y)/2*s.y,(t.max.z-t.min.z)/2*s.z),n},kt={reg:new RegExp(".*"),handler({config:n,target:e,processor:t,engine:s}){const r=t.create(n,s);e.copy(r),e.dispatchEvent({type:"update"}),e.uuid=r.uuid,r.dispose()}},gt={add:{groups({target:n,value:e}){n.addGroup(e.start,e.count,e.materialIndex)},$reg:[kt]},set:{groups(n){const{path:e,target:t,config:s}=n;if(e[1]!==void 0){t.groups.splice(Number(n.path[1]),1);const r=s.groups[e[1]];t.addGroup(r.start,r.count,r.materialIndex)}else console.warn("geometry processor can not set group",n)},$reg:[kt]},delete:{groups({target:n,key:e}){n.groups.splice(Number(e),1)},$reg:[kt]}},Et=function(n,e){n.clearGroups();for(const t of e.groups)n.addGroup(t.start,t.count,t.materialIndex);return ba(n,e)},H=new Map;H.set(a.CONFIGTYPE.BOXGEOMETRY,n=>new l.BoxBufferGeometry(n.width,n.height,n.depth,n.widthSegments,n.heightSegments,n.depthSegments)),H.set(a.CONFIGTYPE.SPHEREGEOMETRY,n=>new l.SphereBufferGeometry(n.radius,n.widthSegments,n.heightSegments,n.phiStart,n.phiLength,n.thetaStart,n.thetaLength)),H.set(a.CONFIGTYPE.PLANEGEOMETRY,n=>new l.PlaneBufferGeometry(n.width,n.height,n.widthSegments,n.heightSegments)),H.set(a.CONFIGTYPE.CIRCLEGEOMETRY,n=>new l.CircleBufferGeometry(n.radius,n.segments,n.thetaStart,n.thetaLength)),H.set(a.CONFIGTYPE.CONEGEOMETRY,n=>new l.ConeBufferGeometry(n.radius,n.height,n.radialSegments,n.heightSegments,n.openEnded,n.thetaStart,n.thetaLength)),H.set(a.CONFIGTYPE.CYLINDERGEOMETRY,n=>new l.CylinderBufferGeometry(n.radiusTop,n.radiusBottom,n.height,n.radialSegments,n.heightSegments,n.openEnded,n.thetaStart,n.thetaLength)),H.set(a.CONFIGTYPE.LINECURVEGEOMETRY,n=>new ya(n.path.map(e=>new l.Vector3(e.x,e.y,e.z)),n.divisions,n.space)),H.set(a.CONFIGTYPE.SPLINECURVEGEOMETRY,n=>new Ma(n.path.map(e=>new l.Vector3(e.x,e.y,e.z)),n.divisions,n.space)),H.set(a.CONFIGTYPE.CUBICBEZIERCURVEGEOMETRY,n=>new Ta(n.path.map(e=>new l.Vector3(e.x,e.y,e.z)),n.divisions,n.space)),H.set(a.CONFIGTYPE.QUADRATICBEZIERCURVEGEOMETRY,n=>new Ea(n.path.map(e=>new l.Vector3(e.x,e.y,e.z)),n.divisions,n.space)),H.set(a.CONFIGTYPE.LINETUBEGEOMETRY,n=>new Sa(n.path.map(e=>new l.Vector3(e.x,e.y,e.z)),n.tubularSegments,n.radius,n.radialSegments,n.closed)),H.set(a.CONFIGTYPE.SPLINETUBEGEOMETRY,n=>new Ca(n.path.map(e=>new l.Vector3(e.x,e.y,e.z)),n.tubularSegments,n.radius,n.radialSegments,n.closed)),H.set(a.CONFIGTYPE.TORUSGEOMETRY,n=>new l.TorusGeometry(n.radius,n.tube,n.radialSegments,n.tubularSegments,n.arc)),H.set(a.CONFIGTYPE.RINGGEOMETRY,n=>new l.RingBufferGeometry(n.innerRadius,n.outerRadius,n.thetaSegments,n.phiSegments,n.thetaStart,n.thetaLength)),H.set(a.CONFIGTYPE.LINESHAPEGEOMETRY,n=>new Oa(n.path.map(e=>new l.Vector2(e.x,e.y)),n.curveSegments));const Ra=function(n){return H.has(n.type)?Et(H.get(n.type)(n),n):(console.error(`parametric geometry can not support this type config: ${n.type}`),new l.BufferGeometry)},La=function(n){n.dispose()},wa=function(n){return A({configType:n,commands:gt,create:Ra,dispose:La})},Pa=[a.CONFIGTYPE.BOXGEOMETRY,a.CONFIGTYPE.SPHEREGEOMETRY,a.CONFIGTYPE.PLANEGEOMETRY,a.CONFIGTYPE.CIRCLEGEOMETRY,a.CONFIGTYPE.CONEGEOMETRY,a.CONFIGTYPE.CYLINDERGEOMETRY,a.CONFIGTYPE.LINECURVEGEOMETRY,a.CONFIGTYPE.SPLINECURVEGEOMETRY,a.CONFIGTYPE.CUBICBEZIERCURVEGEOMETRY,a.CONFIGTYPE.QUADRATICBEZIERCURVEGEOMETRY,a.CONFIGTYPE.LINETUBEGEOMETRY,a.CONFIGTYPE.SPLINETUBEGEOMETRY,a.CONFIGTYPE.TORUSGEOMETRY,a.CONFIGTYPE.RINGGEOMETRY,a.CONFIGTYPE.LINESHAPEGEOMETRY].map(n=>wa(n));class Aa extends l.BufferGeometry{constructor(e){super();h(this,"type","LoadBufferGeometry");e&&this.copy(e)}}var Ia=A({configType:a.CONFIGTYPE.LOADGEOMETRY,commands:gt,create(n,e){const t=e.resourceManager.resourceMap.get(n.url);return!t&&!(t instanceof l.BufferGeometry)?(console.error(`engine rescoure can not found url: ${n.url}`),new l.BoxBufferGeometry(5,5,5)):Et(new Aa(t),n)},dispose(n){n.dispose()}});const va=function(n){const e=new l.BufferGeometry;return n.position.length&&e.setAttribute("position",new l.Float32BufferAttribute(n.position,3)),n.color.length&&e.setAttribute("color",new l.Float32BufferAttribute(n.color,3)),n.normal.length&&e.setAttribute("normal",new l.Float32BufferAttribute(n.normal,3)),n.uv.length&&e.setAttribute("uv",new l.Float32BufferAttribute(n.uv,2)),n.uv2.length&&e.setAttribute("uv2",new l.Float32BufferAttribute(n.uv2,2)),n.index.length&&e.setIndex(n.index),e};var Na=A({configType:a.CONFIGTYPE.CUSTOMGEOMETRY,commands:gt,create(n){return Et(va(n.attribute),n)},dispose(n){n.dispose()}}),Ga=A({configType:a.CONFIGTYPE.EDGESGEOMETRY,commands:gt,create(n,e){const t=e.compilerManager.getObjectBySymbol(n.url);return!t||!(t instanceof l.BufferGeometry)?(console.error(`engine rescoure can not found url: ${n.url}`),new l.EdgesGeometry(new l.BoxBufferGeometry(5,5,5))):Et(new l.EdgesGeometry(t),n)},dispose(n){n.dispose()}});class Da extends L{constructor(){super();h(this,"MODULE",a.MODULETYPE.GEOMETRY)}}Pa.forEach(n=>{L.processor(n)}),L.processor(Ia),L.processor(Na),L.processor(Ga);var Fa=A({configType:a.CONFIGTYPE.GROUP,commands:U,create(n,e){return ie(new l.Group,n,{},e)},dispose:q});class xa extends Le{constructor(){super();h(this,"MODULE",a.MODULETYPE.GROUP)}}L.processor(Fa);const Ua=function({target:n,value:e}){n.color.copy(new l.Color(e))},Tt=function(n,e,t,s){return n.color.copy(new l.Color(e.color)),ie(n,e,j({color:!0,scale:!0,rotation:!0,lookAt:!0},t),s)},yt=Object.assign({},U,{set:{color:Ua,scale:mt,rotation:mt,lookAt:mt}});var Ba=A({configType:a.CONFIGTYPE.AMBIENTLIGHT,commands:yt,create(n,e){return Tt(new l.AmbientLight,n,{},e)},dispose:q}),ja=A({configType:a.CONFIGTYPE.DIRECTIONALLIGHT,commands:yt,create(n,e){return Tt(new l.DirectionalLight,n,{},e)},dispose:q}),Ya=A({configType:a.CONFIGTYPE.POINTLIGHT,commands:yt,create(n,e){return Tt(new l.PointLight,n,{},e)},dispose:q}),_a=A({configType:a.CONFIGTYPE.SPOTLIGHT,commands:yt,create(n,e){return Tt(new l.SpotLight,n,{},e)},dispose:q});class Ha extends Le{constructor(){super();h(this,"MODULE",a.MODULETYPE.LIGHT)}}L.processor(Ba),L.processor(ja),L.processor(Ya),L.processor(_a);class Mt extends Le{constructor(){super()}}const St=new l.ShaderMaterial({fragmentShader:`
  void main () {
    gl_FragColor = vec4(0.5, 0.5, 0.5, 1.0);
  }
  `}),ns=new l.BoxBufferGeometry(10,10,10),ka=function({target:n,value:e,engine:t}){const s=t.compilerManager.getGeometry(e);if(!s){console.warn(`can not found geometry by vid in engine: ${e}`),n.geometry=ns;return}n.geometry=s},zt=function({target:n,config:e,engine:t}){let s;typeof e.material=="string"?s=t.compilerManager.getMaterial(e.material)||St:s=e.material.map(r=>t.compilerManager.getMaterial(r)||St),n.material=s},Ct=function(n,e,t,s){if(!t.geometry){let r=s.getObjectBySymbol(e.geometry);r instanceof l.BufferGeometry||(console.warn(`geometry vid in engine is not instance of BufferGeometry: ${e.geometry}`,r),r=ns),n.geometry.dispose(),n.geometry=r}if(!t.material){let r;typeof e.material=="string"?r=s.compilerManager.getMaterial(e.material)||St:r=e.material.map(i=>s.compilerManager.getMaterial(i)||St),n.material=r}return ie(n,e,j({geometry:!0,material:!0},t),s)},Ot=function(n){q(n)},Xe={add:j({material:zt},U.add),set:j({geometry:ka,material:zt},U.set),delete:j({material:zt},U.delete)};var za=A({configType:a.CONFIGTYPE.LINE,commands:Xe,create(n,e){return Ct(new l.Line,n,{},e)},dispose:Ot});class Va extends Mt{constructor(){super();h(this,"MODULE",a.MODULETYPE.LINE)}}L.processor(za);const Ae={reg:new RegExp("transparent|sizeAttenuation"),handler({target:n,key:e,value:t}){n[e]=t,n.needsUpdate=!0}},je={reg:new RegExp("map$","i"),handler({target:n,key:e,value:t,engine:s}){const r=s.compilerManager.getObjectBySymbol(t);r instanceof l.Texture||console.warn(`this url resource is not instance of Texture: ${e}`,t,r),n[e]=r,n.needsUpdate=!0}},J=function({target:n,key:e,value:t}){n[e].copy(new l.Color(t))},Ye=function(n,e,t){const s={};for(const r of Object.keys(e))if(r.toLocaleLowerCase().endsWith("map")&&e[r]){const i=t.compilerManager.getObjectBySymbol(e[r]);if(!(i instanceof l.Texture)){console.warn(`this url resource is not instance of Texture: ${r}`,e[r],i);continue}n[r]=i,s[r]=!0}else n[r]instanceof l.Color&&(n[r]=new l.Color(e[r]),s[r]=!0);return k(e,n,s),n.needsUpdate=!0,n},Ie=function(n){n.dispose()};var ss=A({configType:a.CONFIGTYPE.LINEBASICMATERIAL,commands:{set:{color:J,$reg:[je,Ae]}},create:function(n,e){return Ye(new l.LineBasicMaterial,n,e)},dispose:Ie}),Wa=A({configType:a.CONFIGTYPE.MESHBASICMATERIAL,commands:{set:{color:J,$reg:[je,Ae]}},create:function(n,e){return Ye(new l.MeshBasicMaterial,n,e)},dispose:Ie}),$a=A({configType:a.CONFIGTYPE.MESHPHONGMATERIAL,commands:{set:{color:J,emissive:J,specular:J,$reg:[je,Ae]}},create:function(n,e){return Ye(new l.MeshPhongMaterial,n,e)},dispose:Ie}),Ka=A({configType:a.CONFIGTYPE.MESHPHYSICALMATERIAL,commands:{set:{color:J,emissive:J,specularColor:J,sheenColor:J,attenuationColor:J,$reg:[je,Ae]}},create:function(n,e){return Ye(new l.MeshPhysicalMaterial,n,e)},dispose:Ie}),Xa=A({configType:a.CONFIGTYPE.MESHSTANDARDMATERIAL,commands:{set:{color:J,emissive:J,$reg:[je,Ae]}},create:function(n,e){return Ye(new l.MeshStandardMaterial,n,e)},dispose:Ie}),Qa=A({configType:a.CONFIGTYPE.POINTSMATERIAL,commands:{set:{color:J,$reg:[je,Ae]}},create:function(n,e){return Ye(new l.PointsMaterial,n,e)},dispose:Ie}),qa=A({configType:a.CONFIGTYPE.SHADERMATERIAL,commands:{set:{shader({target:n,value:e}){const t=ee.getShader(e);(t==null?void 0:t.vertexShader)&&(n.vertexShader=t.vertexShader),(t==null?void 0:t.fragmentShader)&&(n.fragmentShader=t.fragmentShader),(t==null?void 0:t.uniforms)&&(n.uniforms=t.uniforms),(t==null?void 0:t.defines)&&(n.defines=t.defines),n.needsUpdate=!0},$reg:[Ae]}},create:function(n,e){const t=new l.ShaderMaterial,s=ee.getShader(n.shader);return(s==null?void 0:s.vertexShader)&&(t.vertexShader=s.vertexShader),(s==null?void 0:s.fragmentShader)&&(t.fragmentShader=s.fragmentShader),(s==null?void 0:s.uniforms)&&(t.uniforms=s.uniforms),(s==null?void 0:s.defines)&&(t.defines=s.defines),k(n,t,{type:!0,shader:!0}),t.needsUpdate=!0,t},dispose:Ie}),Ja=A({configType:a.CONFIGTYPE.SPRITEMATERIAL,commands:{set:{color:J,$reg:[je,Ae]}},create:function(n,e){return Ye(new l.SpriteMaterial,n,e)},dispose:Ie});class Za extends L{constructor(){super();h(this,"MODULE",a.MODULETYPE.MATERIAL)}}L.processor(Wa),L.processor(Xa),L.processor($a),L.processor(ss),L.processor(Qa),L.processor(Ja),L.processor(ss),L.processor(qa),L.processor(Ka);var ec=A({configType:a.CONFIGTYPE.MESH,commands:Xe,create(n,e){return Ct(new l.Mesh,n,{},e)},dispose:Ot});class tc extends Mt{constructor(){super();h(this,"MODULE",a.MODULETYPE.MESH)}}L.processor(ec);var nc=A({configType:a.CONFIGTYPE.OBJECT3D,commands:U,create(n,e){return ie(new l.Object3D,n,{},e)},dispose:q});class sc extends Le{constructor(){super();h(this,"MODULE",a.MODULETYPE.OBJECT3D)}}L.processor(nc);var rc=A({configType:a.CONFIGTYPE.SMAAPASS,create(n,e){const t=window.devicePixelRatio;return new As.SMAAPass(e.dom?e.dom.offsetWidth*t:window.innerWidth*t,e.dom?e.dom.offsetHeight*t:window.innerWidth*t)},dispose(n){}}),ic=A({configType:a.CONFIGTYPE.UNREALBLOOMPASS,create(n,e){const t=window.devicePixelRatio;return new Is.UnrealBloomPass(new l.Vector2(e.dom?e.dom.offsetWidth*t:window.innerWidth*t,e.dom?e.dom.offsetHeight*t:window.innerWidth*t),n.strength,n.radius,n.threshold)},dispose(n){n.dispose()}});const rs={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new l.Color(0)},defaultOpacity:{value:0}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform vec3 defaultColor;
		uniform float defaultOpacity;
		uniform float luminosityThreshold;
		uniform float smoothWidth;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );

			vec3 luma = vec3( 0.299, 0.587, 0.114 );

			float v = dot( texel.xyz, luma );

			vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );

			float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );

			gl_FragColor = mix( outputColor, texel, alpha );

		}`},wt=class extends un.Pass{constructor(e=new l.Vector2(256,256),t=1,s=0,r=0,i=new l.Scene,o=new l.PerspectiveCamera,c){super();h(this,"resolution");h(this,"strength");h(this,"radius");h(this,"threshold");h(this,"selectedObjects",[]);h(this,"renderScene");h(this,"renderCamera");h(this,"clearColor",new l.Color(0,0,0));h(this,"renderTargetsHorizontal",[]);h(this,"renderTargetsVertical",[]);h(this,"nMips",5);h(this,"selectRenderTarget");h(this,"renderTargetBright");h(this,"highPassUniforms");h(this,"materialHighPassFilter");h(this,"separableBlurMaterials",[]);h(this,"compositeMaterial");h(this,"bloomTintColors");h(this,"mixMaterial");h(this,"enabled",!0);h(this,"needsSwap",!1);h(this,"_oldClearColor",new l.Color);h(this,"oldClearAlpha",1);h(this,"basic",new l.MeshBasicMaterial);h(this,"fsQuad",new un.FullScreenQuad);h(this,"materialCache",new Map);h(this,"sceneBackgroundCache",null);h(this,"overrideBackground",new l.Color("black"));h(this,"overrideMeshMaterial",new l.MeshBasicMaterial({color:"black"}));h(this,"overrideLineMaterial",new l.LineBasicMaterial({color:"black"}));h(this,"overridePointsMaterial",new l.PointsMaterial({color:"black"}));h(this,"overrideSpriteMaterial",new l.SpriteMaterial({color:"black"}));this.resolution=e,this.strength=t,this.radius=s,this.threshold=r,this.renderScene=i,this.renderCamera=o,this.selectedObjects=c;let u=Math.round(this.resolution.x/2),d=Math.round(this.resolution.y/2);this.selectRenderTarget=new l.WebGLRenderTarget(u,d),this.selectRenderTarget.texture.name="UnrealBloomPass.selected",this.selectRenderTarget.texture.generateMipmaps=!1,this.renderTargetBright=new l.WebGLRenderTarget(u,d),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let E=0;E<this.nMips;E++){const T=new l.WebGLRenderTarget(u,d);T.texture.name="UnrealBloomPass.h"+E,T.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(T);const C=new l.WebGLRenderTarget(u,d);C.texture.name="UnrealBloomPass.v"+E,C.texture.generateMipmaps=!1,this.renderTargetsVertical.push(C),u=Math.round(u/2),d=Math.round(d/2)}rs===void 0&&console.error("THREE.UnrealBloomPass relies on LuminosityHighPassShader");const p=rs;this.highPassUniforms=l.UniformsUtils.clone(p.uniforms),this.highPassUniforms.luminosityThreshold.value=r,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new l.ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:p.vertexShader,fragmentShader:p.fragmentShader,defines:{}});const f=[3,5,7,9,11];u=Math.round(this.resolution.x/2),d=Math.round(this.resolution.y/2);for(let E=0;E<this.nMips;E++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(f[E])),this.separableBlurMaterials[E].uniforms.texSize.value=new l.Vector2(u,d),u=Math.round(u/2),d=Math.round(d/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;const g=[1,.8,.6,.4,.2];this.compositeMaterial.uniforms.bloomFactors.value=g,this.bloomTintColors=[new l.Vector3(1,1,1),new l.Vector3(1,1,1),new l.Vector3(1,1,1),new l.Vector3(1,1,1),new l.Vector3(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,this.mixMaterial=this.getMixMaterial()}dispose(){for(let e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose()}setSize(e,t){let s=Math.round(e/2),r=Math.round(t/2);this.selectRenderTarget.setSize(s,r),this.renderTargetBright.setSize(s,r);for(let i=0;i<this.nMips;i++)this.renderTargetsHorizontal[i].setSize(s,r),this.renderTargetsVertical[i].setSize(s,r),this.separableBlurMaterials[i].uniforms.texSize.value=new l.Vector2(s,r),s=Math.round(s/2),r=Math.round(r/2)}render(e,t,s,r,i){if(!this.selectedObjects.length){this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=s.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e));return}e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const o=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),i&&e.state.buffers.stencil.setTest(!1);const c=new Map;for(const p of this.selectedObjects)c.set(p,!0);const u=this.materialCache;this.renderScene.background&&(this.sceneBackgroundCache=this.renderScene.background,this.renderScene.background=this.overrideBackground),this.renderScene.traverse(p=>{!c.has(p)&&!p.isLight&&p.visible&&(u.set(p,p.material),p instanceof l.Mesh?p.material=this.overrideMeshMaterial:p instanceof l.Line?p.material=this.overrideLineMaterial:p instanceof l.Points?p.material=this.overridePointsMaterial:p instanceof l.Sprite&&(p.material=this.overrideSpriteMaterial))}),e.setRenderTarget(this.selectRenderTarget),e.clear(),e.render(this.renderScene,this.renderCamera),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=this.selectRenderTarget.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=this.selectRenderTarget.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);let d=this.renderTargetBright;for(let p=0;p<this.nMips;p++)this.fsQuad.material=this.separableBlurMaterials[p],this.separableBlurMaterials[p].uniforms.colorTexture.value=d.texture,this.separableBlurMaterials[p].uniforms.direction.value=wt.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[p]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[p].uniforms.colorTexture.value=this.renderTargetsHorizontal[p].texture,this.separableBlurMaterials[p].uniforms.direction.value=wt.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[p]),e.clear(),this.fsQuad.render(e),d=this.renderTargetsVertical[p];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.mixMaterial,this.mixMaterial.uniforms.bloom.value=this.renderTargetsHorizontal[0].texture,this.mixMaterial.uniforms.origin.value=s.texture,i&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(s),this.fsQuad.render(e)),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=o;for(const p of u.entries())p[0].material=p[1];u.clear(),this.sceneBackgroundCache&&(this.renderScene.background=this.sceneBackgroundCache,this.sceneBackgroundCache=null)}getMixMaterial(){return new l.ShaderMaterial({blending:l.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0,uniforms:{bloom:{value:null},origin:{value:null}},vertexShader:`
    
        varying vec2 vUv;
    
        void main() {
    
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
    
        }`,fragmentShader:`
        uniform sampler2D bloom;
        uniform sampler2D origin;
    
        varying vec2 vUv;
    
        void main() {
          vec3 bloomColor = texture2D(bloom, vUv).rgb;
          vec3 originColor = texture2D(origin, vUv).rgb;
          gl_FragColor = vec4(originColor + bloomColor, 1.0);
        }`})}getSeperableBlurMaterial(e){return new l.ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new l.Vector2(.5,.5)},direction:{value:new l.Vector2(.5,.5)}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 texSize;
				uniform vec2 direction;

				float gaussianPdf(in float x, in float sigma) {
					return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;
				}
				void main() {
					vec2 invSize = 1.0 / texSize;
					float fSigma = float(SIGMA);
					float weightSum = gaussianPdf(0.0, fSigma);
					vec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;
					for( int i = 1; i < KERNEL_RADIUS; i ++ ) {
						float x = float(i);
						float w = gaussianPdf(x, fSigma);
						vec2 uvOffset = direction * invSize * x;
						vec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;
						vec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;
						diffuseSum += (sample1 + sample2) * w;
						weightSum += 2.0 * w;
					}
					gl_FragColor = vec4(diffuseSum/weightSum, 1.0);
				}`})}getCompositeMaterial(e){return new l.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;
				uniform sampler2D blurTexture1;
				uniform sampler2D blurTexture2;
				uniform sampler2D blurTexture3;
				uniform sampler2D blurTexture4;
				uniform sampler2D blurTexture5;
				uniform float bloomStrength;
				uniform float bloomRadius;
				uniform float bloomFactors[NUM_MIPS];
				uniform vec3 bloomTintColors[NUM_MIPS];

				float lerpBloomFactor(const in float factor) {
					float mirrorFactor = 1.2 - factor;
					return mix(factor, mirrorFactor, bloomRadius);
				}

				void main() {
					gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +
						lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +
						lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +
						lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +
						lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );
				}`})}};let it=wt;h(it,"BlurDirectionX",new l.Vector2(1,0)),h(it,"BlurDirectionY",new l.Vector2(0,1));var oc=A({configType:a.CONFIGTYPE.SELECTIVEBLOOMPASS,commands:{add:{selectedObjects({target:n,engine:e,value:t}){const s=e.compilerManager.getObject3D(t);s?n.selectedObjects.push(s):console.warn(`selectiveBloomPassProcessor: can not found vid in engine: ${t}`)}},set:{renderScene({target:n,engine:e,value:t}){const s=e.compilerManager.getObject3D(t);s instanceof l.Scene&&(n.renderScene=s)},renderCamera({target:n,engine:e,value:t}){const s=e.compilerManager.getObject3D(t);s instanceof l.Camera&&(n.renderCamera=s)},selectedObjects({target:n,config:e,engine:t}){const s=e.selectedObjects.map(r=>{const i=t.compilerManager.getObject3D(r);if(i)return i;console.warn(`selectiveBloomPassProcessor: can not found vid in engine: ${r}`)}).filter(r=>r);n.selectedObjects=s}},delete:{selectedObjects({target:n,engine:e,value:t}){const s=e.compilerManager.getObject3D(t);s?n.selectedObjects.includes(s)&&n.selectedObjects.splice(n.selectedObjects.indexOf(s),1):console.warn(`selectiveBloomPassProcessor: can not found vid in engine: ${t}`)}}},create(n,e){const t=[];for(const i of n.selectedObjects){const o=e.compilerManager.getObject3D(i);o&&t.push(o)}const s=window.devicePixelRatio;return new it(new l.Vector2(e.dom?e.dom.offsetWidth*s:window.innerWidth*s,e.dom?e.dom.offsetHeight*s:window.innerWidth*s),n.strength,n.radius,n.threshold,n.renderScene&&e.compilerManager.getObject3D(n.renderScene)||void 0,n.renderCamera&&e.compilerManager.getObject3D(n.renderCamera)||void 0,t)},dispose(n){n.dispose()}});class ac extends L{constructor(){super();h(this,"MODULE",a.MODULETYPE.PASS);h(this,"composer")}useEngine(e){return super.useEngine(e),e.effectComposer?(this.composer=e.effectComposer,this):(console.warn("engine need install effectComposer plugin that can use pass compiler."),this)}add(e){const t=super.add(e);return t&&this.composer.addPass(t),t}remove(e){if(!this.map.has(e.vid))return console.warn(`PassCompiler can not found this vid pass: ${e.vid}.`),this;const t=this.map.get(e.vid);return this.composer.removePass(t),super.remove(e),this}}L.processor(rc),L.processor(ic),L.processor(oc);var cc=A({configType:a.CONFIGTYPE.POINTS,commands:Xe,create(n,e){return Ct(new l.Points,n,{},e)},dispose:Ot});class lc extends Mt{constructor(){super();h(this,"MODULE",a.MODULETYPE.POINTS)}}L.processor(cc);var uc=A({configType:a.CONFIGTYPE.WEBGLRENDERER,commands:{set:{size({target:n,config:e}){e.size?n.setSize(e.size.x,e.size.y):n.setSize(n.domElement.offsetWidth,n.domElement.offsetHeight)},clearColor({target:n,value:e}){const t=Number(e.slice(0,-1).split(",").pop().trim());n.setClearColor(e,t),n.clear()},viewport({target:n,config:e}){const t=e.viewport;if(t)n.setViewport(t.x,t.y,t.width,t.height);else{const s=n.domElement;n.setViewport(0,0,s.offsetWidth,s.offsetHeight)}},scissor({target:n,config:e}){const t=e.scissor;if(t)n.setScissorTest(!0),n.setScissor(t.x,t.y,t.width,t.height);else{n.setScissorTest(!1);const s=n.domElement;n.setScissor(0,0,s.offsetWidth,s.offsetHeight)}},pixelRatio({target:n,value:e}){n.setPixelRatio(e),n.clear()}}},create(n,e){let t;if(e.webGLRenderer?t=e.webGLRenderer:t=new l.WebGLRenderer,n.size&&t.setSize(n.size.x,n.size.y),n.clearColor){const s=Number(n.clearColor.slice(0,-1).split(",").pop().trim());t.setClearColor(n.clearColor,s)}if(n.viewport){const s=n.viewport;t.setViewport(s.x,s.y,s.width,s.height)}if(n.scissor){const s=n.scissor;t.setScissorTest(!0),t.setScissor(s.x,s.y,s.width,s.height)}return n.pixelRatio&&t.setPixelRatio(n.pixelRatio),k(n,t,{size:!0,clearColor:!0,viewport:!0,scissor:!0,pixelRatio:!0}),t},dispose(n){n.clear(),n.dispose()}}),dc=A({configType:a.CONFIGTYPE.CSS3DRENDERER,commands:{set:{size({target:n,config:e}){e.size?n.setSize(e.size.x,e.size.y):n.setSize(n.domElement.offsetWidth,n.domElement.offsetHeight)}}},create(n,e){let t;return e.css3DRenderer?t=e.css3DRenderer:t=new Oe.CSS3DRenderer,n.size&&t.setSize(n.size.x,n.size.y),k(n,t,{size:!0}),t},dispose(n){}});class hc extends L{constructor(){super();h(this,"MODULE",a.MODULETYPE.RENDERER)}useEngine(e){return e.webGLRenderer&&this.map.set(a.CONFIGTYPE.WEBGLRENDERER,e.webGLRenderer),e.css3DRenderer&&this.map.set(a.CONFIGTYPE.CSS3DRENDERER,e.css3DRenderer),super.useEngine(e)}}L.processor(uc),L.processor(dc);const is=function(n,e,t){if(!e){n.background=null;return}if(se.validate(e)){const s=t.compilerManager.getTexture(e);s?n.background=s:console.warn(`engine can not found this vid texture : '${e}'`)}else n.background=new l.Color(e)},os=function(n,e,t){if(!e){n.environment=null;return}if(se.validate(e)){const s=t.compilerManager.getTexture(e);s?n.environment=s:console.warn(`engine can not found this vid texture : '${e}'`)}else console.warn(`scene environment is illeage: ${e}`)};var pc=A({configType:a.CONFIGTYPE.SCENE,commands:{add:U.add,set:at(j({},U.set),{lookAt(){},fog({target:n,config:e,key:t,value:s}){const r=e.fog;r.type?r.type==="Fog"?!n.fog||!(n.fog instanceof l.Fog)?n.fog=new l.Fog(r.color,r.near,r.far):t==="color"?n.fog.color.copy(new l.Color(r.color)):n.fog[t]&&(n.fog[t]=s):r.type==="FogExp2"&&(!n.fog||!(n.fog instanceof l.FogExp2)?n.fog=new l.FogExp2(r.color,r.density):t==="color"?n.fog.color.copy(new l.Color(r.color)):n.fog[t]&&(n.fog[t]=s)):n.fog=null},background({target:n,value:e,engine:t}){is(n,e,t)},environment({target:n,value:e,engine:t}){os(n,e,t)}}),delete:U.delete},create(n,e){const t=new l.Scene;if(is(t,n.background,e),os(t,n.environment,e),n.fog.type){const s=n.fog;s.type==="Fog"?t.fog=new l.Fog(s.color,s.near,s.far):s.type==="FogExp2"?t.fog=new l.FogExp2(s.color,s.density):console.warn(`scene processor can not support this type fog:'${n.type}'`)}return ie(t,n,{lookAt:!0,background:!0,environment:!0,fog:!0},e)},dispose:q});class fc extends Le{constructor(){super();h(this,"MODULE",a.MODULETYPE.SCENE)}}L.processor(pc);const as=new l.SpriteMaterial({color:"rgb(123, 123, 123)"});var mc=A({configType:a.CONFIGTYPE.SPRITE,commands:{add:Xe.add,set:at(j({lookAt(){}},Xe.set),{material({target:n,engine:e,value:t}){const s=e.compilerManager.getMaterial(t);s&&s instanceof l.SpriteMaterial?n.material=s:n.material=as}}),delete:Xe.add},create(n,e){const t=new l.Sprite,s=e.compilerManager.getMaterial(n.material);return s&&s instanceof l.SpriteMaterial?t.material=s:t.material=as,Ct(t,n,{geometry:!0,material:!0,lookAt:!0},e)},dispose:Ot});class gc extends Mt{constructor(){super();h(this,"MODULE",a.MODULETYPE.SPRITE)}}L.processor(mc);class Ec extends l.Texture{constructor(e,t,s,r,i,o,c,u,d,p){super(e,t,s,r,i,o,c,u,d,p)}}const bt={reg:new RegExp("wrapS|wrapT|format|encoding|anisotropy|magFilter|minFilter|mapping"),handler({target:n,key:e,value:t}){n[e]=t,n.needsUpdate=!0}};var Tc=A({configType:a.CONFIGTYPE.IMAGETEXTURE,commands:{set:{url({target:n,value:e,engine:t}){n.image=t.compilerManager.textureCompiler.getResource(e,HTMLImageElement),n.needsUpdate=!0},$reg:[bt]}},create(n,e){const t=new Ec;return n.url&&(t.image=e.compilerManager.textureCompiler.getResource(n.url,HTMLImageElement)),k(n,t,{type:!0,url:!0}),t.needsUpdate=!0,t},dispose(n){n.dispose()}}),yc=A({configType:a.CONFIGTYPE.CANVASTEXTURE,commands:{set:{url({target:n,value:e,engine:t}){n.image=t.compilerManager.textureCompiler.getResource(e,HTMLCanvasElement),n.needsUpdate=!0},$reg:[bt]}},create(n,e){const t=new l.CanvasTexture(e.compilerManager.textureCompiler.getResource(n.url,HTMLCanvasElement));return k(n,t,{type:!0,url:!0}),t.needsUpdate=!0,t},dispose(n){n.dispose()}});const _e=[HTMLImageElement,HTMLVideoElement,HTMLCanvasElement],Qe=function({target:n,index:e,value:t,engine:s}){n.images[e]=s.compilerManager.textureCompiler.getResource(t,_e),n.needsUpdate=!0};var Mc=A({configType:a.CONFIGTYPE.CUBETEXTURE,commands:{set:{cube:{px({target:n,value:e,engine:t}){Qe({target:n,value:e,engine:t,index:0})},nx({target:n,value:e,engine:t}){Qe({target:n,value:e,engine:t,index:1})},py({target:n,value:e,engine:t}){Qe({target:n,value:e,engine:t,index:2})},ny({target:n,value:e,engine:t}){Qe({target:n,value:e,engine:t,index:3})},pz({target:n,value:e,engine:t}){Qe({target:n,value:e,engine:t,index:4})},nz({target:n,value:e,engine:t}){Qe({target:n,value:e,engine:t,index:5})}}}},create(n,e){const t=new l.CubeTexture,s=n.cube,r=e.compilerManager.textureCompiler,i=[r.getResource(s.px,_e),r.getResource(s.nx,_e),r.getResource(s.py,_e),r.getResource(s.ny,_e),r.getResource(s.pz,_e),r.getResource(s.nz,_e)];return t.image=i,k(n,t,{type:!0,cube:!0}),t.needsUpdate=!0,t},dispose(n){n.dispose()}});class Sc extends l.Texture{constructor(e,t,s,r,i,o,c,u,d){super(e,t,s,r,i,o,c,u,d);h(this,"isVideoTexture",!0);this.format=c!==void 0?c:l.RGBFormat,this.minFilter=o!==void 0?o:l.LinearFilter,this.magFilter=i!==void 0?i:l.LinearFilter,this.generateMipmaps=!1}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image,t="requestVideoFrameCallback"in e;t?this.needsUpdate=!0:t===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}var Cc=A({configType:a.CONFIGTYPE.VIDEOTEXTURE,commands:{set:{url({target:n,value:e,engine:t}){n.image=t.compilerManager.textureCompiler.getResource(e,HTMLVideoElement),n.needsUpdate=!0},$reg:[bt]}},create(n,e){const t=new Sc(document.createElement("video"));return n.url&&(t.image=e.compilerManager.textureCompiler.getResource(n.url,HTMLVideoElement)),k(n,t,{type:!0,url:!0}),t.needsUpdate=!0,t},dispose(n){n.dispose()}});class qe{constructor(e){h(this,"canvas");this.canvas=document.createElement("canvas");const t=window.devicePixelRatio;this.canvas.width=((e==null?void 0:e.width)||512)*t,this.canvas.height=((e==null?void 0:e.height)||512)*t,this.canvas.style.backgroundColor=(e==null?void 0:e.bgColor)||"rgb(255, 255, 255)";const s=this.canvas.getContext("2d");s&&s.scale(window.devicePixelRatio,window.devicePixelRatio)}get(){return this.canvas}getDom(){return this.canvas}clear(e=0,t=0,s,r){!s&&(s=this.canvas.width),!r&&(r=this.canvas.height);const i=this.canvas.getContext("2d");return i?(i.clearRect(e,t,s,r),this):(console.warn("you browser can not support canvas 2d"),this)}draw(e){const t=this.canvas.getContext("2d");return t?(e(t),this):(console.warn("you browser can not support canvas 2d"),this)}preview(e){const t=this.canvas;return t.style.position="fixed",t.style.top=(e==null?void 0:e.top)||"5%",t.style.left=(e==null?void 0:e.left)||"5%",t.style.right=(e==null?void 0:e.right)||"unset",t.style.bottom=(e==null?void 0:e.bottom)||"unset",(e==null?void 0:e.scale)&&(t.style.transform=`scale(${e.scale})`),document.body.appendChild(this.canvas),this}}class cs extends l.Texture{constructor(e){super();Object.keys(e).forEach(t=>{this[t]=e[t]}),this.copy(e)}}var Oc=A({configType:a.CONFIGTYPE.LOADTEXTURE,commands:{set:{url({}){},$reg:[bt]}},create(n,e){let t;const s=e.compilerManager.textureCompiler.getResource(n.url,l.Texture);if(s instanceof l.Texture)t=new cs(s);else{const r=new l.Texture(s);t=new cs(r)}return k(n,t,{type:!0,url:!0}),t.needsUpdate=!0,t},dispose(n){n.dispose()}});const ot=class extends L{constructor(){super();h(this,"MODULE",a.MODULETYPE.TEXTURE)}getResource(e,t){const s=this.engine.resourceManager.resourceMap;if(!s.has(e))return console.warn(`engine resourceManager can not found this url: ${e}`),ot.replaceImage;const r=s.get(e);if(Array.isArray(t)){for(const i of t)if(r instanceof i)return r;return console.warn(`this url mapping resource is not a texture image class: ${e}`,r),ot.replaceImage}else return r instanceof t?r:(console.warn(`this url mapping resource is not a texture image class: ${e}`,r),ot.replaceImage)}};let Vt=ot;h(Vt,"replaceImage",new qe({width:512,height:512}).draw(e=>{e.translate(256,256),e.font="72px",e.fillStyle="white",e.fillText("\u6682\u65E0\u56FE\u7247",0,0)}).getDom()),L.processor(Tc),L.processor(yc),L.processor(Mc),L.processor(Cc),L.processor(Oc);class bc{constructor(e){h(this,"object3DCompiler",new sc);h(this,"cameraCompiler",new aa);h(this,"lightCompiler",new Ha);h(this,"geometryCompiler",new Da);h(this,"textureCompiler",new Vt);h(this,"materialCompiler",new Za);h(this,"rendererCompiler",new hc);h(this,"sceneCompiler",new fc);h(this,"controlsCompiler",new ua);h(this,"spriteCompiler",new gc);h(this,"lineCompiler",new Va);h(this,"meshCompiler",new tc);h(this,"pointsCompiler",new lc);h(this,"groupCompiler",new xa);h(this,"css3DCompiler",new ga);h(this,"passCompiler",new ac);h(this,"animationCompiler",new So);h(this,"compilerMap");e&&Object.keys(e).forEach(s=>{this[s]=e[s]});const t=new Map;Object.keys(this).forEach(s=>{const r=this[s];r instanceof L&&t.set(r.MODULE,r)}),this.compilerMap=t}support(e){this.compilerMap.forEach(s=>{s.useEngine(e)});const t=e.dataSupportManager;return t.textureDataSupport.addCompiler(this.textureCompiler),t.materialDataSupport.addCompiler(this.materialCompiler),t.geometryDataSupport.addCompiler(this.geometryCompiler),t.rendererDataSupport.addCompiler(this.rendererCompiler),t.controlsDataSupport.addCompiler(this.controlsCompiler),t.passDataSupport.addCompiler(this.passCompiler),t.object3DDataSupport.addCompiler(this.object3DCompiler),t.cameraDataSupport.addCompiler(this.cameraCompiler),t.lightDataSupport.addCompiler(this.lightCompiler),t.spriteDataSupport.addCompiler(this.spriteCompiler),t.lineDataSupport.addCompiler(this.lineCompiler),t.meshDataSupport.addCompiler(this.meshCompiler),t.pointsDataSupport.addCompiler(this.pointsCompiler),t.css3DDataSupport.addCompiler(this.css3DCompiler),t.groupDataSupport.addCompiler(this.groupCompiler),t.sceneDataSupport.addCompiler(this.sceneCompiler),t.animationDataSupport.addCompiler(this.animationCompiler),this}getObjectSymbol(e){for(const t of this.compilerMap.values()){const s=t.getObjectSymbol(e);if(s)return s}return null}getObjectBySymbol(e){for(const t of this.compilerMap.values()){const s=t.getObjectBySymbol(e);if(s)return s}return null}getObject3D(e){for(const t of this.compilerMap.values())if(t instanceof Le&&t.map.has(e))return t.map.get(e);return null}getGeometry(e){return this.geometryCompiler.map.get(e)||null}getMaterial(e){return this.materialCompiler.map.get(e)||null}getTexture(e){return this.textureCompiler.map.get(e)||null}dispose(){for(const e of this.compilerMap.values())e.dispose();return this.compilerMap.clear(),this}}const Rc=function(n){if(this.compilerManager)return console.warn("engine has installed compilerManager plugin."),!1;if(!this.dataSupportManager)return console.warn("must install dataSupportManager before compilerManager plugin."),!1;if(!this.renderManager)return console.warn("must install renderManager before compilerManager plugin."),!1;const e=new bc;return this.compilerManager=e,this.getObjectSymbol=function(t){return this.compilerManager.getObjectSymbol(t)},this.getObjectBySymbol=function(t){return this.compilerManager.getObjectBySymbol(t)},this.addEventListener("dispose",()=>{this.compilerManager.dispose()}),this.completeSet.add(()=>{this.compilerManager.support(this)}),!0};class ls extends re{constructor(){super();h(this,"map",new Map)}generateSymbol(e){return Array.isArray(e)?e.join(" + "):e.shortcutKey.join(" + ")}watch(e){return e?ct.default.watch(void 0,e):ct.default.watch(),this}register(e){const t=this.generateSymbol(e);return this.map.has(t)?(console.warn(`KeyboardManager: shortcutKey already exist: ${t}. desp: ${this.map.get(t).desp}`),this):(ct.default.bind(t,e.keydown||null,e.keyup),this.map.set(t,e),this)}update(e){const t=this.generateSymbol(e);return this.map.has(t)?(this.cancel(e.shortcutKey),this.register(e),this):(console.warn("KeyboardManager: shortcutKey unregister then exec register function"),this.register(e),this)}cancel(e){const t=this.generateSymbol(e);if(this.map.has(t)){const s=this.map.get(t);ct.default.unbind(t,s.keydown||null,s.keyup),this.map.delete(t)}return this}checkRepeat(e){const t=this.generateSymbol(e);return this.map.has(t)}}const Lc=function(n){if(this.keyboardManager)return console.warn("engine has installed keyboardManager plugin."),!1;const e=new ls;return this.keyboardManager=e,this.completeSet.add(()=>{if(this.transformControls)if(this.IS_ENGINESUPPORT){const t=this.dataSupportManager.controlsDataSupport.getData()[a.CONFIGTYPE.TRNASFORMCONTROLS];e.register({shortcutKey:["r"],desp:"tranformControls rotate mode",keyup:s=>{s==null||s.preventDefault(),t.mode="rotate"}}).register({shortcutKey:["t"],desp:"tranformControls translate mode",keyup:s=>{s==null||s.preventDefault(),t.mode="translate"}}).register({shortcutKey:["e"],desp:"tranformControls scale mode",keyup:s=>{s==null||s.preventDefault(),t.mode="scale"}}).register({shortcutKey:["x"],desp:"tranformControls switch x axis",keyup:s=>{s==null||s.preventDefault(),t.showX=!t.showX}}).register({shortcutKey:["y"],desp:"tranformControls switch y axis",keyup:s=>{s==null||s.preventDefault(),!(s==null?void 0:s.ctrlKey)&&(t.showY=!t.showY)}}).register({shortcutKey:["z"],desp:"tranformControls switch z axis",keyup:s=>{s==null||s.preventDefault(),!(s==null?void 0:s.ctrlKey)&&(t.showZ=!t.showZ)}}).register({shortcutKey:["space"],desp:"tranformControls switch coordinate space",keyup:s=>{s==null||s.preventDefault(),t.space=t.space==="local"?"world":"local"}}).register({shortcutKey:["shift"],desp:"tranformControls switch tranform numeric value",keyup:s=>{s==null||s.preventDefault(),t.snapAllow=!1},keydown:s=>{s==null||s.preventDefault(),s==null||s.preventRepeat(),t.snapAllow=!0}})}else{const t=this.transformControls;e.register({shortcutKey:["r"],desp:"tranformControls rotate mode",keyup:s=>{s==null||s.preventDefault(),t.mode="rotate"}}).register({shortcutKey:["t"],desp:"tranformControls translate mode",keyup:s=>{s==null||s.preventDefault(),t.mode="translate"}}).register({shortcutKey:["e"],desp:"tranformControls scale mode",keyup:s=>{s==null||s.preventDefault(),t.mode="scale"}}).register({shortcutKey:["x"],desp:"tranformControls switch x axis",keyup:s=>{s==null||s.preventDefault(),t.showX=!t.showX}}).register({shortcutKey:["y"],desp:"tranformControls switch y axis",keyup:s=>{s==null||s.preventDefault(),!(s==null?void 0:s.ctrlKey)&&(t.showY=!t.showY)}}).register({shortcutKey:["z"],desp:"tranformControls switch z axis",keyup:s=>{s==null||s.preventDefault(),!(s==null?void 0:s.ctrlKey)&&(t.showZ=!t.showZ)}}).register({shortcutKey:["space"],desp:"tranformControls switch coordinate space",keyup:s=>{s==null||s.preventDefault(),t.space=t.space==="local"?"world":"local"}}).register({shortcutKey:["shift"],desp:"tranformControls switch tranform numeric value",keyup:s=>{s==null||s.preventDefault(),t.translationSnap=null,t.rotationSnap=null,t.scaleSnap=null},keydown:s=>{s==null||s.preventDefault(),s==null||s.preventRepeat(),t.translationSnap=5,t.rotationSnap=Math.PI/180*10,t.scaleSnap=.1}})}}),!0},wc=function(n={}){if(!this.scene)return console.error("must install some scene plugin before BasicViewpoint plugin."),!1;const e=new l.AxesHelper(n.length||500);return e.matrixAutoUpdate=!1,e.raycast=()=>{},this.scene.add(e),this.setAxesHelper=function(t){return t.show?this.scene.add(e):this.scene.remove(e),this},this.addEventListener("setScene",t=>{t.scene.add(e)}),!0},Pc=function(n={}){if(!this.scene)return console.error("must install some scene before BasicViewpoint plugin."),!1;const e=new l.GridHelper(n.range||500,n.spacing||50,n.axesColor||"rgb(130, 130, 130)",n.cellColor||"rgb(70, 70, 70)");if(n.opacity!==1){const t=e.material;t.transparent=!0,t.opacity=n.opacity||.5,t.needsUpdate=!0}return e.matrixAutoUpdate=!1,e.raycast=()=>{},this.scene.add(e),this.setGridHelper=function(t){return t.show?this.scene.add(e):this.scene.remove(e),this},this.addEventListener("setScene",t=>{t.scene.add(e)}),this.completeSet.add(()=>{this.setViewpoint&&this.addEventListener("setViewpoint",t=>{const s=t.viewpoint;s===a.VIEWPOINT.DEFAULT||s===a.VIEWPOINT.TOP||s===a.VIEWPOINT.BOTTOM?e.rotation.set(0,0,0):s===a.VIEWPOINT.RIGHT||s===a.VIEWPOINT.LEFT?e.rotation.set(0,0,Math.PI/2):(s===a.VIEWPOINT.FRONT||s===a.VIEWPOINT.BACK)&&e.rotation.set(Math.PI/2,0,0),e.updateMatrix(),e.updateMatrixWorld()})}),!0};a.DISPLAYMODE=void 0,function(n){n.GEOMETRY="geometry",n.MATERIAL="material",n.LIGHT="light",n.ENV="env"}(a.DISPLAYMODE||(a.DISPLAYMODE={}));const Ac=function(n={}){if(!this.webGLRenderer)return console.error("must install some renderer before DisplayModel plugin."),!1;if(!this.scene)return console.error("must install some scene before DisplayModel plugin."),!1;!n.overrideColor&&(n.overrideColor="rgb(250, 250, 250)"),!n.defaultAmbientLightSetting&&(n.defaultAmbientLightSetting={}),!n.defaultAmbientLightSetting.color&&(n.defaultAmbientLightSetting.color="rgb(255, 255, 255)"),!n.defaultAmbientLightSetting.intensity&&(n.defaultAmbientLightSetting.intensity=.5);const e=new l.AmbientLight(n.defaultAmbientLightSetting.color,n.defaultAmbientLightSetting.intensity);e.matrixAutoUpdate=!1,!n.defaultDirectionalLightSetting&&(n.defaultDirectionalLightSetting={}),!n.defaultDirectionalLightSetting.color&&(n.defaultDirectionalLightSetting.color="rgb(255, 255, 255)"),!n.defaultDirectionalLightSetting.intensity&&(n.defaultDirectionalLightSetting.intensity=.5),!n.defaultDirectionalLightSetting.position&&(n.defaultDirectionalLightSetting.position={x:-100,y:100,z:100});const t=new l.DirectionalLight(n.defaultDirectionalLightSetting.color,n.defaultDirectionalLightSetting.intensity);t.castShadow=!1,t.position.set(n.defaultDirectionalLightSetting.position.x,n.defaultDirectionalLightSetting.position.y,n.defaultDirectionalLightSetting.position.z),t.updateMatrix(),t.updateMatrixWorld(),t.matrixAutoUpdate=!1,!n.mode&&(n.mode=a.DISPLAYMODE.ENV),this.displayMode=n.mode;const s=new l.MeshLambertMaterial({color:n.overrideColor}),r=new l.LineBasicMaterial({color:n.overrideColor}),i=new l.PointsMaterial({color:n.overrideColor,size:5,sizeAttenuation:!1}),o=new l.SpriteMaterial({color:n.overrideColor}),c=new WeakMap,u=new Set,d=new Set,p=new Set,f=new Set,g=new Set;let E,T;const C={Object3D:!0,Group:!0};this.scene.addEventListener("afterAdd",S=>{const N=this.displayMode,I=S.objects;for(const P of I)if(!C[P.type])if(P instanceof l.Mesh&&P.type==="Mesh")d.add(P),N===a.DISPLAYMODE.GEOMETRY&&(c.set(P,P.material),P.material=s);else if(P instanceof l.Line&&P.type.includes("Line"))p.add(P),N===a.DISPLAYMODE.GEOMETRY&&(c.set(P,P.material),P.material=r);else if(P instanceof l.Light&&P.type.includes("Light")){if(P===e||P===t)continue;u.has(P)||u.add(P),N!==a.DISPLAYMODE.ENV&&N!==a.DISPLAYMODE.LIGHT&&this.scene.remove(P)}else P instanceof l.Points&&P.type==="Points"?(f.add(P),N===a.DISPLAYMODE.GEOMETRY&&(c.set(P,P.material),P.material=i)):P instanceof l.Sprite&&P.type==="Sprite"&&(g.add(P),N===a.DISPLAYMODE.GEOMETRY&&(c.set(P,P.material),P.material=o))}),this.scene.addEventListener("afterRemove",S=>{const N=S.objects;for(const I of N)if(!C[I.type])if(I instanceof l.Mesh&&I.type==="Mesh")d.delete(I),c.has(I)&&c.delete(I);else if(I instanceof l.Line&&I.type.includes("Line"))p.delete(I),c.has(I)&&c.delete(I);else if(I instanceof l.Light&&I.type.includes("Light")){if(I===e||I===t)continue;u.delete(I)}else I instanceof l.Points&&I.type==="Points"?(f.delete(I),c.has(I)&&c.delete(I)):I instanceof l.Sprite&&I.type==="Sprite"&&(g.delete(I),c.has(I)&&c.delete(I))});const M=()=>{for(const S of d)S.material!==s&&(c.set(S,S.material),S.material=s);for(const S of p)S.material!==r&&(c.set(S,S.material),S.material=r);for(const S of f)S.material!==i&&(c.set(S,S.material),S.material=i);for(const S of g)S.material!==o&&(c.set(S,S.material),S.material=o)},y=()=>{d.forEach(S=>{c.has(S)&&(S.material=c.get(S),c.delete(S))}),p.forEach(S=>{c.has(S)&&(S.material=c.get(S),c.delete(S))}),f.forEach(S=>{c.has(S)&&(S.material=c.get(S),c.delete(S))}),g.forEach(S=>{c.has(S)&&(S.material=c.get(S),c.delete(S))})},O=()=>{u.forEach(S=>{S.visible=!1}),this.scene.add(e),this.scene.add(t)},b=()=>{u.forEach(S=>{S.visible=!0}),this.scene.remove(e),this.scene.remove(t)},R=()=>{this.scene.background instanceof l.Texture&&(E=this.scene.background,this.scene.background=null),this.scene.environment instanceof l.Texture&&(T=this.scene.environment,this.scene.environment=null)},G=()=>{E&&(this.scene.background=E,E=void 0),T&&(this.scene.environment=T,T=void 0)};return this.setDisplayMode=function(S){return this.displayMode=S||a.DISPLAYMODE.ENV,S===a.DISPLAYMODE.GEOMETRY?(M(),R(),O()):S===a.DISPLAYMODE.MATERIAL?(y(),R(),O()):S===a.DISPLAYMODE.LIGHT?(y(),R(),b()):S===a.DISPLAYMODE.ENV?(y(),G(),b()):console.warn(`displayMode plugin can not set this mode: ${S}`),this},this.completeSet.add(()=>{this.objectHelperManager&&this.objectHelperManager.addFilteredObject(t)}),!0},ve=()=>new l.LineBasicMaterial({color:"rgb(255, 255, 255)"});class Wt extends l.LineSegments{constructor(e){super();h(this,"shape");h(this,"target");h(this,"type","CameraHelper");h(this,"cachaData");const t=new l.BufferGeometry,s=[0,0,0,-1,1,-1,0,0,0,-1,1,1,0,0,0,-1,-1,-1,0,0,0,-1,-1,1,-1,-1,1,-1,-1,-1,-1,-1,-1,-1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,-1,1,0,0,0,0,1,1,0,0,0,0,1,-1,0,0,0,0,-1,-1,0,0,0,0,-1,1,0,1,1,0,1,-1,0,1,-1,0,-1,-1,0,-1,-1,0,-1,1,0,-1,1,0,1,1,0,-1,1,2,-1,1,0,1,-1,2,1,-1,0,-1,-1,2,-1,-1,0,1,1,2,1,1,2,1,1,2,-1,1,2,-1,1,2,-1,-1,2,-1,-1,2,1,-1,2,1,-1,2,1,1];t.setAttribute("position",new l.Float32BufferAttribute(s,3)),t.rotateY(-90*Math.PI/180),t.computeBoundingBox();const r=new l.CameraHelper(e);r.matrix=new l.Matrix4,r.matrixAutoUpdate=!0,r.raycast=()=>{},this.add(r),this.shape=r,this.geometry=t,this.material=ve(),this.target=e,this.matrixAutoUpdate=!1,this.matrix=e.matrix,e instanceof l.PerspectiveCamera?this.cachaData={fov:e.fov,aspect:e.aspect,near:e.near,far:e.far}:e instanceof l.OrthographicCamera?this.cachaData={left:e.left,right:e.right,top:e.top,bottom:e.bottom,near:e.near,far:e.far}:this.cachaData={},this.onBeforeRender=()=>{let i=!1;const o=this.cachaData;Object.keys(o).forEach(c=>{o[c]!==e[c]&&(o[c]=e[c],i=!0)}),i&&this.shape.update()}}raycast(e,t){const s=this.matrixWorld,r=this.geometry.boundingBox.clone();if(r.applyMatrix4(s),e.ray.intersectsBox(r)){const i=this.target;t.push({distance:e.ray.origin.distanceTo(i.position),object:i,point:i.position})}}}class us extends l.LineSegments{constructor(e){super();h(this,"sphere");h(this,"target");h(this,"shape");h(this,"type","VisDirectionalLightHelper");h(this,"cacheColor");h(this,"cacheVector3");this.geometry=new l.BufferGeometry;const t=[-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,0,0,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,-.707,0,-.707,.707,0,.707,.707,0,-.707,-.707,0,.707];this.geometry.setAttribute("position",new l.Float32BufferAttribute(t,3)),this.material=ve(),this.geometry.boundingSphere;const s=new l.Color().copy(e.color).multiplyScalar(e.intensity),r=new l.PlaneBufferGeometry(20,20);r.dispose();const i=new l.LineSegments(new l.EdgesGeometry(r),new l.LineBasicMaterial({color:s}));i.raycast=()=>{},this.shape=i,this.target=e,this.sphere=new l.Sphere(new l.Vector3(0,0,0),1),this.cacheColor=e.color.getHex(),this.cacheVector3=new l.Vector3,this.add(this.shape),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.onBeforeRender=()=>{const o=this.target,c=this.shape;o.color.getHex()!==this.cacheColor&&(c.material.color.copy(o.color).multiplyScalar(o.intensity),this.cacheColor=o.color.getHex()),c.lookAt(o.target.position)}}raycast(e,t){const s=this.target,r=s.matrixWorld,i=this.sphere;i.set(this.cacheVector3.set(0,0,0),1),i.applyMatrix4(r),e.ray.intersectsSphere(i)&&t.push({distance:e.ray.origin.distanceTo(s.position),object:s,point:s.position})}}class ds extends l.LineSegments{constructor(e){super();h(this,"sphere");h(this,"target");h(this,"shape");h(this,"type","VisPointLightHelper");h(this,"cacheColor");h(this,"cacheDistance");h(this,"cacheVector3");this.geometry=new l.BufferGeometry;const t=[-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,0,0,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,-.707,0,-.707,.707,0,.707,.707,0,-.707,-.707,0,.707];this.geometry.setAttribute("position",new l.Float32BufferAttribute(t,3)),this.material=ve(),this.geometry.boundingSphere;const s=new l.Color().copy(e.color).multiplyScalar(e.intensity),r=new l.Mesh(new l.OctahedronBufferGeometry(e.distance,0),new l.MeshBasicMaterial({color:s,wireframe:!0}));r.raycast=()=>{},r.matrixAutoUpdate=!1,this.shape=r,this.target=e,this.sphere=new l.Sphere(new l.Vector3(0,0,0),1),this.cacheColor=e.color.getHex(),this.cacheDistance=e.distance,this.cacheVector3=new l.Vector3,this.add(this.shape),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.onBeforeRender=()=>{const i=this.target,o=this.shape;i.distance!==this.cacheDistance&&(o.geometry.dispose(),o.geometry=new l.OctahedronBufferGeometry(i.distance,0),this.cacheDistance=i.distance),i.color.getHex()!==this.cacheColor&&(o.material.color.copy(i.color).multiplyScalar(i.intensity),this.cacheColor=i.color.getHex())}}raycast(e,t){const s=this.target,r=s.matrixWorld,i=this.sphere;i.set(this.cacheVector3.set(0,0,0),1),i.applyMatrix4(r),e.ray.intersectsSphere(i)&&t.push({distance:e.ray.origin.distanceTo(s.position),object:s,point:s.position})}}class hs extends l.LineSegments{constructor(e){super();h(this,"sphere");h(this,"target");h(this,"shape");h(this,"type","VisSpotLightHelper");h(this,"cacheVector3");h(this,"cacheColor");h(this,"cacheAngle");h(this,"cacheDistance");this.geometry=new l.BufferGeometry;const t=[-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,0,0,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,-.707,0,-.707,.707,0,.707,.707,0,-.707,-.707,0,.707];this.geometry.setAttribute("position",new l.Float32BufferAttribute(t,3)),this.material=ve(),this.geometry.boundingSphere;const s=new l.BufferGeometry,r=[0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let d=0,p=1,f=32;d<f;d++,p++){const g=d/f*Math.PI*2,E=p/f*Math.PI*2;r.push(Math.cos(g),Math.sin(g),1,Math.cos(E),Math.sin(E),1)}s.setAttribute("position",new l.Float32BufferAttribute(r,3));const i=ve(),o=new l.LineSegments(s,i);o.material.color.copy(e.color).multiplyScalar(e.intensity);const c=e.distance?e.distance:1e3,u=c*Math.tan(e.angle);o.scale.set(u,u,c),o.raycast=()=>{},this.add(o),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.target=e,this.shape=o,this.sphere=new l.Sphere(new l.Vector3(0,0,0),1),this.cacheColor=e.color.getHex(),this.cacheDistance=e.distance,this.cacheAngle=e.angle,this.cacheVector3=new l.Vector3,this.onBeforeRender=()=>{const d=this.target,p=this.shape;let f=!1;if(d.distance!==this.cacheDistance&&(this.cacheDistance=d.distance,p.scale.z=d.distance,f=!0),d.angle!==this.cacheAngle&&(this.cacheAngle=d.angle,f=!0),f){const g=d.distance*Math.tan(d.angle);p.scale.set(g,g,d.distance)}d.color.getHex()!==this.cacheColor&&(p.material.color.copy(d.color).multiplyScalar(d.intensity),this.cacheColor=d.color.getHex()),p.lookAt(d.target.position)}}raycast(e,t){const s=this.target,r=s.matrixWorld,i=this.sphere;i.set(this.cacheVector3.set(0,0,0),1),i.applyMatrix4(r),e.ray.intersectsSphere(i)&&t.push({distance:e.ray.origin.distanceTo(s.position),object:s,point:s.position})}}class Ic extends l.LineSegments{constructor(e){super();h(this,"target");h(this,"type","VisCSS3DHelper");const s=e.element.getBoundingClientRect(),r=s.width,i=s.height;this.geometry=new l.EdgesGeometry(new l.PlaneBufferGeometry(r,i)),this.geometry.computeBoundingBox(),this.material=ve(),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.target=e}raycast(e,t){const s=this.target,r=s.matrixWorld,i=this.geometry.boundingBox.clone();i.applyMatrix4(r),e.ray.intersectsBox(i)&&t.push({distance:e.ray.origin.distanceTo(s.position),object:s,point:s.position})}}class ps extends l.LineSegments{constructor(e){super();h(this,"target");h(this,"type","VisCSS3DPlaneHelper");h(this,"observer");this.geometry=new l.EdgesGeometry(new l.PlaneBufferGeometry(e.width,e.height)),this.geometry.computeBoundingBox(),this.material=ve(),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.target=e;const t=new MutationObserver(()=>{this.geometry.dispose(),this.geometry=new l.EdgesGeometry(new l.PlaneBufferGeometry(e.width,e.height)),this.geometry.computeBoundingBox()});t.observe(e.element,{attributeFilter:["style"]}),this.observer=t}dispose(){this.observer.disconnect()}}const en=class extends l.Sprite{constructor(e){super();h(this,"target");h(this,"type","VisGroupHelper");this.target=e,this.geometry.computeBoundingBox(),this.material=new l.SpriteMaterial({map:en.colorTexture}),this.material.depthTest=!1,this.material.depthWrite=!1,this.scale.set(5,5,5);const t=this.updateMatrixWorld.bind(this);this.updateMatrixWorld=s=>{const r=this.position,i=this.target.position;r.x=i.x,r.y=i.y,r.z=i.z,t(s)}}raycast(e,t){const s=this.matrixWorld,r=this.geometry.boundingBox.clone();if(r.applyMatrix4(s),e.ray.intersectsBox(r)){const i=this.target;t.push({distance:e.ray.origin.distanceTo(i.position),object:i,point:i.position})}}};let Rt=en;h(Rt,"colorTexture",new l.CanvasTexture(new qe({width:512,height:512}).draw(e=>{e.beginPath(),e.fillStyle="rgba(0, 0, 0, 0)",e.fillRect(0,0,512,512),e.closePath(),e.translate(256,200),e.beginPath(),e.fillStyle="yellow",e.fillRect(-200,0,400,200),e.closePath(),e.beginPath(),e.fillStyle="yellow",e.fillRect(-200,-70,200,70),e.closePath()}).get()));const tn=class extends l.Points{constructor(e){super();h(this,"target");h(this,"cachaGeometryUUid");h(this,"type","VisLineHelper");this.target=e,this.geometry.dispose(),this.geometry.copy(e.geometry),this.cachaGeometryUUid=e.geometry.uuid,this.material=new l.PointsMaterial({color:"rgb(255, 255, 255)",alphaMap:tn.alphaTexture,transparent:!0,size:5,sizeAttenuation:!1}),this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.matrix=e.matrix,this.matrixWorld=e.matrixWorld,this.renderOrder=-1,this.raycast=()=>{},this.onBeforeRender=()=>{const t=this.target;t.geometry.uuid!==this.cachaGeometryUUid&&(this.geometry.dispose(),this.geometry=t.geometry.clone(),this.cachaGeometryUUid=t.geometry.uuid)}}};let $t=tn;h($t,"alphaTexture",new l.CanvasTexture(new qe({width:512,height:512,bgColor:"rgb(0, 0, 0)"}).draw(e=>{e.beginPath(),e.fillStyle="rgb(255, 255, 255)",e.arc(256,256,200,0,Math.PI*2),e.fill(),e.closePath()}).getDom()));class vc extends l.LineSegments{constructor(e){super();h(this,"target");h(this,"type","VisMeshHelper");h(this,"cachaGeometryUUid");const t=1;this.target=e,this.geometry=new l.EdgesGeometry(e.geometry,t),this.cachaGeometryUUid=e.geometry.uuid,this.material=ve(),this.raycast=()=>{},this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.matrix=e.matrix,this.matrixWorld=e.matrixWorld,this.onBeforeRender=()=>{const s=this.target;s.geometry.uuid!==this.cachaGeometryUUid&&(this.geometry.dispose(),this.geometry=new l.EdgesGeometry(s.geometry,t),this.cachaGeometryUUid=s.geometry.uuid)}}}const nn=class extends l.Points{constructor(e){super();h(this,"target");h(this,"type","VisPointsHelper");this.target=e,this.geometry.dispose(),this.geometry.copy(e.geometry),this.material.dispose(),this.material=new l.PointsMaterial({color:"rgb(255, 255, 255)",alphaMap:nn.alphaTexture,transparent:!0});const t=Array.isArray(e.material)?e.material[0]:e.material;t instanceof l.PointsMaterial&&(this.material.size=t.size,this.material.sizeAttenuation=t.sizeAttenuation),this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.matrix=e.matrix,this.matrixWorld=e.matrixWorld,this.raycast=()=>{}}};let Kt=nn;h(Kt,"alphaTexture",new l.CanvasTexture(new qe({width:512,height:512,bgColor:"rgb(0, 0, 0)"}).draw(e=>{e.beginPath(),e.strokeStyle="rgb(255, 255, 255)",e.lineWidth=4,e.strokeRect(0,0,512,512),e.closePath()}).get()));const sn=class extends l.Sprite{constructor(e){super();h(this,"target");h(this,"type","VisSpriteHelper");this.target=e,this.material.dispose(),this.material=new l.SpriteMaterial({color:"rgb(255, 255, 255)",alphaMap:sn.alphaTexture,transparent:!0,depthWrite:!1}),this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.matrix=e.matrix,this.matrixWorld=e.matrixWorld,this.raycast=()=>{}}};let Xt=sn;h(Xt,"alphaTexture",new l.CanvasTexture(new qe({width:512,height:512,bgColor:"rgb(0, 0, 0)"}).draw(e=>{e.beginPath(),e.strokeStyle="rgb(255, 255, 255)",e.lineWidth=4,e.strokeRect(0,0,512,512),e.closePath()}).get()));class Nc extends re{constructor(e={}){super();h(this,"helperGenerator",{[a.CONFIGTYPE.POINTLIGHT]:ds,[a.CONFIGTYPE.SPOTLIGHT]:hs,[a.CONFIGTYPE.DIRECTIONALLIGHT]:us,[a.CONFIGTYPE.PERSPECTIVECAMERA]:Wt,[a.CONFIGTYPE.ORTHOGRAPHICCAMERA]:Wt,[a.CONFIGTYPE.MESH]:vc,[a.CONFIGTYPE.GROUP]:Rt,[a.CONFIGTYPE.SPRITE]:Xt,[a.CONFIGTYPE.POINTS]:Kt,[a.CONFIGTYPE.LINE]:$t,[a.CONFIGTYPE.CSS3DOBJECT]:Ic,[a.CONFIGTYPE.CSS3DPLANE]:ps,[a.CONFIGTYPE.CSS3DSPRITE]:ps});h(this,"helperFilter",{AmbientLight:!0,Object3D:!0,TransformControls:!0,Scene:!0});h(this,"objectFilter",new Set);h(this,"objectHelperMap",new Map);e.helperGenerator&&(this.helperGenerator=Object.assign(this.helperGenerator,e.helperGenerator)),e.helperFilter&&(this.helperFilter=Object.assign(this.helperFilter,e.helperFilter)),e.objectFilter&&(this.objectFilter=new Set(e.objectFilter.concat(Array.from(this.objectFilter))))}addFilteredObject(...e){for(const t of e)this.objectFilter.add(t);return this}addObjectHelper(e){if(this.objectFilter.has(e)||this.objectHelperMap.has(e)||this.helperFilter[e.type]||e.type.toLocaleLowerCase().includes("helper"))return null;if(!this.helperGenerator[e.type])return console.warn(`object helper can not support this type object: '${e.type}'`),null;const t=new this.helperGenerator[e.type](e);return this.objectHelperMap.set(e,t),t}disposeObjectHelper(e){if(this.objectFilter.has(e)||this.helperFilter[e.type]||e.type.toLocaleLowerCase().includes("helper"))return null;if(!this.objectHelperMap.has(e))return console.warn("object helper manager can not found this object`s helper: ",e),null;const t=this.objectHelperMap.get(e);return t.geometry&&t.geometry.dispose(),t.material&&(t.material instanceof l.Material?t.material.dispose():t.material.forEach(s=>{s.dispose()})),this.objectHelperMap.delete(e),t}}const Gc=function(n={}){if(!this.scene)return console.error("must install some scene plugin before ObjectHelper plugin."),!1;n.interact===void 0&&(n.interact=!0),n.interact&&(this.eventManager||(console.warn("must install eventManager plugin that can use interact function."),n.interact=!1));const e=new Nc,t=new Map,s=new Map,r=new Map,i=e.objectHelperMap;this.objectHelperManager=e,!n.activeColor&&(n.activeColor="rgb(230, 20, 240)"),!n.hoverColor&&(n.hoverColor="rgb(255, 158, 240)"),!n.defaultColor&&(n.defaultColor="rgb(255, 255, 255)"),!n.selectedColor&&(n.selectedColor=n.activeColor);const o=new l.Color(n.defaultColor).getHex(),c=new l.Color(n.activeColor).getHex(),u=new l.Color(n.hoverColor).getHex(),d=new l.Color(n.selectedColor).getHex(),p=new WeakSet,f=C=>{const M=C.objects;for(const y of M){const O=e.addObjectHelper(y);if(!!O&&(O.material.color.setHex(o),this.scene.add(O),n.interact)){const b=()=>{var S;((S=this.transformControls)==null?void 0:S.dragging)||this.selectionBox&&this.selectionBox.has(y)||O.material.color.setHex(u)},R=()=>{var S;((S=this.transformControls)==null?void 0:S.dragging)||this.selectionBox&&this.selectionBox.has(y)||O.material.color.setHex(o)},G=()=>{var S;((S=this.transformControls)==null?void 0:S.dragging)||this.selectionBox&&this.selectionBox.has(y)||O.material.color.setHex(c)};y.addEventListener("pointerenter",b),y.addEventListener("pointerleave",R),y.addEventListener("click",G),t.set(y,b),s.set(y,R),r.set(y,G)}}},g=C=>{const M=C.objects;for(const y of M){const O=e.disposeObjectHelper(y);!O||(this.scene.remove(O),n.interact&&(y.removeEventListener("pointerenter",t.get(y)),y.removeEventListener("pointerleave",s.get(y)),y.removeEventListener("click",r.get(y)),t.delete(y),s.delete(y),r.delete(y)))}},E=C=>{p.has(C)||(C.traverse(M=>{const y=e.addObjectHelper(M);y&&C.add(y)}),p.add(C))};this.scene.addEventListener("afterAdd",f),this.scene.addEventListener("afterRemove",g),this.setObjectHelper=function(C){return C.show?this.scene.traverse(M=>{i.has(M)&&this.scene.add(i.get(M))}):this.scene.traverse(M=>{i.has(M)&&this.scene.remove(i.get(M))}),this},this.addEventListener("setScene",C=>{const M=C.scene;!p.has(M)&&E(M),M.hasEventListener("afterAdd",f)||M.addEventListener("afterAdd",f),M.hasEventListener("afterRemove",g)||M.addEventListener("afterRemove",g)});const T=new Set;return this.completeSet.add(()=>{this.selectionBox&&this.addEventListener("selected",C=>{T.forEach(M=>{M.material.color.setHex(o)}),T.clear();for(const M of C.objects)if(i.has(M)){const y=i.get(M);y.material.color.setHex(d),T.add(y)}})}),!0},Dc=function(n={}){if(this.selectionBox)return console.warn("engine has installed selection plugin."),!1;if(!this.eventManager)return console.warn("must install eventManager plugin before Selection plugin."),!1;this.selectionBox=new Set;const e=()=>{const t=[];this.IS_ENGINESUPPORT&&this.selectionBox.forEach(s=>{const r=this.compilerManager.getObjectSymbol(s);r?t.push(r):console.warn("selection plugin can not font vid in compilerManager.",s)}),this.dispatchEvent({type:"selected",objects:[...this.selectionBox],objectSymbols:t})};return this.setSelectionBox=function(t){this.selectionBox.clear();for(const s of t.objects)this.selectionBox.add(s);return e(),this},this.eventManager.addEventListener("click",t=>{var r,i,o;if(this.transing){this.transing=!1;return}const s=t.intersections;if(t.ctrlKey||this.selectionBox.clear(),this.eventManager.penetrate)for(const c of s){if(t.ctrlKey&&((r=this.selectionBox)==null?void 0:r.has(c.object))){this.selectionBox.delete(c.object);continue}this.selectionBox.add(c.object)}else if(s.length){const c=s[0].object;if(t.ctrlKey&&((i=this.selectionBox)==null?void 0:i.has(c))){this.selectionBox.delete(c);return}(o=this.selectionBox)==null||o.add(c)}e()}),!0},Fc=function(n={}){if(this.css3DRenderer)return console.warn("this has installed css3DRenderer plugin."),!1;this.css3DRenderer=new Oe.CSS3DRenderer;const e=this.css3DRenderer.domElement;if(e.classList.add("vis-css3D"),e.style.position="absolute",e.style.top="0",e.style.left="0",this.addEventListener("setDom",t=>{t.dom.appendChild(this.css3DRenderer.domElement)}),this.addEventListener("setSize",t=>{this.css3DRenderer.setSize(t.width,t.height)}),this.addEventListener("setScene",t=>{t.oldScene.traverse(r=>{r instanceof Oe.CSS3DObject&&(r.element.style.display="none")})}),this.renderManager)this.renderManager.removeEventListener("render",this.render),this.renderManager.addEventListener("render",t=>{this.css3DRenderer.render(this.scene,this.camera)});else if(this.webGLRenderer){const t=this.render.bind(this);this.render=function(){return t(),this.webGLRenderer.render(this.scene,this.camera),this}}else this.render=function(){return this.webGLRenderer.render(this.scene,this.camera),this};return!0};a.ENGINEPLUGIN=void 0,function(n){n.WEBGLRENDERER="WebGLRenderer",n.CSS3DRENDERER="CSS3DRenderer",n.SCENE="Scene",n.MODELINGSCENE="ModelingScene",n.RENDERMANAGER="RenderManager",n.ORBITCONTROLS="OrbitControls",n.STATS="Stats",n.EFFECTCOMPOSER="EffectComposer",n.POINTERMANAGER="PointerManager",n.EVENTMANAGER="EventManager",n.TRANSFORMCONTROLS="TransformControls",n.LOADERMANAGER="LoaderManager",n.RESOURCEMANAGER="ResourceManager",n.DATASUPPORTMANAGER="DataSupportManager",n.COMPILERMANAGER="CompilerManager",n.KEYBOARDMANAGER="KeyboardManager",n.AXESHELPER="AxesHelper",n.GRIDHELPER="GridHelper",n.VIEWPOINT="Viewpoint",n.DISPLAYMODE="DisplayMode",n.OBJECTHELPER="ObjectHelper",n.SELECTION="Selection"}(a.ENGINEPLUGIN||(a.ENGINEPLUGIN={}));const Ne=class extends re{constructor(){super();h(this,"completeSet");h(this,"camera",new l.PerspectiveCamera);h(this,"scene",new l.Scene);h(this,"IS_ENGINESUPPORT",!1);h(this,"dom");h(this,"webGLRenderer");h(this,"css3DRenderer");h(this,"orbitControls");h(this,"transformControls");h(this,"effectComposer");h(this,"renderManager");h(this,"pointerManager");h(this,"eventManager");h(this,"loaderManager");h(this,"resourceManager");h(this,"dataSupportManager");h(this,"compilerManager");h(this,"keyboardManager");h(this,"objectHelperManager");h(this,"transing");h(this,"stats");h(this,"displayMode");h(this,"selectionBox");h(this,"getScreenshot");h(this,"setStats");h(this,"setTransformControls");h(this,"setViewpoint");h(this,"setDisplayMode");h(this,"setAxesHelper");h(this,"setGridHelper");h(this,"setObjectHelper");h(this,"setSelectionBox");h(this,"loadResources");h(this,"loadResourcesAsync");h(this,"registerResources");h(this,"toJSON");h(this,"exportConfig");h(this,"applyConfig");h(this,"reactiveConfig");h(this,"getConfigBySymbol");h(this,"removeConfigBySymbol");h(this,"getObjectSymbol");h(this,"getObjectBySymbol");h(this,"play");h(this,"stop");h(this,"render");this.completeSet=new Set,this.render=function(){return console.warn("can not install some plugin"),this},this.camera.position.set(50,50,50),this.addEventListener("setSize",e=>{this.camera.aspect=e.width/e.height,this.camera.updateProjectionMatrix()})}optimizeMemory(){Object.keys(this).forEach(e=>{this[e]===void 0&&delete this[e]})}install(e,t){return Ne.pluginHandler.has(e)?Ne.pluginHandler.get(e).call(this,t):console.error(`engine can not support ${e} plugin.`),this}complete(){return this.completeSet.forEach(e=>{e(this)}),this.completeSet.clear(),this}dispose(){return this.dispatchEvent({type:"dispose"}),this}setDom(e){return this.dom=e,this.dispatchEvent({type:"setDom",dom:e}),this}setSize(e,t){var s,r;return e&&e<=0||t&&t<=0?(console.warn(`you must be input width and height bigger then zero, width: ${e}, height: ${t}`),this):(!e&&(e=((s=this.dom)==null?void 0:s.offsetWidth)||window.innerWidth),!t&&(t=((r=this.dom)==null?void 0:r.offsetHeight)||window.innerHeight),this.dispatchEvent({type:"setSize",width:e,height:t}),this)}setCamera(e,t){if(typeof e=="object"&&e instanceof l.Camera)this.camera=e,this.dispatchEvent({type:"setCamera",camera:e,options:Object.assign({orbitControls:!0,transformControls:!0},t||{})});else if(this.IS_ENGINESUPPORT){const s=this.compilerManager.getObjectBySymbol(e);s?(this.camera=s,this.dispatchEvent({type:"setCamera",camera:s,options:Object.assign({orbitControls:!0,transformControls:!0},t||{})})):console.warn(`can not found camera in compilerManager: ${e}`)}else console.warn("engine is not a Engine support but use symbol to found camera.");return this}setScene(e){if(typeof e=="object"&&e instanceof l.Scene)this.dispatchEvent({type:"setScene",scene:e,oldScene:this.scene}),this.scene=e;else if(this.IS_ENGINESUPPORT){const t=this.compilerManager.getObjectBySymbol(e);t?(this.dispatchEvent({type:"setScene",scene:t,oldScene:this.scene}),this.scene=t):console.warn(`can not found scene in compilerManager: ${e}`)}else console.warn("engine is not a Engine support but use symbol to found scene.");return this}};let F=Ne;h(F,"pluginHandler",new Map),h(F,"register",function(e,t){return Ne.pluginHandler&&Ne.pluginHandler.set(e,t),Ne}),h(F,"dispose",function(){Ne.pluginHandler=void 0}),F.register(a.ENGINEPLUGIN.WEBGLRENDERER,Ws),F.register(a.ENGINEPLUGIN.CSS3DRENDERER,Fc),F.register(a.ENGINEPLUGIN.EFFECTCOMPOSER,Ys),F.register(a.ENGINEPLUGIN.RENDERMANAGER,Ds),F.register(a.ENGINEPLUGIN.POINTERMANAGER,Hs),F.register(a.ENGINEPLUGIN.EVENTMANAGER,zs),F.register(a.ENGINEPLUGIN.LOADERMANAGER,Pr),F.register(a.ENGINEPLUGIN.RESOURCEMANAGER,Hi),F.register(a.ENGINEPLUGIN.DATASUPPORTMANAGER,fo),F.register(a.ENGINEPLUGIN.COMPILERMANAGER,Rc),F.register(a.ENGINEPLUGIN.KEYBOARDMANAGER,Lc),F.register(a.ENGINEPLUGIN.ORBITCONTROLS,xs),F.register(a.ENGINEPLUGIN.TRANSFORMCONTROLS,Vs),F.register(a.ENGINEPLUGIN.AXESHELPER,wc),F.register(a.ENGINEPLUGIN.GRIDHELPER,Pc),F.register(a.ENGINEPLUGIN.OBJECTHELPER,Gc),F.register(a.ENGINEPLUGIN.DISPLAYMODE,Ac),F.register(a.ENGINEPLUGIN.VIEWPOINT,Fs),F.register(a.ENGINEPLUGIN.STATS,Bs),F.register(a.ENGINEPLUGIN.SELECTION,Dc);class xc extends F{constructor(){super();this.install(a.ENGINEPLUGIN.WEBGLRENDERER,{antialias:!0,alpha:!0}).install(a.ENGINEPLUGIN.RENDERMANAGER).install(a.ENGINEPLUGIN.EFFECTCOMPOSER,{WebGLMultisampleRenderTarget:!0}).install(a.ENGINEPLUGIN.ORBITCONTROLS).install(a.ENGINEPLUGIN.POINTERMANAGER).install(a.ENGINEPLUGIN.EVENTMANAGER).complete()}}class Uc extends F{constructor(){super();this.install(a.ENGINEPLUGIN.RENDERMANAGER).install(a.ENGINEPLUGIN.WEBGLRENDERER,{antialias:!0,alpha:!0}).install(a.ENGINEPLUGIN.POINTERMANAGER).install(a.ENGINEPLUGIN.EVENTMANAGER).install(a.ENGINEPLUGIN.EFFECTCOMPOSER,{WebGLMultisampleRenderTarget:!0}).install(a.ENGINEPLUGIN.SELECTION).install(a.ENGINEPLUGIN.AXESHELPER).install(a.ENGINEPLUGIN.GRIDHELPER).install(a.ENGINEPLUGIN.OBJECTHELPER).install(a.ENGINEPLUGIN.VIEWPOINT).install(a.ENGINEPLUGIN.DISPLAYMODE).install(a.ENGINEPLUGIN.STATS).install(a.ENGINEPLUGIN.ORBITCONTROLS).install(a.ENGINEPLUGIN.KEYBOARDMANAGER).install(a.ENGINEPLUGIN.TRANSFORMCONTROLS).complete()}}class Bc{constructor(){h(this,"supportData");h(this,"supportDataType")}create(e){return e?(this.supportData={},this.supportDataType=e,this):(console.warn("you must give a module type in create params"),this)}add(e){return!this.supportData||!this.supportDataType?(console.warn("you must call 'create' method before the 'add' method"),this):e.type?ke(e.type)!==this.supportDataType?(console.warn(`current generator create config which module is in: ${this.supportDataType}, but you provide type is '${e.type}'`),this):(this.supportData[e.vid]=X(e.type,e),this):(console.warn("config can not found attribute 'type'"),this)}get(){return this.supportDataType=void 0,this.supportData?this.supportData:{}}}const Qt=new l.PointLight("rgb(255, 255, 255)",.5,200,1);Qt.position.set(-30,5,20),Qt.castShadow=!0;const Lt=new l.Mesh(new l.BoxBufferGeometry(80,2,80),new l.MeshStandardMaterial({color:"rgb(255, 255, 255)"}));Lt.position.set(0,-11,0),Lt.receiveShadow=!0,Lt.castShadow=!0;const de=class{constructor(e){h(this,"material");h(this,"dom");h(this,"renderer");h(this,"scene");h(this,"camera");h(this,"object");const t=new l.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0});t.setPixelRatio(window.devicePixelRatio),t.setClearColor("rgb(150, 150, 150)"),t.shadowMap.enabled=!0,t.shadowMap.type=l.PCFSoftShadowMap;const s=new l.Scene,r=new l.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,500);r.position.set(0,0,35),r.up.x=0,r.up.y=1,r.up.z=0,r.lookAt(new l.Vector3(0,0,0)),s.add(de.ambientLight),s.add(de.pointLight),s.add(de.plane),this.scene=s,this.renderer=t,this.camera=r,this.object=new l.Object3D,(e==null?void 0:e.material)&&this.setMaterial(e.material),(e==null?void 0:e.dom)&&this.setDom(e.dom)}setMaterial(e){if(this.scene.remove(this.object),this.material=e,e.type.includes("Mesh"))this.object=new l.Mesh(de.geometry,e);else if(e.type.includes("Line"))this.object=new l.Line(de.geometry,e);else if(e.type.includes("Ponits"))this.object=new l.Points(de.geometry,e);else if(e.type.includes("Sprite"))this.object=new l.Sprite(e);else return console.warn(`material displayer can not support this type material: '${e.type}'`),this;return this.object.castShadow=!0,this.object.receiveShadow=!0,this.scene.add(this.object),this}setDom(e){return this.dom=e,this.setSize(),e.appendChild(this.renderer.domElement),this}setSize(e,t){if(e&&t)this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t,!0);else{if(!this.dom)return console.warn("material displayer must set dom before setSize with empty parameters"),this;const s=this.dom;this.camera.aspect=s.offsetWidth/s.offsetHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(s.offsetWidth,s.offsetHeight,!0)}return this}render(){this.renderer.render(this.scene,this.camera)}getDataURL(e){return this.renderer.domElement.toDataURL(e||"image/png")}dispose(){this.renderer.dispose()}};let He=de;h(He,"ambientLight",new l.AmbientLight("rgb(255, 255, 255)",.7)),h(He,"pointLight",Qt),h(He,"geometry",new l.SphereBufferGeometry(10,12,12)),h(He,"plane",Lt),h(He,"dispose",()=>{de.geometry.dispose(),de.plane.geometry.dispose()});const rn=class{constructor(e){h(this,"dom");h(this,"texture");h(this,"renderer");h(this,"scene");h(this,"camera");const t=new l.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0});t.setPixelRatio(window.devicePixelRatio),t.setClearColor("rgb(150, 150, 150)"),t.shadowMap.enabled=!0,t.shadowMap.type=l.PCFSoftShadowMap;const s=new l.Scene,r=new l.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,500);r.position.set(0,0,35),r.up.x=0,r.up.y=1,r.up.z=0,r.lookAt(new l.Vector3(0,0,0)),s.add(rn.ambientLight),this.scene=s,this.renderer=t,this.camera=r,(e==null?void 0:e.texture)&&this.setTexture(e.texture),(e==null?void 0:e.dom)&&this.setDom(e.dom)}setTexture(e){return this.scene.background=e,this}setDom(e){return this.dom=e,this.setSize(),e.appendChild(this.renderer.domElement),this}setSize(e,t){if(e&&t)this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t,!0);else{if(!this.dom)return console.warn("texture displayer must set dom before setSize with empty parameters"),this;const s=this.dom;this.camera.aspect=s.offsetWidth/s.offsetHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(s.offsetWidth,s.offsetHeight,!0)}return this}render(){this.renderer.render(this.scene,this.camera)}getDataURL(e){return this.renderer.domElement.toDataURL(e||"image/png")}dispose(){this.renderer.dispose()}};let qt=rn;h(qt,"ambientLight",new l.AmbientLight("rgb(255, 255, 255)",1));class Jt extends F{constructor(e={},t={}){super();h(this,"IS_ENGINESUPPORT",!0);this.install(a.ENGINEPLUGIN.LOADERMANAGER).install(a.ENGINEPLUGIN.RESOURCEMANAGER,{resources:t}).install(a.ENGINEPLUGIN.POINTERMANAGER).install(a.ENGINEPLUGIN.EVENTMANAGER).install(a.ENGINEPLUGIN.RENDERMANAGER).install(a.ENGINEPLUGIN.DATASUPPORTMANAGER,e).install(a.ENGINEPLUGIN.COMPILERMANAGER)}loadLifeCycle(e){const t=this.dataSupportManager;e.texture&&t.load({texture:e.texture}),e.material&&t.load({material:e.material}),delete e.texture,delete e.material,t.load(e)}removeLifeCycle(e){const t=this.dataSupportManager,s=e[a.MODULETYPE.TEXTURE]||{},r=e[a.MODULETYPE.MATERIAL]||{},i=e.assets||[];delete e.texture,delete e.material,delete e.assets,t.remove(e),t.remove({[a.MODULETYPE.MATERIAL]:r}),t.remove({[a.MODULETYPE.TEXTURE]:s});const o=this.resourceManager,c=this.loaderManager;i.forEach(u=>{o.remove(u),c.remove(u)})}loadConfig(e,t){const s=this.renderManager.hasRendering();if(s&&this.renderManager.stop(),e.assets&&e.assets.length){const r=i=>{delete e.assets,this.loadLifeCycle(e),this.resourceManager.removeEventListener("mapped",r),t&&t(i),s?this.renderManager.play():this.renderManager.render()};this.resourceManager.addEventListener("mapped",r),this.loaderManager.reset().load(e.assets)}else this.loadLifeCycle(e),t&&t(),s?this.renderManager.play():this.renderManager.render();return this}loadConfigAsync(e){return new Promise((t,s)=>{const r=this.renderManager.hasRendering();if(r&&this.renderManager.stop(),e.assets&&e.assets.length){const i=o=>{delete e.assets,this.loadLifeCycle(e),this.resourceManager.removeEventListener("mapped",i),r?this.renderManager.play():this.renderManager.render(),t(o)};this.resourceManager.addEventListener("mapped",i),this.loaderManager.reset().load(e.assets)}else this.loadLifeCycle(e),r?this.renderManager.play():this.renderManager.render(),t(void 0)})}removeConfig(e){this.removeLifeCycle(e)}getObjectConfig(e){const t=this.getObjectSymbol(e);return t?this.getConfigBySymbol(t):null}}class jc extends Jt{constructor(e){super(e);h(this,"IS_ENGINESUPPORT",!0);this.install(a.ENGINEPLUGIN.WEBGLRENDERER,{antialias:!0,alpha:!0}).install(a.ENGINEPLUGIN.EFFECTCOMPOSER,{WebGLMultisampleRenderTarget:!0}).install(a.ENGINEPLUGIN.SELECTION).install(a.ENGINEPLUGIN.AXESHELPER).install(a.ENGINEPLUGIN.GRIDHELPER).install(a.ENGINEPLUGIN.OBJECTHELPER).install(a.ENGINEPLUGIN.VIEWPOINT).install(a.ENGINEPLUGIN.DISPLAYMODE).install(a.ENGINEPLUGIN.STATS).install(a.ENGINEPLUGIN.ORBITCONTROLS).install(a.ENGINEPLUGIN.KEYBOARDMANAGER).install(a.ENGINEPLUGIN.TRANSFORMCONTROLS).complete()}}class Yc extends Jt{constructor(e){super(e);this.install(a.ENGINEPLUGIN.WEBGLRENDERER,{antialias:!0,alpha:!0}).install(a.ENGINEPLUGIN.EFFECTCOMPOSER,{WebGLMultisampleRenderTarget:!0}).install(a.ENGINEPLUGIN.ORBITCONTROLS).complete()}}class _c{constructor(e){h(this,"visible",!0);e.visible&&(this.visible=e.visible)}}class Hc extends _c{constructor(e){super(e);h(this,"source");h(this,"target");h(this,"mode");h(this,"cacheSourceMatrix");h(this,"cacheTargetMatrix");h(this,"cacheSoruceGeometryUuid");h(this,"cacheTargetGeometryUuid");h(this,"originalGeometry");h(this,"modifiedGeometry");this.source=e.source,this.target=e.target,this.mode=e.mode||"subtract",this.cacheSourceMatrix=this.source.matrix.clone(),this.cacheTargetMatrix=this.target.matrix.clone(),this.cacheSoruceGeometryUuid=this.source.geometry.uuid,this.cacheTargetGeometryUuid=this.target.geometry.uuid,this.originalGeometry=this.source.geometry,this.modifiedGeometry=new l.BufferGeometry,this.modify(),this.source.geometry=this.modifiedGeometry}async modify(){const e=this.source,t={geometry:this.originalGeometry,matrix:this.source.matrix},s=vt.CSG.fromMesh(t),r=vt.CSG.fromMesh(this.target),i=vt.CSG.toGeometry(s[this.mode](r),e.matrix);this.modifiedGeometry.copy(i),this.modifiedGeometry.uuid=i.uuid}render(){if(this.visible){if(!this.cacheSourceMatrix.equals(this.source.matrix)){this.modify(),this.cacheSourceMatrix.copy(this.source.matrix);return}if(!this.cacheTargetMatrix.equals(this.target.matrix)){this.modify(),this.cacheTargetMatrix.copy(this.target.matrix);return}if(this.originalGeometry.uuid!==this.cacheSoruceGeometryUuid){this.modify(),this.cacheSoruceGeometryUuid=this.originalGeometry.uuid;return}if(this.target.geometry.uuid!==this.cacheTargetGeometryUuid){this.modify(),this.cacheTargetGeometryUuid=this.target.geometry.uuid;return}}else this.modifiedGeometry.copy(this.originalGeometry)}apply(){this.originalGeometry.copy(this.modifiedGeometry),this.originalGeometry.uuid=this.modifiedGeometry.uuid,this.source.geometry=this.originalGeometry}dispose(){this.source.geometry=this.originalGeometry,this.modifiedGeometry.dispose()}}class kc{next(){console.warn(`this action can not set next function: ${this.constructor.name}`)}prev(){console.warn(`this action can not set prev function: ${this.constructor.name}`)}}class zc{constructor(e){h(this,"actionList",[]);h(this,"index",-1);h(this,"step",50);this.step=e||50}do(e){this.actionList[this.index][e]()}apply(e,t=!1){const s=this.actionList;this.index===s.length-1&&s.length>=this.step?(s.shift(),this.index=this.actionList.length-1):this.index!==-1?s.splice(this.index+1,s.length-1):this.index===-1&&(this.actionList=[]),this.actionList.push(e),t?this.redo():this.index+=1}redo(){if(this.index+=1,this.index>this.actionList.length-1){this.index=this.actionList.length-1;return}this.do("next")}undo(){this.index<0||(this.do("prev"),this.index-=1)}clear(){this.actionList=[]}}const Vc="0.2.3";window.__THREE__||console.error("vis-three dependent on three.js module, pleace run 'npm i three' first."),window.__VIS__?console.warn("Duplicate vis-three frames are introduced"):window.__VIS__=Vc,l.Scene.prototype.add=function(...n){if(!arguments.length)return this;if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}const e=n[0];if(e===this)return console.error("THREE.Object3D.add: object can't be added as a child of itself.",n),this;if(e&&e.isObject3D){if(e.parent!==null){const t=this.children.indexOf(e);t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent({type:"removed"}))}e.parent=this,this.children.push(e),e.dispatchEvent({type:"added"})}else console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",n);return this};const Wc=l.Scene.prototype.add,$c=l.Scene.prototype.remove;l.Scene.prototype.add=function(...n){return Wc.call(this,...n),this.dispatchEvent({type:"afterAdd",objects:n}),this},l.Scene.prototype.remove=function(...n){return $c.call(this,...n),this.dispatchEvent({type:"afterRemove",objects:n}),this};const Zt=new Ns.LightShadow(new l.OrthographicCamera(-256,256,256,-256));Zt.autoUpdate=!1,Zt.needsUpdate=!1,l.AmbientLight.prototype.shadow=Zt,a.Action=kc,a.AniScriptLibrary=Re,a.AnimationDataSupport=Xn,a.BooleanModifier=Hc,a.CONFIGMODULE=Ar,a.CSS3DDataSupport=Qn,a.CSS3DPlane=ts,a.CameraDataSupport=jn,a.CameraHelper=Wt,a.CanvasGenerator=qe,a.ControlsDataSupport=Hn,a.DataSupportManager=qn,a.DirectionalLightHelper=us,a.DisplayEngine=xc,a.DisplayEngineSupport=Yc,a.Engine=F,a.EngineSupport=Jt,a.EventDispatcher=re,a.EventLibrary=x,a.GeometryDataSupport=Bn,a.GroupDataSupport=$n,a.GroupHelper=Rt,a.History=zc,a.JSONHandler=ki,a.KeyboardManager=ls,a.LightDataSupport=Un,a.LineDataSupport=zn,a.LoaderManager=Rn,a.MaterialDataSupport=xn,a.MaterialDisplayer=He,a.MeshDataSupport=Vn,a.ModelingEngine=Uc,a.ModelingEngineSupport=jc,a.PassDataSupport=Kn,a.PointLightHelper=ds,a.PointsDataSupport=Wn,a.ProxyBroadcast=ze,a.RenderManager=hn,a.RendererDataSupport=Yn,a.ResourceManager=Nn,a.SceneDataSupport=_n,a.SelectiveBloomPass=it,a.ShaderLibrary=ee,a.SpotLightHelper=hs,a.SpriteDataSupport=kn,a.SupportDataGenerator=Bc,a.TextureDataSupport=Fn,a.TextureDisplayer=qt,a.Translater=Dn,a.Utils=Bi,a.VideoLoader=Fe,a.generateConfig=X,a.getModule=ke,Object.defineProperty(a,"__esModule",{value:!0}),a[Symbol.toStringTag]="Module"});
