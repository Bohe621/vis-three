var _c=Object.defineProperty,kc=Object.defineProperties;var zc=Object.getOwnPropertyDescriptors;var gs=Object.getOwnPropertySymbols;var Vc=Object.prototype.hasOwnProperty,Wc=Object.prototype.propertyIsEnumerable;var on=(a,l,z)=>l in a?_c(a,l,{enumerable:!0,configurable:!0,writable:!0,value:z}):a[l]=z,H=(a,l)=>{for(var z in l||(l={}))Vc.call(l,z)&&on(a,z,l[z]);if(gs)for(var z of gs(l))Wc.call(l,z)&&on(a,z,l[z]);return a},it=(a,l)=>kc(a,zc(l));var d=(a,l,z)=>(on(a,typeof l!="symbol"?l+"":l,z),z);(function(a,l){typeof exports=="object"&&typeof module!="undefined"?l(exports,require("three"),require("three/examples/jsm/libs/stats.module"),require("three/examples/jsm/postprocessing/EffectComposer"),require("three/examples/jsm/postprocessing/RenderPass"),require("three/examples/jsm/controls/TransformControls"),require("three/examples/jsm/loaders/OBJLoader"),require("three/examples/jsm/loaders/MTLLoader"),require("three/examples/jsm/loaders/RGBELoader"),require("uuid"),require("three/examples/jsm/renderers/CSS3DRenderer"),require("@tweenjs/tween.js"),require("three/examples/jsm/postprocessing/SMAAPass"),require("three/examples/jsm/postprocessing/UnrealBloomPass"),require("three/examples/jsm/postprocessing/Pass"),require("three/examples/jsm/shaders/LuminosityHighPassShader"),require("keyboardjs"),require("three-csg-ts"),require("three/src/lights/LightShadow")):typeof define=="function"&&define.amd?define(["exports","three","three/examples/jsm/libs/stats.module","three/examples/jsm/postprocessing/EffectComposer","three/examples/jsm/postprocessing/RenderPass","three/examples/jsm/controls/TransformControls","three/examples/jsm/loaders/OBJLoader","three/examples/jsm/loaders/MTLLoader","three/examples/jsm/loaders/RGBELoader","uuid","three/examples/jsm/renderers/CSS3DRenderer","@tweenjs/tween.js","three/examples/jsm/postprocessing/SMAAPass","three/examples/jsm/postprocessing/UnrealBloomPass","three/examples/jsm/postprocessing/Pass","three/examples/jsm/shaders/LuminosityHighPassShader","keyboardjs","three-csg-ts","three/src/lights/LightShadow"],l):(a=typeof globalThis!="undefined"?globalThis:a||self,l(a.Vis={},a.three,a.Stats,a.EffectComposer,a.RenderPass,a.TransformControls,a.OBJLoader,a.MTLLoader,a.RGBELoader,a.uuid,a.CSS3DRenderer,a.tween_js,a.SMAAPass,a.UnrealBloomPass,a.Pass,a.LuminosityHighPassShader,a.keyboardjs,a.threeCsgTs,a.LightShadow))})(this,function(a,l,z,Pt,vt,Es,Ts,ys,Ms,ee,we,N,Ss,Os,an,cn,Cs,At,bs){"use strict";function ln(n){return n&&typeof n=="object"&&"default"in n?n:{default:n}}var Rs=ln(z),rt=ln(Cs);class te{constructor(){d(this,"listeners",new Map)}addEventListener(e,t){const s=this.listeners;s.has(e)||s.set(e,new Set),s.get(e).add(t)}hasEventListener(e,t){const s=this.listeners;return s.has(e)?s.get(e).has(t):!1}removeEventListener(e,t){const s=this.listeners;!s.has(e)||!s.get(e).has(t)||s.get(e).delete(t)}dispatchEvent(e){var i;const t=e.type,s=this.listeners;if(s.has(t))try{(i=s.get(t))==null||i.forEach(r=>{r.call(this,e)})}catch(r){console.error(r)}}clear(){this.listeners=new Map}useful(){return Boolean([...this.listeners.keys()].length)}once(e,t){const s=function(i){t.call(this,i),this.removeEventListener(e,s)};this.addEventListener(e,s)}}class un extends te{constructor(e=0){super();d(this,"clock",new l.Clock);d(this,"animationFrame",-1);d(this,"fps",0);d(this,"timer",null);d(this,"playFun",()=>{});d(this,"render",()=>{this.dispatchEvent({type:"render",delta:this.clock.getDelta(),total:this.clock.getElapsedTime()})});d(this,"play",()=>{if(this.hasRendering()){console.warn("render manager is rendering.");return}this.dispatchEvent({type:"play"}),this.playFun()});d(this,"stop",()=>{this.animationFrame!==-1&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=-1),this.timer&&(clearTimeout(this.timer),this.timer=null),this.dispatchEvent({type:"stop"})});d(this,"hasRendering",()=>Boolean(this.animationFrame!==-1||this.timer));d(this,"hasVaildRender",()=>this.useful());this.setFPS(e)}setFPS(e){return this.animationFrame!==-1&&cancelAnimationFrame(this.animationFrame),this.timer&&clearTimeout(this.timer),this.fps=e,e<=0?(this.fps=0,this.playFun=()=>{this.render(),this.animationFrame=requestAnimationFrame(this.playFun)}):this.playFun=()=>{this.timer=setTimeout(()=>{this.playFun()},e),this.render()},this.playFun(),this}dispose(){this.hasRendering()&&this.stop(),this.clear()}}const Ls=function(){return this.renderManager?(console.warn("has installed render manager plugin."),!1):(this.renderManager=new un,this.render=function(){return this.renderManager.render(),this},this.play=function(){return this.renderManager.play(),this},this.stop=function(){return this.renderManager.stop(),this},this.addEventListener("dispose",()=>{this.renderManager.dispose()}),!0)};class dn extends te{constructor(e,t){super();d(this,"object");d(this,"domElement");d(this,"enabled",!0);d(this,"target",new l.Vector3);d(this,"minDistance",0);d(this,"maxDistance",1/0);d(this,"minZoom",0);d(this,"maxZoom",1/0);d(this,"minPolarAngle",0);d(this,"maxPolarAngle",Math.PI);d(this,"minAzimuthAngle",-1/0);d(this,"maxAzimuthAngle",1/0);d(this,"enableDamping",!1);d(this,"dampingFactor",.05);d(this,"enableZoom",!0);d(this,"zoomSpeed",1);d(this,"enableRotate",!0);d(this,"rotateSpeed",1);d(this,"enablePan",!0);d(this,"panSpeed",1);d(this,"screenSpacePanning",!0);d(this,"keyPanSpeed",7);d(this,"autoRotate",!1);d(this,"autoRotateSpeed",2);d(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"});d(this,"mouseButtons",{LEFT:null,MIDDLE:l.MOUSE.DOLLY,RIGHT:l.MOUSE.ROTATE});d(this,"touches",{ONE:l.TOUCH.ROTATE,TWO:l.TOUCH.DOLLY_PAN});d(this,"target0");d(this,"position0");d(this,"zoom0");d(this,"_domElementKeyEvents",null);d(this,"spherical");d(this,"reset");d(this,"update");d(this,"onContextMenu");d(this,"onPointerDown");d(this,"onPointerCancel");d(this,"onMouseWheel");d(this,"onPointerMove");d(this,"onPointerUp");d(this,"onKeyDown");this.object=e||new l.PerspectiveCamera,this.domElement=t||document.createElement("div"),this.domElement.style.touchAction="none",this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.update=(()=>{const m=new l.Vector3,R=new l.Quaternion().setFromUnitVectors(this.object.up,new l.Vector3(0,1,0)),Y=R.clone().invert(),k=new l.Vector3,Re=new l.Quaternion,Le=2*Math.PI;return()=>{const ms=this.object.position;m.copy(ms).sub(this.target),m.applyQuaternion(R),o.setFromVector3(m),this.autoRotate&&i===s.NONE&&P(M()),this.enableDamping?(o.theta+=c.theta*this.dampingFactor,o.phi+=c.phi*this.dampingFactor):(o.theta+=c.theta,o.phi+=c.phi);let fe=this.minAzimuthAngle,me=this.maxAzimuthAngle;return isFinite(fe)&&isFinite(me)&&(fe<-Math.PI?fe+=Le:fe>Math.PI&&(fe-=Le),me<-Math.PI?me+=Le:me>Math.PI&&(me-=Le),fe<=me?o.theta=Math.max(fe,Math.min(me,o.theta)):o.theta=o.theta>(fe+me)/2?Math.max(fe,o.theta):Math.min(me,o.theta)),o.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,o.phi)),o.makeSafe(),o.radius*=u,o.radius=Math.max(this.minDistance,Math.min(this.maxDistance,o.radius)),this.enableDamping===!0?this.target.addScaledVector(h,this.dampingFactor):this.target.add(h),m.setFromSpherical(o),m.applyQuaternion(Y),ms.copy(this.target).add(m),this.object.lookAt(this.target),this.enableDamping===!0?(c.theta*=1-this.dampingFactor,c.phi*=1-this.dampingFactor,h.multiplyScalar(1-this.dampingFactor)):(c.set(0,0,0),h.set(0,0,0)),u=1,p||k.distanceToSquared(this.object.position)>r||8*(1-Re.dot(this.object.quaternion))>r?(this.dispatchEvent({type:"change"}),k.copy(this.object.position),Re.copy(this.object.quaternion),p=!1,!0):!1}})();const s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let i=s.NONE;const r=1e-6,o=new l.Spherical,c=new l.Spherical;let u=1;const h=new l.Vector3;let p=!1;const f=new l.Vector2,g=new l.Vector2,E=new l.Vector2,S=new l.Vector2,O=new l.Vector2,y=new l.Vector2,T=new l.Vector2,L=new l.Vector2,C=new l.Vector2,w=[],x={},M=()=>2*Math.PI/60/60*this.autoRotateSpeed,G=()=>Math.pow(.95,this.zoomSpeed),P=m=>{c.theta-=m},I=m=>{c.phi-=m},Lt=function(){const m=new l.Vector3;return function(Y,k){m.setFromMatrixColumn(k,0),m.multiplyScalar(-Y),h.add(m)}}(),xe=(()=>{const m=new l.Vector3;return(R,Y)=>{this.screenSpacePanning===!0?m.setFromMatrixColumn(Y,1):(m.setFromMatrixColumn(Y,0),m.crossVectors(this.object.up,m)),m.multiplyScalar(R),h.add(m)}})(),q=(()=>{const m=new l.Vector3;return(R,Y)=>{const k=this.domElement;if(this.object instanceof l.PerspectiveCamera){const Re=this.object.position;m.copy(Re).sub(this.target);let Le=m.length();Le*=Math.tan(this.object.fov/2*Math.PI/180),Lt(2*R*Le/k.clientHeight,this.object.matrix),xe(2*Y*Le/k.clientHeight,this.object.matrix)}else this.object instanceof l.OrthographicCamera?(Lt(R*(this.object.right-this.object.left)/this.object.zoom/k.clientWidth,this.object.matrix),xe(Y*(this.object.top-this.object.bottom)/this.object.zoom/k.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}})(),Q=m=>{this.object instanceof l.PerspectiveCamera?u/=m:this.object instanceof l.OrthographicCamera?(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*m)),this.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)},Fe=m=>{this.object instanceof l.PerspectiveCamera?u*=m:this.object instanceof l.OrthographicCamera?(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/m)),this.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)};function ie(m){f.set(m.clientX,m.clientY)}function wt(m){T.set(m.clientX,m.clientY)}function It(m){S.set(m.clientX,m.clientY)}const nn=m=>{g.set(m.clientX,m.clientY),E.subVectors(g,f).multiplyScalar(this.rotateSpeed);const R=this.domElement;P(2*Math.PI*E.x/R.clientHeight),I(2*Math.PI*E.y/R.clientHeight),f.copy(g),this.update()},wc=m=>{L.set(m.clientX,m.clientY),C.subVectors(L,T),C.y>0?Q(G()):C.y<0&&Fe(G()),T.copy(L),this.update()},Ic=m=>{O.set(m.clientX,m.clientY),y.subVectors(O,S).multiplyScalar(this.panSpeed),q(y.x,y.y),S.copy(O),this.update()},Pc=m=>{m.deltaY<0?Fe(G()):m.deltaY>0&&Q(G()),this.update()},vc=m=>{let R=!1;switch(m.code){case this.keys.UP:q(0,this.keyPanSpeed),R=!0;break;case this.keys.BOTTOM:q(0,-this.keyPanSpeed),R=!0;break;case this.keys.LEFT:q(this.keyPanSpeed,0),R=!0;break;case this.keys.RIGHT:q(-this.keyPanSpeed,0),R=!0;break}R&&(m.preventDefault(),this.update())};function as(){if(w.length===1)f.set(w[0].pageX,w[0].pageY);else{const m=.5*(w[0].pageX+w[1].pageX),R=.5*(w[0].pageY+w[1].pageY);f.set(m,R)}}function cs(){if(w.length===1)S.set(w[0].pageX,w[0].pageY);else{const m=.5*(w[0].pageX+w[1].pageX),R=.5*(w[0].pageY+w[1].pageY);S.set(m,R)}}function ls(){const m=w[0].pageX-w[1].pageX,R=w[0].pageY-w[1].pageY,Y=Math.sqrt(m*m+R*R);T.set(0,Y)}const Ac=()=>{this.enableZoom&&ls(),this.enablePan&&cs()},Nc=()=>{this.enableZoom&&ls(),this.enableRotate&&as()},us=m=>{if(w.length==1)g.set(m.pageX,m.pageY);else{const Y=rn(m),k=.5*(m.pageX+Y.x),Re=.5*(m.pageY+Y.y);g.set(k,Re)}E.subVectors(g,f).multiplyScalar(this.rotateSpeed);const R=this.domElement;P(2*Math.PI*E.x/R.clientHeight),I(2*Math.PI*E.y/R.clientHeight),f.copy(g)},ds=m=>{if(w.length===1)O.set(m.pageX,m.pageY);else{const R=rn(m),Y=.5*(m.pageX+R.x),k=.5*(m.pageY+R.y);O.set(Y,k)}y.subVectors(O,S).multiplyScalar(this.panSpeed),q(y.x,y.y),S.copy(O)},hs=m=>{const R=rn(m),Y=m.pageX-R.x,k=m.pageY-R.y,Re=Math.sqrt(Y*Y+k*k);L.set(0,Re),C.set(0,Math.pow(L.y/T.y,this.zoomSpeed)),Q(C.y),T.copy(L)},Gc=m=>{this.enableZoom&&hs(m),this.enablePan&&ds(m)},Dc=m=>{this.enableZoom&&hs(m),this.enableRotate&&us(m)};this.onPointerDown=m=>{this.enabled!==!1&&(w.length===0&&(this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp)),Bc(m),m.pointerType==="touch"?jc(m):Uc(m))};let sn=!1;this.onPointerMove=m=>{this.enabled!==!1&&(sn||(this.domElement.setPointerCapture(m.pointerId),sn=!0),m.pointerType==="touch"?Yc(m):xc(m))},this.onPointerUp=m=>{this.enabled!==!1&&(sn=!1,m.pointerType==="touch"?Hc():Fc(m),ps(m),w.length===0&&(this.domElement.releasePointerCapture(m.pointerId),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)))},this.onPointerCancel=m=>{ps(m)};const Uc=m=>{let R;switch(m.button){case 0:R=this.mouseButtons.LEFT;break;case 1:R=this.mouseButtons.MIDDLE;break;case 2:R=this.mouseButtons.RIGHT;break;default:R=-1}switch(R){case l.MOUSE.DOLLY:if(this.enableZoom===!1)return;wt(m),i=s.DOLLY;break;case l.MOUSE.ROTATE:if(m.ctrlKey||m.metaKey||m.shiftKey){if(this.enablePan===!1)return;It(m),i=s.PAN}else{if(this.enableRotate===!1)return;ie(m),i=s.ROTATE}break;case l.MOUSE.PAN:if(m.ctrlKey||m.metaKey||m.shiftKey){if(this.enableRotate===!1)return;ie(m),i=s.ROTATE}else{if(this.enablePan===!1)return;It(m),i=s.PAN}break;default:i=s.NONE}i!==s.NONE&&this.dispatchEvent({type:"start"})},xc=m=>{if(this.enabled!==!1)switch(i){case s.ROTATE:if(this.enableRotate===!1)return;nn(m);break;case s.DOLLY:if(this.enableZoom===!1)return;wc(m);break;case s.PAN:if(this.enablePan===!1)return;Ic(m);break}},Fc=m=>{this.dispatchEvent({type:"end"}),i=s.NONE};this.onMouseWheel=m=>{this.enabled===!1||this.enableZoom===!1||i!==s.NONE||(m.preventDefault(),this.dispatchEvent({type:"start"}),Pc(m),this.dispatchEvent({type:"end"}))},this.onKeyDown=m=>{this.enabled===!1||this.enablePan===!1||vc(m)};const jc=m=>{switch(fs(m),w.length){case 1:switch(this.touches.ONE){case l.TOUCH.ROTATE:if(this.enableRotate===!1)return;as(),i=s.TOUCH_ROTATE;break;case l.TOUCH.PAN:if(this.enablePan===!1)return;cs(),i=s.TOUCH_PAN;break;default:i=s.NONE}break;case 2:switch(this.touches.TWO){case l.TOUCH.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;Ac(),i=s.TOUCH_DOLLY_PAN;break;case l.TOUCH.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;Nc(),i=s.TOUCH_DOLLY_ROTATE;break;default:i=s.NONE}break;default:i=s.NONE}i!==s.NONE&&this.dispatchEvent({type:"start"})},Yc=m=>{switch(fs(m),i){case s.TOUCH_ROTATE:if(this.enableRotate===!1)return;us(m),this.update();break;case s.TOUCH_PAN:if(this.enablePan===!1)return;ds(m),this.update();break;case s.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;Gc(m),this.update();break;case s.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;Dc(m),this.update();break;default:i=s.NONE}},Hc=m=>{this.dispatchEvent({type:"end"}),i=s.NONE};this.onContextMenu=m=>{this.enabled!==!1&&m.preventDefault()};function Bc(m){w.push(m)}const ps=m=>{delete x[m.pointerId];for(let R=0;R<w.length;R++)if(w[R].pointerId==m.pointerId){w.splice(R,1);return}};function fs(m){let R=x[m.pointerId];R===void 0&&(R=new l.Vector2,x[m.pointerId]=R),R.set(m.pageX,m.pageY)}function rn(m){const R=m.pointerId===w[0].pointerId?w[1]:w[0];return x[R.pointerId]}this.spherical=o,this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),this.domElement.addEventListener("wheel",this.onMouseWheel,{passive:!1}),this.reset=()=>{this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent({type:"change"}),this.update(),i=s.NONE},this.update()}getPolarAngle(){return this.spherical.phi}getAzimuthalAngle(){return this.spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this.onKeyDown),this._domElementKeyEvents=e}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}setCamera(e){this.object=e}setDom(e){this.dispose(),this.domElement=e,this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),this.domElement.addEventListener("wheel",this.onMouseWheel,{passive:!1})}dispose(){this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("pointercancel",this.onPointerCancel),this.domElement.removeEventListener("wheel",this.onMouseWheel),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp),this._domElementKeyEvents!==null&&this._domElementKeyEvents.removeEventListener("keydown",this.onKeyDown)}}a.VIEWPOINT=void 0,function(n){n.DEFAULT="default",n.TOP="top",n.BOTTOM="bottom",n.LEFT="left",n.RIGHT="right",n.FRONT="front",n.BACK="back"}(a.VIEWPOINT||(a.VIEWPOINT={}));const ws=function(n={}){var i;if(!this.webGLRenderer)return console.error("must install some renderer before BasicViewpoint plugin."),!1;!n.viewpoint&&(n.viewpoint=a.VIEWPOINT.DEFAULT),!n.perspective&&(n.perspective={}),!n.perspective.position&&(n.perspective.position={x:60,y:60,z:60}),!n.perspective.lookAt&&(n.perspective.lookAt={x:0,y:0,z:0}),!n.perspective.up&&(n.perspective.up={x:0,y:1,z:0}),!n.orthograpbic&&(n.orthograpbic={}),!n.orthograpbic.up&&(n.orthograpbic.up={x:0,y:1,z:0});const e=new l.PerspectiveCamera;e.position.set(n.perspective.position.x,n.perspective.position.y,n.perspective.position.z),e.lookAt(n.perspective.lookAt.x,n.perspective.lookAt.y,n.perspective.lookAt.z),e.up.set(n.perspective.up.x,n.perspective.up.y,n.perspective.up.z);const t=n.orthograpbic.distance||1e4,s=new l.OrthographicCamera(-window.innerWidth/8,window.innerWidth/8,-window.innerHeight/8,window.innerHeight/8,0,t);return s.up.set(n.perspective.up.x,n.perspective.up.y,n.perspective.up.z),this.setViewpoint=function(r){return this.dispatchEvent({type:"setViewpoint",viewpoint:r}),this},this.addEventListener("setSize",r=>{const o=r.width,c=r.height,u=o/c;e.aspect=u,e.updateProjectionMatrix(),s.left=-t*u,s.right=t*u,s.top=t,s.bottom=-t,s.zoom=t/c*5,s.updateProjectionMatrix()}),(i=n.orthograpbic.allowRotate)!=null,this.addEventListener("setViewpoint",r=>{const o=r.viewpoint;if(o===a.VIEWPOINT.DEFAULT){this.setCamera(e);return}o===a.VIEWPOINT.TOP?s.position.set(0,t/2,0):o===a.VIEWPOINT.BOTTOM?s.position.set(0,-t/2,0):o===a.VIEWPOINT.RIGHT?s.position.set(t/2,0,0):o===a.VIEWPOINT.LEFT?s.position.set(-t/2,0,0):o===a.VIEWPOINT.FRONT?s.position.set(0,0,t/2):o===a.VIEWPOINT.BACK&&s.position.set(0,0,-t/2),this.setCamera(s)}),this.completeSet.add(()=>{n.viewpoint===a.VIEWPOINT.DEFAULT?this.setCamera(e):this.setCamera(s),this.objectHelperManager&&this.objectHelperManager.addFilteredObject(e,s)}),!0},Is=function(n){return this.orbitControls?(console.warn("this has installed orbitControls plugin."),!1):this.renderManager?(this.orbitControls=new dn(this.camera,this.dom),this.addEventListener("setCamera",e=>{e.options.orbitControls&&this.orbitControls.setCamera(e.camera)}),this.addEventListener("setDom",e=>{this.orbitControls.setDom(e.dom)}),this.renderManager.addEventListener("render",()=>{this.orbitControls.update()}),this.completeSet.add(()=>{this.setViewpoint&&this.addEventListener("setViewpoint",e=>{const t=e.viewpoint;this.orbitControls.target.set(0,0,0),t===a.VIEWPOINT.DEFAULT?this.orbitControls.enableRotate=!0:t===a.VIEWPOINT.TOP?this.orbitControls.enableRotate=!1:t===a.VIEWPOINT.BOTTOM?this.orbitControls.enableRotate=!1:t===a.VIEWPOINT.RIGHT?this.orbitControls.enableRotate=!1:t===a.VIEWPOINT.LEFT?this.orbitControls.enableRotate=!1:t===a.VIEWPOINT.FRONT?this.orbitControls.enableRotate=!1:t===a.VIEWPOINT.BACK&&(this.orbitControls.enableRotate=!1)})}),!0):(console.warn("this must install renderManager before install orbitControls plugin."),!1)};class Ps{constructor(e){d(this,"REVISION");d(this,"dom");d(this,"addPanel");d(this,"showPanel");d(this,"begin");d(this,"end");d(this,"update");d(this,"domElement");d(this,"setMode");const t=Rs.default();this.REVISION=t.REVISION,this.dom=t.dom,this.domElement=t.domElement,this.begin=t.begin.bind(t),this.end=t.end.bind(t),this.update=t.update.bind(t),this.addPanel=t.addPanel.bind(t),this.showPanel=t.showPanel.bind(t),this.setMode=t.setMode.bind(t);const s=this.domElement;s.style.position="absolute",s.style.top="0",s.style.left="35px",e&&(s.style.top=`${e.top}px`,s.style.left=`${e.left}px`,s.style.right=`${e.right}px`,s.style.bottom=`${e.bottom}px`)}}const vs=function(n){if(this.stats)return console.warn("this has installed stats plugin."),!1;if(!this.renderManager)return console.warn("this must install renderManager before install stats plugin."),!1;const e=new Ps(n);this.stats=e;const t=()=>{this.stats.update()};return this.setStats=function(s){if(s)this.dom.appendChild(this.stats.domElement),this.renderManager.addEventListener("render",t);else try{this.dom.removeChild(this.stats.domElement),this.renderManager.removeEventListener("render",t)}catch{}return this},!0},As=function(n={}){if(this.effectComposer)return console.warn("this has installed effect composer plugin."),!1;if(!this.webGLRenderer)return console.error("must install some renderer before this plugin."),!1;let e;if(n.WebGLMultisampleRenderTarget||n.MSAA){const s=this.webGLRenderer,i=s.getPixelRatio(),r=s.getDrawingBufferSize(new l.Vector2);Number(window.__THREE__)>137?e=new Pt.EffectComposer(s,new l.WebGLRenderTarget(r.width*i,r.height*i,{format:n.format||l.RGBAFormat,samples:n.samples||4})):e=new Pt.EffectComposer(s,new l.WebGLMultisampleRenderTarget(r.width*i,r.height*i,{format:n.format||l.RGBAFormat}))}else e=new Pt.EffectComposer(this.webGLRenderer);this.effectComposer=e;let t;return this.scene&&this.camera&&(t=new vt.RenderPass(this.scene,this.camera),e.addPass(t)),this.addEventListener("setCamera",s=>{if(!t&&this.scene){t=new vt.RenderPass(this.scene,s.camera),e.addPass(t);return}else t&&(t.camera=s.camera)}),this.addEventListener("setScene",s=>{if(!t&&this.camera){t=new vt.RenderPass(s.scene,this.camera),e.addPass(t);return}else t&&(t.scene=s.scene)}),this.addEventListener("setSize",s=>{e.setSize(s.width,s.height)}),this.renderManager?(this.renderManager.removeEventListener("render",this.render),this.renderManager.addEventListener("render",s=>{this.effectComposer.render(s.delta)})):this.render=function(){return this.effectComposer.render(),this},!0};class Ns extends te{constructor(e){super();d(this,"dom");d(this,"mouse");d(this,"canMouseMove");d(this,"mouseEventTimer");d(this,"throttleTime");d(this,"pointerDownHandler");d(this,"pointerMoveHandler");d(this,"pointerUpHandler");d(this,"mouseDownHandler");d(this,"mouseUpHandler");d(this,"clickHandler");d(this,"dblclickHandler");d(this,"contextmenuHandler");this.dom=e.dom,this.mouse=new l.Vector2,this.canMouseMove=!0,this.mouseEventTimer=null,this.throttleTime=e.throttleTime||1e3/60;const t=i=>{const r={mouse:{x:this.mouse.x,y:this.mouse.y}};for(const o in i)r[o]=i[o];return r},s=i=>{this.dispatchEvent(t(i))};this.pointerMoveHandler=i=>{!this.canMouseMove||(this.canMouseMove=!1,this.mouseEventTimer=window.setTimeout(()=>{const r=this.mouse,o=this.dom,c=o.getBoundingClientRect();r.x=(i.clientX-c.left)/o.offsetWidth*2-1,r.y=-((i.clientY-c.top)/o.offsetHeight)*2+1,this.canMouseMove=!0,this.dispatchEvent(t(i))},this.throttleTime))},this.mouseDownHandler=s,this.mouseUpHandler=s,this.pointerDownHandler=s,this.pointerUpHandler=s,this.clickHandler=s,this.dblclickHandler=s,this.contextmenuHandler=s}setDom(e){if(this.dom){const t=this.dom;t.removeEventListener("mousedown",this.mouseDownHandler),t.removeEventListener("mouseup",this.mouseUpHandler),t.removeEventListener("pointerdown",this.pointerDownHandler),t.removeEventListener("pointermove",this.pointerMoveHandler),t.removeEventListener("pointerup",this.pointerUpHandler),t.removeEventListener("click",this.clickHandler),t.removeEventListener("dblclick",this.dblclickHandler),t.removeEventListener("contextmenu",this.contextmenuHandler)}return e.addEventListener("mousedown",this.mouseDownHandler),e.addEventListener("mouseup",this.mouseUpHandler),e.addEventListener("pointerdown",this.pointerDownHandler),e.addEventListener("pointermove",this.pointerMoveHandler),e.addEventListener("pointerup",this.pointerUpHandler),e.addEventListener("click",this.clickHandler),e.addEventListener("dblclick",this.dblclickHandler),e.addEventListener("contextmenu",this.contextmenuHandler),this.dom=e,this}getNormalMouse(){return this.mouse}}const Gs=function(n){if(this.pointerManager)return console.warn("this has installed pointerManager plugin."),!1;const e=new Ns(Object.assign(n||{},{dom:this.dom}));return this.addEventListener("setDom",t=>{e.setDom(t.dom)}),this.pointerManager=e,!0};a.EVENTNAME=void 0,function(n){n.POINTERDOWN="pointerdown",n.POINTERUP="pointerup",n.POINTERMOVE="pointermove",n.POINTERENTER="pointerenter",n.POINTERLEAVE="pointerleave",n.CLICK="click",n.DBLCLICK="dblclick",n.CONTEXTMENU="contextmenu"}(a.EVENTNAME||(a.EVENTNAME={}));class Ds extends te{constructor(e){super();d(this,"raycaster");d(this,"scene");d(this,"camera");d(this,"filter",new Set);d(this,"recursive",!1);d(this,"penetrate",!1);d(this,"propagation",!1);d(this,"delegation",!1);this.raycaster=new l.Raycaster,this.camera=e.camera,this.scene=e.scene,e.recursive&&(this.recursive=e.recursive),e.penetrate&&(this.penetrate=e.penetrate)}setScene(e){return this.scene=e,this}setCamera(e){return this.camera=e,this}addFilterObject(e){return this.filter.add(e),this}removeFilterObject(e){return this.filter.delete(e),this}intersectObject(e){this.raycaster.setFromCamera(e,this.camera);const t=this.filter,s=this.scene.children.filter(i=>!t.has(i));return this.raycaster.intersectObjects(s,this.recursive)}use(e){const t=function(c,u){return Object.assign({},c,u)},s=(c,u)=>{const h=this.intersectObject(c.mouse);if(h.length)if(this.penetrate)for(const p of h)p.object.dispatchEvent(t(c,{type:u,intersection:p}));else{const p=h[0];p.object.dispatchEvent(t(c,{type:u,intersection:p}))}this.dispatchEvent(t(c,{type:u,intersections:h}))},i=["pointerdown","pointerup","mousedown","mouseup","pointermove","click","dblclick","contextmenu"];for(const c of i)e.addEventListener(c,u=>{s(u,c)});const r=new Map;let o=null;return e.addEventListener("pointermove",c=>{const u=this.intersectObject(c.mouse);if(this.penetrate){if(!u.length){r.forEach(h=>{h.object.dispatchEvent(t(c,{type:"pointerleave",intersection:h})),h.object.dispatchEvent(t(c,{type:"mouseleave",intersection:h}))}),r.clear();return}for(const h of u)r.has(h.object)?(h.object.dispatchEvent(t(c,{type:"pointermove",intersection:h})),h.object.dispatchEvent(t(c,{type:"mousemove",intersection:h})),r.delete(h.object)):(h.object.dispatchEvent(t(c,{type:"pointerenter",intersection:h})),h.object.dispatchEvent(t(c,{type:"mouseenter",intersection:h})));for(const h of r.values())h.object.dispatchEvent(t(c,{type:"pointerleave",intersection:h})),h.object.dispatchEvent(t(c,{type:"mouseleave",intersection:h}));r.clear();for(const h of u)r.set(h.object,h)}else{if(!u.length){o&&(o.object.dispatchEvent(t(c,{type:"pointerleave",intersection:o})),o.object.dispatchEvent(t(c,{type:"mouseleave",intersection:o})),o=null);return}const h=u[0];if(!o){h.object.dispatchEvent(t(c,{type:"pointerenter",intersection:h})),h.object.dispatchEvent(t(c,{type:"mouseenter",intersection:h})),o=h;return}if(h.object!==o.object){o.object.dispatchEvent(t(c,{type:"pointerleave",intersection:h})),o.object.dispatchEvent(t(c,{type:"mouseleave",intersection:h})),h.object.dispatchEvent(t(c,{type:"pointerenter",intersection:h})),h.object.dispatchEvent(t(c,{type:"mouseenter",intersection:h})),o=h;return}h.object===o.object&&(h.object.dispatchEvent(t(c,{type:"pointermove",intersection:h})),h.object.dispatchEvent(t(c,{type:"mousemove",intersection:h})))}this.dispatchEvent(t(c,{type:"pointermove",intersections:u})),this.dispatchEvent(t(c,{type:"mousemove",intersections:u}))}),this}}const Us=function(n){if(this.eventManager)return console.warn("engine has installed eventManager plugin."),!1;if(!this.pointerManager)return console.error("must install pointerManager before this plugin."),!1;const e=new Ds(Object.assign({scene:this.scene,camera:this.camera},n));return e.use(this.pointerManager),this.eventManager=e,this.addEventListener("setCamera",t=>{this.eventManager.setCamera(t.camera)}),this.addEventListener("setScene",t=>{this.eventManager.setScene(t.scene)}),!0};var ot;(function(n){n.OBJECTCHANGED="objectChanged"})(ot||(ot={}));class hn extends Es.TransformControls{constructor(e,t){!e&&(e=new l.PerspectiveCamera),!t&&(t=document.body);super(e,t);d(this,"target");d(this,"transObjectSet");this.domElement.removeEventListener("pointerdown",this._onPointerDown),this._onPointerDown=u=>{var h;!this.enabled||!((h=this.object)==null?void 0:h.parent)||(this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(u)),this.pointerDown(this._getPointer(u)))},this.domElement.addEventListener("pointerdown",this._onPointerDown),this.target=new l.Object3D,this.transObjectSet=new Set;let s="";const i=this.target,r=this.transObjectSet,o={x:0,y:0,z:0},c=new WeakMap;this.addEventListener("mouseDown",u=>{s=u.target.mode,s==="translate"&&(s="position"),s==="rotate"&&(s="rotation"),o.x=i[s].x,o.y=i[s].y,o.z=i[s].z,r.forEach(h=>{c.set(h,h.matrixAutoUpdate),h.matrixAutoUpdate=!1})}),this.addEventListener("objectChange",u=>{const h=i[s].x-o.x,p=i[s].y-o.y,f=i[s].z-o.z;o.x=i[s].x,o.y=i[s].y,o.z=i[s].z,r.forEach(g=>{g[s].x+=h,g[s].y+=p,g[s].z+=f,g.updateMatrix(),g.updateMatrixWorld()}),this.dispatchEvent({type:ot.OBJECTCHANGED,transObjectSet:r,mode:s,target:i})}),this.addEventListener("mouseUp",u=>{r.forEach(h=>{h.matrixAutoUpdate=c.get(h),c.delete(h)})})}setDom(e){return this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),e.addEventListener("pointerdown",this._onPointerDown),e.addEventListener("pointermove",this._onPointerHover),e.addEventListener("pointerup",this._onPointerUp),this.domElement=e,this}setCamera(e){return this.camera=e,this}getTarget(){return this.target}getTransObjectSet(){return this.transObjectSet}setAttach(...e){if(this.transObjectSet.clear(),!e.length||!e[0])return this.detach(),this;this.attach(this.target);const t=this.target;if(e.length===1){const o=e[0];return o.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.updateMatrix(),t.updateMatrixWorld(),this.transObjectSet.add(o),this}const s=[],i=[],r=[];return e.forEach(o=>{s.push(o.matrixWorld.elements[12]),i.push(o.matrixWorld.elements[13]),r.push(o.matrixWorld.elements[14])}),t.rotation.set(0,0,0),t.scale.set(0,0,0),t.position.x=(Math.max(...s)-Math.min(...s))/2+Math.min(...s),t.position.y=(Math.max(...i)-Math.min(...i))/2+Math.min(...i),t.position.z=(Math.max(...r)-Math.min(...r))/2+Math.min(...r),t.updateMatrix(),t.updateMatrixWorld(),e.forEach(o=>{this.transObjectSet.add(o)}),this}}const xs=function(n){if(this.transformControls)return console.warn("this has installed transformControls plugin."),!1;if(!this.pointerManager)return console.warn("this must install pointerManager before install transformControls plugin."),!1;if(!this.eventManager)return console.warn("this must install eventManager before install transformControls plugin."),!1;const e=new hn(this.camera,this.dom);return e.detach(),this.transformControls=e,this.scene.add(this.transformControls),this.scene.add(this.transformControls.target),this.transformControls.addEventListener("mouseDown",()=>{this.transing=!0}),this.setTransformControls=function(t){return t?this.scene.add(this.transformControls):this.scene.remove(this.transformControls),this},this.addEventListener("setCamera",t=>{t.options.transformControls&&e.setCamera(t.camera)}),this.addEventListener("setDom",t=>{e.setDom(t.dom)}),this.addEventListener("setScene",t=>{const s=t.scene;s.add(this.transformControls.target),s.add(this.transformControls)}),this.selectionBox?this.addEventListener("selected",t=>{e.setAttach(...t.objects)}):this.eventManager.addEventListener("click",t=>{if(this.transing){this.transing=!1;return}if(t.button===0){const i=t.intersections.map(r=>r.object)[0]||null;i?e.setAttach(i):e.detach()}}),this.eventManager.addFilterObject(e),this.completeSet.add(()=>{if(this.IS_ENGINESUPPORT){const t=r=>{const o=this.compilerManager.getObjectSymbol(r);return o?this.dataSupportManager.getConfigBySymbol(o):null};let s=null,i;e.addEventListener(ot.OBJECTCHANGED,r=>{const o=r;o.transObjectSet.forEach(c=>{s=t(c),i=o.mode,s&&(s[i].x=c[i].x,s[i].y=c[i].y,s[i].z=c[i].z)})})}}),!0},Fs=function(n={}){if(this.webGLRenderer)return console.warn("this has installed webglRenderer plugin."),!1;this.webGLRenderer=new l.WebGLRenderer(n);const e=this.webGLRenderer.domElement;return e.style.position="absolute",e.style.top="0",e.style.left="0",e.classList.add("vis-webgl"),this.getScreenshot=async function(t={}){const s={width:this.dom.offsetWidth,height:this.dom.offsetHeight};!t.width&&(t.width=this.dom.offsetWidth),!t.height&&(t.height=this.dom.offsetHeight),!t.mine&&(t.mine="image/png");let i=!1;this.renderManager.hasRendering()&&(this.renderManager.stop(),i=!0);let r="";const o=this.webGLRenderer.getContext(),u=o.getParameter(o.MAX_RENDERBUFFER_SIZE)/4;if(t.width>u||t.height>u){const h=[],p=Math.ceil(t.width/u),f=Math.ceil(t.height/u),g=t.width/p,E=t.height/f,S=document.createElement("canvas");S.setAttribute("width",t.width.toString()),S.setAttribute("height",t.height.toString());const O=S.getContext("2d");if(!O)return console.warn("can not support canvas 2d;"),r;this.setSize(g,E);for(let T=0;T<p;T+=1)for(let L=0;L<f;L+=1)h.push({x:g*T,y:E*L});const y=[];h.forEach(T=>{this.camera.setViewOffset(t.width,t.height,T.x,T.y,g,E),this.renderManager.render();const L=this.webGLRenderer.domElement.toDataURL(t.mine);y.push(new Promise((C,w)=>{const x=new Image;x.src=L,x.onload=()=>{O.drawImage(x,T.x,T.y,g,E),C(null)}}))}),this.setSize(s.width,s.height),await Promise.all(y).catch(T=>{console.warn(T)}),r=S.toDataURL(t.mine),this.camera.clearViewOffset()}else this.setSize(t.width,t.height),this.renderManager.render(),r=this.webGLRenderer.domElement.toDataURL(t.mine),this.setSize(s.width,s.height);return i&&this.renderManager.play(),r},this.addEventListener("setDom",t=>{t.dom.appendChild(this.webGLRenderer.domElement)}),this.addEventListener("setSize",t=>{this.webGLRenderer.setSize(t.width,t.height,!0)}),this.addEventListener("dispose",()=>{this.webGLRenderer.dispose()}),this.renderManager?(this.renderManager.removeEventListener("render",this.render),this.renderManager.addEventListener("render",t=>{this.webGLRenderer.render(this.scene,this.camera)})):this.render=function(){return this.webGLRenderer.render(this.scene,this.camera),this},!0},Ke=class extends l.Loader{constructor(e){super(e)}load(e,t,s,i){this.path!==void 0&&(e=this.path+e),this.manager.itemStart(e),e=this.manager.resolveURL(e);const r=l.Cache.get(e);if(r!==void 0)return setTimeout(()=>{t&&t(r),this.manager.itemEnd(e)},0),r;const o=document.createElement("video");return o.preload=Ke.preload,o.autoplay=Ke.autoplay,o.loop=Ke.loop,o.muted=Ke.muted,o.src=e,o.style.position="fixed",o.style.top="0",o.style.left="0",o.style.zIndex="-1",document.body.appendChild(o),o.oncanplay=()=>{l.Cache.add(e,o),this.manager.itemEnd(e),t&&t(o)},o.onerror=c=>{this.manager.itemEnd(e),i&&i(c)},o}};let Ie=Ke;d(Ie,"autoplay",!0),d(Ie,"preload","auto"),d(Ie,"muted",!0),d(Ie,"loop",!0);class js extends l.Loader{constructor(e){super(e);this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new ks(t)}),this.register(function(t){return new Qs(t)}),this.register(function(t){return new qs(t)}),this.register(function(t){return new Vs(t)}),this.register(function(t){return new Ws(t)}),this.register(function(t){return new $s(t)}),this.register(function(t){return new Ks(t)}),this.register(function(t){return new _s(t)}),this.register(function(t){return new Xs(t)}),this.register(function(t){return new zs(t)}),this.register(function(t){return new Hs(t)}),this.register(function(t){return new Zs(t)})}load(e,t,s,i){const r=this;let o;this.resourcePath!==""?o=this.resourcePath:this.path!==""?o=this.path:o=l.LoaderUtils.extractUrlBase(e),this.manager.itemStart(e);const c=function(h){i?i(h):console.error(h),r.manager.itemError(e),r.manager.itemEnd(e)},u=new l.FileLoader(this.manager);u.setPath(this.path),u.setResponseType("arraybuffer"),u.setRequestHeader(this.requestHeader),u.setWithCredentials(this.withCredentials),u.load(e,function(h){try{r.parse(h,o,function(p){t(p),r.manager.itemEnd(e)},c)}catch(p){c(p)}},s,c)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,s,i){let r;const o={},c={};if(typeof e=="string")r=e;else if(l.LoaderUtils.decodeText(new Uint8Array(e,0,4))===pn){try{o[A.KHR_BINARY_GLTF]=new Js(e)}catch(f){i&&i(f);return}r=o[A.KHR_BINARY_GLTF].content}else r=l.LoaderUtils.decodeText(new Uint8Array(e));const u=JSON.parse(r);if(u.asset===void 0||u.asset.version[0]<2){i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const h=new hi(u,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});h.fileLoader.setRequestHeader(this.requestHeader);for(let p=0;p<this.pluginCallbacks.length;p++){const f=this.pluginCallbacks[p](h);c[f.name]=f,o[f.name]=!0}if(u.extensionsUsed)for(let p=0;p<u.extensionsUsed.length;++p){const f=u.extensionsUsed[p],g=u.extensionsRequired||[];switch(f){case A.KHR_MATERIALS_UNLIT:o[f]=new Bs;break;case A.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[f]=new ni;break;case A.KHR_DRACO_MESH_COMPRESSION:o[f]=new ei(u,this.dracoLoader);break;case A.KHR_TEXTURE_TRANSFORM:o[f]=new ti;break;case A.KHR_MESH_QUANTIZATION:o[f]=new si;break;default:g.indexOf(f)>=0&&c[f]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+f+'".')}}h.setExtensions(o),h.setPlugins(c),h.parse(s,i)}parseAsync(e,t){const s=this;return new Promise(function(i,r){s.parse(e,t,i,r)})}}function Ys(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}const A={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class Hs{constructor(e){this.parser=e,this.name=A.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let s=0,i=t.length;s<i;s++){const r=t[s];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,s="light:"+e;let i=t.cache.get(s);if(i)return i;const r=t.json,u=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let h;const p=new l.Color(16777215);u.color!==void 0&&p.fromArray(u.color);const f=u.range!==void 0?u.range:0;switch(u.type){case"directional":h=new l.DirectionalLight(p),h.target.position.set(0,0,-1),h.add(h.target);break;case"point":h=new l.PointLight(p),h.distance=f;break;case"spot":h=new l.SpotLight(p),h.distance=f,u.spot=u.spot||{},u.spot.innerConeAngle=u.spot.innerConeAngle!==void 0?u.spot.innerConeAngle:0,u.spot.outerConeAngle=u.spot.outerConeAngle!==void 0?u.spot.outerConeAngle:Math.PI/4,h.angle=u.spot.outerConeAngle,h.penumbra=1-u.spot.innerConeAngle/u.spot.outerConeAngle,h.target.position.set(0,0,-1),h.add(h.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+u.type)}return h.position.set(0,0,0),h.decay=2,u.intensity!==void 0&&(h.intensity=u.intensity),h.name=t.createUniqueName(u.name||"light_"+e),i=Promise.resolve(h),t.cache.add(s,i),i}createNodeAttachment(e){const t=this,s=this.parser,r=s.json.nodes[e],c=(r.extensions&&r.extensions[this.name]||{}).light;return c===void 0?null:this._loadLight(c).then(function(u){return s._getNodeRef(t.cache,c,u)})}}class Bs{constructor(){this.name=A.KHR_MATERIALS_UNLIT}getMaterialType(){return l.MeshBasicMaterial}extendParams(e,t,s){const i=[];e.color=new l.Color(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const o=r.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}r.baseColorTexture!==void 0&&i.push(s.assignTexture(e,"map",r.baseColorTexture,l.sRGBEncoding))}return Promise.all(i)}}class _s{constructor(e){this.parser=e,this.name=A.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=i.extensions[this.name].emissiveStrength;return r!==void 0&&(t.emissiveIntensity=r),Promise.resolve()}}class ks{constructor(e){this.parser=e,this.name=A.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&r.push(s.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&r.push(s.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(r.push(s.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const c=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new l.Vector2(c,c)}return Promise.all(r)}}class zs{constructor(e){this.parser=e,this.name=A.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&r.push(s.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&r.push(s.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(r)}}class Vs{constructor(e){this.parser=e,this.name=A.KHR_MATERIALS_SHEEN}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new l.Color(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=i.extensions[this.name];return o.sheenColorFactor!==void 0&&t.sheenColor.fromArray(o.sheenColorFactor),o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&r.push(s.assignTexture(t,"sheenColorMap",o.sheenColorTexture,l.sRGBEncoding)),o.sheenRoughnessTexture!==void 0&&r.push(s.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(r)}}class Ws{constructor(e){this.parser=e,this.name=A.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&r.push(s.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(r)}}class $s{constructor(e){this.parser=e,this.name=A.KHR_MATERIALS_VOLUME}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&r.push(s.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||0;const c=o.attenuationColor||[1,1,1];return t.attenuationColor=new l.Color(c[0],c[1],c[2]),Promise.all(r)}}class Ks{constructor(e){this.parser=e,this.name=A.KHR_MATERIALS_IOR}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=i.extensions[this.name];return t.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}}class Xs{constructor(e){this.parser=e,this.name=A.KHR_MATERIALS_SPECULAR}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:l.MeshPhysicalMaterial}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&r.push(s.assignTexture(t,"specularIntensityMap",o.specularTexture));const c=o.specularColorFactor||[1,1,1];return t.specularColor=new l.Color(c[0],c[1],c[2]),o.specularColorTexture!==void 0&&r.push(s.assignTexture(t,"specularColorMap",o.specularColorTexture,l.sRGBEncoding)),Promise.all(r)}}class Qs{constructor(e){this.parser=e,this.name=A.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,s=t.json,i=s.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const r=i.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,o)}}class qs{constructor(e){this.parser=e,this.name=A.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,i=s.json,r=i.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],c=i.images[o.source];let u=s.textureLoader;if(c.uri){const h=s.options.manager.getHandler(c.uri);h!==null&&(u=h)}return this.detectSupport().then(function(h){if(h)return s.loadTextureImage(e,o.source,u);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Zs{constructor(e){this.name=A.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,s=t.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const i=s.extensions[this.name],r=this.parser.getDependency("buffer",i.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([r,o.ready]).then(function(c){const u=i.byteOffset||0,h=i.byteLength||0,p=i.count,f=i.byteStride,g=new ArrayBuffer(p*f),E=new Uint8Array(c[0],u,h);return o.decodeGltfBuffer(new Uint8Array(g),p,f,E,i.mode,i.filter),g})}else return null}}const pn="glTF",Xe=12,fn={JSON:1313821514,BIN:5130562};class Js{constructor(e){this.name=A.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,Xe);if(this.header={magic:l.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==pn)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-Xe,i=new DataView(e,Xe);let r=0;for(;r<s;){const o=i.getUint32(r,!0);r+=4;const c=i.getUint32(r,!0);if(r+=4,c===fn.JSON){const u=new Uint8Array(e,Xe+r,o);this.content=l.LoaderUtils.decodeText(u)}else if(c===fn.BIN){const u=Xe+r;this.body=e.slice(u,u+o)}r+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class ei{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=A.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const s=this.json,i=this.dracoLoader,r=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,c={},u={},h={};for(const p in o){const f=Dt[p]||p.toLowerCase();c[f]=o[p]}for(const p in e.attributes){const f=Dt[p]||p.toLowerCase();if(o[p]!==void 0){const g=s.accessors[e.attributes[p]],E=Qe[g.componentType];h[f]=E,u[f]=g.normalized===!0}}return t.getDependency("bufferView",r).then(function(p){return new Promise(function(f){i.decodeDracoFile(p,function(g){for(const E in g.attributes){const S=g.attributes[E],O=u[E];O!==void 0&&(S.normalized=O)}f(g)},c,h)})})}}class ti{constructor(){this.name=A.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return t.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Nt extends l.MeshStandardMaterial{constructor(e){super();this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),s=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),r=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),c={specular:{value:new l.Color().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=c,this.onBeforeCompile=function(u){for(const h in c)u.uniforms[h]=c[h];u.fragmentShader=u.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",s).replace("#include <roughnessmap_fragment>",i).replace("#include <metalnessmap_fragment>",r).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return c.specular.value},set:function(u){c.specular.value=u}},specularMap:{get:function(){return c.specularMap.value},set:function(u){c.specularMap.value=u,u?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return c.glossiness.value},set:function(u){c.glossiness.value=u}},glossinessMap:{get:function(){return c.glossinessMap.value},set:function(u){c.glossinessMap.value=u,u?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class ni{constructor(){this.name=A.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return Nt}extendParams(e,t,s){const i=t.extensions[this.name];e.color=new l.Color(1,1,1),e.opacity=1;const r=[];if(Array.isArray(i.diffuseFactor)){const o=i.diffuseFactor;e.color.fromArray(o),e.opacity=o[3]}if(i.diffuseTexture!==void 0&&r.push(s.assignTexture(e,"map",i.diffuseTexture,l.sRGBEncoding)),e.emissive=new l.Color(0,0,0),e.glossiness=i.glossinessFactor!==void 0?i.glossinessFactor:1,e.specular=new l.Color(1,1,1),Array.isArray(i.specularFactor)&&e.specular.fromArray(i.specularFactor),i.specularGlossinessTexture!==void 0){const o=i.specularGlossinessTexture;r.push(s.assignTexture(e,"glossinessMap",o)),r.push(s.assignTexture(e,"specularMap",o,l.sRGBEncoding))}return Promise.all(r)}createMaterial(e){const t=new Nt(e);return t.fog=!0,t.color=e.color,t.map=e.map===void 0?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=e.aoMap===void 0?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=e.emissiveIntensity===void 0?1:e.emissiveIntensity,t.emissiveMap=e.emissiveMap===void 0?null:e.emissiveMap,t.bumpMap=e.bumpMap===void 0?null:e.bumpMap,t.bumpScale=1,t.normalMap=e.normalMap===void 0?null:e.normalMap,t.normalMapType=l.TangentSpaceNormalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=e.specularMap===void 0?null:e.specularMap,t.specular=e.specular,t.glossinessMap=e.glossinessMap===void 0?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=e.envMap===void 0?null:e.envMap,t.envMapIntensity=1,t}}class si{constructor(){this.name=A.KHR_MESH_QUANTIZATION}}class Gt extends l.Interpolant{constructor(e,t,s,i){super(e,t,s,i)}copySampleValue_(e){const t=this.resultBuffer,s=this.sampleValues,i=this.valueSize,r=e*i*3+i;for(let o=0;o!==i;o++)t[o]=s[r+o];return t}}Gt.prototype.interpolate_=function(n,e,t,s){const i=this.resultBuffer,r=this.sampleValues,o=this.valueSize,c=o*2,u=o*3,h=s-e,p=(t-e)/h,f=p*p,g=f*p,E=n*u,S=E-u,O=-2*g+3*f,y=g-f,T=1-O,L=y-f+p;for(let C=0;C!==o;C++){const w=r[S+C+o],x=r[S+C+c]*h,M=r[E+C+o],G=r[E+C]*h;i[C]=T*w+L*x+O*M+y*G}return i};const ii=new l.Quaternion;class ri extends Gt{interpolate_(e,t,s,i){const r=super.interpolate_(e,t,s,i);return ii.fromArray(r).normalize().toArray(r),r}}const le={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Qe={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},mn={9728:l.NearestFilter,9729:l.LinearFilter,9984:l.NearestMipmapNearestFilter,9985:l.LinearMipmapNearestFilter,9986:l.NearestMipmapLinearFilter,9987:l.LinearMipmapLinearFilter},gn={33071:l.ClampToEdgeWrapping,33648:l.MirroredRepeatWrapping,10497:l.RepeatWrapping},En={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Dt={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},ge={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},oi={CUBICSPLINE:void 0,LINEAR:l.InterpolateLinear,STEP:l.InterpolateDiscrete},Ut={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function ai(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new l.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:l.FrontSide})),n.DefaultMaterial}function qe(n,e,t){for(const s in t.extensions)n[s]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[s]=t.extensions[s])}function Pe(n,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function ci(n,e,t){let s=!1,i=!1,r=!1;for(let h=0,p=e.length;h<p;h++){const f=e[h];if(f.POSITION!==void 0&&(s=!0),f.NORMAL!==void 0&&(i=!0),f.COLOR_0!==void 0&&(r=!0),s&&i&&r)break}if(!s&&!i&&!r)return Promise.resolve(n);const o=[],c=[],u=[];for(let h=0,p=e.length;h<p;h++){const f=e[h];if(s){const g=f.POSITION!==void 0?t.getDependency("accessor",f.POSITION):n.attributes.position;o.push(g)}if(i){const g=f.NORMAL!==void 0?t.getDependency("accessor",f.NORMAL):n.attributes.normal;c.push(g)}if(r){const g=f.COLOR_0!==void 0?t.getDependency("accessor",f.COLOR_0):n.attributes.color;u.push(g)}}return Promise.all([Promise.all(o),Promise.all(c),Promise.all(u)]).then(function(h){const p=h[0],f=h[1],g=h[2];return s&&(n.morphAttributes.position=p),i&&(n.morphAttributes.normal=f),r&&(n.morphAttributes.color=g),n.morphTargetsRelative=!0,n})}function li(n,e){if(n.updateMorphTargets(),e.weights!==void 0)for(let t=0,s=e.weights.length;t<s;t++)n.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(n.morphTargetInfluences.length===t.length){n.morphTargetDictionary={};for(let s=0,i=t.length;s<i;s++)n.morphTargetDictionary[t[s]]=s}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function ui(n){const e=n.extensions&&n.extensions[A.KHR_DRACO_MESH_COMPRESSION];let t;return e?t="draco:"+e.bufferView+":"+e.indices+":"+Tn(e.attributes):t=n.indices+":"+Tn(n.attributes)+":"+n.mode,t}function Tn(n){let e="";const t=Object.keys(n).sort();for(let s=0,i=t.length;s<i;s++)e+=t[s]+":"+n[t[s]]+";";return e}function xt(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function di(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}class hi{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Ys,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const s=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,i=navigator.userAgent.indexOf("Firefox")>-1,r=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;typeof createImageBitmap=="undefined"||s||i&&r<98?this.textureLoader=new l.TextureLoader(this.options.manager):this.textureLoader=new l.ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new l.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const s=this,i=this.json,r=this.extensions;this.cache.removeAll(),this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])}).then(function(o){const c={scene:o[0][i.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:i.asset,parser:s,userData:{}};qe(r,c,i),Pe(c,i),Promise.all(s._invokeAll(function(u){return u.afterRoot&&u.afterRoot(c)})).then(function(){e(c)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],s=this.json.meshes||[];for(let i=0,r=t.length;i<r;i++){const o=t[i].joints;for(let c=0,u=o.length;c<u;c++)e[o[c]].isBone=!0}for(let i=0,r=e.length;i<r;i++){const o=e[i];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(s[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,s){if(e.refs[t]<=1)return s;const i=s.clone(),r=(o,c)=>{const u=this.associations.get(o);u!=null&&this.associations.set(c,u);for(const[h,p]of o.children.entries())r(p,c.children[h])};return r(s,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let s=0;s<t.length;s++){const i=e(t[s]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const s=[];for(let i=0;i<t.length;i++){const r=e(t[i]);r&&s.push(r)}return s}getDependency(e,t){const s=e+":"+t;let i=this.cache.get(s);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this.loadNode(t);break;case"mesh":i=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne(function(r){return r.loadAnimation&&r.loadAnimation(t)});break;case"camera":i=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(s,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const s=this,i=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(i.map(function(r,o){return s.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],s=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[A.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(r,o){s.load(l.LoaderUtils.resolveURL(t.uri,i.path),r,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(s){const i=t.byteLength||0,r=t.byteOffset||0;return s.slice(r,r+i)})}loadAccessor(e){const t=this,s=this.json,i=this.json.accessors[e];if(i.bufferView===void 0&&i.sparse===void 0)return Promise.resolve(null);const r=[];return i.bufferView!==void 0?r.push(this.getDependency("bufferView",i.bufferView)):r.push(null),i.sparse!==void 0&&(r.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(r).then(function(o){const c=o[0],u=En[i.type],h=Qe[i.componentType],p=h.BYTES_PER_ELEMENT,f=p*u,g=i.byteOffset||0,E=i.bufferView!==void 0?s.bufferViews[i.bufferView].byteStride:void 0,S=i.normalized===!0;let O,y;if(E&&E!==f){const T=Math.floor(g/E),L="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+T+":"+i.count;let C=t.cache.get(L);C||(O=new h(c,T*E,i.count*E/p),C=new l.InterleavedBuffer(O,E/p),t.cache.add(L,C)),y=new l.InterleavedBufferAttribute(C,u,g%E/p,S)}else c===null?O=new h(i.count*u):O=new h(c,g,i.count*u),y=new l.BufferAttribute(O,u,S);if(i.sparse!==void 0){const T=En.SCALAR,L=Qe[i.sparse.indices.componentType],C=i.sparse.indices.byteOffset||0,w=i.sparse.values.byteOffset||0,x=new L(o[1],C,i.sparse.count*T),M=new h(o[2],w,i.sparse.count*u);c!==null&&(y=new l.BufferAttribute(y.array.slice(),y.itemSize,y.normalized));for(let G=0,P=x.length;G<P;G++){const I=x[G];if(y.setX(I,M[G*u]),u>=2&&y.setY(I,M[G*u+1]),u>=3&&y.setZ(I,M[G*u+2]),u>=4&&y.setW(I,M[G*u+3]),u>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return y})}loadTexture(e){const t=this.json,s=this.options,r=t.textures[e].source,o=t.images[r];let c=this.textureLoader;if(o.uri){const u=s.manager.getHandler(o.uri);u!==null&&(c=u)}return this.loadTextureImage(e,r,c)}loadTextureImage(e,t,s){const i=this,r=this.json,o=r.textures[e],c=r.images[t],u=(c.uri||c.bufferView)+":"+o.sampler;if(this.textureCache[u])return this.textureCache[u];const h=this.loadImageSource(t,s).then(function(p){p.flipY=!1,o.name&&(p.name=o.name);const g=(r.samplers||{})[o.sampler]||{};return p.magFilter=mn[g.magFilter]||l.LinearFilter,p.minFilter=mn[g.minFilter]||l.LinearMipmapLinearFilter,p.wrapS=gn[g.wrapS]||l.RepeatWrapping,p.wrapT=gn[g.wrapT]||l.RepeatWrapping,i.associations.set(p,{textures:e}),p}).catch(function(){return null});return this.textureCache[u]=h,h}loadImageSource(e,t){const s=this,i=this.json,r=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(f=>f.clone());const o=i.images[e],c=self.URL||self.webkitURL;let u=o.uri||"",h=!1;if(o.bufferView!==void 0)u=s.getDependency("bufferView",o.bufferView).then(function(f){h=!0;const g=new Blob([f],{type:o.mimeType});return u=c.createObjectURL(g),u});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const p=Promise.resolve(u).then(function(f){return new Promise(function(g,E){let S=g;t.isImageBitmapLoader===!0&&(S=function(O){const y=new l.Texture(O);y.needsUpdate=!0,g(y)}),t.load(l.LoaderUtils.resolveURL(f,r.path),S,void 0,E)})}).then(function(f){return h===!0&&c.revokeObjectURL(u),f.userData.mimeType=o.mimeType||di(o.uri),f}).catch(function(f){throw console.error("THREE.GLTFLoader: Couldn't load texture",u),f});return this.sourceCache[e]=p,p}assignTexture(e,t,s,i){const r=this;return this.getDependency("texture",s.index).then(function(o){if(s.texCoord!==void 0&&s.texCoord!=0&&!(t==="aoMap"&&s.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+s.texCoord+" for texture "+t+" not yet supported."),r.extensions[A.KHR_TEXTURE_TRANSFORM]){const c=s.extensions!==void 0?s.extensions[A.KHR_TEXTURE_TRANSFORM]:void 0;if(c){const u=r.associations.get(o);o=r.extensions[A.KHR_TEXTURE_TRANSFORM].extendTexture(o,c),r.associations.set(o,u)}}return i!==void 0&&(o.encoding=i),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let s=e.material;const i=t.attributes.tangent===void 0,r=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const c="PointsMaterial:"+s.uuid;let u=this.cache.get(c);u||(u=new l.PointsMaterial,l.Material.prototype.copy.call(u,s),u.color.copy(s.color),u.map=s.map,u.sizeAttenuation=!1,this.cache.add(c,u)),s=u}else if(e.isLine){const c="LineBasicMaterial:"+s.uuid;let u=this.cache.get(c);u||(u=new l.LineBasicMaterial,l.Material.prototype.copy.call(u,s),u.color.copy(s.color),this.cache.add(c,u)),s=u}if(i||r||o){let c="ClonedMaterial:"+s.uuid+":";s.isGLTFSpecularGlossinessMaterial&&(c+="specular-glossiness:"),i&&(c+="derivative-tangents:"),r&&(c+="vertex-colors:"),o&&(c+="flat-shading:");let u=this.cache.get(c);u||(u=s.clone(),r&&(u.vertexColors=!0),o&&(u.flatShading=!0),i&&(u.normalScale&&(u.normalScale.y*=-1),u.clearcoatNormalScale&&(u.clearcoatNormalScale.y*=-1)),this.cache.add(c,u),this.associations.set(u,this.associations.get(s))),s=u}s.aoMap&&t.attributes.uv2===void 0&&t.attributes.uv!==void 0&&t.setAttribute("uv2",t.attributes.uv),e.material=s}getMaterialType(){return l.MeshStandardMaterial}loadMaterial(e){const t=this,s=this.json,i=this.extensions,r=s.materials[e];let o;const c={},u=r.extensions||{},h=[];if(u[A.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const f=i[A.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];o=f.getMaterialType(),h.push(f.extendParams(c,r,t))}else if(u[A.KHR_MATERIALS_UNLIT]){const f=i[A.KHR_MATERIALS_UNLIT];o=f.getMaterialType(),h.push(f.extendParams(c,r,t))}else{const f=r.pbrMetallicRoughness||{};if(c.color=new l.Color(1,1,1),c.opacity=1,Array.isArray(f.baseColorFactor)){const g=f.baseColorFactor;c.color.fromArray(g),c.opacity=g[3]}f.baseColorTexture!==void 0&&h.push(t.assignTexture(c,"map",f.baseColorTexture,l.sRGBEncoding)),c.metalness=f.metallicFactor!==void 0?f.metallicFactor:1,c.roughness=f.roughnessFactor!==void 0?f.roughnessFactor:1,f.metallicRoughnessTexture!==void 0&&(h.push(t.assignTexture(c,"metalnessMap",f.metallicRoughnessTexture)),h.push(t.assignTexture(c,"roughnessMap",f.metallicRoughnessTexture))),o=this._invokeOne(function(g){return g.getMaterialType&&g.getMaterialType(e)}),h.push(Promise.all(this._invokeAll(function(g){return g.extendMaterialParams&&g.extendMaterialParams(e,c)})))}r.doubleSided===!0&&(c.side=l.DoubleSide);const p=r.alphaMode||Ut.OPAQUE;if(p===Ut.BLEND?(c.transparent=!0,c.depthWrite=!1):(c.transparent=!1,p===Ut.MASK&&(c.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&o!==l.MeshBasicMaterial&&(h.push(t.assignTexture(c,"normalMap",r.normalTexture)),c.normalScale=new l.Vector2(1,1),r.normalTexture.scale!==void 0)){const f=r.normalTexture.scale;c.normalScale.set(f,f)}return r.occlusionTexture!==void 0&&o!==l.MeshBasicMaterial&&(h.push(t.assignTexture(c,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(c.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&o!==l.MeshBasicMaterial&&(c.emissive=new l.Color().fromArray(r.emissiveFactor)),r.emissiveTexture!==void 0&&o!==l.MeshBasicMaterial&&h.push(t.assignTexture(c,"emissiveMap",r.emissiveTexture,l.sRGBEncoding)),Promise.all(h).then(function(){let f;return o===Nt?f=i[A.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(c):f=new o(c),r.name&&(f.name=r.name),Pe(f,r),t.associations.set(f,{materials:e}),r.extensions&&qe(i,f,r),f})}createUniqueName(e){const t=l.PropertyBinding.sanitizeNodeName(e||"");let s=t;for(let i=1;this.nodeNamesUsed[s];++i)s=t+"_"+i;return this.nodeNamesUsed[s]=!0,s}loadGeometries(e){const t=this,s=this.extensions,i=this.primitiveCache;function r(c){return s[A.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(c,t).then(function(u){return Mn(u,c,t)})}const o=[];for(let c=0,u=e.length;c<u;c++){const h=e[c],p=ui(h),f=i[p];if(f)o.push(f.promise);else{let g;h.extensions&&h.extensions[A.KHR_DRACO_MESH_COMPRESSION]?g=r(h):g=Mn(new l.BufferGeometry,h,t),i[p]={primitive:h,promise:g},o.push(g)}}return Promise.all(o)}loadMesh(e){const t=this,s=this.json,i=this.extensions,r=s.meshes[e],o=r.primitives,c=[];for(let u=0,h=o.length;u<h;u++){const p=o[u].material===void 0?ai(this.cache):this.getDependency("material",o[u].material);c.push(p)}return c.push(t.loadGeometries(o)),Promise.all(c).then(function(u){const h=u.slice(0,u.length-1),p=u[u.length-1],f=[];for(let E=0,S=p.length;E<S;E++){const O=p[E],y=o[E];let T;const L=h[E];if(y.mode===le.TRIANGLES||y.mode===le.TRIANGLE_STRIP||y.mode===le.TRIANGLE_FAN||y.mode===void 0)T=r.isSkinnedMesh===!0?new l.SkinnedMesh(O,L):new l.Mesh(O,L),T.isSkinnedMesh===!0&&!T.geometry.attributes.skinWeight.normalized&&T.normalizeSkinWeights(),y.mode===le.TRIANGLE_STRIP?T.geometry=Sn(T.geometry,l.TriangleStripDrawMode):y.mode===le.TRIANGLE_FAN&&(T.geometry=Sn(T.geometry,l.TriangleFanDrawMode));else if(y.mode===le.LINES)T=new l.LineSegments(O,L);else if(y.mode===le.LINE_STRIP)T=new l.Line(O,L);else if(y.mode===le.LINE_LOOP)T=new l.LineLoop(O,L);else if(y.mode===le.POINTS)T=new l.Points(O,L);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+y.mode);Object.keys(T.geometry.morphAttributes).length>0&&li(T,r),T.name=t.createUniqueName(r.name||"mesh_"+e),Pe(T,r),y.extensions&&qe(i,T,y),t.assignFinalMaterial(T),f.push(T)}for(let E=0,S=f.length;E<S;E++)t.associations.set(f[E],{meshes:e,primitives:E});if(f.length===1)return f[0];const g=new l.Group;t.associations.set(g,{meshes:e});for(let E=0,S=f.length;E<S;E++)g.add(f[E]);return g})}loadCamera(e){let t;const s=this.json.cameras[e],i=s[s.type];if(!i){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return s.type==="perspective"?t=new l.PerspectiveCamera(l.MathUtils.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):s.type==="orthographic"&&(t=new l.OrthographicCamera(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),s.name&&(t.name=this.createUniqueName(s.name)),Pe(t,s),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],s={joints:t.joints};return t.inverseBindMatrices===void 0?Promise.resolve(s):this.getDependency("accessor",t.inverseBindMatrices).then(function(i){return s.inverseBindMatrices=i,s})}loadAnimation(e){const s=this.json.animations[e],i=[],r=[],o=[],c=[],u=[];for(let h=0,p=s.channels.length;h<p;h++){const f=s.channels[h],g=s.samplers[f.sampler],E=f.target,S=E.node!==void 0?E.node:E.id,O=s.parameters!==void 0?s.parameters[g.input]:g.input,y=s.parameters!==void 0?s.parameters[g.output]:g.output;i.push(this.getDependency("node",S)),r.push(this.getDependency("accessor",O)),o.push(this.getDependency("accessor",y)),c.push(g),u.push(E)}return Promise.all([Promise.all(i),Promise.all(r),Promise.all(o),Promise.all(c),Promise.all(u)]).then(function(h){const p=h[0],f=h[1],g=h[2],E=h[3],S=h[4],O=[];for(let T=0,L=p.length;T<L;T++){const C=p[T],w=f[T],x=g[T],M=E[T],G=S[T];if(C===void 0)continue;C.updateMatrix(),C.matrixAutoUpdate=!0;let P;switch(ge[G.path]){case ge.weights:P=l.NumberKeyframeTrack;break;case ge.rotation:P=l.QuaternionKeyframeTrack;break;case ge.position:case ge.scale:default:P=l.VectorKeyframeTrack;break}const I=C.name?C.name:C.uuid,Lt=M.interpolation!==void 0?oi[M.interpolation]:l.InterpolateLinear,xe=[];ge[G.path]===ge.weights?C.traverse(function(Q){Q.morphTargetInfluences&&xe.push(Q.name?Q.name:Q.uuid)}):xe.push(I);let q=x.array;if(x.normalized){const Q=xt(q.constructor),Fe=new Float32Array(q.length);for(let ie=0,wt=q.length;ie<wt;ie++)Fe[ie]=q[ie]*Q;q=Fe}for(let Q=0,Fe=xe.length;Q<Fe;Q++){const ie=new P(xe[Q]+"."+ge[G.path],w.array,q,Lt);M.interpolation==="CUBICSPLINE"&&(ie.createInterpolant=function(It){const nn=this instanceof l.QuaternionKeyframeTrack?ri:Gt;return new nn(this.times,this.values,this.getValueSize()/3,It)},ie.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),O.push(ie)}}const y=s.name?s.name:"animation_"+e;return new l.AnimationClip(y,void 0,O)})}createNodeMesh(e){const t=this.json,s=this,i=t.nodes[e];return i.mesh===void 0?null:s.getDependency("mesh",i.mesh).then(function(r){const o=s._getNodeRef(s.meshCache,i.mesh,r);return i.weights!==void 0&&o.traverse(function(c){if(!!c.isMesh)for(let u=0,h=i.weights.length;u<h;u++)c.morphTargetInfluences[u]=i.weights[u]}),o})}loadNode(e){const t=this.json,s=this.extensions,i=this,r=t.nodes[e],o=r.name?i.createUniqueName(r.name):"";return function(){const c=[],u=i._invokeOne(function(h){return h.createNodeMesh&&h.createNodeMesh(e)});return u&&c.push(u),r.camera!==void 0&&c.push(i.getDependency("camera",r.camera).then(function(h){return i._getNodeRef(i.cameraCache,r.camera,h)})),i._invokeAll(function(h){return h.createNodeAttachment&&h.createNodeAttachment(e)}).forEach(function(h){c.push(h)}),Promise.all(c)}().then(function(c){let u;if(r.isBone===!0?u=new l.Bone:c.length>1?u=new l.Group:c.length===1?u=c[0]:u=new l.Object3D,u!==c[0])for(let h=0,p=c.length;h<p;h++)u.add(c[h]);if(r.name&&(u.userData.name=r.name,u.name=o),Pe(u,r),r.extensions&&qe(s,u,r),r.matrix!==void 0){const h=new l.Matrix4;h.fromArray(r.matrix),u.applyMatrix4(h)}else r.translation!==void 0&&u.position.fromArray(r.translation),r.rotation!==void 0&&u.quaternion.fromArray(r.rotation),r.scale!==void 0&&u.scale.fromArray(r.scale);return i.associations.has(u)||i.associations.set(u,{}),i.associations.get(u).nodes=e,u})}loadScene(e){const t=this.json,s=this.extensions,i=this.json.scenes[e],r=this,o=new l.Group;i.name&&(o.name=r.createUniqueName(i.name)),Pe(o,i),i.extensions&&qe(s,o,i);const c=i.nodes||[],u=[];for(let h=0,p=c.length;h<p;h++)u.push(yn(c[h],o,t,r));return Promise.all(u).then(function(){const h=p=>{const f=new Map;for(const[g,E]of r.associations)(g instanceof l.Material||g instanceof l.Texture)&&f.set(g,E);return p.traverse(g=>{const E=r.associations.get(g);E!=null&&f.set(g,E)}),f};return r.associations=h(o),o})}}function yn(n,e,t,s){const i=t.nodes[n];return s.getDependency("node",n).then(function(r){if(i.skin===void 0)return r;let o;return s.getDependency("skin",i.skin).then(function(c){o=c;const u=[];for(let h=0,p=o.joints.length;h<p;h++)u.push(s.getDependency("node",o.joints[h]));return Promise.all(u)}).then(function(c){return r.traverse(function(u){if(!u.isMesh)return;const h=[],p=[];for(let f=0,g=c.length;f<g;f++){const E=c[f];if(E){h.push(E);const S=new l.Matrix4;o.inverseBindMatrices!==void 0&&S.fromArray(o.inverseBindMatrices.array,f*16),p.push(S)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',o.joints[f])}u.bind(new l.Skeleton(h,p),u.matrixWorld)}),r})}).then(function(r){e.add(r);const o=[];if(i.children){const c=i.children;for(let u=0,h=c.length;u<h;u++){const p=c[u];o.push(yn(p,r,t,s))}}return Promise.all(o)})}function pi(n,e,t){const s=e.attributes,i=new l.Box3;if(s.POSITION!==void 0){const c=t.json.accessors[s.POSITION],u=c.min,h=c.max;if(u!==void 0&&h!==void 0){if(i.set(new l.Vector3(u[0],u[1],u[2]),new l.Vector3(h[0],h[1],h[2])),c.normalized){const p=xt(Qe[c.componentType]);i.min.multiplyScalar(p),i.max.multiplyScalar(p)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const r=e.targets;if(r!==void 0){const c=new l.Vector3,u=new l.Vector3;for(let h=0,p=r.length;h<p;h++){const f=r[h];if(f.POSITION!==void 0){const g=t.json.accessors[f.POSITION],E=g.min,S=g.max;if(E!==void 0&&S!==void 0){if(u.setX(Math.max(Math.abs(E[0]),Math.abs(S[0]))),u.setY(Math.max(Math.abs(E[1]),Math.abs(S[1]))),u.setZ(Math.max(Math.abs(E[2]),Math.abs(S[2]))),g.normalized){const O=xt(Qe[g.componentType]);u.multiplyScalar(O)}c.max(u)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(c)}n.boundingBox=i;const o=new l.Sphere;i.getCenter(o.center),o.radius=i.min.distanceTo(i.max)/2,n.boundingSphere=o}function Mn(n,e,t){const s=e.attributes,i=[];function r(o,c){return t.getDependency("accessor",o).then(function(u){n.setAttribute(c,u)})}for(const o in s){const c=Dt[o]||o.toLowerCase();c in n.attributes||i.push(r(s[o],c))}if(e.indices!==void 0&&!n.index){const o=t.getDependency("accessor",e.indices).then(function(c){n.setIndex(c)});i.push(o)}return Pe(n,e),pi(n,e,t),Promise.all(i).then(function(){return e.targets!==void 0?ci(n,e.targets,t):n})}function Sn(n,e){let t=n.getIndex();if(t===null){const o=[],c=n.getAttribute("position");if(c!==void 0){for(let u=0;u<c.count;u++)o.push(u);n.setIndex(o),t=n.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const s=t.count-2,i=[];if(e===l.TriangleFanDrawMode)for(let o=1;o<=s;o++)i.push(t.getX(0)),i.push(t.getX(o)),i.push(t.getX(o+1));else for(let o=0;o<s;o++)o%2==0?(i.push(t.getX(o)),i.push(t.getX(o+1)),i.push(t.getX(o+2))):(i.push(t.getX(o+2)),i.push(t.getX(o+1)),i.push(t.getX(o)));i.length/3!==s&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=n.clone();return r.setIndex(i),r}var V;(function(n){n.BEFORELOAD="beforeLoad",n.LOADING="loading",n.DETAILLOADING="detailLoading",n.DETAILLOADED="detailLoaded",n.LOADED="loaded"})(V||(V={}));class On extends te{constructor(e){super();d(this,"resourceMap");d(this,"loaderMap");d(this,"loadTotal");d(this,"loadSuccess");d(this,"loadError");d(this,"isError");d(this,"isLoading");d(this,"isLoaded");d(this,"loadDetailMap");d(this,"path","");this.resourceMap=new Map,this.loadTotal=0,this.loadSuccess=0,this.loadError=0,this.isError=!1,this.isLoading=!1,this.isLoaded=!1,this.loadDetailMap={};const t=new l.ImageLoader,s=new Ie,i=new js;this.loaderMap={jpg:t,png:t,jpeg:t,obj:new Ts.OBJLoader,mtl:new ys.MTLLoader,mp4:s,webm:s,ogg:s,hdr:new Ms.RGBELoader,glb:i,gltf:i},e&&(this.loaderMap=Object.assign(this.loaderMap,e.loaderExtends))}loaded(){return this.dispatchEvent({type:V.LOADED,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError,resourceMap:this.resourceMap}),this}checkLoaded(){return this.loadTotal===this.loadSuccess+this.loadError&&(this.isError=!0,this.isLoaded=!0,this.isLoading=!1,this.loaded()),this}setPath(e){const t=this.loaderMap;return Object.keys(t).forEach(s=>{t[s].setPath(e)}),this.path=e,this}load(e){var r;if(this.reset(),this.isLoading=!0,this.dispatchEvent({type:V.BEFORELOAD,urlList:[...e]}),e.length<=0)return this.checkLoaded(),console.warn("url list is empty."),this;this.loadTotal+=e.length;const t=this.resourceMap,s=this.loaderMap,i=this.loadDetailMap;for(const o of e){let c,u;typeof o=="string"?(c=o,u=((r=c.split(".").pop())==null?void 0:r.toLocaleLowerCase())||""):(c=o.url,u=o.ext.toLocaleLowerCase());const h={url:c,progress:0,error:!1,message:c};if(i[c]=h,t.has(c)){h.progress=1,this.loadSuccess+=1,this.dispatchEvent({type:V.DETAILLOADED,detail:h}),this.dispatchEvent({type:V.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded();continue}if(!u){h.message=`url: ${c} \u5730\u5740\u6709\u8BEF\uFF0C\u65E0\u6CD5\u83B7\u53D6\u6587\u4EF6\u683C\u5F0F\u3002`,console.warn(h.message),h.error=!0,this.isError=!0,this.loadError+=1,this.dispatchEvent({type:V.DETAILLOADED,detail:h}),this.dispatchEvent({type:V.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError});continue}const p=s[u];if(!p){h.message=`url: ${c} \u4E0D\u652F\u6301\u6B64\u6587\u4EF6\u683C\u5F0F\u52A0\u8F7D\u3002`,console.warn(h.message),h.error=!0,this.isError=!0,this.loadError+=1,this.dispatchEvent({type:V.DETAILLOADED,detail:h}),this.dispatchEvent({type:V.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError});continue}p.loadAsync(c,f=>{h.progress=Number((f.loaded/f.total).toFixed(2)),this.dispatchEvent({type:V.DETAILLOADING,detail:h})}).then(f=>{h.progress=1,this.loadSuccess+=1,this.resourceMap.set(c,f),this.dispatchEvent({type:V.DETAILLOADED,detail:h}),this.dispatchEvent({type:V.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded()}).catch(f=>{h.error=!0,h.message=JSON.stringify(f),this.loadError+=1,this.dispatchEvent({type:V.DETAILLOADED,detail:h}),this.dispatchEvent({type:V.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded()})}return this}reset(){return this.loadTotal=0,this.loadSuccess=0,this.loadError=0,this.isError=!1,this.isLoading=!1,this.isLoaded=!1,this.loadDetailMap={},this}register(e,t){return this.loaderMap[e]=t,this}hasLoaded(e){return this.resourceMap.has(e)}getResource(e){return this.resourceMap.get(e)}getLoadDetailMap(){return this.loadDetailMap}setLoadDetailMap(e){return this.loadDetailMap=e,this}remove(e){}toJSON(){const e=[];return this.resourceMap.forEach((t,s)=>{e.push(s)}),JSON.stringify(e)}exportConfig(){const e=[];return this.resourceMap.forEach((t,s)=>{e.push(s)}),e}dispose(){return this.resourceMap.clear(),this}}const fi=function(n){if(this.loaderManager)return console.warn("engine has installed loaderManager plugin."),!1;const e=new On(n);return this.loaderManager=e,this.loadResources=(t,s)=>{if(this.resourceManager){const i=r=>{s(void 0,r),this.resourceManager.removeEventListener("mapped",i)};try{this.resourceManager.addEventListener("mapped",i)}catch(r){s(r)}}else{const i=r=>{s(void 0,r),this.loaderManager.removeEventListener("loaded",i)};try{this.loaderManager.addEventListener("loaded",i)}catch(r){s(r)}}return this.loaderManager.load(t),this},this.loadResourcesAsync=t=>new Promise((s,i)=>{if(this.resourceManager){const r=o=>{s(o),this.resourceManager.removeEventListener("mapped",r)};try{this.resourceManager.addEventListener("mapped",r)}catch(o){i(o)}}else{const r=o=>{s(o),this.loaderManager.removeEventListener("loaded",r)};try{this.loaderManager.addEventListener("loaded",r)}catch(o){i(o)}}this.loaderManager.load(t)}),!0};a.CONFIGTYPE=void 0,function(n){n.BOXGEOMETRY="BoxGeometry",n.SPHEREGEOMETRY="SphereGeometry",n.LOADGEOMETRY="LoadGeometry",n.PLANEGEOMETRY="PlaneGeometry",n.CIRCLEGEOMETRY="CircleGeometry",n.CONEGEOMETRY="ConeGeometry",n.CYLINDERGEOMETRY="CylinderGeometry",n.DODECAHEDRONGEOMETRY="DodecahedronGeometry",n.TORUSGEOMETRY="TorusGeometry",n.RINGGEOMETRY="RingGeometry",n.EDGESGEOMETRY="EdgesGeometry",n.LINECURVEGEOMETRY="LineCurveGeometry",n.SPLINECURVEGEOMETRY="SplineCurveGeometry",n.CUBICBEZIERCURVEGEOMETRY="CubicBezierCurveGeometry",n.QUADRATICBEZIERCURVEGEOMETRY="QuadraticBezierCurveGeometry",n.CUSTOMGEOMETRY="CustomGeometry",n.LINETUBEGEOMETRY="LineTubeGeometry",n.SPLINETUBEGEOMETRY="SplineTubeGeometry",n.LINESHAPEGEOMETRY="LineShapeGeometry",n.MESH="Mesh",n.LINE="Line",n.POINTS="Points",n.SPRITE="Sprite",n.GROUP="Group",n.CSS3DOBJECT="CSS3DObject",n.CSS3DSPRITE="CSS3DSprite",n.CSS3DPLANE="CSS3DPlane",n.IMAGETEXTURE="ImageTexture",n.CUBETEXTURE="CubeTexture",n.CANVASTEXTURE="CanvasTexture",n.VIDEOTEXTURE="VideoTexture",n.LOADTEXTURE="LoadTexture",n.MESHBASICMATERIAL="MeshBasicMaterial",n.MESHSTANDARDMATERIAL="MeshStandardMaterial",n.MESHPHONGMATERIAL="MeshPhongMaterial",n.SPRITEMATERIAL="SpriteMaterial",n.LINEBASICMATERIAL="LineBasicMaterial",n.POINTSMATERIAL="PointsMaterial",n.SHADERMATERIAL="ShaderMaterial",n.AMBIENTLIGHT="AmbientLight",n.SPOTLIGHT="SpotLight",n.POINTLIGHT="PointLight",n.DIRECTIONALLIGHT="DirectionalLight",n.HEMISPHERELIGHT="HemisphereLight",n.PERSPECTIVECAMERA="PerspectiveCamera",n.ORTHOGRAPHICCAMERA="OrthographicCamera",n.WEBGLRENDERER="WebGLRenderer",n.CSS3DRENDERER="CSS3DRenderer",n.SCENE="Scene",n.TRNASFORMCONTROLS="TransformControls",n.ORBITCONTROLS="OrbitControls",n.SMAAPASS="SMAAPass",n.UNREALBLOOMPASS="UnrealBloomPass",n.SELECTIVEBLOOMPASS="SelectiveBloomPass",n.SCRIPTANIMATION="ScriptAnimation",n.KEYFRAMEANIMATION="KeyframeAnimation"}(a.CONFIGTYPE||(a.CONFIGTYPE={})),a.MODULETYPE=void 0,function(n){n.CAMERA="camera",n.LIGHT="light",n.GEOMETRY="geometry",n.TEXTURE="texture",n.MATERIAL="material",n.RENDERER="renderer",n.SCENE="scene",n.SPRITE="sprite",n.CONTROLS="controls",n.LINE="line",n.MESH="mesh",n.POINTS="points",n.GROUP="group",n.CSS3D="css3D",n.PASS="pass",n.ANIMATION="animation"}(a.MODULETYPE||(a.MODULETYPE={})),a.OBJECTMODULE=void 0,function(n){n[n.CAMERA=a.MODULETYPE.CAMERA]="CAMERA",n[n.LIGHT=a.MODULETYPE.LIGHT]="LIGHT",n[n.SCENE=a.MODULETYPE.SCENE]="SCENE",n[n.SPRITE=a.MODULETYPE.SPRITE]="SPRITE",n[n.LINE=a.MODULETYPE.LINE]="LINE",n[n.MESH=a.MODULETYPE.MESH]="MESH",n[n.POINTS=a.MODULETYPE.POINTS]="POINTS",n[n.GROUP=a.MODULETYPE.GROUP]="GROUP",n[n.CSS3D=a.MODULETYPE.CSS3D]="CSS3D"}(a.OBJECTMODULE||(a.OBJECTMODULE={}));const mi={[a.CONFIGTYPE.IMAGETEXTURE]:a.MODULETYPE.TEXTURE,[a.CONFIGTYPE.CUBETEXTURE]:a.MODULETYPE.TEXTURE,[a.CONFIGTYPE.CANVASTEXTURE]:a.MODULETYPE.TEXTURE,[a.CONFIGTYPE.VIDEOTEXTURE]:a.MODULETYPE.TEXTURE,[a.CONFIGTYPE.MESHBASICMATERIAL]:a.MODULETYPE.MATERIAL,[a.CONFIGTYPE.MESHSTANDARDMATERIAL]:a.MODULETYPE.MATERIAL,[a.CONFIGTYPE.MESHPHONGMATERIAL]:a.MODULETYPE.MATERIAL,[a.CONFIGTYPE.SPRITEMATERIAL]:a.MODULETYPE.MATERIAL,[a.CONFIGTYPE.LINEBASICMATERIAL]:a.MODULETYPE.MATERIAL,[a.CONFIGTYPE.POINTSMATERIAL]:a.MODULETYPE.MATERIAL,[a.CONFIGTYPE.SHADERMATERIAL]:a.MODULETYPE.MATERIAL,[a.CONFIGTYPE.AMBIENTLIGHT]:a.MODULETYPE.LIGHT,[a.CONFIGTYPE.SPOTLIGHT]:a.MODULETYPE.LIGHT,[a.CONFIGTYPE.POINTLIGHT]:a.MODULETYPE.LIGHT,[a.CONFIGTYPE.DIRECTIONALLIGHT]:a.MODULETYPE.LIGHT,[a.CONFIGTYPE.BOXGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.SPHEREGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.LOADGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.CUSTOMGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.PLANEGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.CIRCLEGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.CONEGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.CIRCLEGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.EDGESGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.CYLINDERGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.LINECURVEGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.SPLINECURVEGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.CUBICBEZIERCURVEGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.QUADRATICBEZIERCURVEGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.LINETUBEGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.SPLINETUBEGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.TORUSGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.RINGGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.LINESHAPEGEOMETRY]:a.MODULETYPE.GEOMETRY,[a.CONFIGTYPE.SPRITE]:a.MODULETYPE.SPRITE,[a.CONFIGTYPE.LINE]:a.MODULETYPE.LINE,[a.CONFIGTYPE.MESH]:a.MODULETYPE.MESH,[a.CONFIGTYPE.POINTS]:a.MODULETYPE.POINTS,[a.CONFIGTYPE.GROUP]:a.MODULETYPE.GROUP,[a.CONFIGTYPE.CSS3DOBJECT]:a.MODULETYPE.CSS3D,[a.CONFIGTYPE.CSS3DSPRITE]:a.MODULETYPE.CSS3D,[a.CONFIGTYPE.CSS3DPLANE]:a.MODULETYPE.CSS3D,[a.CONFIGTYPE.PERSPECTIVECAMERA]:a.MODULETYPE.CAMERA,[a.CONFIGTYPE.ORTHOGRAPHICCAMERA]:a.MODULETYPE.CAMERA,[a.CONFIGTYPE.WEBGLRENDERER]:a.MODULETYPE.RENDERER,[a.CONFIGTYPE.SCENE]:a.MODULETYPE.SCENE,[a.CONFIGTYPE.TRNASFORMCONTROLS]:a.MODULETYPE.CONTROLS,[a.CONFIGTYPE.ORBITCONTROLS]:a.MODULETYPE.CONTROLS,[a.CONFIGTYPE.SMAAPASS]:a.MODULETYPE.PASS,[a.CONFIGTYPE.UNREALBLOOMPASS]:a.MODULETYPE.PASS,[a.CONFIGTYPE.SCRIPTANIMATION]:a.MODULETYPE.ANIMATION,[a.CONFIGTYPE.KEYFRAMEANIMATION]:a.MODULETYPE.ANIMATION},je=n=>{const e=t=>n.toLocaleLowerCase().includes(t.toLocaleLowerCase());for(const t of Object.values(a.MODULETYPE))if(e(t))return t;return null},Ee=()=>({vid:"",name:"",type:"Object3D",castShadow:!0,receiveShadow:!0,lookAt:"",visible:!0,matrixAutoUpdate:!0,renderOrder:0,position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},up:{x:0,y:1,z:0},parent:"",children:[],pointerdown:[],pointermove:[],pointerup:[],pointerenter:[],pointerleave:[],click:[],dblclick:[],contextmenu:[]}),at=function(){return Object.assign(Ee(),{type:"Light",color:"rgb(255, 255, 255)",intensity:1})},gi=function(){return Object.assign(Ee(),{type:a.CONFIGTYPE.AMBIENTLIGHT,color:"rgb(255, 255, 255)",intensity:1})},Ei=function(){return Object.assign(at(),{type:a.CONFIGTYPE.POINTLIGHT,distance:30,decay:.01})},Ti=function(){return Object.assign(at(),{type:a.CONFIGTYPE.SPOTLIGHT,distance:30,angle:Math.PI/180*45,penumbra:.01,decay:.01})},yi=function(){return Object.assign(at(),{type:a.CONFIGTYPE.DIRECTIONALLIGHT,shadow:{mapSize:{width:512,height:512},camera:{near:.5,far:500}}})},Mi=function(){return Object.assign(at(),{type:a.CONFIGTYPE.HEMISPHERELIGHT,color:"rgb(255, 255, 255)",groundColor:"rgb(0, 0, 0)"})},W=function(){return{vid:"",type:"Geometry",position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},groups:[]}},Si=function(){return Object.assign(W(),{type:a.CONFIGTYPE.BOXGEOMETRY,width:5,height:5,depth:5,widthSegments:1,heightSegments:1,depthSegments:1})},Oi=function(){return Object.assign(W(),{type:a.CONFIGTYPE.SPHEREGEOMETRY,radius:3,widthSegments:32,heightSegments:32,phiStart:0,phiLength:Math.PI*2,thetaStart:0,thetaLength:Math.PI})},Ci=function(){return Object.assign(W(),{type:a.CONFIGTYPE.PLANEGEOMETRY,width:5,height:5,widthSegments:1,heightSegments:1})},bi=function(){return Object.assign(W(),{type:a.CONFIGTYPE.CIRCLEGEOMETRY,radius:3,segments:8,thetaStart:0,thetaLength:Math.PI*2})},Ri=function(){return Object.assign(W(),{type:a.CONFIGTYPE.CONEGEOMETRY,radius:3,height:5,radialSegments:8,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:Math.PI*2})},Li=function(){return Object.assign(W(),{type:a.CONFIGTYPE.TORUSGEOMETRY,radius:3,tube:.4,radialSegments:8,tubularSegments:6,arc:Math.PI*2})},wi=function(){return Object.assign(W(),{type:a.CONFIGTYPE.RINGGEOMETRY,innerRadius:2,outerRadius:3,thetaSegments:8,phiSegments:8,thetaStart:0,thetaLength:Math.PI*2})},Ii=function(){return Object.assign(W(),{type:a.CONFIGTYPE.LOADGEOMETRY,url:""})},Pi=function(){return Object.assign(W(),{type:a.CONFIGTYPE.CUSTOMGEOMETRY,attribute:{position:[],color:[],index:[],normal:[],uv:[],uv2:[]}})},vi=function(){return Object.assign(W(),{type:a.CONFIGTYPE.CYLINDERGEOMETRY,radiusTop:3,radiusBottom:3,height:5,radialSegments:8,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:Math.PI*2})},Ai=function(){return Object.assign(W(),{type:"",radius:3,detail:0})},Ni=function(){return Object.assign(W(),{type:a.CONFIGTYPE.LOADGEOMETRY,url:"",thresholdAngle:1})},ct=function(){return Object.assign(W(),{path:[],divisions:36,space:!0})},Gi=function(){return Object.assign(ct(),{type:a.CONFIGTYPE.LINECURVEGEOMETRY})},Di=function(){return Object.assign(ct(),{type:a.CONFIGTYPE.SPLINECURVEGEOMETRY})},Ui=function(){return Object.assign(ct(),{type:a.CONFIGTYPE.CUBICBEZIERCURVEGEOMETRY})},xi=function(){return Object.assign(ct(),{type:a.CONFIGTYPE.QUADRATICBEZIERCURVEGEOMETRY})},Cn=function(){return Object.assign(W(),{type:"TubeGeometry",path:[],tubularSegments:64,radius:1,radialSegments:8,closed:!1})},Fi=function(){return Object.assign(Cn(),{type:a.CONFIGTYPE.LINETUBEGEOMETRY})},ji=function(){return Object.assign(Cn(),{type:a.CONFIGTYPE.SPLINETUBEGEOMETRY})},Yi=function(){return Object.assign(W(),{path:[],curveSegments:12})},Hi=function(){return Object.assign(Yi(),{type:a.CONFIGTYPE.LINESHAPEGEOMETRY})},Ze=function(){return{vid:"",type:"Texture",name:"",mapping:l.UVMapping,wrapS:l.ClampToEdgeWrapping,wrapT:l.ClampToEdgeWrapping,magFilter:l.LinearFilter,minFilter:l.LinearMipmapLinearFilter,anisotropy:1,format:l.RGBAFormat,offset:{x:0,y:0},repeat:{x:1,y:1},rotation:0,center:{x:0,y:0},matrixAutoUpdate:!0,encoding:l.LinearEncoding,needsUpdate:!1}},Bi=function(){return Object.assign(Ze(),{type:a.CONFIGTYPE.IMAGETEXTURE,url:""})},_i=function(){return Object.assign(Ze(),{type:a.CONFIGTYPE.VIDEOTEXTURE,url:"",minFilter:l.LinearFilter})},ki=function(){return Object.assign(Ze(),{type:a.CONFIGTYPE.CUBETEXTURE,cube:{nx:"",ny:"",nz:"",px:"",py:"",pz:""},mapping:l.CubeReflectionMapping,flipY:!1})},zi=function(){return Object.assign(Ze(),{type:a.CONFIGTYPE.CANVASTEXTURE,url:"",needsUpdate:!1})},Vi=function(){return Object.assign(Ze(),{type:a.CONFIGTYPE.LOADTEXTURE,url:""})},ve=function(){return{vid:"",type:"Material",alphaTest:0,colorWrite:!0,depthTest:!0,depthWrite:!0,fog:!0,name:"",needsUpdate:!1,opacity:1,dithering:!1,shadowSide:null,side:l.FrontSide,toneMapped:!0,transparent:!1,visible:!0,blendDst:l.OneMinusSrcAlphaFactor,blendDstAlpha:null,blendEquation:l.AddEquation,blendEquationAlpha:null,blending:l.NormalBlending,blendSrc:l.SrcAlphaFactor,blendSrcAlpha:null,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0}},Wi=function(){return Object.assign(ve(),{type:a.CONFIGTYPE.MESHBASICMATERIAL,color:"rgb(255, 255, 255)",combine:l.MultiplyOperation,aoMapIntensity:1,fog:!0,lightMapIntensity:1,reflectivity:1,refractionRatio:.98,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",wireframeLinewidth:1,map:"",envMap:"",alphaMap:"",aoMap:"",lightMap:"",specularMap:""})},$i=function(){return Object.assign(ve(),{type:a.CONFIGTYPE.MESHSTANDARDMATERIAL,aoMapIntensity:1,bumpScale:1,color:"rgb(255, 255, 255)",displacementScale:1,displacementBias:0,emissive:"rgb(0, 0, 0)",emissiveIntensity:1,envMapIntensity:1,flatShading:!1,lightMapIntensity:1,metalness:0,normalMapType:l.TangentSpaceNormalMap,refractionRatio:.98,roughness:1,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",roughnessMap:"",normalMap:"",metalnessMap:"",map:"",lightMap:"",envMap:"",emissiveMap:"",displacementMap:"",bumpMap:"",alphaMap:"",aoMap:""})},Ki=function(){return Object.assign(ve(),{type:a.CONFIGTYPE.MESHPHONGMATERIAL,aoMapIntensity:1,bumpScale:1,color:"rgb(255, 255, 255)",displacementScale:1,displacementBias:0,emissive:"rgb(0, 0, 0)",emissiveIntensity:1,envMapIntensity:1,flatShading:!1,lightMapIntensity:1,normalMapType:l.TangentSpaceNormalMap,refractionRatio:.98,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",specular:"rgb(17, 17, 17)",shininess:30,combine:l.MultiplyOperation,normalMap:"",map:"",lightMap:"",envMap:"",emissiveMap:"",displacementMap:"",bumpMap:"",alphaMap:"",aoMap:"",specularMap:""})},Xi=function(){return Object.assign(ve(),{type:a.CONFIGTYPE.SPRITEMATERIAL,color:"rgb(255, 255, 255)",rotation:0,map:"",alphaMap:"",sizeAttenuation:!0})},Qi=function(){return Object.assign(ve(),{type:a.CONFIGTYPE.LINEBASICMATERIAL,color:"rgb(255, 255, 255)",linecap:"round",linejoin:"round",linewidth:1})},qi=function(){return Object.assign(ve(),{type:a.CONFIGTYPE.POINTSMATERIAL,map:"",alphaMap:"",color:"rgb(255, 255, 255)",sizeAttenuation:!0,size:1})},Zi=function(){return Object.assign(ve(),{type:a.CONFIGTYPE.SHADERMATERIAL,shader:"defaultShader",uniforms:{}})},Ji=function(){return Object.assign(Ee(),{type:a.CONFIGTYPE.PERSPECTIVECAMERA,adaptiveWindow:!1,fov:45,aspect:1920/1080,near:5,far:50})},er=function(){return Object.assign(Ee(),{type:a.CONFIGTYPE.ORTHOGRAPHICCAMERA,adaptiveWindow:!1,left:-window.innerWidth,right:window.innerWidth,top:window.innerHeight,bottom:-window.innerHeight,near:5,far:50,zoom:1})},bn=function(){return{vid:"",type:"Renderer",size:null}},tr=function(){return Object.assign(bn(),{vid:a.CONFIGTYPE.WEBGLRENDERER,type:a.CONFIGTYPE.WEBGLRENDERER,clearColor:"rgba(0, 0, 0, 0)",outputEncoding:l.LinearEncoding,physicallyCorrectLights:!1,shadowMap:{enabled:!1,autoUpdate:!0,needsUpdate:!1,type:l.PCFShadowMap},toneMapping:l.NoToneMapping,toneMappingExposure:1,pixelRatio:window.devicePixelRatio,adaptiveCamera:!1,viewport:null,scissor:null})},nr=function(){return Object.assign(bn(),{vid:a.CONFIGTYPE.CSS3DRENDERER,type:a.CONFIGTYPE.CSS3DRENDERER})},sr=function(){return Object.assign(Ee(),{vid:a.CONFIGTYPE.SCENE,type:a.CONFIGTYPE.SCENE,background:"",environment:"",fog:{type:"",color:"rgb(150, 150, 150)",near:1,far:200,density:.003}})},ir=function(){return{vid:a.CONFIGTYPE.TRNASFORMCONTROLS,type:a.CONFIGTYPE.TRNASFORMCONTROLS,axis:"XYZ",enabled:!0,mode:"translate",snapAllow:!1,rotationSnap:Math.PI/180*10,translationSnap:5,scaleSnap:.1,showX:!0,showY:!0,showZ:!0,size:1,space:"world"}},rr=function(){return{vid:a.CONFIGTYPE.ORBITCONTROLS,type:a.CONFIGTYPE.ORBITCONTROLS,autoRotate:!1,autoRotateSpeed:2,enableDamping:!1,dampingFactor:.05,enabled:!0,enablePan:!0,enableRotate:!0,enableZoom:!0,maxAzimuthAngle:1/0,maxDistance:1/0,maxPolarAngle:Math.PI,maxZoom:1/0,minAzimuthAngle:-1/0,minDistance:0,minPolarAngle:0,minZoom:0,panSpeed:1,rotateSpeed:1,zoomSpeed:1,screenSpacePanning:!0,target:null}},lt=function(){return Object.assign(Ee(),{material:"",geometry:""})},or=function(){return Object.assign(lt(),{type:"Sprite",material:"",center:{x:.5,y:.5}})},ar=function(){return Object.assign(lt(),{type:a.CONFIGTYPE.MESH,geometry:"",material:""})},cr=function(){return Object.assign(lt(),{type:a.CONFIGTYPE.POINTS,geometry:"",material:""})},lr=function(){return Object.assign(lt(),{type:a.CONFIGTYPE.LINE,geometry:"",material:""})},ur=function(){return Object.assign(Ee(),{type:a.CONFIGTYPE.GROUP,children:[]})},Ft=function(){return{vid:"",type:"Pass"}},dr=function(){return Object.assign(Ft(),{type:a.CONFIGTYPE.SMAAPASS})},hr=function(){return Object.assign(Ft(),{type:a.CONFIGTYPE.UNREALBLOOMPASS,strength:1.5,threshold:0,radius:0})},pr=function(){return Object.assign(Ft(),{type:a.CONFIGTYPE.SELECTIVEBLOOMPASS,strength:1,threshold:0,radius:0,renderScene:"",renderCamera:"",selectedObjects:[]})},Rn=function(){return{vid:"",type:"",name:"",target:"",attribute:"",play:!0}},fr=function(){return Object.assign(Rn(),{type:a.CONFIGTYPE.SCRIPTANIMATION,script:{name:""}})},mr=function(){return Object.assign(Rn(),{type:a.CONFIGTYPE.KEYFRAMEANIMATION,script:{name:""}})},jt=function(){return Object.assign(Ee(),{type:a.CONFIGTYPE.CSS3DOBJECT,element:"",width:50,height:50})},gr=function(){return Object.assign(jt(),{type:a.CONFIGTYPE.CSS3DPLANE})},Er=function(){return Object.assign(jt(),{type:a.CONFIGTYPE.CSS3DSPRITE,rotation2D:0})},$={[a.CONFIGTYPE.IMAGETEXTURE]:Bi,[a.CONFIGTYPE.CUBETEXTURE]:ki,[a.CONFIGTYPE.CANVASTEXTURE]:zi,[a.CONFIGTYPE.VIDEOTEXTURE]:_i,[a.CONFIGTYPE.LOADTEXTURE]:Vi,[a.CONFIGTYPE.MESHBASICMATERIAL]:Wi,[a.CONFIGTYPE.MESHSTANDARDMATERIAL]:$i,[a.CONFIGTYPE.MESHPHONGMATERIAL]:Ki,[a.CONFIGTYPE.SPRITEMATERIAL]:Xi,[a.CONFIGTYPE.LINEBASICMATERIAL]:Qi,[a.CONFIGTYPE.POINTSMATERIAL]:qi,[a.CONFIGTYPE.SHADERMATERIAL]:Zi,[a.CONFIGTYPE.AMBIENTLIGHT]:gi,[a.CONFIGTYPE.SPOTLIGHT]:Ti,[a.CONFIGTYPE.POINTLIGHT]:Ei,[a.CONFIGTYPE.DIRECTIONALLIGHT]:yi,[a.CONFIGTYPE.HEMISPHERELIGHT]:Mi,[a.CONFIGTYPE.BOXGEOMETRY]:Si,[a.CONFIGTYPE.SPHEREGEOMETRY]:Oi,[a.CONFIGTYPE.LOADGEOMETRY]:Ii,[a.CONFIGTYPE.CUSTOMGEOMETRY]:Pi,[a.CONFIGTYPE.PLANEGEOMETRY]:Ci,[a.CONFIGTYPE.CIRCLEGEOMETRY]:bi,[a.CONFIGTYPE.CONEGEOMETRY]:Ri,[a.CONFIGTYPE.CYLINDERGEOMETRY]:vi,[a.CONFIGTYPE.EDGESGEOMETRY]:Ni,[a.CONFIGTYPE.LINECURVEGEOMETRY]:Gi,[a.CONFIGTYPE.SPLINECURVEGEOMETRY]:Di,[a.CONFIGTYPE.CUBICBEZIERCURVEGEOMETRY]:Ui,[a.CONFIGTYPE.QUADRATICBEZIERCURVEGEOMETRY]:xi,[a.CONFIGTYPE.DODECAHEDRONGEOMETRY]:Ai,[a.CONFIGTYPE.SPLINETUBEGEOMETRY]:ji,[a.CONFIGTYPE.LINETUBEGEOMETRY]:Fi,[a.CONFIGTYPE.TORUSGEOMETRY]:Li,[a.CONFIGTYPE.RINGGEOMETRY]:wi,[a.CONFIGTYPE.LINESHAPEGEOMETRY]:Hi,[a.CONFIGTYPE.SPRITE]:or,[a.CONFIGTYPE.LINE]:lr,[a.CONFIGTYPE.MESH]:ar,[a.CONFIGTYPE.POINTS]:cr,[a.CONFIGTYPE.GROUP]:ur,[a.CONFIGTYPE.CSS3DOBJECT]:jt,[a.CONFIGTYPE.CSS3DSPRITE]:Er,[a.CONFIGTYPE.CSS3DPLANE]:gr,[a.CONFIGTYPE.PERSPECTIVECAMERA]:Ji,[a.CONFIGTYPE.ORTHOGRAPHICCAMERA]:er,[a.CONFIGTYPE.WEBGLRENDERER]:tr,[a.CONFIGTYPE.CSS3DRENDERER]:nr,[a.CONFIGTYPE.SCENE]:sr,[a.CONFIGTYPE.TRNASFORMCONTROLS]:ir,[a.CONFIGTYPE.ORBITCONTROLS]:rr,[a.CONFIGTYPE.SMAAPASS]:dr,[a.CONFIGTYPE.UNREALBLOOMPASS]:hr,[a.CONFIGTYPE.SELECTIVEBLOOMPASS]:pr,[a.CONFIGTYPE.SCRIPTANIMATION]:fr,[a.CONFIGTYPE.KEYFRAMEANIMATION]:mr};class Ye{}class Tr extends Ye{parse({url:e,resource:t,configMap:s,resourceMap:i}){const r=$[a.CONFIGTYPE.IMAGETEXTURE]();r.url=e,i.set(e,t),s.set(e,r)}}class yr extends Ye{parse({url:e,resource:t,configMap:s,resourceMap:i}){const r=$[a.CONFIGTYPE.CANVASTEXTURE]();r.url=e,i.set(e,t),s.set(e,r)}}class Mr extends Ye{parse({url:e,resource:t,configMap:s,resourceMap:i}){const r=$[a.CONFIGTYPE.VIDEOTEXTURE]();r.url=e,i.set(e,t),s.set(e,r)}}function Ln(n,e){return n in e}function Sr(n,e){return Object.values(n).includes(e)}function Or(n){return e=>{const t=(s,i)=>{for(const r in i){if(s[r]===void 0){console.warn(` config can not set key: ${r}`);continue}typeof i[r]=="object"&&i[r]!==null&&!Array.isArray(i[r])?t(s[r],i[r]):s[r]=i[r]}};return e&&t(n,e),n}}function _(n,e,t,s){const i=(r,o,c)=>{for(const u in r)if(o[u]!==void 0&&!(c&&c[u])){if(typeof r[u]=="object"&&typeof r[u]!==null){c&&typeof c[u]=="object"&&typeof c[u]!==null?i(r[u],o[u],c[u]):i(r[u],o[u]);continue}o[u]=r[u]}};i(n,e,t),s&&s()}var Cr=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",isValidKey:Ln,isValidEnum:Sr,generateConfigFunction:Or,syncObject:_});class br extends Ye{parse(e){this.parseObject3D(e)}parseColor(e){return`rgb(${Math.round(255*e.r)}, ${Math.round(255*e.g)}, ${Math.round(255*e.b)})`}parseTexture({url:e,resource:t,configMap:s,resourceMap:i}){i.set(e,t);const r=$[t.type==="Texture"?a.CONFIGTYPE.IMAGETEXTURE:t.type]();s.set(e,r),r.vid=ee.v4(),_(t,r,{type:!0,vid:!0})}parseMaterial({url:e,resource:t,configMap:s,resourceMap:i}){i.set(e,t);const r=$[t.type]();s.set(e,r),r.vid=ee.v4(),_(t,r,{type:!0,vid:!0});for(const o of["color","emissive","specular"])r[o]&&(r[o]=this.parseColor(t[o]));for(const o of Object.keys(r))if(o.toLocaleLowerCase().endsWith("map")&&t[o]){const c=`${e}.${o}`;this.parseTexture({url:c,resource:t[o],configMap:s,resourceMap:i}),r[o]=s.get(c).vid}}parseGeometry({url:e,resource:t,configMap:s,resourceMap:i}){i.set(e,t),t.computeBoundingBox();const r=t.boundingBox,o=r.getCenter(new l.Vector3),c=$[a.CONFIGTYPE.LOADGEOMETRY]();c.vid=ee.v4(),c.url=e,c.position.x=o.x/(r.max.x-r.min.x)*2,c.position.y=o.y/(r.max.y-r.min.y)*2,c.position.z=o.z/(r.max.z-r.min.z)*2,s.set(e,c)}parseObject3D({url:e,resource:t,configMap:s,resourceMap:i}){i.set(e,t);const r=$[t.type]();if(r.vid=ee.v4(),_(t,r,{type:!0,vid:!0,children:!0,geometry:!0,material:!0,parent:!0,lookAt:!0}),s.set(e,r),t.material)if(Array.isArray(t.material))r.material=[],t.material.forEach((o,c,u)=>{const h=`${e}.material.${c}`;this.parseMaterial({url:h,resource:o,configMap:s,resourceMap:i}),r.material.push(s.get(h).vid)});else{const o=`${e}.material`;this.parseMaterial({url:o,resource:t.material,configMap:s,resourceMap:i}),r.material=s.get(o).vid}if(t.geometry){const o=`${e}.geometry`;this.parseGeometry({url:o,resource:t.geometry,configMap:s,resourceMap:i}),r.geometry=s.get(o).vid}t.children&&t.children.length&&t.children.forEach((o,c,u)=>{const h=`${e}.children.${c}`;this.parseObject3D({url:h,resource:o,configMap:s,resourceMap:i}),r.children.push(s.get(h).vid)})}}class Rr extends Ye{parse({url:e,resource:t,configMap:s,resourceMap:i}){const r=$[a.CONFIGTYPE.CSS3DPLANE]();r.element=e,i.set(e,t),s.set(e,r)}}class Lr extends Ye{parse({url:e,resource:t,configMap:s,resourceMap:i}){const r=$[a.CONFIGTYPE.LOADTEXTURE]();r.url=e,i.set(e,t),s.set(e,r)}}a.RESOURCEEVENTTYPE=void 0,function(n){n.MAPPED="mapped"}(a.RESOURCEEVENTTYPE||(a.RESOURCEEVENTTYPE={}));class wn extends te{constructor(e={}){super();d(this,"structureMap",new Map);d(this,"configMap",new Map);d(this,"resourceMap",new Map);d(this,"mappingHandler",new Map);const t=this.mappingHandler;t.set(HTMLImageElement,new Tr),t.set(HTMLCanvasElement,new yr),t.set(HTMLVideoElement,new Mr),t.set(l.Object3D,new br),t.set(HTMLElement,new Rr),t.set(l.Texture,new Lr);const s=new Map;for(const i in e)s.has(i)&&console.warn(`resourceManager construct params rescource already exist: ${i}, that will be cover.`),s.set(i,e[i]);this.mappingResource(s)}mappingResource(e){const t=this.configMap,s=this.resourceMap,i=this.mappingHandler,r=(c,u,h)=>Object.getPrototypeOf(h)?i.has(Object.getPrototypeOf(h).constructor)?(i.get(Object.getPrototypeOf(h).constructor).parse({url:c,resource:u,configMap:this.configMap,resourceMap:this.resourceMap}),!0):r(c,u,Object.getPrototypeOf(h)):!1,o={};return e.forEach((c,u)=>{r(u,c,c)?o[u]=this.getResourceConfig(u):(s.set(u,c),console.warn("resource manager can not support this resource to generate config",c))}),this.dispatchEvent({type:"mapped",structureMap:this.structureMap,configMap:t,resourceMap:s,resourceConfig:o}),this}getResourceConfig(e){const t=this.configMap,s={};return[...t.keys()].filter(i=>i.startsWith(e)).some(i=>{const r=t.get(i);if(!r)console.error(`unknow error: can not found config by url: ${i}`);else{const o=je(r.type);o?(!s[o]&&(s[o]={}),s[o][r.vid]=r):console.error(`unknow error: can not found module by type: ${r.type}`,r)}}),s}hasResource(e){return this.resourceMap.has(e)}remove(e){return this}dispose(){this.resourceMap.forEach((e,t)=>{e.dispose&&e.dispose()}),this.resourceMap.clear(),this.configMap.clear()}}const wr=function(n){if(this.resourceManager)return console.warn("engine has installed resourceManager plugin."),!1;const e=new wn(n.resources);return this.resourceManager=e,this.loaderManager&&this.loaderManager.addEventListener("loaded",t=>{this.resourceManager.mappingResource(t.resourceMap)}),this.registerResources=t=>{const s=new Map;return Object.keys(t).forEach(i=>{s.set(i,t[i])}),this.resourceManager.mappingResource(s),this},this.addEventListener("dispose",()=>{this.resourceManager.dispose()}),!0},Je=(n,e)=>e===1/0?"Infinity":e===-1/0?"-Infinity":e,In=(n,e)=>e==="Infinity"?1/0:e==="-Infinity"?-1/0:e,ut=n=>JSON.parse(JSON.stringify(n,Je),In);var Ir=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",stringify:Je,parse:In,clone:ut});const X=class extends te{constructor(e){super();d(this,"ignoreAttribute");this.ignoreAttribute=e||{}}static proxyGetter(e,t,s){return Reflect.get(e,t,s)}static proxySetter(e,t,s,i,r,o){if(typeof t=="symbol")return Reflect.set(e,t,s,i);X.cacheArray(s);let c;if(e[t]===void 0){if(typeof s=="object"&&s!==null&&!X.proxyWeakSet.has(s)&&!r.ignoreAttribute[t]){const u=o.concat([t]);s=r.proxyExtends(s,u)}c=Reflect.set(e,t,s),r.broadcast({operate:"add",path:o.concat([]),key:t,value:s})}else{if(typeof s=="object"&&s!==null&&!X.proxyWeakSet.has(s)&&!r.ignoreAttribute[t]){const u=o.concat([t]);s=r.proxyExtends(s,u)}if(c=Reflect.set(e,t,s),Array.isArray(e)&&t==="length"){const u=e[Symbol.for(X.arraySymobl)],h=u.length-e.length;if(h>0){let p=0,f=0;for(const g of u){if(!e.includes(g)&&(r.broadcast({operate:"delete",path:o.concat([]),key:f.toString(),value:g}),p+=1,p===h))break;f+=1}}return e[Symbol.for(this.arraySymobl)]=e.concat([]),c}r.broadcast({operate:"set",path:o.concat([]),key:t,value:s})}return c}static proxyDeleter(e,t,s,i){const r=e[t],o=Reflect.deleteProperty(e,t);return Array.isArray(e)||typeof t=="symbol"||s.broadcast({operate:"delete",path:i.concat([]),key:t,value:r}),o}proxyExtends(e,t=[]){if(X.proxyWeakSet.has(e)||typeof e!="object")return e;const s={get:X.proxyGetter,set:(r,o,c,u)=>X.proxySetter(r,o,c,u,this,t),deleteProperty:(r,o)=>X.proxyDeleter(r,o,this,t)};if(typeof e=="object"&&e!==null)for(const r in e){const o=t.concat([r]);let c=this.ignoreAttribute,u=!1;for(const h of o.slice(1)){if(c[h]===!0){u=!0;break}c[h]&&(c=c[h])}u||Ln(r,e)&&typeof e[r]=="object"&&e[r]!==null&&(X.cacheArray(e[r]),e[r]=this.proxyExtends(e[r],o))}const i=new Proxy(e,s);return X.proxyWeakSet.add(i),i}broadcast({operate:e,path:t,key:s,value:i}){return{__poto__:!0,length:!0}[s]?this:(this.dispatchEvent({type:"broadcast",notice:{operate:e,path:t,key:s,value:i}}),this)}};let He=X;d(He,"proxyWeakSet",new WeakSet),d(He,"arraySymobl","vis.array"),d(He,"cacheArray",function(e){Array.isArray(e)&&!e[Symbol.for(X.arraySymobl)]&&(e[Symbol.for(X.arraySymobl)]=e.concat([]))});class Pn{constructor(){d(this,"rule");d(this,"memberSet");this.rule=function(){},this.memberSet=new Set}apply(e){return this.memberSet.add(e),this}cancel(e){return this.memberSet.delete(e),this}setRule(e){return this.rule=e,this}translate(e){const t=this.rule;return this.memberSet.forEach(s=>{t(e,s)}),this}}class re{constructor(e,t,s){d(this,"data");d(this,"broadcast");d(this,"translater");this.translater=new Pn().setRule(e),this.broadcast=new He(s),this.data=this.broadcast.proxyExtends(t),this.broadcast.addEventListener("broadcast",i=>{this.translater.translate(i.notice)})}getData(){return this.data}setData(e){return this.data=e,this}proxyData(e){return this.data=this.broadcast.proxyExtends(e),this.data}existSymbol(e){return Boolean(this.data[e])}addConfig(e){return this.data[e.vid]=e,this}getConfig(e){return this.data[e]}removeConfig(e){const t=this.data;t[e]!==void 0&&delete t[e]}addCompiler(e){return e.setTarget(this.data),e.compileAll(),this.translater.apply(e),this}toJSON(e=!0){return e?JSON.stringify(this.exportConfig(),Je):JSON.stringify(this.data,Je)}exportConfig(e=!0){if(e){const t=this.data,s={},i={},r=(o,c,u={})=>{for(const h in o){if(["vid","type"].includes(h)){u[h]=o[h];continue}if(typeof o[h]=="object"&&o[h]!==null){if(Array.isArray(o[h])){if(!o[h].length)continue;u[h]=o[h].map(p=>typeof p=="object"&&p!==null?ut(p):p);continue}u[h]={},c[h]?(r(o[h],c[h],u[h]),Object.keys(u[h]).length===0&&delete u[h]):u[h]=ut(o[h])}else c[h]!==o[h]&&(u[h]=o[h])}};for(const o of Object.values(t)){if(!i[o.type]){if(!$[o.type]){console.error(`can not font some config with: ${o.type}`);continue}i[o.type]=$[o.type]()}s[o.vid]={},r(o,i[o.type],s[o.vid])}return s}else return ut(this.data)}load(e){const t=this.data,s={},i=(r,o)=>{for(const c in o)typeof r[c]=="object"&&r[c]!==null&&typeof o[c]=="object"&&o[c]!==null?i(r[c],o[c]):r[c]===void 0&&(r[c]=o[c])};for(const r in e){const o=e[r];if(!s[o.type]){if(!$[o.type]){console.error(`can not font some config with: ${o.type}`);continue}s[o.type]=$[o.type]()}i(o,s[o.type]),t[r]=o}return this}remove(e){const t=this.data;for(const s in e)t[s]!==void 0&&delete t[s];return this}getModule(){return this.MODULE}}const ue=(n,e,t=ee.validate)=>{const{operate:s,key:i,path:r,value:o}=n;let c=i;const u=[].concat(r);if(r.length&&(c=u.shift()),!t(c)){console.warn(`${e.MODULE} Rule: vid is illeage: ${c}`);return}if(s==="add"&&!u.length){e.add(o);return}if(n.operate==="delete"&&!u.length){e.remove(o);return}if(n.operate==="set"&&!u.length&&i===c){e.cover(o);return}e.compile(c,{operate:s,key:i,path:u,value:o})},Pr=function(n,e){ue(n,e)};class vn extends re{constructor(e,t){!e&&(e={});super(Pr,e,t);d(this,"MODULE",a.MODULETYPE.TEXTURE)}}const vr=function(n,e){ue(n,e)};class An extends re{constructor(e,t){!e&&(e={});super(vr,e,t);d(this,"MODULE",a.MODULETYPE.MATERIAL)}}class et extends re{constructor(e,t,s){!t&&(t=Object.create(Object.prototype));super(e,t,s);d(this,"MODULE",a.MODULETYPE.GROUP)}}const Te=function(n,e){n.key!=="parent"&&ue(n,e)},Ar=function(n,e){Te(n,e)};class Nn extends et{constructor(e,t){!e&&(e={});super(Ar,e,t);d(this,"MODULE",a.MODULETYPE.LIGHT)}}const Nr=function(n,e){ue(n,e)};class Gn extends re{constructor(e,t){!e&&(e={});super(Nr,e,t);d(this,"MODULE",a.MODULETYPE.GEOMETRY)}}const Gr=function(n,e){Te(n,e)};class Dn extends et{constructor(e,t){!e&&(e={});super(Gr,e,t);d(this,"MODULE",a.MODULETYPE.CAMERA)}}const Dr=function(n,e){ue(n,e,t=>ee.validate(t)||[a.CONFIGTYPE.WEBGLRENDERER,a.CONFIGTYPE.CSS3DRENDERER].includes(t))};class Un extends re{constructor(e,t){!e&&(e={});super(Dr,e,t);d(this,"MODULE",a.MODULETYPE.RENDERER)}}const Ur=function(n,e){ue(n,e,t=>ee.validate(t)||[a.CONFIGTYPE.SCENE].includes(t))};class xn extends et{constructor(e,t){!e&&(e={});super(Ur,e,t);d(this,"MODULE",a.MODULETYPE.SCENE)}}const xr=function(n,e){ue(n,e,t=>ee.validate(t)||[a.CONFIGTYPE.TRNASFORMCONTROLS,a.CONFIGTYPE.ORBITCONTROLS].includes(t))};class Fn extends re{constructor(e,t){!e&&(e={});super(xr,e,t);d(this,"MODULE",a.MODULETYPE.CONTROLS)}}class dt extends re{constructor(e,t,s){!t&&(t=Object.create(Object.prototype));super(e,t,s);d(this,"MODULE",a.MODULETYPE.MESH)}}const Fr=function(n,e){n.key!=="geometry"&&Te(n,e)};class jn extends dt{constructor(e,t){!e&&(e={});super(Fr,e,t);d(this,"MODULE",a.MODULETYPE.SPRITE)}}const jr=function(n,e){Te(n,e)};class Yn extends dt{constructor(e,t){!e&&(e={});super(jr,e,t);d(this,"MODULE",a.MODULETYPE.LINE)}}const Yr=function(n,e){Te(n,e)};class Hn extends dt{constructor(e,t){!e&&(e={});super(Yr,e,t);d(this,"MODULE",a.MODULETYPE.MESH)}}const Hr=function(n,e){Te(n,e)};class Bn extends dt{constructor(e,t){!e&&(e={});super(Hr,e,t);d(this,"MODULE",a.MODULETYPE.POINTS)}}const Br=function(n,e){Te(n,e)};class _n extends et{constructor(e,t){!e&&(e={});super(Br,e,t);d(this,"MODULE",a.MODULETYPE.GROUP)}}const _r=function(n,e){ue(n,e)};class kn extends re{constructor(e,t){!e&&(e={});super(_r,e,t);d(this,"MODULE",a.MODULETYPE.PASS)}}const kr=function(n,e){n.key==="name"&&n.path.length===1||ue(n,e)};class zn extends re{constructor(e,t){!e&&(e={});super(kr,e,t);d(this,"MODULE",a.MODULETYPE.ANIMATION)}}const zr=function(n,e){Te(n,e)};class Vn extends et{constructor(e,t){!e&&(e={});super(zr,e,t);d(this,"MODULE",a.MODULETYPE.CSS3D)}}class Wn{constructor(e){d(this,"cameraDataSupport",new Dn);d(this,"lightDataSupport",new Nn);d(this,"geometryDataSupport",new Gn);d(this,"textureDataSupport",new vn);d(this,"materialDataSupport",new An);d(this,"rendererDataSupport",new Un);d(this,"sceneDataSupport",new xn);d(this,"controlsDataSupport",new Fn);d(this,"spriteDataSupport",new jn);d(this,"lineDataSupport",new Yn);d(this,"meshDataSupport",new Hn);d(this,"pointsDataSupport",new Bn);d(this,"groupDataSupport",new _n);d(this,"css3DDataSupport",new Vn);d(this,"passDataSupport",new kn);d(this,"animationDataSupport",new zn);d(this,"dataSupportMap");e&&Object.keys(e).forEach(s=>{this[s]!==void 0&&(this[s]=e[s])});const t=new Map;Object.keys(this).forEach(s=>{const i=this[s];i instanceof re&&t.set(i.MODULE,i)}),this.dataSupportMap=t}getDataSupport(e){return this.dataSupportMap.has(e)?this.dataSupportMap.get(e):(console.warn(`can not found this type in dataSupportManager: ${e}`),null)}getSupportData(e){return this.dataSupportMap.has(e)?this.dataSupportMap.get(e).getData():(console.warn(`can not found this type in dataSupportManager: ${e}`),null)}setSupportData(e,t){return this.dataSupportMap.has(e)?this.dataSupportMap.get(e).setData(t):console.warn(`can not found this type in dataSupportManager: ${e}`),this}getConfigBySymbol(e){const t=this.dataSupportMap.values();for(const s of t){const i=s.getConfig(e);if(i)return i}return null}removeConfigBySymbol(...e){const t=this.dataSupportMap.values();for(const s of e)for(const i of t)if(i.existSymbol(s)){i.removeConfig(s);break}return this}getModuleBySymbol(e){const t=this.dataSupportMap.values();for(const s of t)if(s.existSymbol(e))return s.MODULE;return null}applyConfig(...e){for(const t of e){const s=je(t.type);s?this.dataSupportMap.get(s).addConfig(t):console.warn(`dataSupportManager can not found this config module: ${t.type}`)}return this}reactiveConfig(e){const t=je(e.type);return t?this.dataSupportMap.get(t).addConfig(e).getConfig(e.vid):(console.warn(`dataSupportManager can not found this config module: ${e.type}`),e)}load(e){return this.dataSupportMap.forEach((s,i)=>{e[i]&&s.load(e[i])}),this}remove(e){return this.dataSupportMap.forEach((s,i)=>{e[i]&&s.remove(e[i])}),this}toJSON(e={},t=!0){return JSON.stringify(this.exportConfig(e,t),Je)}exportConfig(e={},t=!0){return this.dataSupportMap.forEach((i,r)=>{e[r]=i.exportConfig(t)}),e}}const Vr={name:"uvPulseShader",uniforms:{time:{value:0},width:{value:.5},color:{value:{r:1,g:0,b:0}},center:{value:{x:.5,y:.5}}},vertexShader:`
    varying vec2 vUv;

    void main () {

      vUv = uv;

      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }`,fragmentShader:`
    uniform float width;
    uniform float time;
    uniform vec3 color;
    uniform vec2 center;

    varying vec2 vUv;

    void main () {
      // \u6839\u636EuTime\u6C42\u51FA\u767E\u5206\u6BD4
      float deg = mod(degrees(time), 360.0);
      if (deg > 0.0 && deg < 180.0) {
        discard;
      }

      float percent = cos(time);
      float distancePercent = distance(center, vUv);

      // \u4ECE\u5916\u5411\u91CC
      if (distancePercent > 0.5) {
        discard;
      }

      if (distancePercent < percent) {
        discard;
      }

      if (distancePercent - percent > width) {
        discard;
      }

      float opacity =  (width - (distancePercent - percent)) / width;

      // float opacity = distancePercent;
      gl_FragColor = vec4(color, opacity);
    }`},Wr={name:"fragCoordTestingShader",uniforms:{resolution:{value:{x:1920,y:1080}}},vertexShader:`
  void main () {
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }`,fragmentShader:`
    uniform vec2 resolution;

    void main () {
      vec2 st = gl_FragCoord.xy / resolution;
      gl_FragColor = vec4(st.x,st.y,0.0,1.0);
    }`},$r={name:"colorMixShader",uniforms:{colorA:{value:{r:1,g:0,b:0}},colorB:{value:{r:0,g:1,b:0}},percent:{value:.5}},vertexShader:`
  void main () {
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }`,fragmentShader:`
    uniform vec3 colorA;
    uniform vec3 colorB;
    uniform float percent;

    void main () {
      gl_FragColor = vec4(mix(colorA, colorB, percent), 1.0);
    }`},Kr={name:"BloomShader",uniforms:{brightness:{value:.5},extend:{value:5},range:{value:10},specular:{value:.8},specularRange:{value:2},color:{value:{r:1,g:1,b:1}}},vertexShader:`
  uniform float extend;

  varying vec2 vUv;

  void main () {

    vUv = uv;

    vec3 extendPosition = position + normalize(position) * extend;

    gl_Position = projectionMatrix * modelViewMatrix * vec4(extendPosition , 1.0 );
  }`,fragmentShader:`
    uniform vec3 color;
    uniform float brightness;
    uniform float specular;
    uniform float range;
    uniform float specularRange;

    varying vec2 vUv;
    
    void main () {

      gl_FragColor = vec4(color, brightness);
    }`},pe=class{static getShader(e){return pe.library.has(e)?pe.cloneShader(pe.library.get(e)):(console.warn(`con not found shader in shader library: ${e}`),null)}static generateConfig(e){if(!pe.library.has(e))return console.warn(`con not found shader in shader library: ${e}`),{};const t=pe.library.get(e),s={shader:e,uniforms:{}};return t.uniforms&&(s.uniforms=JSON.parse(JSON.stringify(t.uniforms))),s}static cloneShader(e){const t={name:e.name};return e.vertexShader&&(t.vertexShader=e.vertexShader),e.fragmentShader&&(t.fragmentShader=e.fragmentShader),e.uniforms&&(t.uniforms=JSON.parse(JSON.stringify(e.uniforms))),t}};let Z=pe;d(Z,"library",new Map),d(Z,"reigster",function(e){pe.library.has(e.name)&&console.warn(`shader library has exist shader: ${e.name} that will be cover.`),pe.library.set(e.name,e)});const Xr={name:"defaultShader"};Z.reigster(Xr),Z.reigster(Vr),Z.reigster(Wr),Z.reigster($r),Z.reigster(Kr);const K=function(n,e,t=!0,s=!0){if(!$[n])return console.error(`type: ${n} can not be found in configList.`),{vid:"",type:n};const i=(o,c)=>{for(const u in c){if(o[u]===void 0){!t&&(o[u]=c[u]),t&&s&&console.warn(`'${n}' config can not set key: ${u}`);continue}typeof c[u]=="object"&&c[u]!==null&&!Array.isArray(c[u])?(o[u]===null&&(o[u]=H({},c[u])),i(o[u],c[u])):o[u]=c[u]}},r=$[n]();if([a.CONFIGTYPE.SHADERMATERIAL].includes(n)){const o=Z.generateConfig((e==null?void 0:e.shader)||"defaultShader"),c=t;t=!1,i(r,o),t=c}if([a.CONFIGTYPE.SCRIPTANIMATION,a.CONFIGTYPE.KEYFRAMEANIMATION].includes(n)&&(t=!1),r.vid===""&&(r.vid=ee.v4()),e&&i(r,e),K.autoInject&&K.injectEngine){const o=K.injectEngine,c=o.reactiveConfig(r);if(K.injectScene&&je(r.type)in a.OBJECTMODULE&&r.type!==a.CONFIGTYPE.SCENE){let u=null;typeof K.injectScene=="boolean"?u=o.getObjectConfig(o.scene):typeof K.injectScene=="string"&&(u=o.getConfigBySymbol(K.injectScene)),u?u.children.push(r.vid):console.warn("current engine scene can not found it config",o,o.scene)}return c}return r};K.autoInject=!0,K.injectScene=!1,K.injectEngine=null;const Qr=function(n){if(this.dataSupportManager)return console.warn("engine has installed dataSupportManager plugin."),!1;const e=new Wn(n);return this.dataSupportManager=e,this.applyConfig=function(...t){return this.dataSupportManager.applyConfig(...t),this},this.reactiveConfig=function(t){return this.dataSupportManager.reactiveConfig(t)},this.getConfigBySymbol=function(t){return this.dataSupportManager.getConfigBySymbol(t)},this.removeConfigBySymbol=function(...t){return this.dataSupportManager.removeConfigBySymbol(...t),this},this.toJSON=function(){if(this.loaderManager){const t={assets:JSON.parse(this.loaderManager.toJSON())};return this.dataSupportManager.toJSON(t)}return this.dataSupportManager.toJSON()},this.exportConfig=function(){let t={};return this.loaderManager&&(t={assets:this.loaderManager.exportConfig()}),this.dataSupportManager.exportConfig(t)},this.completeSet.add(()=>{const t=this.dataSupportManager.getDataSupport(a.MODULETYPE.RENDERER).getData();t.WebGLRenderer||(t.WebGLRenderer=K(a.CONFIGTYPE.WEBGLRENDERER));const s=this.dataSupportManager.getDataSupport(a.MODULETYPE.CONTROLS).getData();this.transformControls&&(s[a.CONFIGTYPE.TRNASFORMCONTROLS]||(s[a.CONFIGTYPE.TRNASFORMCONTROLS]=K(a.CONFIGTYPE.TRNASFORMCONTROLS))),this.orbitControls&&(s[a.CONFIGTYPE.ORBITCONTROLS]||(s[a.CONFIGTYPE.ORBITCONTROLS]=K(a.CONFIGTYPE.ORBITCONTROLS)))}),!0},se=class{constructor(){d(this,"target",{});d(this,"map",new Map);d(this,"weakMap",new WeakMap);d(this,"engine");d(this,"cacheCompile")}getMap(){return this.map}useEngine(e){return this.engine=e,this}setTarget(e){return this.target=e,this}add(e){if(!se.processors.has(e.type))return console.warn(`${this.MODULE} compiler can not support this type: ${e.type}`),null;const s=se.processors.get(e.type).create(e,this.engine);return this.map.set(e.vid,s),this.weakMap.set(s,e.vid),s}remove(e){const t=e.vid;if(!this.map.has(t))return console.warn(`${this.MODULE} compiler can not found this vid object: ${t}.`),this;if(!se.processors.has(e.type))return console.warn(`${this.MODULE} compiler can not support this type: ${e.type}`),this;const s=this.map.get(t);return se.processors.get(e.type).dispose(s),this.map.delete(t),this.weakMap.delete(s),this}cover(e){const t=e.vid;return this.map.has(t)?(Promise.resolve().then(()=>{_(e,e,{vid:!0,type:!0})}),this):(console.warn(`${this.MODULE} compiler can not found this vid object: ${t}.`),this)}compile(e,t){const s=this.cacheCompile;let i,r,o;if(s&&s.vid===e)i=s.target,r=s.config,o=s.processor;else{if(!this.map.has(e))return console.warn(`${this.MODULE} compiler set function: can not found object which vid is: '${e}'`),this;if(!this.target[e])return console.warn(`${this.MODULE} compiler set function: can not found config which vid is: '${e}'`),this;if(i=this.map.get(e),r=this.target[e],!se.processors.has(r.type))return console.warn(`PassCompiler can not support this type: ${r.type}`),this;o=se.processors.get(r.type),this.cacheCompile={target:i,config:r,processor:o,vid:e}}return o.process(H({config:r,target:i,engine:this.engine,processor:o,compiler:this},t)),this}compileAll(){const e=this.target;for(const t of Object.values(e))this.add(t);return this}dispose(){this.cacheCompile&&(this.cacheCompile=void 0);for(const e of Object.values(this.target)){if(!this.map.has(e.vid)){console.warn(`${this.MODULE} compiler set function: can not found object which vid is: '${e.vid}'`);continue}const t=this.map.get(e.vid);if(!se.processors.has(e.type)){console.warn(`${this.MODULE}  can not support this type: ${e.type}`);continue}se.processors.get(e.type).dispose(t)}return this.map.clear(),this.target={},this}getObjectSymbol(e){return this.weakMap.get(e)||null}getObjectBySymbol(e){return this.map.get(e)||null}};let b=se;d(b,"processors",new Map),d(b,"processor",function(e){se.processors.set(e.configType,e)});const Be="vis.scriptAni";class qr{constructor(e){d(this,"configType");d(this,"commands");d(this,"create");d(this,"dispose");this.configType=e.configType,this.commands=e.commands,this.create=e.create,this.dispose=e.dispose}process(e){if(!this.commands||!this.commands[e.operate]){this[e.operate](e);return}let t=this.commands[e.operate];for(const s of[].concat(e.path,e.key))if(!t[s]&&!t.$reg){this[e.operate](e);return}else if(t[s])if(typeof t[s]=="function"){t[s](e);return}else t=t[s];else if(t.$reg){for(const i of t.$reg)if(i.reg.test(s)){i.handler(e);return}}this[e.operate](e)}add(e){let t=e.target;const s=e.path;for(const i of s)if(typeof t[i]!==void 0)t=t[i];else{console.warn("processor can not exec default add operate.",e);return}t[e.key]=e.value}set(e){let t=e.target;const s=e.path;for(const i of s)if(typeof t[i]!==void 0)t=t[i];else{console.warn("processor can not exec default set operate.",e);return}t[e.key]=e.value}delete(e){let t=e.target;const s=e.path;for(const i of s)if(typeof t[i]!==void 0)t=t[i];else{console.warn("processor can not exec default delete operate.",e);return}delete t[e.key]}}const v=n=>new qr(n),ht=function(){},Zr={name:"linearTime",multiply:1},Jr=function(n,e,t,s){return e[t]===void 0?(console.warn(`object not exist attribute: ${t}`,e),i=>{}):typeof e[t]!="number"?(console.warn("object attribute is not typeof number.",e,t),i=>{}):i=>{e[t]+=i.delta*s.multiply}},eo={name:"sinWave",wavelength:1,offset:0,amplitude:1,speed:1},to=function(n,e,t,s){if(e[t]===void 0)return console.warn(`object not exist attribute: ${t}`,e),r=>{};if(typeof e[t]!="number")return console.warn("object attribute is not typeof number.",e,t),r=>{};const i=e[t];return r=>{e[t]=i+s.amplitude*Math.sin(r.total*s.speed/s.wavelength)+s.offset}},oe=class{static generateConfig(e,t){if(!oe.configLibrary.has(e))return console.warn(`event library can not found config by name: ${e}`),{name:""};const s=(r,o)=>{for(const c in o)r[c]!==void 0&&(typeof o[c]=="object"&&o[c]!==null&&!Array.isArray(o[c])?s(r[c],o[c]):r[c]=o[c])},i=JSON.parse(JSON.stringify(oe.configLibrary.get(e)));return s(i,t),i}static generateScript(e,t,s,i){return oe.generatorLibrary.has(i.name)?oe.generatorLibrary.get(i.name)(e,t,s,i):(console.error(`event library can not found generator by name: ${i.name}`),()=>{})}static has(e){return oe.configLibrary.has(e)}};let ye=oe;d(ye,"configLibrary",new Map),d(ye,"generatorLibrary",new Map),d(ye,"register",function(e,t){oe.configLibrary.has(e.name)&&console.warn(`EventLibrary has already exist this event generator: ${e.name}, that will be cover.`),oe.configLibrary.set(e.name,JSON.parse(JSON.stringify(e))),oe.generatorLibrary.set(e.name,t)}),ye.register(Zr,Jr),ye.register(eo,to);const $n=function(n,e){let t=e.compilerManager.getObjectBySymbol(n.target);t||console.error(`can not found object in enigne: ${n.target}`);const s=n.attribute.split(".");s.shift();const i=s.pop();for(const r of s){if(t[r]===void 0)return console.error(`animaton processor: target object can not found key: ${r}`,t),()=>{};t=t[r]}return ye.generateScript(e,t,i,n.script)};var no=v({configType:a.CONFIGTYPE.SCRIPTANIMATION,commands:{set:{play({target:n,engine:e,value:t}){t?e.renderManager.addEventListener("render",n):e.renderManager.removeEventListener("render",n)},$reg:[{reg:new RegExp(".*"),handler({config:n,engine:e}){const t=n[Symbol.for(Be)];e.renderManager.removeEventListener("render",t);const s=$n(n,e);n[Symbol.for(Be)]=s,n.play&&e.renderManager.addEventListener("render",t)}}]}},create(n,e){const t=$n(n,e);return n.play&&e.renderManager.addEventListener("render",t),n[Symbol.for(Be)]=t,t},dispose(){}});class so extends b{constructor(){super();d(this,"MODULE",a.MODULETYPE.ANIMATION)}cover(e){super.cover(e);const t=this.map.get(e.vid);return e[Symbol.for(Be)]=t,this}remove(e){return delete e[Symbol.for(Be)],super.remove(e),this}compile(e,t){super.compile(e,t);const s=this.target[e],i=this.map.get(s.vid);return s[Symbol.for(Be)]=i,this}}b.processor(no);class Ae extends b{constructor(){super()}}const io={name:"openWindow",params:{url:""}},ro=function(n,e){return()=>{window.open(e.params.url)}},oo={name:"visibleObject",params:{target:"",visible:!0,delay:0}},ao=function(n,e){const t=e.params,s=n.getObjectBySymbol(t.target);return s?()=>{setTimeout(()=>{s.visible=t.visible},t.delay)}:(console.warn(`basic event visibleObject: can not found vid object: ${t.target}`),()=>{})},co={name:"addClass",params:{target:"",className:"",delay:0}},lo=function(n,e){const t=e.params,s=[];if(t.target==="all")n.scene.traverse(i=>{i instanceof we.CSS3DObject&&s.push(i)});else if(Array.isArray(t.target))t.target.forEach(i=>{const r=n.getObjectBySymbol(i);r?s.push(r):console.warn(`basic event AddClass: can not found vid object: ${t.target}`)});else{const i=n.getObjectBySymbol(t.target);if(!i)return console.warn(`basic event AddClass: can not found vid object: ${t.target}`),()=>{};if(!(i instanceof we.CSS3DObject))return console.warn("basic event AddClass: object is not a CSS3DObject."),()=>{};s.push(i)}return s.length?()=>{setTimeout(()=>{s.forEach(i=>{i.element.classList.add(t.className)})},t.delay)}:(console.warn(`basic event AddClass: can not found vid object: ${t.target}`),()=>{})},uo={name:"changeScene",params:{scene:"Scene",delay:0}},ho=function(n,e){const t=e.params;return()=>{setTimeout(()=>{n.setScene(t.scene)},t.delay)}},po={name:"changeCamera",params:{camera:"",delay:0}},fo=function(n,e){const t=e.params;return()=>{setTimeout(()=>{n.setCamera(t.camera)},t.delay)}},mo={name:"switchAnimate",params:{target:"",toggle:"auto",delay:0}},go=function(n,e){const t=e.params,s=n.getConfigBySymbol(t.target);return s?()=>{setTimeout(()=>{if(t.toggle==="auto"){s.play!=s.play;return}if(t.toggle==="off"){s.play=!1;return}if(t.toggle==="on"){s.play=!0;return}},t.delay)}:(console.warn(`basic event switchAnimate: can not found vid config: ${t.target}`),()=>{})};a.TIMINGFUNCTION=void 0,function(n){n.ELN="ELN",n.EQI="EQI",n.EQO="EQO",n.EASING_LINEAR_NONE="EASING_LINEAR_NONE",n.EASING_QUARTIC_IN="EASING_QUARTIC_IN",n.EASING_QUARTIC_OUT="EASING_QUARTIC_OUT",n.EASING_QUARTIC_INOUT="EASING_QUARTIC_INOUT",n.EASING_QUADRATIC_IN="EASING_QUADRATIC_IN",n.EASING_QUADRATIC_OUT="EASING_QUADRATIC_OUT",n.EASING_QUADRATIC_INOUT="EASING_QUADRATIC_INOUT"}(a.TIMINGFUNCTION||(a.TIMINGFUNCTION={}));const F={ELN:N.Easing.Linear.None,EQI:N.Easing.Quartic.In,EQO:N.Easing.Quartic.Out,EASING_LINEAR_NONE:N.Easing.Linear.None,EASING_QUARTIC_IN:N.Easing.Quartic.In,EASING_QUARTIC_OUT:N.Easing.Quartic.Out,EASING_QUARTIC_INOUT:N.Easing.Quartic.InOut,EASING_QUADRATIC_IN:N.Easing.Quadratic.In,EASING_QUADRATIC_OUT:N.Easing.Quadratic.Out,EASING_QUADRATIC_INOUT:N.Easing.Quadratic.InOut},Eo={name:"moveTo",params:{target:"",position:{x:0,y:0,z:0},delay:0,duration:1e3,timingFunction:a.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},To=function(n,e){const t=e.params,i=n.compilerManager.getObjectBySymbol(t.target);if(!i)return console.warn(`real time animation moveTO: can not found vid object: ${t.target}`),()=>{};const r=n.renderManager,o=n.dataSupportManager.getConfigBySymbol(t.target);if(!o)return console.warn(`can not found object config: ${t.target}`),()=>{};let c=!1;return()=>{if(c)return;c=!0;const u=new N.Tween(i.position).to(t.position).duration(t.duration).delay(t.delay).easing(F[t.timingFunction]).start(),h=p=>{u.update()};r.addEventListener("render",h),u.onComplete(()=>{r.removeEventListener("render",h),o.position.x=t.position.x,o.position.y=t.position.y,o.position.z=t.position.z,c=!1})}},yo={name:"rotationTo",params:{target:"",rotation:{x:0,y:0,z:0},delay:0,duration:1e3,timingFunction:a.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},Mo=function(n,e){const t=e.params,i=n.compilerManager.getObjectBySymbol(t.target);if(!i)return console.warn(`real time animation moveTO: can not found vid object: ${t.target}`),()=>{};const r=n.renderManager,o=n.dataSupportManager.getConfigBySymbol(t.target);if(!o)return console.warn(`can not found object config: ${t.target}`),()=>{};let c=!1;return()=>{if(c)return;c=!0;const u=new N.Tween(i.rotation).to(t.rotation).duration(t.duration).delay(t.delay).easing(F[t.timingFunction]).start(),h=p=>{u.update()};r.addEventListener("render",h),u.onComplete(()=>{r.removeEventListener("render",h),o.rotation.x=t.rotation.x,o.rotation.y=t.rotation.y,o.rotation.z=t.rotation.z,c=!1})}},So={name:"upTo",params:{target:"",up:{x:0,y:1,z:0},delay:0,duration:1e3,timingFunction:a.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},Oo=function(n,e){const t=e.params,i=n.compilerManager.getObjectBySymbol(t.target);if(!i)return console.warn(`real time animation upTo: can not found vid object: ${t.target}`),()=>{};const r=n.renderManager,o=n.dataSupportManager.getConfigBySymbol(t.target);if(!o)return console.warn(`can not found object config: ${t.target}`),()=>{};let c=!1;return()=>{if(c)return;c=!0;const u=new N.Tween(i.up).to(t.up).duration(t.duration).delay(t.delay).easing(F[t.timingFunction]).start(),h=p=>{u.update()};r.addEventListener("render",h),u.onComplete(()=>{r.removeEventListener("render",h),o.up.x=t.up.x,o.up.y=t.up.y,o.up.z=t.up.z,c=!1})}},Co={name:"moveFromTo",params:{target:"",from:{x:0,y:0,z:0},to:{x:10,y:10,z:10},delay:0,duration:1e3,timingFunction:a.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},bo=function(n,e){const t=e.params,i=n.compilerManager.getObjectBySymbol(t.target);if(!i)return console.warn(`real time animation moveTO: can not found vid object: ${t.target}`),()=>{};const r=n.renderManager,o=n.dataSupportManager.getConfigBySymbol(t.target);if(!o)return console.warn(`can not found object config: ${t.target}`),()=>{};let c=!1;return()=>{if(c)return;c=!0,i.position.set(t.from.x,t.from.y,t.from.z),i.updateMatrix(),i.updateMatrixWorld();const u=new N.Tween(i.position).to(t.to).duration(t.duration).delay(t.delay).easing(F[t.timingFunction]).start(),h=p=>{u.update()};r.addEventListener("render",h),u.onComplete(()=>{r.removeEventListener("render",h),o.position.x=t.to.x,o.position.y=t.to.y,o.position.z=t.to.z,c=!1})}},Ro={name:"moveSpacing",params:{target:"",spacing:{x:10,y:10,z:10},delay:0,duration:1e3,timingFunction:a.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},Lo=function(n,e){const t=e.params,s=n.getObjectBySymbol(t.target);if(!s)return console.warn(`can not found vid object: ${t.target}`),()=>{};if(!(s instanceof l.Object3D))return console.warn(`object is not instanceof Object3D: ${t.target}`),()=>{};const i=n.renderManager,r=n.getConfigBySymbol(t.target);let o=!1;return()=>{if(o)return;o=!0;const c={x:s.position.x+t.spacing.x,y:s.position.y+t.spacing.y,z:s.position.z+t.spacing.z},u=new N.Tween(s.position).to(c).duration(t.duration).delay(t.delay).easing(F[t.timingFunction]).start(),h=p=>{u.update()};i.addEventListener("render",h),u.onComplete(()=>{i.removeEventListener("render",h),r.position.x=c.x,r.position.y=c.y,r.position.z=c.z,o=!1})}},wo={name:"moveToObject",params:{target:"",to:"",offset:{x:0,y:0,z:0},delay:0,duration:1e3,timingFunction:a.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},Io=function(n,e){const t=e.params,s=n.compilerManager,i=s.getObjectBySymbol(t.target),r=s.getObjectBySymbol(t.to);if(!i)return console.warn(`real time animation MoveToObject: can not found vid object: ${t.target}`),()=>{};if(!r)return console.warn(`real time animation MoveToObject: can not found vid object: ${t.target}`),()=>{};const o=n.renderManager,c=n.dataSupportManager.getConfigBySymbol(t.target);if(!c)return console.warn(`can not found object config: ${t.target}`),()=>{};let u=!1;return()=>{if(u)return;u=!0;const h={x:r.position.x+t.offset.x,y:r.position.y+t.offset.y,z:r.position.z+t.offset.z},p=new N.Tween(i.position).to(h).duration(t.duration).delay(t.delay).easing(F[t.timingFunction]).start(),f=g=>{p.update()};o.addEventListener("render",f),p.onComplete(()=>{o.removeEventListener("render",f),c.position.x=h.x,c.position.y=h.y,c.position.z=h.z,u=!1})}},Po={name:"vector3To",params:{target:"",attribute:".position",props:{x:"x",y:"y",z:"z"},delay:0,duration:500,to:{},timingFunction:a.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},vo=function(n,e){var f,g,E;const t=e.params,s=n.compilerManager.getObjectBySymbol(t.target);if(!s)return console.warn(`real time animation vector3To: can not found vid object: ${t.target}`),()=>{};const i=n.renderManager;let r=n.dataSupportManager.getConfigBySymbol(t.target);if(!r)return console.warn(`real time animation vector3To: can not found object config: ${t.target}`),()=>{};const o=t.attribute.split(".");o.shift();let c=s;for(const S of o){if(c[S]===void 0)return console.error(`real time animation vector3To: object can not support key: ${S}`,s),()=>{};c=c[S],r=r[S]}const u=t.props;if(!(u.x in c)||!(u.y in c)||!(u.z in c))return console.error("real time animation vector3To: object can not support props:",c,u),()=>{};if(!(u.x in r)||!(u.y in r)||!(u.z in r))return console.error("real time animation vector3To: config can not support props:",r,u),()=>{};const h={x:(f=t.to.x)!=null?f:c[u.x],y:(g=t.to.y)!=null?g:c[u.y],z:(E=t.to.z)!=null?E:c[u.z]};let p=!1;return()=>{if(p)return;p=!0;const S=new N.Tween(c).to(h).duration(t.duration).delay(t.delay).easing(F[t.timingFunction]).start(),O=y=>{S.update()};i.addEventListener("render",O),S.onComplete(()=>{i.removeEventListener("render",O),r[u.x]=h.x,r[u.y]=h.y,r[u.z]=h.z,p=!1})}},Ao={name:"focusObject",params:{target:"",camera:"",space:"world",offset:{x:0,y:0,z:20},delay:0,duration:1e3,timingFunction:a.TIMINGFUNCTION.EASING_QUADRATIC_INOUT,back:!0}},No=function(n,e){const t=e.params,s=n.getObjectBySymbol(t.target),i=n.orbitControls.target;if(!s)return console.warn(`real time animation focusObject: can not found vid object: ${t.target}`),()=>{};if(!(s instanceof l.Object3D))return console.warn(`real time animation focusObject: vid object is not a class of THREE.Object3D: ${t.target}`),()=>{};let r=!1;const o=new l.Euler;return()=>{if(r)return;r=!0;let c=n.camera;t.camera&&(c=n.getObjectBySymbol(t.camera),c||(c=n.camera,console.warn(`real time animation focusObject: can not found camera config: ${t.camera}`)));const u=n.getObjectConfig(c),h=n.orbitControls&&n.orbitControls.object===c;u||console.warn("engine current camera can not found config.");const p=n.renderManager;let f={x:s.matrixWorld.elements[12]+t.offset.x,y:s.matrixWorld.elements[13]+t.offset.y,z:s.matrixWorld.elements[14]+t.offset.z};const g={x:c.position.x,y:c.position.y,z:c.position.z};if(t.space==="local"){const C=new l.Vector3(t.offset.x,t.offset.y,t.offset.z).applyEuler(o.setFromRotationMatrix(s.matrixWorld));f={x:s.matrixWorld.elements[12]+C.x,y:s.matrixWorld.elements[13]+C.y,z:s.matrixWorld.elements[14]+C.z}}const E=new N.Tween(c.position).to(f).duration(t.duration).delay(t.delay).easing(F[t.timingFunction]).start();let S;const O={x:c.up.x,y:c.up.y,z:c.up.z};if(t.space==="local"){const C=new l.Vector3(0,1,0).applyEuler(o.setFromRotationMatrix(s.matrixWorld));S=new N.Tween(c.up).to({x:C.x,y:C.y,z:C.z}).duration(t.duration).delay(t.delay).easing(F[t.timingFunction]).start()}let y;const T={x:i.x,y:i.y,z:i.z};h&&(y=new N.Tween(i).to({x:s.matrixWorld.elements[12],y:s.matrixWorld.elements[13],z:s.matrixWorld.elements[14]}).duration(t.duration).delay(t.delay).easing(F[t.timingFunction]).start());let L;h&&t.space==="local"?L=C=>{E.update(),S.update(),y.update()}:h?L=C=>{E.update(),y.update()}:t.space==="local"?L=C=>{E.update(),S.update()}:L=C=>{E.update()},p.addEventListener("render",L),E.onComplete(()=>{if(p.removeEventListener("render",L),u&&(u.position.x=f.x,u.position.y=f.y,u.position.z=f.z),r=!1,t.back){const C=()=>{const w=new N.Tween(c.position).to(g).duration(t.duration).delay(t.delay).easing(F[t.timingFunction]).start();let x;t.space==="local"&&(x=new N.Tween(c.up).to(O).duration(t.duration).delay(t.delay).easing(F[t.timingFunction]).start());let M;h&&(M=new N.Tween(i).to(T).duration(t.duration).delay(t.delay).easing(F[t.timingFunction]).start());const G=P=>{w.update(),x&&x.update(),M&&M.update()};w.onComplete(()=>{p.removeEventListener("render",G)}),p.addEventListener("render",G),document.removeEventListener("dblclick",C)};document.addEventListener("dblclick",C)}})}},Go={name:"fadeObject",params:{target:"",direction:"out",delay:0,duration:300,timingFunction:a.TIMINGFUNCTION.EASING_QUADRATIC_INOUT,visible:!0}},Do=function(n,e){const t=e.params,s=n.getObjectBySymbol(t.target);if(!s)return console.warn(`real time animation fadeObject: can not found vid object: ${t.target}`),()=>{};const i=n.getObjectConfig(s);if(!i.material)return console.warn(`real time animation fadeObject: target can not support fade: ${t.target}`),()=>{};const r=[],o=[],c=Array.isArray(i.material)?[].concat(i.material):[i.material];for(const h of c){const p=n.getObjectBySymbol(h),f=n.getConfigBySymbol(h);if(!(p instanceof l.Material)){console.error(`real time animation fadeObject: object config material is not instanceof Material: ${h}`);continue}if(!f){console.error(`real time animation fadeObject: object config material can not found config: ${h}`);continue}r.push(p),o.push(f)}let u=!1;return()=>{if(u)return;u=!0;const h=n.renderManager;i.visible=!0,r.forEach((p,f,g)=>{p.visible=!0,p.transparent=!0,p.opacity=t.direction==="in"?0:1,p.needsUpdate=!0;const E=new N.Tween(p).to({opacity:t.direction==="in"?1:0}).duration(t.duration).delay(t.delay).easing(F[t.timingFunction]).start(),S=O=>{E.update()};h.addEventListener("render",S),E.onComplete(()=>{h.removeEventListener("render",S),t.direction==="out"&&t.visible?(o[f].visible=!1,i.visible=!1):t.direction==="in"&&t.visible&&(o[f].visible=!0,i.visible=!0),o[f].opacity=t.direction==="in"?1:0,u=!1})})}},Uo={name:"showToCamera",params:{target:"",offset:{x:0,y:0,z:-30},delay:0,duration:1e3,timingFunction:a.TIMINGFUNCTION.EASING_QUADRATIC_INOUT,back:!0}},xo=function(n,e){const t=e.params,s=n.getObjectBySymbol(t.target),i=n.getConfigBySymbol(t.target),r=n.camera;if(!s)return console.warn(`real time animation showToCamera: can not found vid object: ${t.target}`),()=>{};if(!s)return console.warn(`real time animation showToCamera: can not found vid config: ${t.target}`),()=>{};if(!(s instanceof l.Object3D))return console.warn(`real time animation showToCamera: vid object is not a class of THREE.Object3D: ${t.target}`),()=>{};const o=new l.Matrix4,c=new l.Euler,u=new l.Vector3;let h=!1;return()=>{if(h)return;h=!0;const p=n.renderManager;u.set(t.offset.x,t.offset.y,t.offset.z).applyEuler(r.rotation),u.set(r.position.x+u.x,r.position.y+u.y,r.position.z+u.z),o.lookAt(r.position,u,r.up),c.setFromRotationMatrix(o);const f={x:s.position.x,y:s.position.y,z:s.position.z},g={x:s.rotation.x,y:s.rotation.y,z:s.rotation.z},E=new N.Tween(s.position).to({x:u.x,y:u.y,z:u.z}).duration(t.duration).delay(t.delay).easing(F[t.timingFunction]).start(),S=new N.Tween(s.rotation).to({x:c.x,y:c.y,z:c.z}).duration(t.duration).delay(t.delay).easing(F[t.timingFunction]).start(),O=y=>{E.update(),S.update()};p.addEventListener("render",O),E.onComplete(()=>{if(p.removeEventListener("render",O),i.position.x=u.x,i.position.y=u.y,i.position.z=u.z,i.rotation.x=c.x,i.rotation.y=c.y,i.rotation.z=c.z,h=!1,t.back){const y=()=>{const T=new N.Tween(s.position).to(f).duration(t.duration).delay(t.delay).easing(F[t.timingFunction]).start(),L=new N.Tween(s.rotation).to(g).duration(t.duration).delay(t.delay).easing(F[t.timingFunction]).start(),C=w=>{T.update(),L.update()};T.onComplete(()=>{p.removeEventListener("render",C),i.position.x=f.x,i.position.y=f.y,i.position.z=f.z,i.rotation.x=g.x,i.rotation.y=g.y,i.rotation.z=g.z}),p.addEventListener("render",C),document.removeEventListener("dblclick",y)};document.addEventListener("dblclick",y)}})}},Fo={name:"colorChange",params:{target:"",attribute:"color",color:"rgb(255, 255, 255)",delay:0,duration:500,timingFunction:a.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},jo=function(n,e){const t=e.params,s=n.getObjectBySymbol(t.target);if(!s)return console.warn(`real time animation ColorChange: can not found vid material: ${t.target}`),()=>{};if(!s[t.attribute]||!(s[t.attribute]instanceof l.Color))return console.warn(`real time animation ColorChange: material attribute is illeage: ${t.attribute}`),()=>{};const i=n.getConfigBySymbol(t.target);if(!i)return console.warn(`real time animation ColorChange: can not found material config: ${t.target}`),()=>{};const r=new l.Color(t.color),o=n.renderManager;let c=!1;return()=>{if(c)return;c=!0;const u=new N.Tween(s[t.attribute]).to({r:r.r,g:r.g,b:r.b}).duration(t.duration).delay(t.delay).easing(F[t.timingFunction]).start(),h=p=>{u.update()};o.addEventListener("render",h),u.onComplete(()=>{o.removeEventListener("render",h),i[t.attribute]=t.color,c=!1})}},Yo={name:"orbitTargetMove",params:{target:"",offset:{x:0,y:0,z:0},delay:0,duration:1e3,timingFunction:a.TIMINGFUNCTION.EASING_QUADRATIC_INOUT}},Ho=function(n,e){const t=e.params;if(n.compilerManager,!n.orbitControls)return console.warn("real time animation orbitTargetMove: engine can not install orbitControls."),()=>{};const s=n.renderManager;let i=!1;return()=>{if(i)return;i=!0;let r=t.offset;if(t.target){const u=n.getObjectBySymbol(t.target);u?r={x:u.matrixWorld.elements[12]+r.x,y:u.matrixWorld.elements[13]+r.y,z:u.matrixWorld.elements[14]+r.z}:console.warn(`real time animation orbitTargetMove: can not found vid object: ${t.target}`)}const o=new N.Tween(n.orbitControls.target).to(r).duration(t.duration).delay(t.delay).easing(F[t.timingFunction]).start(),c=u=>{o.update()};s.addEventListener("render",c),o.onComplete(()=>{s.removeEventListener("render",c),i=!1})}},ae=class{static generateConfig(e,t){if(!ae.configLibrary.has(e))return console.warn(`event library can not found config by name: ${e}`),{name:""};const s=(r,o)=>{for(const c in o)typeof o[c]=="object"&&o[c]!==null&&!Array.isArray(o[c])?s(r[c],o[c]):r[c]=o[c]},i=JSON.parse(JSON.stringify(ae.configLibrary.get(e)));return s(i,t),i}static generateEvent(e,t){return ae.generatorLibrary.has(e.name)?ae.generatorLibrary.get(e.name)(t,e):(console.error(`event library can not found generator by name: ${e.name}`),()=>{})}static has(e){return ae.configLibrary.has(e)}};let U=ae;d(U,"configLibrary",new Map),d(U,"generatorLibrary",new Map),d(U,"register",function(e,t){ae.configLibrary.has(e.name)&&console.warn(`EventLibrary has already exist this event generator: ${e.name}, that will be cover.`),ae.configLibrary.set(e.name,JSON.parse(JSON.stringify(e))),ae.generatorLibrary.set(e.name,t)}),U.register(io,ro),U.register(oo,ao),U.register(co,lo),U.register(uo,ho),U.register(po,fo),U.register(mo,go),U.register(Eo,To),U.register(yo,Mo),U.register(So,Oo),U.register(Co,bo),U.register(Ro,Lo),U.register(wo,Io),U.register(Po,vo),U.register(Ao,No),U.register(Go,Do),U.register(Uo,xo),U.register(Fo,jo),U.register(Yo,Ho);const Kn=new WeakMap,Xn=function({target:n,config:e,value:t,engine:s}){if(e.vid===t){console.warn("can not set object lookAt itself.");return}let i=Kn.get(n);if(i||(i={lookAtTarget:null,updateMatrixWorldFun:null},Kn.set(n,i)),!t){if(!i.updateMatrixWorldFun)return;n.updateMatrixWorld=i.updateMatrixWorldFun,i.lookAtTarget=null,i.updateMatrixWorldFun=null;return}const r=s.compilerManager.getObject3D(t);if(!r){console.warn(`lookAt handler can not found this vid mapping object: '${t}'`);return}const o=n.updateMatrixWorld;i.updateMatrixWorldFun=o,i.lookAtTarget=r.position,n.updateMatrixWorld=c=>{o.call(n,c),n.lookAt(i.lookAtTarget)}},tt="vis.event",de=function({target:n,path:e,value:t,engine:s}){const i=e[0];if(!U.has(t.name)){console.warn(`EventLibrary: can not support this event: ${t.name}`);return}const r=U.generateEvent(t,s),o=Symbol.for(tt);t[o]=r,n.addEventListener(i,r)},Me=function({target:n,path:e,value:t}){const s=e[0],i=t[Symbol.for(tt)];if(!i){console.warn("event remove can not fun found event in config",t);return}n.removeEventListener(s,i),delete t[Symbol.for(tt)]},Se=function({target:n,config:e,path:t,engine:s}){const i=t[0],r=e[t[0]][t[1]],o=r[Symbol.for(tt)];if(!o){console.warn("event remove can not fun found event in config",r);return}n.removeEventListener(i,o);const c=U.generateEvent(r,s);r[Symbol.for(tt)]=c,n.addEventListener(i,c)},Yt=function({target:n,config:e,value:t,engine:s}){const i=s.getConfigBySymbol(t);if(!i){console.warn(` can not foud object config in engine: ${t}`);return}if(i.parent&&i.parent!==e.vid){const o=s.getConfigBySymbol(i.parent);if(!o){console.warn(` can not foud object parent config in engine: ${i.parent}`);return}o.children.splice(o.children.indexOf(t),1)}i.parent=e.vid;const r=s.compilerManager.getObject3D(t);if(!r){console.warn(`can not found this vid in engine: ${t}.`);return}n.add(r)},Bo=function({target:n,config:e,value:t,engine:s}){const i=s.compilerManager.getObject3D(t);if(!i){console.warn(`can not found this vid in engine: ${t}.`);return}n.remove(i);const r=s.getConfigBySymbol(t);if(!r){console.warn(`can not found this vid in engine: ${t}.`);return}r.parent=""},Oe=function(n,e,t,s){return Promise.resolve().then(()=>{!t.lookAt&&Xn({target:n,config:e,engine:s,value:e.lookAt}),e.children.forEach(r=>{Yt({target:n,config:e,value:r,engine:s})});for(const r of Object.values(a.EVENTNAME))e[r].forEach((o,c)=>{de({target:n,path:[r,c.toString()],value:o,engine:s})})}),_(e,n,H({vid:!0,type:!0,lookAt:!0,parent:!0,children:!0,pointerdown:!0,pointermove:!0,pointerup:!0,pointerenter:!0,pointerleave:!0,click:!0,dblclick:!0,contextmenu:!0},t)),n},ne=function(n){n._listener={}},j={add:{pointerdown:de,pointerup:de,pointermove:de,pointerenter:de,pointerleave:de,click:de,dblclick:de,contextmenu:de,children:Yt},set:{lookAt:Xn,pointerdown:Se,pointerup:Se,pointermove:Se,pointerenter:Se,pointerleave:Se,click:Se,dblclick:Se,contextmenu:Se,parent:ht,children:{$reg:[{reg:new RegExp(".*"),handler:Yt}]}},delete:{pointerdown:Me,pointerup:Me,pointermove:Me,pointerenter:Me,pointerleave:Me,click:Me,dblclick:Me,contextmenu:Me,children:Bo}},J=new WeakMap;var _o=v({configType:a.CONFIGTYPE.PERSPECTIVECAMERA,commands:{add:H({scale(){}},j.add),set:it(H({scale(){},adaptiveWindow({target:n,value:e,engine:t}){if(e){if(!J.has(e)){const s=i=>{n.aspect=i.width/i.height,n.updateProjectionMatrix()};J.set(n,s),t.addEventListener("setSize",s),s({type:"setSize",width:t.dom.offsetWidth,height:t.dom.offsetHeight})}}else{const s=J.get(n);s&&(t.removeEventListener("setSize",s),J.delete(n))}}},j.set),{$reg:[{reg:new RegExp("fov|aspect|near|far"),handler({target:n,key:e,value:t}){n[e]=t,n.updateProjectionMatrix()}}]}),delete:H({scale(){}},j.delete)},create(n,e){const t=new l.PerspectiveCamera;if(Oe(t,n,{scale:!0,adaptiveWindow:!0},e),t.updateProjectionMatrix(),n.adaptiveWindow){const s=i=>{t.aspect=i.width/i.height,t.updateProjectionMatrix()};J.set(t,s),e.addEventListener("setSize",s),s({type:"setSize",width:e.dom.offsetWidth,height:e.dom.offsetHeight})}return t},dispose(n){J.delete(n),ne(n)}}),ko=v({configType:a.CONFIGTYPE.ORTHOGRAPHICCAMERA,commands:{add:H({scale(){}},j.add),set:it(H({scale(){},adaptiveWindow({target:n,value:e,engine:t}){if(e){if(!J.has(e)){const s=i=>{const r=i.width,o=i.height;n.left=-r,n.right=r,n.top=o,n.bottom=-o,n.updateProjectionMatrix()};J.set(n,s),t.addEventListener("setSize",s),s({type:"setSize",width:t.dom.offsetWidth,height:t.dom.offsetHeight})}}else{const s=J.get(n);s&&(t.removeEventListener("setSize",s),J.delete(n))}}},j.set),{$reg:[{reg:new RegExp("left|right|top|bottom|near|far|zoom"),handler({target:n,key:e,value:t}){n[e]=t,n.updateProjectionMatrix()}}]}),delete:H({scale(){}},j.delete)},create(n,e){const t=new l.OrthographicCamera(-50,50,50,-50);if(Oe(t,n,{scale:!0,adaptiveWindow:!0},e),t.updateProjectionMatrix(),n.adaptiveWindow){const s=i=>{const r=i.width,o=i.height;t.left=-r,t.right=r,t.top=o,t.bottom=-o,t.updateProjectionMatrix()};J.set(t,s),e.addEventListener("setSize",s),s({type:"setSize",width:e.dom.offsetWidth,height:e.dom.offsetHeight})}return t},dispose(n){J.delete(n),ne(n)}});class zo extends Ae{constructor(){super();d(this,"MODULE",a.MODULETYPE.CAMERA)}}b.processor(_o),b.processor(ko);var Vo=v({configType:a.CONFIGTYPE.ORBITCONTROLS,commands:{set:{target({target:n,config:e,path:t,key:s,value:i}){const r=e.target;if(!e.type){e.target=new l.Vector3(0,0,0);return}typeof e.target=="string"||(t.length>1?n.target[s]=i:n.target=new l.Vector3(r.x,r.y,r.z))}}},create(n,e){let t;return e.orbitControls?t=e.orbitControls:(t=new dn,t.setCamera(e.camera),t.setDom(e.dom)),n.target&&(typeof n.target=="string"||(t.target=new l.Vector3(n.target.x,n.target.y,n.target.z))),_(n,t,{target:!0}),t},dispose(n){n.dispose()}}),Wo=v({configType:a.CONFIGTYPE.TRNASFORMCONTROLS,commands:{set:{snapAllow({target:n,config:e,value:t}){t?(n.translationSnap=e.translationSnap,n.rotationSnap=e.rotationSnap,n.scaleSnap=e.scaleSnap):(n.translationSnap=null,n.rotationSnap=null,n.scaleSnap=null)},translationSnap({target:n,config:e,value:t}){e.snapAllow&&(n.translationSnap=t)},rotationSnap({target:n,config:e,value:t}){e.snapAllow&&(n.rotationSnap=t)},scaleSnap({target:n,config:e,value:t}){e.snapAllow&&(n.scaleSnap=t)}}},create(n,e){let t;return e.transformControls?t=e.transformControls:(t=new hn,t.setCamera(e.camera),t.setDom(e.dom)),n.snapAllow&&(t.translationSnap=n.translationSnap,t.rotationSnap=n.rotationSnap,t.scaleSnap=n.scaleSnap),t},dispose(n){n.dispose()}});class $o extends b{constructor(){super();d(this,"MODULE",a.MODULETYPE.CONTROLS)}useEngine(e){return e.transformControls&&(this.map.set(a.CONFIGTYPE.TRNASFORMCONTROLS,e.transformControls),this.weakMap.set(e.transformControls,a.CONFIGTYPE.TRNASFORMCONTROLS)),e.orbitControls&&(this.map.set(a.CONFIGTYPE.ORBITCONTROLS,e.orbitControls),this.weakMap.set(e.orbitControls,a.CONFIGTYPE.ORBITCONTROLS)),super.useEngine(e)}}b.processor(Vo),b.processor(Wo);const pt=function(n,e){const t=e.resourceManager.resourceMap;if(!t.has(n))return console.warn(`css3D compiler: can not found resource element: ${n}`),document.createElement("div");const s=t.get(n);return s instanceof HTMLElement?s:(console.warn("css3D compiler can not suport render this resource type.",s.constructor,n),document.createElement("div"))};var Ko=v({configType:a.CONFIGTYPE.CSS3DOBJECT,commands:{add:j.add,set:H({element({target:n,value:e,engine:t}){n.element=pt(e,t)}},j.set),delete:j.delete},create(n,e){return Oe(new we.CSS3DObject(pt(n.element,e)),n,{element:!0},e)},dispose:ne});class Xo extends we.CSS3DObject{constructor(e=document.createElement("div")){const t=document.createElement("div"),s=50,i=50;t.style.width=`${s}px`,t.style.height=`${i}px`,t.appendChild(e);super(t);d(this,"geometry");d(this,"_width");d(this,"_height");d(this,"cacheBox",new l.Box3);this.geometry=new l.PlaneBufferGeometry(s,i),this.geometry.computeBoundingBox(),this._width=s,this._height=i}get width(){return this._width}set width(e){this.geometry.dispose(),this.geometry=new l.PlaneBufferGeometry(e,this._height),this.geometry.computeBoundingBox(),this.element.style.width=`${e}px`,this._width=e}get height(){return this._height}set height(e){this.geometry.dispose(),this.geometry=new l.PlaneBufferGeometry(this._width,e),this.geometry.computeBoundingBox(),this.element.style.height=`${e}px`,this._height=e}}class Qn extends Xo{constructor(e=document.createElement("div")){super(e);this.element.classList.add("vis-css3d-plane")}raycast(e,t){const s=this.cacheBox.copy(this.geometry.boundingBox);s.applyMatrix4(this.matrixWorld),e.ray.intersectsBox(s)&&t.push({distance:e.ray.origin.distanceTo(this.position),object:this,point:this.position})}}var Qo=v({configType:a.CONFIGTYPE.CSS3DPLANE,commands:{add:j.add,set:H({element({target:n,value:e,engine:t}){n.element.innerHTML="",n.element.appendChild(pt(e,t))}},j.set),delete:j.delete},create(n,e){return Oe(new Qn(pt(n.element,e)),n,{element:!0},e)},dispose:ne});class qo extends Ae{constructor(){super();d(this,"MODULE",a.MODULETYPE.CSS3D)}}b.processor(Qo),b.processor(Ko);class _e extends l.BufferGeometry{constructor(e=[],t=36,s=!0){super();d(this,"parameters");this.type="CurveGeometry",this.parameters={path:e.map(i=>i.clone()),space:s,divisions:t}}}class Zo extends _e{constructor(e=[],t=36,s=!0){super(e,t,s);this.type="QuadraticBezierCurveGeometry";const i=new l.CurvePath;if(e.length<3){console.warn("QuadraticBezierCurveGeometry path length at least 3.");return}const r=3+(e.length-3)-(e.length-3)%2;for(let c=1;c<r;c+=2)i.add(new l.QuadraticBezierCurve3(e[c-1],e[c],e[c+1]));const o=i.curves.reduce((c,u)=>c+=u.arcLengthDivisions,0);if(t>o){const c=Math.ceil((t-o)/i.curves.length);i.curves.forEach(u=>{u.arcLengthDivisions=u.arcLengthDivisions*(c+1),u.updateArcLengths()})}this.setFromPoints(s?i.getSpacedPoints(t):i.getPoints(t))}}class Jo extends _e{constructor(e=[],t=36,s=!0){super(e,t,s);this.type="CubicBezierCurveGeometry";const i=new l.CurvePath;if(e.length<4){console.warn("CubicBezierCurveGeometry path length at least 4.");return}const r=4+(e.length-4)-(e.length-4)%3;for(let c=2;c<r;c+=3)i.add(new l.CubicBezierCurve3(e[c-2],e[c-1],e[c],e[c+1]));const o=i.curves.reduce((c,u)=>c+=u.arcLengthDivisions,0);if(t>o){const c=Math.ceil((t-o)/i.curves.length);i.curves.forEach(u=>{u.arcLengthDivisions=u.arcLengthDivisions*(c+1),u.updateArcLengths()})}this.setFromPoints(s?i.getSpacedPoints(t):i.getPoints(t))}}class ea extends _e{constructor(e=[],t=36,s=!0){super(e,t,s);if(this.type="LineCurveGeometry",!e.length){console.warn("LineCurveGeometry path length at least 1.");return}const i=new l.CurvePath;for(let o=1;o<e.length;o+=1)i.add(new l.LineCurve3(e[o-1],e[o]));const r=i.curves.reduce((o,c)=>o+=c.arcLengthDivisions,0);if(t>r){const o=Math.ceil((t-r)/i.curves.length);i.curves.forEach(c=>{c.arcLengthDivisions=c.arcLengthDivisions*(o+1),c.updateArcLengths()})}this.setFromPoints(s?i.getSpacedPoints(t):i.getPoints(t))}}class ta extends _e{constructor(e=[],t=36,s=!0){super(e,t,s);if(this.type="SplineCurveGeometry",!e.length){console.warn("SplineCurveGeometry path length at least 1.");return}const i=new l.CatmullRomCurve3(e);this.setFromPoints(s?i.getSpacedPoints(t):i.getPoints(t))}}class na extends l.TubeGeometry{constructor(e=[],t=64,s=1,i=8,r=!1){if(!e.length){console.warn("LineTubeGeometry path length at least 1.");return}const o=new l.CurvePath;for(let c=1;c<e.length;c+=1)o.add(new l.LineCurve3(e[c-1],e[c]));super(o,t,s,i,r);this.type="LineTubeGeometry"}}class sa extends l.TubeGeometry{constructor(e=[],t=64,s=1,i=8,r=!1){if(!e.length){console.warn("SplineTubeGeometry path length at least 1.");return}const o=new l.CatmullRomCurve3(e);super(o,t,s,i,r);this.type="SplineTubeGeometry"}}class ia extends l.ShapeBufferGeometry{constructor(e=[new l.Vector2(0,0)],t=12){const s=new l.Shape,i=e[0];if(i){s.moveTo(i.x,i.y);for(let r=1;r<e.length;r+=1)s.lineTo(e[r].x,e[r].y)}super(s,t);this.type="LineShapeGeometry"}}const ra=function(n,e){!(n instanceof _e)&&!(n instanceof l.TubeGeometry)&&!(n instanceof l.ShapeGeometry)&&n.center(),n.computeBoundingBox();const t=n.boundingBox,s=e.position,i=e.rotation,r=e.scale,o=new l.Quaternion().setFromEuler(new l.Euler(i.x,i.y,i.z,"XYZ"));return n.applyQuaternion(o),n.scale(r.x,r.y,r.z),!(n instanceof _e)&&!(n instanceof l.TubeGeometry)&&!(n instanceof l.ShapeGeometry)&&n.center(),n.computeBoundingBox(),n.translate((t.max.x-t.min.x)/2*s.x,(t.max.y-t.min.y)/2*s.y,(t.max.z-t.min.z)/2*s.z),n},Ht={reg:new RegExp(".*"),handler({config:n,target:e,processor:t,engine:s}){const i=t.create(n,s);e.copy(i),e.dispatchEvent({type:"update"}),e.uuid=i.uuid,i.dispose()}},ft={add:{groups({target:n,value:e}){n.addGroup(e.start,e.count,e.materialIndex)},$reg:[Ht]},set:{groups(n){const{path:e,target:t,config:s}=n;if(e[1]!==void 0){t.groups.splice(Number(n.path[1]),1);const i=s.groups[e[1]];t.addGroup(i.start,i.count,i.materialIndex)}else console.warn("geometry processor can not set group",n)},$reg:[Ht]},delete:{groups({target:n,key:e}){n.groups.splice(Number(e),1)},$reg:[Ht]}},mt=function(n,e){n.clearGroups();for(const t of e.groups)n.addGroup(t.start,t.count,t.materialIndex);return ra(n,e)},B=new Map;B.set(a.CONFIGTYPE.BOXGEOMETRY,n=>new l.BoxBufferGeometry(n.width,n.height,n.depth,n.widthSegments,n.heightSegments,n.depthSegments)),B.set(a.CONFIGTYPE.SPHEREGEOMETRY,n=>new l.SphereBufferGeometry(n.radius,n.widthSegments,n.heightSegments,n.phiStart,n.phiLength,n.thetaStart,n.thetaLength)),B.set(a.CONFIGTYPE.PLANEGEOMETRY,n=>new l.PlaneBufferGeometry(n.width,n.height,n.widthSegments,n.heightSegments)),B.set(a.CONFIGTYPE.CIRCLEGEOMETRY,n=>new l.CircleBufferGeometry(n.radius,n.segments,n.thetaStart,n.thetaLength)),B.set(a.CONFIGTYPE.CONEGEOMETRY,n=>new l.ConeBufferGeometry(n.radius,n.height,n.radialSegments,n.heightSegments,n.openEnded,n.thetaStart,n.thetaLength)),B.set(a.CONFIGTYPE.CYLINDERGEOMETRY,n=>new l.CylinderBufferGeometry(n.radiusTop,n.radiusBottom,n.height,n.radialSegments,n.heightSegments,n.openEnded,n.thetaStart,n.thetaLength)),B.set(a.CONFIGTYPE.LINECURVEGEOMETRY,n=>new ea(n.path.map(e=>new l.Vector3(e.x,e.y,e.z)),n.divisions,n.space)),B.set(a.CONFIGTYPE.SPLINECURVEGEOMETRY,n=>new ta(n.path.map(e=>new l.Vector3(e.x,e.y,e.z)),n.divisions,n.space)),B.set(a.CONFIGTYPE.CUBICBEZIERCURVEGEOMETRY,n=>new Jo(n.path.map(e=>new l.Vector3(e.x,e.y,e.z)),n.divisions,n.space)),B.set(a.CONFIGTYPE.QUADRATICBEZIERCURVEGEOMETRY,n=>new Zo(n.path.map(e=>new l.Vector3(e.x,e.y,e.z)),n.divisions,n.space)),B.set(a.CONFIGTYPE.LINETUBEGEOMETRY,n=>new na(n.path.map(e=>new l.Vector3(e.x,e.y,e.z)),n.tubularSegments,n.radius,n.radialSegments,n.closed)),B.set(a.CONFIGTYPE.SPLINETUBEGEOMETRY,n=>new sa(n.path.map(e=>new l.Vector3(e.x,e.y,e.z)),n.tubularSegments,n.radius,n.radialSegments,n.closed)),B.set(a.CONFIGTYPE.TORUSGEOMETRY,n=>new l.TorusGeometry(n.radius,n.tube,n.radialSegments,n.tubularSegments,n.arc)),B.set(a.CONFIGTYPE.RINGGEOMETRY,n=>new l.RingBufferGeometry(n.innerRadius,n.outerRadius,n.thetaSegments,n.phiSegments,n.thetaStart,n.thetaLength)),B.set(a.CONFIGTYPE.LINESHAPEGEOMETRY,n=>new ia(n.path.map(e=>new l.Vector2(e.x,e.y)),n.curveSegments));const oa=function(n){return B.has(n.type)?mt(B.get(n.type)(n),n):(console.error(`parametric geometry can not support this type config: ${n.type}`),new l.BufferGeometry)},aa=function(n){n.dispose()},ca=function(n){return v({configType:n,commands:ft,create:oa,dispose:aa})},la=[a.CONFIGTYPE.BOXGEOMETRY,a.CONFIGTYPE.SPHEREGEOMETRY,a.CONFIGTYPE.PLANEGEOMETRY,a.CONFIGTYPE.CIRCLEGEOMETRY,a.CONFIGTYPE.CONEGEOMETRY,a.CONFIGTYPE.CYLINDERGEOMETRY,a.CONFIGTYPE.LINECURVEGEOMETRY,a.CONFIGTYPE.SPLINECURVEGEOMETRY,a.CONFIGTYPE.CUBICBEZIERCURVEGEOMETRY,a.CONFIGTYPE.QUADRATICBEZIERCURVEGEOMETRY,a.CONFIGTYPE.LINETUBEGEOMETRY,a.CONFIGTYPE.SPLINETUBEGEOMETRY,a.CONFIGTYPE.TORUSGEOMETRY,a.CONFIGTYPE.RINGGEOMETRY,a.CONFIGTYPE.LINESHAPEGEOMETRY].map(n=>ca(n));class ua extends l.BufferGeometry{constructor(e){super();d(this,"type","LoadBufferGeometry");e&&this.copy(e)}}var da=v({configType:a.CONFIGTYPE.LOADGEOMETRY,commands:ft,create(n,e){const t=e.resourceManager.resourceMap.get(n.url);return!t&&!(t instanceof l.BufferGeometry)?(console.error(`engine rescoure can not found url: ${n.url}`),new l.BoxBufferGeometry(5,5,5)):mt(new ua(t),n)},dispose(n){n.dispose()}});const ha=function(n){const e=new l.BufferGeometry;return n.position.length&&e.setAttribute("position",new l.Float32BufferAttribute(n.position,3)),n.color.length&&e.setAttribute("color",new l.Float32BufferAttribute(n.color,3)),n.normal.length&&e.setAttribute("normal",new l.Float32BufferAttribute(n.normal,3)),n.uv.length&&e.setAttribute("uv",new l.Float32BufferAttribute(n.uv,2)),n.uv2.length&&e.setAttribute("uv2",new l.Float32BufferAttribute(n.uv2,2)),n.index.length&&e.setIndex(n.index),e};var pa=v({configType:a.CONFIGTYPE.CUSTOMGEOMETRY,commands:ft,create(n){return mt(ha(n.attribute),n)},dispose(n){n.dispose()}}),fa=v({configType:a.CONFIGTYPE.EDGESGEOMETRY,commands:ft,create(n,e){const t=e.compilerManager.getObjectBySymbol(n.url);return!t||!(t instanceof l.BufferGeometry)?(console.error(`engine rescoure can not found url: ${n.url}`),new l.EdgesGeometry(new l.BoxBufferGeometry(5,5,5))):mt(new l.EdgesGeometry(t),n)},dispose(n){n.dispose()}});class ma extends b{constructor(){super();d(this,"MODULE",a.MODULETYPE.GEOMETRY)}}la.forEach(n=>{b.processor(n)}),b.processor(da),b.processor(pa),b.processor(fa);var ga=v({configType:a.CONFIGTYPE.GROUP,commands:j,create(n,e){return Oe(new l.Group,n,{},e)},dispose:ne});class Ea extends Ae{constructor(){super();d(this,"MODULE",a.MODULETYPE.GROUP)}}b.processor(ga);const Ta=function({target:n,value:e}){n.color.copy(new l.Color(e))},gt=function(n,e,t,s){return n.color.copy(new l.Color(e.color)),Oe(n,e,H({color:!0,scale:!0,rotation:!0,lookAt:!0},t),s)},Et=Object.assign({},j,{set:{color:Ta,scale:ht,rotation:ht,lookAt:ht}});var ya=v({configType:a.CONFIGTYPE.AMBIENTLIGHT,commands:Et,create(n,e){return gt(new l.AmbientLight,n,{},e)},dispose:ne}),Ma=v({configType:a.CONFIGTYPE.DIRECTIONALLIGHT,commands:Et,create(n,e){return gt(new l.DirectionalLight,n,{},e)},dispose:ne}),Sa=v({configType:a.CONFIGTYPE.POINTLIGHT,commands:Et,create(n,e){return gt(new l.PointLight,n,{},e)},dispose:ne}),Oa=v({configType:a.CONFIGTYPE.SPOTLIGHT,commands:Et,create(n,e){return gt(new l.SpotLight,n,{},e)},dispose:ne});class Ca extends Ae{constructor(){super();d(this,"MODULE",a.MODULETYPE.LIGHT)}}b.processor(ya),b.processor(Ma),b.processor(Sa),b.processor(Oa);class Tt extends Ae{constructor(){super()}}const yt=new l.ShaderMaterial({fragmentShader:`
  void main () {
    gl_FragColor = vec4(0.5, 0.5, 0.5, 1.0);
  }
  `}),qn=new l.BoxBufferGeometry(10,10,10),ba=function({target:n,value:e,engine:t}){const s=t.compilerManager.getGeometry(e);if(!s){console.warn(`can not found geometry by vid in engine: ${e}`),n.geometry=qn;return}n.geometry=s},Bt=function({target:n,config:e,engine:t}){let s;typeof e.material=="string"?s=t.compilerManager.getMaterial(e.material)||yt:s=e.material.map(i=>t.compilerManager.getMaterial(i)||yt),n.material=s},Mt=function(n,e,t,s){if(!t.geometry){let i=s.getObjectBySymbol(e.geometry);i instanceof l.BufferGeometry||(console.warn(`geometry vid in engine is not instance of BufferGeometry: ${e.geometry}`,i),i=qn),n.geometry.dispose(),n.geometry=i}if(!t.material){let i;typeof e.material=="string"?i=s.compilerManager.getMaterial(e.material)||yt:i=e.material.map(r=>s.compilerManager.getMaterial(r)||yt),n.material=i}return Oe(n,e,H({geometry:!0,material:!0},t),s)},St=function(n){ne(n)},ke={add:H({material:Bt},j.add),set:H({geometry:ba,material:Bt},j.set),delete:H({material:Bt},j.delete)};var Ra=v({configType:a.CONFIGTYPE.LINE,commands:ke,create(n,e){return Mt(new l.Line,n,{},e)},dispose:St});class La extends Tt{constructor(){super();d(this,"MODULE",a.MODULETYPE.LINE)}}b.processor(Ra);const Ne={reg:new RegExp("transparent|sizeAttenuation"),handler({target:n,key:e,value:t,engine:s}){n[e]=t,n.needsUpdate=!0}},ze={reg:new RegExp("map$","i"),handler({target:n,key:e,value:t,engine:s}){const i=s.compilerManager.getObjectBySymbol(t);i instanceof l.Texture||console.warn(`this url resource is not instance of Texture: ${e}`,t,i),n[e]=i,n.needsUpdate=!0}},he=function({target:n,key:e,value:t}){n[e].copy(new l.Color(t))},Ve=function(n,e,t){const s={};for(const i of Object.keys(e))if(i.toLocaleLowerCase().endsWith("map")&&e[i]){const r=t.compilerManager.getObjectBySymbol(e[i]);if(!(r instanceof l.Texture)){console.warn(`this url resource is not instance of Texture: ${i}`,e[i],r);continue}n[i]=r,s[i]=!0}else["color","emissive","specular"].includes(i)&&(n[i]=new l.Color(e[i]),s[i]=!0);return _(e,n,s),n.needsUpdate=!0,n},Ge=function(n){n.dispose()};var Zn=v({configType:a.CONFIGTYPE.LINEBASICMATERIAL,commands:{set:{color:he,$reg:[ze,Ne]}},create:function(n,e){return Ve(new l.LineBasicMaterial,n,e)},dispose:Ge}),wa=v({configType:a.CONFIGTYPE.MESHBASICMATERIAL,commands:{set:{color:he,$reg:[ze,Ne]}},create:function(n,e){return Ve(new l.MeshBasicMaterial,n,e)},dispose:Ge}),Ia=v({configType:a.CONFIGTYPE.MESHPHONGMATERIAL,commands:{set:{color:he,emissive:he,specular:he,$reg:[ze,Ne]}},create:function(n,e){return Ve(new l.MeshPhongMaterial,n,e)},dispose:Ge}),Pa=v({configType:a.CONFIGTYPE.MESHSTANDARDMATERIAL,commands:{set:{color:he,emissive:he,$reg:[ze,Ne]}},create:function(n,e){return Ve(new l.MeshStandardMaterial,n,e)},dispose:Ge}),va=v({configType:a.CONFIGTYPE.POINTSMATERIAL,commands:{set:{color:he,$reg:[ze,Ne]}},create:function(n,e){return Ve(new l.PointsMaterial,n,e)},dispose:Ge}),Aa=v({configType:a.CONFIGTYPE.SHADERMATERIAL,commands:{set:{shader({target:n,value:e}){const t=Z.getShader(e);(t==null?void 0:t.vertexShader)&&(n.vertexShader=t.vertexShader),(t==null?void 0:t.fragmentShader)&&(n.fragmentShader=t.fragmentShader),(t==null?void 0:t.uniforms)&&(n.uniforms=t.uniforms),(t==null?void 0:t.defines)&&(n.defines=t.defines),n.needsUpdate=!0},$reg:[Ne]}},create:function(n,e){const t=new l.ShaderMaterial,s=Z.getShader(n.shader);return(s==null?void 0:s.vertexShader)&&(t.vertexShader=s.vertexShader),(s==null?void 0:s.fragmentShader)&&(t.fragmentShader=s.fragmentShader),(s==null?void 0:s.uniforms)&&(t.uniforms=s.uniforms),(s==null?void 0:s.defines)&&(t.defines=s.defines),_(n,t,{type:!0,shader:!0}),t.needsUpdate=!0,t},dispose:Ge}),Na=v({configType:a.CONFIGTYPE.SPRITEMATERIAL,commands:{set:{color:he,$reg:[ze,Ne]}},create:function(n,e){return Ve(new l.SpriteMaterial,n,e)},dispose:Ge});class Ga extends b{constructor(){super();d(this,"MODULE",a.MODULETYPE.MATERIAL)}}b.processor(wa),b.processor(Pa),b.processor(Ia),b.processor(Zn),b.processor(va),b.processor(Na),b.processor(Zn),b.processor(Aa);var Da=v({configType:a.CONFIGTYPE.MESH,commands:ke,create(n,e){return Mt(new l.Mesh,n,{},e)},dispose:St});class Ua extends Tt{constructor(){super();d(this,"MODULE",a.MODULETYPE.MESH)}}b.processor(Da);var xa=v({configType:a.CONFIGTYPE.SMAAPASS,create(n,e){const t=window.devicePixelRatio;return new Ss.SMAAPass(e.dom?e.dom.offsetWidth*t:window.innerWidth*t,e.dom?e.dom.offsetHeight*t:window.innerWidth*t)},dispose(n){}}),Fa=v({configType:a.CONFIGTYPE.UNREALBLOOMPASS,create(n,e){const t=window.devicePixelRatio;return new Os.UnrealBloomPass(new l.Vector2(e.dom?e.dom.offsetWidth*t:window.innerWidth*t,e.dom?e.dom.offsetHeight*t:window.innerWidth*t),n.strength,n.radius,n.threshold)},dispose(n){n.dispose()}});const Rt=class extends an.Pass{constructor(e=new l.Vector2(256,256),t=1,s=0,i=0,r=new l.Scene,o=new l.PerspectiveCamera,c){super();d(this,"resolution");d(this,"strength");d(this,"radius");d(this,"threshold");d(this,"selectedObjects",[]);d(this,"renderScene");d(this,"renderCamera");d(this,"clearColor",new l.Color(0,0,0));d(this,"renderTargetsHorizontal",[]);d(this,"renderTargetsVertical",[]);d(this,"nMips",5);d(this,"selectRenderTarget");d(this,"renderTargetBright");d(this,"highPassUniforms");d(this,"materialHighPassFilter");d(this,"separableBlurMaterials",[]);d(this,"compositeMaterial");d(this,"bloomTintColors");d(this,"mixMaterial");d(this,"enabled",!0);d(this,"needsSwap",!1);d(this,"_oldClearColor",new l.Color);d(this,"oldClearAlpha",1);d(this,"basic",new l.MeshBasicMaterial);d(this,"fsQuad",new an.FullScreenQuad);d(this,"materialCache",new Map);d(this,"sceneBackgroundCache",null);d(this,"overrideBackground",new l.Color("black"));d(this,"overrideMeshMaterial",new l.MeshBasicMaterial({color:"black"}));d(this,"overrideLineMaterial",new l.LineBasicMaterial({color:"black"}));d(this,"overridePointsMaterial",new l.PointsMaterial({color:"black"}));d(this,"overrideSpriteMaterial",new l.SpriteMaterial({color:"black"}));this.resolution=e,this.strength=t,this.radius=s,this.threshold=i,this.renderScene=r,this.renderCamera=o,this.selectedObjects=c;let u=Math.round(this.resolution.x/2),h=Math.round(this.resolution.y/2);this.selectRenderTarget=new l.WebGLRenderTarget(u,h),this.selectRenderTarget.texture.name="UnrealBloomPass.selected",this.selectRenderTarget.texture.generateMipmaps=!1,this.renderTargetBright=new l.WebGLRenderTarget(u,h),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let E=0;E<this.nMips;E++){const S=new l.WebGLRenderTarget(u,h);S.texture.name="UnrealBloomPass.h"+E,S.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(S);const O=new l.WebGLRenderTarget(u,h);O.texture.name="UnrealBloomPass.v"+E,O.texture.generateMipmaps=!1,this.renderTargetsVertical.push(O),u=Math.round(u/2),h=Math.round(h/2)}cn.LuminosityHighPassShader===void 0&&console.error("THREE.UnrealBloomPass relies on LuminosityHighPassShader");const p=cn.LuminosityHighPassShader;this.highPassUniforms=l.UniformsUtils.clone(p.uniforms),this.highPassUniforms.luminosityThreshold.value=i,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new l.ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:p.vertexShader,fragmentShader:p.fragmentShader,defines:{}});const f=[3,5,7,9,11];u=Math.round(this.resolution.x/2),h=Math.round(this.resolution.y/2);for(let E=0;E<this.nMips;E++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(f[E])),this.separableBlurMaterials[E].uniforms.texSize.value=new l.Vector2(u,h),u=Math.round(u/2),h=Math.round(h/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;const g=[1,.8,.6,.4,.2];this.compositeMaterial.uniforms.bloomFactors.value=g,this.bloomTintColors=[new l.Vector3(1,1,1),new l.Vector3(1,1,1),new l.Vector3(1,1,1),new l.Vector3(1,1,1),new l.Vector3(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,this.mixMaterial=this.getMixMaterial()}dispose(){for(let e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose()}setSize(e,t){let s=Math.round(e/2),i=Math.round(t/2);this.selectRenderTarget.setSize(s,i),this.renderTargetBright.setSize(s,i);for(let r=0;r<this.nMips;r++)this.renderTargetsHorizontal[r].setSize(s,i),this.renderTargetsVertical[r].setSize(s,i),this.separableBlurMaterials[r].uniforms.texSize.value=new l.Vector2(s,i),s=Math.round(s/2),i=Math.round(i/2)}render(e,t,s,i,r){if(!this.selectedObjects.length){this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=s.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e));return}e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const o=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),r&&e.state.buffers.stencil.setTest(!1);const c=new Map;for(const p of this.selectedObjects)c.set(p,!0);const u=this.materialCache;this.renderScene.background&&(this.sceneBackgroundCache=this.renderScene.background,this.renderScene.background=this.overrideBackground),this.renderScene.traverse(p=>{!c.has(p)&&!p.isLight&&p.visible&&(u.set(p,p.material),p instanceof l.Mesh?p.material=this.overrideMeshMaterial:p instanceof l.Line?p.material=this.overrideLineMaterial:p instanceof l.Points?p.material=this.overridePointsMaterial:p instanceof l.Sprite&&(p.material=this.overrideSpriteMaterial))}),e.setRenderTarget(this.selectRenderTarget),e.clear(),e.render(this.renderScene,this.renderCamera),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=this.selectRenderTarget.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=this.selectRenderTarget.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);let h=this.renderTargetBright;for(let p=0;p<this.nMips;p++)this.fsQuad.material=this.separableBlurMaterials[p],this.separableBlurMaterials[p].uniforms.colorTexture.value=h.texture,this.separableBlurMaterials[p].uniforms.direction.value=Rt.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[p]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[p].uniforms.colorTexture.value=this.renderTargetsHorizontal[p].texture,this.separableBlurMaterials[p].uniforms.direction.value=Rt.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[p]),e.clear(),this.fsQuad.render(e),h=this.renderTargetsVertical[p];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.mixMaterial,this.mixMaterial.uniforms.bloom.value=this.renderTargetsHorizontal[0].texture,this.mixMaterial.uniforms.origin.value=s.texture,r&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(s),this.fsQuad.render(e)),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=o;for(const p of u.entries())p[0].material=p[1];u.clear(),this.sceneBackgroundCache&&(this.renderScene.background=this.sceneBackgroundCache,this.sceneBackgroundCache=null)}getMixMaterial(){return new l.ShaderMaterial({blending:l.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0,uniforms:{bloom:{value:null},origin:{value:null}},vertexShader:`
    
        varying vec2 vUv;
    
        void main() {
    
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
    
        }`,fragmentShader:`
        uniform sampler2D bloom;
        uniform sampler2D origin;
    
        varying vec2 vUv;
    
        void main() {
          vec3 bloomColor = texture2D(bloom, vUv).rgb;
          vec3 originColor = texture2D(origin, vUv).rgb;
          gl_FragColor = vec4(originColor + bloomColor, 1.0);
        }`})}getSeperableBlurMaterial(e){return new l.ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new l.Vector2(.5,.5)},direction:{value:new l.Vector2(.5,.5)}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 texSize;
				uniform vec2 direction;

				float gaussianPdf(in float x, in float sigma) {
					return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;
				}
				void main() {
					vec2 invSize = 1.0 / texSize;
					float fSigma = float(SIGMA);
					float weightSum = gaussianPdf(0.0, fSigma);
					vec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;
					for( int i = 1; i < KERNEL_RADIUS; i ++ ) {
						float x = float(i);
						float w = gaussianPdf(x, fSigma);
						vec2 uvOffset = direction * invSize * x;
						vec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;
						vec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;
						diffuseSum += (sample1 + sample2) * w;
						weightSum += 2.0 * w;
					}
					gl_FragColor = vec4(diffuseSum/weightSum, 1.0);
				}`})}getCompositeMaterial(e){return new l.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;
				uniform sampler2D blurTexture1;
				uniform sampler2D blurTexture2;
				uniform sampler2D blurTexture3;
				uniform sampler2D blurTexture4;
				uniform sampler2D blurTexture5;
				uniform float bloomStrength;
				uniform float bloomRadius;
				uniform float bloomFactors[NUM_MIPS];
				uniform vec3 bloomTintColors[NUM_MIPS];

				float lerpBloomFactor(const in float factor) {
					float mirrorFactor = 1.2 - factor;
					return mix(factor, mirrorFactor, bloomRadius);
				}

				void main() {
					gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +
						lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +
						lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +
						lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +
						lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );
				}`})}};let nt=Rt;d(nt,"BlurDirectionX",new l.Vector2(1,0)),d(nt,"BlurDirectionY",new l.Vector2(0,1));var ja=v({configType:a.CONFIGTYPE.SELECTIVEBLOOMPASS,commands:{add:{selectedObjects({target:n,engine:e,value:t}){const s=e.compilerManager.getObject3D(t);s?n.selectedObjects.push(s):console.warn(`selectiveBloomPassProcessor: can not found vid in engine: ${t}`)}},set:{renderScene({target:n,engine:e,value:t}){const s=e.compilerManager.getObject3D(t);s instanceof l.Scene&&(n.renderScene=s)},renderCamera({target:n,engine:e,value:t}){const s=e.compilerManager.getObject3D(t);s instanceof l.Camera&&(n.renderCamera=s)},selectedObjects({target:n,config:e,engine:t}){const s=e.selectedObjects.map(i=>{const r=t.compilerManager.getObject3D(i);if(r)return r;console.warn(`selectiveBloomPassProcessor: can not found vid in engine: ${i}`)}).filter(i=>i);n.selectedObjects=s}},delete:{selectedObjects({target:n,engine:e,value:t}){const s=e.compilerManager.getObject3D(t);s?n.selectedObjects.includes(s)&&n.selectedObjects.splice(n.selectedObjects.indexOf(s),1):console.warn(`selectiveBloomPassProcessor: can not found vid in engine: ${t}`)}}},create(n,e){const t=[];for(const r of n.selectedObjects){const o=e.compilerManager.getObject3D(r);o&&t.push(o)}const s=window.devicePixelRatio;return new nt(new l.Vector2(e.dom?e.dom.offsetWidth*s:window.innerWidth*s,e.dom?e.dom.offsetHeight*s:window.innerWidth*s),n.strength,n.radius,n.threshold,n.renderScene&&e.compilerManager.getObject3D(n.renderScene)||void 0,n.renderCamera&&e.compilerManager.getObject3D(n.renderCamera)||void 0,t)},dispose(n){n.dispose()}});class Ya extends b{constructor(){super();d(this,"MODULE",a.MODULETYPE.PASS);d(this,"composer")}useEngine(e){return super.useEngine(e),e.effectComposer?(this.composer=e.effectComposer,this):(console.warn("engine need install effectComposer plugin that can use pass compiler."),this)}add(e){const t=super.add(e);return t&&this.composer.addPass(t),t}remove(e){if(!this.map.has(e.vid))return console.warn(`PassCompiler can not found this vid pass: ${e.vid}.`),this;const t=this.map.get(e.vid);return this.composer.removePass(t),super.remove(e),this}}b.processor(xa),b.processor(Fa),b.processor(ja);var Ha=v({configType:a.CONFIGTYPE.POINTS,commands:ke,create(n,e){return Mt(new l.Points,n,{},e)},dispose:St});class Ba extends Tt{constructor(){super();d(this,"MODULE",a.MODULETYPE.POINTS)}}b.processor(Ha);var _a=v({configType:a.CONFIGTYPE.WEBGLRENDERER,commands:{set:{size({target:n,config:e}){e.size?n.setSize(e.size.x,e.size.y):n.setSize(n.domElement.offsetWidth,n.domElement.offsetHeight)},clearColor({target:n,value:e}){const t=Number(e.slice(0,-1).split(",").pop().trim());n.setClearColor(e,t),n.clear()},viewport({target:n,config:e}){const t=e.viewport;if(t)n.setViewport(t.x,t.y,t.width,t.height);else{const s=n.domElement;n.setViewport(0,0,s.offsetWidth,s.offsetHeight)}},scissor({target:n,config:e}){const t=e.scissor;if(t)n.setScissorTest(!0),n.setScissor(t.x,t.y,t.width,t.height);else{n.setScissorTest(!1);const s=n.domElement;n.setScissor(0,0,s.offsetWidth,s.offsetHeight)}},pixelRatio({target:n,value:e}){n.setPixelRatio(e),n.clear()}}},create(n,e){let t;if(e.webGLRenderer?t=e.webGLRenderer:t=new l.WebGLRenderer,n.size&&t.setSize(n.size.x,n.size.y),n.clearColor){const s=Number(n.clearColor.slice(0,-1).split(",").pop().trim());t.setClearColor(n.clearColor,s)}if(n.viewport){const s=n.viewport;t.setViewport(s.x,s.y,s.width,s.height)}if(n.scissor){const s=n.scissor;t.setScissorTest(!0),t.setScissor(s.x,s.y,s.width,s.height)}return n.pixelRatio&&t.setPixelRatio(n.pixelRatio),_(n,t,{size:!0,clearColor:!0,viewport:!0,scissor:!0,pixelRatio:!0}),t},dispose(n){n.clear(),n.dispose()}}),ka=v({configType:a.CONFIGTYPE.CSS3DRENDERER,commands:{set:{size({target:n,config:e}){e.size?n.setSize(e.size.x,e.size.y):n.setSize(n.domElement.offsetWidth,n.domElement.offsetHeight)}}},create(n,e){let t;return e.css3DRenderer?t=e.css3DRenderer:t=new we.CSS3DRenderer,n.size&&t.setSize(n.size.x,n.size.y),_(n,t,{size:!0}),t},dispose(n){}});class za extends b{constructor(){super();d(this,"MODULE",a.MODULETYPE.RENDERER)}useEngine(e){return e.webGLRenderer&&this.map.set(a.CONFIGTYPE.WEBGLRENDERER,e.webGLRenderer),e.css3DRenderer&&this.map.set(a.CONFIGTYPE.CSS3DRENDERER,e.css3DRenderer),super.useEngine(e)}}b.processor(_a),b.processor(ka);const Jn=function(n,e,t){if(!e){n.background=null;return}if(ee.validate(e)){const s=t.compilerManager.getTexture(e);s?n.background=s:console.warn(`engine can not found this vid texture : '${e}'`)}else n.background=new l.Color(e)},es=function(n,e,t){if(!e){n.environment=null;return}if(ee.validate(e)){const s=t.compilerManager.getTexture(e);s?n.environment=s:console.warn(`engine can not found this vid texture : '${e}'`)}else console.warn(`scene environment is illeage: ${e}`)};var Va=v({configType:a.CONFIGTYPE.SCENE,commands:{add:j.add,set:it(H({},j.set),{lookAt(){},fog({target:n,config:e,key:t,value:s}){const i=e.fog;i.type?i.type==="Fog"?!n.fog||!(n.fog instanceof l.Fog)?n.fog=new l.Fog(i.color,i.near,i.far):t==="color"?n.fog.color.copy(new l.Color(i.color)):n.fog[t]&&(n.fog[t]=s):i.type==="FogExp2"&&(!n.fog||!(n.fog instanceof l.FogExp2)?n.fog=new l.FogExp2(i.color,i.density):t==="color"?n.fog.color.copy(new l.Color(i.color)):n.fog[t]&&(n.fog[t]=s)):n.fog=null},background({target:n,value:e,engine:t}){Jn(n,e,t)},environment({target:n,value:e,engine:t}){es(n,e,t)}}),delete:j.delete},create(n,e){const t=new l.Scene;if(Jn(t,n.background,e),es(t,n.environment,e),n.fog.type){const s=n.fog;s.type==="Fog"?t.fog=new l.Fog(s.color,s.near,s.far):s.type==="FogExp2"?t.fog=new l.FogExp2(s.color,s.density):console.warn(`scene processor can not support this type fog:'${n.type}'`)}return Oe(t,n,{lookAt:!0,background:!0,environment:!0,fog:!0},e)},dispose:ne});class Wa extends Ae{constructor(){super();d(this,"MODULE",a.MODULETYPE.SCENE)}}b.processor(Va);const ts=new l.SpriteMaterial({color:"rgb(123, 123, 123)"});var $a=v({configType:a.CONFIGTYPE.SPRITE,commands:{add:ke.add,set:it(H({lookAt(){}},ke.set),{material({target:n,engine:e,value:t}){const s=e.compilerManager.getMaterial(t);s&&s instanceof l.SpriteMaterial?n.material=s:n.material=ts}}),delete:ke.add},create(n,e){const t=new l.Sprite,s=e.compilerManager.getMaterial(n.material);return s&&s instanceof l.SpriteMaterial?t.material=s:t.material=ts,Mt(t,n,{geometry:!0,material:!0,lookAt:!0},e)},dispose:St});class Ka extends Tt{constructor(){super();d(this,"MODULE",a.MODULETYPE.SPRITE)}}b.processor($a);class Xa extends l.Texture{constructor(e,t,s,i,r,o,c,u,h,p){super(e,t,s,i,r,o,c,u,h,p)}}const Ot={reg:new RegExp("wrapS|wrapT|format|encoding|anisotropy|magFilter|minFilter|mapping"),handler({target:n,key:e,value:t}){n[e]=t,n.needsUpdate=!0}};var Qa=v({configType:a.CONFIGTYPE.IMAGETEXTURE,commands:{set:{url({target:n,value:e,engine:t}){n.image=t.compilerManager.textureCompiler.getResource(e,HTMLImageElement),n.needsUpdate=!0},$reg:[Ot]}},create(n,e){const t=new Xa;return n.url&&(t.image=e.compilerManager.textureCompiler.getResource(n.url,HTMLImageElement)),_(n,t,{type:!0,url:!0}),t.needsUpdate=!0,t},dispose(n){n.dispose()}}),qa=v({configType:a.CONFIGTYPE.CANVASTEXTURE,commands:{set:{url({target:n,value:e,engine:t}){n.image=t.compilerManager.textureCompiler.getResource(e,HTMLCanvasElement),n.needsUpdate=!0},$reg:[Ot]}},create(n,e){const t=new l.CanvasTexture(e.compilerManager.textureCompiler.getResource(n.url,HTMLCanvasElement));return _(n,t,{type:!0,url:!0}),t.needsUpdate=!0,t},dispose(n){n.dispose()}});const De=[HTMLImageElement,HTMLVideoElement,HTMLCanvasElement],We=function({target:n,index:e,value:t,engine:s}){n.images[e]=s.compilerManager.textureCompiler.getResource(t,De),n.needsUpdate=!0};var Za=v({configType:a.CONFIGTYPE.CUBETEXTURE,commands:{set:{cube:{px({target:n,value:e,engine:t}){We({target:n,value:e,engine:t,index:0})},nx({target:n,value:e,engine:t}){We({target:n,value:e,engine:t,index:1})},py({target:n,value:e,engine:t}){We({target:n,value:e,engine:t,index:2})},ny({target:n,value:e,engine:t}){We({target:n,value:e,engine:t,index:3})},pz({target:n,value:e,engine:t}){We({target:n,value:e,engine:t,index:4})},nz({target:n,value:e,engine:t}){We({target:n,value:e,engine:t,index:5})}}}},create(n,e){const t=new l.CubeTexture,s=n.cube,i=e.compilerManager.textureCompiler,r=[i.getResource(s.px,De),i.getResource(s.nx,De),i.getResource(s.py,De),i.getResource(s.ny,De),i.getResource(s.pz,De),i.getResource(s.nz,De)];return t.image=r,_(n,t,{type:!0,cube:!0}),t.needsUpdate=!0,t},dispose(n){n.dispose()}});class Ja extends l.Texture{constructor(e,t,s,i,r,o,c,u,h){super(e,t,s,i,r,o,c,u,h);d(this,"isVideoTexture",!0);this.format=c!==void 0?c:l.RGBFormat,this.minFilter=o!==void 0?o:l.LinearFilter,this.magFilter=r!==void 0?r:l.LinearFilter,this.generateMipmaps=!1}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image,t="requestVideoFrameCallback"in e;t?this.needsUpdate=!0:t===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}var ec=v({configType:a.CONFIGTYPE.VIDEOTEXTURE,commands:{set:{url({target:n,value:e,engine:t}){n.image=t.compilerManager.textureCompiler.getResource(e,HTMLVideoElement),n.needsUpdate=!0},$reg:[Ot]}},create(n,e){const t=new Ja(document.createElement("video"));return n.url&&(t.image=e.compilerManager.textureCompiler.getResource(n.url,HTMLVideoElement)),_(n,t,{type:!0,url:!0}),t.needsUpdate=!0,t},dispose(n){n.dispose()}});class $e{constructor(e){d(this,"canvas");this.canvas=document.createElement("canvas");const t=window.devicePixelRatio;this.canvas.width=((e==null?void 0:e.width)||512)*t,this.canvas.height=((e==null?void 0:e.height)||512)*t,this.canvas.style.backgroundColor=(e==null?void 0:e.bgColor)||"rgb(255, 255, 255)";const s=this.canvas.getContext("2d");s&&s.scale(window.devicePixelRatio,window.devicePixelRatio)}get(){return this.canvas}getDom(){return this.canvas}clear(e=0,t=0,s,i){!s&&(s=this.canvas.width),!i&&(i=this.canvas.height);const r=this.canvas.getContext("2d");return r?(r.clearRect(e,t,s,i),this):(console.warn("you browser can not support canvas 2d"),this)}draw(e){const t=this.canvas.getContext("2d");return t?(e(t),this):(console.warn("you browser can not support canvas 2d"),this)}preview(e){const t=this.canvas;return t.style.position="fixed",t.style.top=(e==null?void 0:e.top)||"5%",t.style.left=(e==null?void 0:e.left)||"5%",t.style.right=(e==null?void 0:e.right)||"unset",t.style.bottom=(e==null?void 0:e.bottom)||"unset",(e==null?void 0:e.scale)&&(t.style.transform=`scale(${e.scale})`),document.body.appendChild(this.canvas),this}}class ns extends l.Texture{constructor(e){super();Object.keys(e).forEach(t=>{this[t]=e[t]})}}var tc=v({configType:a.CONFIGTYPE.LOADTEXTURE,commands:{set:{url({}){},$reg:[Ot]}},create(n,e){let t;const s=e.compilerManager.textureCompiler.getResource(n.url,l.Texture);if(s instanceof l.Texture)t=new ns(s);else{const i=new l.Texture(s);t=new ns(i)}return _(n,t,{type:!0,url:!0}),t.needsUpdate=!0,t},dispose(n){n.dispose()}});const st=class extends b{constructor(){super();d(this,"MODULE",a.MODULETYPE.TEXTURE)}getResource(e,t){const s=this.engine.resourceManager.resourceMap;if(!s.has(e))return console.warn(`engine resourceManager can not found this url: ${e}`),st.replaceImage;const i=s.get(e);if(Array.isArray(t)){for(const r of t)if(i instanceof r)return i;return console.warn(`this url mapping resource is not a texture image class: ${e}`,i),st.replaceImage}else return i instanceof t?i:(console.warn(`this url mapping resource is not a texture image class: ${e}`,i),st.replaceImage)}};let _t=st;d(_t,"replaceImage",new $e({width:512,height:512}).draw(e=>{e.translate(256,256),e.font="72px",e.fillStyle="white",e.fillText("\u6682\u65E0\u56FE\u7247",0,0)}).getDom()),b.processor(Qa),b.processor(qa),b.processor(Za),b.processor(ec),b.processor(tc);class nc{constructor(e){d(this,"cameraCompiler",new zo);d(this,"lightCompiler",new Ca);d(this,"geometryCompiler",new ma);d(this,"textureCompiler",new _t);d(this,"materialCompiler",new Ga);d(this,"rendererCompiler",new za);d(this,"sceneCompiler",new Wa);d(this,"controlsCompiler",new $o);d(this,"spriteCompiler",new Ka);d(this,"lineCompiler",new La);d(this,"meshCompiler",new Ua);d(this,"pointsCompiler",new Ba);d(this,"groupCompiler",new Ea);d(this,"css3DCompiler",new qo);d(this,"passCompiler",new Ya);d(this,"animationCompiler",new so);d(this,"compilerMap");e&&Object.keys(e).forEach(s=>{this[s]=e[s]});const t=new Map;Object.keys(this).forEach(s=>{const i=this[s];i instanceof b&&t.set(i.MODULE,i)}),this.compilerMap=t}support(e){this.compilerMap.forEach(s=>{s.useEngine(e)});const t=e.dataSupportManager;return t.textureDataSupport.addCompiler(this.textureCompiler),t.materialDataSupport.addCompiler(this.materialCompiler),t.geometryDataSupport.addCompiler(this.geometryCompiler),t.rendererDataSupport.addCompiler(this.rendererCompiler),t.controlsDataSupport.addCompiler(this.controlsCompiler),t.passDataSupport.addCompiler(this.passCompiler),t.cameraDataSupport.addCompiler(this.cameraCompiler),t.lightDataSupport.addCompiler(this.lightCompiler),t.spriteDataSupport.addCompiler(this.spriteCompiler),t.lineDataSupport.addCompiler(this.lineCompiler),t.meshDataSupport.addCompiler(this.meshCompiler),t.pointsDataSupport.addCompiler(this.pointsCompiler),t.css3DDataSupport.addCompiler(this.css3DCompiler),t.groupDataSupport.addCompiler(this.groupCompiler),t.sceneDataSupport.addCompiler(this.sceneCompiler),t.animationDataSupport.addCompiler(this.animationCompiler),this}getObjectSymbol(e){for(const t of this.compilerMap.values()){const s=t.getObjectSymbol(e);if(s)return s}return null}getObjectBySymbol(e){for(const t of this.compilerMap.values()){const s=t.getObjectBySymbol(e);if(s)return s}return null}getObject3D(e){for(const t of this.compilerMap.values())if(t instanceof Ae&&t.map.has(e))return t.map.get(e);return null}getGeometry(e){return this.geometryCompiler.map.get(e)||null}getMaterial(e){return this.materialCompiler.map.get(e)||null}getTexture(e){return this.textureCompiler.map.get(e)||null}dispose(){for(const e of this.compilerMap.values())e.dispose();return this.compilerMap.clear(),this}}const sc=function(n){if(this.compilerManager)return console.warn("engine has installed compilerManager plugin."),!1;if(!this.dataSupportManager)return console.warn("must install dataSupportManager before compilerManager plugin."),!1;if(!this.renderManager)return console.warn("must install renderManager before compilerManager plugin."),!1;const e=new nc;return this.compilerManager=e,this.getObjectSymbol=function(t){return this.compilerManager.getObjectSymbol(t)},this.getObjectBySymbol=function(t){return this.compilerManager.getObjectBySymbol(t)},this.addEventListener("dispose",()=>{this.compilerManager.dispose()}),this.completeSet.add(()=>{this.compilerManager.support(this)}),!0};class ss extends te{constructor(){super();d(this,"map",new Map)}generateSymbol(e){return Array.isArray(e)?e.join(" + "):e.shortcutKey.join(" + ")}watch(e){return e?rt.default.watch(void 0,e):rt.default.watch(),this}register(e){const t=this.generateSymbol(e);return this.map.has(t)?(console.warn(`KeyboardManager: shortcutKey already exist: ${t}. desp: ${this.map.get(t).desp}`),this):(rt.default.bind(t,e.keydown||null,e.keyup),this.map.set(t,e),this)}update(e){const t=this.generateSymbol(e);return this.map.has(t)?(this.cancel(e.shortcutKey),this.register(e),this):(console.warn("KeyboardManager: shortcutKey unregister then exec register function"),this.register(e),this)}cancel(e){const t=this.generateSymbol(e);if(this.map.has(t)){const s=this.map.get(t);rt.default.unbind(t,s.keydown||null,s.keyup),this.map.delete(t)}return this}checkRepeat(e){const t=this.generateSymbol(e);return this.map.has(t)}}const ic=function(n){if(this.keyboardManager)return console.warn("engine has installed keyboardManager plugin."),!1;const e=new ss;return this.keyboardManager=e,this.completeSet.add(()=>{if(this.transformControls)if(this.IS_ENGINESUPPORT){const t=this.dataSupportManager.controlsDataSupport.getData()[a.CONFIGTYPE.TRNASFORMCONTROLS];e.register({shortcutKey:["r"],desp:"tranformControls rotate mode",keyup:s=>{s==null||s.preventDefault(),t.mode="rotate"}}).register({shortcutKey:["t"],desp:"tranformControls translate mode",keyup:s=>{s==null||s.preventDefault(),t.mode="translate"}}).register({shortcutKey:["e"],desp:"tranformControls scale mode",keyup:s=>{s==null||s.preventDefault(),t.mode="scale"}}).register({shortcutKey:["x"],desp:"tranformControls switch x axis",keyup:s=>{s==null||s.preventDefault(),t.showX=!t.showX}}).register({shortcutKey:["y"],desp:"tranformControls switch y axis",keyup:s=>{s==null||s.preventDefault(),!(s==null?void 0:s.ctrlKey)&&(t.showY=!t.showY)}}).register({shortcutKey:["z"],desp:"tranformControls switch z axis",keyup:s=>{s==null||s.preventDefault(),!(s==null?void 0:s.ctrlKey)&&(t.showZ=!t.showZ)}}).register({shortcutKey:["space"],desp:"tranformControls switch coordinate space",keyup:s=>{s==null||s.preventDefault(),t.space=t.space==="local"?"world":"local"}}).register({shortcutKey:["shift"],desp:"tranformControls switch tranform numeric value",keyup:s=>{s==null||s.preventDefault(),t.snapAllow=!1},keydown:s=>{s==null||s.preventDefault(),s==null||s.preventRepeat(),t.snapAllow=!0}})}else{const t=this.transformControls;e.register({shortcutKey:["r"],desp:"tranformControls rotate mode",keyup:s=>{s==null||s.preventDefault(),t.mode="rotate"}}).register({shortcutKey:["t"],desp:"tranformControls translate mode",keyup:s=>{s==null||s.preventDefault(),t.mode="translate"}}).register({shortcutKey:["e"],desp:"tranformControls scale mode",keyup:s=>{s==null||s.preventDefault(),t.mode="scale"}}).register({shortcutKey:["x"],desp:"tranformControls switch x axis",keyup:s=>{s==null||s.preventDefault(),t.showX=!t.showX}}).register({shortcutKey:["y"],desp:"tranformControls switch y axis",keyup:s=>{s==null||s.preventDefault(),!(s==null?void 0:s.ctrlKey)&&(t.showY=!t.showY)}}).register({shortcutKey:["z"],desp:"tranformControls switch z axis",keyup:s=>{s==null||s.preventDefault(),!(s==null?void 0:s.ctrlKey)&&(t.showZ=!t.showZ)}}).register({shortcutKey:["space"],desp:"tranformControls switch coordinate space",keyup:s=>{s==null||s.preventDefault(),t.space=t.space==="local"?"world":"local"}}).register({shortcutKey:["shift"],desp:"tranformControls switch tranform numeric value",keyup:s=>{s==null||s.preventDefault(),t.translationSnap=null,t.rotationSnap=null,t.scaleSnap=null},keydown:s=>{s==null||s.preventDefault(),s==null||s.preventRepeat(),t.translationSnap=5,t.rotationSnap=Math.PI/180*10,t.scaleSnap=.1}})}}),!0},rc=function(n={}){if(!this.scene)return console.error("must install some scene plugin before BasicViewpoint plugin."),!1;const e=new l.AxesHelper(n.length||500);return e.matrixAutoUpdate=!1,e.raycast=()=>{},this.scene.add(e),this.setAxesHelper=function(t){return t.show?this.scene.add(e):this.scene.remove(e),this},this.addEventListener("setScene",t=>{t.scene.add(e)}),!0},oc=function(n={}){if(!this.scene)return console.error("must install some scene before BasicViewpoint plugin."),!1;const e=new l.GridHelper(n.range||500,n.spacing||50,n.axesColor||"rgb(130, 130, 130)",n.cellColor||"rgb(70, 70, 70)");if(n.opacity!==1){const t=e.material;t.transparent=!0,t.opacity=n.opacity||.5,t.needsUpdate=!0}return e.matrixAutoUpdate=!1,e.raycast=()=>{},this.scene.add(e),this.setGridHelper=function(t){return t.show?this.scene.add(e):this.scene.remove(e),this},this.addEventListener("setScene",t=>{t.scene.add(e)}),this.completeSet.add(()=>{this.setViewpoint&&this.addEventListener("setViewpoint",t=>{const s=t.viewpoint;s===a.VIEWPOINT.DEFAULT||s===a.VIEWPOINT.TOP||s===a.VIEWPOINT.BOTTOM?e.rotation.set(0,0,0):s===a.VIEWPOINT.RIGHT||s===a.VIEWPOINT.LEFT?e.rotation.set(0,0,Math.PI/2):(s===a.VIEWPOINT.FRONT||s===a.VIEWPOINT.BACK)&&e.rotation.set(Math.PI/2,0,0),e.updateMatrix(),e.updateMatrixWorld()})}),!0};a.DISPLAYMODE=void 0,function(n){n.GEOMETRY="geometry",n.MATERIAL="material",n.LIGHT="light",n.ENV="env"}(a.DISPLAYMODE||(a.DISPLAYMODE={}));const ac=function(n={}){if(!this.webGLRenderer)return console.error("must install some renderer before DisplayModel plugin."),!1;if(!this.scene)return console.error("must install some scene before DisplayModel plugin."),!1;!n.overrideColor&&(n.overrideColor="rgb(250, 250, 250)"),!n.defaultAmbientLightSetting&&(n.defaultAmbientLightSetting={}),!n.defaultAmbientLightSetting.color&&(n.defaultAmbientLightSetting.color="rgb(255, 255, 255)"),!n.defaultAmbientLightSetting.intensity&&(n.defaultAmbientLightSetting.intensity=.5);const e=new l.AmbientLight(n.defaultAmbientLightSetting.color,n.defaultAmbientLightSetting.intensity);e.matrixAutoUpdate=!1,!n.defaultDirectionalLightSetting&&(n.defaultDirectionalLightSetting={}),!n.defaultDirectionalLightSetting.color&&(n.defaultDirectionalLightSetting.color="rgb(255, 255, 255)"),!n.defaultDirectionalLightSetting.intensity&&(n.defaultDirectionalLightSetting.intensity=.5),!n.defaultDirectionalLightSetting.position&&(n.defaultDirectionalLightSetting.position={x:-100,y:100,z:100});const t=new l.DirectionalLight(n.defaultDirectionalLightSetting.color,n.defaultDirectionalLightSetting.intensity);t.castShadow=!1,t.position.set(n.defaultDirectionalLightSetting.position.x,n.defaultDirectionalLightSetting.position.y,n.defaultDirectionalLightSetting.position.z),t.updateMatrix(),t.updateMatrixWorld(),t.matrixAutoUpdate=!1,!n.mode&&(n.mode=a.DISPLAYMODE.ENV),this.displayMode=n.mode;const s=new l.MeshLambertMaterial({color:n.overrideColor}),i=new l.LineBasicMaterial({color:n.overrideColor}),r=new l.PointsMaterial({color:n.overrideColor,size:5,sizeAttenuation:!1}),o=new l.SpriteMaterial({color:n.overrideColor}),c=new WeakMap,u=new Set,h=new Set,p=new Set,f=new Set,g=new Set;let E,S;const O={Object3D:!0,Group:!0};this.scene.addEventListener("afterAdd",M=>{const G=this.displayMode,P=M.objects;for(const I of P)if(!O[I.type])if(I instanceof l.Mesh&&I.type==="Mesh")h.add(I),G===a.DISPLAYMODE.GEOMETRY&&(c.set(I,I.material),I.material=s);else if(I instanceof l.Line&&I.type.includes("Line"))p.add(I),G===a.DISPLAYMODE.GEOMETRY&&(c.set(I,I.material),I.material=i);else if(I instanceof l.Light&&I.type.includes("Light")){if(I===e||I===t)continue;u.has(I)||u.add(I),G!==a.DISPLAYMODE.ENV&&G!==a.DISPLAYMODE.LIGHT&&this.scene.remove(I)}else I instanceof l.Points&&I.type==="Points"?(f.add(I),G===a.DISPLAYMODE.GEOMETRY&&(c.set(I,I.material),I.material=r)):I instanceof l.Sprite&&I.type==="Sprite"&&(g.add(I),G===a.DISPLAYMODE.GEOMETRY&&(c.set(I,I.material),I.material=o))}),this.scene.addEventListener("afterRemove",M=>{const G=M.objects;for(const P of G)if(!O[P.type])if(P instanceof l.Mesh&&P.type==="Mesh")h.delete(P),c.has(P)&&c.delete(P);else if(P instanceof l.Line&&P.type.includes("Line"))p.delete(P),c.has(P)&&c.delete(P);else if(P instanceof l.Light&&P.type.includes("Light")){if(P===e||P===t)continue;u.delete(P)}else P instanceof l.Points&&P.type==="Points"?(f.delete(P),c.has(P)&&c.delete(P)):P instanceof l.Sprite&&P.type==="Sprite"&&(g.delete(P),c.has(P)&&c.delete(P))});const y=()=>{for(const M of h)M.material!==s&&(c.set(M,M.material),M.material=s);for(const M of p)M.material!==i&&(c.set(M,M.material),M.material=i);for(const M of f)M.material!==r&&(c.set(M,M.material),M.material=r);for(const M of g)M.material!==o&&(c.set(M,M.material),M.material=o)},T=()=>{h.forEach(M=>{c.has(M)&&(M.material=c.get(M),c.delete(M))}),p.forEach(M=>{c.has(M)&&(M.material=c.get(M),c.delete(M))}),f.forEach(M=>{c.has(M)&&(M.material=c.get(M),c.delete(M))}),g.forEach(M=>{c.has(M)&&(M.material=c.get(M),c.delete(M))})},L=()=>{u.forEach(M=>{M.visible=!1}),this.scene.add(e),this.scene.add(t)},C=()=>{u.forEach(M=>{M.visible=!0}),this.scene.remove(e),this.scene.remove(t)},w=()=>{this.scene.background instanceof l.Texture&&(E=this.scene.background,this.scene.background=null),this.scene.environment instanceof l.Texture&&(S=this.scene.environment,this.scene.environment=null)},x=()=>{E&&(this.scene.background=E,E=void 0),S&&(this.scene.environment=S,S=void 0)};return this.setDisplayMode=function(M){return this.displayMode=M||a.DISPLAYMODE.ENV,M===a.DISPLAYMODE.GEOMETRY?(y(),w(),L()):M===a.DISPLAYMODE.MATERIAL?(T(),w(),L()):M===a.DISPLAYMODE.LIGHT?(T(),w(),C()):M===a.DISPLAYMODE.ENV?(T(),x(),C()):console.warn(`displayMode plugin can not set this mode: ${M}`),this},this.completeSet.add(()=>{this.objectHelperManager&&this.objectHelperManager.addFilteredObject(t)}),!0},Ce=()=>new l.LineBasicMaterial({color:"rgb(255, 255, 255)"});class kt extends l.LineSegments{constructor(e){super();d(this,"shape");d(this,"target");d(this,"type","CameraHelper");d(this,"cachaData");const t=new l.BufferGeometry,s=[0,0,0,-1,1,-1,0,0,0,-1,1,1,0,0,0,-1,-1,-1,0,0,0,-1,-1,1,-1,-1,1,-1,-1,-1,-1,-1,-1,-1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,-1,1,0,0,0,0,1,1,0,0,0,0,1,-1,0,0,0,0,-1,-1,0,0,0,0,-1,1,0,1,1,0,1,-1,0,1,-1,0,-1,-1,0,-1,-1,0,-1,1,0,-1,1,0,1,1,0,-1,1,2,-1,1,0,1,-1,2,1,-1,0,-1,-1,2,-1,-1,0,1,1,2,1,1,2,1,1,2,-1,1,2,-1,1,2,-1,-1,2,-1,-1,2,1,-1,2,1,-1,2,1,1];t.setAttribute("position",new l.Float32BufferAttribute(s,3)),t.rotateY(-90*Math.PI/180),t.computeBoundingBox();const i=new l.CameraHelper(e);i.matrix=new l.Matrix4,i.matrixAutoUpdate=!0,i.raycast=()=>{},this.add(i),this.shape=i,this.geometry=t,this.material=Ce(),this.target=e,this.matrixAutoUpdate=!1,this.matrix=e.matrix,e instanceof l.PerspectiveCamera?this.cachaData={fov:e.fov,aspect:e.aspect,near:e.near,far:e.far}:e instanceof l.OrthographicCamera?this.cachaData={left:e.left,right:e.right,top:e.top,bottom:e.bottom,near:e.near,far:e.far}:this.cachaData={},this.onBeforeRender=()=>{let r=!1;const o=this.cachaData;Object.keys(o).forEach(c=>{o[c]!==e[c]&&(o[c]=e[c],r=!0)}),r&&this.shape.update()}}raycast(e,t){const s=this.matrixWorld,i=this.geometry.boundingBox.clone();if(i.applyMatrix4(s),e.ray.intersectsBox(i)){const r=this.target;t.push({distance:e.ray.origin.distanceTo(r.position),object:r,point:r.position})}}}class is extends l.LineSegments{constructor(e){super();d(this,"sphere");d(this,"target");d(this,"shape");d(this,"type","VisDirectionalLightHelper");d(this,"cacheColor");d(this,"cacheVector3");this.geometry=new l.BufferGeometry;const t=[-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,0,0,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,-.707,0,-.707,.707,0,.707,.707,0,-.707,-.707,0,.707];this.geometry.setAttribute("position",new l.Float32BufferAttribute(t,3)),this.material=Ce(),this.geometry.boundingSphere;const s=new l.Color().copy(e.color).multiplyScalar(e.intensity),i=new l.PlaneBufferGeometry(20,20);i.dispose();const r=new l.LineSegments(new l.EdgesGeometry(i),new l.LineBasicMaterial({color:s}));r.raycast=()=>{},this.shape=r,this.target=e,this.sphere=new l.Sphere(new l.Vector3(0,0,0),1),this.cacheColor=e.color.getHex(),this.cacheVector3=new l.Vector3,this.add(this.shape),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.onBeforeRender=()=>{const o=this.target,c=this.shape;o.color.getHex()!==this.cacheColor&&(c.material.color.copy(o.color).multiplyScalar(o.intensity),this.cacheColor=o.color.getHex()),c.lookAt(o.target.position)}}raycast(e,t){const s=this.target,i=s.matrixWorld,r=this.sphere;r.set(this.cacheVector3.set(0,0,0),1),r.applyMatrix4(i),e.ray.intersectsSphere(r)&&t.push({distance:e.ray.origin.distanceTo(s.position),object:s,point:s.position})}}class rs extends l.LineSegments{constructor(e){super();d(this,"sphere");d(this,"target");d(this,"shape");d(this,"type","VisPointLightHelper");d(this,"cacheColor");d(this,"cacheDistance");d(this,"cacheVector3");this.geometry=new l.BufferGeometry;const t=[-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,0,0,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,-.707,0,-.707,.707,0,.707,.707,0,-.707,-.707,0,.707];this.geometry.setAttribute("position",new l.Float32BufferAttribute(t,3)),this.material=Ce(),this.geometry.boundingSphere;const s=new l.Color().copy(e.color).multiplyScalar(e.intensity),i=new l.Mesh(new l.OctahedronBufferGeometry(e.distance,0),new l.MeshBasicMaterial({color:s,wireframe:!0}));i.raycast=()=>{},i.matrixAutoUpdate=!1,this.shape=i,this.target=e,this.sphere=new l.Sphere(new l.Vector3(0,0,0),1),this.cacheColor=e.color.getHex(),this.cacheDistance=e.distance,this.cacheVector3=new l.Vector3,this.add(this.shape),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.onBeforeRender=()=>{const r=this.target,o=this.shape;r.distance!==this.cacheDistance&&(o.geometry.dispose(),o.geometry=new l.OctahedronBufferGeometry(r.distance,0),this.cacheDistance=r.distance),r.color.getHex()!==this.cacheColor&&(o.material.color.copy(r.color).multiplyScalar(r.intensity),this.cacheColor=r.color.getHex())}}raycast(e,t){const s=this.target,i=s.matrixWorld,r=this.sphere;r.set(this.cacheVector3.set(0,0,0),1),r.applyMatrix4(i),e.ray.intersectsSphere(r)&&t.push({distance:e.ray.origin.distanceTo(s.position),object:s,point:s.position})}}class os extends l.LineSegments{constructor(e){super();d(this,"sphere");d(this,"target");d(this,"shape");d(this,"type","VisSpotLightHelper");d(this,"cacheVector3");d(this,"cacheColor");d(this,"cacheAngle");d(this,"cacheDistance");this.geometry=new l.BufferGeometry;const t=[-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,0,0,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,-.707,0,-.707,.707,0,.707,.707,0,-.707,-.707,0,.707];this.geometry.setAttribute("position",new l.Float32BufferAttribute(t,3)),this.material=Ce(),this.geometry.boundingSphere;const s=new l.BufferGeometry,i=[0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let h=0,p=1,f=32;h<f;h++,p++){const g=h/f*Math.PI*2,E=p/f*Math.PI*2;i.push(Math.cos(g),Math.sin(g),1,Math.cos(E),Math.sin(E),1)}s.setAttribute("position",new l.Float32BufferAttribute(i,3));const r=Ce(),o=new l.LineSegments(s,r);o.material.color.copy(e.color).multiplyScalar(e.intensity);const c=e.distance?e.distance:1e3,u=c*Math.tan(e.angle);o.scale.set(u,u,c),o.raycast=()=>{},this.add(o),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.target=e,this.shape=o,this.sphere=new l.Sphere(new l.Vector3(0,0,0),1),this.cacheColor=e.color.getHex(),this.cacheDistance=e.distance,this.cacheAngle=e.angle,this.cacheVector3=new l.Vector3,this.onBeforeRender=()=>{const h=this.target,p=this.shape;let f=!1;if(h.distance!==this.cacheDistance&&(this.cacheDistance=h.distance,p.scale.z=h.distance,f=!0),h.angle!==this.cacheAngle&&(this.cacheAngle=h.angle,f=!0),f){const g=h.distance*Math.tan(h.angle);p.scale.set(g,g,h.distance)}h.color.getHex()!==this.cacheColor&&(p.material.color.copy(h.color).multiplyScalar(h.intensity),this.cacheColor=h.color.getHex()),p.lookAt(h.target.position)}}raycast(e,t){const s=this.target,i=s.matrixWorld,r=this.sphere;r.set(this.cacheVector3.set(0,0,0),1),r.applyMatrix4(i),e.ray.intersectsSphere(r)&&t.push({distance:e.ray.origin.distanceTo(s.position),object:s,point:s.position})}}class cc extends l.LineSegments{constructor(e){super();d(this,"target");d(this,"type","VisCSS3DHelper");const s=e.element.getBoundingClientRect(),i=s.width,r=s.height;this.geometry=new l.EdgesGeometry(new l.PlaneBufferGeometry(i,r)),this.geometry.computeBoundingBox(),this.material=Ce(),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.target=e}raycast(e,t){const s=this.target,i=s.matrixWorld,r=this.geometry.boundingBox.clone();r.applyMatrix4(i),e.ray.intersectsBox(r)&&t.push({distance:e.ray.origin.distanceTo(s.position),object:s,point:s.position})}}class lc extends l.LineSegments{constructor(e){super();d(this,"target");d(this,"type","VisCSS3DPlaneHelper");d(this,"observer");this.geometry=new l.EdgesGeometry(new l.PlaneBufferGeometry(e.width,e.height)),this.geometry.computeBoundingBox(),this.material=Ce(),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.target=e;const t=new MutationObserver(()=>{this.geometry.dispose(),this.geometry=new l.EdgesGeometry(new l.PlaneBufferGeometry(e.width,e.height)),this.geometry.computeBoundingBox()});t.observe(e.element,{attributeFilter:["style"]}),this.observer=t}dispose(){this.observer.disconnect()}}const qt=class extends l.Sprite{constructor(e){super();d(this,"target");d(this,"type","VisGroupHelper");this.target=e,this.geometry.computeBoundingBox(),this.material=new l.SpriteMaterial({map:qt.colorTexture}),this.material.depthTest=!1,this.material.depthWrite=!1,this.scale.set(5,5,5);const t=this.updateMatrixWorld.bind(this);this.updateMatrixWorld=s=>{const i=this.position,r=this.target.position;i.x=r.x,i.y=r.y,i.z=r.z,t(s)}}raycast(e,t){const s=this.matrixWorld,i=this.geometry.boundingBox.clone();if(i.applyMatrix4(s),e.ray.intersectsBox(i)){const r=this.target;t.push({distance:e.ray.origin.distanceTo(r.position),object:r,point:r.position})}}};let Ct=qt;d(Ct,"colorTexture",new l.CanvasTexture(new $e({width:512,height:512}).draw(e=>{e.beginPath(),e.fillStyle="rgba(0, 0, 0, 0)",e.fillRect(0,0,512,512),e.closePath(),e.translate(256,200),e.beginPath(),e.fillStyle="yellow",e.fillRect(-200,0,400,200),e.closePath(),e.beginPath(),e.fillStyle="yellow",e.fillRect(-200,-70,200,70),e.closePath()}).get()));const Zt=class extends l.Points{constructor(e){super();d(this,"target");d(this,"cachaGeometryUUid");d(this,"type","VisLineHelper");this.target=e,this.geometry.dispose(),this.geometry.copy(e.geometry),this.cachaGeometryUUid=e.geometry.uuid,this.material=new l.PointsMaterial({color:"rgb(255, 255, 255)",alphaMap:Zt.alphaTexture,transparent:!0,size:5,sizeAttenuation:!1}),this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.matrix=e.matrix,this.matrixWorld=e.matrixWorld,this.renderOrder=-1,this.raycast=()=>{},this.onBeforeRender=()=>{const t=this.target;t.geometry.uuid!==this.cachaGeometryUUid&&(this.geometry.dispose(),this.geometry=t.geometry.clone(),this.cachaGeometryUUid=t.geometry.uuid)}}};let zt=Zt;d(zt,"alphaTexture",new l.CanvasTexture(new $e({width:512,height:512,bgColor:"rgb(0, 0, 0)"}).draw(e=>{e.beginPath(),e.fillStyle="rgb(255, 255, 255)",e.arc(256,256,200,0,Math.PI*2),e.fill(),e.closePath()}).getDom()));class uc extends l.LineSegments{constructor(e){super();d(this,"target");d(this,"type","VisMeshHelper");d(this,"cachaGeometryUUid");const t=1;this.target=e,this.geometry=new l.EdgesGeometry(e.geometry,t),this.cachaGeometryUUid=e.geometry.uuid,this.material=Ce(),this.raycast=()=>{},this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.matrix=e.matrix,this.matrixWorld=e.matrixWorld,this.onBeforeRender=()=>{const s=this.target;s.geometry.uuid!==this.cachaGeometryUUid&&(this.geometry.dispose(),this.geometry=new l.EdgesGeometry(s.geometry,t),this.cachaGeometryUUid=s.geometry.uuid)}}}const Jt=class extends l.Points{constructor(e){super();d(this,"target");d(this,"type","VisPointsHelper");this.target=e,this.geometry.dispose(),this.geometry.copy(e.geometry),this.material.dispose(),this.material=new l.PointsMaterial({color:"rgb(255, 255, 255)",alphaMap:Jt.alphaTexture,transparent:!0});const t=Array.isArray(e.material)?e.material[0]:e.material;t instanceof l.PointsMaterial&&(this.material.size=t.size,this.material.sizeAttenuation=t.sizeAttenuation),this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.matrix=e.matrix,this.matrixWorld=e.matrixWorld,this.raycast=()=>{}}};let Vt=Jt;d(Vt,"alphaTexture",new l.CanvasTexture(new $e({width:512,height:512,bgColor:"rgb(0, 0, 0)"}).draw(e=>{e.beginPath(),e.strokeStyle="rgb(255, 255, 255)",e.lineWidth=4,e.strokeRect(0,0,512,512),e.closePath()}).get()));const en=class extends l.Sprite{constructor(e){super();d(this,"target");d(this,"type","VisSpriteHelper");this.target=e,this.material.dispose(),this.material=new l.SpriteMaterial({color:"rgb(255, 255, 255)",alphaMap:en.alphaTexture,transparent:!0,depthWrite:!1}),this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.matrix=e.matrix,this.matrixWorld=e.matrixWorld,this.raycast=()=>{}}};let Wt=en;d(Wt,"alphaTexture",new l.CanvasTexture(new $e({width:512,height:512,bgColor:"rgb(0, 0, 0)"}).draw(e=>{e.beginPath(),e.strokeStyle="rgb(255, 255, 255)",e.lineWidth=4,e.strokeRect(0,0,512,512),e.closePath()}).get()));class dc extends te{constructor(e={}){super();d(this,"helperGenerator",{[a.CONFIGTYPE.POINTLIGHT]:rs,[a.CONFIGTYPE.SPOTLIGHT]:os,[a.CONFIGTYPE.DIRECTIONALLIGHT]:is,[a.CONFIGTYPE.PERSPECTIVECAMERA]:kt,[a.CONFIGTYPE.ORTHOGRAPHICCAMERA]:kt,[a.CONFIGTYPE.MESH]:uc,[a.CONFIGTYPE.GROUP]:Ct,[a.CONFIGTYPE.SPRITE]:Wt,[a.CONFIGTYPE.POINTS]:Vt,[a.CONFIGTYPE.LINE]:zt,[a.CONFIGTYPE.CSS3DOBJECT]:cc,[a.CONFIGTYPE.CSS3DPLANE]:lc});d(this,"helperFilter",{AmbientLight:!0,Object3D:!0,TransformControls:!0,Scene:!0});d(this,"objectFilter",new Set);d(this,"objectHelperMap",new Map);e.helperGenerator&&(this.helperGenerator=Object.assign(this.helperGenerator,e.helperGenerator)),e.helperFilter&&(this.helperFilter=Object.assign(this.helperFilter,e.helperFilter)),e.objectFilter&&(this.objectFilter=new Set(e.objectFilter.concat(Array.from(this.objectFilter))))}addFilteredObject(...e){for(const t of e)this.objectFilter.add(t);return this}addObjectHelper(e){if(this.objectFilter.has(e)||this.objectHelperMap.has(e)||this.helperFilter[e.type]||e.type.toLocaleLowerCase().includes("helper"))return null;if(!this.helperGenerator[e.type])return console.warn(`object helper can not support this type object: '${e.type}'`),null;const t=new this.helperGenerator[e.type](e);return this.objectHelperMap.set(e,t),t}disposeObjectHelper(e){if(this.objectFilter.has(e)||this.helperFilter[e.type]||e.type.toLocaleLowerCase().includes("helper"))return null;if(!this.objectHelperMap.has(e))return console.warn("object helper manager can not found this object`s helper: ",e),null;const t=this.objectHelperMap.get(e);return t.geometry&&t.geometry.dispose(),t.material&&(t.material instanceof l.Material?t.material.dispose():t.material.forEach(s=>{s.dispose()})),this.objectHelperMap.delete(e),t}}const hc=function(n={}){if(!this.scene)return console.error("must install some scene plugin before ObjectHelper plugin."),!1;n.interact===void 0&&(n.interact=!0),n.interact&&(this.eventManager||(console.warn("must install eventManager plugin that can use interact function."),n.interact=!1));const e=new dc,t=new Map,s=new Map,i=new Map,r=e.objectHelperMap;this.objectHelperManager=e,!n.activeColor&&(n.activeColor="rgb(230, 20, 240)"),!n.hoverColor&&(n.hoverColor="rgb(255, 158, 240)"),!n.defaultColor&&(n.defaultColor="rgb(255, 255, 255)"),!n.selectedColor&&(n.selectedColor=n.activeColor);const o=new l.Color(n.defaultColor).getHex(),c=new l.Color(n.activeColor).getHex(),u=new l.Color(n.hoverColor).getHex(),h=new l.Color(n.selectedColor).getHex(),p=new WeakSet,f=O=>{const y=O.objects;for(const T of y){const L=e.addObjectHelper(T);if(!!L&&(L.material.color.setHex(o),this.scene.add(L),n.interact)){const C=()=>{var M;((M=this.transformControls)==null?void 0:M.dragging)||this.selectionBox&&this.selectionBox.has(T)||L.material.color.setHex(u)},w=()=>{var M;((M=this.transformControls)==null?void 0:M.dragging)||this.selectionBox&&this.selectionBox.has(T)||L.material.color.setHex(o)},x=()=>{var M;((M=this.transformControls)==null?void 0:M.dragging)||this.selectionBox&&this.selectionBox.has(T)||L.material.color.setHex(c)};T.addEventListener("pointerenter",C),T.addEventListener("pointerleave",w),T.addEventListener("click",x),t.set(T,C),s.set(T,w),i.set(T,x)}}},g=O=>{const y=O.objects;for(const T of y){const L=e.disposeObjectHelper(T);!L||(this.scene.remove(L),n.interact&&(T.removeEventListener("pointerenter",t.get(T)),T.removeEventListener("pointerleave",s.get(T)),T.removeEventListener("click",i.get(T)),t.delete(T),s.delete(T),i.delete(T)))}},E=O=>{p.has(O)||(O.traverse(y=>{const T=e.addObjectHelper(y);T&&O.add(T)}),p.add(O))};this.scene.addEventListener("afterAdd",f),this.scene.addEventListener("afterRemove",g),this.setObjectHelper=function(O){return O.show?this.scene.traverse(y=>{r.has(y)&&this.scene.add(r.get(y))}):this.scene.traverse(y=>{r.has(y)&&this.scene.remove(r.get(y))}),this},this.addEventListener("setScene",O=>{const y=O.scene;!p.has(y)&&E(y),y.hasEventListener("afterAdd",f)||y.addEventListener("afterAdd",f),y.hasEventListener("afterRemove",g)||y.addEventListener("afterRemove",g)});const S=new Set;return this.completeSet.add(()=>{this.selectionBox&&this.addEventListener("selected",O=>{S.forEach(y=>{y.material.color.setHex(o)}),S.clear();for(const y of O.objects)if(r.has(y)){const T=r.get(y);T.material.color.setHex(h),S.add(T)}})}),!0},pc=function(n={}){if(this.selectionBox)return console.warn("engine has installed selection plugin."),!1;if(!this.eventManager)return console.warn("must install eventManager plugin before Selection plugin."),!1;this.selectionBox=new Set;const e=()=>{const t=[];this.IS_ENGINESUPPORT&&this.selectionBox.forEach(s=>{const i=this.compilerManager.getObjectSymbol(s);i?t.push(i):console.warn("selection plugin can not font vid in compilerManager.",s)}),this.dispatchEvent({type:"selected",objects:[...this.selectionBox],objectSymbols:t})};return this.setSelectionBox=function(t){this.selectionBox.clear();for(const s of t.objects)this.selectionBox.add(s);return e(),this},this.eventManager.addEventListener("click",t=>{var i,r,o;if(this.transing){this.transing=!1;return}const s=t.intersections;if(t.ctrlKey||this.selectionBox.clear(),this.eventManager.penetrate)for(const c of s){if(t.ctrlKey&&((i=this.selectionBox)==null?void 0:i.has(c.object))){this.selectionBox.delete(c.object);continue}this.selectionBox.add(c.object)}else if(s.length){const c=s[0].object;if(t.ctrlKey&&((r=this.selectionBox)==null?void 0:r.has(c))){this.selectionBox.delete(c);return}(o=this.selectionBox)==null||o.add(c)}e()}),!0},fc=function(n={}){if(this.css3DRenderer)return console.warn("this has installed css3DRenderer plugin."),!1;this.css3DRenderer=new we.CSS3DRenderer;const e=this.css3DRenderer.domElement;if(e.classList.add("vis-css3D"),e.style.position="absolute",e.style.top="0",e.style.left="0",this.addEventListener("setDom",t=>{t.dom.appendChild(this.css3DRenderer.domElement)}),this.addEventListener("setSize",t=>{this.css3DRenderer.setSize(t.width,t.height)}),this.addEventListener("setScene",t=>{t.oldScene.traverse(i=>{i instanceof we.CSS3DObject&&(i.element.style.display="none")})}),this.renderManager)this.renderManager.removeEventListener("render",this.render),this.renderManager.addEventListener("render",t=>{this.css3DRenderer.render(this.scene,this.camera)});else if(this.webGLRenderer){const t=this.render.bind(this);this.render=function(){return t(),this.webGLRenderer.render(this.scene,this.camera),this}}else this.render=function(){return this.webGLRenderer.render(this.scene,this.camera),this};return!0};a.ENGINEPLUGIN=void 0,function(n){n.WEBGLRENDERER="WebGLRenderer",n.CSS3DRENDERER="CSS3DRenderer",n.SCENE="Scene",n.MODELINGSCENE="ModelingScene",n.RENDERMANAGER="RenderManager",n.ORBITCONTROLS="OrbitControls",n.STATS="Stats",n.EFFECTCOMPOSER="EffectComposer",n.POINTERMANAGER="PointerManager",n.EVENTMANAGER="EventManager",n.TRANSFORMCONTROLS="TransformControls",n.LOADERMANAGER="LoaderManager",n.RESOURCEMANAGER="ResourceManager",n.DATASUPPORTMANAGER="DataSupportManager",n.COMPILERMANAGER="CompilerManager",n.KEYBOARDMANAGER="KeyboardManager",n.AXESHELPER="AxesHelper",n.GRIDHELPER="GridHelper",n.VIEWPOINT="Viewpoint",n.DISPLAYMODE="DisplayMode",n.OBJECTHELPER="ObjectHelper",n.SELECTION="Selection"}(a.ENGINEPLUGIN||(a.ENGINEPLUGIN={}));const be=class extends te{constructor(){super();d(this,"completeSet");d(this,"camera",new l.PerspectiveCamera);d(this,"scene",new l.Scene);d(this,"IS_ENGINESUPPORT",!1);d(this,"dom");d(this,"webGLRenderer");d(this,"css3DRenderer");d(this,"orbitControls");d(this,"transformControls");d(this,"effectComposer");d(this,"renderManager");d(this,"pointerManager");d(this,"eventManager");d(this,"loaderManager");d(this,"resourceManager");d(this,"dataSupportManager");d(this,"compilerManager");d(this,"keyboardManager");d(this,"objectHelperManager");d(this,"transing");d(this,"stats");d(this,"displayMode");d(this,"selectionBox");d(this,"getScreenshot");d(this,"setStats");d(this,"setTransformControls");d(this,"setViewpoint");d(this,"setDisplayMode");d(this,"setAxesHelper");d(this,"setGridHelper");d(this,"setObjectHelper");d(this,"setSelectionBox");d(this,"loadResources");d(this,"loadResourcesAsync");d(this,"registerResources");d(this,"toJSON");d(this,"exportConfig");d(this,"applyConfig");d(this,"reactiveConfig");d(this,"getConfigBySymbol");d(this,"removeConfigBySymbol");d(this,"getObjectSymbol");d(this,"getObjectBySymbol");d(this,"play");d(this,"stop");d(this,"render");this.completeSet=new Set,this.render=function(){return console.warn("can not install some plugin"),this},this.camera.position.set(50,50,50),this.addEventListener("setSize",e=>{this.camera.aspect=e.width/e.height,this.camera.updateProjectionMatrix()})}optimizeMemory(){Object.keys(this).forEach(e=>{this[e]===void 0&&delete this[e]})}install(e,t){return be.pluginHandler.has(e)?be.pluginHandler.get(e).call(this,t):console.error(`engine can not support ${e} plugin.`),this}complete(){return this.completeSet.forEach(e=>{e(this)}),this.completeSet.clear(),this}dispose(){return this.dispatchEvent({type:"dispose"}),this}setDom(e){return this.dom=e,this.dispatchEvent({type:"setDom",dom:e}),this}setSize(e,t){var s,i;return e&&e<=0||t&&t<=0?(console.warn(`you must be input width and height bigger then zero, width: ${e}, height: ${t}`),this):(!e&&(e=((s=this.dom)==null?void 0:s.offsetWidth)||window.innerWidth),!t&&(t=((i=this.dom)==null?void 0:i.offsetHeight)||window.innerHeight),this.dispatchEvent({type:"setSize",width:e,height:t}),this)}setCamera(e,t){if(typeof e=="object"&&e instanceof l.Camera)this.camera=e,this.dispatchEvent({type:"setCamera",camera:e,options:Object.assign({orbitControls:!0,transformControls:!0},t||{})});else if(this.IS_ENGINESUPPORT){const s=this.compilerManager.getObjectBySymbol(e);s?(this.camera=s,this.dispatchEvent({type:"setCamera",camera:s,options:Object.assign({orbitControls:!0,transformControls:!0},t||{})})):console.warn(`can not found camera in compilerManager: ${e}`)}else console.warn("engine is not a Engine support but use symbol to found camera.");return this}setScene(e){if(typeof e=="object"&&e instanceof l.Scene)this.dispatchEvent({type:"setScene",scene:e,oldScene:this.scene}),this.scene=e;else if(this.IS_ENGINESUPPORT){const t=this.compilerManager.getObjectBySymbol(e);t?(this.dispatchEvent({type:"setScene",scene:t,oldScene:this.scene}),this.scene=t):console.warn(`can not found scene in compilerManager: ${e}`)}else console.warn("engine is not a Engine support but use symbol to found scene.");return this}};let D=be;d(D,"pluginHandler",new Map),d(D,"register",function(e,t){return be.pluginHandler&&be.pluginHandler.set(e,t),be}),d(D,"dispose",function(){be.pluginHandler=void 0}),D.register(a.ENGINEPLUGIN.WEBGLRENDERER,Fs),D.register(a.ENGINEPLUGIN.CSS3DRENDERER,fc),D.register(a.ENGINEPLUGIN.EFFECTCOMPOSER,As),D.register(a.ENGINEPLUGIN.RENDERMANAGER,Ls),D.register(a.ENGINEPLUGIN.POINTERMANAGER,Gs),D.register(a.ENGINEPLUGIN.EVENTMANAGER,Us),D.register(a.ENGINEPLUGIN.LOADERMANAGER,fi),D.register(a.ENGINEPLUGIN.RESOURCEMANAGER,wr),D.register(a.ENGINEPLUGIN.DATASUPPORTMANAGER,Qr),D.register(a.ENGINEPLUGIN.COMPILERMANAGER,sc),D.register(a.ENGINEPLUGIN.KEYBOARDMANAGER,ic),D.register(a.ENGINEPLUGIN.ORBITCONTROLS,Is),D.register(a.ENGINEPLUGIN.TRANSFORMCONTROLS,xs),D.register(a.ENGINEPLUGIN.AXESHELPER,rc),D.register(a.ENGINEPLUGIN.GRIDHELPER,oc),D.register(a.ENGINEPLUGIN.OBJECTHELPER,hc),D.register(a.ENGINEPLUGIN.DISPLAYMODE,ac),D.register(a.ENGINEPLUGIN.VIEWPOINT,ws),D.register(a.ENGINEPLUGIN.STATS,vs),D.register(a.ENGINEPLUGIN.SELECTION,pc);class mc extends D{constructor(){super();this.install(a.ENGINEPLUGIN.WEBGLRENDERER,{antialias:!0,alpha:!0}).install(a.ENGINEPLUGIN.RENDERMANAGER).install(a.ENGINEPLUGIN.EFFECTCOMPOSER,{WebGLMultisampleRenderTarget:!0}).install(a.ENGINEPLUGIN.ORBITCONTROLS).install(a.ENGINEPLUGIN.POINTERMANAGER).install(a.ENGINEPLUGIN.EVENTMANAGER).complete()}}class gc extends D{constructor(){super();this.install(a.ENGINEPLUGIN.RENDERMANAGER).install(a.ENGINEPLUGIN.WEBGLRENDERER,{antialias:!0,alpha:!0}).install(a.ENGINEPLUGIN.POINTERMANAGER).install(a.ENGINEPLUGIN.EVENTMANAGER).install(a.ENGINEPLUGIN.EFFECTCOMPOSER,{WebGLMultisampleRenderTarget:!0}).install(a.ENGINEPLUGIN.SELECTION).install(a.ENGINEPLUGIN.AXESHELPER).install(a.ENGINEPLUGIN.GRIDHELPER).install(a.ENGINEPLUGIN.OBJECTHELPER).install(a.ENGINEPLUGIN.VIEWPOINT).install(a.ENGINEPLUGIN.DISPLAYMODE).install(a.ENGINEPLUGIN.STATS).install(a.ENGINEPLUGIN.ORBITCONTROLS).install(a.ENGINEPLUGIN.KEYBOARDMANAGER).install(a.ENGINEPLUGIN.TRANSFORMCONTROLS).complete()}}class Ec{constructor(){d(this,"supportData");d(this,"supportDataType")}create(e){return e?(this.supportData={},this.supportDataType=e,this):(console.warn("you must give a module type in create params"),this)}add(e){return!this.supportData||!this.supportDataType?(console.warn("you must call 'create' method before the 'add' method"),this):e.type?je(e.type)!==this.supportDataType?(console.warn(`current generator create config which module is in: ${this.supportDataType}, but you provide type is '${e.type}'`),this):(this.supportData[e.vid]=K(e.type,e),this):(console.warn("config can not found attribute 'type'"),this)}get(){return this.supportDataType=void 0,this.supportData?this.supportData:{}}}const $t=new l.PointLight("rgb(255, 255, 255)",.5,200,1);$t.position.set(-30,5,20),$t.castShadow=!0;const bt=new l.Mesh(new l.BoxBufferGeometry(80,2,80),new l.MeshStandardMaterial({color:"rgb(255, 255, 255)"}));bt.position.set(0,-11,0),bt.receiveShadow=!0,bt.castShadow=!0;const ce=class{constructor(e){d(this,"material");d(this,"dom");d(this,"renderer");d(this,"scene");d(this,"camera");d(this,"object");const t=new l.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0});t.setPixelRatio(window.devicePixelRatio),t.setClearColor("rgb(150, 150, 150)"),t.shadowMap.enabled=!0,t.shadowMap.type=l.PCFSoftShadowMap;const s=new l.Scene,i=new l.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,500);i.position.set(0,0,35),i.up.x=0,i.up.y=1,i.up.z=0,i.lookAt(new l.Vector3(0,0,0)),s.add(ce.ambientLight),s.add(ce.pointLight),s.add(ce.plane),this.scene=s,this.renderer=t,this.camera=i,this.object=new l.Object3D,(e==null?void 0:e.material)&&this.setMaterial(e.material),(e==null?void 0:e.dom)&&this.setDom(e.dom)}setMaterial(e){if(this.scene.remove(this.object),this.material=e,e.type.includes("Mesh"))this.object=new l.Mesh(ce.geometry,e);else if(e.type.includes("Line"))this.object=new l.Line(ce.geometry,e);else if(e.type.includes("Ponits"))this.object=new l.Points(ce.geometry,e);else if(e.type.includes("Sprite"))this.object=new l.Sprite(e);else return console.warn(`material displayer can not support this type material: '${e.type}'`),this;return this.object.castShadow=!0,this.object.receiveShadow=!0,this.scene.add(this.object),this}setDom(e){return this.dom=e,this.setSize(),e.appendChild(this.renderer.domElement),this}setSize(e,t){if(e&&t)this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t,!0);else{if(!this.dom)return console.warn("material displayer must set dom before setSize with empty parameters"),this;const s=this.dom;this.camera.aspect=s.offsetWidth/s.offsetHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(s.offsetWidth,s.offsetHeight,!0)}return this}render(){this.renderer.render(this.scene,this.camera)}getDataURL(e){return this.renderer.domElement.toDataURL(e||"image/png")}dispose(){this.renderer.dispose()}};let Ue=ce;d(Ue,"ambientLight",new l.AmbientLight("rgb(255, 255, 255)",.7)),d(Ue,"pointLight",$t),d(Ue,"geometry",new l.SphereBufferGeometry(10,12,12)),d(Ue,"plane",bt),d(Ue,"dispose",()=>{ce.geometry.dispose(),ce.plane.geometry.dispose()});const tn=class{constructor(e){d(this,"dom");d(this,"texture");d(this,"renderer");d(this,"scene");d(this,"camera");const t=new l.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0});t.setPixelRatio(window.devicePixelRatio),t.setClearColor("rgb(150, 150, 150)"),t.shadowMap.enabled=!0,t.shadowMap.type=l.PCFSoftShadowMap;const s=new l.Scene,i=new l.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,500);i.position.set(0,0,35),i.up.x=0,i.up.y=1,i.up.z=0,i.lookAt(new l.Vector3(0,0,0)),s.add(tn.ambientLight),this.scene=s,this.renderer=t,this.camera=i,(e==null?void 0:e.texture)&&this.setTexture(e.texture),(e==null?void 0:e.dom)&&this.setDom(e.dom)}setTexture(e){return this.scene.background=e,this}setDom(e){return this.dom=e,this.setSize(),e.appendChild(this.renderer.domElement),this}setSize(e,t){if(e&&t)this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t,!0);else{if(!this.dom)return console.warn("texture displayer must set dom before setSize with empty parameters"),this;const s=this.dom;this.camera.aspect=s.offsetWidth/s.offsetHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(s.offsetWidth,s.offsetHeight,!0)}return this}render(){this.renderer.render(this.scene,this.camera)}getDataURL(e){return this.renderer.domElement.toDataURL(e||"image/png")}dispose(){this.renderer.dispose()}};let Kt=tn;d(Kt,"ambientLight",new l.AmbientLight("rgb(255, 255, 255)",1));class Xt extends D{constructor(e={},t={}){super();d(this,"IS_ENGINESUPPORT",!0);this.install(a.ENGINEPLUGIN.LOADERMANAGER).install(a.ENGINEPLUGIN.RESOURCEMANAGER,{resources:t}).install(a.ENGINEPLUGIN.POINTERMANAGER).install(a.ENGINEPLUGIN.EVENTMANAGER).install(a.ENGINEPLUGIN.RENDERMANAGER).install(a.ENGINEPLUGIN.DATASUPPORTMANAGER,e).install(a.ENGINEPLUGIN.COMPILERMANAGER)}loadLifeCycle(e){const t=this.dataSupportManager;e.texture&&t.load({texture:e.texture}),e.material&&t.load({material:e.material}),delete e.texture,delete e.material,t.load(e)}removeLifeCycle(e){const t=this.dataSupportManager,s=e[a.MODULETYPE.TEXTURE]||{},i=e[a.MODULETYPE.MATERIAL]||{},r=e.assets||[];delete e.texture,delete e.material,delete e.assets,t.remove(e),t.remove({[a.MODULETYPE.MATERIAL]:i}),t.remove({[a.MODULETYPE.TEXTURE]:s});const o=this.resourceManager,c=this.loaderManager;r.forEach(u=>{o.remove(u),c.remove(u)})}loadConfig(e,t){const s=this.renderManager.hasRendering();if(s&&this.renderManager.stop(),e.assets&&e.assets.length){const i=r=>{delete e.assets,this.loadLifeCycle(e),this.resourceManager.removeEventListener("mapped",i),t&&t(r),s?this.renderManager.play():this.renderManager.render()};this.resourceManager.addEventListener("mapped",i),this.loaderManager.reset().load(e.assets)}else this.loadLifeCycle(e),t&&t(),s?this.renderManager.play():this.renderManager.render();return this}loadConfigAsync(e){return new Promise((t,s)=>{const i=this.renderManager.hasRendering();if(i&&this.renderManager.stop(),e.assets&&e.assets.length){const r=o=>{delete e.assets,this.loadLifeCycle(e),this.resourceManager.removeEventListener("mapped",r),i?this.renderManager.play():this.renderManager.render(),t(o)};this.resourceManager.addEventListener("mapped",r),this.loaderManager.reset().load(e.assets)}else this.loadLifeCycle(e),i?this.renderManager.play():this.renderManager.render(),t(void 0)})}removeConfig(e){this.removeLifeCycle(e)}getObjectConfig(e){const t=this.getObjectSymbol(e);return t?this.getConfigBySymbol(t):null}}class Tc extends Xt{constructor(e){super(e);d(this,"IS_ENGINESUPPORT",!0);this.install(a.ENGINEPLUGIN.WEBGLRENDERER,{antialias:!0,alpha:!0}).install(a.ENGINEPLUGIN.EFFECTCOMPOSER,{WebGLMultisampleRenderTarget:!0}).install(a.ENGINEPLUGIN.SELECTION).install(a.ENGINEPLUGIN.AXESHELPER).install(a.ENGINEPLUGIN.GRIDHELPER).install(a.ENGINEPLUGIN.OBJECTHELPER).install(a.ENGINEPLUGIN.VIEWPOINT).install(a.ENGINEPLUGIN.DISPLAYMODE).install(a.ENGINEPLUGIN.STATS).install(a.ENGINEPLUGIN.ORBITCONTROLS).install(a.ENGINEPLUGIN.KEYBOARDMANAGER).install(a.ENGINEPLUGIN.TRANSFORMCONTROLS).complete()}}class yc extends Xt{constructor(e){super(e);this.install(a.ENGINEPLUGIN.WEBGLRENDERER,{antialias:!0,alpha:!0}).install(a.ENGINEPLUGIN.EFFECTCOMPOSER,{WebGLMultisampleRenderTarget:!0}).install(a.ENGINEPLUGIN.ORBITCONTROLS).complete()}}class Mc{constructor(e){d(this,"visible",!0);e.visible&&(this.visible=e.visible)}}class Sc extends Mc{constructor(e){super(e);d(this,"source");d(this,"target");d(this,"mode");d(this,"cacheSourceMatrix");d(this,"cacheTargetMatrix");d(this,"cacheSoruceGeometryUuid");d(this,"cacheTargetGeometryUuid");d(this,"originalGeometry");d(this,"modifiedGeometry");this.source=e.source,this.target=e.target,this.mode=e.mode||"subtract",this.cacheSourceMatrix=this.source.matrix.clone(),this.cacheTargetMatrix=this.target.matrix.clone(),this.cacheSoruceGeometryUuid=this.source.geometry.uuid,this.cacheTargetGeometryUuid=this.target.geometry.uuid,this.originalGeometry=this.source.geometry,this.modifiedGeometry=new l.BufferGeometry,this.modify(),this.source.geometry=this.modifiedGeometry}async modify(){const e=this.source,t={geometry:this.originalGeometry,matrix:this.source.matrix},s=At.CSG.fromMesh(t),i=At.CSG.fromMesh(this.target),r=At.CSG.toGeometry(s[this.mode](i),e.matrix);this.modifiedGeometry.copy(r),this.modifiedGeometry.uuid=r.uuid}render(){if(this.visible){if(!this.cacheSourceMatrix.equals(this.source.matrix)){this.modify(),this.cacheSourceMatrix.copy(this.source.matrix);return}if(!this.cacheTargetMatrix.equals(this.target.matrix)){this.modify(),this.cacheTargetMatrix.copy(this.target.matrix);return}if(this.originalGeometry.uuid!==this.cacheSoruceGeometryUuid){this.modify(),this.cacheSoruceGeometryUuid=this.originalGeometry.uuid;return}if(this.target.geometry.uuid!==this.cacheTargetGeometryUuid){this.modify(),this.cacheTargetGeometryUuid=this.target.geometry.uuid;return}}else this.modifiedGeometry.copy(this.originalGeometry)}apply(){this.originalGeometry.copy(this.modifiedGeometry),this.originalGeometry.uuid=this.modifiedGeometry.uuid,this.source.geometry=this.originalGeometry}dispose(){this.source.geometry=this.originalGeometry,this.modifiedGeometry.dispose()}}class Oc{next(){console.warn(`this action can not set next function: ${this.constructor.name}`)}prev(){console.warn(`this action can not set prev function: ${this.constructor.name}`)}}class Cc{constructor(e){d(this,"actionList",[]);d(this,"index",-1);d(this,"step",50);this.step=e||50}do(e){this.actionList[this.index][e]()}apply(e,t=!1){const s=this.actionList;this.index===s.length-1&&s.length>=this.step?(s.shift(),this.index=this.actionList.length-1):this.index!==-1?s.splice(this.index+1,s.length-1):this.index===-1&&(this.actionList=[]),this.actionList.push(e),t?this.redo():this.index+=1}redo(){if(this.index+=1,this.index>this.actionList.length-1){this.index=this.actionList.length-1;return}this.do("next")}undo(){this.index<0||(this.do("prev"),this.index-=1)}clear(){this.actionList=[]}}const bc="0.2.3";window.__THREE__||console.error("vis-three dependent on three.js module, pleace run 'npm i three' first."),window.__VIS__?console.warn("Duplicate vis-three frames are introduced"):window.__VIS__=bc,l.Scene.prototype.add=function(...n){if(!arguments.length)return this;if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}const e=n[0];if(e===this)return console.error("THREE.Object3D.add: object can't be added as a child of itself.",n),this;if(e&&e.isObject3D){if(e.parent!==null){const t=this.children.indexOf(e);t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent({type:"removed"}))}e.parent=this,this.children.push(e),e.dispatchEvent({type:"added"})}else console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",n);return this};const Rc=l.Scene.prototype.add,Lc=l.Scene.prototype.remove;l.Scene.prototype.add=function(...n){return Rc.call(this,...n),this.dispatchEvent({type:"afterAdd",objects:n}),this},l.Scene.prototype.remove=function(...n){return Lc.call(this,...n),this.dispatchEvent({type:"afterRemove",objects:n}),this};const Qt=new bs.LightShadow(new l.OrthographicCamera(-256,256,256,-256));Qt.autoUpdate=!1,Qt.needsUpdate=!1,l.AmbientLight.prototype.shadow=Qt,a.Action=Oc,a.AniScriptLibrary=ye,a.AnimationDataSupport=zn,a.BooleanModifier=Sc,a.CONFIGMODULE=mi,a.CSS3DDataSupport=Vn,a.CSS3DPlane=Qn,a.CameraDataSupport=Dn,a.CameraHelper=kt,a.CanvasGenerator=$e,a.ControlsDataSupport=Fn,a.DataSupportManager=Wn,a.DirectionalLightHelper=is,a.DisplayEngine=mc,a.DisplayEngineSupport=yc,a.Engine=D,a.EngineSupport=Xt,a.EventDispatcher=te,a.EventLibrary=U,a.GeometryDataSupport=Gn,a.GroupDataSupport=_n,a.GroupHelper=Ct,a.History=Cc,a.JSONHandler=Ir,a.KeyboardManager=ss,a.LightDataSupport=Nn,a.LineDataSupport=Yn,a.LoaderManager=On,a.MaterialDataSupport=An,a.MaterialDisplayer=Ue,a.MeshDataSupport=Hn,a.ModelingEngine=gc,a.ModelingEngineSupport=Tc,a.PassDataSupport=kn,a.PointLightHelper=rs,a.PointsDataSupport=Bn,a.ProxyBroadcast=He,a.RenderManager=un,a.RendererDataSupport=Un,a.ResourceManager=wn,a.SceneDataSupport=xn,a.SelectiveBloomPass=nt,a.ShaderLibrary=Z,a.SpotLightHelper=os,a.SpriteDataSupport=jn,a.SupportDataGenerator=Ec,a.TextureDataSupport=vn,a.TextureDisplayer=Kt,a.Translater=Pn,a.Utils=Cr,a.VideoLoader=Ie,a.generateConfig=K,a.getModule=je,Object.defineProperty(a,"__esModule",{value:!0}),a[Symbol.toStringTag]="Module"});
