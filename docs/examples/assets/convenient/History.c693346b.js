var B=Object.defineProperty;var O=(e,t,s)=>t in e?B(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var r=(e,t,s)=>(O(e,typeof t!="symbol"?t+"":t,s),s);import"../modulepreload-polyfill.b7f2da20.js";import{M as L,B as D,a as S,ac as $,P as k}from"../three.a7f96461.js";import"../TextureDisplayer.4cf2d30b.js";import{M as v}from"../index.001f3687.js";import"../index.a2f5d06c.js";import"../index.90c2f86e.js";import"../index.905449da.js";import"../index.d8b4942b.js";import"../index.b6c2852c.js";import"../index.ac438749.js";import"../index.bc97152c.js";import"../index.eecf5bb8.js";import"../index.355261f2.js";import"../index.2afa8225.js";import"../index.774abea2.js";import"../index.7fa56c04.js";import"../index.248a65de.js";import"../Antdv.35288747.js";import"../index.72d4ac78.js";import"../index.b0fe2ce4.js";import"../index.512960c2.js";import"../index.7b782c3d.js";import"../index.725c43cc.js";import"../index.7e2f6976.js";import"../index.7c056589.js";import"../index.3d33b1b8.js";import"../index.82d0dfac.js";import"../index.16e30821.js";import"../index.3bb87df6.js";class b{next(){console.warn(`this action can not set next function: ${this.constructor.name}`)}prev(){console.warn(`this action can not set prev function: ${this.constructor.name}`)}}class G{constructor(t){r(this,"actionList",[]);r(this,"index",-1);r(this,"step",50);this.step=t||50}do(t){this.actionList[this.index][t]()}apply(t,s=!1){const o=this.actionList;this.index===o.length-1&&o.length>=this.step?(o.shift(),this.index=this.actionList.length-1):this.index!==-1?o.splice(this.index+1,o.length-1):this.index===-1&&(this.actionList=[]),this.actionList.push(t),s?this.redo():this.index+=1}redo(){if(this.index+=1,this.index>this.actionList.length-1){this.index=this.actionList.length-1;return}this.do("next")}undo(){this.index<0||(this.do("prev"),this.index-=1)}clear(){this.actionList=[]}}const a=class extends b{constructor({objects:t,engine:s}){super(),this.oldObjects=[].concat(a.cacheSection),this.newObjects=[].concat(t),this.engine=s,a.cacheSection=[].concat(t)}next(){a.status=!0,this.engine.setSelectionBox([this.newObjects])}prev(){a.status=!0,this.engine.setSelectionBox([this.oldObjects])}};let i=a;r(i,"status",!1),r(i,"cacheSection",[]);class K extends b{constructor({transformControls:t}){super(),this.nextState={mode:"translate",space:"world",tranform:"",objectMap:new Map},this.prevState={mode:"translate",space:"world",tranform:"",objectMap:new Map},this.transfromControls=t}generate(t){const s=this.transfromControls,o=s.mode,d=o==="rotate"?"rotation":o==="translate"?"position":o,j=s.getTransObjectSet(),m=this[`${t}State`];m.mode=o,m.tranform=d,m.space=s.space;const z=m.objectMap;j.forEach(n=>{z.set(n,{x:n[d].x,y:n[d].y,z:n[d].z})}),this[t]=function(){const n=this.transfromControls,l=this[`${t}State`];n.mode=l.mode,n.space=l.space;const x=l.tranform,M=[];l.objectMap.forEach((g,p)=>{p[x].x=g.x,p[x].y=g.y,p[x].z=g.z,p.updateMatrixWorld(),M.push(p)}),n.setAttach(...M)}}}const c=new v().setDom(document.getElementById("app")).setSize().setStats(!0).play(),u=new G(50);c.keyboardManager.register({shortcutKey:["ctrl","z"],desp:"undo",keyup:e=>{e==null||e.preventDefault(),u.undo()}}).register({shortcutKey:["ctrl","y"],desp:"redo",keyup:e=>{e==null||e.preventDefault(),u.redo()}});const y=c.scene,f=new L(new D(10,10,10),new S({color:"rgb(255, 105, 100)"}));f.position.x=10;y.add(f);f.updateMatrixWorld();const C=new L(new $(5,32,32),new S({color:"rgb(255, 205, 100)"}));C.position.x=-10;y.add(C);const E=new k("rgb(255, 255, 255)",1,300,0);E.position.y=30;y.add(E);c.setSelectionBox([f]);c.addEventListener("selected",e=>{if(i.status){i.status=!1;return}!i.cacheSection.length&&!e.objects.length||u.apply(new i({objects:e.objects,engine:c}))});const w=c.transformControls;let h="";w.addEventListener("mouseDown",e=>{h=new K({transformControls:w}),h.generate("prev")});w.addEventListener("mouseUp",e=>{h.generate("next"),u.apply(h),h=""});
