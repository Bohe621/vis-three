var er=Object.defineProperty;var tr=(o,e,t)=>e in o?er(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var Z=(o,e,t)=>(tr(o,typeof e!="symbol"?e+"":e,t),t);import{h as V,f as k,ax as De,ay as de,aw as Oe,d as Me,F as ie,al as st,az as rt,ap as $e,an as it,aA as Wt,b as Mt,M as Gt,aB as he,a4 as $n,aC as Je,V as Dt,aD as nr,aE as fn,aF as te,aG as sr,H as gt,n as kt,r as Ct,a1 as es,q as Ue,ak as ts,P as zt,aj as ns,am as et,ao as we,a as pn,a3 as rr,aH as ir,Q as tt,N as or,aI as ar,aJ as cr,aK as lr,a0 as An,p as qt,aL as ur,aM as ss,aN as hr,aO as fr,aP as pr,aQ as Ar,aR as wt,aS as dr,aT as at,aU as rs,aV as Br,aW as is,L as os,aX as mr,c as as,aY as ue,O as cs,aZ as ls,a_ as $t,a$ as us,b0 as hs,b1 as en,s as Tt,t as _,b2 as fs,w as Lt,K as gr,b3 as Cr,b4 as Ut,b5 as Fr,b6 as Er,b7 as yr,A as Mr,b8 as Tr,b9 as vr,ab as nt,ba as Sn,bb as Ir,R as Rr,bc as Gr,bd as Dr,be as wr,bf as Lr,bg as Sr,bh as br,bi as Hr,bj as xr,bk as Pr,bl as bn,bm as Or}from"./three.a7f96461.js";import{e as Jr,t as Ur}from"./index.a2f5d06c.js";const _r=/^[og]\s*(.+)?/,kr=/^mtllib /,Kr=/^usemtl /,Nr=/^usemap /,Hn=new V,Kt=new V,xn=new V,Pn=new V,se=new V,Ft=new k;function jr(){const o={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1){this.object.name=e,this.object.fromDeclaration=t!==!1;return}const n=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(s,r){const i=this._finalize(!1);i&&(i.inherited||i.groupCount<=0)&&this.materials.splice(i.index,1);const a={index:this.materials.length,name:s||"",mtllib:Array.isArray(r)&&r.length>0?r[r.length-1]:"",smooth:i!==void 0?i.smooth:this.smooth,groupStart:i!==void 0?i.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(c){const l={index:typeof c=="number"?c:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return l.clone=this.clone.bind(l),l}};return this.materials.push(a),a},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(s){const r=this.currentMaterial();if(r&&r.groupEnd===-1&&(r.groupEnd=this.geometry.vertices.length/3,r.groupCount=r.groupEnd-r.groupStart,r.inherited=!1),s&&this.materials.length>1)for(let i=this.materials.length-1;i>=0;i--)this.materials[i].groupCount<=0&&this.materials.splice(i,1);return s&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),r}},n&&n.name&&typeof n.clone=="function"){const s=n.clone(0);s.inherited=!0,this.object.materials.push(s)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const n=parseInt(e,10);return(n>=0?n-1:n+t/3)*3},parseNormalIndex:function(e,t){const n=parseInt(e,10);return(n>=0?n-1:n+t/3)*3},parseUVIndex:function(e,t){const n=parseInt(e,10);return(n>=0?n-1:n+t/2)*2},addVertex:function(e,t,n){const s=this.vertices,r=this.object.geometry.vertices;r.push(s[e+0],s[e+1],s[e+2]),r.push(s[t+0],s[t+1],s[t+2]),r.push(s[n+0],s[n+1],s[n+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,n){const s=this.normals,r=this.object.geometry.normals;r.push(s[e+0],s[e+1],s[e+2]),r.push(s[t+0],s[t+1],s[t+2]),r.push(s[n+0],s[n+1],s[n+2])},addFaceNormal:function(e,t,n){const s=this.vertices,r=this.object.geometry.normals;Hn.fromArray(s,e),Kt.fromArray(s,t),xn.fromArray(s,n),se.subVectors(xn,Kt),Pn.subVectors(Hn,Kt),se.cross(Pn),se.normalize(),r.push(se.x,se.y,se.z),r.push(se.x,se.y,se.z),r.push(se.x,se.y,se.z)},addColor:function(e,t,n){const s=this.colors,r=this.object.geometry.colors;s[e]!==void 0&&r.push(s[e+0],s[e+1],s[e+2]),s[t]!==void 0&&r.push(s[t+0],s[t+1],s[t+2]),s[n]!==void 0&&r.push(s[n+0],s[n+1],s[n+2])},addUV:function(e,t,n){const s=this.uvs,r=this.object.geometry.uvs;r.push(s[e+0],s[e+1]),r.push(s[t+0],s[t+1]),r.push(s[n+0],s[n+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,n,s,r,i,a,c,l){const h=this.vertices.length;let u=this.parseVertexIndex(e,h),f=this.parseVertexIndex(t,h),p=this.parseVertexIndex(n,h);if(this.addVertex(u,f,p),this.addColor(u,f,p),a!==void 0&&a!==""){const A=this.normals.length;u=this.parseNormalIndex(a,A),f=this.parseNormalIndex(c,A),p=this.parseNormalIndex(l,A),this.addNormal(u,f,p)}else this.addFaceNormal(u,f,p);if(s!==void 0&&s!==""){const A=this.uvs.length;u=this.parseUVIndex(s,A),f=this.parseUVIndex(r,A),p=this.parseUVIndex(i,A),this.addUV(u,f,p),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let n=0,s=e.length;n<s;n++){const r=this.parseVertexIndex(e[n],t);this.addVertexPoint(r),this.addColor(r)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const n=this.vertices.length,s=this.uvs.length;for(let r=0,i=e.length;r<i;r++)this.addVertexLine(this.parseVertexIndex(e[r],n));for(let r=0,i=t.length;r<i;r++)this.addUVLine(this.parseUVIndex(t[r],s))}};return o.startObject("",!1),o}class Qr extends De{constructor(e){super(e),this.materials=null}load(e,t,n,s){const r=this,i=new de(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,function(a){try{t(r.parse(a))}catch(c){s?s(c):console.error(c),r.manager.itemError(e)}},n,s)}setMaterials(e){return this.materials=e,this}parse(e){const t=new jr;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const n=e.split(`
`);let s="",r="",i=0,a=[];const c=typeof"".trimLeft=="function";for(let u=0,f=n.length;u<f;u++)if(s=n[u],s=c?s.trimLeft():s.trim(),i=s.length,i!==0&&(r=s.charAt(0),r!=="#"))if(r==="v"){const p=s.split(/\s+/);switch(p[0]){case"v":t.vertices.push(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3])),p.length>=7?(Ft.setRGB(parseFloat(p[4]),parseFloat(p[5]),parseFloat(p[6])).convertSRGBToLinear(),t.colors.push(Ft.r,Ft.g,Ft.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3]));break;case"vt":t.uvs.push(parseFloat(p[1]),parseFloat(p[2]));break}}else if(r==="f"){const A=s.slice(1).trim().split(/\s+/),B=[];for(let g=0,C=A.length;g<C;g++){const d=A[g];if(d.length>0){const F=d.split("/");B.push(F)}}const m=B[0];for(let g=1,C=B.length-1;g<C;g++){const d=B[g],F=B[g+1];t.addFace(m[0],d[0],F[0],m[1],d[1],F[1],m[2],d[2],F[2])}}else if(r==="l"){const p=s.substring(1).trim().split(" ");let A=[];const B=[];if(s.indexOf("/")===-1)A=p;else for(let m=0,g=p.length;m<g;m++){const C=p[m].split("/");C[0]!==""&&A.push(C[0]),C[1]!==""&&B.push(C[1])}t.addLineGeometry(A,B)}else if(r==="p"){const A=s.slice(1).trim().split(" ");t.addPointGeometry(A)}else if((a=_r.exec(s))!==null){const p=(" "+a[0].slice(1).trim()).slice(1);t.startObject(p)}else if(Kr.test(s))t.object.startMaterial(s.substring(7).trim(),t.materialLibraries);else if(kr.test(s))t.materialLibraries.push(s.substring(7).trim());else if(Nr.test(s))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(r==="s"){if(a=s.split(" "),a.length>1){const A=a[1].trim().toLowerCase();t.object.smooth=A!=="0"&&A!=="off"}else t.object.smooth=!0;const p=t.object.currentMaterial();p&&(p.smooth=t.object.smooth)}else{if(s==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+s+'"')}t.finalize();const l=new Oe;if(l.materialLibraries=[].concat(t.materialLibraries),!(t.objects.length===1&&t.objects[0].geometry.vertices.length===0)===!0)for(let u=0,f=t.objects.length;u<f;u++){const p=t.objects[u],A=p.geometry,B=p.materials,m=A.type==="Line",g=A.type==="Points";let C=!1;if(A.vertices.length===0)continue;const d=new Me;d.setAttribute("position",new ie(A.vertices,3)),A.normals.length>0&&d.setAttribute("normal",new ie(A.normals,3)),A.colors.length>0&&(C=!0,d.setAttribute("color",new ie(A.colors,3))),A.hasUVIndices===!0&&d.setAttribute("uv",new ie(A.uvs,2));const F=[];for(let y=0,M=B.length;y<M;y++){const E=B[y],I=E.name+"_"+E.smooth+"_"+C;let T=t.materials[I];if(this.materials!==null){if(T=this.materials.create(E.name),m&&T&&!(T instanceof st)){const R=new st;rt.prototype.copy.call(R,T),R.color.copy(T.color),T=R}else if(g&&T&&!(T instanceof $e)){const R=new $e({size:10,sizeAttenuation:!1});rt.prototype.copy.call(R,T),R.color.copy(T.color),R.map=T.map,T=R}}T===void 0&&(m?T=new st:g?T=new $e({size:1,sizeAttenuation:!1}):T=new it,T.name=E.name,T.flatShading=!E.smooth,T.vertexColors=C,t.materials[I]=T),F.push(T)}let v;if(F.length>1){for(let y=0,M=B.length;y<M;y++){const E=B[y];d.addGroup(E.groupStart,E.groupCount,y)}m?v=new Wt(d,F):g?v=new Mt(d,F):v=new Gt(d,F)}else m?v=new Wt(d,F[0]):g?v=new Mt(d,F[0]):v=new Gt(d,F[0]);v.name=p.name,l.add(v)}else if(t.vertices.length>0){const u=new $e({size:1,sizeAttenuation:!1}),f=new Me;f.setAttribute("position",new ie(t.vertices,3)),t.colors.length>0&&t.colors[0]!==void 0&&(f.setAttribute("color",new ie(t.colors,3)),u.vertexColors=!0);const p=new Mt(f,u);l.add(p)}return l}}class Xr extends De{constructor(e){super(e)}load(e,t,n,s){const r=this,i=this.path===""?he.extractUrlBase(e):this.path,a=new de(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(c){try{t(r.parse(c,i))}catch(l){s?s(l):console.error(l),r.manager.itemError(e)}},n,s)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,t){const n=e.split(`
`);let s={};const r=/\s+/,i={};for(let c=0;c<n.length;c++){let l=n[c];if(l=l.trim(),l.length===0||l.charAt(0)==="#")continue;const h=l.indexOf(" ");let u=h>=0?l.substring(0,h):l;u=u.toLowerCase();let f=h>=0?l.substring(h+1):"";if(f=f.trim(),u==="newmtl")s={name:f},i[f]=s;else if(u==="ka"||u==="kd"||u==="ks"||u==="ke"){const p=f.split(r,3);s[u]=[parseFloat(p[0]),parseFloat(p[1]),parseFloat(p[2])]}else s[u]=f}const a=new Vr(this.resourcePath||t,this.materialOptions);return a.setCrossOrigin(this.crossOrigin),a.setManager(this.manager),a.setMaterials(i),a}}class Vr{constructor(e="",t={}){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:$n,this.wrap=this.options.wrap!==void 0?this.options.wrap:Je}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const t={};for(const n in e){const s=e[n],r={};t[n]=r;for(const i in s){let a=!0,c=s[i];const l=i.toLowerCase();switch(l){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(c=[c[0]/255,c[1]/255,c[2]/255]),this.options&&this.options.ignoreZeroRGBs&&c[0]===0&&c[1]===0&&c[2]===0&&(a=!1);break}a&&(r[l]=c)}}return t}preload(){for(const e in this.materialsInfo)this.create(e)}getIndex(e){return this.nameLookup[e]}getAsArray(){let e=0;for(const t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray}create(e){return this.materials[e]===void 0&&this.createMaterial_(e),this.materials[e]}createMaterial_(e){const t=this,n=this.materialsInfo[e],s={name:e,side:this.side};function r(a,c){return typeof c!="string"||c===""?"":/^https?:\/\//i.test(c)?c:a+c}function i(a,c){if(s[a])return;const l=t.getTextureParams(c,s),h=t.loadTexture(r(t.baseUrl,l.url));h.repeat.copy(l.scale),h.offset.copy(l.offset),h.wrapS=t.wrap,h.wrapT=t.wrap,(a==="map"||a==="emissiveMap")&&(h.encoding=te),s[a]=h}for(const a in n){const c=n[a];let l;if(c!=="")switch(a.toLowerCase()){case"kd":s.color=new k().fromArray(c).convertSRGBToLinear();break;case"ks":s.specular=new k().fromArray(c).convertSRGBToLinear();break;case"ke":s.emissive=new k().fromArray(c).convertSRGBToLinear();break;case"map_kd":i("map",c);break;case"map_ks":i("specularMap",c);break;case"map_ke":i("emissiveMap",c);break;case"norm":i("normalMap",c);break;case"map_bump":case"bump":i("bumpMap",c);break;case"map_d":i("alphaMap",c),s.transparent=!0;break;case"ns":s.shininess=parseFloat(c);break;case"d":l=parseFloat(c),l<1&&(s.opacity=l,s.transparent=!0);break;case"tr":l=parseFloat(c),this.options&&this.options.invertTrProperty&&(l=1-l),l>0&&(s.opacity=1-l,s.transparent=!0);break}}return this.materials[e]=new it(s),this.materials[e]}getTextureParams(e,t){const n={scale:new Dt(1,1),offset:new Dt(0,0)},s=e.split(/\s+/);let r;return r=s.indexOf("-bm"),r>=0&&(t.bumpScale=parseFloat(s[r+1]),s.splice(r,2)),r=s.indexOf("-s"),r>=0&&(n.scale.set(parseFloat(s[r+1]),parseFloat(s[r+2])),s.splice(r,4)),r=s.indexOf("-o"),r>=0&&(n.offset.set(parseFloat(s[r+1]),parseFloat(s[r+2])),s.splice(r,4)),n.url=s.join(" ").trim(),n}loadTexture(e,t,n,s,r){const i=this.manager!==void 0?this.manager:nr;let a=i.getHandler(e);a===null&&(a=new fn(i)),a.setCrossOrigin&&a.setCrossOrigin(this.crossOrigin);const c=a.load(e,n,s,r);return t!==void 0&&(c.mapping=t),c}}class Yr extends sr{constructor(e){super(e),this.type=gt}parse(e){const a=function(d,F){switch(d){case 1:console.error("THREE.RGBELoader Read Error: "+(F||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(F||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(F||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(F||""))}return-1},u=`
`,f=function(d,F,v){F=F||1024;let M=d.pos,E=-1,I=0,T="",R=String.fromCharCode.apply(null,new Uint16Array(d.subarray(M,M+128)));for(;0>(E=R.indexOf(u))&&I<F&&M<d.byteLength;)T+=R,I+=R.length,M+=128,R+=String.fromCharCode.apply(null,new Uint16Array(d.subarray(M,M+128)));return-1<E?(v!==!1&&(d.pos+=I+E+1),T+R.slice(0,E)):!1},p=function(d){const F=/^#\?(\S+)/,v=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,y=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,M=/^\s*FORMAT=(\S+)\s*$/,E=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,I={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let T,R;if(d.pos>=d.byteLength||!(T=f(d)))return a(1,"no header found");if(!(R=T.match(F)))return a(3,"bad initial token");for(I.valid|=1,I.programtype=R[1],I.string+=T+`
`;T=f(d),T!==!1;){if(I.string+=T+`
`,T.charAt(0)==="#"){I.comments+=T+`
`;continue}if((R=T.match(v))&&(I.gamma=parseFloat(R[1])),(R=T.match(y))&&(I.exposure=parseFloat(R[1])),(R=T.match(M))&&(I.valid|=2,I.format=R[1]),(R=T.match(E))&&(I.valid|=4,I.height=parseInt(R[1],10),I.width=parseInt(R[2],10)),I.valid&2&&I.valid&4)break}return I.valid&2?I.valid&4?I:a(3,"missing image size specifier"):a(3,"missing format specifier")},A=function(d,F,v){const y=F;if(y<8||y>32767||d[0]!==2||d[1]!==2||d[2]&128)return new Uint8Array(d);if(y!==(d[2]<<8|d[3]))return a(3,"wrong scanline width");const M=new Uint8Array(4*F*v);if(!M.length)return a(4,"unable to allocate buffer space");let E=0,I=0;const T=4*y,R=new Uint8Array(4),D=new Uint8Array(T);let G=v;for(;G>0&&I<d.byteLength;){if(I+4>d.byteLength)return a(1);if(R[0]=d[I++],R[1]=d[I++],R[2]=d[I++],R[3]=d[I++],R[0]!=2||R[1]!=2||(R[2]<<8|R[3])!=y)return a(3,"bad rgbe scanline format");let w=0,L;for(;w<T&&I<d.byteLength;){L=d[I++];const x=L>128;if(x&&(L-=128),L===0||w+L>T)return a(3,"bad scanline data");if(x){const J=d[I++];for(let X=0;X<L;X++)D[w++]=J}else D.set(d.subarray(I,I+L),w),w+=L,I+=L}const P=y;for(let x=0;x<P;x++){let J=0;M[E]=D[x+J],J+=y,M[E+1]=D[x+J],J+=y,M[E+2]=D[x+J],J+=y,M[E+3]=D[x+J],E+=4}G--}return M},B=function(d,F,v,y){const M=d[F+3],E=Math.pow(2,M-128)/255;v[y+0]=d[F+0]*E,v[y+1]=d[F+1]*E,v[y+2]=d[F+2]*E,v[y+3]=1},m=function(d,F,v,y){const M=d[F+3],E=Math.pow(2,M-128)/255;v[y+0]=Ct.toHalfFloat(Math.min(d[F+0]*E,65504)),v[y+1]=Ct.toHalfFloat(Math.min(d[F+1]*E,65504)),v[y+2]=Ct.toHalfFloat(Math.min(d[F+2]*E,65504)),v[y+3]=Ct.toHalfFloat(1)},g=new Uint8Array(e);g.pos=0;const C=p(g);if(C!==-1){const d=C.width,F=C.height,v=A(g.subarray(g.pos),d,F);if(v!==-1){let y,M,E;switch(this.type){case kt:E=v.length/4;const I=new Float32Array(E*4);for(let R=0;R<E;R++)B(v,R*4,I,R*4);y=I,M=kt;break;case gt:E=v.length/4;const T=new Uint16Array(E*4);for(let R=0;R<E;R++)m(v,R*4,T,R*4);y=T,M=gt;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type);break}return{width:d,height:F,data:y,header:C.string,gamma:C.gamma,exposure:C.exposure,type:M}}}return null}setDataType(e){return this.type=e,this}load(e,t,n,s){function r(i,a){switch(i.type){case kt:case gt:i.encoding=es,i.minFilter=Ue,i.magFilter=Ue,i.generateMipmaps=!1,i.flipY=!0;break}t&&t(i,a)}return super.load(e,r,n,s)}}class Zr extends De{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new ei(t)}),this.register(function(t){return new ai(t)}),this.register(function(t){return new ci(t)}),this.register(function(t){return new ni(t)}),this.register(function(t){return new si(t)}),this.register(function(t){return new ri(t)}),this.register(function(t){return new ii(t)}),this.register(function(t){return new $r(t)}),this.register(function(t){return new oi(t)}),this.register(function(t){return new ti(t)}),this.register(function(t){return new zr(t)}),this.register(function(t){return new li(t)})}load(e,t,n,s){const r=this;let i;this.resourcePath!==""?i=this.resourcePath:this.path!==""?i=this.path:i=he.extractUrlBase(e),this.manager.itemStart(e);const a=function(l){s?s(l):console.error(l),r.manager.itemError(e),r.manager.itemEnd(e)},c=new de(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(l){try{r.parse(l,i,function(h){t(h),r.manager.itemEnd(e)},a)}catch(h){a(h)}},n,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,s){let r;const i={},a={};if(typeof e=="string")r=e;else if(he.decodeText(new Uint8Array(e,0,4))===ps){try{i[b.KHR_BINARY_GLTF]=new ui(e)}catch(u){s&&s(u);return}r=i[b.KHR_BINARY_GLTF].content}else r=he.decodeText(new Uint8Array(e));const c=JSON.parse(r);if(c.asset===void 0||c.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new Mi(c,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const u=this.pluginCallbacks[h](l);a[u.name]=u,i[u.name]=!0}if(c.extensionsUsed)for(let h=0;h<c.extensionsUsed.length;++h){const u=c.extensionsUsed[h],f=c.extensionsRequired||[];switch(u){case b.KHR_MATERIALS_UNLIT:i[u]=new qr;break;case b.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:i[u]=new pi;break;case b.KHR_DRACO_MESH_COMPRESSION:i[u]=new hi(c,this.dracoLoader);break;case b.KHR_TEXTURE_TRANSFORM:i[u]=new fi;break;case b.KHR_MESH_QUANTIZATION:i[u]=new Ai;break;default:f.indexOf(u)>=0&&a[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}l.setExtensions(i),l.setPlugins(a),l.parse(n,s)}parseAsync(e,t){const n=this;return new Promise(function(s,r){n.parse(e,t,s,r)})}}function Wr(){let o={};return{get:function(e){return o[e]},add:function(e,t){o[e]=t},remove:function(e){delete o[e]},removeAll:function(){o={}}}}const b={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class zr{constructor(e){this.parser=e,this.name=b.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,s=t.length;n<s;n++){const r=t[n];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let s=t.cache.get(n);if(s)return s;const r=t.json,c=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let l;const h=new k(16777215);c.color!==void 0&&h.fromArray(c.color);const u=c.range!==void 0?c.range:0;switch(c.type){case"directional":l=new ns(h),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new zt(h),l.distance=u;break;case"spot":l=new ts(h),l.distance=u,c.spot=c.spot||{},c.spot.innerConeAngle=c.spot.innerConeAngle!==void 0?c.spot.innerConeAngle:0,c.spot.outerConeAngle=c.spot.outerConeAngle!==void 0?c.spot.outerConeAngle:Math.PI/4,l.angle=c.spot.outerConeAngle,l.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return l.position.set(0,0,0),l.decay=2,c.intensity!==void 0&&(l.intensity=c.intensity),l.name=t.createUniqueName(c.name||"light_"+e),s=Promise.resolve(l),t.cache.add(n,s),s}createNodeAttachment(e){const t=this,n=this.parser,r=n.json.nodes[e],a=(r.extensions&&r.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(c){return n._getNodeRef(t.cache,a,c)})}}class qr{constructor(){this.name=b.KHR_MATERIALS_UNLIT}getMaterialType(){return et}extendParams(e,t,n){const s=[];e.color=new k(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const i=r.baseColorFactor;e.color.fromArray(i),e.opacity=i[3]}r.baseColorTexture!==void 0&&s.push(n.assignTexture(e,"map",r.baseColorTexture,te))}return Promise.all(s)}}class $r{constructor(e){this.parser=e,this.name=b.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name].emissiveStrength;return r!==void 0&&(t.emissiveIntensity=r),Promise.resolve()}}class ei{constructor(e){this.parser=e,this.name=b.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:we}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],i=s.extensions[this.name];if(i.clearcoatFactor!==void 0&&(t.clearcoat=i.clearcoatFactor),i.clearcoatTexture!==void 0&&r.push(n.assignTexture(t,"clearcoatMap",i.clearcoatTexture)),i.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=i.clearcoatRoughnessFactor),i.clearcoatRoughnessTexture!==void 0&&r.push(n.assignTexture(t,"clearcoatRoughnessMap",i.clearcoatRoughnessTexture)),i.clearcoatNormalTexture!==void 0&&(r.push(n.assignTexture(t,"clearcoatNormalMap",i.clearcoatNormalTexture)),i.clearcoatNormalTexture.scale!==void 0)){const a=i.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Dt(a,a)}return Promise.all(r)}}class ti{constructor(e){this.parser=e,this.name=b.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:we}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],i=s.extensions[this.name];return i.iridescenceFactor!==void 0&&(t.iridescence=i.iridescenceFactor),i.iridescenceTexture!==void 0&&r.push(n.assignTexture(t,"iridescenceMap",i.iridescenceTexture)),i.iridescenceIor!==void 0&&(t.iridescenceIOR=i.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),i.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=i.iridescenceThicknessMinimum),i.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=i.iridescenceThicknessMaximum),i.iridescenceThicknessTexture!==void 0&&r.push(n.assignTexture(t,"iridescenceThicknessMap",i.iridescenceThicknessTexture)),Promise.all(r)}}class ni{constructor(e){this.parser=e,this.name=b.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:we}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new k(0,0,0),t.sheenRoughness=0,t.sheen=1;const i=s.extensions[this.name];return i.sheenColorFactor!==void 0&&t.sheenColor.fromArray(i.sheenColorFactor),i.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=i.sheenRoughnessFactor),i.sheenColorTexture!==void 0&&r.push(n.assignTexture(t,"sheenColorMap",i.sheenColorTexture,te)),i.sheenRoughnessTexture!==void 0&&r.push(n.assignTexture(t,"sheenRoughnessMap",i.sheenRoughnessTexture)),Promise.all(r)}}class si{constructor(e){this.parser=e,this.name=b.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:we}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],i=s.extensions[this.name];return i.transmissionFactor!==void 0&&(t.transmission=i.transmissionFactor),i.transmissionTexture!==void 0&&r.push(n.assignTexture(t,"transmissionMap",i.transmissionTexture)),Promise.all(r)}}class ri{constructor(e){this.parser=e,this.name=b.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:we}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],i=s.extensions[this.name];t.thickness=i.thicknessFactor!==void 0?i.thicknessFactor:0,i.thicknessTexture!==void 0&&r.push(n.assignTexture(t,"thicknessMap",i.thicknessTexture)),t.attenuationDistance=i.attenuationDistance||0;const a=i.attenuationColor||[1,1,1];return t.attenuationColor=new k(a[0],a[1],a[2]),Promise.all(r)}}class ii{constructor(e){this.parser=e,this.name=b.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:we}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name];return t.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}}class oi{constructor(e){this.parser=e,this.name=b.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:we}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],i=s.extensions[this.name];t.specularIntensity=i.specularFactor!==void 0?i.specularFactor:1,i.specularTexture!==void 0&&r.push(n.assignTexture(t,"specularIntensityMap",i.specularTexture));const a=i.specularColorFactor||[1,1,1];return t.specularColor=new k(a[0],a[1],a[2]),i.specularColorTexture!==void 0&&r.push(n.assignTexture(t,"specularColorMap",i.specularColorTexture,te)),Promise.all(r)}}class ai{constructor(e){this.parser=e,this.name=b.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,s=n.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const r=s.extensions[this.name],i=t.options.ktx2Loader;if(!i){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,i)}}class ci{constructor(e){this.parser=e,this.name=b.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,s=n.json,r=s.textures[e];if(!r.extensions||!r.extensions[t])return null;const i=r.extensions[t],a=s.images[i.source];let c=n.textureLoader;if(a.uri){const l=n.options.manager.getHandler(a.uri);l!==null&&(c=l)}return this.detectSupport().then(function(l){if(l)return n.loadTextureImage(e,i.source,c);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class li{constructor(e){this.name=b.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const s=n.extensions[this.name],r=this.parser.getDependency("buffer",s.buffer),i=this.parser.options.meshoptDecoder;if(!i||!i.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([r,i.ready]).then(function(a){const c=s.byteOffset||0,l=s.byteLength||0,h=s.count,u=s.byteStride,f=new ArrayBuffer(h*u),p=new Uint8Array(a[0],c,l);return i.decodeGltfBuffer(new Uint8Array(f),h,u,p,s.mode,s.filter),f})}else return null}}const ps="glTF",ze=12,On={JSON:1313821514,BIN:5130562};class ui{constructor(e){this.name=b.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,ze);if(this.header={magic:he.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==ps)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-ze,s=new DataView(e,ze);let r=0;for(;r<n;){const i=s.getUint32(r,!0);r+=4;const a=s.getUint32(r,!0);if(r+=4,a===On.JSON){const c=new Uint8Array(e,ze+r,i);this.content=he.decodeText(c)}else if(a===On.BIN){const c=ze+r;this.body=e.slice(c,c+i)}r+=i}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class hi{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=b.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,s=this.dracoLoader,r=e.extensions[this.name].bufferView,i=e.extensions[this.name].attributes,a={},c={},l={};for(const h in i){const u=nn[h]||h.toLowerCase();a[u]=i[h]}for(const h in e.attributes){const u=nn[h]||h.toLowerCase();if(i[h]!==void 0){const f=n.accessors[e.attributes[h]],p=ct[f.componentType];l[u]=p,c[u]=f.normalized===!0}}return t.getDependency("bufferView",r).then(function(h){return new Promise(function(u){s.decodeDracoFile(h,function(f){for(const p in f.attributes){const A=f.attributes[p],B=c[p];B!==void 0&&(A.normalized=B)}u(f)},a,l)})})}}class fi{constructor(){this.name=b.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return t.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class tn extends pn{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),n=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),s=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),r=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),i=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),a={specular:{value:new k().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(c){for(const l in a)c.uniforms[l]=a[l];c.fragmentShader=c.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",s).replace("#include <metalnessmap_fragment>",r).replace("#include <lights_physical_fragment>",i)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(c){a.specular.value=c}},specularMap:{get:function(){return a.specularMap.value},set:function(c){a.specularMap.value=c,c?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return a.glossiness.value},set:function(c){a.glossiness.value=c}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(c){a.glossinessMap.value=c,c?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class pi{constructor(){this.name=b.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return tn}extendParams(e,t,n){const s=t.extensions[this.name];e.color=new k(1,1,1),e.opacity=1;const r=[];if(Array.isArray(s.diffuseFactor)){const i=s.diffuseFactor;e.color.fromArray(i),e.opacity=i[3]}if(s.diffuseTexture!==void 0&&r.push(n.assignTexture(e,"map",s.diffuseTexture,te)),e.emissive=new k(0,0,0),e.glossiness=s.glossinessFactor!==void 0?s.glossinessFactor:1,e.specular=new k(1,1,1),Array.isArray(s.specularFactor)&&e.specular.fromArray(s.specularFactor),s.specularGlossinessTexture!==void 0){const i=s.specularGlossinessTexture;r.push(n.assignTexture(e,"glossinessMap",i)),r.push(n.assignTexture(e,"specularMap",i,te))}return Promise.all(r)}createMaterial(e){const t=new tn(e);return t.fog=!0,t.color=e.color,t.map=e.map===void 0?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=e.aoMap===void 0?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=e.emissiveIntensity===void 0?1:e.emissiveIntensity,t.emissiveMap=e.emissiveMap===void 0?null:e.emissiveMap,t.bumpMap=e.bumpMap===void 0?null:e.bumpMap,t.bumpScale=1,t.normalMap=e.normalMap===void 0?null:e.normalMap,t.normalMapType=rr,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=e.specularMap===void 0?null:e.specularMap,t.specular=e.specular,t.glossinessMap=e.glossinessMap===void 0?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=e.envMap===void 0?null:e.envMap,t.envMapIntensity=1,t}}class Ai{constructor(){this.name=b.KHR_MESH_QUANTIZATION}}class dn extends ir{constructor(e,t,n,s){super(e,t,n,s)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,s=this.valueSize,r=e*s*3+s;for(let i=0;i!==s;i++)t[i]=n[r+i];return t}}dn.prototype.interpolate_=function(o,e,t,n){const s=this.resultBuffer,r=this.sampleValues,i=this.valueSize,a=i*2,c=i*3,l=n-e,h=(t-e)/l,u=h*h,f=u*h,p=o*c,A=p-c,B=-2*f+3*u,m=f-u,g=1-B,C=m-u+h;for(let d=0;d!==i;d++){const F=r[A+d+i],v=r[A+d+a]*l,y=r[p+d+i],M=r[p+d]*l;s[d]=g*F+C*v+B*y+m*M}return s};const di=new tt;class Bi extends dn{interpolate_(e,t,n,s){const r=super.interpolate_(e,t,n,s);return di.fromArray(r).normalize().toArray(r),r}}const me={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},ct={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Jn={9728:or,9729:Ue,9984:ar,9985:cr,9986:lr,9987:An},Un={33071:qt,33648:ur,10497:Je},_n={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},nn={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Ee={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},mi={CUBICSPLINE:void 0,LINEAR:ss,STEP:hr},Nt={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function gi(o){return o.DefaultMaterial===void 0&&(o.DefaultMaterial=new pn({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:$n})),o.DefaultMaterial}function qe(o,e,t){for(const n in t.extensions)o[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function Re(o,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(o.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Ci(o,e,t){let n=!1,s=!1,r=!1;for(let l=0,h=e.length;l<h;l++){const u=e[l];if(u.POSITION!==void 0&&(n=!0),u.NORMAL!==void 0&&(s=!0),u.COLOR_0!==void 0&&(r=!0),n&&s&&r)break}if(!n&&!s&&!r)return Promise.resolve(o);const i=[],a=[],c=[];for(let l=0,h=e.length;l<h;l++){const u=e[l];if(n){const f=u.POSITION!==void 0?t.getDependency("accessor",u.POSITION):o.attributes.position;i.push(f)}if(s){const f=u.NORMAL!==void 0?t.getDependency("accessor",u.NORMAL):o.attributes.normal;a.push(f)}if(r){const f=u.COLOR_0!==void 0?t.getDependency("accessor",u.COLOR_0):o.attributes.color;c.push(f)}}return Promise.all([Promise.all(i),Promise.all(a),Promise.all(c)]).then(function(l){const h=l[0],u=l[1],f=l[2];return n&&(o.morphAttributes.position=h),s&&(o.morphAttributes.normal=u),r&&(o.morphAttributes.color=f),o.morphTargetsRelative=!0,o})}function Fi(o,e){if(o.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)o.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(o.morphTargetInfluences.length===t.length){o.morphTargetDictionary={};for(let n=0,s=t.length;n<s;n++)o.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Ei(o){const e=o.extensions&&o.extensions[b.KHR_DRACO_MESH_COMPRESSION];let t;return e?t="draco:"+e.bufferView+":"+e.indices+":"+kn(e.attributes):t=o.indices+":"+kn(o.attributes)+":"+o.mode,t}function kn(o){let e="";const t=Object.keys(o).sort();for(let n=0,s=t.length;n<s;n++)e+=t[n]+":"+o[t[n]]+";";return e}function sn(o){switch(o){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function yi(o){return o.search(/\.jpe?g($|\?)/i)>0||o.search(/^data\:image\/jpeg/)===0?"image/jpeg":o.search(/\.webp($|\?)/i)>0||o.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}class Mi{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Wr,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,s=navigator.userAgent.indexOf("Firefox")>-1,r=s?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;typeof createImageBitmap=="undefined"||n||s&&r<98?this.textureLoader=new fn(this.options.manager):this.textureLoader=new fr(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new de(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,s=this.json,r=this.extensions;this.cache.removeAll(),this._invokeAll(function(i){return i._markDefs&&i._markDefs()}),Promise.all(this._invokeAll(function(i){return i.beforeRoot&&i.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(i){const a={scene:i[0][s.scene||0],scenes:i[0],animations:i[1],cameras:i[2],asset:s.asset,parser:n,userData:{}};qe(r,a,s),Re(a,s),Promise.all(n._invokeAll(function(c){return c.afterRoot&&c.afterRoot(a)})).then(function(){e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let s=0,r=t.length;s<r;s++){const i=t[s].joints;for(let a=0,c=i.length;a<c;a++)e[i[a]].isBone=!0}for(let s=0,r=e.length;s<r;s++){const i=e[s];i.mesh!==void 0&&(this._addNodeRef(this.meshCache,i.mesh),i.skin!==void 0&&(n[i.mesh].isSkinnedMesh=!0)),i.camera!==void 0&&this._addNodeRef(this.cameraCache,i.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const s=n.clone(),r=(i,a)=>{const c=this.associations.get(i);c!=null&&this.associations.set(a,c);for(const[l,h]of i.children.entries())r(h,a.children[l])};return r(n,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const s=e(t[n]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let s=0;s<t.length;s++){const r=e(t[s]);r&&n.push(r)}return n}getDependency(e,t){const n=e+":"+t;let s=this.cache.get(n);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this.loadNode(t);break;case"mesh":s=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(t)});break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(t)});break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(t)});break;case"texture":s=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(t)});break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne(function(r){return r.loadAnimation&&r.loadAnimation(t)});break;case"camera":s=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(s.map(function(r,i){return n.getDependency(e,i)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[b.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(r,i){n.load(he.resolveURL(t.uri,s.path),r,void 0,function(){i(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const s=t.byteLength||0,r=t.byteOffset||0;return n.slice(r,r+s)})}loadAccessor(e){const t=this,n=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0)return Promise.resolve(null);const r=[];return s.bufferView!==void 0?r.push(this.getDependency("bufferView",s.bufferView)):r.push(null),s.sparse!==void 0&&(r.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(r).then(function(i){const a=i[0],c=_n[s.type],l=ct[s.componentType],h=l.BYTES_PER_ELEMENT,u=h*c,f=s.byteOffset||0,p=s.bufferView!==void 0?n.bufferViews[s.bufferView].byteStride:void 0,A=s.normalized===!0;let B,m;if(p&&p!==u){const g=Math.floor(f/p),C="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+g+":"+s.count;let d=t.cache.get(C);d||(B=new l(a,g*p,s.count*p/h),d=new pr(B,p/h),t.cache.add(C,d)),m=new Ar(d,c,f%p/h,A)}else a===null?B=new l(s.count*c):B=new l(a,f,s.count*c),m=new wt(B,c,A);if(s.sparse!==void 0){const g=_n.SCALAR,C=ct[s.sparse.indices.componentType],d=s.sparse.indices.byteOffset||0,F=s.sparse.values.byteOffset||0,v=new C(i[1],d,s.sparse.count*g),y=new l(i[2],F,s.sparse.count*c);a!==null&&(m=new wt(m.array.slice(),m.itemSize,m.normalized));for(let M=0,E=v.length;M<E;M++){const I=v[M];if(m.setX(I,y[M*c]),c>=2&&m.setY(I,y[M*c+1]),c>=3&&m.setZ(I,y[M*c+2]),c>=4&&m.setW(I,y[M*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return m})}loadTexture(e){const t=this.json,n=this.options,r=t.textures[e].source,i=t.images[r];let a=this.textureLoader;if(i.uri){const c=n.manager.getHandler(i.uri);c!==null&&(a=c)}return this.loadTextureImage(e,r,a)}loadTextureImage(e,t,n){const s=this,r=this.json,i=r.textures[e],a=r.images[t],c=(a.uri||a.bufferView)+":"+i.sampler;if(this.textureCache[c])return this.textureCache[c];const l=this.loadImageSource(t,n).then(function(h){h.flipY=!1,i.name&&(h.name=i.name);const f=(r.samplers||{})[i.sampler]||{};return h.magFilter=Jn[f.magFilter]||Ue,h.minFilter=Jn[f.minFilter]||An,h.wrapS=Un[f.wrapS]||Je,h.wrapT=Un[f.wrapT]||Je,s.associations.set(h,{textures:e}),h}).catch(function(){return null});return this.textureCache[c]=l,l}loadImageSource(e,t){const n=this,s=this.json,r=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(u=>u.clone());const i=s.images[e],a=self.URL||self.webkitURL;let c=i.uri||"",l=!1;if(i.bufferView!==void 0)c=n.getDependency("bufferView",i.bufferView).then(function(u){l=!0;const f=new Blob([u],{type:i.mimeType});return c=a.createObjectURL(f),c});else if(i.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(c).then(function(u){return new Promise(function(f,p){let A=f;t.isImageBitmapLoader===!0&&(A=function(B){const m=new Lt(B);m.needsUpdate=!0,f(m)}),t.load(he.resolveURL(u,r.path),A,void 0,p)})}).then(function(u){return l===!0&&a.revokeObjectURL(c),u.userData.mimeType=i.mimeType||yi(i.uri),u}).catch(function(u){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),u});return this.sourceCache[e]=h,h}assignTexture(e,t,n,s){const r=this;return this.getDependency("texture",n.index).then(function(i){if(n.texCoord!==void 0&&n.texCoord!=0&&!(t==="aoMap"&&n.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),r.extensions[b.KHR_TEXTURE_TRANSFORM]){const a=n.extensions!==void 0?n.extensions[b.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const c=r.associations.get(i);i=r.extensions[b.KHR_TEXTURE_TRANSFORM].extendTexture(i,a),r.associations.set(i,c)}}return s!==void 0&&(i.encoding=s),e[t]=i,i})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const s=t.attributes.tangent===void 0,r=t.attributes.color!==void 0,i=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+n.uuid;let c=this.cache.get(a);c||(c=new $e,rt.prototype.copy.call(c,n),c.color.copy(n.color),c.map=n.map,c.sizeAttenuation=!1,this.cache.add(a,c)),n=c}else if(e.isLine){const a="LineBasicMaterial:"+n.uuid;let c=this.cache.get(a);c||(c=new st,rt.prototype.copy.call(c,n),c.color.copy(n.color),this.cache.add(a,c)),n=c}if(s||r||i){let a="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(a+="specular-glossiness:"),s&&(a+="derivative-tangents:"),r&&(a+="vertex-colors:"),i&&(a+="flat-shading:");let c=this.cache.get(a);c||(c=n.clone(),r&&(c.vertexColors=!0),i&&(c.flatShading=!0),s&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(a,c),this.associations.set(c,this.associations.get(n))),n=c}n.aoMap&&t.attributes.uv2===void 0&&t.attributes.uv!==void 0&&t.setAttribute("uv2",t.attributes.uv),e.material=n}getMaterialType(){return pn}loadMaterial(e){const t=this,n=this.json,s=this.extensions,r=n.materials[e];let i;const a={},c=r.extensions||{},l=[];if(c[b.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const u=s[b.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];i=u.getMaterialType(),l.push(u.extendParams(a,r,t))}else if(c[b.KHR_MATERIALS_UNLIT]){const u=s[b.KHR_MATERIALS_UNLIT];i=u.getMaterialType(),l.push(u.extendParams(a,r,t))}else{const u=r.pbrMetallicRoughness||{};if(a.color=new k(1,1,1),a.opacity=1,Array.isArray(u.baseColorFactor)){const f=u.baseColorFactor;a.color.fromArray(f),a.opacity=f[3]}u.baseColorTexture!==void 0&&l.push(t.assignTexture(a,"map",u.baseColorTexture,te)),a.metalness=u.metallicFactor!==void 0?u.metallicFactor:1,a.roughness=u.roughnessFactor!==void 0?u.roughnessFactor:1,u.metallicRoughnessTexture!==void 0&&(l.push(t.assignTexture(a,"metalnessMap",u.metallicRoughnessTexture)),l.push(t.assignTexture(a,"roughnessMap",u.metallicRoughnessTexture))),i=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(e,a)})))}r.doubleSided===!0&&(a.side=dr);const h=r.alphaMode||Nt.OPAQUE;if(h===Nt.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,h===Nt.MASK&&(a.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&i!==et&&(l.push(t.assignTexture(a,"normalMap",r.normalTexture)),a.normalScale=new Dt(1,1),r.normalTexture.scale!==void 0)){const u=r.normalTexture.scale;a.normalScale.set(u,u)}return r.occlusionTexture!==void 0&&i!==et&&(l.push(t.assignTexture(a,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&i!==et&&(a.emissive=new k().fromArray(r.emissiveFactor)),r.emissiveTexture!==void 0&&i!==et&&l.push(t.assignTexture(a,"emissiveMap",r.emissiveTexture,te)),Promise.all(l).then(function(){let u;return i===tn?u=s[b.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):u=new i(a),r.name&&(u.name=r.name),Re(u,r),t.associations.set(u,{materials:e}),r.extensions&&qe(s,u,r),u})}createUniqueName(e){const t=at.sanitizeNodeName(e||"");let n=t;for(let s=1;this.nodeNamesUsed[n];++s)n=t+"_"+s;return this.nodeNamesUsed[n]=!0,n}loadGeometries(e){const t=this,n=this.extensions,s=this.primitiveCache;function r(a){return n[b.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(c){return Kn(c,a,t)})}const i=[];for(let a=0,c=e.length;a<c;a++){const l=e[a],h=Ei(l),u=s[h];if(u)i.push(u.promise);else{let f;l.extensions&&l.extensions[b.KHR_DRACO_MESH_COMPRESSION]?f=r(l):f=Kn(new Me,l,t),s[h]={primitive:l,promise:f},i.push(f)}}return Promise.all(i)}loadMesh(e){const t=this,n=this.json,s=this.extensions,r=n.meshes[e],i=r.primitives,a=[];for(let c=0,l=i.length;c<l;c++){const h=i[c].material===void 0?gi(this.cache):this.getDependency("material",i[c].material);a.push(h)}return a.push(t.loadGeometries(i)),Promise.all(a).then(function(c){const l=c.slice(0,c.length-1),h=c[c.length-1],u=[];for(let p=0,A=h.length;p<A;p++){const B=h[p],m=i[p];let g;const C=l[p];if(m.mode===me.TRIANGLES||m.mode===me.TRIANGLE_STRIP||m.mode===me.TRIANGLE_FAN||m.mode===void 0)g=r.isSkinnedMesh===!0?new rs(B,C):new Gt(B,C),g.isSkinnedMesh===!0&&!g.geometry.attributes.skinWeight.normalized&&g.normalizeSkinWeights(),m.mode===me.TRIANGLE_STRIP?g.geometry=Nn(g.geometry,Br):m.mode===me.TRIANGLE_FAN&&(g.geometry=Nn(g.geometry,is));else if(m.mode===me.LINES)g=new Wt(B,C);else if(m.mode===me.LINE_STRIP)g=new os(B,C);else if(m.mode===me.LINE_LOOP)g=new mr(B,C);else if(m.mode===me.POINTS)g=new Mt(B,C);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+m.mode);Object.keys(g.geometry.morphAttributes).length>0&&Fi(g,r),g.name=t.createUniqueName(r.name||"mesh_"+e),Re(g,r),m.extensions&&qe(s,g,m),t.assignFinalMaterial(g),u.push(g)}for(let p=0,A=u.length;p<A;p++)t.associations.set(u[p],{meshes:e,primitives:p});if(u.length===1)return u[0];const f=new Oe;t.associations.set(f,{meshes:e});for(let p=0,A=u.length;p<A;p++)f.add(u[p]);return f})}loadCamera(e){let t;const n=this.json.cameras[e],s=n[n.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new as(ue.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):n.type==="orthographic"&&(t=new cs(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),Re(t,n),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],n={joints:t.joints};return t.inverseBindMatrices===void 0?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then(function(s){return n.inverseBindMatrices=s,n})}loadAnimation(e){const n=this.json.animations[e],s=[],r=[],i=[],a=[],c=[];for(let l=0,h=n.channels.length;l<h;l++){const u=n.channels[l],f=n.samplers[u.sampler],p=u.target,A=p.node!==void 0?p.node:p.id,B=n.parameters!==void 0?n.parameters[f.input]:f.input,m=n.parameters!==void 0?n.parameters[f.output]:f.output;s.push(this.getDependency("node",A)),r.push(this.getDependency("accessor",B)),i.push(this.getDependency("accessor",m)),a.push(f),c.push(p)}return Promise.all([Promise.all(s),Promise.all(r),Promise.all(i),Promise.all(a),Promise.all(c)]).then(function(l){const h=l[0],u=l[1],f=l[2],p=l[3],A=l[4],B=[];for(let g=0,C=h.length;g<C;g++){const d=h[g],F=u[g],v=f[g],y=p[g],M=A[g];if(d===void 0)continue;d.updateMatrix(),d.matrixAutoUpdate=!0;let E;switch(Ee[M.path]){case Ee.weights:E=us;break;case Ee.rotation:E=$t;break;case Ee.position:case Ee.scale:default:E=ls;break}const I=d.name?d.name:d.uuid,T=y.interpolation!==void 0?mi[y.interpolation]:ss,R=[];Ee[M.path]===Ee.weights?d.traverse(function(G){G.morphTargetInfluences&&R.push(G.name?G.name:G.uuid)}):R.push(I);let D=v.array;if(v.normalized){const G=sn(D.constructor),w=new Float32Array(D.length);for(let L=0,P=D.length;L<P;L++)w[L]=D[L]*G;D=w}for(let G=0,w=R.length;G<w;G++){const L=new E(R[G]+"."+Ee[M.path],F.array,D,T);y.interpolation==="CUBICSPLINE"&&(L.createInterpolant=function(x){const J=this instanceof $t?Bi:dn;return new J(this.times,this.values,this.getValueSize()/3,x)},L.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),B.push(L)}}const m=n.name?n.name:"animation_"+e;return new hs(m,void 0,B)})}createNodeMesh(e){const t=this.json,n=this,s=t.nodes[e];return s.mesh===void 0?null:n.getDependency("mesh",s.mesh).then(function(r){const i=n._getNodeRef(n.meshCache,s.mesh,r);return s.weights!==void 0&&i.traverse(function(a){if(!!a.isMesh)for(let c=0,l=s.weights.length;c<l;c++)a.morphTargetInfluences[c]=s.weights[c]}),i})}loadNode(e){const t=this.json,n=this.extensions,s=this,r=t.nodes[e],i=r.name?s.createUniqueName(r.name):"";return function(){const a=[],c=s._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(e)});return c&&a.push(c),r.camera!==void 0&&a.push(s.getDependency("camera",r.camera).then(function(l){return s._getNodeRef(s.cameraCache,r.camera,l)})),s._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(e)}).forEach(function(l){a.push(l)}),Promise.all(a)}().then(function(a){let c;if(r.isBone===!0?c=new en:a.length>1?c=new Oe:a.length===1?c=a[0]:c=new Tt,c!==a[0])for(let l=0,h=a.length;l<h;l++)c.add(a[l]);if(r.name&&(c.userData.name=r.name,c.name=i),Re(c,r),r.extensions&&qe(n,c,r),r.matrix!==void 0){const l=new _;l.fromArray(r.matrix),c.applyMatrix4(l)}else r.translation!==void 0&&c.position.fromArray(r.translation),r.rotation!==void 0&&c.quaternion.fromArray(r.rotation),r.scale!==void 0&&c.scale.fromArray(r.scale);return s.associations.has(c)||s.associations.set(c,{}),s.associations.get(c).nodes=e,c})}loadScene(e){const t=this.json,n=this.extensions,s=this.json.scenes[e],r=this,i=new Oe;s.name&&(i.name=r.createUniqueName(s.name)),Re(i,s),s.extensions&&qe(n,i,s);const a=s.nodes||[],c=[];for(let l=0,h=a.length;l<h;l++)c.push(As(a[l],i,t,r));return Promise.all(c).then(function(){const l=h=>{const u=new Map;for(const[f,p]of r.associations)(f instanceof rt||f instanceof Lt)&&u.set(f,p);return h.traverse(f=>{const p=r.associations.get(f);p!=null&&u.set(f,p)}),u};return r.associations=l(i),i})}}function As(o,e,t,n){const s=t.nodes[o];return n.getDependency("node",o).then(function(r){if(s.skin===void 0)return r;let i;return n.getDependency("skin",s.skin).then(function(a){i=a;const c=[];for(let l=0,h=i.joints.length;l<h;l++)c.push(n.getDependency("node",i.joints[l]));return Promise.all(c)}).then(function(a){return r.traverse(function(c){if(!c.isMesh)return;const l=[],h=[];for(let u=0,f=a.length;u<f;u++){const p=a[u];if(p){l.push(p);const A=new _;i.inverseBindMatrices!==void 0&&A.fromArray(i.inverseBindMatrices.array,u*16),h.push(A)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',i.joints[u])}c.bind(new fs(l,h),c.matrixWorld)}),r})}).then(function(r){e.add(r);const i=[];if(s.children){const a=s.children;for(let c=0,l=a.length;c<l;c++){const h=a[c];i.push(As(h,r,t,n))}}return Promise.all(i)})}function Ti(o,e,t){const n=e.attributes,s=new gr;if(n.POSITION!==void 0){const a=t.json.accessors[n.POSITION],c=a.min,l=a.max;if(c!==void 0&&l!==void 0){if(s.set(new V(c[0],c[1],c[2]),new V(l[0],l[1],l[2])),a.normalized){const h=sn(ct[a.componentType]);s.min.multiplyScalar(h),s.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const r=e.targets;if(r!==void 0){const a=new V,c=new V;for(let l=0,h=r.length;l<h;l++){const u=r[l];if(u.POSITION!==void 0){const f=t.json.accessors[u.POSITION],p=f.min,A=f.max;if(p!==void 0&&A!==void 0){if(c.setX(Math.max(Math.abs(p[0]),Math.abs(A[0]))),c.setY(Math.max(Math.abs(p[1]),Math.abs(A[1]))),c.setZ(Math.max(Math.abs(p[2]),Math.abs(A[2]))),f.normalized){const B=sn(ct[f.componentType]);c.multiplyScalar(B)}a.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(a)}o.boundingBox=s;const i=new Cr;s.getCenter(i.center),i.radius=s.min.distanceTo(s.max)/2,o.boundingSphere=i}function Kn(o,e,t){const n=e.attributes,s=[];function r(i,a){return t.getDependency("accessor",i).then(function(c){o.setAttribute(a,c)})}for(const i in n){const a=nn[i]||i.toLowerCase();a in o.attributes||s.push(r(n[i],a))}if(e.indices!==void 0&&!o.index){const i=t.getDependency("accessor",e.indices).then(function(a){o.setIndex(a)});s.push(i)}return Re(o,e),Ti(o,e,t),Promise.all(s).then(function(){return e.targets!==void 0?Ci(o,e.targets,t):o})}function Nn(o,e){let t=o.getIndex();if(t===null){const i=[],a=o.getAttribute("position");if(a!==void 0){for(let c=0;c<a.count;c++)i.push(c);o.setIndex(i),t=o.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),o}const n=t.count-2,s=[];if(e===is)for(let i=1;i<=n;i++)s.push(t.getX(0)),s.push(t.getX(i)),s.push(t.getX(i+1));else for(let i=0;i<n;i++)i%2===0?(s.push(t.getX(i)),s.push(t.getX(i+1)),s.push(t.getX(i+2))):(s.push(t.getX(i+2)),s.push(t.getX(i+1)),s.push(t.getX(i)));s.length/3!==n&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=o.clone();return r.setIndex(s),r}/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var jn={},rn=function(o){return URL.createObjectURL(new Blob([o],{type:"text/javascript"}))},ds=function(o){return new Worker(o)};try{URL.revokeObjectURL(rn(""))}catch{rn=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},ds=function(e){return new Worker(e,{type:"module"})}}var vi=function(o,e,t,n,s){var r=ds(jn[e]||(jn[e]=rn(o)));return r.onerror=function(i){return s(i.error,null)},r.onmessage=function(i){return s(null,i.data)},r.postMessage(t,n),r},H=Uint8Array,Q=Uint16Array,Ce=Uint32Array,Ke=new H([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ne=new H([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),lt=new H([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Bs=function(o,e){for(var t=new Q(31),n=0;n<31;++n)t[n]=e+=1<<o[n-1];for(var s=new Ce(t[30]),n=1;n<30;++n)for(var r=t[n];r<t[n+1];++r)s[r]=r-t[n]<<5|n;return[t,s]},ms=Bs(Ke,2),Bn=ms[0],St=ms[1];Bn[28]=258,St[258]=28;var gs=Bs(Ne,0),Cs=gs[0],on=gs[1],ut=new Q(32768);for(var U=0;U<32768;++U){var ye=(U&43690)>>>1|(U&21845)<<1;ye=(ye&52428)>>>2|(ye&13107)<<2,ye=(ye&61680)>>>4|(ye&3855)<<4,ut[U]=((ye&65280)>>>8|(ye&255)<<8)>>>1}var oe=function(o,e,t){for(var n=o.length,s=0,r=new Q(e);s<n;++s)++r[o[s]-1];var i=new Q(e);for(s=0;s<e;++s)i[s]=i[s-1]+r[s-1]<<1;var a;if(t){a=new Q(1<<e);var c=15-e;for(s=0;s<n;++s)if(o[s])for(var l=s<<4|o[s],h=e-o[s],u=i[o[s]-1]++<<h,f=u|(1<<h)-1;u<=f;++u)a[ut[u]>>>c]=l}else for(a=new Q(n),s=0;s<n;++s)o[s]&&(a[s]=ut[i[o[s]-1]++]>>>15-o[s]);return a},Fe=new H(288);for(var U=0;U<144;++U)Fe[U]=8;for(var U=144;U<256;++U)Fe[U]=9;for(var U=256;U<280;++U)Fe[U]=7;for(var U=280;U<288;++U)Fe[U]=8;var _e=new H(32);for(var U=0;U<32;++U)_e[U]=5;var Fs=oe(Fe,9,0),Es=oe(Fe,9,1),ys=oe(_e,5,0),Ms=oe(_e,5,1),vt=function(o){for(var e=o[0],t=1;t<o.length;++t)o[t]>e&&(e=o[t]);return e},re=function(o,e,t){var n=e/8|0;return(o[n]|o[n+1]<<8)>>(e&7)&t},It=function(o,e){var t=e/8|0;return(o[t]|o[t+1]<<8|o[t+2]<<16)>>(e&7)},pt=function(o){return(o/8|0)+(o&7&&1)},ae=function(o,e,t){(e==null||e<0)&&(e=0),(t==null||t>o.length)&&(t=o.length);var n=new(o instanceof Q?Q:o instanceof Ce?Ce:H)(t-e);return n.set(o.subarray(e,t)),n},At=function(o,e,t){var n=o.length;if(!n||t&&!t.l&&n<5)return e||new H(0);var s=!e||t,r=!t||t.i;t||(t={}),e||(e=new H(n*3));var i=function(mt){var We=e.length;if(mt>We){var Se=new H(Math.max(We*2,mt));Se.set(e),e=Se}},a=t.f||0,c=t.p||0,l=t.b||0,h=t.l,u=t.d,f=t.m,p=t.n,A=n*8;do{if(!h){t.f=a=re(o,c,1);var B=re(o,c+1,3);if(c+=3,B)if(B==1)h=Es,u=Ms,f=9,p=5;else if(B==2){var d=re(o,c,31)+257,F=re(o,c+10,15)+4,v=d+re(o,c+5,31)+1;c+=14;for(var y=new H(v),M=new H(19),E=0;E<F;++E)M[lt[E]]=re(o,c+E*3,7);c+=F*3;for(var I=vt(M),T=(1<<I)-1,R=oe(M,I,1),E=0;E<v;){var D=R[re(o,c,T)];c+=D&15;var m=D>>>4;if(m<16)y[E++]=m;else{var G=0,w=0;for(m==16?(w=3+re(o,c,3),c+=2,G=y[E-1]):m==17?(w=3+re(o,c,7),c+=3):m==18&&(w=11+re(o,c,127),c+=7);w--;)y[E++]=G}}var L=y.subarray(0,d),P=y.subarray(d);f=vt(L),p=vt(P),h=oe(L,f,1),u=oe(P,p,1)}else throw"invalid block type";else{var m=pt(c)+4,g=o[m-4]|o[m-3]<<8,C=m+g;if(C>n){if(r)throw"unexpected EOF";break}s&&i(l+g),e.set(o.subarray(m,C),l),t.b=l+=g,t.p=c=C*8;continue}if(c>A){if(r)throw"unexpected EOF";break}}s&&i(l+131072);for(var x=(1<<f)-1,J=(1<<p)-1,X=c;;X=c){var G=h[It(o,c)&x],ne=G>>>4;if(c+=G&15,c>A){if(r)throw"unexpected EOF";break}if(!G)throw"invalid length/literal";if(ne<256)e[l++]=ne;else if(ne==256){X=c,h=null;break}else{var W=ne-254;if(ne>264){var E=ne-257,le=Ke[E];W=re(o,c,(1<<le)-1)+Bn[E],c+=le}var fe=u[It(o,c)&J],q=fe>>>4;if(!fe)throw"invalid distance";c+=fe&15;var P=Cs[q];if(q>3){var le=Ne[q];P+=It(o,c)&(1<<le)-1,c+=le}if(c>A){if(r)throw"unexpected EOF";break}s&&i(l+131072);for(var Y=l+W;l<Y;l+=4)e[l]=e[l-P],e[l+1]=e[l+1-P],e[l+2]=e[l+2-P],e[l+3]=e[l+3-P];l=Y}}t.l=h,t.p=X,t.b=l,h&&(a=1,t.m=f,t.d=u,t.n=p)}while(!a);return l==e.length?e:ae(e,0,l)},pe=function(o,e,t){t<<=e&7;var n=e/8|0;o[n]|=t,o[n+1]|=t>>>8},He=function(o,e,t){t<<=e&7;var n=e/8|0;o[n]|=t,o[n+1]|=t>>>8,o[n+2]|=t>>>16},Rt=function(o,e){for(var t=[],n=0;n<o.length;++n)o[n]&&t.push({s:n,f:o[n]});var s=t.length,r=t.slice();if(!s)return[ge,0];if(s==1){var i=new H(t[0].s+1);return i[t[0].s]=1,[i,1]}t.sort(function(v,y){return v.f-y.f}),t.push({s:-1,f:25001});var a=t[0],c=t[1],l=0,h=1,u=2;for(t[0]={s:-1,f:a.f+c.f,l:a,r:c};h!=s-1;)a=t[t[l].f<t[u].f?l++:u++],c=t[l!=h&&t[l].f<t[u].f?l++:u++],t[h++]={s:-1,f:a.f+c.f,l:a,r:c};for(var f=r[0].s,n=1;n<s;++n)r[n].s>f&&(f=r[n].s);var p=new Q(f+1),A=bt(t[h-1],p,0);if(A>e){var n=0,B=0,m=A-e,g=1<<m;for(r.sort(function(y,M){return p[M.s]-p[y.s]||y.f-M.f});n<s;++n){var C=r[n].s;if(p[C]>e)B+=g-(1<<A-p[C]),p[C]=e;else break}for(B>>>=m;B>0;){var d=r[n].s;p[d]<e?B-=1<<e-p[d]++-1:++n}for(;n>=0&&B;--n){var F=r[n].s;p[F]==e&&(--p[F],++B)}A=e}return[new H(p),A]},bt=function(o,e,t){return o.s==-1?Math.max(bt(o.l,e,t+1),bt(o.r,e,t+1)):e[o.s]=t},an=function(o){for(var e=o.length;e&&!o[--e];);for(var t=new Q(++e),n=0,s=o[0],r=1,i=function(c){t[n++]=c},a=1;a<=e;++a)if(o[a]==s&&a!=e)++r;else{if(!s&&r>2){for(;r>138;r-=138)i(32754);r>2&&(i(r>10?r-11<<5|28690:r-3<<5|12305),r=0)}else if(r>3){for(i(s),--r;r>6;r-=6)i(8304);r>2&&(i(r-3<<5|8208),r=0)}for(;r--;)i(s);r=1,s=o[a]}return[t.subarray(0,n),e]},xe=function(o,e){for(var t=0,n=0;n<e.length;++n)t+=o[n]*e[n];return t},ot=function(o,e,t){var n=t.length,s=pt(e+2);o[s]=n&255,o[s+1]=n>>>8,o[s+2]=o[s]^255,o[s+3]=o[s+1]^255;for(var r=0;r<n;++r)o[s+r+4]=t[r];return(s+4+n)*8},cn=function(o,e,t,n,s,r,i,a,c,l,h){pe(e,h++,t),++s[256];for(var u=Rt(s,15),f=u[0],p=u[1],A=Rt(r,15),B=A[0],m=A[1],g=an(f),C=g[0],d=g[1],F=an(B),v=F[0],y=F[1],M=new Q(19),E=0;E<C.length;++E)M[C[E]&31]++;for(var E=0;E<v.length;++E)M[v[E]&31]++;for(var I=Rt(M,7),T=I[0],R=I[1],D=19;D>4&&!T[lt[D-1]];--D);var G=l+5<<3,w=xe(s,Fe)+xe(r,_e)+i,L=xe(s,f)+xe(r,B)+i+14+3*D+xe(M,T)+(2*M[16]+3*M[17]+7*M[18]);if(G<=w&&G<=L)return ot(e,h,o.subarray(c,c+l));var P,x,J,X;if(pe(e,h,1+(L<w)),h+=2,L<w){P=oe(f,p,0),x=f,J=oe(B,m,0),X=B;var ne=oe(T,R,0);pe(e,h,d-257),pe(e,h+5,y-1),pe(e,h+10,D-4),h+=14;for(var E=0;E<D;++E)pe(e,h+3*E,T[lt[E]]);h+=3*D;for(var W=[C,v],le=0;le<2;++le)for(var fe=W[le],E=0;E<fe.length;++E){var q=fe[E]&31;pe(e,h,ne[q]),h+=T[q],q>15&&(pe(e,h,fe[E]>>>5&127),h+=fe[E]>>>12)}}else P=Fs,x=Fe,J=ys,X=_e;for(var E=0;E<a;++E)if(n[E]>255){var q=n[E]>>>18&31;He(e,h,P[q+257]),h+=x[q+257],q>7&&(pe(e,h,n[E]>>>23&31),h+=Ke[q]);var Y=n[E]&31;He(e,h,J[Y]),h+=X[Y],Y>3&&(He(e,h,n[E]>>>5&8191),h+=Ne[Y])}else He(e,h,P[n[E]]),h+=x[n[E]];return He(e,h,P[256]),h+x[256]},Ts=new Ce([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),ge=new H(0),vs=function(o,e,t,n,s,r){var i=o.length,a=new H(n+i+5*(1+Math.ceil(i/7e3))+s),c=a.subarray(n,a.length-s),l=0;if(!e||i<8)for(var h=0;h<=i;h+=65535){var u=h+65535;u<i?l=ot(c,l,o.subarray(h,u)):(c[h]=r,l=ot(c,l,o.subarray(h,i)))}else{for(var f=Ts[e-1],p=f>>>13,A=f&8191,B=(1<<t)-1,m=new Q(32768),g=new Q(B+1),C=Math.ceil(t/3),d=2*C,F=function(_t){return(o[_t]^o[_t+1]<<C^o[_t+2]<<d)&B},v=new Ce(25e3),y=new Q(288),M=new Q(32),E=0,I=0,h=0,T=0,R=0,D=0;h<i;++h){var G=F(h),w=h&32767,L=g[G];if(m[w]=L,g[G]=w,R<=h){var P=i-h;if((E>7e3||T>24576)&&P>423){l=cn(o,c,0,v,y,M,I,T,D,h-D,l),T=E=I=0,D=h;for(var x=0;x<286;++x)y[x]=0;for(var x=0;x<30;++x)M[x]=0}var J=2,X=0,ne=A,W=w-L&32767;if(P>2&&G==F(h-W))for(var le=Math.min(p,P)-1,fe=Math.min(32767,h),q=Math.min(258,P);W<=fe&&--ne&&w!=L;){if(o[h+J]==o[h+J-W]){for(var Y=0;Y<q&&o[h+Y]==o[h+Y-W];++Y);if(Y>J){if(J=Y,X=W,Y>le)break;for(var mt=Math.min(W,Y-2),We=0,x=0;x<mt;++x){var Se=h-W+x+32768&32767,$s=m[Se],Dn=Se-$s+32768&32767;Dn>We&&(We=Dn,L=Se)}}}w=L,L=m[w],W+=w-L+32768&32767}if(X){v[T++]=268435456|St[J]<<18|on[X];var wn=St[J]&31,Ln=on[X]&31;I+=Ke[wn]+Ne[Ln],++y[257+wn],++M[Ln],R=h+J,++E}else v[T++]=o[h],++y[o[h]]}}l=cn(o,c,r,v,y,M,I,T,D,h-D,l),!r&&l&7&&(l=ot(c,l+1,ge))}return ae(a,0,n+pt(l)+s)},Is=function(){for(var o=new Ce(256),e=0;e<256;++e){for(var t=e,n=9;--n;)t=(t&1&&3988292384)^t>>>1;o[e]=t}return o}(),je=function(){var o=-1;return{p:function(e){for(var t=o,n=0;n<e.length;++n)t=Is[t&255^e[n]]^t>>>8;o=t},d:function(){return~o}}},mn=function(){var o=1,e=0;return{p:function(t){for(var n=o,s=e,r=t.length,i=0;i!=r;){for(var a=Math.min(i+2655,r);i<a;++i)s+=n+=t[i];n=(n&65535)+15*(n>>16),s=(s&65535)+15*(s>>16)}o=n,e=s},d:function(){return o%=65521,e%=65521,(o&255)<<24|o>>>8<<16|(e&255)<<8|e>>>8}}},Le=function(o,e,t,n,s){return vs(o,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(o.length)))*1.5):12+e.mem,t,n,!s)},dt=function(o,e){var t={};for(var n in o)t[n]=o[n];for(var n in e)t[n]=e[n];return t},Qn=function(o,e,t){for(var n=o(),s=o.toString(),r=s.slice(s.indexOf("[")+1,s.lastIndexOf("]")).replace(/ /g,"").split(","),i=0;i<n.length;++i){var a=n[i],c=r[i];if(typeof a=="function"){e+=";"+c+"=";var l=a.toString();if(a.prototype)if(l.indexOf("[native code]")!=-1){var h=l.indexOf(" ",8)+1;e+=l.slice(h,l.indexOf("(",h))}else{e+=l;for(var u in a.prototype)e+=";"+c+".prototype."+u+"="+a.prototype[u].toString()}else e+=l}else t[c]=a}return[e,t]},Et=[],Ii=function(o){var e=[];for(var t in o)(o[t]instanceof H||o[t]instanceof Q||o[t]instanceof Ce)&&e.push((o[t]=new o[t].constructor(o[t])).buffer);return e},Rs=function(o,e,t,n){var s;if(!Et[t]){for(var r="",i={},a=o.length-1,c=0;c<a;++c)s=Qn(o[c],r,i),r=s[0],i=s[1];Et[t]=Qn(o[a],r,i)}var l=dt({},Et[t][1]);return vi(Et[t][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",t,l,Ii(l),n)},Qe=function(){return[H,Q,Ce,Ke,Ne,lt,Bn,Cs,Es,Ms,ut,oe,vt,re,It,pt,ae,At,Ze,Ie,gn]},Xe=function(){return[H,Q,Ce,Ke,Ne,lt,St,on,Fs,Fe,ys,_e,ut,Ts,ge,oe,pe,He,Rt,bt,an,xe,ot,cn,pt,ae,vs,Le,Bt,Ie]},Gs=function(){return[Cn,En,O,je,Is]},Ds=function(){return[Fn,Ss]},ws=function(){return[yn,O,mn]},Ls=function(){return[bs]},Ie=function(o){return postMessage(o,[o.buffer])},gn=function(o){return o&&o.size&&new H(o.size)},Ve=function(o,e,t,n,s,r){var i=Rs(t,n,s,function(a,c){i.terminate(),r(a,c)});return i.postMessage([o,e],e.consume?[o.buffer]:[]),function(){i.terminate()}},ce=function(o){return o.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(e){return o.push(e.data[0],e.data[1])}},Ye=function(o,e,t,n,s){var r,i=Rs(o,n,s,function(a,c){a?(i.terminate(),e.ondata.call(e,a)):(c[1]&&i.terminate(),e.ondata.call(e,a,c[0],c[1]))});i.postMessage(t),e.push=function(a,c){if(r)throw"stream finished";if(!e.ondata)throw"no stream handler";i.postMessage([a,r=c],[a.buffer])},e.terminate=function(){i.terminate()}},z=function(o,e){return o[e]|o[e+1]<<8},N=function(o,e){return(o[e]|o[e+1]<<8|o[e+2]<<16|o[e+3]<<24)>>>0},jt=function(o,e){return N(o,e)+N(o,e+4)*4294967296},O=function(o,e,t){for(;t;++e)o[e]=t,t>>>=8},Cn=function(o,e){var t=e.filename;if(o[0]=31,o[1]=139,o[2]=8,o[8]=e.level<2?4:e.level==9?2:0,o[9]=3,e.mtime!=0&&O(o,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),t){o[3]=8;for(var n=0;n<=t.length;++n)o[n+10]=t.charCodeAt(n)}},Fn=function(o){if(o[0]!=31||o[1]!=139||o[2]!=8)throw"invalid gzip data";var e=o[3],t=10;e&4&&(t+=o[10]|(o[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!o[t++]);return t+(e&2)},Ss=function(o){var e=o.length;return(o[e-4]|o[e-3]<<8|o[e-2]<<16|o[e-1]<<24)>>>0},En=function(o){return 10+(o.filename&&o.filename.length+1||0)},yn=function(o,e){var t=e.level,n=t==0?0:t<6?1:t==9?3:2;o[0]=120,o[1]=n<<6|(n?32-2*n:1)},bs=function(o){if((o[0]&15)!=8||o[0]>>>4>7||(o[0]<<8|o[1])%31)throw"invalid zlib data";if(o[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function Mn(o,e){return!e&&typeof o=="function"&&(e=o,o={}),this.ondata=e,o}var Be=function(){function o(e,t){!t&&typeof e=="function"&&(t=e,e={}),this.ondata=t,this.o=e||{}}return o.prototype.p=function(e,t){this.ondata(Le(e,this.o,0,0,!t),t)},o.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},o}(),Hs=function(){function o(e,t){Ye([Xe,function(){return[ce,Be]}],this,Mn.call(this,e,t),function(n){var s=new Be(n.data);onmessage=ce(s)},6)}return o}();function xs(o,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Ve(o,e,[Xe],function(n){return Ie(Bt(n.data[0],n.data[1]))},0,t)}function Bt(o,e){return Le(o,e||{},0,0)}var ee=function(){function o(e){this.s={},this.p=new H(0),this.ondata=e}return o.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,n=new H(t+e.length);n.set(this.p),n.set(e,t),this.p=n},o.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,n=At(this.p,this.o,this.s);this.ondata(ae(n,t,this.s.b),this.d),this.o=ae(n,this.s.b-32768),this.s.b=this.o.length,this.p=ae(this.p,this.s.p/8|0),this.s.p&=7},o.prototype.push=function(e,t){this.e(e),this.c(t)},o}(),Tn=function(){function o(e){this.ondata=e,Ye([Qe,function(){return[ce,ee]}],this,0,function(){var t=new ee;onmessage=ce(t)},7)}return o}();function vn(o,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Ve(o,e,[Qe],function(n){return Ie(Ze(n.data[0],gn(n.data[1])))},1,t)}function Ze(o,e){return At(o,e)}var Ht=function(){function o(e,t){this.c=je(),this.l=0,this.v=1,Be.call(this,e,t)}return o.prototype.push=function(e,t){Be.prototype.push.call(this,e,t)},o.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var n=Le(e,this.o,this.v&&En(this.o),t&&8,!t);this.v&&(Cn(n,this.o),this.v=0),t&&(O(n,n.length-8,this.c.d()),O(n,n.length-4,this.l)),this.ondata(n,t)},o}(),Xn=function(){function o(e,t){Ye([Xe,Gs,function(){return[ce,Be,Ht]}],this,Mn.call(this,e,t),function(n){var s=new Ht(n.data);onmessage=ce(s)},8)}return o}();function Vn(o,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Ve(o,e,[Xe,Gs,function(){return[xt]}],function(n){return Ie(xt(n.data[0],n.data[1]))},2,t)}function xt(o,e){e||(e={});var t=je(),n=o.length;t.p(o);var s=Le(o,e,En(e),8),r=s.length;return Cn(s,e),O(s,r-8,t.d()),O(s,r-4,n),s}var Pt=function(){function o(e){this.v=1,ee.call(this,e)}return o.prototype.push=function(e,t){if(ee.prototype.e.call(this,e),this.v){var n=this.p.length>3?Fn(this.p):4;if(n>=this.p.length&&!t)return;this.p=this.p.subarray(n),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}ee.prototype.c.call(this,t)},o}(),Ps=function(){function o(e){this.ondata=e,Ye([Qe,Ds,function(){return[ce,ee,Pt]}],this,0,function(){var t=new Pt;onmessage=ce(t)},9)}return o}();function Os(o,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Ve(o,e,[Qe,Ds,function(){return[Ot]}],function(n){return Ie(Ot(n.data[0]))},3,t)}function Ot(o,e){return At(o.subarray(Fn(o),-8),e||new H(Ss(o)))}var ln=function(){function o(e,t){this.c=mn(),this.v=1,Be.call(this,e,t)}return o.prototype.push=function(e,t){Be.prototype.push.call(this,e,t)},o.prototype.p=function(e,t){this.c.p(e);var n=Le(e,this.o,this.v&&2,t&&4,!t);this.v&&(yn(n,this.o),this.v=0),t&&O(n,n.length-4,this.c.d()),this.ondata(n,t)},o}(),Ri=function(){function o(e,t){Ye([Xe,ws,function(){return[ce,Be,ln]}],this,Mn.call(this,e,t),function(n){var s=new ln(n.data);onmessage=ce(s)},10)}return o}();function Gi(o,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Ve(o,e,[Xe,ws,function(){return[un]}],function(n){return Ie(un(n.data[0],n.data[1]))},4,t)}function un(o,e){e||(e={});var t=mn();t.p(o);var n=Le(o,e,2,4);return yn(n,e),O(n,n.length-4,t.d()),n}var Jt=function(){function o(e){this.v=1,ee.call(this,e)}return o.prototype.push=function(e,t){if(ee.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}ee.prototype.c.call(this,t)},o}(),Js=function(){function o(e){this.ondata=e,Ye([Qe,Ls,function(){return[ce,ee,Jt]}],this,0,function(){var t=new Jt;onmessage=ce(t)},11)}return o}();function Us(o,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Ve(o,e,[Qe,Ls,function(){return[ht]}],function(n){return Ie(ht(n.data[0],gn(n.data[1])))},5,t)}function ht(o,e){return At((bs(o),o.subarray(2,-4)),e)}var _s=function(){function o(e){this.G=Pt,this.I=ee,this.Z=Jt,this.ondata=e}return o.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var n=new H(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var s=this,r=function(){s.ondata.apply(s,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(r):(this.p[0]&15)!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(r):new this.Z(r),this.s.push(this.p,t),this.p=null}}},o}(),Di=function(){function o(e){this.G=Ps,this.I=Tn,this.Z=Js,this.ondata=e}return o.prototype.push=function(e,t){_s.prototype.push.call(this,e,t)},o}();function wi(o,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return o[0]==31&&o[1]==139&&o[2]==8?Os(o,e,t):(o[0]&15)!=8||o[0]>>4>7||(o[0]<<8|o[1])%31?vn(o,e,t):Us(o,e,t)}function Li(o,e){return o[0]==31&&o[1]==139&&o[2]==8?Ot(o,e):(o[0]&15)!=8||o[0]>>4>7||(o[0]<<8|o[1])%31?Ze(o,e):ht(o,e)}var In=function(o,e,t,n){for(var s in o){var r=o[s],i=e+s;r instanceof H?t[i]=[r,n]:Array.isArray(r)?t[i]=[r[0],dt(n,r[1])]:In(r,i+"/",t,n)}},Yn=typeof TextEncoder!="undefined"&&new TextEncoder,hn=typeof TextDecoder!="undefined"&&new TextDecoder,ks=0;try{hn.decode(ge,{stream:!0}),ks=1}catch{}var Ks=function(o){for(var e="",t=0;;){var n=o[t++],s=(n>127)+(n>223)+(n>239);if(t+s>o.length)return[e,ae(o,t-1)];s?s==3?(n=((n&15)<<18|(o[t++]&63)<<12|(o[t++]&63)<<6|o[t++]&63)-65536,e+=String.fromCharCode(55296|n>>10,56320|n&1023)):s&1?e+=String.fromCharCode((n&31)<<6|o[t++]&63):e+=String.fromCharCode((n&15)<<12|(o[t++]&63)<<6|o[t++]&63):e+=String.fromCharCode(n)}},Si=function(){function o(e){this.ondata=e,ks?this.t=new TextDecoder:this.p=ge}return o.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}return}if(!this.p)throw"stream finished";var n=new H(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length);var s=Ks(n),r=s[0],i=s[1];if(t){if(i.length)throw"invalid utf-8 data";this.p=null}else this.p=i;this.ondata(r,t)},o}(),bi=function(){function o(e){this.ondata=e}return o.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(ve(e),this.d=t||!1)},o}();function ve(o,e){if(e){for(var t=new H(o.length),n=0;n<o.length;++n)t[n]=o.charCodeAt(n);return t}if(Yn)return Yn.encode(o);for(var s=o.length,r=new H(o.length+(o.length>>1)),i=0,a=function(h){r[i++]=h},n=0;n<s;++n){if(i+5>r.length){var c=new H(i+8+(s-n<<1));c.set(r),r=c}var l=o.charCodeAt(n);l<128||e?a(l):l<2048?(a(192|l>>6),a(128|l&63)):l>55295&&l<57344?(l=65536+(l&1023<<10)|o.charCodeAt(++n)&1023,a(240|l>>18),a(128|l>>12&63),a(128|l>>6&63),a(128|l&63)):(a(224|l>>12),a(128|l>>6&63),a(128|l&63))}return ae(r,0,i)}function Rn(o,e){if(e){for(var t="",n=0;n<o.length;n+=16384)t+=String.fromCharCode.apply(null,o.subarray(n,n+16384));return t}else{if(hn)return hn.decode(o);var s=Ks(o),r=s[0],i=s[1];if(i.length)throw"invalid utf-8 data";return r}}var Ns=function(o){return o==1?3:o<6?2:o==9?1:0},js=function(o,e){return e+30+z(o,e+26)+z(o,e+28)},Qs=function(o,e,t){var n=z(o,e+28),s=Rn(o.subarray(e+46,e+46+n),!(z(o,e+8)&2048)),r=e+46+n,i=N(o,e+20),a=t&&i==4294967295?Xs(o,r):[i,N(o,e+24),N(o,e+42)],c=a[0],l=a[1],h=a[2];return[z(o,e+10),c,l,s,r+z(o,e+30)+z(o,e+32),h]},Xs=function(o,e){for(;z(o,e)!=1;e+=4+z(o,e+2));return[jt(o,e+12),jt(o,e+4),jt(o,e+20)]},Te=function(o){var e=0;if(o)for(var t in o){var n=o[t].length;if(n>65535)throw"extra field too long";e+=n+4}return e},ke=function(o,e,t,n,s,r,i,a){var c=n.length,l=t.extra,h=a&&a.length,u=Te(l);O(o,e,i!=null?33639248:67324752),e+=4,i!=null&&(o[e++]=20,o[e++]=t.os),o[e]=20,e+=2,o[e++]=t.flag<<1|(r==null&&8),o[e++]=s&&8,o[e++]=t.compression&255,o[e++]=t.compression>>8;var f=new Date(t.mtime==null?Date.now():t.mtime),p=f.getFullYear()-1980;if(p<0||p>119)throw"date not in range 1980-2099";if(O(o,e,p<<25|f.getMonth()+1<<21|f.getDate()<<16|f.getHours()<<11|f.getMinutes()<<5|f.getSeconds()>>>1),e+=4,r!=null&&(O(o,e,t.crc),O(o,e+4,r),O(o,e+8,t.size)),O(o,e+12,c),O(o,e+14,u),e+=16,i!=null&&(O(o,e,h),O(o,e+6,t.attrs),O(o,e+10,i),e+=14),o.set(n,e),e+=c,u)for(var A in l){var B=l[A],m=B.length;O(o,e,+A),O(o,e+2,m),o.set(B,e+4),e+=4+m}return h&&(o.set(a,e),e+=h),e},Gn=function(o,e,t,n,s){O(o,e,101010256),O(o,e+8,t),O(o,e+10,t),O(o,e+12,n),O(o,e+16,s)},ft=function(){function o(e){this.filename=e,this.c=je(),this.size=0,this.compression=0}return o.prototype.process=function(e,t){this.ondata(null,e,t)},o.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},o}(),Hi=function(){function o(e,t){var n=this;t||(t={}),ft.call(this,e),this.d=new Be(t,function(s,r){n.ondata(null,s,r)}),this.compression=8,this.flag=Ns(t.level)}return o.prototype.process=function(e,t){try{this.d.push(e,t)}catch(n){this.ondata(n,null,t)}},o.prototype.push=function(e,t){ft.prototype.push.call(this,e,t)},o}(),xi=function(){function o(e,t){var n=this;t||(t={}),ft.call(this,e),this.d=new Hs(t,function(s,r,i){n.ondata(s,r,i)}),this.compression=8,this.flag=Ns(t.level),this.terminate=this.d.terminate}return o.prototype.process=function(e,t){this.d.push(e,t)},o.prototype.push=function(e,t){ft.prototype.push.call(this,e,t)},o}(),Pi=function(){function o(e){this.ondata=e,this.u=[],this.d=1}return o.prototype.add=function(e){var t=this;if(this.d&2)throw"stream finished";var n=ve(e.filename),s=n.length,r=e.comment,i=r&&ve(r),a=s!=e.filename.length||i&&r.length!=i.length,c=s+Te(e.extra)+30;if(s>65535)throw"filename too long";var l=new H(c);ke(l,0,e,n,a);var h=[l],u=function(){for(var m=0,g=h;m<g.length;m++){var C=g[m];t.ondata(null,C,!1)}h=[]},f=this.d;this.d=0;var p=this.u.length,A=dt(e,{f:n,u:a,o:i,t:function(){e.terminate&&e.terminate()},r:function(){if(u(),f){var m=t.u[p+1];m?m.r():t.d=1}f=1}}),B=0;e.ondata=function(m,g,C){if(m)t.ondata(m,g,C),t.terminate();else if(B+=g.length,h.push(g),C){var d=new H(16);O(d,0,134695760),O(d,4,e.crc),O(d,8,B),O(d,12,e.size),h.push(d),A.c=B,A.b=c+B+16,A.crc=e.crc,A.size=e.size,f&&A.r(),f=1}else f&&u()},this.u.push(A)},o.prototype.end=function(){var e=this;if(this.d&2)throw this.d&1?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){!(e.d&1)||(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},o.prototype.e=function(){for(var e=0,t=0,n=0,s=0,r=this.u;s<r.length;s++){var i=r[s];n+=46+i.f.length+Te(i.extra)+(i.o?i.o.length:0)}for(var a=new H(n+22),c=0,l=this.u;c<l.length;c++){var i=l[c];ke(a,e,i,i.f,i.u,i.c,t,i.o),e+=46+i.f.length+Te(i.extra)+(i.o?i.o.length:0),t+=i.b}Gn(a,e,this.u.length,n,t),this.ondata(null,a,!0),this.d=2},o.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++){var n=t[e];n.t()}this.d=2},o}();function Oi(o,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";var n={};In(o,"",n,e);var s=Object.keys(n),r=s.length,i=0,a=0,c=r,l=new Array(r),h=[],u=function(){for(var B=0;B<h.length;++B)h[B]()},f=function(){var B=new H(a+22),m=i,g=a-i;a=0;for(var C=0;C<c;++C){var d=l[C];try{var F=d.c.length;ke(B,a,d,d.f,d.u,F);var v=30+d.f.length+Te(d.extra),y=a+v;B.set(d.c,y),ke(B,i,d,d.f,d.u,F,a,d.m),i+=16+v+(d.m?d.m.length:0),a=y+F}catch(M){return t(M,null)}}Gn(B,i,l.length,g,m),t(null,B)};r||f();for(var p=function(B){var m=s[B],g=n[m],C=g[0],d=g[1],F=je(),v=C.length;F.p(C);var y=ve(m),M=y.length,E=d.comment,I=E&&ve(E),T=I&&I.length,R=Te(d.extra),D=d.level==0?0:8,G=function(w,L){if(w)u(),t(w,null);else{var P=L.length;l[B]=dt(d,{size:v,crc:F.d(),c:L,f:y,m:I,u:M!=m.length||I&&E.length!=T,compression:D}),i+=30+M+R+P,a+=76+2*(M+R)+(T||0)+P,--r||f()}};if(M>65535&&G("filename too long",null),!D)G(null,C);else if(v<16e4)try{G(null,Bt(C,d))}catch(w){G(w,null)}else h.push(xs(C,d,G))},A=0;A<c;++A)p(A);return u}function Ji(o,e){e||(e={});var t={},n=[];In(o,"",t,e);var s=0,r=0;for(var i in t){var a=t[i],c=a[0],l=a[1],h=l.level==0?0:8,u=ve(i),f=u.length,p=l.comment,A=p&&ve(p),B=A&&A.length,m=Te(l.extra);if(f>65535)throw"filename too long";var g=h?Bt(c,l):c,C=g.length,d=je();d.p(c),n.push(dt(l,{size:c.length,crc:d.d(),c:g,f:u,m:A,u:f!=i.length||A&&p.length!=B,o:s,compression:h})),s+=30+f+m+C,r+=76+2*(f+m)+(B||0)+C}for(var F=new H(r+22),v=s,y=r-s,M=0;M<n.length;++M){var u=n[M];ke(F,u.o,u,u.f,u.u,u.c.length);var E=30+u.f.length+Te(u.extra);F.set(u.c,u.o+E),ke(F,s,u,u.f,u.u,u.c.length,u.o,u.m),s+=16+E+(u.m?u.m.length:0)}return Gn(F,s,n.length,y,v),F}var Vs=function(){function o(){}return o.prototype.push=function(e,t){this.ondata(null,e,t)},o.compression=0,o}(),Ui=function(){function o(){var e=this;this.i=new ee(function(t,n){e.ondata(null,t,n)})}return o.prototype.push=function(e,t){try{this.i.push(e,t)}catch(n){this.ondata(n,e,t)}},o.compression=8,o}(),_i=function(){function o(e,t){var n=this;t<32e4?this.i=new ee(function(s,r){n.ondata(null,s,r)}):(this.i=new Tn(function(s,r,i){n.ondata(s,r,i)}),this.terminate=this.i.terminate)}return o.prototype.push=function(e,t){this.i.terminate&&(e=ae(e,0)),this.i.push(e,t)},o.compression=8,o}(),ki=function(){function o(e){this.onfile=e,this.k=[],this.o={0:Vs},this.p=ge}return o.prototype.push=function(e,t){var n=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var s=Math.min(this.c,e.length),r=e.subarray(0,s);if(this.c-=s,this.d?this.d.push(r,!this.c):this.k[0].push(r),e=e.subarray(s),e.length)return this.push(e,t)}else{var i=0,a=0,c=void 0,l=void 0;this.p.length?e.length?(l=new H(this.p.length+e.length),l.set(this.p),l.set(e,this.p.length)):l=this.p:l=e;for(var h=l.length,u=this.c,f=u&&this.d,p=function(){var g,C=N(l,a);if(C==67324752){i=1,c=a,A.d=null,A.c=0;var d=z(l,a+6),F=z(l,a+8),v=d&2048,y=d&8,M=z(l,a+26),E=z(l,a+28);if(h>a+30+M+E){var I=[];A.k.unshift(I),i=2;var T=N(l,a+18),R=N(l,a+22),D=Rn(l.subarray(a+30,a+=30+M),!v);T==4294967295?(g=y?[-2]:Xs(l,a),T=g[0],R=g[1]):y&&(T=-1),a+=E,A.c=T;var G,w={name:D,compression:F,start:function(){if(!w.ondata)throw"no callback";if(!T)w.ondata(null,ge,!0);else{var L=n.o[F];if(!L)throw"unknown compression type "+F;G=T<0?new L(D):new L(D,T,R),G.ondata=function(X,ne,W){w.ondata(X,ne,W)};for(var P=0,x=I;P<x.length;P++){var J=x[P];G.push(J,!1)}n.k[0]==I&&n.c?n.d=G:G.push(ge,!0)}},terminate:function(){G&&G.terminate&&G.terminate()}};T>=0&&(w.size=T,w.originalSize=R),A.onfile(w)}return"break"}else if(u){if(C==134695760)return c=a+=12+(u==-2&&8),i=3,A.c=0,"break";if(C==33639248)return c=a-=4,i=3,A.c=0,"break"}},A=this;a<h-4;++a){var B=p();if(B==="break")break}if(this.p=ge,u<0){var m=i?l.subarray(0,c-12-(u==-2&&8)-(N(l,c-16)==134695760&&4)):l.subarray(0,a);f?f.push(m,!!i):this.k[+(i==2)].push(m)}if(i&2)return this.push(l.subarray(a),t);this.p=l.subarray(a)}if(t){if(this.c)throw"invalid zip file";this.p=null}},o.prototype.register=function(e){this.o[e.compression]=e},o}();function Ki(o,e){if(typeof e!="function")throw"no callback";for(var t=[],n=function(){for(var f=0;f<t.length;++f)t[f]()},s={},r=o.length-22;N(o,r)!=101010256;--r)if(!r||o.length-r>65558){e("invalid zip file",null);return}var i=z(o,r+8);i||e(null,{});var a=i,c=N(o,r+16),l=c==4294967295;if(l){if(r=N(o,r-12),N(o,r)!=101075792){e("invalid zip file",null);return}a=i=N(o,r+32),c=N(o,r+48)}for(var h=function(f){var p=Qs(o,c,l),A=p[0],B=p[1],m=p[2],g=p[3],C=p[4],d=p[5],F=js(o,d);c=C;var v=function(M,E){M?(n(),e(M,null)):(s[g]=E,--i||e(null,s))};if(!A)v(null,ae(o,F,F+B));else if(A==8){var y=o.subarray(F,F+B);if(B<32e4)try{v(null,Ze(y,new H(m)))}catch(M){v(M,null)}else t.push(vn(y,{size:m},v))}else v("unknown compression type "+A,null)},u=0;u<a;++u)h();return n}function Ni(o){for(var e={},t=o.length-22;N(o,t)!=101010256;--t)if(!t||o.length-t>65558)throw"invalid zip file";var n=z(o,t+8);if(!n)return{};var s=N(o,t+16),r=s==4294967295;if(r){if(t=N(o,t-12),N(o,t)!=101075792)throw"invalid zip file";n=N(o,t+32),s=N(o,t+48)}for(var i=0;i<n;++i){var a=Qs(o,s,r),c=a[0],l=a[1],h=a[2],u=a[3],f=a[4],p=a[5],A=js(o,p);if(s=f,!c)e[u]=ae(o,A,A+l);else if(c==8)e[u]=Ze(o.subarray(A,A+l),new H(h));else throw"unknown compression type "+c}return e}var ji=Object.freeze(Object.defineProperty({__proto__:null,Deflate:Be,AsyncDeflate:Hs,deflate:xs,deflateSync:Bt,Inflate:ee,AsyncInflate:Tn,inflate:vn,inflateSync:Ze,Gzip:Ht,AsyncGzip:Xn,gzip:Vn,gzipSync:xt,Gunzip:Pt,AsyncGunzip:Ps,gunzip:Os,gunzipSync:Ot,Zlib:ln,AsyncZlib:Ri,zlib:Gi,zlibSync:un,Unzlib:Jt,AsyncUnzlib:Js,unzlib:Us,unzlibSync:ht,compress:Vn,AsyncCompress:Xn,compressSync:xt,Compress:Ht,Decompress:_s,AsyncDecompress:Di,decompress:wi,decompressSync:Li,DecodeUTF8:Si,EncodeUTF8:bi,strToU8:ve,strFromU8:Rn,ZipPassThrough:ft,ZipDeflate:Hi,AsyncZipDeflate:xi,Zip:Pi,zip:Oi,zipSync:Ji,UnzipPassThrough:Vs,UnzipInflate:Ui,AsyncUnzipInflate:_i,Unzip:ki,unzip:Ki,unzipSync:Ni},Symbol.toStringTag,{value:"Module"}));function Ys(o,e,t){const n=t.length-o-1;if(e>=t[n])return n-1;if(e<=t[o])return o;let s=o,r=n,i=Math.floor((s+r)/2);for(;e<t[i]||e>=t[i+1];)e<t[i]?r=i:s=i,i=Math.floor((s+r)/2);return i}function Qi(o,e,t,n){const s=[],r=[],i=[];s[0]=1;for(let a=1;a<=t;++a){r[a]=e-n[o+1-a],i[a]=n[o+a]-e;let c=0;for(let l=0;l<a;++l){const h=i[l+1],u=r[a-l],f=s[l]/(h+u);s[l]=c+h*f,c=u*f}s[a]=c}return s}function Xi(o,e,t,n){const s=Ys(o,n,e),r=Qi(s,n,o,e),i=new Ut(0,0,0,0);for(let a=0;a<=o;++a){const c=t[s-o+a],l=r[a],h=c.w*l;i.x+=c.x*h,i.y+=c.y*h,i.z+=c.z*h,i.w+=c.w*l}return i}function Vi(o,e,t,n,s){const r=[];for(let u=0;u<=t;++u)r[u]=0;const i=[];for(let u=0;u<=n;++u)i[u]=r.slice(0);const a=[];for(let u=0;u<=t;++u)a[u]=r.slice(0);a[0][0]=1;const c=r.slice(0),l=r.slice(0);for(let u=1;u<=t;++u){c[u]=e-s[o+1-u],l[u]=s[o+u]-e;let f=0;for(let p=0;p<u;++p){const A=l[p+1],B=c[u-p];a[u][p]=A+B;const m=a[p][u-1]/a[u][p];a[p][u]=f+A*m,f=B*m}a[u][u]=f}for(let u=0;u<=t;++u)i[0][u]=a[u][t];for(let u=0;u<=t;++u){let f=0,p=1;const A=[];for(let B=0;B<=t;++B)A[B]=r.slice(0);A[0][0]=1;for(let B=1;B<=n;++B){let m=0;const g=u-B,C=t-B;u>=B&&(A[p][0]=A[f][0]/a[C+1][g],m=A[p][0]*a[g][C]);const d=g>=-1?1:-g,F=u-1<=C?B-1:t-u;for(let y=d;y<=F;++y)A[p][y]=(A[f][y]-A[f][y-1])/a[C+1][g+y],m+=A[p][y]*a[g+y][C];u<=C&&(A[p][B]=-A[f][B-1]/a[C+1][u],m+=A[p][B]*a[u][C]),i[B][u]=m;const v=f;f=p,p=v}}let h=t;for(let u=1;u<=n;++u){for(let f=0;f<=t;++f)i[u][f]*=h;h*=t-u}return i}function Yi(o,e,t,n,s){const r=s<o?s:o,i=[],a=Ys(o,n,e),c=Vi(a,n,o,r,e),l=[];for(let h=0;h<t.length;++h){const u=t[h].clone(),f=u.w;u.x*=f,u.y*=f,u.z*=f,l[h]=u}for(let h=0;h<=r;++h){const u=l[a-o].clone().multiplyScalar(c[h][0]);for(let f=1;f<=o;++f)u.add(l[a-o+f].clone().multiplyScalar(c[h][f]));i[h]=u}for(let h=r+1;h<=s+1;++h)i[h]=new Ut(0,0,0);return i}function Zi(o,e){let t=1;for(let s=2;s<=o;++s)t*=s;let n=1;for(let s=2;s<=e;++s)n*=s;for(let s=2;s<=o-e;++s)n*=s;return t/n}function Wi(o){const e=o.length,t=[],n=[];for(let r=0;r<e;++r){const i=o[r];t[r]=new V(i.x,i.y,i.z),n[r]=i.w}const s=[];for(let r=0;r<e;++r){const i=t[r].clone();for(let a=1;a<=r;++a)i.sub(s[r-a].clone().multiplyScalar(Zi(r,a)*n[a]));s[r]=i.divideScalar(n[0])}return s}function zi(o,e,t,n,s){const r=Yi(o,e,t,n,s);return Wi(r)}class Zn extends Fr{constructor(e,t,n,s,r){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=s||0,this.endKnot=r||this.knots.length-1;for(let i=0;i<n.length;++i){const a=n[i];this.controlPoints[i]=new Ut(a.x,a.y,a.z,a.w)}}getPoint(e,t=new V){const n=t,s=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),r=Xi(this.degree,this.knots,this.controlPoints,s);return r.w!==1&&r.divideScalar(r.w),n.set(r.x,r.y,r.z)}getTangent(e,t=new V){const n=t,s=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),r=zi(this.degree,this.knots,this.controlPoints,s,1);return n.copy(r[1]).normalize(),n}}let S,K,$;class qi extends De{constructor(e){super(e)}load(e,t,n,s){const r=this,i=r.path===""?he.extractUrlBase(e):r.path,a=new de(this.manager);a.setPath(r.path),a.setResponseType("arraybuffer"),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,function(c){try{t(r.parse(c,i))}catch(l){s?s(l):console.error(l),r.manager.itemError(e)}},n,s)}parse(e,t){if(ro(e))S=new so().parse(e);else{const s=qs(e);if(!io(s))throw new Error("THREE.FBXLoader: Unknown format.");if(zn(s)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+zn(s));S=new no().parse(s)}const n=new fn(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new $i(n,this.manager).parse(S)}}class $i{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){K=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),s=this.parseDeformers(),r=new eo().parse(s);return this.parseScene(s,r,n),$}parseConnections(){const e=new Map;return"Connections"in S&&S.Connections.connections.forEach(function(n){const s=n[0],r=n[1],i=n[2];e.has(s)||e.set(s,{parents:[],children:[]});const a={ID:r,relationship:i};e.get(s).parents.push(a),e.has(r)||e.set(r,{parents:[],children:[]});const c={ID:s,relationship:i};e.get(r).children.push(c)}),e}parseImages(){const e={},t={};if("Video"in S.Objects){const n=S.Objects.Video;for(const s in n){const r=n[s],i=parseInt(s);if(e[i]=r.RelativeFilename||r.Filename,"Content"in r){const a=r.Content instanceof ArrayBuffer&&r.Content.byteLength>0,c=typeof r.Content=="string"&&r.Content!=="";if(a||c){const l=this.parseImage(n[s]);t[r.RelativeFilename||r.Filename]=l}}}}for(const n in e){const s=e[n];t[s]!==void 0?e[n]=t[s]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,s=n.slice(n.lastIndexOf(".")+1).toLowerCase();let r;switch(s){case"bmp":r="image/bmp";break;case"jpg":case"jpeg":r="image/jpeg";break;case"png":r="image/png";break;case"tif":r="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",n),r="image/tga";break;default:console.warn('FBXLoader: Image type "'+s+'" is not supported.');return}if(typeof t=="string")return"data:"+r+";base64,"+t;{const i=new Uint8Array(t);return window.URL.createObjectURL(new Blob([i],{type:r}))}}parseTextures(e){const t=new Map;if("Texture"in S.Objects){const n=S.Objects.Texture;for(const s in n){const r=this.parseTexture(n[s],e);t.set(parseInt(s),r)}}return t}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const s=e.WrapModeU,r=e.WrapModeV,i=s!==void 0?s.value:0,a=r!==void 0?r.value:0;if(n.wrapS=i===0?Je:qt,n.wrapT=a===0?Je:qt,"Scaling"in e){const c=e.Scaling.value;n.repeat.x=c[0],n.repeat.y=c[1]}if("Translation"in e){const c=e.Translation.value;n.offset.x=c[0],n.offset.y=c[1]}return n}loadTexture(e,t){let n;const s=this.textureLoader.path,r=K.get(e.id).children;r!==void 0&&r.length>0&&t[r[0].ID]!==void 0&&(n=t[r[0].ID],(n.indexOf("blob:")===0||n.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let i;const a=e.FileName.slice(-3).toLowerCase();if(a==="tga"){const c=this.manager.getHandler(".tga");c===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),i=new Lt):(c.setPath(this.textureLoader.path),i=c.load(n))}else a==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),i=new Lt):i=this.textureLoader.load(n);return this.textureLoader.setPath(s),i}parseMaterials(e){const t=new Map;if("Material"in S.Objects){const n=S.Objects.Material;for(const s in n){const r=this.parseMaterial(n[s],e);r!==null&&t.set(parseInt(s),r)}}return t}parseMaterial(e,t){const n=e.id,s=e.attrName;let r=e.ShadingModel;if(typeof r=="object"&&(r=r.value),!K.has(n))return null;const i=this.parseParameters(e,t,n);let a;switch(r.toLowerCase()){case"phong":a=new it;break;case"lambert":a=new Er;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',r),a=new it;break}return a.setValues(i),a.name=s,a}parseParameters(e,t,n){const s={};e.BumpFactor&&(s.bumpScale=e.BumpFactor.value),e.Diffuse?s.color=new k().fromArray(e.Diffuse.value):e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(s.color=new k().fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(s.displacementScale=e.DisplacementFactor.value),e.Emissive?s.emissive=new k().fromArray(e.Emissive.value):e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(s.emissive=new k().fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(s.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(s.opacity=parseFloat(e.Opacity.value)),s.opacity<1&&(s.transparent=!0),e.ReflectionFactor&&(s.reflectivity=e.ReflectionFactor.value),e.Shininess&&(s.shininess=e.Shininess.value),e.Specular?s.specular=new k().fromArray(e.Specular.value):e.SpecularColor&&e.SpecularColor.type==="Color"&&(s.specular=new k().fromArray(e.SpecularColor.value));const r=this;return K.get(n).children.forEach(function(i){const a=i.relationship;switch(a){case"Bump":s.bumpMap=r.getTexture(t,i.ID);break;case"Maya|TEX_ao_map":s.aoMap=r.getTexture(t,i.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":s.map=r.getTexture(t,i.ID),s.map!==void 0&&(s.map.encoding=te);break;case"DisplacementColor":s.displacementMap=r.getTexture(t,i.ID);break;case"EmissiveColor":s.emissiveMap=r.getTexture(t,i.ID),s.emissiveMap!==void 0&&(s.emissiveMap.encoding=te);break;case"NormalMap":case"Maya|TEX_normal_map":s.normalMap=r.getTexture(t,i.ID);break;case"ReflectionColor":s.envMap=r.getTexture(t,i.ID),s.envMap!==void 0&&(s.envMap.mapping=yr,s.envMap.encoding=te);break;case"SpecularColor":s.specularMap=r.getTexture(t,i.ID),s.specularMap!==void 0&&(s.specularMap.encoding=te);break;case"TransparentColor":case"TransparencyFactor":s.alphaMap=r.getTexture(t,i.ID),s.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",a);break}}),s}getTexture(e,t){return"LayeredTexture"in S.Objects&&t in S.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=K.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in S.Objects){const n=S.Objects.Deformer;for(const s in n){const r=n[s],i=K.get(parseInt(s));if(r.attrType==="Skin"){const a=this.parseSkeleton(i,n);a.ID=s,i.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),a.geometryID=i.parents[0].ID,e[s]=a}else if(r.attrType==="BlendShape"){const a={id:s};a.rawTargets=this.parseMorphTargets(i,n),a.id=s,i.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[s]=a}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const n=[];return e.children.forEach(function(s){const r=t[s.ID];if(r.attrType!=="Cluster")return;const i={ID:s.ID,indices:[],weights:[],transformLink:new _().fromArray(r.TransformLink.a)};"Indexes"in r&&(i.indices=r.Indexes.a,i.weights=r.Weights.a),n.push(i)}),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const n=[];for(let s=0;s<e.children.length;s++){const r=e.children[s],i=t[r.ID],a={name:i.attrName,initialWeight:i.DeformPercent,id:i.id,fullWeights:i.FullWeights.a};if(i.attrType!=="BlendShapeChannel")return;a.geoID=K.get(parseInt(r.ID)).children.filter(function(c){return c.relationship===void 0})[0].ID,n.push(a)}return n}parseScene(e,t,n){$=new Oe;const s=this.parseModels(e.skeletons,t,n),r=S.Objects.Model,i=this;s.forEach(function(c){const l=r[c.ID];i.setLookAtProperties(c,l),K.get(c.ID).parents.forEach(function(u){const f=s.get(u.ID);f!==void 0&&f.add(c)}),c.parent===null&&$.add(c)}),this.bindSkeleton(e.skeletons,t,s),this.createAmbientLight(),$.traverse(function(c){if(c.userData.transformData){c.parent&&(c.userData.transformData.parentMatrix=c.parent.matrix,c.userData.transformData.parentMatrixWorld=c.parent.matrixWorld);const l=Ws(c.userData.transformData);c.applyMatrix4(l),c.updateWorldMatrix()}});const a=new to().parse();$.children.length===1&&$.children[0].isGroup&&($.children[0].animations=a,$=$.children[0]),$.animations=a}parseModels(e,t,n){const s=new Map,r=S.Objects.Model;for(const i in r){const a=parseInt(i),c=r[i],l=K.get(a);let h=this.buildSkeleton(l,e,a,c.attrName);if(!h){switch(c.attrType){case"Camera":h=this.createCamera(l);break;case"Light":h=this.createLight(l);break;case"Mesh":h=this.createMesh(l,t,n);break;case"NurbsCurve":h=this.createCurve(l,t);break;case"LimbNode":case"Root":h=new en;break;case"Null":default:h=new Oe;break}h.name=c.attrName?at.sanitizeNodeName(c.attrName):"",h.ID=a}this.getTransformData(h,c),s.set(a,h)}return s}buildSkeleton(e,t,n,s){let r=null;return e.parents.forEach(function(i){for(const a in t){const c=t[a];c.rawBones.forEach(function(l,h){if(l.ID===i.ID){const u=r;r=new en,r.matrixWorld.copy(l.transformLink),r.name=s?at.sanitizeNodeName(s):"",r.ID=n,c.bones[h]=r,u!==null&&r.add(u)}})}}),r}createCamera(e){let t,n;if(e.children.forEach(function(s){const r=S.Objects.NodeAttribute[s.ID];r!==void 0&&(n=r)}),n===void 0)t=new Tt;else{let s=0;n.CameraProjectionType!==void 0&&n.CameraProjectionType.value===1&&(s=1);let r=1;n.NearPlane!==void 0&&(r=n.NearPlane.value/1e3);let i=1e3;n.FarPlane!==void 0&&(i=n.FarPlane.value/1e3);let a=window.innerWidth,c=window.innerHeight;n.AspectWidth!==void 0&&n.AspectHeight!==void 0&&(a=n.AspectWidth.value,c=n.AspectHeight.value);const l=a/c;let h=45;n.FieldOfView!==void 0&&(h=n.FieldOfView.value);const u=n.FocalLength?n.FocalLength.value:null;switch(s){case 0:t=new as(h,l,r,i),u!==null&&t.setFocalLength(u);break;case 1:t=new cs(-a/2,a/2,c/2,-c/2,r,i);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+s+"."),t=new Tt;break}}return t}createLight(e){let t,n;if(e.children.forEach(function(s){const r=S.Objects.NodeAttribute[s.ID];r!==void 0&&(n=r)}),n===void 0)t=new Tt;else{let s;n.LightType===void 0?s=0:s=n.LightType.value;let r=16777215;n.Color!==void 0&&(r=new k().fromArray(n.Color.value));let i=n.Intensity===void 0?1:n.Intensity.value/100;n.CastLightOnObject!==void 0&&n.CastLightOnObject.value===0&&(i=0);let a=0;n.FarAttenuationEnd!==void 0&&(n.EnableFarAttenuation!==void 0&&n.EnableFarAttenuation.value===0?a=0:a=n.FarAttenuationEnd.value);const c=1;switch(s){case 0:t=new zt(r,i,a,c);break;case 1:t=new ns(r,i);break;case 2:let l=Math.PI/3;n.InnerAngle!==void 0&&(l=ue.degToRad(n.InnerAngle.value));let h=0;n.OuterAngle!==void 0&&(h=ue.degToRad(n.OuterAngle.value),h=Math.max(h,1)),t=new ts(r,i,a,l,h,c);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new zt(r,i);break}n.CastShadows!==void 0&&n.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,n){let s,r=null,i=null;const a=[];return e.children.forEach(function(c){t.has(c.ID)&&(r=t.get(c.ID)),n.has(c.ID)&&a.push(n.get(c.ID))}),a.length>1?i=a:a.length>0?i=a[0]:(i=new it({color:13421772}),a.push(i)),"color"in r.attributes&&a.forEach(function(c){c.vertexColors=!0}),r.FBX_Deformer?(s=new rs(r,i),s.normalizeSkinWeights()):s=new Gt(r,i),s}createCurve(e,t){const n=e.children.reduce(function(r,i){return t.has(i.ID)&&(r=t.get(i.ID)),r},null),s=new st({color:3342591,linewidth:1});return new os(n,s)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?n.eulerOrder=zs(t.RotationOrder.value):n.eulerOrder="ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){"LookAtProperty"in t&&K.get(e.ID).children.forEach(function(s){if(s.relationship==="LookAtProperty"){const r=S.Objects.Model[s.ID];if("Lcl_Translation"in r){const i=r.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(i),$.add(e.target)):e.lookAt(new V().fromArray(i))}}})}bindSkeleton(e,t,n){const s=this.parsePoseNodes();for(const r in e){const i=e[r];K.get(parseInt(i.ID)).parents.forEach(function(c){if(t.has(c.ID)){const l=c.ID;K.get(l).parents.forEach(function(u){n.has(u.ID)&&n.get(u.ID).bind(new fs(i.bones),s[u.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in S.Objects){const t=S.Objects.Pose;for(const n in t)if(t[n].attrType==="BindPose"&&t[n].NbPoseNodes>0){const s=t[n].PoseNode;Array.isArray(s)?s.forEach(function(r){e[r.Node]=new _().fromArray(r.Matrix.a)}):e[s.Node]=new _().fromArray(s.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in S&&"AmbientColor"in S.GlobalSettings){const e=S.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],s=e[2];if(t!==0||n!==0||s!==0){const r=new k(t,n,s);$.add(new Mr(r,1))}}}}class eo{parse(e){const t=new Map;if("Geometry"in S.Objects){const n=S.Objects.Geometry;for(const s in n){const r=K.get(parseInt(s)),i=this.parseGeometry(r,n[s],e);t.set(parseInt(s),i)}}return t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const s=n.skeletons,r=[],i=e.parents.map(function(u){return S.Objects.Model[u.ID]});if(i.length===0)return;const a=e.children.reduce(function(u,f){return s[f.ID]!==void 0&&(u=s[f.ID]),u},null);e.children.forEach(function(u){n.morphTargets[u.ID]!==void 0&&r.push(n.morphTargets[u.ID])});const c=i[0],l={};"RotationOrder"in c&&(l.eulerOrder=zs(c.RotationOrder.value)),"InheritType"in c&&(l.inheritType=parseInt(c.InheritType.value)),"GeometricTranslation"in c&&(l.translation=c.GeometricTranslation.value),"GeometricRotation"in c&&(l.rotation=c.GeometricRotation.value),"GeometricScaling"in c&&(l.scale=c.GeometricScaling.value);const h=Ws(l);return this.genGeometry(t,a,r,h)}genGeometry(e,t,n,s){const r=new Me;e.attrName&&(r.name=e.attrName);const i=this.parseGeoNode(e,t),a=this.genBuffers(i),c=new ie(a.vertex,3);if(c.applyMatrix4(s),r.setAttribute("position",c),a.colors.length>0&&r.setAttribute("color",new ie(a.colors,3)),t&&(r.setAttribute("skinIndex",new Tr(a.weightsIndices,4)),r.setAttribute("skinWeight",new ie(a.vertexWeights,4)),r.FBX_Deformer=t),a.normal.length>0){const l=new vr().getNormalMatrix(s),h=new ie(a.normal,3);h.applyNormalMatrix(l),r.setAttribute("normal",h)}if(a.uvs.forEach(function(l,h){let u="uv"+(h+1).toString();h===0&&(u="uv"),r.setAttribute(u,new ie(a.uvs[h],2))}),i.material&&i.material.mappingType!=="AllSame"){let l=a.materialIndex[0],h=0;if(a.materialIndex.forEach(function(u,f){u!==l&&(r.addGroup(h,f-h,l),l=u,h=f)}),r.groups.length>0){const u=r.groups[r.groups.length-1],f=u.start+u.count;f!==a.materialIndex.length&&r.addGroup(f,a.materialIndex.length-f,l)}r.groups.length===0&&r.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(r,e,n,s),r}parseGeoNode(e,t){const n={};if(n.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],n.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let s=0;for(;e.LayerElementUV[s];)e.LayerElementUV[s].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[s])),s++}return n.weightTable={},t!==null&&(n.skeleton=t,t.rawBones.forEach(function(s,r){s.indices.forEach(function(i,a){n.weightTable[i]===void 0&&(n.weightTable[i]=[]),n.weightTable[i].push({id:r,weight:s.weights[a]})})})),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,s=0,r=!1,i=[],a=[],c=[],l=[],h=[],u=[];const f=this;return e.vertexIndices.forEach(function(p,A){let B,m=!1;p<0&&(p=p^-1,m=!0);let g=[],C=[];if(i.push(p*3,p*3+1,p*3+2),e.color){const d=yt(A,n,p,e.color);c.push(d[0],d[1],d[2])}if(e.skeleton){if(e.weightTable[p]!==void 0&&e.weightTable[p].forEach(function(d){C.push(d.weight),g.push(d.id)}),C.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);const d=[0,0,0,0],F=[0,0,0,0];C.forEach(function(v,y){let M=v,E=g[y];F.forEach(function(I,T,R){if(M>I){R[T]=M,M=I;const D=d[T];d[T]=E,E=D}})}),g=d,C=F}for(;C.length<4;)C.push(0),g.push(0);for(let d=0;d<4;++d)h.push(C[d]),u.push(g[d])}if(e.normal){const d=yt(A,n,p,e.normal);a.push(d[0],d[1],d[2])}e.material&&e.material.mappingType!=="AllSame"&&(B=yt(A,n,p,e.material)[0]),e.uv&&e.uv.forEach(function(d,F){const v=yt(A,n,p,d);l[F]===void 0&&(l[F]=[]),l[F].push(v[0]),l[F].push(v[1])}),s++,m&&(f.genFace(t,e,i,B,a,c,l,h,u,s),n++,s=0,i=[],a=[],c=[],l=[],h=[],u=[])}),t}genFace(e,t,n,s,r,i,a,c,l,h){for(let u=2;u<h;u++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[(u-1)*3]]),e.vertex.push(t.vertexPositions[n[(u-1)*3+1]]),e.vertex.push(t.vertexPositions[n[(u-1)*3+2]]),e.vertex.push(t.vertexPositions[n[u*3]]),e.vertex.push(t.vertexPositions[n[u*3+1]]),e.vertex.push(t.vertexPositions[n[u*3+2]]),t.skeleton&&(e.vertexWeights.push(c[0]),e.vertexWeights.push(c[1]),e.vertexWeights.push(c[2]),e.vertexWeights.push(c[3]),e.vertexWeights.push(c[(u-1)*4]),e.vertexWeights.push(c[(u-1)*4+1]),e.vertexWeights.push(c[(u-1)*4+2]),e.vertexWeights.push(c[(u-1)*4+3]),e.vertexWeights.push(c[u*4]),e.vertexWeights.push(c[u*4+1]),e.vertexWeights.push(c[u*4+2]),e.vertexWeights.push(c[u*4+3]),e.weightsIndices.push(l[0]),e.weightsIndices.push(l[1]),e.weightsIndices.push(l[2]),e.weightsIndices.push(l[3]),e.weightsIndices.push(l[(u-1)*4]),e.weightsIndices.push(l[(u-1)*4+1]),e.weightsIndices.push(l[(u-1)*4+2]),e.weightsIndices.push(l[(u-1)*4+3]),e.weightsIndices.push(l[u*4]),e.weightsIndices.push(l[u*4+1]),e.weightsIndices.push(l[u*4+2]),e.weightsIndices.push(l[u*4+3])),t.color&&(e.colors.push(i[0]),e.colors.push(i[1]),e.colors.push(i[2]),e.colors.push(i[(u-1)*3]),e.colors.push(i[(u-1)*3+1]),e.colors.push(i[(u-1)*3+2]),e.colors.push(i[u*3]),e.colors.push(i[u*3+1]),e.colors.push(i[u*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(s),e.materialIndex.push(s),e.materialIndex.push(s)),t.normal&&(e.normal.push(r[0]),e.normal.push(r[1]),e.normal.push(r[2]),e.normal.push(r[(u-1)*3]),e.normal.push(r[(u-1)*3+1]),e.normal.push(r[(u-1)*3+2]),e.normal.push(r[u*3]),e.normal.push(r[u*3+1]),e.normal.push(r[u*3+2])),t.uv&&t.uv.forEach(function(f,p){e.uvs[p]===void 0&&(e.uvs[p]=[]),e.uvs[p].push(a[p][0]),e.uvs[p].push(a[p][1]),e.uvs[p].push(a[p][(u-1)*2]),e.uvs[p].push(a[p][(u-1)*2+1]),e.uvs[p].push(a[p][u*2]),e.uvs[p].push(a[p][u*2+1])})}addMorphTargets(e,t,n,s){if(n.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const r=this;n.forEach(function(i){i.rawTargets.forEach(function(a){const c=S.Objects.Geometry[a.geoID];c!==void 0&&r.genMorphGeometry(e,t,c,s,a.name)})})}genMorphGeometry(e,t,n,s,r){const i=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],a=n.Vertices!==void 0?n.Vertices.a:[],c=n.Indexes!==void 0?n.Indexes.a:[],l=e.attributes.position.count*3,h=new Float32Array(l);for(let A=0;A<c.length;A++){const B=c[A]*3;h[B]=a[A*3],h[B+1]=a[A*3+1],h[B+2]=a[A*3+2]}const u={vertexIndices:i,vertexPositions:h},f=this.genBuffers(u),p=new ie(f.vertex,3);p.name=r||n.attrName,p.applyMatrix4(s),e.morphAttributes.position.push(p)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,s=e.Normals.a;let r=[];return n==="IndexToDirect"&&("NormalIndex"in e?r=e.NormalIndex.a:"NormalsIndex"in e&&(r=e.NormalsIndex.a)),{dataSize:3,buffer:s,indices:r,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,s=e.UV.a;let r=[];return n==="IndexToDirect"&&(r=e.UVIndex.a),{dataSize:2,buffer:s,indices:r,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,s=e.Colors.a;let r=[];return n==="IndexToDirect"&&(r=e.ColorIndex.a),{dataSize:4,buffer:s,indices:r,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const s=e.Materials.a,r=[];for(let i=0;i<s.length;++i)r.push(i);return{dataSize:1,buffer:s,indices:r,mappingType:t,referenceType:n}}parseNurbsGeometry(e){if(Zn===void 0)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new Me;const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new Me;const n=t-1,s=e.KnotVector.a,r=[],i=e.Points.a;for(let u=0,f=i.length;u<f;u+=4)r.push(new Ut().fromArray(i,u));let a,c;if(e.Form==="Closed")r.push(r[0]);else if(e.Form==="Periodic"){a=n,c=s.length-1-a;for(let u=0;u<n;++u)r.push(r[u])}const h=new Zn(n,s,r,a,c).getPoints(r.length*12);return new Me().setFromPoints(h)}}class to{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const n in t){const s=t[n],r=this.addClip(s);e.push(r)}return e}parseClips(){if(S.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=S.Objects.AnimationCurveNode,t=new Map;for(const n in e){const s=e[n];if(s.attrName.match(/S|R|T|DeformPercent/)!==null){const r={id:s.id,attr:s.attrName,curves:{}};t.set(r.id,r)}}return t}parseAnimationCurves(e){const t=S.Objects.AnimationCurve;for(const n in t){const s={id:t[n].id,times:t[n].KeyTime.a.map(oo),values:t[n].KeyValueFloat.a},r=K.get(s.id);if(r!==void 0){const i=r.parents[0].ID,a=r.parents[0].relationship;a.match(/X/)?e.get(i).curves.x=s:a.match(/Y/)?e.get(i).curves.y=s:a.match(/Z/)?e.get(i).curves.z=s:a.match(/d|DeformPercent/)&&e.has(i)&&(e.get(i).curves.morph=s)}}}parseAnimationLayers(e){const t=S.Objects.AnimationLayer,n=new Map;for(const s in t){const r=[],i=K.get(parseInt(s));i!==void 0&&(i.children.forEach(function(c,l){if(e.has(c.ID)){const h=e.get(c.ID);if(h.curves.x!==void 0||h.curves.y!==void 0||h.curves.z!==void 0){if(r[l]===void 0){const u=K.get(c.ID).parents.filter(function(f){return f.relationship!==void 0})[0].ID;if(u!==void 0){const f=S.Objects.Model[u.toString()];if(f===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",c);return}const p={modelName:f.attrName?at.sanitizeNodeName(f.attrName):"",ID:f.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};$.traverse(function(A){A.ID===f.id&&(p.transform=A.matrix,A.userData.transformData&&(p.eulerOrder=A.userData.transformData.eulerOrder))}),p.transform||(p.transform=new _),"PreRotation"in f&&(p.preRotation=f.PreRotation.value),"PostRotation"in f&&(p.postRotation=f.PostRotation.value),r[l]=p}}r[l]&&(r[l][h.attr]=h)}else if(h.curves.morph!==void 0){if(r[l]===void 0){const u=K.get(c.ID).parents.filter(function(g){return g.relationship!==void 0})[0].ID,f=K.get(u).parents[0].ID,p=K.get(f).parents[0].ID,A=K.get(p).parents[0].ID,B=S.Objects.Model[A],m={modelName:B.attrName?at.sanitizeNodeName(B.attrName):"",morphName:S.Objects.Deformer[u].attrName};r[l]=m}r[l][h.attr]=h}}}),n.set(parseInt(s),r))}return n}parseAnimStacks(e){const t=S.Objects.AnimationStack,n={};for(const s in t){const r=K.get(parseInt(s)).children;r.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const i=e.get(r[0].ID);n[s]={name:t[s].attrName,layer:i}}return n}addClip(e){let t=[];const n=this;return e.layer.forEach(function(s){t=t.concat(n.generateTracks(s))}),new hs(e.name,-1,t)}generateTracks(e){const t=[];let n=new V,s=new tt,r=new V;if(e.transform&&e.transform.decompose(n,s,r),n=n.toArray(),s=new nt().setFromQuaternion(s,e.eulerOrder).toArray(),r=r.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const i=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");i!==void 0&&t.push(i)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const i=this.generateRotationTrack(e.modelName,e.R.curves,s,e.preRotation,e.postRotation,e.eulerOrder);i!==void 0&&t.push(i)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const i=this.generateVectorTrack(e.modelName,e.S.curves,r,"scale");i!==void 0&&t.push(i)}if(e.DeformPercent!==void 0){const i=this.generateMorphTrack(e);i!==void 0&&t.push(i)}return t}generateVectorTrack(e,t,n,s){const r=this.getTimesForAllAxes(t),i=this.getKeyframeTrackValues(r,t,n);return new ls(e+"."+s,r,i)}generateRotationTrack(e,t,n,s,r,i){t.x!==void 0&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(ue.degToRad)),t.y!==void 0&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(ue.degToRad)),t.z!==void 0&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(ue.degToRad));const a=this.getTimesForAllAxes(t),c=this.getKeyframeTrackValues(a,t,n);s!==void 0&&(s=s.map(ue.degToRad),s.push(i),s=new nt().fromArray(s),s=new tt().setFromEuler(s)),r!==void 0&&(r=r.map(ue.degToRad),r.push(i),r=new nt().fromArray(r),r=new tt().setFromEuler(r).invert());const l=new tt,h=new nt,u=[];for(let f=0;f<c.length;f+=3)h.set(c[f],c[f+1],c[f+2],i),l.setFromEuler(h),s!==void 0&&l.premultiply(s),r!==void 0&&l.multiply(r),l.toArray(u,f/3*4);return new $t(e+".quaternion",a,u)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,n=t.values.map(function(r){return r/100}),s=$.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new us(e.modelName+".morphTargetInfluences["+s+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(n,s){return n-s}),t.length>1){let n=1,s=t[0];for(let r=1;r<t.length;r++){const i=t[r];i!==s&&(t[n]=i,s=i,n++)}t=t.slice(0,n)}return t}getKeyframeTrackValues(e,t,n){const s=n,r=[];let i=-1,a=-1,c=-1;return e.forEach(function(l){if(t.x&&(i=t.x.times.indexOf(l)),t.y&&(a=t.y.times.indexOf(l)),t.z&&(c=t.z.times.indexOf(l)),i!==-1){const h=t.x.values[i];r.push(h),s[0]=h}else r.push(s[0]);if(a!==-1){const h=t.y.values[a];r.push(h),s[1]=h}else r.push(s[1]);if(c!==-1){const h=t.z.values[c];r.push(h),s[2]=h}else r.push(s[2])}),r}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const n=e.values[t-1],s=e.values[t]-n,r=Math.abs(s);if(r>=180){const i=r/180,a=s/i;let c=n+a;const l=e.times[t-1],u=(e.times[t]-l)/i;let f=l+u;const p=[],A=[];for(;f<e.times[t];)p.push(f),f+=u,A.push(c),c+=a;e.times=qn(e.times,t,p),e.values=qn(e.values,t,A)}}}}class no{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new Zs,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach(function(s,r){const i=s.match(/^[\s\t]*;/),a=s.match(/^[\s\t]*$/);if(i||a)return;const c=s.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),l=s.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),h=s.match("^\\t{"+(t.currentIndent-1)+"}}");c?t.parseNodeBegin(s,c):l?t.parseNodeProperty(s,l,n[++r]):h?t.popStack():s.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(s)}),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),s=t[2].split(",").map(function(c){return c.trim().replace(/^"/,"").replace(/"$/,"")}),r={name:n},i=this.parseNodeAttr(s),a=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(n,r):n in a?(n==="PoseNode"?a.PoseNode.push(r):a[n].id!==void 0&&(a[n]={},a[n][a[n].id]=a[n]),i.id!==""&&(a[n][i.id]=r)):typeof i.id=="number"?(a[n]={},a[n][i.id]=r):n!=="Properties70"&&(n==="PoseNode"?a[n]=[r]:a[n]=r),typeof i.id=="number"&&(r.id=i.id),i.name!==""&&(r.attrName=i.name),i.type!==""&&(r.attrType=i.type),this.pushStack(r)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",s="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),s=e[2]),{id:t,name:n,type:s}}parseNodeProperty(e,t,n){let s=t[1].replace(/^"/,"").replace(/"$/,"").trim(),r=t[2].replace(/^"/,"").replace(/"$/,"").trim();s==="Content"&&r===","&&(r=n.replace(/"/g,"").replace(/,$/,"").trim());const i=this.getCurrentNode();if(i.name==="Properties70"){this.parseNodeSpecialProperty(e,s,r);return}if(s==="C"){const c=r.split(",").slice(1),l=parseInt(c[0]),h=parseInt(c[1]);let u=r.split(",").slice(3);u=u.map(function(f){return f.trim().replace(/^"/,"")}),s="connections",r=[l,h],co(r,u),i[s]===void 0&&(i[s]=[])}s==="Node"&&(i.id=r),s in i&&Array.isArray(i[s])?i[s].push(r):s!=="a"?i[s]=r:i.a=r,this.setCurrentProp(i,s),s==="a"&&r.slice(-1)!==","&&(i.a=Xt(r))}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=Xt(t.a))}parseNodeSpecialProperty(e,t,n){const s=n.split('",').map(function(h){return h.trim().replace(/^\"/,"").replace(/\s/,"_")}),r=s[0],i=s[1],a=s[2],c=s[3];let l=s[4];switch(i){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=Xt(l);break}this.getPrevNode()[r]={type:i,type2:a,flag:c,value:l},this.setCurrentProp(this.getPrevNode(),r)}}class so{parse(e){const t=new Wn(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const s=new Zs;for(;!this.endOfContent(t);){const r=this.parseNode(t,n);r!==null&&s.add(r.name,r)}return s}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},s=t>=7500?e.getUint64():e.getUint32(),r=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const i=e.getUint8(),a=e.getString(i);if(s===0)return null;const c=[];for(let f=0;f<r;f++)c.push(this.parseProperty(e));const l=c.length>0?c[0]:"",h=c.length>1?c[1]:"",u=c.length>2?c[2]:"";for(n.singleProperty=r===1&&e.getOffset()===s;s>e.getOffset();){const f=this.parseNode(e,t);f!==null&&this.parseSubNode(a,n,f)}return n.propertyList=c,typeof l=="number"&&(n.id=l),h!==""&&(n.attrName=h),u!==""&&(n.attrType=u),a!==""&&(n.name=a),n}parseSubNode(e,t,n){if(n.singleProperty===!0){const s=n.propertyList[0];Array.isArray(s)?(t[n.name]=n,n.a=s):t[n.name]=s}else if(e==="Connections"&&n.name==="C"){const s=[];n.propertyList.forEach(function(r,i){i!==0&&s.push(r)}),t.connections===void 0&&(t.connections=[]),t.connections.push(s)}else if(n.name==="Properties70")Object.keys(n).forEach(function(r){t[r]=n[r]});else if(e==="Properties70"&&n.name==="P"){let s=n.propertyList[0],r=n.propertyList[1];const i=n.propertyList[2],a=n.propertyList[3];let c;s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),r.indexOf("Lcl ")===0&&(r=r.replace("Lcl ","Lcl_")),r==="Color"||r==="ColorRGB"||r==="Vector"||r==="Vector3D"||r.indexOf("Lcl_")===0?c=[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:c=n.propertyList[4],t[s]={type:r,type2:i,flag:a,value:c}}else t[n.name]===void 0?typeof n.id=="number"?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:n.name==="PoseNode"?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):t[n.name][n.id]===void 0&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const s=e.getUint32(),r=e.getUint32(),i=e.getUint32();if(r===0)switch(t){case"b":case"c":return e.getBooleanArray(s);case"d":return e.getFloat64Array(s);case"f":return e.getFloat32Array(s);case"i":return e.getInt32Array(s);case"l":return e.getInt64Array(s)}typeof ji=="undefined"&&console.error("THREE.FBXLoader: External library fflate.min.js required.");const a=ht(new Uint8Array(e.getArrayBuffer(i))),c=new Wn(a.buffer);switch(t){case"b":case"c":return c.getBooleanArray(s);case"d":return c.getFloat64Array(s);case"f":return c.getFloat32Array(s);case"i":return c.getInt32Array(s);case"l":return c.getInt64Array(s)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class Wn{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t!==void 0?t:!0}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t&2147483648?(t=~t&4294967295,e=~e&4294967295,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(t*4294967296+e)):t*4294967296+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let s=0;s<e;s++)t[s]=this.getUint8();const n=t.indexOf(0);return n>=0&&(t=t.slice(0,n)),he.decodeText(new Uint8Array(t))}}class Zs{add(e,t){this[e]=t}}function ro(o){const e="Kaydara FBX Binary  \0";return o.byteLength>=e.length&&e===qs(o,0,e.length)}function io(o){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let t=0;function n(s){const r=o[s-1];return o=o.slice(t+s),t++,r}for(let s=0;s<e.length;++s)if(n(1)===e[s])return!1;return!0}function zn(o){const e=/FBXVersion: (\d+)/,t=o.match(e);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function oo(o){return o/46186158e3}const ao=[];function yt(o,e,t,n){let s;switch(n.mappingType){case"ByPolygonVertex":s=o;break;case"ByPolygon":s=e;break;case"ByVertice":s=t;break;case"AllSame":s=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}n.referenceType==="IndexToDirect"&&(s=n.indices[s]);const r=s*n.dataSize,i=r+n.dataSize;return lo(ao,n.buffer,r,i)}const Qt=new nt,be=new V;function Ws(o){const e=new _,t=new _,n=new _,s=new _,r=new _,i=new _,a=new _,c=new _,l=new _,h=new _,u=new _,f=new _,p=o.inheritType?o.inheritType:0;if(o.translation&&e.setPosition(be.fromArray(o.translation)),o.preRotation){const T=o.preRotation.map(ue.degToRad);T.push(o.eulerOrder),t.makeRotationFromEuler(Qt.fromArray(T))}if(o.rotation){const T=o.rotation.map(ue.degToRad);T.push(o.eulerOrder),n.makeRotationFromEuler(Qt.fromArray(T))}if(o.postRotation){const T=o.postRotation.map(ue.degToRad);T.push(o.eulerOrder),s.makeRotationFromEuler(Qt.fromArray(T)),s.invert()}o.scale&&r.scale(be.fromArray(o.scale)),o.scalingOffset&&a.setPosition(be.fromArray(o.scalingOffset)),o.scalingPivot&&i.setPosition(be.fromArray(o.scalingPivot)),o.rotationOffset&&c.setPosition(be.fromArray(o.rotationOffset)),o.rotationPivot&&l.setPosition(be.fromArray(o.rotationPivot)),o.parentMatrixWorld&&(u.copy(o.parentMatrix),h.copy(o.parentMatrixWorld));const A=t.clone().multiply(n).multiply(s),B=new _;B.extractRotation(h);const m=new _;m.copyPosition(h);const g=m.clone().invert().multiply(h),C=B.clone().invert().multiply(g),d=r,F=new _;if(p===0)F.copy(B).multiply(A).multiply(C).multiply(d);else if(p===1)F.copy(B).multiply(C).multiply(A).multiply(d);else{const R=new _().scale(new V().setFromMatrixScale(u)).clone().invert(),D=C.clone().multiply(R);F.copy(B).multiply(A).multiply(D).multiply(d)}const v=l.clone().invert(),y=i.clone().invert();let M=e.clone().multiply(c).multiply(l).multiply(t).multiply(n).multiply(s).multiply(v).multiply(a).multiply(i).multiply(r).multiply(y);const E=new _().copyPosition(M),I=h.clone().multiply(E);return f.copyPosition(I),M=f.clone().multiply(F),M.premultiply(h.invert()),M}function zs(o){o=o||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return o===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[o]}function Xt(o){return o.split(",").map(function(t){return parseFloat(t)})}function qs(o,e,t){return e===void 0&&(e=0),t===void 0&&(t=o.byteLength),he.decodeText(new Uint8Array(o,e,t))}function co(o,e){for(let t=0,n=o.length,s=e.length;t<s;t++,n++)o[n]=e[t]}function lo(o,e,t,n){for(let s=t,r=0;s<n;s++,r++)o[r]=e[s];return o}function qn(o,e,t){return o.slice(0,e).concat(t).concat(o.slice(e))}const Vt=new WeakMap;class uo extends De{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,s){const r=new de(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,i=>{const a={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(i,a).then(t).catch(s)},n,s)}decodeDracoFile(e,t,n,s){const r={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,r).then(t)}decodeGeometry(e,t){for(const c in t.attributeTypes){const l=t.attributeTypes[c];l.BYTES_PER_ELEMENT!==void 0&&(t.attributeTypes[c]=l.name)}const n=JSON.stringify(t);if(Vt.has(e)){const c=Vt.get(e);if(c.key===n)return c.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const r=this.workerNextTaskID++,i=e.byteLength,a=this._getWorker(r,i).then(c=>(s=c,new Promise((l,h)=>{s._callbacks[r]={resolve:l,reject:h},s.postMessage({type:"decode",id:r,taskConfig:t,buffer:e},[e])}))).then(c=>this._createGeometry(c.geometry));return a.catch(()=>!0).then(()=>{s&&r&&this._releaseTask(s,r)}),Vt.set(e,{key:n,promise:a}),a}_createGeometry(e){const t=new Me;e.index&&t.setIndex(new wt(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const s=e.attributes[n],r=s.name,i=s.array,a=s.itemSize;t.setAttribute(r,new wt(i,a))}return t}_loadLibrary(e,t){const n=new de(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((s,r)=>{n.load(e,s,void 0,r)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(n=>{const s=n[0];e||(this.decoderConfig.wasmBinary=n[1]);const r=ho.toString(),i=["/* draco decoder */",s,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([i]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(r){const i=r.data;switch(i.type){case"decode":s._callbacks[i.id].resolve(i);break;case"error":s._callbacks[i.id].reject(i);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+i.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,r){return s._taskLoad>r._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function ho(){let o,e;onmessage=function(i){const a=i.data;switch(a.type){case"init":o=a.decoderConfig,e=new Promise(function(h){o.onModuleLoaded=function(u){h({draco:u})},DracoDecoderModule(o)});break;case"decode":const c=a.buffer,l=a.taskConfig;e.then(h=>{const u=h.draco,f=new u.Decoder,p=new u.DecoderBuffer;p.Init(new Int8Array(c),c.byteLength);try{const A=t(u,f,p,l),B=A.attributes.map(m=>m.array.buffer);A.index&&B.push(A.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:A},B)}catch(A){console.error(A),self.postMessage({type:"error",id:a.id,error:A.message})}finally{u.destroy(p),u.destroy(f)}});break}};function t(i,a,c,l){const h=l.attributeIDs,u=l.attributeTypes;let f,p;const A=a.GetEncodedGeometryType(c);if(A===i.TRIANGULAR_MESH)f=new i.Mesh,p=a.DecodeBufferToMesh(c,f);else if(A===i.POINT_CLOUD)f=new i.PointCloud,p=a.DecodeBufferToPointCloud(c,f);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||f.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());const B={index:null,attributes:[]};for(const m in h){const g=self[u[m]];let C,d;if(l.useUniqueIDs)d=h[m],C=a.GetAttributeByUniqueId(f,d);else{if(d=a.GetAttributeId(f,i[h[m]]),d===-1)continue;C=a.GetAttribute(f,d)}B.attributes.push(s(i,a,f,m,g,C))}return A===i.TRIANGULAR_MESH&&(B.index=n(i,a,f)),i.destroy(f),B}function n(i,a,c){const h=c.num_faces()*3,u=h*4,f=i._malloc(u);a.GetTrianglesUInt32Array(c,u,f);const p=new Uint32Array(i.HEAPF32.buffer,f,h).slice();return i._free(f),{array:p,itemSize:1}}function s(i,a,c,l,h,u){const f=u.num_components(),A=c.num_points()*f,B=A*h.BYTES_PER_ELEMENT,m=r(i,h),g=i._malloc(B);a.GetAttributeDataArrayForAllPoints(c,u,m,B,g);const C=new h(i.HEAPF32.buffer,g,A).slice();return i._free(g),{name:l,array:C,itemSize:f}}function r(i,a){switch(a){case Float32Array:return i.DT_FLOAT32;case Int8Array:return i.DT_INT8;case Int16Array:return i.DT_INT16;case Int32Array:return i.DT_INT32;case Uint8Array:return i.DT_UINT8;case Uint16Array:return i.DT_UINT16;case Uint32Array:return i.DT_UINT32}}}class fo{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const n=this.workersResolve[e];if(n&&n(t),this.queue.length){const{resolve:s,msg:r,transfer:i}=this.queue.shift();this.workersResolve[e]=s,this.workers[e].postMessage(r,i)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(n=>{const s=this._getIdleWorker();s!==-1?(this._initWorker(s),this.workerStatus|=1<<s,this.workersResolve[s]=n,this.workers[s].postMessage(e,t)):this.queue.push({resolve:n,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const po=2,Ao=1,Yt=new WeakMap;let Zt=0;class Ae extends De{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new fo,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER!="undefined"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){const e=new de(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),n=new de(this.manager);n.setPath(this.transcoderPath),n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials);const s=n.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,s]).then(([r,i])=>{const a=Ae.BasisWorker.toString(),c=["/* constants */","let _EngineFormat = "+JSON.stringify(Ae.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(Ae.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Ae.BasisFormat),"/* basis_transcoder.js */",r,"/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([c])),this.transcoderBinary=i,this.workerPool.setWorkerCreator(()=>{const l=new Worker(this.workerSourceURL),h=this.transcoderBinary.slice(0);return l.postMessage({type:"init",config:this.workerConfig,transcoderBinary:h},[h]),l})}),Zt>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),Zt++}return this.transcoderPending}load(e,t,n,s){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const r=new de(this.manager);r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials);const i=new Sn;return r.load(e,a=>{if(Yt.has(a))return Yt.get(a).promise.then(t).catch(s);this._createTexture([a]).then(function(c){i.copy(c),i.needsUpdate=!0,t&&t(i)}).catch(s)},n,s),i}_createTextureFrom(e){const{mipmaps:t,width:n,height:s,format:r,type:i,error:a,dfdTransferFn:c,dfdFlags:l}=e;if(i==="error")return Promise.reject(a);const h=new Sn(t,n,s,r,Ir);return h.minFilter=t.length===1?Ue:An,h.magFilter=Ue,h.generateMipmaps=!1,h.needsUpdate=!0,h.encoding=c===po?te:es,h.premultiplyAlpha=!!(l&Ao),h}_createTexture(e,t={}){const n=t,s=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffers:e,taskConfig:n},e)).then(r=>this._createTextureFrom(r.data));return Yt.set(e[0],{promise:s}),s}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),Zt--,this}}Ae.BasisFormat={ETC1S:0,UASTC_4x4:1};Ae.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16};Ae.EngineFormat={RGBAFormat:Rr,RGBA_ASTC_4x4_Format:Gr,RGBA_BPTC_Format:Dr,RGBA_ETC2_EAC_Format:wr,RGBA_PVRTC_4BPPV1_Format:Lr,RGBA_S3TC_DXT5_Format:Sr,RGB_ETC1_Format:br,RGB_ETC2_Format:Hr,RGB_PVRTC_4BPPV1_Format:xr,RGB_S3TC_DXT1_Format:Pr};Ae.BasisWorker=function(){let o,e,t;const n=_EngineFormat,s=_TranscoderFormat,r=_BasisFormat;self.addEventListener("message",function(p){const A=p.data;switch(A.type){case"init":o=A.config,i(A.transcoderBinary);break;case"transcode":e.then(()=>{try{const{width:B,height:m,hasAlpha:g,mipmaps:C,format:d,dfdTransferFn:F,dfdFlags:v}=a(A.buffers[0]),y=[];for(let M=0;M<C.length;++M)y.push(C[M].data.buffer);self.postMessage({type:"transcode",id:A.id,width:B,height:m,hasAlpha:g,mipmaps:C,format:d,dfdTransferFn:F,dfdFlags:v},y)}catch(B){console.error(B),self.postMessage({type:"error",id:A.id,error:B.message})}});break}});function i(p){e=new Promise(A=>{t={wasmBinary:p,onRuntimeInitialized:A},BASIS(t)}).then(()=>{t.initializeBasis(),t.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function a(p){const A=new t.KTX2File(new Uint8Array(p));function B(){A.close(),A.delete()}if(!A.isValid())throw B(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const m=A.isUASTC()?r.UASTC_4x4:r.ETC1S,g=A.getWidth(),C=A.getHeight(),d=A.getLevels(),F=A.getHasAlpha(),v=A.getDFDTransferFunc(),y=A.getDFDFlags(),{transcoderFormat:M,engineFormat:E}=u(m,g,C,F);if(!g||!C||!d)throw B(),new Error("THREE.KTX2Loader:	Invalid texture");if(!A.startTranscoding())throw B(),new Error("THREE.KTX2Loader: .startTranscoding failed");const I=[];for(let T=0;T<d;T++){const R=A.getImageLevelInfo(T,0,0),D=R.origWidth,G=R.origHeight,w=new Uint8Array(A.getImageTranscodedSizeInBytes(T,0,0,M));if(!A.transcodeImage(w,T,0,0,M,0,-1,-1))throw B(),new Error("THREE.KTX2Loader: .transcodeImage failed.");I.push({data:w,width:D,height:G})}return B(),{width:g,height:C,hasAlpha:F,mipmaps:I,format:E,dfdTransferFn:v,dfdFlags:y}}const c=[{if:"astcSupported",basisFormat:[r.UASTC_4x4],transcoderFormat:[s.ASTC_4x4,s.ASTC_4x4],engineFormat:[n.RGBA_ASTC_4x4_Format,n.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[s.BC7_M5,s.BC7_M5],engineFormat:[n.RGBA_BPTC_Format,n.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[s.BC1,s.BC3],engineFormat:[n.RGB_S3TC_DXT1_Format,n.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[s.ETC1,s.ETC2],engineFormat:[n.RGB_ETC2_Format,n.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[s.ETC1],engineFormat:[n.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[s.PVRTC1_4_RGB,s.PVRTC1_4_RGBA],engineFormat:[n.RGB_PVRTC_4BPPV1_Format,n.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],l=c.sort(function(p,A){return p.priorityETC1S-A.priorityETC1S}),h=c.sort(function(p,A){return p.priorityUASTC-A.priorityUASTC});function u(p,A,B,m){let g,C;const d=p===r.ETC1S?l:h;for(let F=0;F<d.length;F++){const v=d[F];if(!!o[v.if]&&!!v.basisFormat.includes(p)&&!(m&&v.transcoderFormat.length<2)&&!(v.needsPowerOfTwo&&!(f(A)&&f(B))))return g=v.transcoderFormat[m?1:0],C=v.engineFormat[m?1:0],{transcoderFormat:g,engineFormat:C}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),g=s.RGBA32,C=n.RGBAFormat,{transcoderFormat:g,engineFormat:C}}function f(p){return p<=2?!0:(p&p-1)===0&&p!==0}};var Bo=function(){var o="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",e="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",t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),n=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};var s=o;WebAssembly.validate(t)&&(s=e,console.log("Warning: meshopt_decoder is using experimental SIMD support"));var r,i=WebAssembly.instantiate(a(s),{}).then(function(u){r=u.instance,r.exports.__wasm_call_ctors()});function a(u){for(var f=new Uint8Array(u.length),p=0;p<u.length;++p){var A=u.charCodeAt(p);f[p]=A>96?A-71:A>64?A-65:A>47?A+4:A>46?63:62}for(var B=0,p=0;p<u.length;++p)f[B++]=f[p]<60?n[f[p]]:(f[p]-60)*64+f[++p];return f.buffer.slice(0,B)}function c(u,f,p,A,B,m){var g=r.exports.sbrk,C=p+3&-4,d=g(C*A),F=g(B.length),v=new Uint8Array(r.exports.memory.buffer);v.set(B,F);var y=u(d,p,A,F,B.length);if(y==0&&m&&m(d,C,A),f.set(v.subarray(d,d+p*A)),g(d-g(0)),y!=0)throw new Error("Malformed buffer data: "+y)}var l={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},h={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:i,supported:!0,decodeVertexBuffer:function(u,f,p,A,B){c(r.exports.meshopt_decodeVertexBuffer,u,f,p,A,r.exports[l[B]])},decodeIndexBuffer:function(u,f,p,A){c(r.exports.meshopt_decodeIndexBuffer,u,f,p,A)},decodeIndexSequence:function(u,f,p,A){c(r.exports.meshopt_decodeIndexSequence,u,f,p,A)},decodeGltfBuffer:function(u,f,p,A,B,m){c(r.exports[h[B]],u,f,p,A,r.exports[l[m]])}}}();const Pe=class extends De{constructor(e){super(e)}load(e,t,n,s){this.path!==void 0&&(e=this.path+e),this.manager.itemStart(e),e=this.manager.resolveURL(e);const r=bn.get(e);if(r!==void 0)return setTimeout(()=>{t&&t(r),this.manager.itemEnd(e)},0),r;const i=document.createElement("video");return i.preload=Pe.preload,i.autoplay=Pe.autoplay,i.loop=Pe.loop,i.muted=Pe.muted,i.src=e,i.style.position="fixed",i.style.top="0",i.style.left="0",i.style.zIndex="-1",document.body.appendChild(i),i.oncanplay=()=>{bn.add(e,i),this.manager.itemEnd(e),t&&t(i)},i.onerror=a=>{this.manager.itemEnd(e),s&&s(a)},i}};let Ge=Pe;Z(Ge,"autoplay",!0),Z(Ge,"preload","auto"),Z(Ge,"muted",!0),Z(Ge,"loop",!0);var j;(function(o){o.BEFORELOAD="beforeLoad",o.LOADING="loading",o.DETAILLOADING="detailLoading",o.DETAILLOADED="detailLoaded",o.LOADED="loaded"})(j||(j={}));class mo extends Jr{constructor(t){super();Z(this,"resourceMap");Z(this,"loaderMap");Z(this,"urlList",[]);Z(this,"loadTotal");Z(this,"loadSuccess");Z(this,"loadError");Z(this,"isError");Z(this,"isLoading");Z(this,"isLoaded");Z(this,"loadDetailMap");Z(this,"path","");this.resourceMap=new Map,this.loadTotal=0,this.loadSuccess=0,this.loadError=0,this.isError=!1,this.isLoading=!1,this.isLoaded=!1,this.loadDetailMap={};const n=new Or,s=new Ge,r=new Zr;r.setDRACOLoader(new uo),r.setKTX2Loader(new Ae),r.setMeshoptDecoder(Bo),this.loaderMap={jpg:n,png:n,jpeg:n,obj:new Qr,mtl:new Xr,mp4:s,webm:s,ogg:s,hdr:new Yr,gltf:r,glb:r,fbx:new qi},t&&(this.loaderMap=Object.assign(this.loaderMap,t.loaderExtends))}loaded(){return this.dispatchEvent({type:j.LOADED,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError,resourceMap:this.resourceMap}),this}checkLoaded(){return this.loadTotal===this.loadSuccess+this.loadError&&(this.isError=!0,this.isLoaded=!0,this.isLoading=!1,this.loaded()),this}setPath(t){return this.path=t,this}setRequestHeader(t){return Object.values(this.loaderMap).forEach(n=>{n.setRequestHeader(t)}),this}setResponseType(t){return Object.values(this.loaderMap).forEach(n=>{n.setResponseType&&n.setResponseType(t)}),this}getLoader(t){return this.loaderMap[t]?this.loaderMap[t]:null}load(t){var i;if(this.reset(),this.isLoading=!0,this.dispatchEvent({type:j.BEFORELOAD,urlList:[...t]}),t.length<=0)return this.checkLoaded(),console.warn("url list is empty."),this;this.loadTotal+=t.length;const n=this.resourceMap,s=this.loaderMap,r=this.loadDetailMap;for(const a of t){let c,l;typeof a=="string"?(c=a,l=((i=c.split(".").pop())==null?void 0:i.toLocaleLowerCase())||""):(c=a.url,l=a.ext.toLocaleLowerCase(),l.startsWith(".")&&(l=l.slice(1)));const h={url:c,progress:0,error:!1,message:c};if(r[c]=h,n.has(c)){h.progress=1,this.loadSuccess+=1,this.dispatchEvent({type:j.DETAILLOADED,detail:h}),this.dispatchEvent({type:j.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded();continue}if(!l){h.message=`url: ${c} \u5730\u5740\u6709\u8BEF\uFF0C\u65E0\u6CD5\u83B7\u53D6\u6587\u4EF6\u683C\u5F0F\u3002`,console.warn(h.message),h.error=!0,this.isError=!0,this.loadError+=1,this.dispatchEvent({type:j.DETAILLOADED,detail:h}),this.dispatchEvent({type:j.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError});continue}const u=s[l];if(!u){h.message=`url: ${c} \u4E0D\u652F\u6301\u6B64\u6587\u4EF6\u683C\u5F0F\u52A0\u8F7D\u3002`,console.warn(h.message),h.error=!0,this.isError=!0,this.loadError+=1,this.dispatchEvent({type:j.DETAILLOADED,detail:h}),this.dispatchEvent({type:j.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError});continue}const f=c.replace(/\\/g,"/").split("/"),p=f.pop(),A=this.path+f.join("/")+"/";u.setPath(A).loadAsync(p,B=>{h.progress=Number((B.loaded/B.total).toFixed(2)),this.dispatchEvent({type:j.DETAILLOADING,detail:h})}).then(B=>{h.progress=1,this.loadSuccess+=1,this.resourceMap.set(c,B),this.urlList.push(a),this.dispatchEvent({type:j.DETAILLOADED,detail:h}),this.dispatchEvent({type:j.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded()}).catch(B=>{h.error=!0,h.message=JSON.stringify(B),this.loadError+=1,this.dispatchEvent({type:j.DETAILLOADED,detail:h}),this.dispatchEvent({type:j.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded()})}return this}reset(){return this.loadTotal=0,this.loadSuccess=0,this.loadError=0,this.isError=!1,this.isLoading=!1,this.isLoaded=!1,this.loadDetailMap={},this}register(t,n){return this.loaderMap[t]=n,this}hasLoaded(t){return this.resourceMap.has(t)}getResource(t){return this.resourceMap.get(t)}getLoadDetailMap(){return this.loadDetailMap}setLoadDetailMap(t){return this.loadDetailMap=t,this}remove(t){}toJSON(){return JSON.stringify(this.urlList)}exportConfig(){return JSON.parse(JSON.stringify(this.urlList))}dispose(){return this.resourceMap.clear(),this}}const go="@vis-three/loader-manager-plugin",Co=Ur(go),Mo=function(o){return{name:Co,install(e){const t=new mo(o);o!=null&&o.path&&t.setPath(o.path),e.loaderManager=t,e.loadResources=(n,s)=>{const r=i=>{s(void 0,i),t.removeEventListener(j.LOADED,r)};try{t.addEventListener(j.LOADED,r)}catch(i){s(i)}return t.load(n),e},e.loadResourcesAsync=n=>new Promise((s,r)=>{const i=a=>{s(a),t.removeEventListener(j.LOADED,i)};try{t.addEventListener(j.LOADED,i)}catch(a){r(a)}t.load(n)})},dispose(e){e.loaderManager.dispose(),delete e.loaderManager,delete e.loadResources,delete e.loadResourcesAsync}}};export{Co as L,j as a,Mo as b};
