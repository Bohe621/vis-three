import{t as x,a as r}from"./index.4a26448f.js";import{W as I,u as C,g as z}from"./three.073ebd5b.js";const P="@vis-three/webgl-renderer-plugin",D=x(P),W=function(d){let o,i,h;return{name:D,install(e){e.webGLRenderer=new I(d);const n=e.webGLRenderer.domElement;n.style.position="absolute",n.style.top="0",n.style.left="0",n.classList.add("vis-webgl"),e.getScreenshot=async function(t={}){const a={width:this.dom.offsetWidth,height:this.dom.offsetHeight};!t.width&&(t.width=this.dom.offsetWidth),!t.height&&(t.height=this.dom.offsetHeight),!t.mine&&(t.mine="image/png");let l="";const L=this.webGLRenderer.getContext(),E=L.getParameter(L.MAX_RENDERBUFFER_SIZE)/4;if(t.width>E||t.height>E){const R=[],S=Math.ceil(t.width/E),b=Math.ceil(t.height/E),w=t.width/S,f=t.height/b,u=document.createElement("canvas");u.setAttribute("width",t.width.toString()),u.setAttribute("height",t.height.toString());const g=u.getContext("2d");if(!g)return console.warn("can not support canvas 2d;"),l;this.setSize(w,f);for(let s=0;s<S;s+=1)for(let c=0;c<b;c+=1)R.push({x:w*s,y:f*c});const v=[];R.forEach(s=>{this.camera.setViewOffset(t.width,t.height,s.x,s.y,w,f),this.webGLRenderer.render(this.scene,this.camera);const c=this.webGLRenderer.domElement.toDataURL(t.mine);v.push(new Promise((G,M)=>{const m=new Image;m.src=c,m.onload=()=>{g.drawImage(m,s.x,s.y,w,f),G(null)}}))}),this.setSize(a.width,a.height),await Promise.all(v).catch(s=>{console.warn(s)}),l=u.toDataURL(t.mine),this.camera.clearViewOffset()}else this.setSize(t.width,t.height),this.webGLRenderer.render(this.scene,this.camera),l=this.webGLRenderer.domElement.toDataURL(t.mine),this.setSize(a.width,a.height);return l},o=t=>{t.dom.appendChild(e.webGLRenderer.domElement)},e.addEventListener(r.SETDOM,o),i=t=>{e.webGLRenderer.setSize(t.width,t.height,!0)},e.addEventListener(r.SETSIZE,i),h=e.render,e.render=function(){return this.webGLRenderer.render(this.scene,this.camera),this}},dispose(e){e.removeEventListener(r.SETDOM,o),e.removeEventListener(r.SETSIZE,i),e.webGLRenderer.dispose(),delete e.webGLRenderer,delete e.getScreenshot,e.render=h}}},p=function(){let d,o;return{name:"CameraAdaptivePlugin",install(i){const h=(e,n,t)=>{e instanceof C?(e.aspect=n/t,e.updateProjectionMatrix()):e instanceof z&&(e.left=-n,e.right=n,e.top=t,e.bottom=-t,e.updateProjectionMatrix())};d=e=>{h(i.camera,e.width,e.height)},i.addEventListener(r.SETSIZE,d),o=e=>{h(i.camera,i.dom.offsetWidth,i.dom.offsetHeight)},i.addEventListener(r.SETCAMERA,o)},dispose(i){i.removeEventListener(r.SETSIZE,d),i.removeEventListener(r.SETCAMERA,o)}}};export{p as C,W,D as a};
