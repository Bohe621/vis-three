var ar=Object.defineProperty;var cr=(e,t,r)=>t in e?ar(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var u=(e,t,r)=>(cr(e,typeof t!="symbol"?t+"":t,r),r);import{s as T,i as nt,g as Ie,h as ye,j as ur,d as lr,k as pr,l as dr,m as Rt,L as fr,S as hr,n as mr,Q as gr,o as Er,p as yr,q as Sr,r as Mr,I as br,V as Rr,u as Ct,e as $t}from"./index.4424140c.js";import{d as kt,$ as Cr,c as Tr,C as Tt,a0 as Or,R as vr,a1 as zt,a2 as Vt,a3 as Yt,a4 as wr,a5 as Lr,a6 as Ar,a7 as xr,a8 as Ir,a9 as Dr,aa as Pr,O as Wt,u as Gr,g as Ur,n as Ot,S as vt,Q as jr,ab as Nr,B as Ne,ac as Hr,w as Br,ad as $r,ae as kr,af as zr,V as Q,ag as Vr,ah as Yr,m as Wr,k as He,x as de,ai as wt,I as P,A as Xr,aj as Jr,P as Zr,ak as Qr,i as qr,h as Kr,y as Xt,L as _r,T as he,al as Fr,am as en,an as tn,ao as rn,a as nn,ap as on,aq as De,M as sn,b as an,ar as qe,as as Ke,v as cn,at as un,au as ln,av as pn,aw as dn}from"./three.c9232d79.js";import{_ as ot,a as Pe,b as Ge,c as Be}from"./G6.7751b749.js";import{a as fn}from"./index.60f12b64.js";import{C as hn}from"./TextureDisplayer.5189c82c.js";const w=class{constructor(){u(this,"target",{});u(this,"map",new Map);u(this,"weakMap",new WeakMap);u(this,"engine");u(this,"cacheCompile")}getMap(){return this.map}useEngine(t){return this.engine=t,this}setTarget(t){return this.target=t,this}add(t){if(!w.processors.has(t.type))return console.warn(`${this.MODULE} compiler can not support this type: ${t.type}`),null;const n=w.processors.get(t.type).create(t,this.engine);return this.map.set(t.vid,n),this.weakMap.set(n,t.vid),n}remove(t){const r=t.vid;if(!this.map.has(r))return console.warn(`${this.MODULE} compiler can not found this vid object: ${r}.`),this;if(!w.processors.has(t.type))return console.warn(`${this.MODULE} compiler can not support this type: ${t.type}`),this;const n=this.map.get(r);return w.processors.get(t.type).dispose(n),this.map.delete(r),this.weakMap.delete(n),this}cover(t){const r=t.vid;return this.map.has(r)?(Promise.resolve().then(()=>{T(t,t,{vid:!0,type:!0})}),this):(console.warn(`${this.MODULE} compiler can not found this vid object: ${r}.`),this)}compile(t,r){const n=this.cacheCompile;let o,s,a;if(n&&n.vid===t)o=n.target,s=n.config,a=n.processor;else{if(!this.map.has(t))return console.warn(`${this.MODULE} compiler set function: can not found object which vid is: '${t}'`),this;if(!this.target[t])return console.warn(`${this.MODULE} compiler set function: can not found config which vid is: '${t}'`),this;if(o=this.map.get(t),s=this.target[t],!w.processors.has(s.type))return console.warn(`PassCompiler can not support this type: ${s.type}`),this;a=w.processors.get(s.type),this.cacheCompile={target:o,config:s,processor:a,vid:t}}return a.process({config:s,target:o,engine:this.engine,processor:a,compiler:this,...r}),this}compileAll(){const t=this.target;for(const r of Object.values(t))this.add(r);return this}dispose(){this.cacheCompile&&(this.cacheCompile=void 0);for(const t of Object.values(this.target)){if(!this.map.has(t.vid)){console.warn(`${this.MODULE} compiler set function: can not found object which vid is: '${t.vid}'`);continue}const r=this.map.get(t.vid);if(!w.processors.has(t.type)){console.warn(`${this.MODULE}  can not support this type: ${t.type}`);continue}w.processors.get(t.type).dispose(r)}return this.map.clear(),this.target={},this}getObjectSymbol(t){return this.weakMap.get(t)||null}getObjectBySymbol(t){return this.map.get(t)||null}};let d=w;u(d,"processors",new Map),u(d,"processor",function(t){w.processors.set(t.configType,t)});function H(e){return typeof e=="function"}function Jt(e){var t=function(n){Error.call(n),n.stack=new Error().stack},r=e(t);return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}var _e=Jt(function(e){return function(r){e(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(n,o){return o+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r}});function st(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var $e=function(){function e(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var t,r,n,o,s;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var c=ot(a),l=c.next();!l.done;l=c.next()){var f=l.value;f.remove(this)}}catch(v){t={error:v}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}else a.remove(this);var g=this.initialTeardown;if(H(g))try{g()}catch(v){s=v instanceof _e?v.errors:[v]}var A=this._finalizers;if(A){this._finalizers=null;try{for(var Re=ot(A),pe=Re.next();!pe.done;pe=Re.next()){var ir=pe.value;try{Lt(ir)}catch(v){s=s!=null?s:[],v instanceof _e?s=Pe(Pe([],Ge(s)),Ge(v.errors)):s.push(v)}}}catch(v){n={error:v}}finally{try{pe&&!pe.done&&(o=Re.return)&&o.call(Re)}finally{if(n)throw n.error}}}if(s)throw new _e(s)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)Lt(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(r=this._finalizers)!==null&&r!==void 0?r:[]).push(t)}},e.prototype._hasParent=function(t){var r=this._parentage;return r===t||Array.isArray(r)&&r.includes(t)},e.prototype._addParent=function(t){var r=this._parentage;this._parentage=Array.isArray(r)?(r.push(t),r):r?[r,t]:t},e.prototype._removeParent=function(t){var r=this._parentage;r===t?this._parentage=null:Array.isArray(r)&&st(r,t)},e.prototype.remove=function(t){var r=this._finalizers;r&&st(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}(),Zt=$e.EMPTY;function Qt(e){return e instanceof $e||e&&"closed"in e&&H(e.remove)&&H(e.add)&&H(e.unsubscribe)}function Lt(e){H(e)?e():e.unsubscribe()}var lt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},it={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var o=it.delegate;return o!=null&&o.setTimeout?o.setTimeout.apply(o,Pe([e,t],Ge(r))):setTimeout.apply(void 0,Pe([e,t],Ge(r)))},clearTimeout:function(e){var t=it.delegate;return((t==null?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function mn(e){it.setTimeout(function(){throw e})}function At(){}var Ce=null;function we(e){if(lt.useDeprecatedSynchronousErrorHandling){var t=!Ce;if(t&&(Ce={errorThrown:!1,error:null}),e(),t){var r=Ce,n=r.errorThrown,o=r.error;if(Ce=null,n)throw o}}else e()}var qt=function(e){Be(t,e);function t(r){var n=e.call(this)||this;return n.isStopped=!1,r?(n.destination=r,Qt(r)&&r.add(n)):n.destination=Sn,n}return t.create=function(r,n,o){return new at(r,n,o)},t.prototype.next=function(r){this.isStopped||this._next(r)},t.prototype.error=function(r){this.isStopped||(this.isStopped=!0,this._error(r))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(r){this.destination.next(r)},t.prototype._error=function(r){try{this.destination.error(r)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}($e),gn=Function.prototype.bind;function Fe(e,t){return gn.call(e,t)}var En=function(){function e(t){this.partialObserver=t}return e.prototype.next=function(t){var r=this.partialObserver;if(r.next)try{r.next(t)}catch(n){Te(n)}},e.prototype.error=function(t){var r=this.partialObserver;if(r.error)try{r.error(t)}catch(n){Te(n)}else Te(t)},e.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(r){Te(r)}},e}(),at=function(e){Be(t,e);function t(r,n,o){var s=e.call(this)||this,a;if(H(r)||!r)a={next:r!=null?r:void 0,error:n!=null?n:void 0,complete:o!=null?o:void 0};else{var c;s&&lt.useDeprecatedNextContext?(c=Object.create(r),c.unsubscribe=function(){return s.unsubscribe()},a={next:r.next&&Fe(r.next,c),error:r.error&&Fe(r.error,c),complete:r.complete&&Fe(r.complete,c)}):a=r}return s.destination=new En(a),s}return t}(qt);function Te(e){mn(e)}function yn(e){throw e}var Sn={closed:!0,next:At,error:yn,complete:At},Mn=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function bn(e){return e}function Rn(e){return e.length===0?bn:e.length===1?e[0]:function(r){return e.reduce(function(n,o){return o(n)},r)}}var xt=function(){function e(t){t&&(this._subscribe=t)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(t,r,n){var o=this,s=Tn(t)?t:new at(t,r,n);return we(function(){var a=o,c=a.operator,l=a.source;s.add(c?c.call(s,l):l?o._subscribe(s):o._trySubscribe(s))}),s},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(r){t.error(r)}},e.prototype.forEach=function(t,r){var n=this;return r=It(r),new r(function(o,s){var a=new at({next:function(c){try{t(c)}catch(l){s(l),a.unsubscribe()}},error:s,complete:o});n.subscribe(a)})},e.prototype._subscribe=function(t){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(t)},e.prototype[Mn]=function(){return this},e.prototype.pipe=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Rn(t)(this)},e.prototype.toPromise=function(t){var r=this;return t=It(t),new t(function(n,o){var s;r.subscribe(function(a){return s=a},function(a){return o(a)},function(){return n(s)})})},e.create=function(t){return new e(t)},e}();function It(e){var t;return(t=e!=null?e:lt.Promise)!==null&&t!==void 0?t:Promise}function Cn(e){return e&&H(e.next)&&H(e.error)&&H(e.complete)}function Tn(e){return e&&e instanceof qt||Cn(e)&&Qt(e)}var On=Jt(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),pt=function(e){Be(t,e);function t(){var r=e.call(this)||this;return r.closed=!1,r.currentObservers=null,r.observers=[],r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return t.prototype.lift=function(r){var n=new Dt(this,this);return n.operator=r,n},t.prototype._throwIfClosed=function(){if(this.closed)throw new On},t.prototype.next=function(r){var n=this;we(function(){var o,s;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var a=ot(n.currentObservers),c=a.next();!c.done;c=a.next()){var l=c.value;l.next(r)}}catch(f){o={error:f}}finally{try{c&&!c.done&&(s=a.return)&&s.call(a)}finally{if(o)throw o.error}}}})},t.prototype.error=function(r){var n=this;we(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=r;for(var o=n.observers;o.length;)o.shift().error(r)}})},t.prototype.complete=function(){var r=this;we(function(){if(r._throwIfClosed(),!r.isStopped){r.isStopped=!0;for(var n=r.observers;n.length;)n.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var r;return((r=this.observers)===null||r===void 0?void 0:r.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(r){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,r)},t.prototype._subscribe=function(r){return this._throwIfClosed(),this._checkFinalizedStatuses(r),this._innerSubscribe(r)},t.prototype._innerSubscribe=function(r){var n=this,o=this,s=o.hasError,a=o.isStopped,c=o.observers;return s||a?Zt:(this.currentObservers=null,c.push(r),new $e(function(){n.currentObservers=null,st(c,r)}))},t.prototype._checkFinalizedStatuses=function(r){var n=this,o=n.hasError,s=n.thrownError,a=n.isStopped;o?r.error(s):a&&r.complete()},t.prototype.asObservable=function(){var r=new xt;return r.source=this,r},t.create=function(r,n){return new Dt(r,n)},t}(xt),Dt=function(e){Be(t,e);function t(r,n){var o=e.call(this)||this;return o.destination=r,o.source=n,o}return t.prototype.next=function(r){var n,o;(o=(n=this.destination)===null||n===void 0?void 0:n.next)===null||o===void 0||o.call(n,r)},t.prototype.error=function(r){var n,o;(o=(n=this.destination)===null||n===void 0?void 0:n.error)===null||o===void 0||o.call(n,r)},t.prototype.complete=function(){var r,n;(n=(r=this.destination)===null||r===void 0?void 0:r.complete)===null||n===void 0||n.call(r)},t.prototype._subscribe=function(r){var n,o;return(o=(n=this.source)===null||n===void 0?void 0:n.subscribe(r))!==null&&o!==void 0?o:Zt},t}(pt);const Kt=new WeakMap,ct=function(e){Array.isArray(e)&&Kt.set(e,e.concat([]))},vn=function(e){return Kt.get(e)},Ue=new WeakMap,wn=function(e,t,r,n,o){const s=Reflect.get(e,t,r);return typeof t!="symbol"&&!n.isIgnore(o)&&(o=ye(o,t),n.next({operate:"get",path:o,key:t,value:e[t]})),s},Ln=function(e,t,r,n,o,s){if(typeof t=="symbol"||o.isIgnore(s))return Reflect.set(e,t,r,n);if(s=ye(s,t),nt(r)&&!Ue.has(r)&&(r=dt(o,r,s)),e[t]===void 0){Ie(r)&&ct(r);const c=Reflect.set(e,t,r);return o.next({operate:"add",path:s,key:t,value:r}),c}const a=Reflect.set(e,t,r);if(Ie(e)&&t==="length"){const c=vn(e);if(!c)return console.error("array value is not be cached:",e),a;const l=c.length-e.length;if(l>0){let f=0,g=0;s=s.slice(0,-t.length);for(const A of c)if(!e.includes(A)&&(o.next({operate:"delete",path:s+g,key:g.toString(),value:A}),f+=1,g+=1,f===l))break}return ct(e),a}return o.next({operate:"set",path:s,key:t,value:r}),a},An=function(e,t,r,n){if(typeof t=="symbol"||r.isIgnore(n))return Reflect.deleteProperty(e,t);n=ye(n,t);const o=e[t],s=Reflect.deleteProperty(e,t);return Ie(e)||r.next({operate:"delete",path:n,key:t,value:o}),s},dt=function(e,t,r=""){if(typeof t!="object"||Ue.has(t)||e.isIgnore(r))return t;const n={get:(s,a,c)=>wn(s,a,c,e,r),set:(s,a,c,l)=>Ln(s,a,c,l,e,r),deleteProperty:(s,a)=>An(s,a,e,r)};if(nt(t))for(const s in t){const a=ye(r,s);e.isIgnore(a)||nt(t[s])&&(Ie(t[s])&&ct(t[s]),t[s]=dt(e,t[s],a))}const o=new Proxy(t,n);return Ue.set(o,e),o};class xn extends pt{constructor(r,n){super();u(this,"ignore",{});u(this,"raw");this.raw=r,n&&(this.ignore=n)}isIgnore(r){let n=this.ignore;for(const o of r.split(".")){if(n[o]===void 0)return!1;if(typeof n[o]=="boolean"&&n[o])return!0;n=n[o]}return!1}setIgnore(r){this.ignore=r}mergeIgnore(r){this.ignore=Object.assign(this.ignore,r)}}const In=function(e,t){const r=new xn(e,t);return dt(r,e)},Dn=function(e){return Ue.get(e)},Pn=function(e,t,r){return Reflect.get(e,t,r)},Gn=function(e,t,r,n,o){if(typeof t=="symbol")return Reflect.set(e,t,r,n);if(e[t]===void 0){const s=Reflect.set(e,t,r);return o.add(r),o.next({operate:"add",path:t,key:t,value:r}),s}else{const s=Reflect.set(e,t,r);return o.remove(r.vid),o.add(r),o.next({operate:"set",path:t,key:t,value:r}),s}},Un=function(e,t,r){if(typeof t=="symbol")return Reflect.deleteProperty(e,t);const n=e[t],o=Reflect.deleteProperty(e,t);return r.next({operate:"delete",path:t,key:t,value:n}),r.remove(n.vid),o},bt=class extends pt{constructor(){super();u(this,"container");u(this,"subscriptions",new Map);this.container=new Proxy(bt.generator(),{get:Pn,set:(r,n,o,s)=>Gn(r,n,o,s,this),deleteProperty:(r,n)=>Un(r,n,this)})}add(r){const n=Dn(r);if(!n){console.error("DataContainer: this config can not Obasrvable",r);return}this.subscriptions.set(n.raw.vid,n.subscribe(o=>{o.operate!=="get"&&this.next({operate:o.operate,path:ye(n.raw.vid,o.path),key:o.key,value:o.value})}))}remove(r){this.subscriptions.delete(r)}};let Le=bt;u(Le,"generator",()=>({}));class jn{constructor(){u(this,"rule",()=>{});u(this,"members",[])}apply(t){return this.members.includes(t)||this.members.push(t),this}cancel(t){return this.members.includes(t)&&this.members.splice(this.members.indexOf(t),1),this}setRule(t){return this.rule=t,this}translate(t){const r=this.rule;for(const n of this.members)r(t,n);return this}}var i;(function(e){e.BOXGEOMETRY="BoxGeometry",e.SPHEREGEOMETRY="SphereGeometry",e.LOADGEOMETRY="LoadGeometry",e.PLANEGEOMETRY="PlaneGeometry",e.CIRCLEGEOMETRY="CircleGeometry",e.CONEGEOMETRY="ConeGeometry",e.CYLINDERGEOMETRY="CylinderGeometry",e.DODECAHEDRONGEOMETRY="DodecahedronGeometry",e.TORUSGEOMETRY="TorusGeometry",e.RINGGEOMETRY="RingGeometry",e.EDGESGEOMETRY="EdgesGeometry",e.LINECURVEGEOMETRY="LineCurveGeometry",e.SPLINECURVEGEOMETRY="SplineCurveGeometry",e.CUBICBEZIERCURVEGEOMETRY="CubicBezierCurveGeometry",e.QUADRATICBEZIERCURVEGEOMETRY="QuadraticBezierCurveGeometry",e.CUSTOMGEOMETRY="CustomGeometry",e.LINETUBEGEOMETRY="LineTubeGeometry",e.SPLINETUBEGEOMETRY="SplineTubeGeometry",e.LINESHAPEGEOMETRY="LineShapeGeometry",e.OBJECT3D="Object3D",e.MESH="Mesh",e.LINE="Line",e.POINTS="Points",e.SPRITE="Sprite",e.GROUP="Group",e.CSS3DOBJECT="CSS3DObject",e.CSS3DSPRITE="CSS3DSprite",e.CSS3DPLANE="CSS3DPlane",e.CSS2DPLANE="CSS2DPlane",e.IMAGETEXTURE="ImageTexture",e.CUBETEXTURE="CubeTexture",e.CANVASTEXTURE="CanvasTexture",e.VIDEOTEXTURE="VideoTexture",e.LOADTEXTURE="LoadTexture",e.MESHBASICMATERIAL="MeshBasicMaterial",e.MESHSTANDARDMATERIAL="MeshStandardMaterial",e.MESHPHONGMATERIAL="MeshPhongMaterial",e.SPRITEMATERIAL="SpriteMaterial",e.LINEBASICMATERIAL="LineBasicMaterial",e.POINTSMATERIAL="PointsMaterial",e.SHADERMATERIAL="ShaderMaterial",e.MESHPHYSICALMATERIAL="MeshPhysicalMaterial",e.AMBIENTLIGHT="AmbientLight",e.SPOTLIGHT="SpotLight",e.POINTLIGHT="PointLight",e.DIRECTIONALLIGHT="DirectionalLight",e.HEMISPHERELIGHT="HemisphereLight",e.RECTAREALIGHT="RectAreaLight",e.PERSPECTIVECAMERA="PerspectiveCamera",e.ORTHOGRAPHICCAMERA="OrthographicCamera",e.WEBGLRENDERER="WebGLRenderer",e.CSS3DRENDERER="CSS3DRenderer",e.SCENE="Scene",e.TRNASFORMCONTROLS="TransformControls",e.ORBITCONTROLS="OrbitControls",e.SCRIPTANIMATION="ScriptAnimation",e.KEYFRAMEANIMATION="KeyframeAnimation"})(i||(i={}));const U=()=>({vid:"",name:"",type:i.OBJECT3D,castShadow:!0,receiveShadow:!0,lookAt:"",visible:!0,matrixAutoUpdate:!0,renderOrder:0,position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},up:{x:0,y:1,z:0},parent:"",children:[],pointerdown:[],pointermove:[],pointerup:[],pointerenter:[],pointerleave:[],click:[],dblclick:[],contextmenu:[]}),Se=function(){return Object.assign(U(),{type:"Light",color:"rgb(255, 255, 255)",intensity:1})},Nn=function(){return Object.assign(U(),{type:i.AMBIENTLIGHT,color:"rgb(255, 255, 255)",intensity:1})},Hn=function(){return Object.assign(Se(),{type:i.POINTLIGHT,distance:30,decay:.01})},Bn=function(){return Object.assign(Se(),{type:i.SPOTLIGHT,distance:30,angle:Math.PI/180*45,penumbra:.01,decay:.01})},$n=function(){return Object.assign(Se(),{type:i.DIRECTIONALLIGHT,shadow:{mapSize:{width:512,height:512},camera:{near:.5,far:500}}})},kn=function(){return Object.assign(Se(),{type:i.HEMISPHERELIGHT,color:"rgb(255, 255, 255)",groundColor:"rgb(0, 0, 0)"})},zn=function(){return Object.assign(Se(),{type:i.RECTAREALIGHT,width:10,height:10})},b=function(){return{vid:"",type:"Geometry",position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},groups:[]}},Vn=function(){return Object.assign(b(),{type:i.BOXGEOMETRY,width:5,height:5,depth:5,widthSegments:1,heightSegments:1,depthSegments:1})},Yn=function(){return Object.assign(b(),{type:i.SPHEREGEOMETRY,radius:3,widthSegments:32,heightSegments:32,phiStart:0,phiLength:Math.PI*2,thetaStart:0,thetaLength:Math.PI})},Wn=function(){return Object.assign(b(),{type:i.PLANEGEOMETRY,width:5,height:5,widthSegments:1,heightSegments:1})},Xn=function(){return Object.assign(b(),{type:i.CIRCLEGEOMETRY,radius:3,segments:8,thetaStart:0,thetaLength:Math.PI*2})},Jn=function(){return Object.assign(b(),{type:i.CONEGEOMETRY,radius:3,height:5,radialSegments:8,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:Math.PI*2})},Zn=function(){return Object.assign(b(),{type:i.TORUSGEOMETRY,radius:3,tube:.4,radialSegments:8,tubularSegments:6,arc:Math.PI*2})},Qn=function(){return Object.assign(b(),{type:i.RINGGEOMETRY,innerRadius:2,outerRadius:3,thetaSegments:8,phiSegments:8,thetaStart:0,thetaLength:Math.PI*2})},qn=function(){return Object.assign(b(),{type:i.LOADGEOMETRY,url:""})},Kn=function(){return Object.assign(b(),{type:i.CUSTOMGEOMETRY,attribute:{position:[],color:[],index:[],normal:[],uv:[],uv2:[]}})},_n=function(){return Object.assign(b(),{type:i.CYLINDERGEOMETRY,radiusTop:3,radiusBottom:3,height:5,radialSegments:8,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:Math.PI*2})},Fn=function(){return Object.assign(b(),{type:"",radius:3,detail:0})},eo=function(){return Object.assign(b(),{type:i.LOADGEOMETRY,url:"",thresholdAngle:1})},ke=function(){return Object.assign(b(),{path:[],divisions:36,space:!0})},to=function(){return Object.assign(ke(),{type:i.LINECURVEGEOMETRY})},ro=function(){return Object.assign(ke(),{type:i.SPLINECURVEGEOMETRY})},no=function(){return Object.assign(ke(),{type:i.CUBICBEZIERCURVEGEOMETRY})},oo=function(){return Object.assign(ke(),{type:i.QUADRATICBEZIERCURVEGEOMETRY})},_t=function(){return Object.assign(b(),{type:"TubeGeometry",path:[],tubularSegments:64,radius:1,radialSegments:8,closed:!1})},so=function(){return Object.assign(_t(),{type:i.LINETUBEGEOMETRY})},io=function(){return Object.assign(_t(),{type:i.SPLINETUBEGEOMETRY})},ao=function(){return Object.assign(b(),{path:[],curveSegments:12})},co=function(){return Object.assign(ao(),{type:i.LINESHAPEGEOMETRY})},Me=function(){return{vid:"",type:"Texture",name:"",mapping:Tr,wrapS:Tt,wrapT:Tt,magFilter:kt,minFilter:Or,anisotropy:1,format:vr,flipY:!0,offset:{x:0,y:0},repeat:{x:1,y:1},rotation:0,center:{x:0,y:0},matrixAutoUpdate:!0,encoding:zt,needsUpdate:!1}},uo=function(){return Object.assign(Me(),{type:i.IMAGETEXTURE,url:""})},lo=function(){return Object.assign(Me(),{type:i.VIDEOTEXTURE,url:"",minFilter:kt})},po=function(){return Object.assign(Me(),{type:i.CUBETEXTURE,cube:{nx:"",ny:"",nz:"",px:"",py:"",pz:""},mapping:Cr,flipY:!1})},fo=function(){return Object.assign(Me(),{type:i.CANVASTEXTURE,url:"",needsUpdate:!1})},ho=function(){return Object.assign(Me(),{type:i.LOADTEXTURE,url:""})},q=function(){return{vid:"",type:"Material",alphaTest:0,colorWrite:!0,depthTest:!0,depthWrite:!0,fog:!0,name:"",needsUpdate:!1,opacity:1,dithering:!1,shadowSide:null,side:wr,toneMapped:!0,transparent:!1,visible:!0,blendDst:Lr,blendDstAlpha:null,blendEquation:Ar,blendEquationAlpha:null,blending:xr,blendSrc:Ir,blendSrcAlpha:null,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0}},mo=function(){return Object.assign(q(),{type:i.MESHBASICMATERIAL,color:"rgb(255, 255, 255)",combine:Vt,aoMapIntensity:1,fog:!0,lightMapIntensity:1,reflectivity:1,refractionRatio:.98,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",wireframeLinewidth:1,map:"",envMap:"",alphaMap:"",aoMap:"",lightMap:"",specularMap:""})},Ft=function(){return Object.assign(q(),{type:i.MESHSTANDARDMATERIAL,aoMapIntensity:1,bumpScale:1,color:"rgb(255, 255, 255)",displacementScale:1,displacementBias:0,emissive:"rgb(0, 0, 0)",emissiveIntensity:1,envMapIntensity:1,flatShading:!1,lightMapIntensity:1,metalness:0,normalMapType:Yt,refractionRatio:.98,roughness:1,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",roughnessMap:"",normalMap:"",metalnessMap:"",map:"",lightMap:"",envMap:"",emissiveMap:"",displacementMap:"",bumpMap:"",alphaMap:"",aoMap:""})},go=function(){return Object.assign(Ft(),{type:i.MESHPHYSICALMATERIAL,attenuationColor:"rgb(255, 255, 255)",attenuationDistance:0,clearcoat:0,clearcoatNormalScale:{x:1,y:1},clearcoatRoughness:0,ior:1.5,reflectivity:.5,sheen:0,sheenRoughness:1,sheenColor:"rgb(255, 255, 255)",specularIntensity:0,specularColor:"rgb(255, 255, 255)",thickness:0,transmission:0,clearcoatMap:"",clearcoatNormalMap:"",clearcoatRoughnessMap:"",sheenRoughnessMap:"",sheenColorMap:"",specularIntensityMap:"",specularColorMap:"",thicknessMap:"",transmissionMap:""})},Eo=function(){return Object.assign(q(),{type:i.MESHPHONGMATERIAL,aoMapIntensity:1,bumpScale:1,color:"rgb(255, 255, 255)",displacementScale:1,displacementBias:0,emissive:"rgb(0, 0, 0)",emissiveIntensity:1,envMapIntensity:1,flatShading:!1,lightMapIntensity:1,normalMapType:Yt,refractionRatio:.98,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",specular:"rgb(17, 17, 17)",shininess:30,combine:Vt,normalMap:"",map:"",lightMap:"",envMap:"",emissiveMap:"",displacementMap:"",bumpMap:"",alphaMap:"",aoMap:"",specularMap:""})},yo=function(){return Object.assign(q(),{type:i.SPRITEMATERIAL,color:"rgb(255, 255, 255)",rotation:0,map:"",alphaMap:"",sizeAttenuation:!0})},So=function(){return Object.assign(q(),{type:i.LINEBASICMATERIAL,color:"rgb(255, 255, 255)",linecap:"round",linejoin:"round",linewidth:1})},Mo=function(){return Object.assign(q(),{type:i.POINTSMATERIAL,map:"",alphaMap:"",color:"rgb(255, 255, 255)",sizeAttenuation:!0,size:1})},bo=function(){return Object.assign(q(),{type:i.SHADERMATERIAL,shader:"defaultShader",uniforms:{}})},Ro=function(){return Object.assign(U(),{type:i.PERSPECTIVECAMERA,adaptiveWindow:!1,fov:45,aspect:1920/1080,near:5,far:50})},Co=function(){return Object.assign(U(),{type:i.ORTHOGRAPHICCAMERA,adaptiveWindow:!1,left:-window.innerWidth,right:window.innerWidth,top:window.innerHeight,bottom:-window.innerHeight,near:5,far:50,zoom:1})};var p;(function(e){e.OBJECT3D="object3D",e.CAMERA="camera",e.LIGHT="light",e.GEOMETRY="geometry",e.TEXTURE="texture",e.MATERIAL="material",e.RENDERER="renderer",e.SCENE="scene",e.SPRITE="sprite",e.CONTROLS="controls",e.LINE="line",e.MESH="mesh",e.POINTS="points",e.GROUP="group",e.CSS3D="css3D",e.CSS2D="css2D",e.PASS="pass",e.ANIMATION="animation"})(p||(p={}));const To={[p.CAMERA]:!0,[p.LIGHT]:!0,[p.SCENE]:!0,[p.SPRITE]:!0,[p.LINE]:!0,[p.MESH]:!0,[p.POINTS]:!0,[p.GROUP]:!0,[p.CSS3D]:!0,[p.CSS2D]:!0,[p.OBJECT3D]:!0},G=function(e){return`DEFUALT-${e}`},ft=e=>{const t=r=>e.toLocaleLowerCase().includes(r.toLocaleLowerCase());for(const r of Object.values(p))if(t(r))return r;return null},Oo=e=>To[e],vo=e=>{const t=ft(e);return t?Oo(t):!1},er=function(){return{vid:"",type:"Renderer",size:null}},wo=function(){return Object.assign(er(),{vid:G(i.WEBGLRENDERER),type:i.WEBGLRENDERER,clearColor:"rgba(0, 0, 0, 0)",outputEncoding:zt,physicallyCorrectLights:!1,shadowMap:{enabled:!1,autoUpdate:!0,needsUpdate:!1,type:Dr},toneMapping:Pr,toneMappingExposure:1,pixelRatio:window.devicePixelRatio,adaptiveCamera:!1,viewport:null,scissor:null})},Lo=function(){return Object.assign(er(),{vid:G(i.CSS3DRENDERER),type:i.CSS3DRENDERER})},Ao=function(){return Object.assign(U(),{vid:G(i.SCENE),type:i.SCENE,background:"",environment:"",fog:{type:"",color:"rgb(150, 150, 150)",near:1,far:200,density:.003}})},xo=function(){return{vid:G(i.TRNASFORMCONTROLS),type:i.TRNASFORMCONTROLS,axis:"XYZ",enabled:!0,mode:"translate",snapAllow:!1,rotationSnap:Math.PI/180*10,translationSnap:5,scaleSnap:.1,showX:!0,showY:!0,showZ:!0,size:1,space:"world"}},Io=function(){return{vid:G(i.ORBITCONTROLS),type:i.ORBITCONTROLS,autoRotate:!1,autoRotateSpeed:2,enableDamping:!1,dampingFactor:.05,enabled:!0,enablePan:!0,enableRotate:!0,enableZoom:!0,maxAzimuthAngle:1/0,maxDistance:1/0,maxPolarAngle:Math.PI,maxZoom:1/0,minAzimuthAngle:-1/0,minDistance:0,minPolarAngle:0,minZoom:0,panSpeed:1,rotateSpeed:1,zoomSpeed:1,screenSpacePanning:!0,target:null}},ze=function(){return Object.assign(U(),{material:"",geometry:""})},Do=function(){return Object.assign(ze(),{type:"Sprite",material:"",center:{x:.5,y:.5}})},Po=function(){return Object.assign(ze(),{type:i.MESH,geometry:"",material:""})},Go=function(){return Object.assign(ze(),{type:i.POINTS,geometry:"",material:""})},Uo=function(){return Object.assign(ze(),{type:i.LINE,geometry:"",material:""})},jo=function(){return Object.assign(U(),{type:i.GROUP,children:[]})},tr=function(){return{vid:"",type:"",name:"",target:"",attribute:"",play:!0}},No=function(){return Object.assign(tr(),{type:i.SCRIPTANIMATION,script:{name:""}})},Ho=function(){return Object.assign(tr(),{type:i.KEYFRAMEANIMATION,script:{name:""}})},ht=function(){return Object.assign(U(),{type:i.CSS3DOBJECT,element:"",width:50,height:50})},Bo=function(){return Object.assign(ht(),{type:i.CSS3DPLANE})},$o=function(){return Object.assign(ht(),{type:i.CSS3DSPRITE,rotation2D:0})},ko=function(){return Object.assign(U(),{type:i.CSS3DOBJECT,element:"",width:50,height:50})},zo=function(){return Object.assign(ko(),{type:i.CSS2DPLANE})},y={[i.IMAGETEXTURE]:uo,[i.CUBETEXTURE]:po,[i.CANVASTEXTURE]:fo,[i.VIDEOTEXTURE]:lo,[i.LOADTEXTURE]:ho,[i.MESHBASICMATERIAL]:mo,[i.MESHSTANDARDMATERIAL]:Ft,[i.MESHPHONGMATERIAL]:Eo,[i.SPRITEMATERIAL]:yo,[i.LINEBASICMATERIAL]:So,[i.POINTSMATERIAL]:Mo,[i.SHADERMATERIAL]:bo,[i.MESHPHYSICALMATERIAL]:go,[i.AMBIENTLIGHT]:Nn,[i.SPOTLIGHT]:Bn,[i.POINTLIGHT]:Hn,[i.DIRECTIONALLIGHT]:$n,[i.HEMISPHERELIGHT]:kn,[i.RECTAREALIGHT]:zn,[i.BOXGEOMETRY]:Vn,[i.SPHEREGEOMETRY]:Yn,[i.LOADGEOMETRY]:qn,[i.CUSTOMGEOMETRY]:Kn,[i.PLANEGEOMETRY]:Wn,[i.CIRCLEGEOMETRY]:Xn,[i.CONEGEOMETRY]:Jn,[i.CYLINDERGEOMETRY]:_n,[i.EDGESGEOMETRY]:eo,[i.LINECURVEGEOMETRY]:to,[i.SPLINECURVEGEOMETRY]:ro,[i.CUBICBEZIERCURVEGEOMETRY]:no,[i.QUADRATICBEZIERCURVEGEOMETRY]:oo,[i.DODECAHEDRONGEOMETRY]:Fn,[i.SPLINETUBEGEOMETRY]:io,[i.LINETUBEGEOMETRY]:so,[i.TORUSGEOMETRY]:Zn,[i.RINGGEOMETRY]:Qn,[i.LINESHAPEGEOMETRY]:co,[i.OBJECT3D]:U,[i.SPRITE]:Do,[i.LINE]:Uo,[i.MESH]:Po,[i.POINTS]:Go,[i.GROUP]:jo,[i.CSS3DOBJECT]:ht,[i.CSS3DSPRITE]:$o,[i.CSS3DPLANE]:Bo,[i.CSS2DPLANE]:zo,[i.PERSPECTIVECAMERA]:Ro,[i.ORTHOGRAPHICCAMERA]:Co,[i.WEBGLRENDERER]:wo,[i.CSS3DRENDERER]:Lo,[i.SCENE]:Ao,[i.TRNASFORMCONTROLS]:xo,[i.ORBITCONTROLS]:Io,[i.SCRIPTANIMATION]:No,[i.KEYFRAMEANIMATION]:Ho},je=(e,t)=>t===1/0?"Infinity":t===-1/0?"-Infinity":t,Vo=(e,t)=>t==="Infinity"?1/0:t==="-Infinity"?-1/0:t,et=e=>JSON.parse(JSON.stringify(e,je),Vo);var Oe,Yo=new Uint8Array(16);function Wo(){if(!Oe&&(Oe=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Oe))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Oe(Yo)}var Xo=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Y(e){return typeof e=="string"&&Xo.test(e)}var E=[];for(var tt=0;tt<256;++tt)E.push((tt+256).toString(16).substr(1));function Jo(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=(E[e[t+0]]+E[e[t+1]]+E[e[t+2]]+E[e[t+3]]+"-"+E[e[t+4]]+E[e[t+5]]+"-"+E[e[t+6]]+E[e[t+7]]+"-"+E[e[t+8]]+E[e[t+9]]+"-"+E[e[t+10]]+E[e[t+11]]+E[e[t+12]]+E[e[t+13]]+E[e[t+14]]+E[e[t+15]]).toLowerCase();if(!Y(r))throw TypeError("Stringified UUID is invalid");return r}function fe(e,t,r){e=e||{};var n=e.random||(e.rng||Wo)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){r=r||0;for(var o=0;o<16;++o)t[r+o]=n[o];return t}return Jo(n)}class Zo{constructor(){u(this,"list",[]);u(this,"timer");u(this,"time",0)}exec(t){t(!1)||(this.list.includes(t)||this.list.push(t),this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{for(const r of this.list)r(!0);this.list=[]},this.time))}append(t){this.list.length&&!this.list.includes(t)?this.list.push(t):this.exec(t)}nextTick(t){setTimeout(()=>{t()},this.time)}}const K=new Zo,D=function(e,t,r={strict:!0,warn:!0}){if(!y[e])return console.error(`type: ${e} can not be found in configList.`),{vid:"",type:e};const n=(a,c)=>{for(const l in c){if(a[l]===void 0){!r.strict&&(a[l]=c[l]),r.strict&&r.warn&&console.warn(`'${e}' config can not set key: ${l}`);continue}typeof c[l]=="object"&&c[l]!==null&&!Array.isArray(c[l])?(a[l]===null&&(a[l]={...c[l]}),n(a[l],c[l])):a[l]=c[l]}};let o=y[e]();[i.SCRIPTANIMATION,i.KEYFRAMEANIMATION].includes(e)&&(r.strict=!1),o.vid===""&&(o.vid=fe()),t&&n(o,t),r.handler&&(o=r.handler(o));const s=In(o);if(D.autoInject&&D.injectEngine){const a=D.injectEngine;if(a.applyConfig(s),D.injectScene&&vo(o.type)&&o.type!==i.SCENE){let c=null;typeof D.injectScene=="boolean"?c=a.getObjectConfig(a.scene):typeof D.injectScene=="string"&&(c=a.getConfigBySymbol(D.injectScene)),c?c.children.push(o.vid):console.warn("current engine scene can not found it config",a,a.scene)}return s}return s};D.autoInject=!0;D.injectScene=!1;D.injectEngine=null;class B{constructor(t,r=[]){u(this,"dataContainer",new Le);u(this,"translater");this.translater=new jn().setRule(t),this.dataContainer.subscribe(n=>{this.translater.translate(n)});for(const n of r)this.addConfig(n)}getData(){return this.dataContainer.container}existSymbol(t){return Boolean(this.dataContainer.container[t])}addConfig(t){return this.dataContainer.container[t.vid]=t,this}getConfig(t){return this.dataContainer.container[t]}removeConfig(t){const r=this.dataContainer.container;r[t]!==void 0&&delete r[t]}addCompiler(t){return t.setTarget(this.dataContainer.container),t.compileAll(),this.translater.apply(t),this}toJSON(t=!0){return t?JSON.stringify(this.exportConfig(),je):JSON.stringify(Object.values(this.dataContainer.container),je)}exportConfig(t=!0){if(t){const r=this.dataContainer.container,n=[],o={},s=(a,c,l={})=>{for(const f in a){if(["vid","type"].includes(f)){l[f]=a[f];continue}if(typeof a[f]=="object"&&a[f]!==null){if(Array.isArray(a[f])){if(!a[f].length)continue;l[f]=a[f].map(g=>typeof g=="object"&&g!==null?et(g):g);continue}l[f]={},c[f]?(s(a[f],c[f],l[f]),Object.keys(l[f]).length===0&&delete l[f]):l[f]=et(a[f])}else c[f]!==a[f]&&(l[f]=a[f])}};for(const a of Object.values(r)){if(!o[a.type]){if(!y[a.type]){console.error(`can not font some config with: ${a.type}`);continue}o[a.type]=y[a.type]()}const c={};s(a,o[a.type],c),n.push(c)}return n}else return Object.values(et(this.dataContainer.container))}load(t){const r=this.dataContainer.container,n={},o=(s,a)=>{for(const c in a)typeof s[c]=="object"&&s[c]!==null&&typeof a[c]=="object"&&a[c]!==null?o(s[c],a[c]):s[c]===void 0&&(s[c]=a[c])};for(const s of t){if(!n[s.type]){if(!y[s.type]){console.error(`can not font some config with: ${s.type}`);continue}n[s.type]=y[s.type]()}o(s,n[s.type]),r[s.vid]=s}return this}remove(t){const r=this.dataContainer.container;for(const n of t)r[n.vid]!==void 0&&delete r[n.vid];return this}getModule(){return this.MODULE}}class Qo{constructor(t){u(this,"configType");u(this,"commands");u(this,"create");u(this,"dispose");this.configType=t.configType,this.commands=t.commands,this.create=t.create,this.dispose=t.dispose}process(t){if(!this.commands||!this.commands[t.operate]){this[t.operate](t);return}let r=this.commands[t.operate];for(const n of[].concat(t.path,t.key))if(!r[n]&&!r.$reg){this[t.operate](t);return}else if(r[n])if(typeof r[n]=="function"){r[n](t);return}else r=r[n];else if(r.$reg){for(const o of r.$reg)if(o.reg.test(n)){o.handler(t);return}}this[t.operate](t)}add(t){let r=t.target;const n=t.path;for(const o of n)if(typeof r[o]!==void 0)r=r[o];else{console.warn("processor can not exec default add operate.",t);return}r[t.key]=t.value}set(t){let r=t.target;const n=t.path;for(const o of n)if(typeof r[o]!==void 0)r=r[o];else{console.warn("processor can not exec default set operate.",t);return}r[t.key]=t.value}delete(t){let r=t.target;const n=t.path;for(const o of n)if(typeof r[o]!==void 0)r=r[o];else{console.warn("processor can not exec default delete operate.",t);return}delete r[t.key]}}const h=e=>new Qo(e),Ae=function(){},_=(e,t,r=Y)=>{const{operate:n,key:o,path:s,value:a}=e;let c=o;const l=s.split(".");if(s.length&&(c=l.shift(),l.pop()),!r(c)){console.warn(`${t.MODULE} Rule: vid is illeage: ${c}`);return}if(n==="add"&&!l.length){t.add(a);return}if(e.operate==="delete"&&!l.length){t.remove(a);return}if(e.operate==="set"&&!l.length&&o===c){t.cover(a);return}t.compile(c,{operate:n,key:o,path:l,value:a})},Z="vis.scriptAni",x=class{static generateConfig(t,r){if(!x.configLibrary.has(t))return console.warn(`event library can not found config by name: ${t}`),{name:""};const n=(s,a)=>{for(const c in a)s[c]!==void 0&&(typeof a[c]=="object"&&a[c]!==null&&!Array.isArray(a[c])?n(s[c],a[c]):s[c]=a[c])},o=JSON.parse(JSON.stringify(x.configLibrary.get(t)));return n(o,r),o}static generateScript(t,r,n,o){return x.generatorLibrary.has(o.name)?x.generatorLibrary.get(o.name)(t,r,n,o):(console.error(`event library can not found generator by name: ${o.name}`),()=>{})}static has(t){return x.configLibrary.has(t)}};let oe=x;u(oe,"configLibrary",new Map),u(oe,"generatorLibrary",new Map),u(oe,"register",function(t,r){x.configLibrary.has(t.name)&&console.warn(`EventLibrary has already exist this event generator: ${t.name}, that will be cover.`),x.configLibrary.set(t.name,JSON.parse(JSON.stringify(t))),x.generatorLibrary.set(t.name,r)});const Pt=function(e,t){let r=t.compilerManager.getObjectBySymbol(e.target);if(!r)return console.warn(`can not found object in enigne: ${e.target}`),()=>{};const n=e.attribute.split(".");n.shift();const o=n.pop();for(const s of n){if(r[s]===void 0)return console.warn(`animaton processor: target object can not found key: ${s}`,r),()=>{};r=r[s]}return oe.generateScript(t,r,o,e.script)};var qo=h({configType:i.SCRIPTANIMATION,commands:{set:{play({target:e,engine:t,value:r}){r?t.renderManager.addEventListener("render",e):t.renderManager.removeEventListener("render",e)},$reg:[{reg:new RegExp(".*"),handler({config:e,engine:t}){const r=e[Symbol.for(Z)];t.renderManager.removeEventListener("render",r);const n=Pt(e,t);e[Symbol.for(Z)]=n,e.play&&t.renderManager.addEventListener("render",r)}}]}},create(e,t){const r=Pt(e,t);return e.play&&t.renderManager.addEventListener("render",r),e[Symbol.for(Z)]=r,r},dispose(){}});class Ko extends d{constructor(){super();u(this,"MODULE",p.ANIMATION)}restoreAttribute(r){if(!r.target||!r.attribute)return this;let n=this.engine.getObjectBySymbol(r.target),o=this.engine.getConfigBySymbol(r.target);(!n||!o)&&console.warn("AnimationCompiler: can not found object target or config in engine",r.vid);const s=r.attribute.split(".");s.shift();const a=s.pop();for(const c of s)if(n[c]&&o[c])n=n[c],o=o[c];else return console.warn("AnimationCompiler: object and config attribute are not sync"),this;return n[a]=o[a],this}cover(r){super.cover(r);const n=this.map.get(r.vid);return r[Symbol.for(Z)]=n,this}remove(r){return this.engine.removeEventListener("render",r[Symbol.for(Z)]),this.restoreAttribute(r),delete r[Symbol.for(Z)],super.remove(r),this}compile(r,n){const o=this.target[r];this.restoreAttribute(o),super.compile(r,n);const s=this.map.get(r),a=o[Symbol.for(Z)];return this.map.set(o.vid,a),this.weakMap.delete(s),this.weakMap.set(a,r),this}}d.processor(qo);const _o=function(e,t){e.key==="name"&&e.path.length===1||_(e,t)};class Fo extends B{constructor(r=[]){super(_o,r);u(this,"MODULE",p.ANIMATION)}}class $ extends d{constructor(){super()}}const I=class{static generateConfig(t,r){if(!I.configLibrary.has(t))return console.warn(`event library can not found config by name: ${t}`),{name:""};const n=(s,a)=>{for(const c in a)typeof a[c]=="object"&&a[c]!==null&&!Array.isArray(a[c])?n(s[c],a[c]):s[c]=a[c]},o=JSON.parse(JSON.stringify(I.configLibrary.get(t)));return n(o,r),o}static generateEvent(t,r){return I.generatorLibrary.has(t.name)?I.generatorLibrary.get(t.name)(r,t):(console.error(`event library can not found generator by name: ${t.name}`),()=>{})}static has(t){return I.configLibrary.has(t)}};let V=I;u(V,"configLibrary",new Map),u(V,"generatorLibrary",new Map),u(V,"register",function(t,r){I.configLibrary.has(t.name)&&console.warn(`EventGeneratorManager has already exist this event generator: ${t.name}, that will be cover.`),I.configLibrary.set(t.name,JSON.parse(JSON.stringify(t))),I.generatorLibrary.set(t.name,r)});const Gt=new WeakMap,rr=function({target:e,config:t,value:r,engine:n}){if(t.vid===r){console.warn("can not set object lookAt itself.");return}let o=Gt.get(e);if(o||(o={lookAtTarget:null,updateMatrixWorldFun:null},Gt.set(e,o)),!r){if(!o.updateMatrixWorldFun)return;e.updateMatrixWorld=o.updateMatrixWorldFun,o.lookAtTarget=null,o.updateMatrixWorldFun=null;return}K.exec(s=>{const a=n.compilerManager.getObject3D(r);if(!a)return s&&console.warn(`lookAt handler can not found this vid mapping object: '${r}'`),!1;const c=e.updateMatrixWorld;return o.updateMatrixWorldFun=c,o.lookAtTarget=a.position,e.updateMatrixWorld=l=>{c.call(e,l),e.lookAt(o.lookAtTarget)},!0})},Ee="vis.event",j=function({target:e,path:t,value:r,engine:n}){const o=t[0];if(!V.has(r.name)){console.warn(`EventGeneratorManager: can not support this event: ${r.name}`);return}const s=V.generateEvent(r,n),a=Symbol.for(Ee);r[a]=s,e.addEventListener(o,s)},k=function({target:e,path:t,value:r}){const n=t[0],o=r[Symbol.for(Ee)];if(!o){console.warn("event remove can not fun found event in config",r);return}e.removeEventListener(n,o),delete r[Symbol.for(Ee)]},z=function({target:e,config:t,path:r,engine:n}){if(r.length<2)return;const o=r[0],s=t[r[0]][r[1]],a=s[Symbol.for(Ee)];if(!a){console.warn("event remove can not fun found event in config",s);return}e.removeEventListener(o,a);const c=V.generateEvent(s,n);s[Symbol.for(Ee)]=c,e.addEventListener(o,c)},ut=function({target:e,config:t,value:r,engine:n}){K.exec(o=>{const s=n.getConfigBySymbol(r);if(!s)return o&&console.warn(` can not foud object config in engine: ${r}`),!1;if(s.parent&&s.parent!==t.vid){const c=n.getConfigBySymbol(s.parent);if(!c)return o&&console.warn(` can not foud object parent config in engine: ${s.parent}`),!1;c.children.splice(c.children.indexOf(r),1)}s.parent=t.vid;const a=n.compilerManager.getObject3D(r);return a?(e.add(a),!0):(o&&console.warn(`can not found this vid in engine: ${r}.`),!1)})},es=function({target:e,config:t,value:r,engine:n}){const o=n.compilerManager.getObject3D(r);if(!o){console.warn(`can not found this vid in engine: ${r}.`);return}e.remove(o);const s=n.getConfigBySymbol(r);if(!s){console.warn(`can not found this vid in engine: ${r}.`);return}s.parent=""},O=function(e,t,r,n){Promise.resolve(),!r.lookAt&&rr({target:e,config:t,engine:n,value:t.lookAt}),t.children.forEach(o=>{ut({target:e,config:t,value:o,engine:n})});for(const o of Object.values(fn))K.nextTick(()=>(t[o].forEach((s,a)=>{j({target:e,path:[o,a.toString()],value:s,engine:n})}),!0));return T(t,e,{vid:!0,type:!0,lookAt:!0,parent:!0,children:!0,pointerdown:!0,pointermove:!0,pointerup:!0,pointerenter:!0,pointerleave:!0,click:!0,dblclick:!0,contextmenu:!0,...r}),e},M=function(e){e._listener={}},m={add:{pointerdown:j,pointerup:j,pointermove:j,pointerenter:j,pointerleave:j,click:j,dblclick:j,contextmenu:j,children:ut},set:{lookAt:rr,pointerdown:z,pointerup:z,pointermove:z,pointerenter:z,pointerleave:z,click:z,dblclick:z,contextmenu:z,parent:Ae,children:{$reg:[{reg:new RegExp(".*"),handler:ut}]}},delete:{pointerdown:k,pointerup:k,pointermove:k,pointerenter:k,pointerleave:k,click:k,dblclick:k,contextmenu:k,children:es}};h({configType:i.OBJECT3D,commands:m,create(e,t){return O(new Wt,e,{},t)},dispose:M});const C=new WeakMap;var ts=h({configType:i.PERSPECTIVECAMERA,commands:{add:{scale(){},...m.add},set:{scale(){},adaptiveWindow({target:e,value:t,engine:r}){if(t){if(!C.has(t)){const n=o=>{e.aspect=o.width/o.height,e.updateProjectionMatrix()};C.set(e,n),r.addEventListener("setSize",n),n({type:"setSize",width:r.dom.offsetWidth,height:r.dom.offsetHeight})}}else{const n=C.get(e);n&&(r.removeEventListener("setSize",n),C.delete(e))}},...m.set,$reg:[{reg:new RegExp("fov|aspect|near|far"),handler({target:e,key:t,value:r}){e[t]=r,e.updateProjectionMatrix()}}]},delete:{scale(){},...m.delete}},create(e,t){const r=new Gr;if(O(r,e,{scale:!0,adaptiveWindow:!0},t),r.updateProjectionMatrix(),e.adaptiveWindow){const n=o=>{r.aspect=o.width/o.height,r.updateProjectionMatrix()};C.set(r,n),t.addEventListener("setSize",n),n({type:"setSize",width:t.dom.offsetWidth,height:t.dom.offsetHeight})}return r},dispose(e){C.delete(e),M(e)}}),rs=h({configType:i.ORTHOGRAPHICCAMERA,commands:{add:{scale(){},...m.add},set:{scale(){},adaptiveWindow({target:e,value:t,engine:r}){if(t){if(!C.has(t)){const n=o=>{const s=o.width,a=o.height;e.left=-s,e.right=s,e.top=a,e.bottom=-a,e.updateProjectionMatrix()};C.set(e,n),r.addEventListener("setSize",n),n({type:"setSize",width:r.dom.offsetWidth,height:r.dom.offsetHeight})}}else{const n=C.get(e);n&&(r.removeEventListener("setSize",n),C.delete(e))}},...m.set,$reg:[{reg:new RegExp("left|right|top|bottom|near|far|zoom"),handler({target:e,key:t,value:r}){e[t]=r,e.updateProjectionMatrix()}}]},delete:{scale(){},...m.delete}},create(e,t){const r=new Ur(-50,50,50,-50);if(O(r,e,{scale:!0,adaptiveWindow:!0},t),r.updateProjectionMatrix(),e.adaptiveWindow){const n=o=>{const s=o.width,a=o.height;r.left=-s,r.right=s,r.top=a,r.bottom=-a,r.updateProjectionMatrix()};C.set(r,n),t.addEventListener("setSize",n),n({type:"setSize",width:t.dom.offsetWidth,height:t.dom.offsetHeight})}return r},dispose(e){C.delete(e),M(e)}});class ns extends ${constructor(){super();u(this,"MODULE",p.CAMERA)}}d.processor(ts);d.processor(rs);class F extends B{constructor(r,n=[]){super(r,n);u(this,"MODULE",p.GROUP)}}const L=function(e,t,r=Y){e.key!=="parent"&&_(e,t,r)},os=function(e,t){L(e,t)};class ss extends F{constructor(r=[]){super(os,r);u(this,"MODULE",p.CAMERA)}}class is extends d{constructor(){super();u(this,"MODULE",p.CONTROLS)}}const as=[G(i.TRNASFORMCONTROLS),G(i.ORBITCONTROLS)],cs=function(e,t){_(e,t,r=>Y(r)||as.includes(r))};class us extends B{constructor(r=[]){super(cs,r);u(this,"MODULE",p.CONTROLS)}}const Ut=function(e,t){const r=t.resourceManager.resourceMap;if(!r.has(e))return console.warn(`css2D compiler: can not found resource element: ${e}`),document.createElement("div");const n=r.get(e);return n instanceof HTMLElement?n:(console.warn("css2D compiler can not suport render this resource type.",n.constructor,e),document.createElement("div"))};var ls=h({configType:i.CSS2DPLANE,commands:{add:m.add,set:{element({target:e,value:t,engine:r}){e.element.innerHTML="",e.element.appendChild(Ut(t,r))},...m.set},delete:m.delete},create(e,t){return O(new ur(Ut(e.element,t)),e,{element:!0},t)},dispose:M});class ps extends ${constructor(){super();u(this,"MODULE",p.CSS2D)}}d.processor(ls);const ds=function(e,t){L(e,t)};class fs extends F{constructor(r=[]){super(ds,r);u(this,"MODULE",p.CSS2D)}}const ae=function(e,t){const r=t.resourceManager.resourceMap;if(!r.has(e))return console.warn(`css3D compiler: can not found resource element: ${e}`),document.createElement("div");const n=r.get(e);return n instanceof HTMLElement?n:(console.warn("css3D compiler can not suport render this resource type.",n.constructor,e),document.createElement("div"))};var hs=h({configType:i.CSS3DOBJECT,commands:{add:m.add,set:{element({target:e,value:t,engine:r}){e.element=ae(t,r)},...m.set},delete:m.delete},create(e,t){return O(new lr(ae(e.element,t)),e,{element:!0},t)},dispose:M}),ms=h({configType:i.CSS3DPLANE,commands:{add:m.add,set:{element({target:e,value:t,engine:r}){e.element.innerHTML="",e.element.appendChild(ae(t,r))},...m.set},delete:m.delete},create(e,t){return O(new pr(ae(e.element,t)),e,{element:!0},t)},dispose:M}),gs=h({configType:i.CSS3DSPRITE,commands:{add:m.add,set:{element({target:e,value:t,engine:r}){e.element.innerHTML="",e.element.appendChild(ae(t,r))},...m.set},delete:m.delete},create(e,t){return O(new dr(ae(e.element,t)),e,{element:!0},t)},dispose:M});class Es extends ${constructor(){super();u(this,"MODULE",p.CSS3D)}}d.processor(ms);d.processor(hs);d.processor(gs);const ys=function(e,t){L(e,t)};class Ss extends F{constructor(r=[]){super(ys,r);u(this,"MODULE",p.CSS3D)}}const Ms=function(e,t){!(e instanceof Rt)&&!(e instanceof Ot)&&!(e instanceof vt)&&e.center(),e.computeBoundingBox();const r=e.boundingBox,n=t.position,o=t.rotation,s=t.scale,a=new jr().setFromEuler(new Nr(o.x,o.y,o.z,"XYZ"));return e.applyQuaternion(a),e.scale(s.x,s.y,s.z),!(e instanceof Rt)&&!(e instanceof Ot)&&!(e instanceof vt)&&e.center(),e.computeBoundingBox(),e.translate((r.max.x-r.min.x)/2*n.x,(r.max.y-r.min.y)/2*n.y,(r.max.z-r.min.z)/2*n.z),e},rt={reg:new RegExp(".*"),handler({config:e,target:t,processor:r,engine:n}){const o=r.create(e,n);t.copy(o),t.dispatchEvent({type:"update"}),t.uuid=o.uuid,o.dispose()}},Ve={add:{groups({target:e,value:t}){e.addGroup(t.start,t.count,t.materialIndex)},$reg:[rt]},set:{groups(e){const{path:t,target:r,config:n}=e;if(t[1]!==void 0){r.groups.splice(Number(e.path[1]),1);const o=n.groups[t[1]];r.addGroup(o.start,o.count,o.materialIndex)}else console.warn("geometry processor can not set group",e)},$reg:[rt]},delete:{groups({target:e,key:t}){e.groups.splice(Number(t),1)},$reg:[rt]}},Ye=function(e,t){e.clearGroups();for(const r of t.groups)e.addGroup(r.start,r.count,r.materialIndex);return Ms(e,t)},S=new Map;S.set(i.BOXGEOMETRY,e=>new Ne(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments));S.set(i.SPHEREGEOMETRY,e=>new Hr(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength));S.set(i.PLANEGEOMETRY,e=>new Br(e.width,e.height,e.widthSegments,e.heightSegments));S.set(i.CIRCLEGEOMETRY,e=>new $r(e.radius,e.segments,e.thetaStart,e.thetaLength));S.set(i.CONEGEOMETRY,e=>new kr(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength));S.set(i.CYLINDERGEOMETRY,e=>new zr(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength));S.set(i.LINECURVEGEOMETRY,e=>new fr(e.path.map(t=>new Q(t.x,t.y,t.z)),e.divisions,e.space));S.set(i.SPLINECURVEGEOMETRY,e=>new hr(e.path.map(t=>new Q(t.x,t.y,t.z)),e.divisions,e.space));S.set(i.CUBICBEZIERCURVEGEOMETRY,e=>new mr(e.path.map(t=>new Q(t.x,t.y,t.z)),e.divisions,e.space));S.set(i.QUADRATICBEZIERCURVEGEOMETRY,e=>new gr(e.path.map(t=>new Q(t.x,t.y,t.z)),e.divisions,e.space));S.set(i.LINETUBEGEOMETRY,e=>new Er(e.path.map(t=>new Q(t.x,t.y,t.z)),e.tubularSegments,e.radius,e.radialSegments,e.closed));S.set(i.SPLINETUBEGEOMETRY,e=>new yr(e.path.map(t=>new Q(t.x,t.y,t.z)),e.tubularSegments,e.radius,e.radialSegments,e.closed));S.set(i.TORUSGEOMETRY,e=>new Vr(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc));S.set(i.RINGGEOMETRY,e=>new Yr(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength));S.set(i.LINESHAPEGEOMETRY,e=>new Sr(e.path.map(t=>new Wr(t.x,t.y)),e.curveSegments));const bs=function(e){return S.has(e.type)?Ye(S.get(e.type)(e),e):(console.error(`parametric geometry can not support this type config: ${e.type}`),new He)},Rs=function(e){e.dispose()},Cs=function(e){return h({configType:e,commands:Ve,create:bs,dispose:Rs})},Ts=[i.BOXGEOMETRY,i.SPHEREGEOMETRY,i.PLANEGEOMETRY,i.CIRCLEGEOMETRY,i.CONEGEOMETRY,i.CYLINDERGEOMETRY,i.LINECURVEGEOMETRY,i.SPLINECURVEGEOMETRY,i.CUBICBEZIERCURVEGEOMETRY,i.QUADRATICBEZIERCURVEGEOMETRY,i.LINETUBEGEOMETRY,i.SPLINETUBEGEOMETRY,i.TORUSGEOMETRY,i.RINGGEOMETRY,i.LINESHAPEGEOMETRY],Os=Ts.map(e=>Cs(e));var vs=h({configType:i.LOADGEOMETRY,commands:Ve,create(e,t){const r=t.resourceManager.resourceMap.get(e.url);return!r&&!(r instanceof He)?(console.error(`engine rescoure can not found url: ${e.url}`),new Ne(5,5,5)):Ye(new Mr(r),e)},dispose(e){e.dispose()}});const ws=function(e){const t=new He;return e.position.length&&t.setAttribute("position",new de(e.position,3)),e.color.length&&t.setAttribute("color",new de(e.color,3)),e.normal.length&&t.setAttribute("normal",new de(e.normal,3)),e.uv.length&&t.setAttribute("uv",new de(e.uv,2)),e.uv2.length&&t.setAttribute("uv2",new de(e.uv2,2)),e.index.length&&t.setIndex(e.index),t};var Ls=h({configType:i.CUSTOMGEOMETRY,commands:Ve,create(e){return Ye(ws(e.attribute),e)},dispose(e){e.dispose()}}),As=h({configType:i.EDGESGEOMETRY,commands:Ve,create(e,t){const r=t.compilerManager.getObjectBySymbol(e.url);return!r||!(r instanceof He)?(console.error(`engine rescoure can not found url: ${e.url}`),new wt(new Ne(5,5,5))):Ye(new wt(r),e)},dispose(e){e.dispose()}});class xs extends d{constructor(){super();u(this,"MODULE",p.GEOMETRY)}}Os.forEach(e=>{d.processor(e)});d.processor(vs);d.processor(Ls);d.processor(As);const Is=function(e,t){_(e,t)};class Ds extends B{constructor(r=[]){super(Is,r);u(this,"MODULE",p.GEOMETRY)}}const Ps=function({target:e,value:t}){e.color.copy(new P(t))},ue=function(e,t,r,n){return e.color.copy(new P(t.color)),O(e,t,{color:!0,scale:!0,rotation:!0,lookAt:!0,...r},n)},le=Object.assign({},m,{set:{color:Ps,scale:Ae,rotation:Ae,lookAt:Ae}});var Gs=h({configType:i.AMBIENTLIGHT,commands:le,create(e,t){return ue(new Xr,e,{},t)},dispose:M}),Us=h({configType:i.DIRECTIONALLIGHT,commands:le,create(e,t){return ue(new Jr,e,{},t)},dispose:M}),js=h({configType:i.POINTLIGHT,commands:le,create(e,t){return ue(new Zr,e,{},t)},dispose:M}),Ns=h({configType:i.SPOTLIGHT,commands:le,create(e,t){return ue(new Qr,e,{},t)},dispose:M}),Hs=h({configType:i.HEMISPHERELIGHT,commands:{set:{...le.set,groundColor:function({target:e,value:t}){e.groundColor.copy(new P(t))}}},create(e,t){const r=new qr;return r.groundColor.copy(new P(e.groundColor)),ue(r,e,{groundColor:!0},t)},dispose:M}),Bs=h({configType:i.RECTAREALIGHT,commands:le,create(e,t){return ue(new Kr,e,{},t)},dispose:M});class $s extends ${constructor(){super();u(this,"MODULE",p.LIGHT)}}d.processor(Gs);d.processor(Us);d.processor(js);d.processor(Ns);d.processor(Hs);d.processor(Bs);const ks=function(e,t){L(e,t)};class zs extends F{constructor(r=[]){super(ks,r);u(this,"MODULE",p.LIGHT)}}class We extends ${constructor(){super();u(this,"MODULE",p.MESH)}}const ve=new Xt({fragmentShader:`
  void main () {
    gl_FragColor = vec4(0.5, 0.5, 0.5, 1.0);
  }
  `}),Vs=new Ne(10,10,10),nr=function({target:e,value:t,engine:r}){K.exec(n=>{const o=r.compilerManager.getGeometry(t);return o?(e.geometry=o,!0):(n&&console.warn(`can not found geometry by vid in engine: ${t}`),e.geometry=Vs,!1)})},xe=function({target:e,config:t,engine:r}){K.exec(n=>{let o;return typeof t.material=="string"?o=r.compilerManager.getMaterial(t.material)||ve:o=t.material.map(s=>r.compilerManager.getMaterial(s)||ve),e.material=o,!(Array.isArray(o)&&o.length&&o[0]===ve||o===ve)})},Xe=function(e,t,r,n){return r.geometry||(e.geometry.dispose(),nr({target:e,value:t.geometry,engine:n})),r.material||xe({target:e,config:t,engine:n}),O(e,t,{geometry:!0,material:!0,...r},n)},Je=function(e){M(e)},ie={add:{material:xe,...m.add},set:{geometry:nr,material:xe,...m.set},delete:{material:xe,...m.delete}};var Ys=h({configType:i.LINE,commands:ie,create(e,t){return Xe(new _r,e,{},t)},dispose:Je});class Ws extends We{constructor(){super();u(this,"MODULE",p.LINE)}}d.processor(Ys);class Ze extends B{constructor(r,n=[]){super(r,n);u(this,"MODULE",p.MESH)}}const Xs=function(e,t){L(e,t)};class Js extends Ze{constructor(r=[]){super(Xs,r);u(this,"MODULE",p.LINE)}}const W={reg:new RegExp("transparent|sizeAttenuation"),handler({target:e,key:t,value:r}){e[t]=r,e.needsUpdate=!0}},or=function({target:e,key:t,value:r,engine:n}){K.exec(o=>{const s=n.compilerManager.getObjectBySymbol(r);return s instanceof he?(e[t]=s,e.needsUpdate=!0,!0):(o&&console.warn(`this url resource is not instance of Texture: ${t}`,r,s),e[t]=null,!1)})},ee={reg:new RegExp("map$","i"),handler:or},R=function({target:e,key:t,value:r}){e[t].copy(new P(r))},te=function(e,t,r){const n={};for(const o of Object.keys(t))o.toLocaleLowerCase().endsWith("map")&&t[o]?(or({target:e,key:o,value:t[o],engine:r}),n[o]=!0):e[o]instanceof P&&(e[o]=new P(t[o]),n[o]=!0);return T(t,e,n),e.needsUpdate=!0,e},X=function(e){e.dispose()};var sr=h({configType:i.LINEBASICMATERIAL,commands:{set:{color:R,$reg:[ee,W]}},create:function(e,t){return te(new Fr,e,t)},dispose:X}),Zs=h({configType:i.MESHBASICMATERIAL,commands:{set:{color:R,$reg:[ee,W]}},create:function(e,t){return te(new en,e,t)},dispose:X}),Qs=h({configType:i.MESHPHONGMATERIAL,commands:{set:{color:R,emissive:R,specular:R,$reg:[ee,W]}},create:function(e,t){return te(new tn,e,t)},dispose:X}),qs=h({configType:i.MESHPHYSICALMATERIAL,commands:{set:{color:R,emissive:R,specularColor:R,sheenColor:R,attenuationColor:R,$reg:[ee,W]}},create:function(e,t){return te(new rn,e,t)},dispose:X}),Ks=h({configType:i.MESHSTANDARDMATERIAL,commands:{set:{color:R,emissive:R,$reg:[ee,W]}},create:function(e,t){return te(new nn,e,t)},dispose:X}),_s=h({configType:i.POINTSMATERIAL,commands:{set:{color:R,$reg:[ee,W]}},create:function(e,t){return te(new on,e,t)},dispose:X});const N=class{static getShader(t){return N.library.has(t)?N.cloneShader(N.library.get(t)):(console.warn(`con not found shader in shader library: ${t}`),null)}static generateConfig(t){if(!N.library.has(t))return console.warn(`con not found shader in shader library: ${t}`),{};const r=N.library.get(t),n={shader:t,uniforms:{}};return r.uniforms&&(n.uniforms=JSON.parse(JSON.stringify(r.uniforms))),n}static cloneShader(t){const r={name:t.name};return t.vertexShader&&(r.vertexShader=t.vertexShader),t.fragmentShader&&(r.fragmentShader=t.fragmentShader),t.uniforms&&(r.uniforms=JSON.parse(JSON.stringify(t.uniforms))),r}};let se=N;u(se,"library",new Map),u(se,"reigster",function(t){N.library.has(t.name)&&console.warn(`shader library has exist shader: ${t.name} that will be cover.`),N.library.set(t.name,t)});var Fs=h({configType:i.SHADERMATERIAL,commands:{set:{shader({target:e,value:t}){const r=se.getShader(t);r!=null&&r.vertexShader&&(e.vertexShader=r.vertexShader),r!=null&&r.fragmentShader&&(e.fragmentShader=r.fragmentShader),r!=null&&r.uniforms&&(e.uniforms=r.uniforms),r!=null&&r.defines&&(e.defines=r.defines),e.needsUpdate=!0},$reg:[W]}},create:function(e,t){const r=new Xt,n=se.getShader(e.shader);return n!=null&&n.vertexShader&&(r.vertexShader=n.vertexShader),n!=null&&n.fragmentShader&&(r.fragmentShader=n.fragmentShader),n!=null&&n.uniforms&&(r.uniforms=n.uniforms),n!=null&&n.defines&&(r.defines=n.defines),T(e,r,{type:!0,shader:!0}),r.needsUpdate=!0,r},dispose:X}),ei=h({configType:i.SPRITEMATERIAL,commands:{set:{color:R,$reg:[ee,W]}},create:function(e,t){return te(new De,e,t)},dispose:X});class ti extends d{constructor(){super();u(this,"MODULE",p.MATERIAL)}}d.processor(Zs);d.processor(Ks);d.processor(Qs);d.processor(sr);d.processor(_s);d.processor(ei);d.processor(sr);d.processor(Fs);d.processor(qs);const ri=function(e,t){_(e,t)};class ni extends B{constructor(r=[]){super(ri,r);u(this,"MODULE",p.MATERIAL)}}var oi=h({configType:i.MESH,commands:ie,create(e,t){return Xe(new sn,e,{},t)},dispose:Je});class si extends We{constructor(){super();u(this,"MODULE",p.MESH)}}d.processor(oi);const ii=function(e,t){L(e,t)};class ai extends Ze{constructor(r=[]){super(ii,r);u(this,"MODULE",p.MESH)}}var ci=h({configType:i.OBJECT3D,commands:m,create(e,t){return O(new Wt,e,{},t)},dispose:M});class ui extends ${constructor(){super();u(this,"MODULE",p.OBJECT3D)}}d.processor(ci);const li=function(e,t){L(e,t)};class pi extends F{constructor(r=[]){super(li,r);u(this,"MODULE",p.OBJECT3D)}}var di=h({configType:i.POINTS,commands:ie,create(e,t){return Xe(new an,e,{},t)},dispose:Je});class fi extends We{constructor(){super();u(this,"MODULE",p.POINTS)}}d.processor(di);const hi=function(e,t){L(e,t)};class mi extends Ze{constructor(r=[]){super(hi,r);u(this,"MODULE",p.POINTS)}}class gi extends d{constructor(){super();u(this,"MODULE",p.RENDERER)}}const Ei=[G(i.WEBGLRENDERER),G(i.CSS3DRENDERER)],yi=function(e,t){_(e,t,r=>Y(r)||Ei.includes(r))};class Si extends B{constructor(r=[]){super(yi,r);u(this,"MODULE",p.RENDERER)}}const jt=function(e,t,r){if(!t){e.background=null;return}if(Y(t)){const n=r.compilerManager.getTexture(t);n?e.background=n:console.warn(`engine can not found this vid texture : '${t}'`)}else e.background=new P(t)},Nt=function(e,t,r){if(!t){e.environment=null;return}if(Y(t)){const n=r.compilerManager.getTexture(t);n?e.environment=n:console.warn(`engine can not found this vid texture : '${t}'`)}else console.warn(`scene environment is illeage: ${t}`)};var Mi=h({configType:i.SCENE,commands:{add:m.add,set:{...m.set,lookAt(){},fog({target:e,config:t,key:r,value:n}){const o=t.fog;o.type?o.type==="Fog"?!e.fog||!(e.fog instanceof qe)?e.fog=new qe(o.color,o.near,o.far):r==="color"?e.fog.color.copy(new P(o.color)):e.fog[r]&&(e.fog[r]=n):o.type==="FogExp2"&&(!e.fog||!(e.fog instanceof Ke)?e.fog=new Ke(o.color,o.density):r==="color"?e.fog.color.copy(new P(o.color)):e.fog[r]&&(e.fog[r]=n)):e.fog=null},background({target:e,value:t,engine:r}){jt(e,t,r)},environment({target:e,value:t,engine:r}){Nt(e,t,r)}},delete:m.delete},create(e,t){const r=new cn;if(jt(r,e.background,t),Nt(r,e.environment,t),e.fog.type){const n=e.fog;n.type==="Fog"?r.fog=new qe(n.color,n.near,n.far):n.type==="FogExp2"?r.fog=new Ke(n.color,n.density):console.warn(`scene processor can not support this type fog:'${e.type}'`)}return O(r,e,{lookAt:!0,background:!0,environment:!0,fog:!0},t)},dispose:M});class bi extends ${constructor(){super();u(this,"MODULE",p.SCENE)}}d.processor(Mi);const Ri=function(e,t){L(e,t,r=>Y(r)||[G(i.SCENE)].includes(r))};class Ci extends F{constructor(r=[]){super(Ri,r);u(this,"MODULE",p.SCENE)}}const Ht=new De({color:"rgb(123, 123, 123)"});var Ti=h({configType:i.SPRITE,commands:{add:ie.add,set:{lookAt(){},...ie.set,material({target:e,engine:t,value:r}){const n=t.compilerManager.getMaterial(r);n&&n instanceof De?e.material=n:e.material=Ht}},delete:ie.add},create(e,t){const r=new un,n=t.compilerManager.getMaterial(e.material);return n&&n instanceof De?r.material=n:r.material=Ht,Xe(r,e,{geometry:!0,material:!0,lookAt:!0},t)},dispose:Je});class Oi extends We{constructor(){super();u(this,"MODULE",p.SPRITE)}}d.processor(Ti);const vi=function(e,t){e.key!=="geometry"&&L(e,t)};class wi extends Ze{constructor(r=[]){super(vi,r);u(this,"MODULE",p.SPRITE)}}const Qe={reg:new RegExp("wrapS|wrapT|format|encoding|anisotropy|magFilter|minFilter|mapping"),handler({target:e,key:t,value:r}){e[t]=r,e.needsUpdate=!0}},ce=function({target:e,value:t,engine:r}){K.exec(n=>(e.image=r.compilerManager.getCompiler(p.TEXTURE).getResource(t,[HTMLImageElement,HTMLVideoElement,HTMLCanvasElement]),e.needsUpdate=!0,e.images!==me.replaceImage))};var Li=h({configType:i.IMAGETEXTURE,commands:{set:{url:ce,$reg:[Qe]}},create(e,t){const r=new br;return e.url&&ce({target:r,value:e.url,engine:t}),T(e,r,{type:!0,url:!0}),r.needsUpdate=!0,r},dispose(e){e.dispose()}}),Ai=h({configType:i.CANVASTEXTURE,commands:{set:{url:ce,$reg:[Qe]}},create(e,t){const r=new ln(t.compilerManager.getCompiler(p.TEXTURE).getResource(e.url,HTMLCanvasElement));return ce({target:r,value:e.url,engine:t}),T(e,r,{type:!0,url:!0}),r.needsUpdate=!0,r},dispose(e){e.dispose()}});const J=[HTMLImageElement,HTMLVideoElement,HTMLCanvasElement],ne=function({target:e,index:t,value:r,engine:n}){e.images[t]=n.compilerManager.textureCompiler.getResource(r,J),e.needsUpdate=!0};var xi=h({configType:i.CUBETEXTURE,commands:{set:{cube:{px({target:e,value:t,engine:r}){ne({target:e,value:t,engine:r,index:0})},nx({target:e,value:t,engine:r}){ne({target:e,value:t,engine:r,index:1})},py({target:e,value:t,engine:r}){ne({target:e,value:t,engine:r,index:2})},ny({target:e,value:t,engine:r}){ne({target:e,value:t,engine:r,index:3})},pz({target:e,value:t,engine:r}){ne({target:e,value:t,engine:r,index:4})},nz({target:e,value:t,engine:r}){ne({target:e,value:t,engine:r,index:5})}}}},create(e,t){const r=new pn,n=e.cube,o=t.compilerManager.getCompiler(p.TEXTURE),s=[o.getResource(n.px,J),o.getResource(n.nx,J),o.getResource(n.py,J),o.getResource(n.ny,J),o.getResource(n.pz,J),o.getResource(n.nz,J)];return r.image=s,T(e,r,{type:!0,cube:!0}),r.needsUpdate=!0,r},dispose(e){e.dispose()}}),Ii=h({configType:i.VIDEOTEXTURE,commands:{set:{url:ce,$reg:[Qe]}},create(e,t){const r=new Rr(document.createElement("video"));return e.url&&ce({target:r,value:e.url,engine:t}),T(e,r,{type:!0,url:!0}),r.needsUpdate=!0,r},dispose(e){e.dispose()}}),Di=h({configType:i.LOADTEXTURE,commands:{set:{url({}){},$reg:[Qe]}},create(e,t){let r;const n=t.compilerManager.getCompiler(p.TEXTURE).getResource(e.url,he);if(n instanceof he)r=new Ct(n);else{const o=new he(n);r=new Ct(o)}return T(e,r,{type:!0,url:!0}),r.needsUpdate=!0,r},dispose(e){e.dispose()}});const ge=class extends d{constructor(){super();u(this,"MODULE",p.TEXTURE)}getResource(r,n){const o=this.engine.resourceManager.resourceMap;if(!o.has(r))return console.warn(`engine resourceManager can not found this url: ${r}`),ge.replaceImage;const s=o.get(r);if(Array.isArray(n)){for(const a of n)if(s instanceof a)return s;return console.warn(`this url mapping resource is not a texture image class: ${r}`,s),ge.replaceImage}else return s instanceof n?s:(console.warn(`this url mapping resource is not a texture image class: ${r}`,s),ge.replaceImage)}};let me=ge;u(me,"replaceImage",new hn({width:512,height:512}).draw(r=>{r.translate(256,256),r.font="72px",r.fillStyle="white",r.fillText("\u6682\u65E0\u56FE\u7247",0,0)}).getDom());d.processor(Li);d.processor(Ai);d.processor(xi);d.processor(Ii);d.processor(Di);const Pi=function(e,t){_(e,t)};class Gi extends B{constructor(r=[]){super(Pi,r);u(this,"MODULE",p.TEXTURE)}}var Ui=h({configType:i.GROUP,commands:m,create(e,t){return O(new dn,e,{},t)},dispose:M});class ji extends ${constructor(){super();u(this,"MODULE",p.GROUP)}}d.processor(Ui);const Ni=function(e,t){L(e,t)};class Hi extends F{constructor(r=[]){super(Ni,r);u(this,"MODULE",p.GROUP)}}class Bi{constructor(t){u(this,"dataSupportMap",new Map);[new pi,new ss,new zs,new Ds,new Gi,new ni,new Si,new Ci,new us,new wi,new Js,new ai,new mi,new Hi,new Ss,new fs,new Fo].forEach(r=>{this.dataSupportMap.set(r.MODULE,r)}),t&&Object.keys(t).forEach(r=>{this[r]!==void 0&&(this[r]=t[r])}),Object.keys(this).forEach(r=>{const n=this[r];n instanceof B&&this.dataSupportMap.set(n.MODULE,n)})}extend(t){this.dataSupportMap.has(t.MODULE)&&console.warn("dataSupport manager has exist this compiler, that will cover",t),this.dataSupportMap.set(t.MODULE,t)}getDataSupport(t){return this.dataSupportMap.has(t)?this.dataSupportMap.get(t):(console.warn(`can not found this type in dataSupportManager: ${t}`),null)}getConfigBySymbol(t){const r=this.dataSupportMap.values();for(const n of r){const o=n.getConfig(t);if(o)return o}return null}removeConfigBySymbol(...t){const r=this.dataSupportMap.values();for(const n of t)for(const o of r)if(o.existSymbol(n)){o.removeConfig(n);break}return this}getModuleBySymbol(t){const r=this.dataSupportMap.values();for(const n of r)if(n.existSymbol(t))return n.MODULE;return null}applyConfig(...t){for(const r of t){const n=ft(r.type);n?this.dataSupportMap.get(n).addConfig(r):console.warn(`dataSupportManager can not found this config module: ${r.type}`)}return this}load(t){return this.dataSupportMap.forEach((n,o)=>{t[o]&&n.load(t[o])}),this}remove(t){return this.dataSupportMap.forEach((n,o)=>{t[o]&&n.remove(t[o])}),this}toJSON(t={},r=!0){return JSON.stringify(this.exportConfig(t,r),je)}exportConfig(t={},r=!0){return this.dataSupportMap.forEach((o,s)=>{t[s]=o.exportConfig(r)}),t}}const $i="DataSupportManagerPlugin",Ki=function(e){return{name:$i,install(t){const r=new Bi(e);t.dataSupportManager=r,t.applyConfig=function(...n){return r.applyConfig(...n),t},t.getConfigBySymbol=function(n){return r.getConfigBySymbol(n)},t.removeConfigBySymbol=function(...n){return r.removeConfigBySymbol(...n),t},t.toJSON=function(){return r.toJSON()},t.exportConfig=function(){return r.exportConfig()}},dispose(t){delete t.dataSupportManager,delete t.applyConfig,delete t.getConfigBySymbol,delete t.removeConfigBySymbol,delete t.toJSON,delete t.exportConfig}}};class re{}class be extends re{constructor(){super(...arguments);u(this,"selector",(r,n,o)=>n.isObject3D&&o.get(be)||null)}parse(r){this.parseObject3D(r)}parseColor(r){return`rgb(${Math.round(255*r.r)}, ${Math.round(255*r.g)}, ${Math.round(255*r.b)})`}attributeEnhance(r){const n={};for(const o in r)o.startsWith("_")?n[o.slice(1)]=r[o]:n[o]=r[o];return n}parseTexture({url:r,resource:n,configMap:o,resourceMap:s}){s.set(r,n);const a=y[i.LOADTEXTURE]();o.set(r,a),a.vid=fe(),a.url=r,T(n,a,{type:!0,vid:!0,url:!0})}parseMaterial({url:r,resource:n,configMap:o,resourceMap:s}){if(s.set(r,n),!y[n.type]){console.warn("can not found support config in vis for this resource",n);return}const a=y[n.type]();o.set(r,a),a.vid=fe(),T(this.attributeEnhance(n),a,{type:!0,vid:!0});for(const c in n)if(!!n[c]){if(n[c].isColor)a[c]=this.parseColor(n[c]);else if(c.toLocaleLowerCase().endsWith("map")&&n[c]){const l=`${r}.${c}`;this.parseTexture({url:l,resource:n[c],configMap:o,resourceMap:s}),a[c]=o.get(l).vid}}}parseGeometry({url:r,resource:n,configMap:o,resourceMap:s}){s.set(r,n),n.computeBoundingBox();const a=n.boundingBox,c=a.getCenter(new Q),l=y[i.LOADGEOMETRY]();l.vid=fe(),l.url=r,l.position.x=c.x/(a.max.x-a.min.x)*2,l.position.y=c.y/(a.max.y-a.min.y)*2,l.position.z=c.z/(a.max.z-a.min.z)*2,o.set(r,l)}parseObject3D({url:r,resource:n,configMap:o,resourceMap:s}){if(s.set(r,n),!y[n.type]){console.warn("can not found support config in vis for this resource",n);return}const a=y[n.type]();if(a.vid=fe(),T(n,a,{type:!0,vid:!0,children:!0,geometry:!0,material:!0,parent:!0,lookAt:!0}),a.rotation.x=n.rotation.x,a.rotation.y=n.rotation.y,a.rotation.z=n.rotation.z,o.set(r,a),n.material)if(Array.isArray(n.material))a.material=[],n.material.forEach((c,l,f)=>{const g=`${r}.material.${l}`;this.parseMaterial({url:g,resource:c,configMap:o,resourceMap:s}),a.material.push(o.get(g).vid)});else{const c=`${r}.material`;this.parseMaterial({url:c,resource:n.material,configMap:o,resourceMap:s}),a.material=o.get(c).vid}if(n.geometry){const c=`${r}.geometry`;this.parseGeometry({url:c,resource:n.geometry,configMap:o,resourceMap:s}),a.geometry=o.get(c).vid}n.children&&n.children.length&&n.children.forEach((c,l,f)=>{const g=`${r}.children.${l}`;this.parseObject3D({url:g,resource:c,configMap:o,resourceMap:s}),a.children.push(o.get(g).vid)})}}const ki=new be;class zi extends be{constructor(){super()}}class mt extends re{constructor(){super();u(this,"object3DParser",ki);u(this,"selector",(r,n,o)=>n.parser&&n.animations&&n.scene&&n.scenes&&o.get(mt)||null)}parse({url:r,resource:n,configMap:o,resourceMap:s}){this.object3DParser.parse({url:`${r}.scene`,resource:n.scene,configMap:o,resourceMap:s})}}class gt extends re{constructor(){super(...arguments);u(this,"selector",(r,n,o)=>n instanceof HTMLCanvasElement&&o.get(gt)||null)}parse({url:r,resource:n,configMap:o,resourceMap:s}){const a=y[i.CANVASTEXTURE]();a.url=r,s.set(r,n),o.set(r,a)}}class Et extends re{constructor(){super(...arguments);u(this,"selector",(r,n,o)=>n instanceof HTMLElement&&o.get(Et)||null)}parse({url:r,resource:n,configMap:o,resourceMap:s}){const a=y[i.CSS3DPLANE]();a.element=r,s.set(r,n),o.set(r,a)}}class yt extends re{constructor(){super(...arguments);u(this,"selector",(r,n,o)=>n instanceof HTMLImageElement&&o.get(yt)||null)}parse({url:r,resource:n,configMap:o,resourceMap:s}){const a=y[i.IMAGETEXTURE]();a.url=r,s.set(r,n),o.set(r,a)}}class St extends re{constructor(){super(...arguments);u(this,"selector",(r,n,o)=>n instanceof HTMLVideoElement&&o.get(St)||null)}parse({url:r,resource:n,configMap:o,resourceMap:s}){const a=y[i.VIDEOTEXTURE]();a.url=r,s.set(r,n),o.set(r,a)}}class Mt extends re{constructor(){super(...arguments);u(this,"selector",(r,n,o)=>n instanceof he&&o.get(Mt)||null)}parse({url:r,resource:n,configMap:o,resourceMap:s}){const a=y[i.LOADTEXTURE]();a.url=r,s.set(r,n),o.set(r,a)}}var Bt;(function(e){e.MAPPED="mapped"})(Bt||(Bt={}));class _i extends $t{constructor(r={}){super();u(this,"configMap",new Map);u(this,"resourceMap",new Map);u(this,"paserMap",new Map);this.addParser(new yt).addParser(new gt).addParser(new St).addParser(new be).addParser(new Et).addParser(new Mt).addParser(new mt).addParser(new zi);const n=new Map;for(const o in r)n.has(o)&&console.warn(`resourceManager construct params rescource already exist: ${o}, that will be cover.`),n.set(o,r[o]);this.mappingResource(n)}addParser(r){return this.paserMap.has(r.constructor)?this:(this.paserMap.set(r.constructor,r),this)}mappingResource(r,n){const o=this.configMap,s=this.resourceMap,a=[...this.paserMap.values()],c={};for(const[l,f]of r.entries()){if((n==null?void 0:n.parser)&&n.parser[l]){n.parser[l].parse({url:l,resource:f,configMap:o,resourceMap:s});continue}if((n==null?void 0:n.selector)&&n.selector[l]){const A=n.selector[l](l,f,this.paserMap);if(!A){console.warn("resource manager hanlder can not found this resource parser: ",f,n.selector[l]);continue}A.parse({url:l,resource:f,configMap:o,resourceMap:s}),c[l]=this.getResourceConfig(l);continue}let g=null;for(const A of a)if(g=A.selector(l,f,this.paserMap),g)break;if(!g){console.warn("resouce manager can not found some handler to parser this resource:",f);continue}g.parse({url:l,resource:f,configMap:o,resourceMap:s}),c[l]=this.getResourceConfig(l)}return this.dispatchEvent({type:"mapped",configMap:o,resourceMap:s,resourceConfig:c}),this}getResourceConfig(r){const n=this.configMap,o={};return[...n.keys()].filter(s=>s.startsWith(r)).forEach(s=>{const a=n.get(s);if(!a)console.error(`unknow error: can not found config by url: ${s}`);else{const c=ft(a.type);c?(!o[c]&&(o[c]=[]),o[c].push(a)):console.error(`unknow error: can not found module by type: ${a.type}`,a)}}),o}hasResource(r){return this.resourceMap.has(r)}remove(r){const n=this.configMap,o=this.resourceMap;return[...n.keys()].filter(s=>s.startsWith(r)).forEach(s=>{n.delete(s);const a=o.get(s);a.dispose&&a.dispose(),o.delete(s)}),this}dispose(){this.resourceMap.forEach((r,n)=>{r.dispose&&r.dispose()}),this.resourceMap.clear(),this.configMap.clear()}}class Vi extends $t{constructor(r){super();u(this,"compilerMap",new Map);[new ui,new ns,new $s,new xs,new me,new ti,new gi,new bi,new is,new Oi,new Ws,new si,new fi,new ji,new Es,new ps,new Ko].forEach(n=>{this.compilerMap.set(n.MODULE,n)}),r&&Object.keys(r).forEach(n=>{this.compilerMap.set(r[n].MODULE,r[n])})}extend(r){this.compilerMap.has(r.MODULE)&&console.warn("compiler manager has exist this compiler, that will cover",r),this.compilerMap.set(r.MODULE,r)}getCompiler(r){return this.compilerMap.has(r)?this.compilerMap.get(r):(console.warn(`can not found this type in compiler manager: ${r}`),null)}getObjectSymbol(r){for(const n of this.compilerMap.values()){const o=n.getObjectSymbol(r);if(o)return o}return null}getObjectBySymbol(r){for(const n of this.compilerMap.values()){const o=n.getObjectBySymbol(r);if(o)return o}return null}getObject3D(r){for(const n of this.compilerMap.values())if(n instanceof $&&n.map.has(r))return n.map.get(r);return null}getMaterial(r){return this.compilerMap.get(p.MATERIAL).map.get(r)}getTexture(r){return this.compilerMap.get(p.TEXTURE).map.get(r)}getGeometry(r){return this.compilerMap.get(p.GEOMETRY).map.get(r)}dispose(){for(const r of this.compilerMap.values())r.dispose();return this.compilerMap.clear(),this}}const Yi="CompilerManagerPlugin",Fi=function(e){return{name:Yi,install(t){const r=new Vi(e);t.compilerManager=r,t.getObjectSymbol=function(n){return r.getObjectSymbol(n)},t.getObjectBySymbol=function(n){return r.getObjectBySymbol(n)}},dispose(t){t.compilerManager.dispose(),delete t.compilerManager,delete t.getObjectSymbol,delete t.getObjectBySymbol}}};export{Yi as C,$i as D,p as M,_i as R,Bt as a,Ki as b,Fi as c,h as d,d as e,_ as f,D as g,B as h,i,y as j,G as u};
