var Dt=Object.defineProperty;var At=(d,o,i)=>o in d?Dt(d,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):d[o]=i;var s=(d,o,i)=>(At(d,typeof o!="symbol"?o+"":o,i),i);import{t as Nt,a as Y}from"./index.5dcba3b7.js";import{V as g,K as x,X as S,u as U,Q as at,Y as rt,m,g as Z}from"./three.057c7ef5.js";const Rt="@vis-three/orbit-controls-plugin";class St{constructor(){s(this,"listeners",new Map)}addEventListener(o,i){const r=this.listeners;r.has(o)||r.set(o,new Set),r.get(o).add(i)}hasEventListener(o,i){const r=this.listeners;return r.has(o)?r.get(o).has(i):!1}removeEventListener(o,i){const r=this.listeners;!r.has(o)||!r.get(o).has(i)||r.get(o).delete(i)}dispatchEvent(o){var n;const i=o.type,r=this.listeners;if(r.has(i))try{(n=r.get(i))==null||n.forEach(a=>{a.call(this,o)})}catch(a){console.error(a)}}clear(){this.listeners.clear()}useful(){return Boolean([...this.listeners.keys()].length)}once(o,i){const r=function(n){i.call(this,n),this.removeEventListener(o,r)};this.addEventListener(o,r)}emit(o,i={}){var n;const r=this.listeners;if(r.has(o))try{(n=r.get(o))==null||n.forEach(a=>{a.call(this,i)})}catch(a){console.error(a)}}on(o,i){this.addEventListener(o,i)}has(o,i){return this.hasEventListener(o,i)}off(o,i){if(i)this.removeEventListener(o,i);else{const r=this.listeners;if(!r.has(o))return;r.delete(o)}}}class jt extends St{constructor(i,r){super();s(this,"object");s(this,"domElement");s(this,"enabled",!0);s(this,"target",new g);s(this,"minDistance",0);s(this,"maxDistance",1/0);s(this,"minZoom",0);s(this,"maxZoom",1/0);s(this,"minPolarAngle",0);s(this,"maxPolarAngle",Math.PI);s(this,"minAzimuthAngle",-1/0);s(this,"maxAzimuthAngle",1/0);s(this,"enableDamping",!1);s(this,"dampingFactor",.05);s(this,"enableZoom",!0);s(this,"zoomSpeed",1);s(this,"enableRotate",!0);s(this,"rotateSpeed",1);s(this,"enablePan",!0);s(this,"panSpeed",1);s(this,"screenSpacePanning",!0);s(this,"keyPanSpeed",7);s(this,"autoRotate",!1);s(this,"autoRotateSpeed",2);s(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"});s(this,"mouseButtons",{LEFT:null,MIDDLE:x.DOLLY,RIGHT:x.ROTATE});s(this,"touches",{ONE:S.ROTATE,TWO:S.DOLLY_PAN});s(this,"target0");s(this,"position0");s(this,"zoom0");s(this,"_domElementKeyEvents",null);s(this,"spherical");s(this,"reset");s(this,"update");s(this,"onContextMenu");s(this,"onPointerDown");s(this,"onPointerCancel");s(this,"onMouseWheel");s(this,"onPointerMove");s(this,"onPointerUp");s(this,"onKeyDown");this.object=i||new U,this.domElement=r||document.createElement("div"),this.domElement.style.touchAction="none",this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.update=(()=>{const t=new g,e=new at().setFromUnitVectors(this.object.up,new g(0,1,0)),c=e.clone().invert(),p=new g,E=new at,y=2*Math.PI;return()=>{const it=this.object.position;t.copy(it).sub(this.target),t.applyQuaternion(e),l.setFromVector3(t),this.autoRotate&&a===n.NONE&&_(ht()),this.enableDamping?(l.theta+=u.theta*this.dampingFactor,l.phi+=u.phi*this.dampingFactor):(l.theta+=u.theta,l.phi+=u.phi);let f=this.minAzimuthAngle,b=this.maxAzimuthAngle;return isFinite(f)&&isFinite(b)&&(f<-Math.PI?f+=y:f>Math.PI&&(f-=y),b<-Math.PI?b+=y:b>Math.PI&&(b-=y),f<=b?l.theta=Math.max(f,Math.min(b,l.theta)):l.theta=l.theta>(f+b)/2?Math.max(f,l.theta):Math.min(b,l.theta)),l.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,l.phi)),l.makeSafe(),l.radius*=k,l.radius=Math.max(this.minDistance,Math.min(this.maxDistance,l.radius)),this.enableDamping===!0?this.target.addScaledVector(L,this.dampingFactor):this.target.add(L),t.setFromSpherical(l),t.applyQuaternion(c),it.copy(this.target).add(t),this.object.lookAt(this.target),this.enableDamping===!0?(u.theta*=1-this.dampingFactor,u.phi*=1-this.dampingFactor,L.multiplyScalar(1-this.dampingFactor)):(u.set(0,0,0),L.set(0,0,0)),k=1,v||p.distanceToSquared(this.object.position)>X||8*(1-E.dot(this.object.quaternion))>X?(this.dispatchEvent({type:"change"}),p.copy(this.object.position),E.copy(this.object.quaternion),v=!1,!0):!1}})();const n={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let a=n.NONE;const X=1e-6,l=new rt,u=new rt;let k=1;const L=new g;let v=!1;const P=new m,T=new m,w=new m,M=new m,O=new m,D=new m,A=new m,N=new m,j=new m,h=[],C={},ht=()=>2*Math.PI/60/60*this.autoRotateSpeed,I=()=>Math.pow(.95,this.zoomSpeed),_=t=>{u.theta-=t},K=t=>{u.phi-=t},V=function(){const t=new g;return function(c,p){t.setFromMatrixColumn(p,0),t.multiplyScalar(-c),L.add(t)}}(),W=(()=>{const t=new g;return(e,c)=>{this.screenSpacePanning===!0?t.setFromMatrixColumn(c,1):(t.setFromMatrixColumn(c,0),t.crossVectors(this.object.up,t)),t.multiplyScalar(e),L.add(t)}})(),R=(()=>{const t=new g;return(e,c)=>{const p=this.domElement;if(this.object instanceof U){const E=this.object.position;t.copy(E).sub(this.target);let y=t.length();y*=Math.tan(this.object.fov/2*Math.PI/180),V(2*e*y/p.clientHeight,this.object.matrix),W(2*c*y/p.clientHeight,this.object.matrix)}else this.object instanceof Z?(V(e*(this.object.right-this.object.left)/this.object.zoom/p.clientWidth,this.object.matrix),W(c*(this.object.top-this.object.bottom)/this.object.zoom/p.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}})(),z=t=>{this.object instanceof U?k/=t:this.object instanceof Z?(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*t)),this.object.updateProjectionMatrix(),v=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)},G=t=>{this.object instanceof U?k*=t:this.object instanceof Z?(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/t)),this.object.updateProjectionMatrix(),v=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)};function B(t){P.set(t.clientX,t.clientY)}function lt(t){A.set(t.clientX,t.clientY)}function q(t){M.set(t.clientX,t.clientY)}const ct=t=>{T.set(t.clientX,t.clientY),w.subVectors(T,P).multiplyScalar(this.rotateSpeed);const e=this.domElement;_(2*Math.PI*w.x/e.clientHeight),K(2*Math.PI*w.y/e.clientHeight),P.copy(T),this.update()},pt=t=>{N.set(t.clientX,t.clientY),j.subVectors(N,A),j.y>0?z(I()):j.y<0&&G(I()),A.copy(N),this.update()},dt=t=>{O.set(t.clientX,t.clientY),D.subVectors(O,M).multiplyScalar(this.panSpeed),R(D.x,D.y),M.copy(O),this.update()},mt=t=>{t.deltaY<0?G(I()):t.deltaY>0&&z(I()),this.update()},ut=t=>{let e=!1;switch(t.code){case this.keys.UP:R(0,this.keyPanSpeed),e=!0;break;case this.keys.BOTTOM:R(0,-this.keyPanSpeed),e=!0;break;case this.keys.LEFT:R(this.keyPanSpeed,0),e=!0;break;case this.keys.RIGHT:R(-this.keyPanSpeed,0),e=!0;break}e&&(t.preventDefault(),this.update())};function Q(){if(h.length===1)P.set(h[0].pageX,h[0].pageY);else{const t=.5*(h[0].pageX+h[1].pageX),e=.5*(h[0].pageY+h[1].pageY);P.set(t,e)}}function J(){if(h.length===1)M.set(h[0].pageX,h[0].pageY);else{const t=.5*(h[0].pageX+h[1].pageX),e=.5*(h[0].pageY+h[1].pageY);M.set(t,e)}}function $(){const t=h[0].pageX-h[1].pageX,e=h[0].pageY-h[1].pageY,c=Math.sqrt(t*t+e*e);A.set(0,c)}const ft=()=>{this.enableZoom&&$(),this.enablePan&&J()},bt=()=>{this.enableZoom&&$(),this.enableRotate&&Q()},tt=t=>{if(h.length==1)T.set(t.pageX,t.pageY);else{const c=F(t),p=.5*(t.pageX+c.x),E=.5*(t.pageY+c.y);T.set(p,E)}w.subVectors(T,P).multiplyScalar(this.rotateSpeed);const e=this.domElement;_(2*Math.PI*w.x/e.clientHeight),K(2*Math.PI*w.y/e.clientHeight),P.copy(T)},et=t=>{if(h.length===1)O.set(t.pageX,t.pageY);else{const e=F(t),c=.5*(t.pageX+e.x),p=.5*(t.pageY+e.y);O.set(c,p)}D.subVectors(O,M).multiplyScalar(this.panSpeed),R(D.x,D.y),M.copy(O)},st=t=>{const e=F(t),c=t.pageX-e.x,p=t.pageY-e.y,E=Math.sqrt(c*c+p*p);N.set(0,E),j.set(0,Math.pow(N.y/A.y,this.zoomSpeed)),z(j.y),A.copy(N)},Et=t=>{this.enableZoom&&st(t),this.enablePan&&et(t)},yt=t=>{this.enableZoom&&st(t),this.enableRotate&&tt(t)};this.onPointerDown=t=>{this.enabled!==!1&&(h.length===0&&(this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp)),wt(t),t.pointerType==="touch"?Mt(t):gt(t))};let H=!1;this.onPointerMove=t=>{this.enabled!==!1&&(H||(this.domElement.setPointerCapture(t.pointerId),H=!0),t.pointerType==="touch"?Ot(t):Pt(t))},this.onPointerUp=t=>{this.enabled!==!1&&(H=!1,t.pointerType==="touch"?Lt():Tt(),nt(t),h.length===0&&(this.domElement.releasePointerCapture(t.pointerId),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)))},this.onPointerCancel=t=>{nt(t)};const gt=t=>{let e;switch(t.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case x.DOLLY:if(this.enableZoom===!1)return;lt(t),a=n.DOLLY;break;case x.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(this.enablePan===!1)return;q(t),a=n.PAN}else{if(this.enableRotate===!1)return;B(t),a=n.ROTATE}break;case x.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(this.enableRotate===!1)return;B(t),a=n.ROTATE}else{if(this.enablePan===!1)return;q(t),a=n.PAN}break;default:a=n.NONE}a!==n.NONE&&this.dispatchEvent({type:"start"})},Pt=t=>{if(this.enabled!==!1)switch(a){case n.ROTATE:if(this.enableRotate===!1)return;ct(t);break;case n.DOLLY:if(this.enableZoom===!1)return;pt(t);break;case n.PAN:if(this.enablePan===!1)return;dt(t);break}},Tt=t=>{this.dispatchEvent({type:"end"}),a=n.NONE};this.onMouseWheel=t=>{this.enabled===!1||this.enableZoom===!1||a!==n.NONE||(t.preventDefault(),this.dispatchEvent({type:"start"}),mt(t),this.dispatchEvent({type:"end"}))},this.onKeyDown=t=>{this.enabled===!1||this.enablePan===!1||ut(t)};const Mt=t=>{switch(ot(t),h.length){case 1:switch(this.touches.ONE){case S.ROTATE:if(this.enableRotate===!1)return;Q(),a=n.TOUCH_ROTATE;break;case S.PAN:if(this.enablePan===!1)return;J(),a=n.TOUCH_PAN;break;default:a=n.NONE}break;case 2:switch(this.touches.TWO){case S.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;ft(),a=n.TOUCH_DOLLY_PAN;break;case S.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;bt(),a=n.TOUCH_DOLLY_ROTATE;break;default:a=n.NONE}break;default:a=n.NONE}a!==n.NONE&&this.dispatchEvent({type:"start"})},Ot=t=>{switch(ot(t),a){case n.TOUCH_ROTATE:if(this.enableRotate===!1)return;tt(t),this.update();break;case n.TOUCH_PAN:if(this.enablePan===!1)return;et(t),this.update();break;case n.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;Et(t),this.update();break;case n.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;yt(t),this.update();break;default:a=n.NONE}},Lt=t=>{this.dispatchEvent({type:"end"}),a=n.NONE};this.onContextMenu=t=>{this.enabled!==!1&&t.preventDefault()};function wt(t){h.push(t)}const nt=t=>{delete C[t.pointerId];for(let e=0;e<h.length;e++)if(h[e].pointerId==t.pointerId){h.splice(e,1);return}};function ot(t){let e=C[t.pointerId];e===void 0&&(e=new m,C[t.pointerId]=e),e.set(t.pageX,t.pageY)}function F(t){const e=t.pointerId===h[0].pointerId?h[1]:h[0];return C[e.pointerId]}this.spherical=l,this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),this.domElement.addEventListener("wheel",this.onMouseWheel,{passive:!1}),this.reset=()=>{this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent({type:"change"}),this.update(),a=n.NONE},this.update()}getPolarAngle(){return this.spherical.phi}getAzimuthalAngle(){return this.spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(i){i.addEventListener("keydown",this.onKeyDown),this._domElementKeyEvents=i}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}setCamera(i){this.object=i}setDom(i){this.dispose(),this.domElement=i,this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),this.domElement.addEventListener("wheel",this.onMouseWheel,{passive:!1})}dispose(){this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("pointercancel",this.onPointerCancel),this.domElement.removeEventListener("wheel",this.onMouseWheel),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp),this._domElementKeyEvents!==null&&this._domElementKeyEvents.removeEventListener("keydown",this.onKeyDown)}}const xt=Nt(Rt),It=function(){let d,o,i;return{name:xt,install(r){const n=new jt(r.camera,r.dom);r.orbitControls=n,d=a=>{n.setDom(a.dom)},r.addEventListener(Y.SETDOM,d),o=a=>{a.options.orbitControls&&n.setCamera(a.camera)},r.addEventListener(Y.SETCAMERA,o),i=r.render.bind(r),r.render=function(a){return i(a),n.update(),this}},dispose(r){r.removeEventListener(Y.SETDOM,d),r.removeEventListener(Y.SETCAMERA,o),r.render=i}}};export{It as O,xt as a};
