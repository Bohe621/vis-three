var Qt=Object.defineProperty;var Xt=(r,o,e)=>o in r?Qt(r,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[o]=e;var ot=(r,o,e)=>(Xt(r,typeof o!="symbol"?o+"":o,e),e);import{t as rt,a as H}from"./index.5dcba3b7.js";import{b as Yt}from"./index.688a05f5.js";import{_ as Ct,V as h,Q as P,O as it,ab as Zt,f as Et,am as xt,al as Dt,af as y,B as u,k as ht,x as ct,M as a,br as K,L,ac as zt,ag as k,w as Ot,aS as jt,u as Ht}from"./three.057c7ef5.js";const kt="@vis-three/selection-plugin",et="selected",vt=rt(kt),oe=function(){return{name:vt,install(r){r.selectionBox=new Set,r.setSelectionBox=function(o){this.selectionBox.clear();for(const e of o)this.selectionBox.add(e);return r.dispatchEvent({type:et,objects:Array.from(this.selectionBox)}),this}},dispose(r){r.selectionBox.clear(),delete r.selectionBox,delete r.setSelectionBox}}},Gt="@vis-three/transform-controls-plugin",Z=new Ct,E=new h,Q=new h,p=new P,pt={X:new h(1,0,0),Y:new h(0,1,0),Z:new h(0,0,1)},st={type:"change"},dt={type:"mouseDown"},mt={type:"mouseUp",mode:null},ut={type:"objectChange"};class Wt extends it{constructor(o,e){super(),e===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),e=document),this.isTransformControls=!0,this.visible=!1,this.domElement=e,this.domElement.style.touchAction="none";const i=new Ut;this._gizmo=i,this.add(i);const n=new Vt;this._plane=n,this.add(n);const s=this;function t(m,_){let O=_;Object.defineProperty(s,m,{get:function(){return O!==void 0?O:_},set:function(C){O!==C&&(O=C,n[m]=C,i[m]=C,s.dispatchEvent({type:m+"-changed",value:C}),s.dispatchEvent(st))}}),s[m]=_,n[m]=_,i[m]=_}t("camera",o),t("object",void 0),t("enabled",!0),t("axis",null),t("mode","translate"),t("translationSnap",null),t("rotationSnap",null),t("scaleSnap",null),t("space","world"),t("size",1),t("dragging",!1),t("showX",!0),t("showY",!0),t("showZ",!0);const l=new h,x=new h,f=new P,d=new P,X=new h,Y=new P,T=new h,N=new h,g=new h,I=0,b=new h;t("worldPosition",l),t("worldPositionStart",x),t("worldQuaternion",f),t("worldQuaternionStart",d),t("cameraPosition",X),t("cameraQuaternion",Y),t("pointStart",T),t("pointEnd",N),t("rotationAxis",g),t("rotationAngle",I),t("eye",b),this._offset=new h,this._startNorm=new h,this._endNorm=new h,this._cameraScale=new h,this._parentPosition=new h,this._parentQuaternion=new P,this._parentQuaternionInv=new P,this._parentScale=new h,this._worldScaleStart=new h,this._worldQuaternionInv=new P,this._worldScale=new h,this._positionStart=new h,this._quaternionStart=new P,this._scaleStart=new h,this._getPointer=qt.bind(this),this._onPointerDown=Nt.bind(this),this._onPointerHover=Rt.bind(this),this._onPointerMove=Bt.bind(this),this._onPointerUp=Ft.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(o){if(this.object===void 0||this.dragging===!0)return;Z.setFromCamera(o,this.camera);const e=at(this._gizmo.picker[this.mode],Z);e?this.axis=e.object.name:this.axis=null}pointerDown(o){if(!(this.object===void 0||this.dragging===!0||o.button!==0)&&this.axis!==null){Z.setFromCamera(o,this.camera);const e=at(this._plane,Z,!0);e&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(e.point).sub(this.worldPositionStart)),this.dragging=!0,dt.mode=this.mode,this.dispatchEvent(dt)}}pointerMove(o){const e=this.axis,i=this.mode,n=this.object;let s=this.space;if(i==="scale"?s="local":(e==="E"||e==="XYZE"||e==="XYZ")&&(s="world"),n===void 0||e===null||this.dragging===!1||o.button!==-1)return;Z.setFromCamera(o,this.camera);const t=at(this._plane,Z,!0);if(!!t){if(this.pointEnd.copy(t.point).sub(this.worldPositionStart),i==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),s==="local"&&e!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),e.indexOf("X")===-1&&(this._offset.x=0),e.indexOf("Y")===-1&&(this._offset.y=0),e.indexOf("Z")===-1&&(this._offset.z=0),s==="local"&&e!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),n.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(s==="local"&&(n.position.applyQuaternion(p.copy(this._quaternionStart).invert()),e.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),e.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),e.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.position.applyQuaternion(this._quaternionStart)),s==="world"&&(n.parent&&n.position.add(E.setFromMatrixPosition(n.parent.matrixWorld)),e.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),e.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),e.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.parent&&n.position.sub(E.setFromMatrixPosition(n.parent.matrixWorld))));else if(i==="scale"){if(e.search("XYZ")!==-1){let l=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(l*=-1),Q.set(l,l,l)}else E.copy(this.pointStart),Q.copy(this.pointEnd),E.applyQuaternion(this._worldQuaternionInv),Q.applyQuaternion(this._worldQuaternionInv),Q.divide(E),e.search("X")===-1&&(Q.x=1),e.search("Y")===-1&&(Q.y=1),e.search("Z")===-1&&(Q.z=1);n.scale.copy(this._scaleStart).multiply(Q),this.scaleSnap&&(e.search("X")!==-1&&(n.scale.x=Math.round(n.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),e.search("Y")!==-1&&(n.scale.y=Math.round(n.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),e.search("Z")!==-1&&(n.scale.z=Math.round(n.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(i==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const l=20/this.worldPosition.distanceTo(E.setFromMatrixPosition(this.camera.matrixWorld));e==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):e==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(E.copy(this.rotationAxis).cross(this.eye))*l):(e==="X"||e==="Y"||e==="Z")&&(this.rotationAxis.copy(pt[e]),E.copy(pt[e]),s==="local"&&E.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(E.cross(this.eye).normalize())*l),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),s==="local"&&e!=="E"&&e!=="XYZE"?(n.quaternion.copy(this._quaternionStart),n.quaternion.multiply(p.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),n.quaternion.copy(p.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),n.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(st),this.dispatchEvent(ut)}}pointerUp(o){o.button===0&&(this.dragging&&this.axis!==null&&(mt.mode=this.mode,this.dispatchEvent(mt)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(o){o.geometry&&o.geometry.dispose(),o.material&&o.material.dispose()})}attach(o){return this.object=o,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){!this.enabled||this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(st),this.dispatchEvent(ut),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Z}getMode(){return this.mode}setMode(o){this.mode=o}setTranslationSnap(o){this.translationSnap=o}setRotationSnap(o){this.rotationSnap=o}setScaleSnap(o){this.scaleSnap=o}setSize(o){this.size=o}setSpace(o){this.space=o}update(){console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}}function qt(r){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:r.button};{const o=this.domElement.getBoundingClientRect();return{x:(r.clientX-o.left)/o.width*2-1,y:-(r.clientY-o.top)/o.height*2+1,button:r.button}}}function Rt(r){if(!!this.enabled)switch(r.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(r));break}}function Nt(r){!this.enabled||(document.pointerLockElement||this.domElement.setPointerCapture(r.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(r)),this.pointerDown(this._getPointer(r)))}function Bt(r){!this.enabled||this.pointerMove(this._getPointer(r))}function Ft(r){!this.enabled||(this.domElement.releasePointerCapture(r.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(r)))}function at(r,o,e){const i=o.intersectObject(r,!0);for(let n=0;n<i.length;n++)if(i[n].object.visible||e)return i[n];return!1}const $=new Zt,c=new h(0,1,0),ft=new h(0,0,0),wt=new Et,J=new P,nt=new P,M=new h,yt=new Et,q=new h(1,0,0),D=new h(0,1,0),R=new h(0,0,1),tt=new h,G=new h,W=new h;class Ut extends it{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const o=new xt({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),e=new Dt({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=o.clone();i.opacity=.15;const n=e.clone();n.opacity=.5;const s=o.clone();s.color.setHex(16711680);const t=o.clone();t.color.setHex(65280);const l=o.clone();l.color.setHex(255);const x=o.clone();x.color.setHex(16711680),x.opacity=.5;const f=o.clone();f.color.setHex(65280),f.opacity=.5;const d=o.clone();d.color.setHex(255),d.opacity=.5;const X=o.clone();X.opacity=.25;const Y=o.clone();Y.color.setHex(16776960),Y.opacity=.25,o.clone().color.setHex(16776960);const N=o.clone();N.color.setHex(7895160);const g=new y(0,.04,.1,12);g.translate(0,.05,0);const I=new u(.08,.08,.08);I.translate(0,.04,0);const b=new ht;b.setAttribute("position",new ct([0,0,0,1,0,0],3));const m=new y(.0075,.0075,.5,3);m.translate(0,.25,0);function _(v,B){const S=new k(v,.0075,3,64,B*Math.PI*2);return S.rotateY(Math.PI/2),S.rotateX(Math.PI/2),S}function O(){const v=new ht;return v.setAttribute("position",new ct([0,0,0,1,1,1],3)),v}const C={X:[[new a(g,s),[.5,0,0],[0,0,-Math.PI/2]],[new a(g,s),[-.5,0,0],[0,0,Math.PI/2]],[new a(m,s),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new a(g,t),[0,.5,0]],[new a(g,t),[0,-.5,0],[Math.PI,0,0]],[new a(m,t)]],Z:[[new a(g,l),[0,0,.5],[Math.PI/2,0,0]],[new a(g,l),[0,0,-.5],[-Math.PI/2,0,0]],[new a(m,l),null,[Math.PI/2,0,0]]],XYZ:[[new a(new K(.1,0),X.clone()),[0,0,0]]],XY:[[new a(new u(.15,.15,.01),d.clone()),[.15,.15,0]]],YZ:[[new a(new u(.15,.15,.01),x.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new a(new u(.15,.15,.01),f.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},St={X:[[new a(new y(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new a(new y(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new a(new y(.2,0,.6,4),i),[0,.3,0]],[new a(new y(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new a(new y(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new a(new y(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new a(new K(.2,0),i)]],XY:[[new a(new u(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new a(new u(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new a(new u(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]]},bt={START:[[new a(new K(.01,2),n),null,null,null,"helper"]],END:[[new a(new K(.01,2),n),null,null,null,"helper"]],DELTA:[[new L(O(),n),null,null,null,"helper"]],X:[[new L(b,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new L(b,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new L(b,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},Mt={XYZE:[[new a(_(.5,1),N),null,[0,Math.PI/2,0]]],X:[[new a(_(.5,.5),s)]],Y:[[new a(_(.5,.5),t),null,[0,0,-Math.PI/2]]],Z:[[new a(_(.5,.5),l),null,[0,Math.PI/2,0]]],E:[[new a(_(.75,1),Y),null,[0,Math.PI/2,0]]]},Pt={AXIS:[[new L(b,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},gt={XYZE:[[new a(new zt(.25,10,8),i)]],X:[[new a(new k(.5,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new a(new k(.5,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new a(new k(.5,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new a(new k(.75,.1,2,24),i)]]},It={X:[[new a(I,s),[.5,0,0],[0,0,-Math.PI/2]],[new a(m,s),[0,0,0],[0,0,-Math.PI/2]],[new a(I,s),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new a(I,t),[0,.5,0]],[new a(m,t)],[new a(I,t),[0,-.5,0],[0,0,Math.PI]]],Z:[[new a(I,l),[0,0,.5],[Math.PI/2,0,0]],[new a(m,l),[0,0,0],[Math.PI/2,0,0]],[new a(I,l),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new a(new u(.15,.15,.01),d),[.15,.15,0]]],YZ:[[new a(new u(.15,.15,.01),x),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new a(new u(.15,.15,.01),f),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new a(new u(.1,.1,.1),X.clone())]]},At={X:[[new a(new y(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new a(new y(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new a(new y(.2,0,.6,4),i),[0,.3,0]],[new a(new y(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new a(new y(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new a(new y(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new a(new u(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new a(new u(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new a(new u(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new a(new u(.2,.2,.2),i),[0,0,0]]]},Tt={X:[[new L(b,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new L(b,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new L(b,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function A(v){const B=new it;for(const S in v)for(let j=v[S].length;j--;){const w=v[S][j][0].clone(),F=v[S][j][1],U=v[S][j][2],V=v[S][j][3],Lt=v[S][j][4];w.name=S,w.tag=Lt,F&&w.position.set(F[0],F[1],F[2]),U&&w.rotation.set(U[0],U[1],U[2]),V&&w.scale.set(V[0],V[1],V[2]),w.updateMatrix();const lt=w.geometry.clone();lt.applyMatrix4(w.matrix),w.geometry=lt,w.renderOrder=1/0,w.position.set(0,0,0),w.rotation.set(0,0,0),w.scale.set(1,1,1),B.add(w)}return B}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=A(C)),this.add(this.gizmo.rotate=A(Mt)),this.add(this.gizmo.scale=A(It)),this.add(this.picker.translate=A(St)),this.add(this.picker.rotate=A(gt)),this.add(this.picker.scale=A(At)),this.add(this.helper.translate=A(bt)),this.add(this.helper.rotate=A(Pt)),this.add(this.helper.scale=A(Tt)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(o){const i=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:nt;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let n=[];n=n.concat(this.picker[this.mode].children),n=n.concat(this.gizmo[this.mode].children),n=n.concat(this.helper[this.mode].children);for(let s=0;s<n.length;s++){const t=n[s];t.visible=!0,t.rotation.set(0,0,0),t.position.copy(this.worldPosition);let l;if(this.camera.isOrthographicCamera?l=(this.camera.top-this.camera.bottom)/this.camera.zoom:l=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),t.scale.set(1,1,1).multiplyScalar(l*this.size/4),t.tag==="helper"){t.visible=!1,t.name==="AXIS"?(t.position.copy(this.worldPositionStart),t.visible=!!this.axis,this.axis==="X"&&(p.setFromEuler($.set(0,0,0)),t.quaternion.copy(i).multiply(p),Math.abs(c.copy(q).applyQuaternion(i).dot(this.eye))>.9&&(t.visible=!1)),this.axis==="Y"&&(p.setFromEuler($.set(0,0,Math.PI/2)),t.quaternion.copy(i).multiply(p),Math.abs(c.copy(D).applyQuaternion(i).dot(this.eye))>.9&&(t.visible=!1)),this.axis==="Z"&&(p.setFromEuler($.set(0,Math.PI/2,0)),t.quaternion.copy(i).multiply(p),Math.abs(c.copy(R).applyQuaternion(i).dot(this.eye))>.9&&(t.visible=!1)),this.axis==="XYZE"&&(p.setFromEuler($.set(0,Math.PI/2,0)),c.copy(this.rotationAxis),t.quaternion.setFromRotationMatrix(wt.lookAt(ft,c,D)),t.quaternion.multiply(p),t.visible=this.dragging),this.axis==="E"&&(t.visible=!1)):t.name==="START"?(t.position.copy(this.worldPositionStart),t.visible=this.dragging):t.name==="END"?(t.position.copy(this.worldPosition),t.visible=this.dragging):t.name==="DELTA"?(t.position.copy(this.worldPositionStart),t.quaternion.copy(this.worldQuaternionStart),E.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),E.applyQuaternion(this.worldQuaternionStart.clone().invert()),t.scale.copy(E),t.visible=this.dragging):(t.quaternion.copy(i),this.dragging?t.position.copy(this.worldPositionStart):t.position.copy(this.worldPosition),this.axis&&(t.visible=this.axis.search(t.name)!==-1));continue}t.quaternion.copy(i),this.mode==="translate"||this.mode==="scale"?(t.name==="X"&&Math.abs(c.copy(q).applyQuaternion(i).dot(this.eye))>.99&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="Y"&&Math.abs(c.copy(D).applyQuaternion(i).dot(this.eye))>.99&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="Z"&&Math.abs(c.copy(R).applyQuaternion(i).dot(this.eye))>.99&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="XY"&&Math.abs(c.copy(R).applyQuaternion(i).dot(this.eye))<.2&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="YZ"&&Math.abs(c.copy(q).applyQuaternion(i).dot(this.eye))<.2&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="XZ"&&Math.abs(c.copy(D).applyQuaternion(i).dot(this.eye))<.2&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1)):this.mode==="rotate"&&(J.copy(i),c.copy(this.eye).applyQuaternion(p.copy(i).invert()),t.name.search("E")!==-1&&t.quaternion.setFromRotationMatrix(wt.lookAt(this.eye,ft,D)),t.name==="X"&&(p.setFromAxisAngle(q,Math.atan2(-c.y,c.z)),p.multiplyQuaternions(J,p),t.quaternion.copy(p)),t.name==="Y"&&(p.setFromAxisAngle(D,Math.atan2(c.x,c.z)),p.multiplyQuaternions(J,p),t.quaternion.copy(p)),t.name==="Z"&&(p.setFromAxisAngle(R,Math.atan2(c.y,c.x)),p.multiplyQuaternions(J,p),t.quaternion.copy(p))),t.visible=t.visible&&(t.name.indexOf("X")===-1||this.showX),t.visible=t.visible&&(t.name.indexOf("Y")===-1||this.showY),t.visible=t.visible&&(t.name.indexOf("Z")===-1||this.showZ),t.visible=t.visible&&(t.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),t.material._color=t.material._color||t.material.color.clone(),t.material._opacity=t.material._opacity||t.material.opacity,t.material.color.copy(t.material._color),t.material.opacity=t.material._opacity,this.enabled&&this.axis&&(t.name===this.axis||this.axis.split("").some(function(x){return t.name===x}))&&(t.material.color.setHex(16776960),t.material.opacity=1)}super.updateMatrixWorld(o)}}class Vt extends a{constructor(){super(new Ot(1e5,1e5,2,2),new xt({visible:!1,wireframe:!0,side:jt,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(o){let e=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(e="local"),tt.copy(q).applyQuaternion(e==="local"?this.worldQuaternion:nt),G.copy(D).applyQuaternion(e==="local"?this.worldQuaternion:nt),W.copy(R).applyQuaternion(e==="local"?this.worldQuaternion:nt),c.copy(G),this.mode){case"translate":case"scale":switch(this.axis){case"X":c.copy(this.eye).cross(tt),M.copy(tt).cross(c);break;case"Y":c.copy(this.eye).cross(G),M.copy(G).cross(c);break;case"Z":c.copy(this.eye).cross(W),M.copy(W).cross(c);break;case"XY":M.copy(W);break;case"YZ":M.copy(tt);break;case"XZ":c.copy(W),M.copy(G);break;case"XYZ":case"E":M.set(0,0,0);break}break;case"rotate":default:M.set(0,0,0)}M.length()===0?this.quaternion.copy(this.cameraQuaternion):(yt.lookAt(E.set(0,0,0),M,c),this.quaternion.setFromRotationMatrix(yt)),super.updateMatrixWorld(o)}}var z;(function(r){r.CHANGED="changed",r.MOUSE_DOWN="mouseDown",r.CHANGEING="objectChange",r.MOUSE_UP="mouseUp"})(z||(z={}));class Kt extends Wt{constructor(e,i){!e&&(e=new Ht),!i&&(i=document.body);super(e,i);ot(this,"target");ot(this,"transObjectSet");this.domElement.removeEventListener("pointerdown",this._onPointerDown),this._onPointerDown=f=>{var d;!this.enabled||!((d=this.object)!=null&&d.parent)||(this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(f)),this.pointerDown(this._getPointer(f)))},this.domElement.addEventListener("pointerdown",this._onPointerDown),this.target=new it,this.transObjectSet=new Set;let n="";const s=this.target,t=this.transObjectSet,l={x:0,y:0,z:0},x=new WeakMap;this.addEventListener(z.MOUSE_DOWN,f=>{n=f.target.mode,n==="translate"&&(n="position"),n==="rotate"&&(n="rotation"),l.x=s[n].x,l.y=s[n].y,l.z=s[n].z,t.forEach(d=>{x.set(d,d.matrixAutoUpdate),d.matrixAutoUpdate=!1})}),this.addEventListener(z.CHANGEING,f=>{const d=s[n].x-l.x,X=s[n].y-l.y,Y=s[n].z-l.z;l.x=s[n].x,l.y=s[n].y,l.z=s[n].z,t.forEach(T=>{T[n].x+=d,T[n].y+=X,T[n].z+=Y,T.updateMatrix(),T.updateMatrixWorld()}),this.dispatchEvent({type:z.CHANGED,transObjectSet:t,mode:n,target:s})}),this.addEventListener(z.MOUSE_UP,f=>{t.forEach(d=>{d.matrixAutoUpdate=x.get(d),x.delete(d)})})}setDom(e){return this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),e.addEventListener("pointerdown",this._onPointerDown),e.addEventListener("pointermove",this._onPointerHover),e.addEventListener("pointerup",this._onPointerUp),this.domElement=e,this}setCamera(e){return this.camera=e,this}getTarget(){return this.target}getTransObjectSet(){return this.transObjectSet}setAttach(...e){if(this.transObjectSet.clear(),!e.length||!e[0])return this.detach(),this;this.attach(this.target);const i=this.target;if(e.length===1){const l=e[0];return l.matrixWorld.decompose(i.position,i.quaternion,i.scale),i.updateMatrix(),i.updateMatrixWorld(),this.transObjectSet.add(l),this}const n=[],s=[],t=[];return e.forEach(l=>{n.push(l.matrixWorld.elements[12]),s.push(l.matrixWorld.elements[13]),t.push(l.matrixWorld.elements[14])}),i.rotation.set(0,0,0),i.scale.set(0,0,0),i.position.x=(Math.max(...n)-Math.min(...n))/2+Math.min(...n),i.position.y=(Math.max(...s)-Math.min(...s))/2+Math.min(...s),i.position.z=(Math.max(...t)-Math.min(...t))/2+Math.min(...t),i.updateMatrix(),i.updateMatrixWorld(),e.forEach(l=>{this.transObjectSet.add(l)}),this}}const _t=rt(Gt),se=function(){let r,o,e;return{name:_t,install(i){const n=new Kt(i.camera,i.dom);n.detach(),i.transformControls=n,i.scene.add(n),i.scene.add(n.target),i.transformControls.addEventListener(z.MOUSE_DOWN,()=>{i.transing=!0}),i.setTransformControls=function(s){return s?this.scene.add(this.transformControls):this.scene.remove(this.transformControls),this},o=s=>{s.options.transformControls&&n.setCamera(s.camera)},i.addEventListener(H.SETCAMERA,o),r=s=>{n.setDom(s.dom)},i.addEventListener(H.SETDOM,r),e=s=>{const t=s.scene;t.add(n.target),t.add(n)},i.addEventListener(H.SETSCENE,e)},dispose(i){var n;i.removeEventListener(H.SETCAMERA,o),i.removeEventListener(H.SETDOM,r),i.removeEventListener(H.SETSCENE,e),(n=i.transformControls)==null||n.dispose(),delete i.transing,delete i.transformControls,delete i.setTransformControls}}},$t="@vis-three/trans-select-event-strategy",Jt=rt($t),ae=function(){let r,o;return{name:Jt,condition:[vt,Yt,_t],exec(e){e.eventManager.addFilterObject(e.transformControls),r=i=>{if(e.transing){e.transing=!1;return}const n=i.intersections;if(i.ctrlKey||e.selectionBox.clear(),e.eventManager.penetrate)for(const s of n){if(i.ctrlKey&&e.selectionBox.has(s.object)){e.selectionBox.delete(s.object);continue}e.selectionBox.add(s.object)}else if(n.length){const s=n[0].object;if(i.ctrlKey&&e.selectionBox.has(s)){e.selectionBox.delete(s);return}e.selectionBox.add(s)}e.dispatchEvent({type:et,objects:Array.from(e.selectionBox)})},e.eventManager.addEventListener("click",r),o=i=>{e.transformControls.setAttach(...i.objects)},e.addEventListener(et,o)},rollback(e){e.eventManager.removeFilterObject(e.transformControls),e.eventManager.removeEventListener("click",r),e.eventManager.removeEventListener(et,o)}}};export{oe as S,se as T,ae as a,_t as b,vt as c,et as d};
