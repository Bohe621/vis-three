(function(c,n){typeof exports=="object"&&typeof module!="undefined"?n(exports,require("three")):typeof define=="function"&&define.amd?define(["exports","three"],n):(c=typeof globalThis!="undefined"?globalThis:c||self,n((c["vis-three"]=c["vis-three"]||{},c["vis-three"].convenient={}),c.three))})(this,function(c,n){"use strict";var P=Object.defineProperty;var E=(c,n,a)=>n in c?P(c,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):c[n]=a;var o=(c,n,a)=>(E(c,typeof n!="symbol"?n+"":n,a),a);class a{constructor(e){o(this,"canvas");this.canvas=document.createElement("canvas");const t=window.devicePixelRatio;this.canvas.width=((e==null?void 0:e.width)||512)*t,this.canvas.height=((e==null?void 0:e.height)||512)*t,this.canvas.style.backgroundColor=(e==null?void 0:e.bgColor)||"rgb(255, 255, 255)";const i=this.canvas.getContext("2d");i&&i.scale(window.devicePixelRatio,window.devicePixelRatio)}get(){return this.canvas}getDom(){return this.canvas}clear(e=0,t=0,i,s){!i&&(i=this.canvas.width),!s&&(s=this.canvas.height);const r=this.canvas.getContext("2d");return r?(r.clearRect(e,t,i,s),this):(console.warn("you browser can not support canvas 2d"),this)}draw(e){const t=this.canvas.getContext("2d");return t?(e(t),this):(console.warn("you browser can not support canvas 2d"),this)}preview(e){const t=this.canvas;return t.style.position="fixed",t.style.top=(e==null?void 0:e.top)||"5%",t.style.left=(e==null?void 0:e.left)||"5%",t.style.right=(e==null?void 0:e.right)||"unset",t.style.bottom=(e==null?void 0:e.bottom)||"unset",e!=null&&e.scale&&(t.style.transform=`scale(${e.scale})`),document.body.appendChild(this.canvas),this}setSize(e,t){return this.canvas.width=e*devicePixelRatio,this.canvas.height=t*devicePixelRatio,this}}class b{constructor(){o(this,"listeners",new Map)}addEventListener(e,t){const i=this.listeners;i.has(e)||i.set(e,[]);const s=i.get(e);s.includes(t)||s.push(t)}hasEventListener(e,t){const i=this.listeners;return i.has(e)?i.get(e).includes(t):!1}removeEventListener(e,t){const i=this.listeners;if(!i.has(e)||!i.get(e).includes(t))return;const s=i.get(e);s.splice(s.indexOf(t),1)}removeEvent(e){const t=this.listeners;!t.has(e)||t.delete(e)}dispatchEvent(e){var s;const t=e.type,i=this.listeners;if(i.has(t))try{(s=i.get(t))==null||s.forEach(r=>{r.call(this,e)})}catch(r){console.error(r)}}once(e,t){const i=function(s){t.call(this,s),Promise.resolve(()=>{this.removeEventListener(e,i)})};this.addEventListener(e,i)}emit(e,t={}){var s;const i=this.listeners;if(i.has(e))try{(s=i.get(e))==null||s.forEach(r=>{r.call(this,t)})}catch(r){console.error(r)}}on(e,t){this.addEventListener(e,t)}has(e,t){return this.hasEventListener(e,t)}off(e,t){if(t)this.removeEventListener(e,t);else{const i=this.listeners;if(!i.has(e))return;i.delete(e)}}eventCount(e){return this.listeners.has(e)?this.listeners.get(e).length:0}popLatestEvent(e){!this.listeners.has(e)||this.listeners.get(e).pop()}clear(){this.listeners.clear()}useful(){return Boolean([...this.listeners.keys()].length)}}var L=(l=>(l.RELOAD="reload",l.UPDATE="update",l))(L||{});const w=class extends b{constructor(t){super();o(this,"canvas");o(this,"data");this.data=new Proxy(t,{get:w.proxyGetter,set:w.proxySetter.bind(this)})}setSize(){return this}draw(){return this}};let u=w;o(u,"proxyGetter",function(t,i,s){return Reflect.get(t,i,s)}),o(u,"proxySetter",function(t,i,s,r){const p=Reflect.set(t,i,s,r);return(i==="width"||i==="height")&&(this.setSize(),this.dispatchEvent({type:"reload"})),this.draw(),this.dispatchEvent({type:"update"}),p});class y{next(){console.warn(`this action can not set next function: ${this.constructor.name}`)}prev(){console.warn(`this action can not set prev function: ${this.constructor.name}`)}}class S{constructor(e){o(this,"actionList",[]);o(this,"index",-1);o(this,"step",50);this.step=e||50}do(e){this.actionList[this.index][e]()}apply(e,t=!1){const i=this.actionList;this.index===i.length-1&&i.length>=this.step?(i.shift(),this.index=this.actionList.length-1):this.index!==-1?i.splice(this.index+1,i.length-1):this.index===-1&&(this.actionList=[]),this.actionList.push(e),t?this.redo():this.index+=1}redo(){if(this.index+=1,this.index>this.actionList.length-1){this.index=this.actionList.length-1;return}this.do("next")}undo(){this.index<0||(this.do("prev"),this.index-=1)}clear(){this.actionList=[]}}const g=new n.PointLight("rgb(255, 255, 255)",.5,200,1);g.position.set(-30,5,20),g.castShadow=!0;const f=new n.Mesh(new n.BoxBufferGeometry(80,2,80),new n.MeshStandardMaterial({color:"rgb(255, 255, 255)"}));f.position.set(0,-11,0),f.receiveShadow=!0,f.castShadow=!0;const h=class{constructor(e){o(this,"material");o(this,"dom");o(this,"renderer");o(this,"scene");o(this,"camera");o(this,"object");const t=new n.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0});t.setPixelRatio(window.devicePixelRatio),t.setClearColor("rgb(150, 150, 150)"),t.shadowMap.enabled=!0,t.shadowMap.type=n.PCFSoftShadowMap;const i=new n.Scene,s=new n.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,500);s.position.set(0,0,35),s.up.x=0,s.up.y=1,s.up.z=0,s.lookAt(new n.Vector3(0,0,0)),i.add(h.ambientLight),i.add(h.pointLight),i.add(h.plane),this.scene=i,this.renderer=t,this.camera=s,this.object=new n.Object3D,e!=null&&e.material&&this.setMaterial(e.material),e!=null&&e.dom&&this.setDom(e.dom)}setMaterial(e){if(this.scene.remove(this.object),this.material=e,e.type.includes("Mesh"))this.object=new n.Mesh(h.geometry,e);else if(e.type.includes("Line"))this.object=new n.Line(h.geometry,e);else if(e.type.includes("Points"))this.object=new n.Points(h.geometry,e);else if(e.type.includes("Sprite"))this.object=new n.Sprite(e);else return console.warn(`material displayer can not support this type material: '${e.type}'`),this;return this.object.castShadow=!0,this.object.receiveShadow=!0,this.scene.add(this.object),this}setDom(e){return this.dom=e,this.setSize(),e.appendChild(this.renderer.domElement),this}setSize(e,t){if(e&&t)this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t,!0);else{if(!this.dom)return console.warn("material displayer must set dom before setSize with empty parameters"),this;const i=this.dom;this.camera.aspect=i.offsetWidth/i.offsetHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(i.offsetWidth,i.offsetHeight,!0)}return this}render(){this.renderer.render(this.scene,this.camera)}getDataURL(e){return this.renderer.domElement.toDataURL(e||"image/png")}dispose(){this.renderer.dispose()}};let d=h;o(d,"ambientLight",new n.AmbientLight("rgb(255, 255, 255)",.7)),o(d,"pointLight",g),o(d,"geometry",new n.SphereBufferGeometry(10,12,12)),o(d,"plane",f),o(d,"dispose",()=>{h.geometry.dispose(),h.plane.geometry.dispose()});const x=class{constructor(e){o(this,"dom");o(this,"texture");o(this,"renderer");o(this,"scene");o(this,"camera");const t=new n.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0});t.setPixelRatio(window.devicePixelRatio),t.setClearColor("rgb(150, 150, 150)"),t.shadowMap.enabled=!0,t.shadowMap.type=n.PCFSoftShadowMap;const i=new n.Scene,s=new n.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,500);s.position.set(0,0,35),s.up.x=0,s.up.y=1,s.up.z=0,s.lookAt(new n.Vector3(0,0,0)),i.add(x.ambientLight),this.scene=i,this.renderer=t,this.camera=s,e!=null&&e.texture&&this.setTexture(e.texture),e!=null&&e.dom&&this.setDom(e.dom)}setTexture(e){return this.scene.background=e,this}setDom(e){return this.dom=e,this.setSize(),e.appendChild(this.renderer.domElement),this}setSize(e,t){if(e&&t)this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t,!0);else{if(!this.dom)return console.warn("texture displayer must set dom before setSize with empty parameters"),this;const i=this.dom;this.camera.aspect=i.offsetWidth/i.offsetHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(i.offsetWidth,i.offsetHeight,!0)}return this}render(){this.renderer.render(this.scene,this.camera)}getDataURL(e){return this.renderer.domElement.toDataURL(e||"image/png")}dispose(){this.renderer.dispose()}};let v=x;o(v,"ambientLight",new n.AmbientLight("rgb(255, 255, 255)",1)),c.Action=y,c.CanvasGenerator=a,c.CanvasReactor=u,c.EventDispatcher=b,c.History=S,c.MaterialDisplayer=d,c.RECT_EVENT=L,c.TextureDisplayer=v,Object.defineProperties(c,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
