(function(o,n){typeof exports=="object"&&typeof module<"u"?n(exports,require("three")):typeof define=="function"&&define.amd?define(["exports","three"],n):(o=typeof globalThis<"u"?globalThis:o||self,n((o["vis-three"]=o["vis-three"]||{},o["vis-three"].convenient={}),o.three))})(this,function(o,n){"use strict";class L{constructor(t){this.canvas=document.createElement("canvas");const e=window.devicePixelRatio;this.canvas.width=((t==null?void 0:t.width)||512)*e,this.canvas.height=((t==null?void 0:t.height)||512)*e,this.canvas.style.backgroundColor=(t==null?void 0:t.bgColor)||"rgb(255, 255, 255)";const i=this.canvas.getContext("2d");i&&i.scale(window.devicePixelRatio,window.devicePixelRatio)}get(){return this.canvas}getDom(){return this.canvas}clear(t=0,e=0,i,s){!i&&(i=this.canvas.width),!s&&(s=this.canvas.height);const h=this.canvas.getContext("2d");return h?(h.clearRect(t,e,i,s),this):(console.warn("you browser can not support canvas 2d"),this)}draw(t){const e=this.canvas.getContext("2d");return e?(t(e),this):(console.warn("you browser can not support canvas 2d"),this)}preview(t){const e=this.canvas;return e.style.position="fixed",e.style.top=(t==null?void 0:t.top)||"5%",e.style.left=(t==null?void 0:t.left)||"5%",e.style.right=(t==null?void 0:t.right)||"unset",e.style.bottom=(t==null?void 0:t.bottom)||"unset",t!=null&&t.scale&&(e.style.transform=`scale(${t.scale})`),document.body.appendChild(this.canvas),this}setSize(t,e){return this.canvas.width=t*devicePixelRatio,this.canvas.height=e*devicePixelRatio,this}}class g{constructor(){this.listeners=new Map}addEventListener(t,e){const i=this.listeners;i.has(t)||i.set(t,[]);const s=i.get(t);s.includes(e)||s.push(e)}hasEventListener(t,e){const i=this.listeners;return i.has(t)?i.get(t).includes(e):!1}removeEventListener(t,e){const i=this.listeners;if(!i.has(t)||!i.get(t).includes(e))return;const s=i.get(t);s.splice(s.indexOf(e),1)}removeEvent(t){const e=this.listeners;e.has(t)&&e.delete(t)}dispatchEvent(t){var s;const e=t.type,i=this.listeners;if(i.has(e))try{(s=i.get(e))==null||s.forEach(h=>{h.call(this,t)})}catch(h){console.error(h)}}once(t,e){const i=function(s){e.call(this,s),Promise.resolve(()=>{this.removeEventListener(t,i)})};this.addEventListener(t,i)}emit(t,e={}){var s;const i=this.listeners;if(i.has(t))try{(s=i.get(t))==null||s.forEach(h=>{h.call(this,e)})}catch(h){console.error(h)}}on(t,e){this.addEventListener(t,e)}has(t,e){return this.hasEventListener(t,e)}off(t,e){if(e)this.removeEventListener(t,e);else{const i=this.listeners;if(!i.has(t))return;i.delete(t)}}eventCount(t){return this.listeners.has(t)?this.listeners.get(t).length:0}popLatestEvent(t){this.listeners.has(t)&&this.listeners.get(t).pop()}clear(){this.listeners.clear()}useful(){return!![...this.listeners.keys()].length}}var x=(r=>(r.RELOAD="reload",r.UPDATE="update",r))(x||{});const d=class d extends g{constructor(t){super(),this.data=new Proxy(t,{get:d.proxyGetter,set:d.proxySetter.bind(this)})}setSize(){return this}draw(){return this}};d.proxyGetter=function(t,e,i){return Reflect.get(t,e,i)},d.proxySetter=function(t,e,i,s){const h=Reflect.set(t,e,i,s);return(e==="width"||e==="height")&&(this.setSize(),this.dispatchEvent({type:"reload"})),this.draw(),this.dispatchEvent({type:"update"}),h};let u=d;class b{next(){console.warn(`this action can not set next function: ${this.constructor.name}`)}prev(){console.warn(`this action can not set prev function: ${this.constructor.name}`)}}class y{constructor(t){this.actionList=[],this.index=-1,this.step=50,this.step=t||50}do(t){this.actionList[this.index][t]()}apply(t,e=!1){const i=this.actionList;this.index===i.length-1&&i.length>=this.step?(i.shift(),this.index=this.actionList.length-1):this.index!==-1?i.splice(this.index+1,i.length-1):this.index===-1&&(this.actionList=[]),this.actionList.push(t),e?this.redo():this.index+=1}redo(){if(this.index+=1,this.index>this.actionList.length-1){this.index=this.actionList.length-1;return}this.do("next")}undo(){this.index<0||(this.do("prev"),this.index-=1)}clear(){this.actionList=[]}}const f=new n.PointLight("rgb(255, 255, 255)",.5,200,1);f.position.set(-30,5,20),f.castShadow=!0;const l=new n.Mesh(new n.BoxGeometry(80,2,80),new n.MeshStandardMaterial({color:"rgb(255, 255, 255)"}));l.position.set(0,-11,0),l.receiveShadow=!0,l.castShadow=!0;const c=class c{constructor(t){const e=new n.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0});e.setPixelRatio(window.devicePixelRatio),e.setClearColor("rgb(150, 150, 150)"),e.shadowMap.enabled=!0,e.shadowMap.type=n.PCFSoftShadowMap;const i=new n.Scene,s=new n.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,500);s.position.set(0,0,35),s.up.x=0,s.up.y=1,s.up.z=0,s.lookAt(new n.Vector3(0,0,0)),i.add(c.ambientLight),i.add(c.pointLight),i.add(c.plane),this.scene=i,this.renderer=e,this.camera=s,this.object=new n.Object3D,t!=null&&t.material&&this.setMaterial(t.material),t!=null&&t.dom&&this.setDom(t.dom)}setMaterial(t){if(this.scene.remove(this.object),this.material=t,t.type.includes("Mesh")||t.type==="ShaderMaterial"||t.type==="RawShaderMaterial")this.object=new n.Mesh(c.geometry,t);else if(t.type.includes("Line"))this.object=new n.Line(c.geometry,t);else if(t.type.includes("Points"))this.object=new n.Points(c.geometry,t);else if(t.type.includes("Sprite"))this.object=new n.Sprite(t);else return console.warn(`material displayer can not support this type material: '${t.type}'`),this;return this.object.castShadow=!0,this.object.receiveShadow=!0,this.scene.add(this.object),this}setDom(t){return this.dom=t,this.setSize(),t.appendChild(this.renderer.domElement),this}setSize(t,e){if(t&&e)this.camera.aspect=t/e,this.camera.updateProjectionMatrix(),this.renderer.setSize(t,e,!0);else{if(!this.dom)return console.warn("material displayer must set dom before setSize with empty parameters"),this;const i=this.dom;this.camera.aspect=i.offsetWidth/i.offsetHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(i.offsetWidth,i.offsetHeight,!0)}return this}render(){this.renderer.render(this.scene,this.camera)}getDataURL(t){return this.renderer.domElement.toDataURL(t||"image/png")}dispose(){this.renderer.dispose()}};c.ambientLight=new n.AmbientLight("rgb(255, 255, 255)",.7),c.pointLight=f,c.geometry=new n.SphereGeometry(10,12,12),c.plane=l,c.dispose=()=>{c.geometry.dispose(),c.plane.geometry.dispose()};let w=c;const a=class a{constructor(t){const e=new n.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0});e.setPixelRatio(window.devicePixelRatio),e.setClearColor("rgb(150, 150, 150)"),e.shadowMap.enabled=!0,e.shadowMap.type=n.PCFSoftShadowMap;const i=new n.Scene,s=new n.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,500);s.position.set(0,0,35),s.up.x=0,s.up.y=1,s.up.z=0,s.lookAt(new n.Vector3(0,0,0)),i.add(a.ambientLight),this.scene=i,this.renderer=e,this.camera=s,t!=null&&t.texture&&this.setTexture(t.texture),t!=null&&t.dom&&this.setDom(t.dom)}setTexture(t){return this.scene.background=t,this}setDom(t){return this.dom=t,this.setSize(),t.appendChild(this.renderer.domElement),this}setSize(t,e){if(t&&e)this.camera.aspect=t/e,this.camera.updateProjectionMatrix(),this.renderer.setSize(t,e,!0);else{if(!this.dom)return console.warn("texture displayer must set dom before setSize with empty parameters"),this;const i=this.dom;this.camera.aspect=i.offsetWidth/i.offsetHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(i.offsetWidth,i.offsetHeight,!0)}return this}render(){this.renderer.render(this.scene,this.camera)}getDataURL(t){return this.renderer.domElement.toDataURL(t||"image/png")}dispose(){this.renderer.dispose()}};a.ambientLight=new n.AmbientLight("rgb(255, 255, 255)",1);let v=a;o.Action=b,o.CanvasGenerator=L,o.CanvasReactor=u,o.EventDispatcher=g,o.History=y,o.MaterialDisplayer=w,o.RECT_EVENT=x,o.TextureDisplayer=v,Object.defineProperty(o,Symbol.toStringTag,{value:"Module"})});
