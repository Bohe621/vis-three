(function(o,n){typeof exports=="object"&&typeof module!="undefined"?n(exports,require("three"),require("three/examples/jsm/lights/RectAreaLightUniformsLib.js"),require("three/src/lights/LightShadow"),require("three/examples/jsm/renderers/CSS2DRenderer"),require("three/examples/jsm/renderers/CSS3DRenderer")):typeof define=="function"&&define.amd?define(["exports","three","three/examples/jsm/lights/RectAreaLightUniformsLib.js","three/src/lights/LightShadow","three/examples/jsm/renderers/CSS2DRenderer","three/examples/jsm/renderers/CSS3DRenderer"],n):(o=typeof globalThis!="undefined"?globalThis:o||self,n((o.VIS=o.VIS||{},o.VIS.core={}),o.three,o.RectAreaLightUniformsLib_js,o.LightShadow,o.CSS2DRenderer,o.CSS3DRenderer))})(this,function(o,n,d,x,L,f){"use strict";var Q=Object.defineProperty;var W=(o,n,d)=>n in o?Q(o,n,{enumerable:!0,configurable:!0,writable:!0,value:d}):o[n]=d;var c=(o,n,d)=>(W(o,typeof n!="symbol"?n+"":n,d),d);const b="0.6.0";window.__THREE__||console.error("vis-three dependent on three.js module, pleace run 'npm i three' first."),window.__VIS__?console.warn("Duplicate vis-three frames are introduced"):window.__VIS__=b;const m=new x.LightShadow(new n.OrthographicCamera(-256,256,256,-256));m.autoUpdate=!1,m.needsUpdate=!1,n.AmbientLight.prototype.shadow=m,n.RectAreaLight.prototype.shadow=m,n.HemisphereLight.prototype.shadow=m,d.RectAreaLightUniformsLib.init();class S{constructor(){c(this,"listeners",new Map)}addEventListener(s,e){const t=this.listeners;t.has(s)||t.set(s,[]);const i=t.get(s);i.includes(e)||i.push(e)}hasEventListener(s,e){const t=this.listeners;return t.has(s)?t.get(s).includes(e):!1}removeEventListener(s,e){const t=this.listeners;if(!t.has(s)||!t.get(s).includes(e))return;const i=t.get(s);i.splice(i.indexOf(e),1)}dispatchEvent(s){var i;const e=s.type,t=this.listeners;if(t.has(e))try{(i=t.get(e))==null||i.forEach(r=>{r.call(this,s)})}catch(r){console.error(r)}}once(s,e){const t=function(i){e.call(this,i),this.removeEventListener(s,t)};this.addEventListener(s,t)}emit(s,e={}){var i;const t=this.listeners;if(t.has(s))try{(i=t.get(s))==null||i.forEach(r=>{r.call(this,e)})}catch(r){console.error(r)}}on(s,e){this.addEventListener(s,e)}has(s,e){return this.hasEventListener(s,e)}off(s,e){if(e)this.removeEventListener(s,e);else{const t=this.listeners;if(!t.has(s))return;t.delete(s)}}eventCount(s){return this.listeners.has(s)?this.listeners.get(s).length:0}popLatestEvent(s){!this.listeners.has(s)||this.listeners.get(s).pop()}clear(){this.listeners.clear()}useful(){return Boolean([...this.listeners.keys()].length)}}o.ENGINE_EVENT=void 0,function(a){a.SETDOM="setDom",a.SETSIZE="setSize",a.SETCAMERA="setCamera",a.SETSCENE="setScene",a.RENDER="render",a.DISPOSE="dispose"}(o.ENGINE_EVENT||(o.ENGINE_EVENT={}));class w extends S{constructor(){super();c(this,"pluginTables",new Map);c(this,"strategyTables",new Map);c(this,"dom",document.createElement("div"));c(this,"camera",new n.PerspectiveCamera);c(this,"scene",new n.Scene);this.camera.position.set(50,50,50),this.camera.lookAt(0,0,0)}install(e){if(this.pluginTables.has(e.name))return console.warn("This plugin already exists",e.name),this;const t=i=>this.pluginTables.has(i)?!0:(console.error(`${e.name} must install this plugin before: ${i}`),!1);if(e.deps)if(Array.isArray(e.deps))for(const i of e.deps)t(i);else t(e.deps);return e.install(this),this.pluginTables.set(e.name,e),this}unistall(e){return this.pluginTables.has(e)?(this.pluginTables.get(e).dispose(this),this.pluginTables.delete(e),this):this}exec(e){const t=this.strategyTables;if(t.has(e.name))return console.warn("This strategy already exists",e.name),this;const i=this.pluginTables;for(const r of e.condition)if(!i.has(r))return console.warn(`${e.name} does not meet the conditions for execution: ${r}`),this;return e.exec(this),t.set(e.name,e),this}rollback(e){const t=this.strategyTables;return t.has(e)?(t.get(e).rollback(this),t.delete(e),this):this}setDom(e){return this.dom=e,this.dispatchEvent({type:o.ENGINE_EVENT.SETDOM,dom:e}),this}setSize(e,t){var i,r;return e&&e<=0||t&&t<=0?(console.warn(`you must be input width and height bigger then zero, width: ${e}, height: ${t}`),this):(!e&&(e=((i=this.dom)==null?void 0:i.offsetWidth)||window.innerWidth),!t&&(t=((r=this.dom)==null?void 0:r.offsetHeight)||window.innerHeight),this.dispatchEvent({type:o.ENGINE_EVENT.SETSIZE,width:e,height:t}),this)}setCamera(e,t){return this.dispatchEvent({type:o.ENGINE_EVENT.SETCAMERA,camera:e,oldCamera:this.camera,options:Object.assign({orbitControls:!0,transformControls:!0},t||{})}),this.camera=e,this}setScene(e){return this.dispatchEvent({type:o.ENGINE_EVENT.SETSCENE,scene:e,oldScene:this.scene}),this.scene=e,this}render(e){return this.dispatchEvent({type:o.ENGINE_EVENT.RENDER,delta:e}),this}dispose(){return this.dispatchEvent({type:o.ENGINE_EVENT.DISPOSE}),this}}const B=function(a){const s=new w;return a.plugins&&a.plugins.forEach(e=>{s.install(e)}),a.strategy&&a.strategy.forEach(e=>{s.exec(e)}),s},P=function(a){return()=>a};class T extends n.Texture{constructor(e,t,i,r,l,h,u,p,y){super(e,t,i,r,l,h,u,p,y);c(this,"isVideoTexture",!0);this.format=u!==void 0?u:n.RGBFormat,this.minFilter=h!==void 0?h:n.LinearFilter,this.magFilter=l!==void 0?l:n.LinearFilter,this.generateMipmaps=!1}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image,t="requestVideoFrameCallback"in e;t?this.needsUpdate=!0:t===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class v extends L.CSS2DObject{constructor(e=document.createElement("div")){const t=document.createElement("div"),i=50,r=50;t.style.width=`${i}px`,t.style.height=`${r}px`,t.appendChild(e);super(t);c(this,"geometry");c(this,"_width");c(this,"_height");this.geometry=new n.PlaneBufferGeometry(i,r),this.geometry.computeBoundingBox(),this._width=i,this._height=r}get width(){return this._width}set width(e){this.geometry.dispose(),this.geometry=new n.PlaneBufferGeometry(e,this._height),this.geometry.computeBoundingBox(),this.element.style.width=`${e}px`,this._width=e}get height(){return this._height}set height(e){this.geometry.dispose(),this.geometry=new n.PlaneBufferGeometry(this._width,e),this.geometry.computeBoundingBox(),this.element.style.height=`${e}px`,this._height=e}}class C extends f.CSS3DObject{constructor(e=document.createElement("div")){const t=document.createElement("div"),i=50,r=50;t.style.width=`${i}px`,t.style.height=`${r}px`,t.appendChild(e);super(t);c(this,"geometry");c(this,"_width");c(this,"_height");this.geometry=new n.PlaneBufferGeometry(i,r),this.geometry.computeBoundingBox(),this._width=i,this._height=r}get width(){return this._width}set width(e){this.geometry.dispose(),this.geometry=new n.PlaneBufferGeometry(e,this._height),this.geometry.computeBoundingBox(),this.element.style.width=`${e}px`,this._width=e}get height(){return this._height}set height(e){this.geometry.dispose(),this.geometry=new n.PlaneBufferGeometry(this._width,e),this.geometry.computeBoundingBox(),this.element.style.height=`${e}px`,this._height=e}}class E extends f.CSS3DSprite{constructor(e=document.createElement("div")){const t=document.createElement("div"),i=50,r=50;t.style.width=`${i}px`,t.style.height=`${r}px`,t.appendChild(e),e.classList.add("vis-css3d","vis-css3d-sprite");super(t);c(this,"geometry");c(this,"_width");c(this,"_height");c(this,"cacheBox",new n.Box3);c(this,"cachePosition",new n.Vector3);c(this,"cacheQuaternion",new n.Quaternion);c(this,"cacheScale",new n.Vector3);c(this,"cacheMatrix4",new n.Matrix4);c(this,"rotateMatrix4",new n.Matrix4);this.geometry=new n.PlaneBufferGeometry(i,r),this.geometry.computeBoundingBox(),this._width=i,this._height=r,this.type="CSS3DSprite"}get width(){return this._width}set width(e){this.geometry.dispose(),this.geometry=new n.PlaneBufferGeometry(e,this._height),this.geometry.computeBoundingBox(),this.element.style.width=`${e}px`,this._width=e}get height(){return this._height}set height(e){this.geometry.dispose(),this.geometry=new n.PlaneBufferGeometry(this._width,e),this.geometry.computeBoundingBox(),this.element.style.height=`${e}px`,this._height=e}raycast(e,t){const i=this.cacheBox.copy(this.geometry.boundingBox);this.matrixWorld.decompose(this.cachePosition,this.cacheQuaternion,this.cacheScale);const r=this.rotateMatrix4.lookAt(this.position,e.camera.position,this.up);this.cacheQuaternion.setFromRotationMatrix(r),this.cacheMatrix4.compose(this.cachePosition,this.cacheQuaternion,this.cacheScale),i.applyMatrix4(this.cacheMatrix4),e.ray.intersectsBox(i)&&t.push({distance:e.ray.origin.distanceTo(this.position),object:this,point:this.position})}}class G extends n.Texture{constructor(s,e,t,i,r,l,h,u,p,y){super(s,e,t,i,r,l,h,u,p,y)}}class _ extends n.Texture{constructor(s){super(),Object.keys(s).forEach(e=>{this[e]=s[e]}),this.copy(s)}}class D extends v{constructor(e=document.createElement("div")){super(e);c(this,"cacheBox",new n.Box3);c(this,"viewWorldMatrix",new n.Matrix4);c(this,"mvPosition",new n.Vector3);c(this,"matrixScale",new n.Vector3);c(this,"worldScale",new n.Vector3);c(this,"vA",new n.Vector3);c(this,"vB",new n.Vector3);c(this,"vC",new n.Vector3);c(this,"alignedPosition",new n.Vector2);c(this,"rotatedPosition",new n.Vector2);c(this,"intersectPoint",new n.Vector3);this.type="CSS2DPlane",this.element.classList.add("vis-css2d","vis-css2d-plane"),new MutationObserver(()=>{this.matrixScale.set(Math.abs(this.width/100)*.1,Math.abs(this.height/100)*.1,1)}).observe(this.element,{attributeFilter:["style"]})}transformVertex(e,t,i){const r=this.alignedPosition,l=this.rotatedPosition,h=0,u=1;r.copy(e).multiply(i),l.x=u*r.x-h*r.y,l.y=h*r.x+u*r.y,e.copy(t),e.x+=l.x,e.y+=l.y,e.applyMatrix4(this.viewWorldMatrix)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),this.viewWorldMatrix.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),this.mvPosition.setFromMatrixPosition(this.modelViewMatrix),this.worldScale.copy(this.matrixScale).multiplyScalar(-this.mvPosition.z),this.transformVertex(this.vA.set(-.5,-.5,0),this.mvPosition,this.worldScale),this.transformVertex(this.vB.set(.5,-.5,0),this.mvPosition,this.worldScale),this.transformVertex(this.vC.set(.5,.5,0),this.mvPosition,this.worldScale);let i=e.ray.intersectTriangle(this.vA,this.vB,this.vC,!1,this.intersectPoint);if(i===null&&(this.transformVertex(this.vB.set(-.5,.5,0),this.mvPosition,this.worldScale),i=e.ray.intersectTriangle(this.vA,this.vC,this.vB,!1,this.intersectPoint),i===null))return;const r=e.ray.origin.distanceTo(this.intersectPoint);r<e.near||r>e.far||t.push({distance:r,point:this.intersectPoint.clone(),face:null,object:this})}}class V extends C{constructor(e=document.createElement("div")){super(e);c(this,"cacheBox",new n.Box3);this.type="CSS3DPlane",this.element.classList.add("vis-css3d","vis-css3d-plane")}raycast(e,t){const i=this.cacheBox.copy(this.geometry.boundingBox);i.applyMatrix4(this.matrixWorld),e.ray.intersectsBox(i)&&t.push({distance:e.ray.origin.distanceTo(this.position),object:this,point:this.position})}}class M extends E{constructor(s=document.createElement("div")){super(s),this.type="CSS3DSprite",this.element.classList.add("vis-css3d","vis-css3d-plane")}}class A extends n.BufferGeometry{constructor(e){super();c(this,"type","LoadBufferGeometry");e&&this.copy(e)}}class g extends n.BufferGeometry{constructor(e=[],t=36,i=!0){super();c(this,"parameters");this.type="CurveGeometry",this.parameters={path:e.map(r=>r.clone()),space:i,divisions:t}}}class R extends g{constructor(s=[],e=36,t=!0){super(s,e,t),this.type="CubicBezierCurveGeometry";const i=new n.CurvePath;if(s.length<4){console.warn("CubicBezierCurveGeometry path length at least 4.");return}const r=4+(s.length-4)-(s.length-4)%3;for(let h=2;h<r;h+=3)i.add(new n.CubicBezierCurve3(s[h-2],s[h-1],s[h],s[h+1]));const l=i.curves.reduce((h,u)=>h+=u.arcLengthDivisions,0);if(e>l){const h=Math.ceil((e-l)/i.curves.length);i.curves.forEach(u=>{u.arcLengthDivisions=u.arcLengthDivisions*(h+1),u.updateArcLengths()})}this.setFromPoints(t?i.getSpacedPoints(e):i.getPoints(e))}}class j extends g{constructor(s=[],e=36,t=!0){if(super(s,e,t),this.type="LineCurveGeometry",!s.length){console.warn("LineCurveGeometry path length at least 1.");return}const i=new n.CurvePath;for(let l=1;l<s.length;l+=1)i.add(new n.LineCurve3(s[l-1],s[l]));const r=i.curves.reduce((l,h)=>l+=h.arcLengthDivisions,0);if(e>r){const l=Math.ceil((e-r)/i.curves.length);i.curves.forEach(h=>{h.arcLengthDivisions=h.arcLengthDivisions*(l+1),h.updateArcLengths()})}this.setFromPoints(t?i.getSpacedPoints(e):i.getPoints(e))}}class $ extends g{constructor(s=[],e=36,t=!0){super(s,e,t),this.type="QuadraticBezierCurveGeometry";const i=new n.CurvePath;if(s.length<3){console.warn("QuadraticBezierCurveGeometry path length at least 3.");return}const r=3+(s.length-3)-(s.length-3)%2;for(let h=1;h<r;h+=2)i.add(new n.QuadraticBezierCurve3(s[h-1],s[h],s[h+1]));const l=i.curves.reduce((h,u)=>h+=u.arcLengthDivisions,0);if(e>l){const h=Math.ceil((e-l)/i.curves.length);i.curves.forEach(u=>{u.arcLengthDivisions=u.arcLengthDivisions*(h+1),u.updateArcLengths()})}this.setFromPoints(t?i.getSpacedPoints(e):i.getPoints(e))}}class N extends g{constructor(s=[],e=36,t=!0){if(super(s,e,t),this.type="SplineCurveGeometry",!s.length){console.warn("SplineCurveGeometry path length at least 1.");return}const i=new n.CatmullRomCurve3(s);this.setFromPoints(t?i.getSpacedPoints(e):i.getPoints(e))}}class I extends n.ShapeBufferGeometry{constructor(s=[new n.Vector2(0,0)],e=12){const t=new n.Shape,i=s[0];if(i){t.moveTo(i.x,i.y);for(let r=1;r<s.length;r+=1)t.lineTo(s[r].x,s[r].y)}super(t,e),this.type="LineShapeGeometry"}}class O extends n.TubeGeometry{constructor(s=[],e=64,t=1,i=8,r=!1){if(!s.length){console.warn("LineTubeGeometry path length at least 1.");return}const l=new n.CurvePath;for(let h=1;h<s.length;h+=1)l.add(new n.LineCurve3(s[h-1],s[h]));super(l,e,t,i,r),this.type="LineTubeGeometry"}}class z extends n.TubeGeometry{constructor(s=[],e=64,t=1,i=8,r=!1){if(!s.length){console.warn("SplineTubeGeometry path length at least 1.");return}const l=new n.CatmullRomCurve3(s);super(l,e,t,i,r),this.type="SplineTubeGeometry"}}const F=function(a){return()=>a};o.CSS2DPlane=D,o.CSS3DPlane=V,o.CSS3DSprite=M,o.CubicBezierCurveGeometry=R,o.CurveGeometry=g,o.Engine=w,o.EventDispatcher=S,o.ImageTexture=G,o.LineCurveGeometry=j,o.LineShapeGeometry=I,o.LineTubeGeometry=O,o.LoadGeometry=A,o.LoadTexture=_,o.QuadraticBezierCurveGeometry=$,o.SplineCurveGeometry=N,o.SplineTubeGeometry=z,o.VideoTexture=T,o.VisCSS2DObject=v,o.VisCSS3DObject=C,o.VisCSS3DSprite=E,o.defineEngine=B,o.definePlugin=P,o.defineStrategy=F,Object.defineProperties(o,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
