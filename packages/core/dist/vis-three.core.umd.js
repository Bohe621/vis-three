(function(n,r){typeof exports=="object"&&typeof module!="undefined"?r(exports,require("three"),require("three/examples/jsm/lights/RectAreaLightUniformsLib.js"),require("three/src/lights/LightShadow")):typeof define=="function"&&define.amd?define(["exports","three","three/examples/jsm/lights/RectAreaLightUniformsLib.js","three/src/lights/LightShadow"],r):(n=typeof globalThis!="undefined"?globalThis:n||self,r((n["vis-three"]=n["vis-three"]||{},n["vis-three"].core={}),n.three,n.RectAreaLightUniformsLib_js,n.LightShadow))})(this,function(n,r,h,p){"use strict";var w=Object.defineProperty;var S=(n,r,h)=>r in n?w(n,r,{enumerable:!0,configurable:!0,writable:!0,value:h}):n[r]=h;var l=(n,r,h)=>(S(n,typeof r!="symbol"?r+"":r,h),h);const g="0.6.1";window.__THREE__||console.error("vis-three dependent on three.js module, pleace run 'npm i three' first."),window.__VIS__?console.warn("Duplicate vis-three frames are introduced"):window.__VIS__=g;const c=new p.LightShadow(new r.OrthographicCamera(-256,256,256,-256));c.autoUpdate=!1,c.needsUpdate=!1,r.AmbientLight.prototype.shadow=c,r.RectAreaLight.prototype.shadow=c,r.HemisphereLight.prototype.shadow=c,h.RectAreaLightUniformsLib.init();class u{constructor(){l(this,"listeners",new Map)}addEventListener(s,e){const t=this.listeners;t.has(s)||t.set(s,[]);const i=t.get(s);i.includes(e)||i.push(e)}hasEventListener(s,e){const t=this.listeners;return t.has(s)?t.get(s).includes(e):!1}removeEventListener(s,e){const t=this.listeners;if(!t.has(s)||!t.get(s).includes(e))return;const i=t.get(s);i.splice(i.indexOf(e),1)}removeEvent(s){const e=this.listeners;!e.has(s)||e.delete(s)}dispatchEvent(s){var i;const e=s.type,t=this.listeners;if(t.has(e))try{(i=t.get(e))==null||i.forEach(a=>{a.call(this,s)})}catch(a){console.error(a)}}once(s,e){const t=function(i){e.call(this,i),this.removeEventListener(s,t)};this.addEventListener(s,t)}emit(s,e={}){var i;const t=this.listeners;if(t.has(s))try{(i=t.get(s))==null||i.forEach(a=>{a.call(this,e)})}catch(a){console.error(a)}}on(s,e){this.addEventListener(s,e)}has(s,e){return this.hasEventListener(s,e)}off(s,e){if(e)this.removeEventListener(s,e);else{const t=this.listeners;if(!t.has(s))return;t.delete(s)}}eventCount(s){return this.listeners.has(s)?this.listeners.get(s).length:0}popLatestEvent(s){!this.listeners.has(s)||this.listeners.get(s).pop()}clear(){this.listeners.clear()}useful(){return Boolean([...this.listeners.keys()].length)}}var d=(o=>(o.SETDOM="setDom",o.SETSIZE="setSize",o.SETCAMERA="setCamera",o.SETSCENE="setScene",o.RENDER="render",o.DISPOSE="dispose",o))(d||{});class f extends u{constructor(){super();l(this,"pluginTables",new Map);l(this,"strategyTables",new Map);l(this,"dom",document.createElement("div"));l(this,"camera",new r.PerspectiveCamera);l(this,"scene",new r.Scene);this.camera.position.set(50,50,50),this.camera.lookAt(0,0,0)}install(e){if(this.pluginTables.has(e.name))return console.warn("This plugin already exists",e.name),this;const t=i=>this.pluginTables.has(i)?!0:(console.error(`${e.name} must install this plugin before: ${i}`),!1);if(e.deps)if(Array.isArray(e.deps))for(const i of e.deps)t(i);else t(e.deps);return e.install(this),this.pluginTables.set(e.name,e),this}uninstall(e){if(!this.pluginTables.has(e))return this;for(const i of this.strategyTables.values())i.condition.includes(e)&&(console.info(`engine auto rollback strategy: ${i.name} before uninstall plugin: ${e}.`),this.rollback(i.name));for(const i of this.pluginTables.values())i.deps&&(Array.isArray(i.deps)&&i.deps.includes(e)||i.deps===e)&&(console.info(`engine auto uninstall plugin: ${i.name} before uninstall plugin: ${e}.`),this.uninstall(i.name));return this.pluginTables.get(e).dispose(this),this.pluginTables.delete(e),this}exec(e){const t=this.strategyTables;if(t.has(e.name))return console.warn("This strategy already exists",e.name),this;const i=this.pluginTables;for(const a of e.condition)if(!i.has(a))return console.warn(`${e.name} does not meet the conditions for execution: ${a}`),this;return e.exec(this),t.set(e.name,e),this}rollback(e){const t=this.strategyTables;return t.has(e)?(t.get(e).rollback(this),t.delete(e),this):this}setDom(e){return this.dom=e,this.dispatchEvent({type:"setDom",dom:e}),this}setSize(e,t){var i,a;return e&&e<=0||t&&t<=0?(console.warn(`you must be input width and height bigger then zero, width: ${e}, height: ${t}`),this):(!e&&(e=((i=this.dom)==null?void 0:i.offsetWidth)||window.innerWidth),!t&&(t=((a=this.dom)==null?void 0:a.offsetHeight)||window.innerHeight),this.dispatchEvent({type:"setSize",width:e,height:t}),this)}setCamera(e,t){return this.dispatchEvent({type:"setCamera",camera:e,oldCamera:this.camera,options:Object.assign({orbitControls:!0,transformControls:!0},t||{})}),this.camera=e,this}setScene(e){return this.dispatchEvent({type:"setScene",scene:e,oldScene:this.scene}),this.scene=e,this}render(e){return this.dispatchEvent({type:"render",delta:e}),this}dispose(){return this.dispatchEvent({type:"dispose"}),this}}const m=function(o){const s=new f;return o.plugins&&o.plugins.forEach(e=>{s.install(e)}),o.strategy&&o.strategy.forEach(e=>{s.exec(e)}),s},v=function(o){return()=>o},b=function(o){return()=>o};n.ENGINE_EVENT=d,n.Engine=f,n.EventDispatcher=u,n.defineEngine=m,n.definePlugin=v,n.defineStrategy=b,Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
