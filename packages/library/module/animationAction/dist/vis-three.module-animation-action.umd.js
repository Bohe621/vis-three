(function(n,t){typeof exports=="object"&&typeof module!="undefined"?t(exports,require("@vis-three/middleware"),require("uuid"),require("three"),require("three/src/animation/AnimationAction"),require("@vis-three/utils")):typeof define=="function"&&define.amd?define(["exports","@vis-three/middleware","uuid","three","three/src/animation/AnimationAction","@vis-three/utils"],t):(n=typeof globalThis!="undefined"?globalThis:n||self,t((n["vis-three"]=n["vis-three"]||{},n["vis-three"]["module-animation-action"]={}),n.middleware,n.uuid,n.three,n.AnimationAction,n.utils))})(this,function(n,t,d,s,f,h){"use strict";class u extends t.Compiler{constructor(){super()}updateAction(i,o){const c=this.map.get(i);if(!c){console.warn(`Animation action compiler update action can not found oldAction by:${i}`);return}this.map.delete(i),this.weakMap.delete(c),t.Bus.compilerEvent.dispose(c),this.map.set(i,o),this.weakMap.set(o,i),t.Bus.compilerEvent.create(o),this.cacheCompile=void 0}}const y=function(e,i,o=d.validate){t.Rule(e,i,o)},p=function(){return Object.assign(t.getSymbolConfig(),{mixer:"",clip:"",clampWhenFinished:!0,enabled:!0,loop:s.LoopRepeat,paused:!1,repetitions:1/0,timeScale:1,weight:1,zeroSlopeAtEnd:!0,zeroSlopeAtStart:!0})},x=new s.Object3D,a=()=>new f.AnimationAction(new s.AnimationMixer(x),new s.AnimationClip("empty",1,[]));var C=t.defineProcessor({type:"AnimationAction",config:p,commands:{set:{clip({target:e,config:i,value:o,engine:c,compiler:r}){let m=e.getMixer();if(m.uncacheAction(e.getClip()),m=c.getObjectBySymbol(i.mixer),!m){console.warn(`animation action processor can not found animation mixer in engine: ${i.mixer}`);return}const l=c.getObjectBySymbol(o);l||console.warn(`animation action processor can not found animation clip in engine: ${o}`);const A=m.clipAction(l);A.play(),r.updateAction(i.vid,A)}}},create(e,i){if(!e.mixer)return console.warn("animation action processor must have mixer"),a();if(!e.clip)return a();const o=i.getObjectBySymbol(e.mixer);if(!o)return console.warn(`animation action processor can not found animation mixer in engine: ${e.mixer}`),a();const c=i.getObjectBySymbol(e.clip);if(!c)return console.warn(`animation action processor can not found animation clip in engine: ${e.clip}`),a();const r=o.clipAction(c);return h.syncObject(e,r,{clip:!0,mixer:!0}),r.play(),r},dispose(e){const i=e.getMixer();i.uncacheAction(e.getClip()),i.uncacheClip(e.getClip())}}),v={type:"animationAction",compiler:u,rule:y,processors:[C],lifeOrder:t.SUPPORT_LIFE_CYCLE.NINE+1};n.AnimationActionCompiler=u,n.default=v,n.getAnimationActionConfig=p,Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
