(function(n,t){typeof exports=="object"&&typeof module!="undefined"?t(exports,require("@vis-three/middleware"),require("uuid"),require("three"),require("three/src/animation/AnimationAction")):typeof define=="function"&&define.amd?define(["exports","@vis-three/middleware","uuid","three","three/src/animation/AnimationAction"],t):(n=typeof globalThis!="undefined"?globalThis:n||self,t((n["vis-three"]=n["vis-three"]||{},n["vis-three"]["module-animation-action"]={}),n.middleware,n.uuid,n.three,n.AnimationAction))})(this,function(n,t,d,r,f){"use strict";class p extends t.Compiler{constructor(){super()}updateAction(e,o){const c=this.map.get(e);if(!c){console.warn(`Animation action compiler update action can not found oldAction by:${e}`);return}this.map.delete(e),this.weakMap.delete(c),t.Bus.compilerEvent.dispose(c),this.map.set(e,o),this.weakMap.set(o,e),t.Bus.compilerEvent.create(o),this.cacheCompile=void 0}}const h=function(i,e,o=d.validate){t.Rule(i,e,o)},u=function(){return Object.assign(t.getSymbolConfig(),{mixer:"",clip:"",clampWhenFinished:!0,enabled:!0,loop:r.LoopRepeat,paused:!1,repetitions:1/0,timeScale:1,weight:1,zeroSlopeAtEnd:!0,zeroSlopeAtStart:!0})},y=new r.Object3D,a=()=>new f.AnimationAction(new r.AnimationMixer(y),new r.AnimationClip("empty",1,[]));var x=t.defineProcessor({type:"AnimationAction",config:u,commands:{set:{clip({target:i,config:e,value:o,engine:c,compiler:s}){let m=i.getMixer();if(m.uncacheAction(i.getClip()),m=c.getObjectBySymbol(e.mixer),!m){console.warn(`animation action processor can not found animation mixer in engine: ${e.mixer}`);return}const l=c.getObjectBySymbol(o);l||console.warn(`animation action processor can not found animation clip in engine: ${o}`);const A=m.clipAction(l);A.play(),s.updateAction(e.vid,A)}}},create(i,e){if(!i.mixer)return console.warn("animation action processor must have mixer"),a();if(!i.clip)return a();const o=e.getObjectBySymbol(i.mixer);if(!o)return console.warn(`animation action processor can not found animation mixer in engine: ${i.mixer}`),a();const c=e.getObjectBySymbol(i.clip);if(!c)return console.warn(`animation action processor can not found animation clip in engine: ${i.clip}`),a();const s=o.clipAction(c);return s.play(),s},dispose(i){const e=i.getMixer();e.uncacheAction(i.getClip()),e.uncacheClip(i.getClip())}}),C={type:"animationAction",compiler:p,rule:h,processors:[x],lifeOrder:t.SUPPORT_LIFE_CYCLE.NINE+1};n.AnimationActionCompiler=p,n.default=C,n.getAnimationActionConfig=u,Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
