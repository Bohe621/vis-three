(function(s,a){typeof exports=="object"&&typeof module!="undefined"?module.exports=a(require("@vis-three/middleware"),require("@vis-three/module-object"),require("three")):typeof define=="function"&&define.amd?define(["@vis-three/middleware","@vis-three/module-object","three"],a):(s=typeof globalThis!="undefined"?globalThis:s||self,s["vis-three"]=s["vis-three"]||{},s["vis-three"]["module-camera"]=a(s.middleware,s.moduleObject,s.three))})(this,function(s,a,c){"use strict";var g=Object.defineProperty;var j=(s,a,c)=>a in s?g(s,a,{enumerable:!0,configurable:!0,writable:!0,value:c}):s[a]=c;var p=(s,a,c)=>(j(s,typeof a!="symbol"?a+"":a,c),c);class f extends a.ObjectCompiler{constructor(){super();p(this,"cacheCameraMap",new WeakMap)}}function m(e){e.setCameraBySymbol=function(t){const o=this.compilerManager.getCompiler(s.MODULETYPE.CAMERA);return o.map.has(t)?this.setCamera(o.map.get(t)):console.warn("can not found camera",t),this}}const C=function(e,t){a.ObjectRule(e,t)},u=function(){return Object.assign(a.getObjectConfig(),{adaptiveWindow:!1,fov:45,aspect:1920/1080,near:5,far:50})},w=function(){return Object.assign(a.getObjectConfig(),{adaptiveWindow:!1,left:-window.innerWidth,right:window.innerWidth,top:window.innerHeight,bottom:-window.innerHeight,near:5,far:50,zoom:1})};var v=s.defineProcessor({type:"OrthographicCamera",config:w,commands:{add:{scale(){},...a.objectCommands.add},set:{scale(){},adaptiveWindow({target:e,value:t,engine:o,compiler:i}){if(t){if(!i.cacheCameraMap.has(t)){const r=n=>{const d=n.width,h=n.height;e.left=-d,e.right=d,e.top=h,e.bottom=-h,e.updateProjectionMatrix()};i.cacheCameraMap.set(e,r),o.addEventListener("setSize",r),r({type:"setSize",width:o.dom.offsetWidth,height:o.dom.offsetHeight})}}else{const r=i.cacheCameraMap.get(e);r&&(o.removeEventListener("setSize",r),i.cacheCameraMap.delete(e))}},...a.objectCommands.set,$reg:[{reg:new RegExp("left|right|top|bottom|near|far|zoom"),handler({target:e,key:t,value:o}){e[t]=o,e.updateProjectionMatrix()}}]},delete:{scale(){},...a.objectCommands.delete}},create(e,t,o){const i=new c.OrthographicCamera(-50,50,50,-50);if(a.objectCreate(i,e,{scale:!0,adaptiveWindow:!0},t),i.updateProjectionMatrix(),e.adaptiveWindow){const r=n=>{const d=n.width,h=n.height;i.left=-d,i.right=d,i.top=h,i.bottom=-h,i.updateProjectionMatrix()};o.cacheCameraMap.set(i,r),t.addEventListener("setSize",r),r({type:"setSize",width:t.dom.offsetWidth,height:t.dom.offsetHeight})}return i},dispose(e,t,o){o.cacheCameraMap.delete(e),a.objectDispose(e)}}),M=s.defineProcessor({type:"PerspectiveCamera",config:u,commands:{add:{scale(){},...a.objectCommands.add},set:{scale(){},adaptiveWindow({target:e,value:t,engine:o,compiler:i}){if(t){if(!i.cacheCameraMap.has(t)){const r=n=>{e.aspect=n.width/n.height,e.updateProjectionMatrix()};i.cacheCameraMap.set(e,r),o.addEventListener("setSize",r),r({type:"setSize",width:o.dom.offsetWidth,height:o.dom.offsetHeight})}}else{const r=i.cacheCameraMap.get(e);r&&(o.removeEventListener("setSize",r),i.cacheCameraMap.delete(e))}},...a.objectCommands.set,$reg:[{reg:new RegExp("fov|aspect|near|far"),handler({target:e,key:t,value:o}){e[t]=o,e.updateProjectionMatrix()}}]},delete:{scale(){},...a.objectCommands.delete}},create(e,t,o){const i=new c.PerspectiveCamera;if(a.objectCreate(i,e,{scale:!0,adaptiveWindow:!0},t),i.updateProjectionMatrix(),e.adaptiveWindow){const r=n=>{i.aspect=n.width/n.height,i.updateProjectionMatrix()};o.cacheCameraMap.set(i,r),t.addEventListener("setSize",r),r({type:"setSize",width:t.dom.offsetWidth,height:t.dom.offsetHeight})}return i},dispose(e,t,o){o.cacheCameraMap.delete(e),a.objectDispose(e)}}),P={type:"camera",object:!0,compiler:f,rule:C,processors:[v,M],extend:m,lifeOrder:s.SUPPORT_LIFE_CYCLE.THREE};return P});
