(function(n,i){typeof exports=="object"&&typeof module<"u"?module.exports=i(require("@vis-three/tdcm"),require("@vis-three/library-constraintor")):typeof define=="function"&&define.amd?define(["@vis-three/tdcm","@vis-three/library-constraintor"],i):(n=typeof globalThis<"u"?globalThis:n||self,n["vis-three"]=n["vis-three"]||{},n["vis-three"]["module-constraintor"]=i(n.tdcm,n.libraryConstraintor))})(this,function(n,i){"use strict";const f=function(){return Object.assign(n.getBasicConfig(),{target:""})},M=function(){return Object.assign(f(),{target:"",targetAttr:"",ref:"",refAttr:"",offset:null})},A=function(){return Object.assign(f(),{targetAttr:"",ref:"",space:"world",offset:{position:{direction:"+",axes:"y"},operate:"+",value:0}})},E={reg:new RegExp(".*"),handler(e){e.processor.set(e),e.target.constrain()}},D=n.defineModel({type:"NumberConstraintor",config:M,context({model:e}){return{constrainFun:()=>{e.puppet.constrain()}}},commands:{set:{target({target:e,config:t,engine:r}){t.target&&t.targetAttr&&(e.setTarget(r.getConfigBySymbol(t.target),t.targetAttr),e.constrain())},targetAttr({target:e,config:t,engine:r}){t.target&&t.targetAttr&&(e.setTarget(r.getConfigBySymbol(t.target),t.targetAttr),e.constrain())},ref({target:e,config:t,engine:r,model:o}){var s,a;t.ref&&t.refAttr&&((s=o.toModel(t.ref))==null||s.off(n.MODEL_EVENT.COMPILED_UPDATE,o.constrainFun),e.setReference(r.getConfigBySymbol(t.ref),t.refAttr),(a=o.toModel(t.ref))==null||a.on(n.MODEL_EVENT.COMPILED_UPDATE,o.constrainFun))},refAttr({target:e,config:t,engine:r,model:o}){var s,a;t.ref&&t.refAttr&&((s=o.toModel(t.ref))==null||s.off(n.MODEL_EVENT.COMPILED_UPDATE,o.constrainFun),e.setReference(r.getConfigBySymbol(t.ref),t.refAttr),(a=o.toModel(t.ref))==null||a.on(n.MODEL_EVENT.COMPILED_UPDATE,o.constrainFun))},$reg:[E]}},create({model:e,config:t,engine:r}){var s;const o=new i.NumberConstraintor(r.getConfigBySymbol(t.target),t.targetAttr,r.getConfigBySymbol(t.ref),t.refAttr,t.offset?{...t.offset}:null);return(s=e.toModel(t.ref))==null||s.on(n.MODEL_EVENT.COMPILED_UPDATE,e.constrainFun),o},dispose({model:e,config:t}){var r;(r=e.toModel(t.ref))==null||r.off(n.MODEL_EVENT.COMPILED_UPDATE,e.constrainFun)}}),O=n.defineModel({type:"BoundingBoxConstraintor",config:A,context({model:e}){return{constrainFun:()=>{e.puppet.constrain()}}},commands:{set:{target({target:e,config:t,engine:r}){t.target&&t.targetAttr&&(e.setTarget(r.getConfigBySymbol(t.target),t.targetAttr),e.constrain())},targetAttr({target:e,config:t,engine:r}){t.target&&t.targetAttr&&(e.setTarget(r.getConfigBySymbol(t.target),t.targetAttr),e.constrain())},ref({model:e,target:t,config:r,engine:o,value:s}){var u,C;if((u=e.toModel(r.ref))==null||u.off(n.MODEL_EVENT.COMPILED_UPDATE,e.constrainFun),!s)return;const a=o.getObjectBySymbol(r.ref);if(!a){console.warn(`BoundingBox constraintor processor: can not found object: ${r.ref}`);return}t.setReference(a),t.constrain(),(C=e.toModel(r.ref))==null||C.on(n.MODEL_EVENT.COMPILED_UPDATE,e.constrainFun)},$reg:[E]}},create({model:e,config:t,engine:r}){var a;const o=e.toObject(t.ref),s=new i.BoundingBoxConstraintor(e.toConfig(t.target),t.targetAttr,t.space,o,n.JSONHandler.clone(t.offset));return o&&(s.constrain(),(a=e.toModel(t.ref))==null||a.on(n.MODEL_EVENT.COMPILED_UPDATE,e.constrainFun)),s},dispose({model:e,config:t}){var r;(r=e.toModel(t.ref))==null||r.off(n.MODEL_EVENT.COMPILED_UPDATE,e.constrainFun)}});return n.defineModule({type:"constraintor",models:[D,O],lifeOrder:n.SUPPORT_LIFE_CYCLE.NINE})});
