(function(t,r){typeof exports=="object"&&typeof module!="undefined"?r(exports,require("@vis-three/middleware"),require("@vis-three/module-object"),require("three"),require("three/examples/jsm/renderers/CSS2DRenderer")):typeof define=="function"&&define.amd?define(["exports","@vis-three/middleware","@vis-three/module-object","three","three/examples/jsm/renderers/CSS2DRenderer"],r):(t=typeof globalThis!="undefined"?globalThis:t||self,r((t["vis-three"]=t["vis-three"]||{},t["vis-three"]["module-css2d"]={}),t.middleware,t.moduleObject,t.three,t.CSS2DRenderer))})(this,function(t,r,n,o,g){"use strict";var P=Object.defineProperty;var D=(t,r,n)=>r in t?P(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n;var s=(t,r,n)=>(D(t,typeof r!="symbol"?r+"":r,n),n);class m extends n.ObjectCompiler{constructor(){super()}}const u=function(){return Object.assign(n.getObjectConfig(),{element:"",width:50,height:50})},p=function(){return Object.assign(u(),{})};class v extends g.CSS2DObject{constructor(e=document.createElement("div")){const c=document.createElement("div"),d=50,h=50;c.style.width=`${d}px`,c.style.height=`${h}px`,c.appendChild(e);super(c);s(this,"geometry");s(this,"_width");s(this,"_height");this.geometry=new o.PlaneBufferGeometry(d,h),this.geometry.computeBoundingBox(),this._width=d,this._height=h}get width(){return this._width}set width(e){this.geometry.dispose(),this.geometry=new o.PlaneBufferGeometry(e,this._height),this.geometry.computeBoundingBox(),this.element.style.width=`${e}px`,this._width=e}get height(){return this._height}set height(e){this.geometry.dispose(),this.geometry=new o.PlaneBufferGeometry(this._width,e),this.geometry.computeBoundingBox(),this.element.style.height=`${e}px`,this._height=e}}class C extends v{constructor(e=document.createElement("div")){super(e);s(this,"cacheBox",new o.Box3);s(this,"viewWorldMatrix",new o.Matrix4);s(this,"mvPosition",new o.Vector3);s(this,"matrixScale",new o.Vector3);s(this,"worldScale",new o.Vector3);s(this,"vA",new o.Vector3);s(this,"vB",new o.Vector3);s(this,"vC",new o.Vector3);s(this,"alignedPosition",new o.Vector2);s(this,"rotatedPosition",new o.Vector2);s(this,"intersectPoint",new o.Vector3);this.type="CSS2DPlane",this.element.classList.add("vis-css2d","vis-css2d-plane"),new MutationObserver(()=>{this.matrixScale.set(Math.abs(this.width/100)*.1,Math.abs(this.height/100)*.1,1)}).observe(this.element,{attributeFilter:["style"]})}transformVertex(e,c,d){const h=this.alignedPosition,l=this.rotatedPosition,f=0,w=1;h.copy(e).multiply(d),l.x=w*h.x-f*h.y,l.y=f*h.x+w*h.y,e.copy(c),e.x+=l.x,e.y+=l.y,e.applyMatrix4(this.viewWorldMatrix)}raycast(e,c){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),this.viewWorldMatrix.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),this.mvPosition.setFromMatrixPosition(this.modelViewMatrix),this.worldScale.copy(this.matrixScale).multiplyScalar(-this.mvPosition.z),this.transformVertex(this.vA.set(-.5,-.5,0),this.mvPosition,this.worldScale),this.transformVertex(this.vB.set(.5,-.5,0),this.mvPosition,this.worldScale),this.transformVertex(this.vC.set(.5,.5,0),this.mvPosition,this.worldScale);let d=e.ray.intersectTriangle(this.vA,this.vB,this.vC,!1,this.intersectPoint);if(d===null&&(this.transformVertex(this.vB.set(-.5,.5,0),this.mvPosition,this.worldScale),d=e.ray.intersectTriangle(this.vA,this.vC,this.vB,!1,this.intersectPoint),d===null))return;const h=e.ray.origin.distanceTo(this.intersectPoint);h<e.near||h>e.far||c.push({distance:h,point:this.intersectPoint.clone(),face:null,object:this})}}const S=function(i,a){const e=a.resourceManager.resourceMap;if(!e.has(i))return console.warn(`css2D compiler: can not found resource element: ${i}`),document.createElement("div");const c=e.get(i);return c instanceof HTMLElement?c:(console.warn("css2D compiler can not suport render this resource type.",c.constructor,i),document.createElement("div"))};var y=r.defineProcessor({type:"CSS2DPlane",config:p,commands:{add:n.objectCommands.add,set:{element({target:i,value:a,engine:e}){i.element.innerHTML="",i.element.appendChild(S(a,e))},...n.objectCommands.set},delete:n.objectCommands.delete},create(i,a){return n.objectCreate(new C(S(i.element,a)),i,{element:!0},a)},dispose:n.objectDispose}),x={type:"css2D",object:!0,compiler:m,rule:function(i,a){n.ObjectRule(i,a)},processors:[y],lifeOrder:r.SUPPORT_LIFE_CYCLE.THREE};t.CSS2DCompiler=m,t.default=x,t.getCSS2DObjectConfig=u,t.getCSS2DPlaneConfig=p,Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
