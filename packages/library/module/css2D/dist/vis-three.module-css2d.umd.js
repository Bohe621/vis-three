(function(n,o){typeof exports=="object"&&typeof module<"u"?o(exports,require("@vis-three/tdcm"),require("@vis-three/module-object"),require("three"),require("three/examples/jsm/renderers/CSS2DRenderer.js")):typeof define=="function"&&define.amd?define(["exports","@vis-three/tdcm","@vis-three/module-object","three","three/examples/jsm/renderers/CSS2DRenderer.js"],o):(n=typeof globalThis<"u"?globalThis:n||self,o((n["vis-three"]=n["vis-three"]||{},n["vis-three"]["module-css2d"]={}),n.tdcm,n.moduleObject,n.three,n.CSS2DRenderer_js))})(this,function(n,o,d,r,p){"use strict";const l=function(){return Object.assign(d.getObjectConfig(),{element:"",width:50,height:50})},a=function(){return Object.assign(l(),{})};class g extends p.CSS2DObject{constructor(e=document.createElement("div")){const i=document.createElement("div"),s=50,t=50;i.style.width=`${s}px`,i.style.height=`${t}px`,i.appendChild(e),super(i),this.geometry=new r.PlaneGeometry(s,t),this.geometry.computeBoundingBox(),this._width=s,this._height=t}get width(){return this._width}set width(e){this.geometry.dispose(),this.geometry=new r.PlaneGeometry(e,this._height),this.geometry.computeBoundingBox(),this.element.style.width=`${e}px`,this._width=e}get height(){return this._height}set height(e){this.geometry.dispose(),this.geometry=new r.PlaneGeometry(this._width,e),this.geometry.computeBoundingBox(),this.element.style.height=`${e}px`,this._height=e}}class f extends g{constructor(e=document.createElement("div")){super(e),this.cacheBox=new r.Box3,this.viewWorldMatrix=new r.Matrix4,this.mvPosition=new r.Vector3,this.matrixScale=new r.Vector3,this.worldScale=new r.Vector3,this.vA=new r.Vector3,this.vB=new r.Vector3,this.vC=new r.Vector3,this.alignedPosition=new r.Vector2,this.rotatedPosition=new r.Vector2,this.intersectPoint=new r.Vector3,this.type="CSS2DPlane",this.element.classList.add("vis-css2d","vis-css2d-plane"),new MutationObserver(()=>{this.matrixScale.set(Math.abs(this.width/100)*.1,Math.abs(this.height/100)*.1,1)}).observe(this.element,{attributeFilter:["style"]})}transformVertex(e,i,s){const t=this.alignedPosition,h=this.rotatedPosition,m=0,u=1;t.copy(e).multiply(s),h.x=u*t.x-m*t.y,h.y=m*t.x+u*t.y,e.copy(i),e.x+=h.x,e.y+=h.y,e.applyMatrix4(this.viewWorldMatrix)}raycast(e,i){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),this.viewWorldMatrix.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),this.mvPosition.setFromMatrixPosition(this.modelViewMatrix),this.worldScale.copy(this.matrixScale).multiplyScalar(-this.mvPosition.z),this.transformVertex(this.vA.set(-.5,-.5,0),this.mvPosition,this.worldScale),this.transformVertex(this.vB.set(.5,-.5,0),this.mvPosition,this.worldScale),this.transformVertex(this.vC.set(.5,.5,0),this.mvPosition,this.worldScale);let s=e.ray.intersectTriangle(this.vA,this.vB,this.vC,!1,this.intersectPoint);if(s===null&&(this.transformVertex(this.vB.set(-.5,.5,0),this.mvPosition,this.worldScale),s=e.ray.intersectTriangle(this.vA,this.vC,this.vB,!1,this.intersectPoint),s===null))return;const t=e.ray.origin.distanceTo(this.intersectPoint);t<e.near||t>e.far||i.push({distance:t,point:this.intersectPoint.clone(),face:null,object:this})}}const w=o.defineModule({type:"css2D",object:!0,rule:d.ObjectRule,models:[d.defineObjectModel(c=>({type:"CSS2DPlane",config:a,shared:{getElement(e,i){const s=i.resourceManager.resourceMap;if(!s.has(e))return console.warn(`css2D compiler: can not found resource element: ${e}`),document.createElement("div");const t=s.get(e);return t instanceof HTMLElement?t:(console.warn("css2D compiler can not suport render this resource type.",t.constructor,e),document.createElement("div"))}},commands:{set:{element({model:e,target:i,value:s,engine:t}){i.element.innerHTML="",i.element.appendChild(e.getElement(s,t))}}},create({model:e,config:i,engine:s}){const t=new f(e.getElement(i.element,s));return c.create({model:e,target:t,config:i,filter:{element:!0},engine:s}),t},dispose({target:e}){c.dispose({target:e})}}))],lifeOrder:o.SUPPORT_LIFE_CYCLE.THREE});n.default=w,n.getCSS2DObjectConfig=l,n.getCSS2DPlaneConfig=a,Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
