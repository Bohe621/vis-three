(function(t,r){typeof exports=="object"&&typeof module!="undefined"?module.exports=r(require("@vis-three/module-object"),require("@vis-three/middleware"),require("three"),require("three/examples/jsm/renderers/CSS3DRenderer")):typeof define=="function"&&define.amd?define(["@vis-three/module-object","@vis-three/middleware","three","three/examples/jsm/renderers/CSS3DRenderer"],r):(t=typeof globalThis!="undefined"?globalThis:t||self,t["vis-three"]=t["vis-three"]||{},t["vis-three"]["module-css3d"]=r(t.moduleObject,t.middleware,t.three,t.CSS3DRenderer))})(this,function(t,r,o,m){"use strict";var _=Object.defineProperty;var j=(t,r,o)=>r in t?_(t,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[r]=o;var c=(t,r,o)=>(j(t,typeof r!="symbol"?r+"":r,o),o);class u extends t.ObjectCompiler{constructor(){super()}}const l=function(s,i){t.ObjectRule(s,i)},p=function(){return Object.assign(t.getObjectConfig(),{element:"",width:50,height:50})},g=function(){return Object.assign(p(),{})},S=function(){return Object.assign(p(),{rotation2D:0})},a=function(s,i){const e=i.resourceManager.resourceMap;if(!e.has(s))return console.warn(`css3D compiler: can not found resource element: ${s}`),document.createElement("div");const n=e.get(s);return n instanceof HTMLElement?n:(console.warn("css3D compiler can not suport render this resource type.",n.constructor,s),document.createElement("div"))};class y extends m.CSS3DObject{constructor(e=document.createElement("div")){const n=document.createElement("div"),h=50,d=50;n.style.width=`${h}px`,n.style.height=`${d}px`,n.appendChild(e);super(n);c(this,"geometry");c(this,"_width");c(this,"_height");this.geometry=new o.PlaneBufferGeometry(h,d),this.geometry.computeBoundingBox(),this._width=h,this._height=d}get width(){return this._width}set width(e){this.geometry.dispose(),this.geometry=new o.PlaneBufferGeometry(e,this._height),this.geometry.computeBoundingBox(),this.element.style.width=`${e}px`,this._width=e}get height(){return this._height}set height(e){this.geometry.dispose(),this.geometry=new o.PlaneBufferGeometry(this._width,e),this.geometry.computeBoundingBox(),this.element.style.height=`${e}px`,this._height=e}}class x extends y{constructor(e=document.createElement("div")){super(e);c(this,"cacheBox",new o.Box3);this.type="CSS3DPlane",this.element.classList.add("vis-css3d","vis-css3d-plane")}raycast(e,n){const h=this.cacheBox.copy(this.geometry.boundingBox);h.applyMatrix4(this.matrixWorld),e.ray.intersectsBox(h)&&n.push({distance:e.ray.origin.distanceTo(this.position),object:this,point:this.position})}}var C=r.defineProcessor({type:"CSS3DPlane",config:g,commands:{add:t.objectCommands.add,set:{element({target:s,value:i,engine:e}){s.element.innerHTML="",s.element.appendChild(a(i,e))},...t.objectCommands.set},delete:t.objectCommands.delete},create(s,i){return t.objectCreate(new x(a(s.element,i)),s,{element:!0},i)},dispose:t.objectDispose}),f=r.defineProcessor({type:"CSS3DObject",config:p,commands:{add:t.objectCommands.add,set:{element({target:s,value:i,engine:e}){s.element=a(i,e)},...t.objectCommands.set},delete:t.objectCommands.delete},create(s,i){return t.objectCreate(new m.CSS3DObject(a(s.element,i)),s,{element:!0},i)},dispose:t.objectDispose});class w extends m.CSS3DSprite{constructor(e=document.createElement("div")){const n=document.createElement("div"),h=50,d=50;n.style.width=`${h}px`,n.style.height=`${d}px`,n.appendChild(e),e.classList.add("vis-css3d","vis-css3d-sprite");super(n);c(this,"geometry");c(this,"_width");c(this,"_height");c(this,"cacheBox",new o.Box3);c(this,"cachePosition",new o.Vector3);c(this,"cacheQuaternion",new o.Quaternion);c(this,"cacheScale",new o.Vector3);c(this,"cacheMatrix4",new o.Matrix4);c(this,"rotateMatrix4",new o.Matrix4);this.geometry=new o.PlaneBufferGeometry(h,d),this.geometry.computeBoundingBox(),this._width=h,this._height=d,this.type="CSS3DSprite"}get width(){return this._width}set width(e){this.geometry.dispose(),this.geometry=new o.PlaneBufferGeometry(e,this._height),this.geometry.computeBoundingBox(),this.element.style.width=`${e}px`,this._width=e}get height(){return this._height}set height(e){this.geometry.dispose(),this.geometry=new o.PlaneBufferGeometry(this._width,e),this.geometry.computeBoundingBox(),this.element.style.height=`${e}px`,this._height=e}raycast(e,n){const h=this.cacheBox.copy(this.geometry.boundingBox);this.matrixWorld.decompose(this.cachePosition,this.cacheQuaternion,this.cacheScale);const d=this.rotateMatrix4.lookAt(this.position,e.camera.position,this.up);this.cacheQuaternion.setFromRotationMatrix(d),this.cacheMatrix4.compose(this.cachePosition,this.cacheQuaternion,this.cacheScale),h.applyMatrix4(this.cacheMatrix4),e.ray.intersectsBox(h)&&n.push({distance:e.ray.origin.distanceTo(this.position),object:this,point:this.position})}}class D extends w{constructor(i=document.createElement("div")){super(i),this.type="CSS3DSprite",this.element.classList.add("vis-css3d","vis-css3d-plane")}}var B=r.defineProcessor({type:"CSS3DSprite",config:S,commands:{add:t.objectCommands.add,set:{element({target:s,value:i,engine:e}){s.element.innerHTML="",s.element.appendChild(a(i,e))},...t.objectCommands.set},delete:t.objectCommands.delete},create(s,i){return t.objectCreate(new D(a(s.element,i)),s,{element:!0},i)},dispose:t.objectDispose}),P={type:"css3D",object:!0,compiler:u,rule:l,processors:[C,f,B],lifeOrder:r.SUPPORT_LIFE_CYCLE.THREE};return P});
