(function(n,c){typeof exports=="object"&&typeof module<"u"?c(exports,require("@vis-three/tdcm"),require("@vis-three/module-object"),require("three"),require("three/examples/jsm/renderers/CSS3DRenderer.js")):typeof define=="function"&&define.amd?define(["exports","@vis-three/tdcm","@vis-three/module-object","three","three/examples/jsm/renderers/CSS3DRenderer.js"],c):(n=typeof globalThis<"u"?globalThis:n||self,c((n["vis-three"]=n["vis-three"]||{},n["vis-three"]["module-css3d"]={}),n.tdcm,n.moduleObject,n.three,n.CSS3DRenderer_js))})(this,function(n,c,h,o,a){"use strict";const d=function(){return Object.assign(h.getObjectConfig(),{element:"",width:50,height:50})},m=function(){return Object.assign(d(),{})},u=function(){return Object.assign(d(),{rotation2D:0})};class p extends a.CSS3DObject{constructor(e=document.createElement("div")){const t=document.createElement("div"),i=50,s=50;t.style.width=`${i}px`,t.style.height=`${s}px`,t.appendChild(e),super(t),this.geometry=new o.PlaneGeometry(i,s),this.geometry.computeBoundingBox(),this._width=i,this._height=s}get width(){return this._width}set width(e){this.geometry.dispose(),this.geometry=new o.PlaneGeometry(e,this._height),this.geometry.computeBoundingBox(),this.element.style.width=`${e}px`,this._width=e}get height(){return this._height}set height(e){this.geometry.dispose(),this.geometry=new o.PlaneGeometry(this._width,e),this.geometry.computeBoundingBox(),this.element.style.height=`${e}px`,this._height=e}}class l extends p{constructor(e=document.createElement("div")){super(e),this.cacheBox=new o.Box3,this.type="CSS3DPlane",this.element.classList.add("vis-css3d","vis-css3d-plane")}raycast(e,t){const i=this.cacheBox.copy(this.geometry.boundingBox);i.applyMatrix4(this.matrixWorld),e.ray.intersectsBox(i)&&t.push({distance:e.ray.origin.distanceTo(this.position),object:this,point:this.position})}}const g=h.defineObjectModel(r=>({type:"CSS3DPlane",config:m,shared:{getElement(e,t){const i=t.resourceManager.resourceMap;if(!i.has(e))return console.warn(`css3D compiler: can not found resource element: ${e}`),document.createElement("div");const s=i.get(e);return s instanceof HTMLElement?s:(console.warn("css3D compiler can not suport render this resource type.",s.constructor,e),document.createElement("div"))}},commands:{set:{element({model:e,target:t,value:i,engine:s}){t.element.innerHTML="",t.element.appendChild(e.getElement(i,s))}}},create({model:e,config:t,engine:i}){const s=new l(e.getElement(t.element,i));return r.create({model:e,target:s,config:t,filter:{element:!0},engine:i}),s},dispose({target:e}){r.dispose({target:e})}}));class S extends a.CSS3DSprite{constructor(e=document.createElement("div")){const t=document.createElement("div"),i=50,s=50;t.style.width=`${i}px`,t.style.height=`${s}px`,t.appendChild(e),e.classList.add("vis-css3d","vis-css3d-sprite"),super(t),this.cacheBox=new o.Box3,this.cachePosition=new o.Vector3,this.cacheQuaternion=new o.Quaternion,this.cacheScale=new o.Vector3,this.cacheMatrix4=new o.Matrix4,this.rotateMatrix4=new o.Matrix4,this.geometry=new o.PlaneGeometry(i,s),this.geometry.computeBoundingBox(),this._width=i,this._height=s,this.type="CSS3DSprite"}get width(){return this._width}set width(e){this.geometry.dispose(),this.geometry=new o.PlaneGeometry(e,this._height),this.geometry.computeBoundingBox(),this.element.style.width=`${e}px`,this._width=e}get height(){return this._height}set height(e){this.geometry.dispose(),this.geometry=new o.PlaneGeometry(this._width,e),this.geometry.computeBoundingBox(),this.element.style.height=`${e}px`,this._height=e}raycast(e,t){const i=this.cacheBox.copy(this.geometry.boundingBox);this.matrixWorld.decompose(this.cachePosition,this.cacheQuaternion,this.cacheScale);const s=this.rotateMatrix4.lookAt(this.position,e.camera.position,this.up);this.cacheQuaternion.setFromRotationMatrix(s),this.cacheMatrix4.compose(this.cachePosition,this.cacheQuaternion,this.cacheScale),i.applyMatrix4(this.cacheMatrix4),e.ray.intersectsBox(i)&&t.push({distance:e.ray.origin.distanceTo(this.position),object:this,point:this.position})}}class y extends S{constructor(e=document.createElement("div")){super(e),this.type="CSS3DSprite",this.element.classList.add("vis-css3d","vis-css3d-plane")}}const x=h.defineObjectModel(r=>({type:"CSS3DSprite",config:u,shared:{getElement(e,t){const i=t.resourceManager.resourceMap;if(!i.has(e))return console.warn(`css3D compiler: can not found resource element: ${e}`),document.createElement("div");const s=i.get(e);return s instanceof HTMLElement?s:(console.warn("css3D compiler can not suport render this resource type.",s.constructor,e),document.createElement("div"))}},commands:{set:{element({model:e,target:t,value:i,engine:s}){t.element.innerHTML="",t.element.appendChild(e.getElement(i,s))}}},create({model:e,config:t,engine:i}){const s=new y(e.getElement(t.element,i));return r.create({model:e,target:s,config:t,filter:{element:!0},engine:i}),s},dispose({target:e}){r.dispose({target:e})}})),f=c.defineModule({type:"css3D",object:!0,rule:h.ObjectRule,models:[g,x],lifeOrder:c.SUPPORT_LIFE_CYCLE.THREE});n.default=f,n.getCSS3DObjectConfig=d,n.getCSS3DPlaneConfig=m,n.getCSS3DSpriteConfig=u,Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
