(function(o,t){typeof exports=="object"&&typeof module!="undefined"?t(exports,require("@vis-three/module-object"),require("@vis-three/middleware"),require("three"),require("three/examples/jsm/renderers/CSS3DRenderer")):typeof define=="function"&&define.amd?define(["exports","@vis-three/module-object","@vis-three/middleware","three","three/examples/jsm/renderers/CSS3DRenderer"],t):(o=typeof globalThis!="undefined"?globalThis:o||self,t((o["vis-three"]=o["vis-three"]||{},o["vis-three"]["module-css3d"]={}),o.moduleObject,o.middleware,o.three,o.CSS3DRenderer))})(this,function(o,t,d,c,u){"use strict";var j=Object.defineProperty;var v=(o,t,d)=>t in o?j(o,t,{enumerable:!0,configurable:!0,writable:!0,value:d}):o[t]=d;var r=(o,t,d)=>(v(o,typeof t!="symbol"?t+"":t,d),d);class S extends t.ObjectCompiler{constructor(){super()}}const C=function(s,i){t.ObjectRule(s,i)},p=function(){return Object.assign(t.getObjectConfig(),{element:"",width:50,height:50})},g=function(){return Object.assign(p(),{})},l=function(){return Object.assign(p(),{rotation2D:0})},m=function(s,i){const e=i.resourceManager.resourceMap;if(!e.has(s))return console.warn(`css3D compiler: can not found resource element: ${s}`),document.createElement("div");const n=e.get(s);return n instanceof HTMLElement?n:(console.warn("css3D compiler can not suport render this resource type.",n.constructor,s),document.createElement("div"))};class y extends u.CSS3DObject{constructor(e=document.createElement("div")){const n=document.createElement("div"),h=50,a=50;n.style.width=`${h}px`,n.style.height=`${a}px`,n.appendChild(e);super(n);r(this,"geometry");r(this,"_width");r(this,"_height");this.geometry=new c.PlaneBufferGeometry(h,a),this.geometry.computeBoundingBox(),this._width=h,this._height=a}get width(){return this._width}set width(e){this.geometry.dispose(),this.geometry=new c.PlaneBufferGeometry(e,this._height),this.geometry.computeBoundingBox(),this.element.style.width=`${e}px`,this._width=e}get height(){return this._height}set height(e){this.geometry.dispose(),this.geometry=new c.PlaneBufferGeometry(this._width,e),this.geometry.computeBoundingBox(),this.element.style.height=`${e}px`,this._height=e}}class f extends y{constructor(e=document.createElement("div")){super(e);r(this,"cacheBox",new c.Box3);this.type="CSS3DPlane",this.element.classList.add("vis-css3d","vis-css3d-plane")}raycast(e,n){const h=this.cacheBox.copy(this.geometry.boundingBox);h.applyMatrix4(this.matrixWorld),e.ray.intersectsBox(h)&&n.push({distance:e.ray.origin.distanceTo(this.position),object:this,point:this.position})}}var x=d.defineProcessor({type:"CSS3DPlane",config:g,commands:{add:t.objectCommands.add,set:{element({target:s,value:i,engine:e}){s.element.innerHTML="",s.element.appendChild(m(i,e))},...t.objectCommands.set},delete:t.objectCommands.delete},create(s,i){return t.objectCreate(new f(m(s.element,i)),s,{element:!0},i)},dispose:t.objectDispose}),w=d.defineProcessor({type:"CSS3DObject",config:p,commands:{add:t.objectCommands.add,set:{element({target:s,value:i,engine:e}){s.element=m(i,e)},...t.objectCommands.set},delete:t.objectCommands.delete},create(s,i){return t.objectCreate(new u.CSS3DObject(m(s.element,i)),s,{element:!0},i)},dispose:t.objectDispose});class D extends u.CSS3DSprite{constructor(e=document.createElement("div")){const n=document.createElement("div"),h=50,a=50;n.style.width=`${h}px`,n.style.height=`${a}px`,n.appendChild(e),e.classList.add("vis-css3d","vis-css3d-sprite");super(n);r(this,"geometry");r(this,"_width");r(this,"_height");r(this,"cacheBox",new c.Box3);r(this,"cachePosition",new c.Vector3);r(this,"cacheQuaternion",new c.Quaternion);r(this,"cacheScale",new c.Vector3);r(this,"cacheMatrix4",new c.Matrix4);r(this,"rotateMatrix4",new c.Matrix4);this.geometry=new c.PlaneBufferGeometry(h,a),this.geometry.computeBoundingBox(),this._width=h,this._height=a,this.type="CSS3DSprite"}get width(){return this._width}set width(e){this.geometry.dispose(),this.geometry=new c.PlaneBufferGeometry(e,this._height),this.geometry.computeBoundingBox(),this.element.style.width=`${e}px`,this._width=e}get height(){return this._height}set height(e){this.geometry.dispose(),this.geometry=new c.PlaneBufferGeometry(this._width,e),this.geometry.computeBoundingBox(),this.element.style.height=`${e}px`,this._height=e}raycast(e,n){const h=this.cacheBox.copy(this.geometry.boundingBox);this.matrixWorld.decompose(this.cachePosition,this.cacheQuaternion,this.cacheScale);const a=this.rotateMatrix4.lookAt(this.position,e.camera.position,this.up);this.cacheQuaternion.setFromRotationMatrix(a),this.cacheMatrix4.compose(this.cachePosition,this.cacheQuaternion,this.cacheScale),h.applyMatrix4(this.cacheMatrix4),e.ray.intersectsBox(h)&&n.push({distance:e.ray.origin.distanceTo(this.position),object:this,point:this.position})}}class B extends D{constructor(i=document.createElement("div")){super(i),this.type="CSS3DSprite",this.element.classList.add("vis-css3d","vis-css3d-plane")}}var P=d.defineProcessor({type:"CSS3DSprite",config:l,commands:{add:t.objectCommands.add,set:{element({target:s,value:i,engine:e}){s.element.innerHTML="",s.element.appendChild(m(i,e))},...t.objectCommands.set},delete:t.objectCommands.delete},create(s,i){return t.objectCreate(new B(m(s.element,i)),s,{element:!0},i)},dispose:t.objectDispose}),_={type:"css3D",object:!0,compiler:S,rule:C,processors:[x,w,P],lifeOrder:d.SUPPORT_LIFE_CYCLE.THREE};o.CSS3DCompiler=S,o.default=_,o.getCSS3DObjectConfig=p,o.getCSS3DPlaneConfig=g,o.getCSS3DSpriteConfig=l,Object.defineProperties(o,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
