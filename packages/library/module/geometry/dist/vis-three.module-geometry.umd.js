(function(p,c){typeof exports=="object"&&typeof module<"u"?c(exports,require("@vis-three/tdcm"),require("three"),require("three/examples/jsm/geometries/DecalGeometry.js")):typeof define=="function"&&define.amd?define(["exports","@vis-three/tdcm","three","three/examples/jsm/geometries/DecalGeometry.js"],c):(p=typeof globalThis<"u"?globalThis:p||self,c((p["vis-three"]=p["vis-three"]||{},p["vis-three"]["module-geometry"]={}),p.tdcm,p.three,p.DecalGeometry_js))})(this,function(p,c,s,z){"use strict";const m=function(){return Object.assign(c.getBasicConfig(),{center:!0,position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},groups:[]})},j=function(){return Object.assign(m(),{width:5,height:5,depth:5,widthSegments:1,heightSegments:1,depthSegments:1})},B=function(){return Object.assign(m(),{radius:3,widthSegments:32,heightSegments:32,phiStart:0,phiLength:Math.PI*2,thetaStart:0,thetaLength:Math.PI})},V=function(){return Object.assign(m(),{width:5,height:5,widthSegments:1,heightSegments:1})},A=function(){return Object.assign(m(),{radius:3,segments:8,thetaStart:0,thetaLength:Math.PI*2})},U=function(){return Object.assign(m(),{radius:3,height:5,radialSegments:8,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:Math.PI*2})},I=function(){return Object.assign(m(),{radius:3,tube:.4,radialSegments:8,tubularSegments:6,arc:Math.PI*2})},F=function(){return Object.assign(m(),{innerRadius:2,outerRadius:3,thetaSegments:8,phiSegments:8,thetaStart:0,thetaLength:Math.PI*2})},N=function(){return Object.assign(m(),{url:""})},R=function(){return Object.assign(m(),{attribute:{position:[],color:[],index:[],normal:[],uv:[],uv2:[]}})},Q=function(){return Object.assign(m(),{radiusTop:3,radiusBottom:3,height:5,radialSegments:8,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:Math.PI*2})},Y=function(){return Object.assign(m(),{target:"",thresholdAngle:1})},E=function(){return Object.assign(m(),{center:!1,path:[],divisions:36,space:!0})},H=function(){return Object.assign(E(),{center:!1})},$=function(){return Object.assign(E(),{center:!1})},q=function(){return Object.assign(E(),{center:!1})},P=function(){return Object.assign(m(),{center:!1,path:[],tubularSegments:64,radius:1,radialSegments:8,closed:!1})},W=function(){return Object.assign(P(),{center:!1})},k=function(){return Object.assign(P(),{center:!1})},X=function(){return Object.assign(m(),{center:!1,path:"",tubularSegments:64,radius:1,radialSegments:8,closed:!1})},Z=function(){return Object.assign(m(),{center:!1,shape:"",curveSegments:12})},J=function(){return Object.assign(m(),{center:!1,shapes:"",options:{curveSegments:12,steps:1,depth:1,bevelEnabled:!0,bevelThickness:.2,bevelSize:.1,bevelOffset:0,bevelSegments:3,extrudePath:"",UVGenerator:"default"}})},K=function(){return Object.assign(m(),{center:!1,path:"",space:!1,divisions:36})},ee=function(){return Object.assign(m(),{path:"",divisions:32,segments:12,phiStart:0,phiLength:Math.PI*2})},te=function(){return Object.assign(m(),{center:!1,target:{geometry:"",position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:0,y:0,z:0}},point:{x:0,y:0,z:0},orientation:{x:0,y:0,z:0},size:{x:0,y:0,z:0}})},re=function(r,e){e.center&&r.center(),r.computeBoundingBox();const t=r.boundingBox,o=e.position,n=e.rotation,a=e.scale,u=new s.Quaternion().setFromEuler(new s.Euler(n.x,n.y,n.z,"XYZ"));return r.applyQuaternion(u),r.scale(a.x,a.y,a.z),e.center&&r.center(),r.computeBoundingBox(),r.translate((t.max.x-t.min.x)/2*o.x,(t.max.y-t.min.y)/2*o.y,(t.max.z-t.min.z)/2*o.z),r},C={reg:new RegExp(".*"),handler({config:r,target:e,model:t,engine:o,compiler:n}){const a=t.createPuppet({model:t,config:r,engine:o,compiler:n});e.copy(a),t.disposePuppet({model:t,target:a,puppet:a,config:r,engine:o,compiler:n})}},h=c.defineModel.extend({commands:{add:{groups({target:r,value:e}){r.addGroup(e.start,e.count,e.materialIndex)},$reg:[C]},set:{groups(r){const{path:e,target:t,config:o}=r;if(e[1]!==void 0){t.groups.splice(Number(r.path[1]),1);const n=o.groups[e[1]];t.addGroup(n.start,n.count,n.materialIndex)}else console.warn("geometry processor can not set group",r)},$reg:[C]},delete:{groups({target:r,key:e}){r.groups.splice(Number(e),1)},$reg:[C]}},create(r,e){r.clearGroups();for(const t of e.groups)r.addGroup(t.start,t.count,t.materialIndex);return re(r,e)},dispose(r){r.dispose()}}),ne=h(r=>({type:"BoxGeometry",config:j,create({config:e}){return r.create(new s.BoxGeometry(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments),e)},dispose({target:e}){r.dispose(e)}})),se=h(r=>({type:"CircleGeometry",config:A,create({config:e}){return r.create(new s.CircleGeometry(e.radius,e.segments,e.thetaStart,e.thetaLength),e)},dispose({target:e}){r.dispose(e)}})),y=function(r){return r>1?1:r<0?0:r},v={default:void 0,cover:{generateTopUV(r,e,t,o,n){const a=e[t*3],u=e[t*3+1],i=e[o*3],l=e[o*3+1],G=e[n*3],g=e[n*3+1];return[new s.Vector2(y(a),y(u)),new s.Vector2(y(i),y(l)),new s.Vector2(y(G),y(g))]},generateSideWallUV(r,e,t,o,n,a){const u=e[t*3],i=e[t*3+1],l=e[t*3+2],G=e[o*3],g=e[o*3+1],D=e[o*3+2],Oe=e[n*3],xe=e[n*3+1],f=e[n*3+2],De=e[a*3],fe=e[a*3+1],_=e[a*3+2];return Math.abs(i-g)<Math.abs(u-G)?[new s.Vector2(y(u),y(1-l)),new s.Vector2(y(G),y(1-D)),new s.Vector2(y(Oe),y(1-f)),new s.Vector2(y(De),y(1-_))]:[new s.Vector2(y(i),y(1-l)),new s.Vector2(y(g),y(1-D)),new s.Vector2(y(xe),y(1-f)),new s.Vector2(y(fe),y(1-_))]}}};class S extends s.BufferGeometry{constructor(e){super(),this.type="LoadBufferGeometry",e&&this.copy(e)}}class d extends s.BufferGeometry{constructor(e=[],t=36,o=!0){super(),this.type="CurveGeometry",this.parameters={path:e.map(n=>n.clone()),space:o,divisions:t}}}class w extends d{constructor(e=[],t=36,o=!0){super(e,t,o),this.type="CubicBezierCurveGeometry";const n=new s.CurvePath;if(e.length<4){console.warn("CubicBezierCurveGeometry path length at least 4.");return}const a=4+(e.length-4)-(e.length-4)%3;for(let i=2;i<a;i+=3)n.add(new s.CubicBezierCurve3(e[i-2],e[i-1],e[i],e[i+1]));const u=n.curves.reduce((i,l)=>i+=l.arcLengthDivisions,0);if(t>u){const i=Math.ceil((t-u)/n.curves.length);n.curves.forEach(l=>{l.arcLengthDivisions=l.arcLengthDivisions*(i+1),l.updateArcLengths()})}this.setFromPoints(o?n.getSpacedPoints(t):n.getPoints(t))}}class oe extends d{constructor(e=[],t=36,o=!0){if(super(e,t,o),this.type="LineCurveGeometry",!e.length){console.warn("LineCurveGeometry path length at least 1.");return}const n=new s.CurvePath;for(let u=1;u<e.length;u+=1)n.add(new s.LineCurve3(e[u-1],e[u]));const a=n.curves.reduce((u,i)=>u+=i.arcLengthDivisions,0);if(t>a){const u=Math.ceil((t-a)/n.curves.length);n.curves.forEach(i=>{i.arcLengthDivisions=i.arcLengthDivisions*(u+1),i.updateArcLengths()})}this.setFromPoints(o?n.getSpacedPoints(t):n.getPoints(t))}}class b extends d{constructor(e=[],t=36,o=!0){super(e,t,o),this.type="QuadraticBezierCurveGeometry";const n=new s.CurvePath;if(e.length<3){console.warn("QuadraticBezierCurveGeometry path length at least 3.");return}const a=3+(e.length-3)-(e.length-3)%2;for(let i=1;i<a;i+=2)n.add(new s.QuadraticBezierCurve3(e[i-1],e[i],e[i+1]));const u=n.curves.reduce((i,l)=>i+=l.arcLengthDivisions,0);if(t>u){const i=Math.ceil((t-u)/n.curves.length);n.curves.forEach(l=>{l.arcLengthDivisions=l.arcLengthDivisions*(i+1),l.updateArcLengths()})}this.setFromPoints(o?n.getSpacedPoints(t):n.getPoints(t))}}class L extends d{constructor(e=[],t=36,o=!0){if(super(e,t,o),this.type="SplineCurveGeometry",!e.length){console.warn("SplineCurveGeometry path length at least 1.");return}const n=new s.CatmullRomCurve3(e);this.setFromPoints(o?n.getSpacedPoints(t):n.getPoints(t))}}class ae extends s.ShapeGeometry{constructor(e=[new s.Vector2(0,0)],t=12){const o=new s.Shape,n=e[0];if(n){o.moveTo(n.x,n.y);for(let a=1;a<e.length;a+=1)o.lineTo(e[a].x,e[a].y)}super(o,t),this.type="LineShapeGeometry"}}class M extends s.TubeGeometry{constructor(e=[],t=64,o=1,n=8,a=!1){if(!e.length){console.warn("LineTubeGeometry path length at least 1.");return}const u=new s.CurvePath;for(let i=1;i<e.length;i+=1)u.add(new s.LineCurve3(e[i-1],e[i]));super(u,t,o,n,a),this.type="LineTubeGeometry"}}class T extends s.TubeGeometry{constructor(e=[],t=64,o=1,n=8,a=!1){if(!e.length){console.warn("SplineTubeGeometry path length at least 1.");return}const u=new s.CatmullRomCurve3(e);super(u,t,o,n,a),this.type="SplineTubeGeometry"}}class O extends s.TubeGeometry{constructor(e=new s.Path,t=64,o=1,n=8,a=!1){super(e,t,o,n,a),this.type="PathTubeGeometry"}}class x extends s.BufferGeometry{constructor(e=new s.Path,t=36,o=!0){super(),this.type="PathGeometry",this.parameters={path:e,space:o,divisions:t},e.curves.length&&this.setFromPoints(o?e.getSpacedPoints(t):e.getPoints(t))}}const ue=h(r=>({type:"CubicBezierCurveGeometry",config:$,create({config:e}){return r.create(new w(e.path.map(t=>new s.Vector3(t.x,t.y,t.z)),e.divisions,e.space),e)},dispose({target:e}){r.dispose(e)}})),ie=h(r=>({type:"CustomGeometry",config:R,shared:{generateGeometry(e){const t=new s.BufferGeometry;return e.position.length&&t.setAttribute("position",new s.Float32BufferAttribute(e.position,3)),e.color.length&&t.setAttribute("color",new s.Float32BufferAttribute(e.color,3)),e.normal.length&&t.setAttribute("normal",new s.Float32BufferAttribute(e.normal,3)),e.uv.length&&t.setAttribute("uv",new s.Float32BufferAttribute(e.uv,2)),e.uv2.length&&t.setAttribute("uv2",new s.Float32BufferAttribute(e.uv2,2)),e.index.length&&t.setIndex(e.index),t}},create({model:e,config:t}){return r.create(e.generateGeometry(t.attribute),t)},dispose({target:e}){r.dispose(e)}})),ce=h(r=>({type:"EdgesGeometry",config:Y,shared:{occupyGeometry:new s.EdgesGeometry(new s.BoxGeometry(5,5,5))},create({model:e,config:t,engine:o}){const n=o.compilerManager.getObjectFromModule(c.MODULE_TYPE.GEOMETRY,t.target);return!n||!(n instanceof s.BufferGeometry)?(console.error(`engine rescoure can not found url: ${t.target}`),e.occupyGeometry):r.create(new s.EdgesGeometry(n,t.thresholdAngle),t)},dispose({target:e}){r.dispose(e)}})),pe=h(r=>({type:"ExtrudeGeometry",config:J,context({model:e}){return{shapeEvent:void 0,pathEvent:void 0}},create({model:e,config:t,engine:o}){var i,l;const n=o.compilerManager.getObjectFromModule(c.MODULE_TYPE.SHAPE,t.shapes)||void 0,a=o.compilerManager.getObjectFromModule(c.MODULE_TYPE.PATH,t.options.extrudePath)||void 0,u=new s.ExtrudeGeometry(n,Object.assign({},t.options,{extrudePath:a,UVGenerator:v[t.options.UVGenerator||"default"]}));return n&&(e.shapeEvent=()=>{t.shapes=t.shapes},(i=e.toModel(t.shapes))==null||i.on(c.MODEL_EVENT.COMPILED_UPDATE,e.shapeEvent)),a&&(e.pathEvent=()=>{t.options.extrudePath=t.options.extrudePath},(l=e.toModel(t.options.extrudePath))==null||l.on(c.MODEL_EVENT.COMPILED_UPDATE,e.pathEvent)),r.create(u,t)},dispose({model:e,config:t,target:o}){var n,a;e.shapeEvent&&((n=e.toModel(t.shapes))==null||n.off(c.MODEL_EVENT.COMPILED_UPDATE,e.shapeEvent)),e.pathEvent&&((a=e.toModel(t.options.extrudePath))==null||a.off(c.MODEL_EVENT.COMPILED_UPDATE,e.pathEvent)),r.dispose(o)}})),he=h(r=>({type:"LatheGeometry",config:ee,context({model:e}){return{pathEvent:void 0}},create({model:e,config:t,engine:o}){var u;const n=o.compilerManager.getObjectFromModule(c.MODULE_TYPE.PATH,t.path)||void 0,a=new s.LatheGeometry(n?n.getPoints(t.divisions):void 0,t.segments,t.phiStart,t.phiLength);return n&&(e.pathEvent=()=>{t.path=t.path},(u=e.toModel(t.path))==null||u.on(c.MODEL_EVENT.COMPILED_UPDATE,e.pathEvent)),r.create(a,t)},dispose({model:e,config:t,target:o}){var n;e.pathEvent&&((n=e.toModel(t.path))==null||n.off(c.MODEL_EVENT.COMPILED_UPDATE,e.pathEvent)),r.dispose(o)}})),ye=h(r=>({type:"LineTubeGeometry",config:W,create({config:e}){return r.create(new M(e.path.map(t=>new s.Vector3(t.x,t.y,t.z)),e.tubularSegments,e.radius,e.radialSegments,e.closed),e)},dispose({target:e}){r.dispose(e)}})),me=h(r=>({type:"LoadGeometry",config:N,create({config:e,engine:t}){const o=t.resourceManager.resourceMap.get(e.url);return!o&&!(o instanceof s.BufferGeometry)?(console.error(`engine rescoure can not found url: ${e.url}`),new s.BoxGeometry(5,5,5)):r.create(new S(o),e)},dispose({target:e}){r.dispose(e)}})),le=h(r=>({type:"PathGeometry",config:K,create({model:e,config:t,engine:o}){var u;const n=o.compilerManager.getObjectFromModule(c.MODULE_TYPE.PATH,t.path)||void 0,a=new x(n,t.divisions,t.space);return n&&(e.pathEvent&&(e.cachePathEvent=e.pathEvent),e.pathEvent=()=>{t.path=t.path},(u=e.toModel(t.path))==null||u.on(c.MODEL_EVENT.COMPILED_UPDATE,e.pathEvent)),r.create(a,t)},dispose({model:e,config:t,target:o}){var n;e.pathEvent&&((n=e.toModel(t.path))==null||n.off(c.MODEL_EVENT.COMPILED_UPDATE,e.pathEvent),e.cachePathEvent&&(e.pathEvent=e.cachePathEvent,e.cachePathEvent=void 0)),r.dispose(o)}})),de=h(r=>({type:"PathTubeGeometry",config:X,context(){return{pathEvent:void 0,restrictor:0}},create({model:e,config:t,engine:o}){var u;const n=o.compilerManager.getObjectFromModule(c.MODULE_TYPE.PATH,t.path)||void 0,a=new O(n,t.tubularSegments,t.radius,t.radialSegments,t.closed);return n&&(e.pathEvent=()=>{e.restrictor||(e.restrictor=window.setTimeout(()=>{t.path=t.path,e.restrictor=0},1e3/30))},(u=e.toModel(t.path))==null||u.on(c.MODEL_EVENT.COMPILED_UPDATE,e.pathEvent)),r.create(a,t)},dispose({model:e,config:t,target:o}){var n;window.clearTimeout(e.restrictor),e.pathEvent&&((n=e.toModel(t.path))==null||n.off(c.MODEL_EVENT.COMPILED_UPDATE,e.pathEvent)),r.dispose(o)}})),Ge=h(r=>({type:"PlaneGeometry",config:V,create({config:e}){return r.create(new s.PlaneGeometry(e.width,e.height,e.widthSegments,e.heightSegments),e)},dispose({target:e}){r.dispose(e)}})),ge=h(r=>({type:"QuadraticBezierCurveGeometry",config:q,create({config:e}){return r.create(new b(e.path.map(t=>new s.Vector3(t.x,t.y,t.z)),e.divisions,e.space),e)},dispose({target:e}){r.dispose(e)}})),Ee=h(r=>({type:"RingGeometry",config:F,create({config:e}){return r.create(new s.RingGeometry(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength),e)},dispose({target:e}){r.dispose(e)}})),Ce=h(r=>({type:"ShapeGeometry",config:Z,create({model:e,config:t,engine:o}){var u;const n=o.compilerManager.getObjectFromModule(c.MODULE_TYPE.SHAPE,t.shape)||void 0,a=new s.ShapeGeometry(n,t.curveSegments);return n&&(e.shapeEvent=()=>{t.shape=t.shape},(u=e.toModel(t.shape))==null||u.on(c.MODEL_EVENT.COMPILED_UPDATE,e.shapeEvent)),r.create(a,t)},dispose({model:e,config:t,target:o}){var n;e.shapeEvent&&((n=e.toModel(t.shape))==null||n.on(c.MODEL_EVENT.COMPILED_UPDATE,e.shapeEvent)),r.dispose(o)}})),Pe=h(r=>({type:"SplineCurveGeometry",config:H,create({config:e}){return r.create(new L(e.path.map(t=>new s.Vector3(t.x,t.y,t.z)),e.divisions,e.space),e)},dispose({target:e}){r.dispose(e)}})),ve=h(r=>({type:"TorusGeometry",config:I,create({config:e}){return r.create(new s.TorusGeometry(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc),e)},dispose({target:e}){r.dispose(e)}})),Se=h(r=>({type:"SphereGeometry",config:B,create({config:e}){return r.create(new s.SphereGeometry(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength),e)},dispose({target:e}){r.dispose(e)}})),we=h(r=>({type:"DecalGeometry",config:te,shared:{tempGeometry:new s.BufferGeometry,tempMesh:new s.Mesh},create({model:e,config:t,engine:o}){const n=t.target.geometry&&o.getObjectBySymbol(t.target.geometry)||e.tempGeometry;return e.tempMesh.geometry=n,e.tempMesh.matrixWorld.compose(new s.Vector3(t.target.position.x,t.target.position.y,t.target.position.z),new s.Quaternion().setFromEuler(new s.Euler(t.target.rotation.x,t.target.rotation.y,t.target.rotation.z)),new s.Vector3(t.target.scale.x,t.target.scale.y,t.target.scale.z)),r.create(new z.DecalGeometry(e.tempMesh,new s.Vector3(t.point.x,t.point.y,t.point.z),new s.Euler(t.orientation.x,t.orientation.y,t.orientation.z),new s.Vector3(t.size.x,t.size.y,t.size.z)),t)},dispose({target:e}){r.dispose(e)}})),be=h(r=>({type:"SplineTubeGeometry",config:k,create({config:e}){return r.create(new T(e.path.map(t=>new s.Vector3(t.x,t.y,t.z)),e.tubularSegments,e.radius,e.radialSegments,e.closed),e)},dispose({target:e}){r.dispose(e)}})),Le=h(r=>({type:"ConeGeometry",config:U,create({config:e}){return r.create(new s.ConeGeometry(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength),e)},dispose({target:e}){r.dispose(e)}})),Me=h(r=>({type:"CylinderGeometry",config:Q,create({config:e}){return r.create(new s.CylinderGeometry(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength),e)},dispose({target:e}){r.dispose(e)}})),Te=c.defineModule({type:"geometry",models:[ne,se,ue,ie,Le,Me,we,ce,pe,he,ye,me,le,de,Ge,ge,Ee,Ce,Se,Pe,be,ve],lifeOrder:c.SUPPORT_LIFE_CYCLE.TWO});p.CubicBezierCurveGeometry=w,p.CurveGeometry=d,p.ExtrudeUVGenerator=v,p.LineCurveGeometry=oe,p.LineShapeGeometry=ae,p.LineTubeGeometry=M,p.LoadGeometry=S,p.PathGeometry=x,p.PathTubeGeometry=O,p.QuadraticBezierCurveGeometry=b,p.SplineCurveGeometry=L,p.SplineTubeGeometry=T,p.default=Te,Object.defineProperties(p,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
