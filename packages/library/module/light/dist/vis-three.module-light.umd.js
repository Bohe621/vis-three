(function(i,n){typeof exports=="object"&&typeof module!="undefined"?n(exports,require("@vis-three/module-object"),require("three"),require("@vis-three/middleware"),require("@vis-three/core")):typeof define=="function"&&define.amd?define(["exports","@vis-three/module-object","three","@vis-three/middleware","@vis-three/core"],n):(i=typeof globalThis!="undefined"?globalThis:i||self,n((i["vis-three"]=i["vis-three"]||{},i["vis-three"]["module-light"]={}),i.moduleObject,i.three,i.middleware,i.core))})(this,function(i,n,s,a,w){"use strict";class y extends n.ObjectCompiler{constructor(){super()}}const R=function(e,t){n.ObjectRule(e,t)},u=function(){return Object.assign(n.getObjectConfig(),{type:"Light",color:"rgb(255, 255, 255)",intensity:1})},f=function(e){return Object.assign(u(),{shadow:{bias:0,normalBias:0,radius:1,mapSize:{x:512,y:512},camera:e}})},C=function(){return Object.assign(n.getObjectConfig(),{color:"rgb(255, 255, 255)",intensity:1})},l=function(){return Object.assign(f({fov:90,aspect:1,near:.5,far:500}),{distance:30,decay:.01})},b=function(){return Object.assign(f({fov:50,aspect:1,near:.5,far:500}),{distance:30,angle:Math.PI/180*45,penumbra:.01,decay:.01})},v=function(){return Object.assign(f({near:.5,far:500,top:window.innerHeight,bottom:-window.innerHeight,left:-window.innerWidth,right:window.innerWidth}),{})},P=function(){return Object.assign(u(),{color:"rgb(255, 255, 255)",groundColor:"rgb(0, 0, 0)"})},S=function(){return Object.assign(u(),{width:10,height:10})},c=new s.Vector2,h=new s.Vector2,E=function(e,t,o){const r=e.shadow;e.shadow.mapSize.set(t.shadow.mapSize.x,t.shadow.mapSize.y),c.copy(r.mapSize);const g=r.getFrameExtents();c.multiply(g),h.copy(r.mapSize),(c.x>o||c.y>o)&&(c.x>o&&(h.x=Math.floor(o/g.x),c.x=h.x*g.x,r.mapSize.x=h.x),c.y>o&&(h.y=Math.floor(o/g.y),c.y=h.y*g.y,r.mapSize.y=h.y)),e.shadow.map.setSize(c.x,c.y)},z=function({target:e,value:t}){e.color.copy(new s.Color(t))},p=function(e,t,o,r){return e.color.copy(new s.Color(t.color)),n.objectCreate(e,t,{color:!0,scale:!0,rotation:!0,lookAt:!0,...o},r)},m=function(e,t,o,r){const g=()=>{e.shadow.map&&(E(e,t,r.webGLRenderer.capabilities.maxTextureSize),r.renderManager.removeEventListener(w.ENGINE_EVENT.RENDER,g))};r.renderManager.addEventListener(w.ENGINE_EVENT.RENDER,g);for(const j in t.shadow.camera)e.shadow.camera[j]=t.shadow.camera[j];return e.shadow.camera.updateProjectionMatrix(),p(e,t,{shadow:{mapSize:!0,camera:!0},...o},r)},d=Object.assign({},n.objectCommands,{set:{color:z,scale:a.emptyHandler,rotation:a.emptyHandler,lookAt:a.emptyHandler}}),L={set:{shadow:{mapSize({target:e,config:t,engine:o,key:r,value:g}){e.shadow.mapSize[r]=g,E(e,t,o.webGLRenderer.capabilities.maxTextureSize)},camera({target:e,key:t,value:o}){e.shadow.camera[t]=o,e.shadow.camera.updateProjectionMatrix()}}}};var D=a.defineProcessor({type:"AmbientLight",config:C,commands:d,create(e,t){return p(new s.AmbientLight,e,{},t)},dispose:n.objectDispose}),A=a.defineProcessor({type:"DirectionalLight",config:v,commands:{set:{...d.set,...L.set}},create(e,t){return m(new s.DirectionalLight,e,{},t)},dispose:n.objectDispose}),H=a.defineProcessor({type:"HemisphereLight",config:P,commands:{set:{...d.set,groundColor:function({target:e,value:t}){e.groundColor.copy(new s.Color(t))}}},create(e,t){const o=new s.HemisphereLight;return o.groundColor.copy(new s.Color(e.groundColor)),p(o,e,{groundColor:!0},t)},dispose:n.objectDispose}),M=a.defineProcessor({type:"PointLight",config:l,commands:{set:{...d.set,...L.set}},create(e,t){return m(new s.PointLight,e,{},t)},dispose:n.objectDispose}),x=a.defineProcessor({type:"RectAreaLight",config:S,commands:{set:{...d.set,rotation:void 0}},create(e,t){const o=p(new s.RectAreaLight,e,{},t);return o.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z),o.updateMatrixWorld(),o},dispose:n.objectDispose}),N=a.defineProcessor({type:"SpotLight",config:b,commands:{set:{...d.set,...L.set}},create(e,t){return m(new s.SpotLight,e,{},t)},dispose:n.objectDispose}),O={type:"light",object:!0,compiler:y,rule:R,processors:[D,M,A,H,x,N],lifeOrder:a.SUPPORT_LIFE_CYCLE.THREE};i.LightCompiler=y,i.default=O,i.getAmbientLightConfig=C,i.getDirectionalLightConfig=v,i.getHemisphereLightConfig=P,i.getPointLightConfig=l,i.getRectAreaLightConfig=S,i.getSpotLightConfig=b,Object.defineProperties(i,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
