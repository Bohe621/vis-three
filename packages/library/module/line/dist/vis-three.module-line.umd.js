(function(s,c){typeof exports=="object"&&typeof module!="undefined"?c(exports,require("@vis-three/middleware"),require("@vis-three/module-solid-object"),require("three"),require("@vis-three/module-object")):typeof define=="function"&&define.amd?define(["exports","@vis-three/middleware","@vis-three/module-solid-object","three","@vis-three/module-object"],c):(s=typeof globalThis!="undefined"?globalThis:s||self,c((s["vis-three"]=s["vis-three"]||{},s["vis-three"]["module-line"]={}),s.middleware,s.moduleSolidObject,s.three,s.moduleObject))})(this,function(s,c,o,r,E){"use strict";class L extends o.SolidObjectCompiler{constructor(){super()}}const h=function(){return Object.assign(o.getSolidObjectConfig(),{geometry:"",material:"",dashed:!1})},p=function(){return h()},j=function(){return Object.assign(o.getSolidObjectConfig(),{geometry:"",material:""})},M=function(){return Object.assign(o.getSolidObjectConfig(),{geometry:"",material:""})},u=new WeakMap,a=new WeakMap,g=function(e,n,t){a.has(n)?console.warn("Line processor has already exist geometry cache"):(a.set(n,t),c.Bus.compilerEvent.on(n,c.COMPILER_EVENT.UPDATE,t),u.set(e,n))},l=function(e,n){if(!a.has(n)){console.warn("Line processor found an error can not found cache geometry:",n);return}c.Bus.compilerEvent.off(n,c.COMPILER_EVENT.UPDATE,a.get(n)),a.delete(n),u.get(e)===n&&u.delete(e)},O=function(e,n){const t=u.get(e);if(!t){console.warn("line processor can not change line geometry");return}const i=a.get(t);l(e,t),g(e,n,i)};var y=c.defineProcessor({type:"Line",config:h,commands:{add:o.solidObjectCommands.add,set:{...o.solidObjectCommands.set,dashed({target:e,value:n}){if(e.material instanceof r.LineDashedMaterial&&n){const t=()=>{e.computeLineDistances()};g(e,e.geometry,t),t();return}n||l(e,e.geometry)},geometry(e){o.geometryHandler(e),O(e.target,e.target.geometry)}},delete:o.solidObjectCommands.delete},create(e,n){const t=o.solidObjectCreate(new r.Line,e,{dashed:!0},n);if(t.material instanceof r.LineDashedMaterial&&e.dashed){const i=()=>{t.computeLineDistances()};g(t,t.geometry,i),i()}return t},dispose:o.solidObjectDispose});const v=function(e,n){E.ObjectRule(e,n)},d=new WeakMap,f=new WeakMap,m=function(e,n,t){f.has(n)?console.warn("LineSegments processor has already exist geometry cache"):(f.set(n,t),c.Bus.compilerEvent.on(n,c.COMPILER_EVENT.UPDATE,t),d.set(e,n))},C=function(e,n){if(!f.has(n)){console.warn("LineSegments processor found an error can not found cache geometry:",n);return}c.Bus.compilerEvent.off(n,c.COMPILER_EVENT.UPDATE,f.get(n)),f.delete(n),d.get(e)===n&&d.delete(e)},P=function(e,n){const t=d.get(e);if(!t){console.warn("line processor can not change line geometry");return}const i=f.get(t);C(e,t),m(e,n,i)};var D=c.defineProcessor({type:"LineSegments",config:p,commands:{add:o.solidObjectCommands.add,set:{...o.solidObjectCommands.set,dashed({target:e,value:n}){if(e.material instanceof r.LineDashedMaterial&&n){const t=()=>{e.computeLineDistances()};m(e,e.geometry,t),t();return}n||C(e,e.geometry)},geometry(e){o.geometryHandler(e),P(e.target,e.target.geometry)}},delete:o.solidObjectCommands.delete},create(e,n){const t=o.solidObjectCreate(new r.LineSegments,e,{dashed:!0},n);if(t.material instanceof r.LineDashedMaterial&&e.dashed){const i=()=>{t.computeLineDistances()};m(t,t.geometry,i),i()}return t},dispose:o.solidObjectDispose}),b={type:"line",object:!0,compiler:L,rule:v,processors:[y,D],lifeOrder:c.SUPPORT_LIFE_CYCLE.THREE};s.LineCompiler=L,s.default=b,s.getLineConfig=h,s.getLineFatConfig=j,s.getLineSegmentsConfig=p,s.getLineSegmentsFatConfig=M,Object.defineProperties(s,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
