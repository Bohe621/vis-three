(function(t,o){typeof exports=="object"&&typeof module!="undefined"?o(exports,require("@vis-three/middleware"),require("three"),require("@vis-three/utils")):typeof define=="function"&&define.amd?define(["exports","@vis-three/middleware","three","@vis-three/utils"],o):(t=typeof globalThis!="undefined"?globalThis:t||self,o((t["vis-three"]=t["vis-three"]||{},t["vis-three"]["module-material"]={}),t.middleware,t.three,t.utils))})(this,function(t,o,r,h){"use strict";class S extends o.Compiler{constructor(){super()}}const w=function(e,n){o.Rule(e,n)},p=function(){return{vid:"",type:"Material",alphaTest:0,colorWrite:!0,depthTest:!0,depthWrite:!0,name:"",needsUpdate:!1,opacity:1,dithering:!1,shadowSide:null,side:r.FrontSide,toneMapped:!0,transparent:!1,visible:!0,blendDst:r.OneMinusSrcAlphaFactor,blendDstAlpha:null,blendEquation:r.AddEquation,blendEquationAlpha:null,blending:r.NormalBlending,blendSrc:r.SrcAlphaFactor,blendSrcAlpha:null,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0}},y=function(){return Object.assign(p(),{color:"rgb(255, 255, 255)",combine:r.MultiplyOperation,aoMapIntensity:1,fog:!0,lightMapIntensity:1,reflectivity:1,refractionRatio:.98,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",wireframeLinewidth:1,map:"",envMap:"",alphaMap:"",aoMap:"",lightMap:"",specularMap:""})},d=function(){return Object.assign(p(),{aoMapIntensity:1,bumpScale:1,color:"rgb(255, 255, 255)",displacementScale:1,displacementBias:0,emissive:"rgb(0, 0, 0)",emissiveIntensity:1,envMapIntensity:1,flatShading:!1,lightMapIntensity:1,metalness:0,normalMapType:r.TangentSpaceNormalMap,refractionRatio:.98,roughness:1,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",roughnessMap:"",normalMap:"",metalnessMap:"",map:"",lightMap:"",envMap:"",emissiveMap:"",displacementMap:"",bumpMap:"",alphaMap:"",aoMap:""})},v=function(){return Object.assign(d(),{attenuationColor:"rgb(255, 255, 255)",attenuationDistance:0,clearcoat:0,clearcoatNormalScale:{x:1,y:1},clearcoatRoughness:0,ior:1.5,reflectivity:.5,sheen:0,sheenRoughness:1,sheenColor:"rgb(255, 255, 255)",specularIntensity:0,specularColor:"rgb(255, 255, 255)",thickness:0,transmission:0,clearcoatMap:"",clearcoatNormalMap:"",clearcoatRoughnessMap:"",sheenRoughnessMap:"",sheenColorMap:"",specularIntensityMap:"",specularColorMap:"",thicknessMap:"",transmissionMap:""})},b=function(){return Object.assign(p(),{aoMapIntensity:1,bumpScale:1,color:"rgb(255, 255, 255)",displacementScale:1,displacementBias:0,emissive:"rgb(0, 0, 0)",emissiveIntensity:1,envMapIntensity:1,flatShading:!1,lightMapIntensity:1,normalMapType:r.TangentSpaceNormalMap,refractionRatio:.98,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",specular:"rgb(17, 17, 17)",shininess:30,combine:r.MultiplyOperation,normalMap:"",map:"",lightMap:"",envMap:"",emissiveMap:"",displacementMap:"",bumpMap:"",alphaMap:"",aoMap:"",specularMap:""})},C=function(){return Object.assign(p(),{color:"rgb(255, 255, 255)",rotation:0,map:"",alphaMap:"",sizeAttenuation:!0})},g=function(){return Object.assign(p(),{color:"rgb(255, 255, 255)",linecap:"round",linejoin:"round",linewidth:1})},P=function(){return Object.assign(g(),{dashSize:3,gapSize:1,scale:1})},O=function(){return Object.assign(p(),{map:"",alphaMap:"",color:"rgb(255, 255, 255)",sizeAttenuation:!0,size:1})},L=function(){return Object.assign(p(),{shader:"defaultShader",uniforms:{}})},l={reg:new RegExp("transparent|sizeAttenuation"),handler({target:e,key:n,value:a}){e[n]=a,e.needsUpdate=!0}},j=function({target:e,key:n,value:a,engine:i}){o.globalAntiShake.exec(c=>{if(!a)return e[n]=null,e.needsUpdate=!0,!0;const m=i.compilerManager.getObjectBySymbol(a);return m instanceof r.Texture?(e[n]=m,e.needsUpdate=!0,!0):(c&&console.warn(`this url resource is not instance of Texture: ${n}`,a,m),e[n]=null,!1)})},f={reg:new RegExp("map$","i"),handler:j},s=function({target:e,key:n,value:a}){e[n].copy(new r.Color(a))},M=function(e,n,a){const i={};for(const c of Object.keys(n))c.toLocaleLowerCase().endsWith("map")&&n[c]?(j({target:e,key:c,value:n[c],engine:a}),i[c]=!0):e[c]instanceof r.Color&&(e[c]=new r.Color(n[c]),i[c]=!0);return h.syncObject(n,e,i),e.needsUpdate=!0,e},u=function(e){e.dispose()};var B=o.defineProcessor({type:"MeshBasicMaterial",config:y,commands:{set:{color:s,$reg:[f,l]}},create:function(e,n){return M(new r.MeshBasicMaterial,e,n)},dispose:u}),R=o.defineProcessor({type:"MeshPhongMaterial",config:b,commands:{set:{color:s,emissive:s,specular:s,$reg:[f,l]}},create:function(e,n){return M(new r.MeshPhongMaterial,e,n)},dispose:u}),I=o.defineProcessor({type:"MeshPhysicalMaterial",config:v,commands:{set:{color:s,emissive:s,specularColor:s,sheenColor:s,attenuationColor:s,$reg:[f,l]}},create:function(e,n){return M(new r.MeshPhysicalMaterial,e,n)},dispose:u}),T=o.defineProcessor({type:"MeshStandardMaterial",config:d,commands:{set:{color:s,emissive:s,$reg:[f,l]}},create:function(e,n){return M(new r.MeshStandardMaterial,e,n)},dispose:u}),$=o.defineProcessor({type:"PointsMaterial",config:O,commands:{set:{color:s,$reg:[f,l]}},create:function(e,n){return M(new r.PointsMaterial,e,n)},dispose:u}),A=o.defineProcessor({type:"ShaderMaterial",config:L,commands:{set:{shader({target:e,value:n}){const a=o.ShaderGeneratorManager.getShader(n);a!=null&&a.vertexShader&&(e.vertexShader=a.vertexShader),a!=null&&a.fragmentShader&&(e.fragmentShader=a.fragmentShader),a!=null&&a.uniforms&&(e.uniforms=a.uniforms),a!=null&&a.defines&&(e.defines=a.defines),e.needsUpdate=!0},$reg:[l]}},create:function(e,n){const a=new r.ShaderMaterial,i=o.ShaderGeneratorManager.getShader(e.shader);return i!=null&&i.vertexShader&&(a.vertexShader=i.vertexShader),i!=null&&i.fragmentShader&&(a.fragmentShader=i.fragmentShader),i!=null&&i.uniforms&&(a.uniforms=i.uniforms),i!=null&&i.defines&&(a.defines=i.defines),h.syncObject(e,a,{type:!0,shader:!0}),a.needsUpdate=!0,a},dispose:u}),U=o.defineProcessor({type:"SpriteMaterial",config:C,commands:{set:{color:s,$reg:[f,l]}},create:function(e,n){return M(new r.SpriteMaterial,e,n)},dispose:u}),D=o.defineProcessor({type:"LineBasicMaterial",config:g,commands:{set:{color:s,$reg:[f,l]}},create:function(e,n){return M(new r.LineBasicMaterial,e,n)},dispose:u}),E=o.defineProcessor({type:"LineDashedMaterial",config:P,commands:{set:{color:s,$reg:[f,l]}},create:function(e,n){return M(new r.LineDashedMaterial,e,n)},dispose:u}),q={type:"material",compiler:S,rule:w,processors:[D,E,B,R,I,T,$,A,U],lifeOrder:o.SUPPORT_LIFE_CYCLE.TWO};t.MaterialCompiler=S,t.default=q,t.getLineBasicMaterialConfig=g,t.getLineDashedMaterialConfig=P,t.getMaterialConfig=p,t.getMeshBasicMaterialConfig=y,t.getMeshPhongMaterialConfig=b,t.getMeshPhysicalMaterialConfig=v,t.getMeshStandardMaterialConfig=d,t.getPointsMaterialConfig=O,t.getShaderMaterialConfig=L,t.getSpriteMaterialConfig=C,Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
