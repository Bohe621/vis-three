(function(o,r){typeof exports=="object"&&typeof module!="undefined"?r(exports,require("@vis-three/middleware"),require("uuid"),require("@vis-three/utils")):typeof define=="function"&&define.amd?define(["exports","@vis-three/middleware","uuid","@vis-three/utils"],r):(o=typeof globalThis!="undefined"?globalThis:o||self,r((o["vis-three"]=o["vis-three"]||{},o["vis-three"]["module-object"]={}),o.middleware,o.uuid,o.utils))})(this,function(o,r,y,M){"use strict";class k extends r.Compiler{constructor(){super()}}const C=function(){return Object.assign(r.getSymbolConfig(),{type:"Object3D",castShadow:!0,receiveShadow:!0,lookAt:"",visible:!0,raycast:!0,matrixAutoUpdate:!0,renderOrder:0,position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},up:{x:0,y:1,z:0},parent:"",children:[],pointerdown:[],pointermove:[],pointerup:[],pointerenter:[],pointerleave:[],click:[],dblclick:[],contextmenu:[]})},O=function(n,i,e=y.validate){n.key!=="parent"&&r.Rule(n,i,e)},b=new WeakMap,m=function({target:n,config:i,value:e,engine:a}){if(i.vid===e){console.warn("can not set object lookAt itself.");return}let t=b.get(n);if(t||(t={lookAtTarget:null,updateMatrixWorldFun:null},b.set(n,t)),!e){if(!t.updateMatrixWorldFun)return;n.updateMatrixWorld=t.updateMatrixWorldFun,t.lookAtTarget=null,t.updateMatrixWorldFun=null;return}r.globalAntiShake.exec(c=>{const u=a.compilerManager.getObjectfromModules(r.OBJECTMODULE,e);if(!u)return c&&console.warn(`lookAt handler can not found this vid mapping object: '${e}'`),!1;const f=n.updateMatrixWorld;return t.updateMatrixWorldFun=f,t.lookAtTarget=u.position,n.updateMatrixWorld=x=>{f.call(n,x),n.lookAt(t.lookAtTarget)},!0})},p="vis.event",l=function({target:n,path:i,value:e,engine:a}){const t=i[0];if(!r.EventGeneratorManager.has(e.name)){console.warn(`EventGeneratorManager: can not support this event: ${e.name}`);return}const c=r.EventGeneratorManager.generateEvent(e,a),u=Symbol.for(p);e[u]=c,n.addEventListener(t,c)},s=function({target:n,path:i,value:e}){const a=i[0],t=e[Symbol.for(p)];if(!t){console.warn("event remove can not fun found event in config",e);return}n.removeEventListener(a,t),delete e[Symbol.for(p)]},d=function({target:n,config:i,path:e,engine:a}){if(e.length<2)return;const t=e[0],c=i[e[0]][e[1]],u=c[Symbol.for(p)];if(!u){console.warn("event remove can not fun found event in config",c);return}n.removeEventListener(t,u);const f=r.EventGeneratorManager.generateEvent(c,a);c[Symbol.for(p)]=f,n.addEventListener(t,f)},v=function({target:n,config:i,value:e,engine:a}){r.globalObjectModuleTrigger.registerExec(t=>{const c=a.getConfigBySymbol(e);if(!c)return t||console.warn(` can not foud object config in engine: ${e}`),!1;if(c.parent&&c.parent!==i.vid){const f=a.getConfigBySymbol(c.parent);if(!f)return t||console.warn(` can not foud object parent config in engine: ${c.parent}`),!1;f.children.splice(f.children.indexOf(e),1)}c.parent=i.vid;const u=a.compilerManager.getObjectfromModules(r.OBJECTMODULE,e);return u?(n.add(u),u.updateMatrixWorld(!0),r.Bus.compilerEvent.emit(u,`${r.COMPILER_EVENT.COMPILE}:parent`),!0):(t||console.warn(`can not found this vid in engine: ${e}.`),!1)})},h=function({target:n,config:i,value:e,engine:a}){const t=a.compilerManager.getObjectfromModules(r.OBJECTMODULE,e);if(!t){console.warn(`can not found this vid in engine: ${e}.`);return}n.remove(t);const c=a.getConfigBySymbol(e);if(!c){console.warn(`can not found this vid in engine: ${e}.`);return}c.parent="",r.Bus.compilerEvent.emit(t,`${r.COMPILER_EVENT.COMPILE}:parent`)},g=function(){},E=function({target:n,config:i,value:e,engine:a}){e?delete n.raycast:n.raycast=g},j=function(n,i,e,a){!e.lookAt&&m({target:n,config:i,engine:a,value:i.lookAt}),!i.raycast&&(n.raycast=g),i.children.forEach(t=>{v({target:n,config:i,value:t,engine:a})});for(const t of Object.values(r.EVENTNAME))r.globalAntiShake.nextTick(()=>(i[t].forEach((c,u)=>{l({target:n,path:[t,u.toString()],value:c,engine:a})}),!0));return M.syncObject(i,n,{vid:!0,type:!0,lookAt:!0,parent:!0,children:!0,raycast:!0,pointerdown:!0,pointermove:!0,pointerup:!0,pointerenter:!0,pointerleave:!0,click:!0,dblclick:!0,contextmenu:!0,...e}),n},A=function(n){n._listener={}},S={add:{pointerdown:l,pointerup:l,pointermove:l,pointerenter:l,pointerleave:l,click:l,dblclick:l,contextmenu:l,children:v},set:{lookAt:m,pointerdown:d,pointerup:d,pointermove:d,pointerenter:d,pointerleave:d,click:d,dblclick:d,contextmenu:d,parent:r.emptyHandler,raycast:E,children:{$reg:[{reg:new RegExp(".*"),handler:v}]}},delete:{pointerdown:s,pointerup:s,pointermove:s,pointerenter:s,pointerleave:s,click:s,dblclick:s,contextmenu:s,children:h}};o.ObjectCompiler=k,o.ObjectRule=O,o.addChildrenHanlder=v,o.addEventHanlder=l,o.getObjectConfig=C,o.lookAtHandler=m,o.objectCommands=S,o.objectCreate=j,o.objectDispose=A,o.raycastHandler=E,o.removeChildrenHandler=h,o.removeEventHandler=s,o.updateEventHandler=d,Object.defineProperties(o,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
