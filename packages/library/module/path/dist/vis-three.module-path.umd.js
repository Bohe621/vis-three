(function(u,a){typeof exports=="object"&&typeof module!="undefined"?a(exports,require("@vis-three/middleware"),require("uuid"),require("three")):typeof define=="function"&&define.amd?define(["exports","@vis-three/middleware","uuid","three"],a):(u=typeof globalThis!="undefined"?globalThis:u||self,a((u["vis-three"]=u["vis-three"]||{},u["vis-three"]["module-path"]={}),u.middleware,u.uuid,u.three))})(this,function(u,a,V,c){"use strict";var se=Object.defineProperty;var re=(u,a,V)=>a in u?se(u,a,{enumerable:!0,configurable:!0,writable:!0,value:V}):u[a]=V;var d=(u,a,V)=>(re(u,typeof a!="symbol"?a+"":a,V),V);class I extends a.Compiler{constructor(){super()}compile(t,r){return super.compile(t,r),this}}const W=function(e,t,r=V.validate){a.Rule(e,t,r)},L=function(){return Object.assign(a.getSymbolConfig(),{curves:[],autoClose:!1})},O=function(){return Object.assign(a.getSymbolConfig(),{curves:[],autoClose:!1})},l=class extends c.EllipseCurve{constructor(r,s,n,o,i,p){super(0,0,1,1,0,Math.PI*2,!1,0);d(this,"start",new c.Vector2);d(this,"end",new c.Vector2);d(this,"vertical",0);d(this,"center",new c.Vector2);d(this,"mid",new c.Vector2);const m=r,x=n,y=i,v=s,C=o,P=p,j=m-x,T=v-C,D=m-y,Q=v-P,U=(m*m-x*x+(v*v-C*C))/2,k=(m*m-y*y+(v*v-P*P))/2,F=T*D-j*Q,M=-(Q*U-T*k)/F,q=-(j*k-D*U)/F,Z=(y+m)/2,G=(P+v)/2,H=l.isLeft(l.tempVector1.set(m,v),l.tempVector2.set(y,P),l.tempVector3.set(M,q)),J=l.tempVector1.set(M,q).sub(l.tempVector2.set(Z,G)).length()*(H?-1:1);this.start.set(r,s),this.end.set(i,p),this.vertical=J;const _=this.start,K=this.end,w=this.center.copy(this.end).sub(this.start),R=this.mid.set(Z,G);w.set(-w.y,w.x).negate().normalize().multiplyScalar(J).add(R),this.aX=w.x,this.aY=w.y;const g=l.tempVector1;this.xRadius=g.copy(K).sub(w).length(),this.yRadius=this.xRadius,this.aStartAngle=g.copy(_).sub(w).angle(),this.aEndAngle=g.copy(K).sub(w).angle();const ee=l.tempVector2.set(x,C).sub(R),te=l.tempVector3.set(M,q).sub(R);this.aClockwise=!((H?1:-1)*(l.isSameDirecton(ee,te)?1:-1)<0)}};let h=l;d(h,"isLeft",function(r,s,n){return(s.x-r.x)*(n.y-r.y)-(s.y-r.y)*(n.x-r.x)>0}),d(h,"isSameDirecton",function(r,s){const n=Math.sqrt(r.lengthSq()*s.lengthSq());if(n===0)return!1;const o=r.dot(s)/n;return Math.acos(c.MathUtils.clamp(o,-1,1))<Math.PI/2}),d(h,"tempVector1",new c.Vector2),d(h,"tempVector2",new c.Vector2),d(h,"tempVector3",new c.Vector2);const $={arc:(e,t,r,s,n,o)=>new h(e,t,r,s,n,o),line:(e,t,r,s)=>new c.LineCurve(new c.Vector2(e,t),new c.Vector2(r,s)),bezier:(e,t,r,s,n,o,i,p)=>new c.CubicBezierCurve(new c.Vector2(e,t),new c.Vector2(r,s),new c.Vector2(n,o),new c.Vector2(i,p)),cubic:(e,t,r,s,n,o,i,p)=>new c.CubicBezierCurve(new c.Vector2(e,t),new c.Vector2(r,s),new c.Vector2(n,o),new c.Vector2(i,p)),quadratic:(e,t,r,s,n,o)=>new c.QuadraticBezierCurve(new c.Vector2(e,t),new c.Vector2(r,s),new c.Vector2(n,o))},f=function(e,t){return t==="start"?{x:e.params[0],y:e.params[1]}:{x:e.params[e.params.length-2],y:e.params[e.params.length-1]}},b=function(e){return $[e.curve]?$[e.curve](...e.params):(console.warn(`path processor can not support this curve: ${e.curve}`),null)},z=function(e,t,r){if(r==="start")e.params[0]!==t[0]&&(e.params[0]=t[0]),e.params[1]!==t[1]&&(e.params[1]=t[1]);else{const s=e.params.length-1;e.params[s-1]!==t[0]&&(e.params[s-1]=t[0]),e.params[s]!==t[1]&&(e.params[s]=t[1])}};var Y=a.defineProcessor({type:"Path",config:L,commands:{add:{curves({target:e,config:t,value:r}){const s=b(r);s&&e.curves.push(s)}},set:{curves({target:e,config:t,path:r,key:s}){let n=Number(r[1]);if(!Number.isInteger(n)){if(Number.isInteger(Number(s)))return;console.warn("path processor: set curves path error:",r);return}const o=b(t.curves[n]);e.curves[n]=o;const i=f(t.curves[n],"start"),p=f(t.curves[n],"end");n-1>=0&&z(t.curves[n-1],[i.x,i.y],"end"),n+1<=t.curves.length-1&&z(t.curves[n+1],[p.x,p.y],"start")}},delete:{curves({target:e,config:t,key:r}){const s=Number(r);if(!(e.curves.length-1<s)&&(e.curves.splice(s,1),s<=t.curves.length-1&&s-1>=0)){const n=f(t.curves[s-1],"end");z(t.curves[s],[n.x,n.y],"start")}}}},create(e,t){const r=new c.Path;if(e.curves.length)for(const s of e.curves){const n=b(s);n&&r.curves.push(n)}return r.autoClose=e.autoClose,r},dispose(e){e.curves=[]}});const B={line:(e,t,r,s,n,o)=>new c.LineCurve3(new c.Vector3(e,t,r),new c.Vector3(s,n,o)),cubic:(e,t,r,s,n,o,i,p,m,x,y,v)=>new c.CubicBezierCurve3(new c.Vector3(e,t,r),new c.Vector3(s,n,o),new c.Vector3(i,p,m),new c.Vector3(x,y,v)),quadratic:(e,t,r,s,n,o,i,p,m)=>new c.QuadraticBezierCurve3(new c.Vector3(e,t,r),new c.Vector3(s,n,o),new c.Vector3(i,p,m))},S=function(e,t){return t==="start"?{x:e.params[0],y:e.params[1],z:e.params[2]}:{x:e.params[e.params.length-3],y:e.params[e.params.length-2],z:e.params[e.params.length-1]}},N=function(e){return B[e.curve]?B[e.curve](...e.params):(console.warn(`path3 processor can not support this curve: ${e.curve}`),null)},E=function(e,t,r){if(r==="start")e.params[0]!==t[0]&&(e.params[0]=t[0]),e.params[1]!==t[1]&&(e.params[1]=t[1]),e.params[2]!==t[2]&&(e.params[2]=t[2]);else{const s=e.params.length-1;e.params[s-2]!==t[0]&&(e.params[s-2]=t[0]),e.params[s-1]!==t[1]&&(e.params[s-1]=t[1]),e.params[s]!==t[2]&&(e.params[s]=t[2])}};var X=a.defineProcessor({type:"Path3",config:O,commands:{add:{curves({target:e,config:t,value:r}){const s=N(r);s&&e.curves.push(s)}},set:{curves({target:e,config:t,path:r,key:s}){let n=Number(r[1]);if(!Number.isInteger(n)){if(Number.isInteger(Number(s)))return;console.warn("path3 processor: set curves path error:",r);return}const o=N(t.curves[n]);e.curves[n]=o;const i=S(t.curves[n],"start"),p=S(t.curves[n],"end");n-1>=0&&E(t.curves[n-1],[i.x,i.y,i.z],"end"),n+1<=t.curves.length-1&&E(t.curves[n+1],[p.x,p.y,p.z],"start")}},delete:{curves({target:e,config:t,key:r}){const s=Number(r);if(!(e.curves.length-1<s)&&(e.curves.splice(s,1),s<=t.curves.length-1&&s-1>=0)){const n=S(t.curves[s-1],"end");E(t.curves[s],[n.x,n.y,n.z],"start")}}}},create(e,t){const r=new c.Path;if(e.curves.length)for(const s of e.curves){const n=N(s);n&&r.curves.push(n)}return r.autoClose=e.autoClose,r},dispose(e){e.curves=[]}}),A={type:"path",compiler:I,rule:W,processors:[Y,X],lifeOrder:a.SUPPORT_LIFE_CYCLE.ZERO};u.PathCompiler=I,u.default=A,u.getPath3Config=O,u.getPathConfig=L,Object.defineProperties(u,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
