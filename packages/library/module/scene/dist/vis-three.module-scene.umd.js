(function(r,s){typeof exports=="object"&&typeof module!="undefined"?s(exports,require("@vis-three/middleware"),require("@vis-three/module-object"),require("three"),require("uuid")):typeof define=="function"&&define.amd?define(["exports","@vis-three/middleware","@vis-three/module-object","three","uuid"],s):(r=typeof globalThis!="undefined"?globalThis:r||self,s((r["vis-three"]=r["vis-three"]||{},r["vis-three"]["module-scene"]={}),r.middleware,r.moduleObject,r.three,r.uuid))})(this,function(r,s,f,i,u){"use strict";class l extends f.ObjectCompiler{constructor(){super()}}function m(e){e.setSceneBySymbol=function(o){const n=this.compilerManager.getCompiler(s.MODULETYPE.SCENE);return n.map.has(o)?this.setScene(n.map.get(o)):console.warn("can not found scene",o),this}}const d=function(){return Object.assign(f.getObjectConfig(),{vid:s.uniqueSymbol("Scene"),background:"",environment:"",fog:{type:"",color:"rgb(150, 150, 150)",near:1,far:200,density:.003}})},p=function(e,o,n){if(!o){e.background=null;return}if(u.validate(o)){const t=n.compilerManager.getObjectfromModule(s.MODULETYPE.TEXTURE,o);t?e.background=t:console.warn(`engine can not found this vid texture : '${o}'`)}else e.background=new i.Color(o)},g=function(e,o,n){if(!o){e.environment=null;return}if(u.validate(o)){const t=n.compilerManager.getObjectfromModule(s.MODULETYPE.TEXTURE,o);t?e.environment=t:console.warn(`engine can not found this vid texture : '${o}'`)}else console.warn(`scene environment is illeage: ${o}`)};var a=s.defineProcessor({type:"Scene",config:d,commands:{add:f.objectCommands.add,set:{...f.objectCommands.set,lookAt(){},fog({target:e,config:o,key:n,value:t}){const c=o.fog;c.type?c.type==="Fog"?!e.fog||!(e.fog instanceof i.Fog)?e.fog=new i.Fog(c.color,c.near,c.far):n==="color"?e.fog.color.copy(new i.Color(c.color)):e.fog[n]&&(e.fog[n]=t):c.type==="FogExp2"&&(!e.fog||!(e.fog instanceof i.FogExp2)?e.fog=new i.FogExp2(c.color,c.density):n==="color"?e.fog.color.copy(new i.Color(c.color)):e.fog[n]&&(e.fog[n]=t)):e.fog=null},background({target:e,value:o,engine:n}){p(e,o,n)},environment({target:e,value:o,engine:n}){g(e,o,n)}},delete:f.objectCommands.delete},create(e,o){const n=new i.Scene;if(p(n,e.background,o),g(n,e.environment,o),e.fog.type){const t=e.fog;t.type==="Fog"?n.fog=new i.Fog(t.color,t.near,t.far):t.type==="FogExp2"?n.fog=new i.FogExp2(t.color,t.density):console.warn(`scene processor can not support this type fog:'${e.type}'`)}return f.objectCreate(n,e,{lookAt:!0,background:!0,environment:!0,fog:!0},o)},dispose:f.objectDispose});const E=[s.uniqueSymbol("Scene")];var S={type:"scene",object:!0,compiler:l,rule:function(e,o){f.ObjectRule(e,o,n=>u.validate(n)||E.includes(n))},processors:[a],extend:m,lifeOrder:s.SUPPORT_LIFE_CYCLE.THREE+1};r.SceneCompiler=l,r.default=S,r.getSceneConfig=d,Object.defineProperties(r,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
