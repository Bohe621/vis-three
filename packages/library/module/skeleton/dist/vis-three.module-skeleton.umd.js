(function(n,s){typeof exports=="object"&&typeof module<"u"?s(exports,require("@vis-three/tdcm"),require("three")):typeof define=="function"&&define.amd?define(["exports","@vis-three/tdcm","three"],s):(n=typeof globalThis<"u"?globalThis:n||self,s((n["vis-three"]=n["vis-three"]||{},n["vis-three"]["module-skeleton"]={}),n.tdcm,n.three))})(this,function(n,s,i){"use strict";const d=function(){return Object.assign(s.getBasicConfig(),{bones:[],boneInverses:[]})},u=function(){return Object.assign(s.getBasicConfig(),{url:""})},b=s.defineModel({type:"Skeleton",config:d,commands:{add:{bones({target:e,value:o,engine:t}){const r=t.getObjectBySymbol(o);r?(e.bones.push(r),e.boneInverses=[],e.init()):console.warn(`skeleton processor can not found bone in engine: ${o}`)}},set:{},delete:{bones({target:e,value:o,engine:t}){e.bones.splice(o,1),e.boneInverses=[],e.init()}}},create({model:e,config:o,engine:t}){const r=[];o.bones.forEach(l=>{const c=t.getObjectBySymbol(l);c?r.push(c):console.warn(`skeleton processor can not found bone in engine: ${l}`)});const f=new i.Skeleton(r,o.boneInverses.length?o.boneInverses.map(l=>{const c=new i.Matrix4;return c.elements=[].concat(l),c}):[]);return o.boneInverses.length||e.toTrigger("object",()=>(f.calculateInverses(),!1)),f},dispose({target:e}){e.bones=[],e.boneInverses=[],e.dispose()}}),a=s.defineModel({type:"LoadSkeleton",config:u,commands:{set:{url(){}}},create({config:e,engine:o}){const t=o.resourceManager.resourceMap.get(e.url);return!t&&!(t instanceof i.Skeleton)?(console.error(`LoadSkeletonProcessor: engine rescoure can not found url: ${e.url}`),new i.Skeleton([new i.Bone])):new i.Skeleton([].concat(t.bones),[].concat(t.boneInverses))},dispose({target:e}){e.bones=[],e.boneInverses=[],e.dispose()}}),p=s.defineModule({type:"skeleton",models:[b,a],lifeOrder:s.SUPPORT_LIFE_CYCLE.THREE-1});n.default=p,n.getLoadSkeletonConfig=u,n.getSkeletonConfig=d,Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
