(function(n,o){typeof exports=="object"&&typeof module!="undefined"?o(exports,require("@vis-three/middleware"),require("uuid"),require("three")):typeof define=="function"&&define.amd?define(["exports","@vis-three/middleware","uuid","three"],o):(n=typeof globalThis!="undefined"?globalThis:n||self,o((n["vis-three"]=n["vis-three"]||{},n["vis-three"]["module-skeleton"]={}),n.middleware,n.uuid,n.three))})(this,function(n,o,b,r){"use strict";class l extends o.Compiler{constructor(){super()}}const a=function(e,t,s=b.validate){o.Rule(e,t,s)},f=function(){return Object.assign(o.getSymbolConfig(),{bones:[],boneInverses:[]})},d=function(){return Object.assign(o.getSymbolConfig(),{url:""})};var p=o.defineProcessor({type:"Skeleton",config:f,commands:{add:{bones({target:e,value:t,engine:s}){const i=s.getObjectBySymbol(t);i?(e.bones.push(i),e.boneInverses=[],e.init()):console.warn(`skeleton processor can not found bone in engine: ${t}`)}},set:{},delete:{bones({target:e,value:t,engine:s}){e.bones.splice(t,1),e.boneInverses=[],e.init()}}},create(e,t){const s=[];e.bones.forEach(u=>{const c=t.getObjectBySymbol(u);c?s.push(c):console.warn(`skeleton processor can not found bone in engine: ${u}`)});const i=new r.Skeleton(s,e.boneInverses.length?e.boneInverses.map(u=>{const c=new r.Matrix4;return c.elements=[].concat(u),c}):[]);return e.boneInverses.length||o.globalObjectModuleTrigger.registerExec(()=>(i.calculateInverses(),!1)),i},dispose(e){e.bones=[],e.boneInverses=[],e.dispose()}}),S=o.defineProcessor({type:"LoadSkeleton",config:d,commands:{set:{url(){}}},create(e,t){const s=t.resourceManager.resourceMap.get(e.url);return!s&&!(s instanceof r.Skeleton)?(console.error(`LoadSkeletonProcessor: engine rescoure can not found url: ${e.url}`),new r.Skeleton([new r.Bone])):new r.Skeleton([].concat(s.bones),[].concat(s.boneInverses))},dispose(e){e.bones=[],e.boneInverses=[],e.dispose()}}),k={type:"skeleton",compiler:l,rule:a,processors:[p,S],lifeOrder:o.SUPPORT_LIFE_CYCLE.THREE-1};n.SkeletonCompiler=l,n.default=k,n.getLoadSkeletonConfig=d,n.getSkeletonConfig=f,Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
