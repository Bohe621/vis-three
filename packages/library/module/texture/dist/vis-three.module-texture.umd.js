(function(a,i){typeof exports=="object"&&typeof module<"u"?i(exports,require("three"),require("@vis-three/tdcm"),require("@vis-three/convenient"),require("@vis-three/utils")):typeof define=="function"&&define.amd?define(["exports","three","@vis-three/tdcm","@vis-three/convenient","@vis-three/utils"],i):(a=typeof globalThis<"u"?globalThis:a||self,i((a["vis-three"]=a["vis-three"]||{},a["vis-three"]["module-texture"]={}),a.three,a.tdcm,a.convenient,a.utils))})(this,function(a,i,c,L,g){"use strict";const o=function(){return Object.assign(c.getBasicConfig(),{mapping:i.UVMapping,wrapS:i.ClampToEdgeWrapping,wrapT:i.ClampToEdgeWrapping,magFilter:i.LinearFilter,minFilter:i.LinearMipmapLinearFilter,anisotropy:1,format:i.RGBAFormat,flipY:!0,offset:{x:0,y:0},repeat:{x:1,y:1},rotation:0,center:{x:0,y:0},matrixAutoUpdate:!0,needsUpdate:!1})},m=function(){return Object.assign(o(),{url:""})},l=function(){return Object.assign(o(),{url:"",minFilter:i.LinearFilter})},T=function(){return Object.assign(o(),{cube:{nx:"",ny:"",nz:"",px:"",py:"",pz:""},mapping:i.CubeReflectionMapping,flipY:!1})},x=function(){return Object.assign(o(),{url:"",needsUpdate:!1})},y=function(){return Object.assign(o(),{url:""})},d=new L.CanvasGenerator({width:512,height:512}).draw(e=>{e.translate(256,256),e.font="72px",e.fillStyle="white",e.fillText("暂无图片",0,0)}).getDom(),M=function(e,t,n){const r=t.resourceManager.resourceMap;if(!r.has(e))return console.warn(`engine resourceManager can not found this url: ${e}`),d;const s=r.get(e);if(Array.isArray(n)){for(const u of n)if(s instanceof u)return s;return console.warn(`this url mapping resource is not a texture image class: ${e}`,s),d}else return s instanceof n?s:(console.warn(`this url mapping resource is not a texture image class: ${e}`,s),d)},p=c.defineModel.extend({shared:{replaceImage:d,getResource:M},commands:{set:{$reg:[{reg:new RegExp("wrapS|wrapT|format|encoding|anisotropy|magFilter|minFilter|mapping|flipY"),handler({target:e,key:t,value:n}){e[t]=n,e.needsUpdate=!0}}]}}}),E=p(()=>({type:"CanvasTexture",config:x,commands:{set:{url({model:e,target:t,value:n,engine:r}){e.toAsync(s=>(t.image=e.getResource(n,r,[HTMLImageElement,HTMLVideoElement,HTMLCanvasElement]),t.needsUpdate=!0,t.image!==e.replaceImage))}}},create({model:e,config:t,engine:n}){const r=new i.CanvasTexture(e.replaceImage);return e.toAsync(s=>(r.image=e.getResource(t.url,n,[HTMLImageElement,HTMLVideoElement,HTMLCanvasElement]),r.needsUpdate=!0,r.image!==e.replaceImage)),g.syncObject(t,r,{type:!0,url:!0}),r.needsUpdate=!0,r},dispose({target:e}){e.dispose()}})),v=p(()=>({type:"CubeTexture",config:T,shared:{imageHanlder({model:e,target:t,index:n,value:r}){t.images[n]=e.getResource(r,[HTMLImageElement,HTMLVideoElement,HTMLCanvasElement]),t.needsUpdate=!0}},commands:{set:{cube:{px({model:e,target:t,value:n}){e.imageHanlder({model:e,target:t,value:n,index:0})},nx({model:e,target:t,value:n}){e.imageHanlder({model:e,target:t,value:n,index:1})},py({model:e,target:t,value:n}){e.imageHanlder({model:e,target:t,value:n,index:2})},ny({model:e,target:t,value:n}){e.imageHanlder({model:e,target:t,value:n,index:3})},pz({model:e,target:t,value:n}){e.imageHanlder({model:e,target:t,value:n,index:4})},nz({model:e,target:t,value:n}){e.imageHanlder({model:e,target:t,value:n,index:5})}}}},create({model:e,config:t,engine:n}){const r=new i.CubeTexture,s=t.cube,u=[HTMLImageElement,HTMLVideoElement,HTMLCanvasElement],f=[e.getResource(s.px,n,u),e.getResource(s.nx,n,u),e.getResource(s.py,n,u),e.getResource(s.ny,n,u),e.getResource(s.pz,n,u),e.getResource(s.nz,n,u)];return r.image=f,g.syncObject(t,r,{type:!0,cube:!0}),r.needsUpdate=!0,r},dispose({target:e}){e.dispose()}}));class H extends i.Texture{constructor(t,n,r,s,u,f,U,O,j){super(t,n,r,s,u,f,U,O,j)}}const I=p(()=>({type:"ImageTexture",config:m,commands:{set:{url({model:e,target:t,value:n,engine:r}){e.toAsync(s=>(t.image=e.getResource(n,r,[HTMLImageElement,HTMLVideoElement,HTMLCanvasElement]),t.needsUpdate=!0,t.image!==e.replaceImage))}}},create({model:e,config:t,engine:n}){const r=new H(e.replaceImage);return t.url&&e.toAsync(s=>(r.image=e.getResource(t.url,n,[HTMLImageElement,HTMLVideoElement,HTMLCanvasElement]),r.needsUpdate=!0,r.image!==e.replaceImage)),g.syncObject(t,r,{type:!0,url:!0}),r.needsUpdate=!0,r},dispose({target:e}){e.dispose()}}));class C extends i.Texture{constructor(t){super(),Object.keys(t).forEach(n=>{this[n]=t[n]}),this.copy(t)}}const b=p(()=>({type:"LoadTexture",config:y,commands:{set:{url(){}}},create({model:e,config:t,engine:n}){let r;const s=e.getResource(t.url,n,i.Texture);if(s instanceof i.Texture)r=new C(s);else{const u=new i.Texture(s);r=new C(u)}return g.syncObject(t,r,{type:!0,url:!0}),r.needsUpdate=!0,r},dispose({target:e}){e.dispose()}})),h=p(()=>({type:"VideoTexture",config:l,commands:{set:{url({model:e,target:t,value:n,engine:r}){e.toAsync(s=>(t.image=e.getResource(n,r,[HTMLVideoElement]),t.needsUpdate=!0,t.image!==e.replaceImage))}}},create({model:e,config:t,engine:n}){const r=new i.VideoTexture(document.createElement("video"));return t.url&&e.toAsync(s=>(r.image=e.getResource(t.url,n,[HTMLVideoElement]),r.needsUpdate=!0,r.image!==e.replaceImage)),g.syncObject(t,r,{type:!0,url:!0}),r.needsUpdate=!0,r},dispose({target:e}){e.dispose()}}));function w(e){e.generateLoadTextureConfig=function(t){const n=M(t,this,i.Texture);return n instanceof HTMLCanvasElement?null:c.generateConfig(c.CONFIG_TYPE.LOADTEXTURE,{url:t,flipY:n.flipY,format:n.format,mapping:n.mapping,minFilter:n.minFilter,magFilter:n.magFilter})}}const R=c.defineModule({type:"texture",models:[E,v,I,b,h],extend:w});a.default=R,a.getCanvasTextureConfig=x,a.getCubeTextureConfig=T,a.getImageTextureConfig=m,a.getLoadTextureConfig=y,a.getTextureConfig=o,a.getVideoTextureConfig=l,Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
