(function(a,i){typeof exports=="object"&&typeof module<"u"?i(exports,require("three"),require("@vis-three/tdcm"),require("@vis-three/convenient"),require("@vis-three/utils")):typeof define=="function"&&define.amd?define(["exports","three","@vis-three/tdcm","@vis-three/convenient","@vis-three/utils"],i):(a=typeof globalThis<"u"?globalThis:a||self,i((a["vis-three"]=a["vis-three"]||{},a["vis-three"]["module-texture"]={}),a.three,a.tdcm,a.convenient,a.utils))})(this,function(a,i,c,L,g){"use strict";const o=function(){return Object.assign(c.getBasicConfig(),{mapping:i.UVMapping,wrapS:i.ClampToEdgeWrapping,wrapT:i.ClampToEdgeWrapping,magFilter:i.LinearFilter,minFilter:i.LinearMipmapLinearFilter,anisotropy:1,format:i.RGBAFormat,flipY:!0,offset:{x:0,y:0},repeat:{x:1,y:1},rotation:0,center:{x:0,y:0},matrixAutoUpdate:!0,needsUpdate:!1})},m=function(){return Object.assign(o(),{url:""})},l=function(){return Object.assign(o(),{url:"",minFilter:i.LinearFilter})},T=function(){return Object.assign(o(),{cube:{nx:"",ny:"",nz:"",px:"",py:"",pz:""},mapping:i.CubeReflectionMapping,flipY:!1})},x=function(){return Object.assign(o(),{url:"",needsUpdate:!1})},y=function(){return Object.assign(o(),{url:""})},d=new L.CanvasGenerator({width:512,height:512}).draw(e=>{e.translate(256,256),e.font="72px",e.fillStyle="white",e.fillText("暂无图片",0,0)}).getDom(),M=function(e,t,r){const n=t.resourceManager.resourceMap;if(!n.has(e))return console.warn(`engine resourceManager can not found this url: ${e}`),d;const s=n.get(e);if(Array.isArray(r)){for(const u of r)if(s instanceof u)return s;return console.warn(`this url mapping resource is not a texture image class: ${e}`,s),d}else return s instanceof r?s:(console.warn(`this url mapping resource is not a texture image class: ${e}`,s),d)},p=c.defineModel.extend({shared:{replaceImage:d,getResource:M},commands:{set:{$reg:[{reg:new RegExp("wrapS|wrapT|format|encoding|anisotropy|magFilter|minFilter|mapping|flipY"),handler({target:e,key:t,value:r}){e[t]=r,e.needsUpdate=!0}}]}}}),E=p(()=>({type:"CanvasTexture",config:x,commands:{set:{url({model:e,target:t,value:r,engine:n}){e.toAsync(s=>(t.image=e.getResource(r,n,[HTMLImageElement,HTMLVideoElement,HTMLCanvasElement]),t.needsUpdate=!0,t.image!==e.replaceImage))}}},create({model:e,config:t,engine:r}){const n=new i.CanvasTexture(e.replaceImage);return e.toAsync(s=>(n.image=e.getResource(t.url,r,[HTMLImageElement,HTMLVideoElement,HTMLCanvasElement]),n.needsUpdate=!0,n.image!==e.replaceImage)),g.syncObject(t,n,{type:!0,url:!0}),n.needsUpdate=!0,n},dispose({target:e}){e.dispose()}})),v=p(()=>({type:"CubeTexture",config:T,shared:{imageHanlder({model:e,target:t,index:r,value:n,engine:s}){t.images[r]=e.getResource(n,s,[HTMLImageElement,HTMLVideoElement,HTMLCanvasElement]),t.needsUpdate=!0}},commands:{set:{cube:{px({model:e,target:t,value:r,engine:n}){e.imageHanlder({model:e,target:t,value:r,index:0,engine:n})},nx({model:e,target:t,value:r,engine:n}){e.imageHanlder({model:e,target:t,value:r,index:1,engine:n})},py({model:e,target:t,value:r,engine:n}){e.imageHanlder({model:e,target:t,value:r,index:2,engine:n})},ny({model:e,target:t,value:r,engine:n}){e.imageHanlder({model:e,target:t,value:r,index:3,engine:n})},pz({model:e,target:t,value:r,engine:n}){e.imageHanlder({model:e,target:t,value:r,index:4,engine:n})},nz({model:e,target:t,value:r,engine:n}){e.imageHanlder({model:e,target:t,value:r,index:5,engine:n})}}}},create({model:e,config:t,engine:r}){const n=new i.CubeTexture,s=t.cube,u=[HTMLImageElement,HTMLVideoElement,HTMLCanvasElement],f=[e.getResource(s.px,r,u),e.getResource(s.nx,r,u),e.getResource(s.py,r,u),e.getResource(s.ny,r,u),e.getResource(s.pz,r,u),e.getResource(s.nz,r,u)];return n.image=f,g.syncObject(t,n,{type:!0,cube:!0}),n.needsUpdate=!0,n},dispose({target:e}){e.dispose()}}));class H extends i.Texture{constructor(t,r,n,s,u,f,U,O,j){super(t,r,n,s,u,f,U,O,j)}}const I=p(()=>({type:"ImageTexture",config:m,commands:{set:{url({model:e,target:t,value:r,engine:n}){e.toAsync(s=>(t.image=e.getResource(r,n,[HTMLImageElement,HTMLVideoElement,HTMLCanvasElement]),t.needsUpdate=!0,t.image!==e.replaceImage))}}},create({model:e,config:t,engine:r}){const n=new H(e.replaceImage);return t.url&&e.toAsync(s=>(n.image=e.getResource(t.url,r,[HTMLImageElement,HTMLVideoElement,HTMLCanvasElement]),n.needsUpdate=!0,n.image!==e.replaceImage)),g.syncObject(t,n,{type:!0,url:!0}),n.needsUpdate=!0,n},dispose({target:e}){e.dispose()}}));class C extends i.Texture{constructor(t){super(),Object.keys(t).forEach(r=>{this[r]=t[r]}),this.copy(t)}}const b=p(()=>({type:"LoadTexture",config:y,commands:{set:{url(){}}},create({model:e,config:t,engine:r}){let n;const s=e.getResource(t.url,r,i.Texture);if(s instanceof i.Texture)n=new C(s);else{const u=new i.Texture(s);n=new C(u)}return g.syncObject(t,n,{type:!0,url:!0}),n.needsUpdate=!0,n},dispose({target:e}){e.dispose()}})),h=p(()=>({type:"VideoTexture",config:l,commands:{set:{url({model:e,target:t,value:r,engine:n}){e.toAsync(s=>(t.image=e.getResource(r,n,[HTMLVideoElement]),t.needsUpdate=!0,t.image!==e.replaceImage))}}},create({model:e,config:t,engine:r}){const n=new i.VideoTexture(document.createElement("video"));return t.url&&e.toAsync(s=>(n.image=e.getResource(t.url,r,[HTMLVideoElement]),n.needsUpdate=!0,n.image!==e.replaceImage)),g.syncObject(t,n,{type:!0,url:!0}),n.needsUpdate=!0,n},dispose({target:e}){e.dispose()}}));function w(e){e.generateLoadTextureConfig=function(t){const r=M(t,this,i.Texture);return r instanceof HTMLCanvasElement?null:c.generateConfig(c.CONFIG_TYPE.LOADTEXTURE,{url:t,flipY:r.flipY,format:r.format,mapping:r.mapping,minFilter:r.minFilter,magFilter:r.magFilter})}}const R=c.defineModule({type:"texture",models:[E,v,I,b,h],extend:w});a.default=R,a.getCanvasTextureConfig=x,a.getCubeTextureConfig=T,a.getImageTextureConfig=m,a.getLoadTextureConfig=y,a.getTextureConfig=o,a.getVideoTextureConfig=l,Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
