(function(s,u){typeof exports=="object"&&typeof module<"u"?u(exports,require("@vis-three/core"),require("three"),require("@vis-three/utils")):typeof define=="function"&&define.amd?define(["exports","@vis-three/core","three","@vis-three/utils"],u):(s=typeof globalThis<"u"?globalThis:s||self,u((s["vis-three"]=s["vis-three"]||{},s["vis-three"]["plugin-pointer-manager"]={}),s.core,s.three,s.utils))})(this,function(s,u,r,p){"use strict";class c extends u.EventDispatcher{constructor(e){super(),this.dom=e.dom,this.mouse=new r.Vector2,this.canMouseMove=!0,this.mouseEventTimer=null,this.throttleTime=e.throttleTime||1e3/60;const t=o=>{const d={mouse:{x:this.mouse.x,y:this.mouse.y}};for(const a in o)d[a]=o[a];return d},i=o=>{o.preventDefault(),this.dispatchEvent(t(o))},n=o=>{this.dispatchEvent(t(o))};this.pointerMoveHandler=o=>{this.canMouseMove&&(this.canMouseMove=!1,this.mouseEventTimer=window.setTimeout(()=>{const d=this.mouse,a=this.dom,m=a.getBoundingClientRect();d.x=(o.clientX-m.left)/a.offsetWidth*2-1,d.y=-((o.clientY-m.top)/a.offsetHeight)*2+1,this.canMouseMove=!0,this.dispatchEvent(t(o))},this.throttleTime))},this.mouseDownHandler=n,this.mouseUpHandler=n,this.pointerDownHandler=n,this.pointerUpHandler=n,this.clickHandler=n,this.dblclickHandler=n,this.contextmenuHandler=i}setDom(e){if(this.dom){const t=this.dom;t.removeEventListener("mousedown",this.mouseDownHandler),t.removeEventListener("mouseup",this.mouseUpHandler),t.removeEventListener("pointerdown",this.pointerDownHandler),t.removeEventListener("pointermove",this.pointerMoveHandler),t.removeEventListener("pointerup",this.pointerUpHandler),t.removeEventListener("click",this.clickHandler),t.removeEventListener("dblclick",this.dblclickHandler),t.removeEventListener("contextmenu",this.contextmenuHandler)}return e.addEventListener("mousedown",this.mouseDownHandler),e.addEventListener("mouseup",this.mouseUpHandler),e.addEventListener("pointerdown",this.pointerDownHandler),e.addEventListener("pointermove",this.pointerMoveHandler),e.addEventListener("pointerup",this.pointerUpHandler),e.addEventListener("click",this.clickHandler),e.addEventListener("dblclick",this.dblclickHandler),e.addEventListener("contextmenu",this.contextmenuHandler),this.dom=e,this}getNormalMouse(){return this.mouse}getWorldPosition(e,t,i){if(!i&&(i=new r.Vector3),e instanceof r.PerspectiveCamera){const n=new r.Vector3(this.mouse.x,this.mouse.y,1).unproject(e).sub(i.setFromMatrixPosition(e.matrixWorld)).normalize();i.add(n.multiplyScalar(t))}else if(e instanceof r.OrthographicCamera){const n=new r.Vector3(this.mouse.x,this.mouse.y,(e.near+e.far)/(e.near-e.far)).unproject(e);i.set(0,0,-1).transformDirection(e.matrixWorld).add(n.multiplyScalar(t))}else console.warn(`pointer manager can not support this type camera: ${e.type}`);return i}intersectPlane(e,t,i){!i&&(i=new r.Vector3);const n=new r.Vector3,o=new r.Ray;if(e instanceof r.PerspectiveCamera){const d=new r.Vector3().setFromMatrixPosition(e.matrixWorld);n.set(this.mouse.x,this.mouse.y,1).unproject(e).sub(d).normalize(),o.set(d,n)}else if(e instanceof r.OrthographicCamera){n.set(this.mouse.x,this.mouse.y,(e.near+e.far)/(e.near-e.far)).unproject(e);const d=new r.Vector3().set(0,0,-1).transformDirection(e.matrixWorld);o.set(n,d)}else console.warn(`pointer manager can not support this type camera: ${e.type}`);return o.intersectPlane(t,i)}}const l=p.transPkgName("@vis-three/plugin-pointer-manager"),v=function(h){let e;return{name:l,install(t){const i=new c(Object.assign(h||{},{dom:t.dom}));e=n=>{i.setDom(n.dom)},t.addEventListener(u.ENGINE_EVENT.SETDOM,e),t.pointerManager=i},dispose(t){t.removeEventListener(u.ENGINE_EVENT.SETDOM,e),e=void 0}}};s.POINTER_MANAGER_PLUGIN=l,s.PointerManager=c,s.PointerManagerPlugin=v,Object.defineProperty(s,Symbol.toStringTag,{value:"Module"})});
