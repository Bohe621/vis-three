(function(r,c){typeof exports=="object"&&typeof module<"u"?c(exports,require("three"),require("three/examples/jsm/loaders/OBJLoader.js"),require("three/examples/jsm/loaders/MTLLoader.js"),require("three/examples/jsm/loaders/RGBELoader.js"),require("three/examples/jsm/loaders/GLTFLoader.js"),require("three/examples/jsm/loaders/FBXLoader.js"),require("three/examples/jsm/loaders/DRACOLoader.js"),require("three/examples/jsm/loaders/KTX2Loader.js"),require("three/examples/jsm/loaders/DDSLoader.js"),require("three/examples/jsm/libs/meshopt_decoder.module.js"),require("three/examples/jsm/loaders/LUTCubeLoader.js"),require("three/examples/jsm/loaders/LUT3dlLoader.js"),require("@vis-three/core"),require("@vis-three/utils")):typeof define=="function"&&define.amd?define(["exports","three","three/examples/jsm/loaders/OBJLoader.js","three/examples/jsm/loaders/MTLLoader.js","three/examples/jsm/loaders/RGBELoader.js","three/examples/jsm/loaders/GLTFLoader.js","three/examples/jsm/loaders/FBXLoader.js","three/examples/jsm/loaders/DRACOLoader.js","three/examples/jsm/loaders/KTX2Loader.js","three/examples/jsm/loaders/DDSLoader.js","three/examples/jsm/libs/meshopt_decoder.module.js","three/examples/jsm/loaders/LUTCubeLoader.js","three/examples/jsm/loaders/LUT3dlLoader.js","@vis-three/core","@vis-three/utils"],c):(r=typeof globalThis<"u"?globalThis:r||self,c((r["vis-three"]=r["vis-three"]||{},r["vis-three"]["plugin-loader-manager"]={}),r.three,r.OBJLoader_js,r.MTLLoader_js,r.RGBELoader_js,r.GLTFLoader_js,r.FBXLoader_js,r.DRACOLoader_js,r.KTX2Loader_js,r.DDSLoader_js,r.meshopt_decoder_module_js,r.LUTCubeLoader_js,r.LUT3dlLoader_js,r.core,r.utils))})(this,function(r,c,T,M,y,D,v,S,x,O,A,R,w,q,P){"use strict";const h=class h extends c.Loader{constructor(e){super(e)}load(e,t,n,d){this.path!==void 0&&(e=this.path+e),this.manager.itemStart(e),e=this.manager.resolveURL(e);const l=c.Cache.get(e);if(l!==void 0)return setTimeout(()=>{t&&t(l),this.manager.itemEnd(e)},0),l;const s=document.createElement("video");return s.preload=h.preload,s.autoplay=h.autoplay,s.loop=h.loop,s.muted=h.muted,s.src=e,s.style.position="fixed",s.style.top="0",s.style.left="0",s.style.zIndex="-1",document.body.appendChild(s),s.oncanplay=()=>{c.Cache.add(e,s),this.manager.itemEnd(e),t&&t(s)},s.onerror=o=>{this.manager.itemEnd(e),d&&d(o)},s}};h.autoplay=!0,h.preload="auto",h.muted=!0,h.loop=!0;let m=h;var u=(i=>(i.BEFORELOAD="beforeLoad",i.LOADING="loading",i.DETAILLOADING="detailLoading",i.DETAILLOADED="detailLoaded",i.LOADED="loaded",i))(u||{});class j extends q.EventDispatcher{constructor(e){super(),this.urlList=[],this.path="",this.resourceMap=new Map,this.loadTotal=0,this.loadSuccess=0,this.loadError=0,this.isError=!1,this.isLoading=!1,this.isLoaded=!1,this.loadDetailMap={};const t=new c.ImageLoader,n=new m,d=new D.GLTFLoader;d.setDRACOLoader(new S.DRACOLoader),d.setKTX2Loader(new x.KTX2Loader),d.setMeshoptDecoder(A.MeshoptDecoder),this.loaderMap={jpg:t,png:t,jpeg:t,obj:new T.OBJLoader,mtl:new M.MTLLoader,mp4:n,webm:n,ogg:n,hdr:new y.RGBELoader,gltf:d,glb:d,fbx:new v.FBXLoader,dds:new O.DDSLoader,cube:new R.LUTCubeLoader,"3dl":new w.LUT3dlLoader},e&&(this.loaderMap=Object.assign(this.loaderMap,e.loaderExtends))}loaded(){return this.dispatchEvent({type:"loaded",loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError,resourceMap:this.resourceMap}),this}checkLoaded(){return this.loadTotal===this.loadSuccess+this.loadError&&(this.isError=!0,this.isLoaded=!0,this.isLoading=!1,this.loaded()),this}setPath(e){return this.path=e,this}setRequestHeader(e){return Object.values(this.loaderMap).forEach(t=>{t.setRequestHeader(e)}),this}setResponseType(e){return Object.values(this.loaderMap).forEach(t=>{t.setResponseType&&t.setResponseType(e)}),this}getLoader(e){return this.loaderMap[e]?this.loaderMap[e]:null}load(e){var l;if(this.reset(),this.isLoading=!0,this.dispatchEvent({type:"beforeLoad",urlList:[...e]}),e.length<=0)return this.checkLoaded(),console.warn("url list is empty."),this;this.loadTotal+=e.length;const t=this.resourceMap,n=this.loaderMap,d=this.loadDetailMap;for(const s of e){let o,p;typeof s=="string"?(o=s,p=((l=o.split(".").pop())==null?void 0:l.toLocaleLowerCase())||""):(o=s.url,p=s.ext.toLocaleLowerCase(),p.startsWith(".")&&(p=p.slice(1)));const a={url:o,progress:0,error:!1,message:o};if(d[o]=a,t.has(o)){a.progress=1,this.loadSuccess+=1,this.dispatchEvent({type:"detailLoaded",detail:a}),this.dispatchEvent({type:"loading",loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError,loadProgress:(this.loadSuccess+this.loadError)/this.loadTotal}),this.checkLoaded();continue}if(!p){a.message=`url: ${o} 地址有误，无法获取文件格式。`,console.warn(a.message),a.error=!0,this.isError=!0,this.loadError+=1,this.dispatchEvent({type:"detailLoaded",detail:a}),this.dispatchEvent({type:"loading",loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError,loadProgress:(this.loadSuccess+this.loadError)/this.loadTotal});continue}const f=n[p];if(!f){a.message=`url: ${o} 不支持此文件格式加载。`,console.warn(a.message),a.error=!0,this.isError=!0,this.loadError+=1,this.dispatchEvent({type:"detailLoaded",detail:a}),this.dispatchEvent({type:"loading",loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError,loadProgress:(this.loadSuccess+this.loadError)/this.loadTotal});continue}const g=o.replace(/\\/g,"/").split("/"),G=g.pop(),B=this.path+g.join("/")+"/";f.setPath(B).loadAsync(G,L=>{a.progress=Number((L.loaded/L.total).toFixed(2)),this.dispatchEvent({type:"detailLoading",detail:a})}).then(L=>{a.progress=1,this.loadSuccess+=1,this.resourceMap.set(o,L),this.urlList.push(s),this.dispatchEvent({type:"detailLoaded",detail:a}),this.dispatchEvent({type:"loading",loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError,loadProgress:(this.loadSuccess+this.loadError)/this.loadTotal}),this.checkLoaded()}).catch(L=>{a.error=!0,a.message=JSON.stringify(L),this.loadError+=1,this.dispatchEvent({type:"detailLoaded",detail:a}),this.dispatchEvent({type:"loading",loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError,loadProgress:(this.loadSuccess+this.loadError)/this.loadTotal}),this.checkLoaded()})}return this}reset(){return this.loadTotal=0,this.loadSuccess=0,this.loadError=0,this.isError=!1,this.isLoading=!1,this.isLoaded=!1,this.loadDetailMap={},this}register(e,t){return this.loaderMap[e]=t,this}hasLoaded(e){return this.resourceMap.has(e)}getResource(e){return this.resourceMap.get(e)}getLoadDetailMap(){return this.loadDetailMap}setLoadDetailMap(e){return this.loadDetailMap=e,this}remove(e){}toJSON(){return JSON.stringify(this.urlList)}exportConfig(){return JSON.parse(JSON.stringify(this.urlList))}dispose(){return this.resourceMap.clear(),this}}const E=P.transPkgName("@vis-three/plugin-loader-manager"),C=function(i){return{name:E,install(e){const t=new j(i);i!=null&&i.path&&t.setPath(i.path),e.loaderManager=t,e.loadResources=(n,d)=>{const l=s=>{d(void 0,s),t.removeEventListener(u.LOADED,l)};try{t.addEventListener(u.LOADED,l)}catch(s){d(s)}return t.load(n),e},e.loadResourcesAsync=n=>new Promise((d,l)=>{const s=o=>{d(o),t.removeEventListener(u.LOADED,s)};try{t.addEventListener(u.LOADED,s)}catch(o){l(o)}t.load(n)})},dispose(e){e.loaderManager.dispose(),delete e.loaderManager,delete e.loadResources,delete e.loadResourcesAsync}}};r.LOADER_EVENT=u,r.LOADER_MANAGER_PLUGIN=E,r.LoaderManager=j,r.LoaderManagerPlugin=C,Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});
