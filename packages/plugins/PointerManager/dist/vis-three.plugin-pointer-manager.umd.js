(function(n,o){typeof exports=="object"&&typeof module!="undefined"?o(exports,require("@vis-three/core"),require("three"),require("@vis-three/utils")):typeof define=="function"&&define.amd?define(["exports","@vis-three/core","three","@vis-three/utils"],o):(n=typeof globalThis!="undefined"?globalThis:n||self,o((n["vis-three"]=n["vis-three"]||{},n["vis-three"]["plugin-pointer-manager"]={}),n.core,n.three,n.utils))})(this,function(n,o,i,E){"use strict";var M=Object.defineProperty;var w=(n,o,i)=>o in n?M(n,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[o]=i;var u=(n,o,i)=>(w(n,typeof o!="symbol"?o+"":o,i),i);class m extends o.EventDispatcher{constructor(e){super();u(this,"dom");u(this,"mouse");u(this,"canMouseMove");u(this,"mouseEventTimer");u(this,"throttleTime");u(this,"pointerDownHandler");u(this,"pointerMoveHandler");u(this,"pointerUpHandler");u(this,"mouseDownHandler");u(this,"mouseUpHandler");u(this,"clickHandler");u(this,"dblclickHandler");u(this,"contextmenuHandler");this.dom=e.dom,this.mouse=new i.Vector2,this.canMouseMove=!0,this.mouseEventTimer=null,this.throttleTime=e.throttleTime||1e3/60;const t=r=>{const a={mouse:{x:this.mouse.x,y:this.mouse.y}};for(const l in r)a[l]=r[l];return a},d=r=>{r.preventDefault(),this.dispatchEvent(t(r))},s=r=>{this.dispatchEvent(t(r))};this.pointerMoveHandler=r=>{!this.canMouseMove||(this.canMouseMove=!1,this.mouseEventTimer=window.setTimeout(()=>{const a=this.mouse,l=this.dom,v=l.getBoundingClientRect();a.x=(r.clientX-v.left)/l.offsetWidth*2-1,a.y=-((r.clientY-v.top)/l.offsetHeight)*2+1,this.canMouseMove=!0,this.dispatchEvent(t(r))},this.throttleTime))},this.mouseDownHandler=s,this.mouseUpHandler=s,this.pointerDownHandler=s,this.pointerUpHandler=s,this.clickHandler=s,this.dblclickHandler=s,this.contextmenuHandler=d}setDom(e){if(this.dom){const t=this.dom;t.removeEventListener("mousedown",this.mouseDownHandler),t.removeEventListener("mouseup",this.mouseUpHandler),t.removeEventListener("pointerdown",this.pointerDownHandler),t.removeEventListener("pointermove",this.pointerMoveHandler),t.removeEventListener("pointerup",this.pointerUpHandler),t.removeEventListener("click",this.clickHandler),t.removeEventListener("dblclick",this.dblclickHandler),t.removeEventListener("contextmenu",this.contextmenuHandler)}return e.addEventListener("mousedown",this.mouseDownHandler),e.addEventListener("mouseup",this.mouseUpHandler),e.addEventListener("pointerdown",this.pointerDownHandler),e.addEventListener("pointermove",this.pointerMoveHandler),e.addEventListener("pointerup",this.pointerUpHandler),e.addEventListener("click",this.clickHandler),e.addEventListener("dblclick",this.dblclickHandler),e.addEventListener("contextmenu",this.contextmenuHandler),this.dom=e,this}getNormalMouse(){return this.mouse}getWorldPosition(e,t,d){if(!d&&(d=new i.Vector3),e instanceof i.PerspectiveCamera){const s=new i.Vector3(this.mouse.x,this.mouse.y,1).unproject(e).sub(d.setFromMatrixPosition(e.matrixWorld)).normalize();d.add(s.multiplyScalar(t))}else if(e instanceof i.OrthographicCamera){const s=new i.Vector3(this.mouse.x,this.mouse.y,(e.near+e.far)/(e.near-e.far)).unproject(e);d.set(0,0,-1).transformDirection(e.matrixWorld).add(s.multiplyScalar(t))}else console.warn(`pointer manager can not support this type camera: ${e.type}`);return d}intersectPlane(e,t,d){!d&&(d=new i.Vector3);const s=new i.Vector3,r=new i.Ray;if(e instanceof i.PerspectiveCamera){const a=new i.Vector3().setFromMatrixPosition(e.matrixWorld);s.set(this.mouse.x,this.mouse.y,1).unproject(e).sub(a).normalize(),r.set(a,s)}else if(e instanceof i.OrthographicCamera){s.set(this.mouse.x,this.mouse.y,(e.near+e.far)/(e.near-e.far)).unproject(e);const a=new i.Vector3().set(0,0,-1).transformDirection(e.matrixWorld);r.set(s,a)}else console.warn(`pointer manager can not support this type camera: ${e.type}`);return r.intersectPlane(t,d)}}const f="@vis-three/plugin-pointer-manager",h=E.transPkgName(f),H=function(p){let c;return{name:h,install(e){const t=new m(Object.assign(p||{},{dom:e.dom}));c=d=>{t.setDom(d.dom)},e.addEventListener(o.ENGINE_EVENT.SETDOM,c),e.pointerManager=t},dispose(e){e.removeEventListener(o.ENGINE_EVENT.SETDOM,c),c=void 0}}};n.POINTER_MANAGER_PLUGIN=h,n.PointerManager=m,n.PointerManagerPlugin=H,Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
