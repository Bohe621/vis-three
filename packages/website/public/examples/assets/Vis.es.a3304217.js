import{a6 as ne,c as Be,k as rn,aG as kr,O as He,b as O,P as ae,ap as $r,Q as Rt,d as wt,B as te,aH as Tt,aI as Ct,aJ as Wr,aK as Vr,aL as tr,V as B,aM as sn,g as at,j as Yr,aN as nn,aO as on,f as an,T as cn,aP as ln,aQ as Oe,G as hn,aR as ct,N as Qr,K as Xr,J as un,S as Ke,i as lt,L as ht,e as xt,o as dn,X as pn,a2 as Kr,n as Ze,aS as Ae,M as Ue,aT as oe,a as F,W as ut,U as mn,q as ze,aU as Fe,aE as fn,aV as Zr,aW as Ot,aX as rr,aY as sr,ak as ce,aZ as dt,a_ as gn,a$ as En,I as At,p as ye,F as he,b0 as yn,aq as nr,h as Jr,b1 as pt,b2 as Je,b3 as qr,au as or,b4 as Sn,b5 as Mn,b6 as bn,ah as es,a1 as vn,A as ts,b7 as Rn,s as wn,b8 as Tn,b9 as Cn,ba as xn,bb as On,bc as rs,Y as ss,bd as An,be as Ln,m as ns,bf as Dn,bg as Pn,E as ir,bh as In,bi as jn,bj as Gn,bk as os,bl as is,C as Nn,R as Bn}from"./three.75af7ea3.js";import{T as Hn,C as mt,b as Un,S as zn,U as Fn,P as _n,F as kn,L as as,d as cs,e as $n,E as ar,R as cr,G as Wn,D as Vn,K as Yn,M as Qn,O as Xn,f as Kn,h as Zn,v as ft,i as H,j as qe,k as Lt,l as lr,m as Jn,n as ue}from"./vis-three.69d8f933.js";var qn=Object.defineProperty,eo=Object.defineProperties,to=Object.getOwnPropertyDescriptors,ls=Object.getOwnPropertySymbols,ro=Object.prototype.hasOwnProperty,so=Object.prototype.propertyIsEnumerable,hr=(t,e,r)=>e in t?qn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_=(t,e)=>{for(var r in e||(e={}))ro.call(e,r)&&hr(t,r,e[r]);if(ls)for(var r of ls(e))so.call(e,r)&&hr(t,r,e[r]);return t},Dt=(t,e)=>eo(t,to(e)),i=(t,e,r)=>(hr(t,typeof e!="symbol"?e+"":e,r),r);class de{constructor(){i(this,"listeners",new Map)}addEventListener(e,r){const s=this.listeners;s.has(e)||s.set(e,new Set),s.get(e).add(r)}hasEventListener(e,r){const s=this.listeners;return s.has(e)?s.get(e).has(r):!1}removeEventListener(e,r){const s=this.listeners;!s.has(e)||!s.get(e).has(r)||s.get(e).delete(r)}dispatchEvent(e){var r;const s=e.type,n=this.listeners;if(n.has(s))try{(r=n.get(s))==null||r.forEach(o=>{o.call(this,e)})}catch(o){console.error(o)}}clear(){this.listeners=new Map}useful(){return Boolean([...this.listeners.keys()].length)}once(e,r){const s=function(n){r.call(this,n),this.removeEventListener(e,s)};this.addEventListener(e,s)}}class no extends de{constructor(e=0){super();i(this,"clock",new Nn),i(this,"animationFrame",-1),i(this,"fps",0),i(this,"timer",null),i(this,"playFun",()=>{}),i(this,"render",()=>{this.dispatchEvent({type:"render",delta:this.clock.getDelta(),total:this.clock.getElapsedTime()})}),i(this,"play",()=>{if(this.hasRendering()){console.warn("render manager is rendering.");return}this.dispatchEvent({type:"play"}),this.playFun()}),i(this,"stop",()=>{this.animationFrame!==-1&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=-1),this.timer&&(clearTimeout(this.timer),this.timer=null),this.dispatchEvent({type:"stop"})}),i(this,"hasRendering",()=>Boolean(this.animationFrame!==-1||this.timer)),i(this,"hasVaildRender",()=>this.useful()),this.setFPS(e)}setFPS(e){return this.animationFrame!==-1&&cancelAnimationFrame(this.animationFrame),this.timer&&clearTimeout(this.timer),this.fps=e,e<=0?(this.fps=0,this.playFun=()=>{this.render(),this.animationFrame=requestAnimationFrame(this.playFun)}):this.playFun=()=>{this.timer=setTimeout(()=>{this.playFun()},e),this.render()},this.playFun(),this}dispose(){this.hasRendering()&&this.stop(),this.clear()}}const oo=function(){return this.renderManager?(console.warn("has installed render manager plugin."),!1):(this.renderManager=new no,this.render=function(){return this.renderManager.render(),this},this.play=function(){return this.renderManager.play(),this},this.stop=function(){return this.renderManager.stop(),this},this.addEventListener("dispose",()=>{this.renderManager.dispose()}),!0)};class hs extends de{constructor(e,r){super();i(this,"object"),i(this,"domElement"),i(this,"enabled",!0),i(this,"target",new O),i(this,"minDistance",0),i(this,"maxDistance",1/0),i(this,"minZoom",0),i(this,"maxZoom",1/0),i(this,"minPolarAngle",0),i(this,"maxPolarAngle",Math.PI),i(this,"minAzimuthAngle",-1/0),i(this,"maxAzimuthAngle",1/0),i(this,"enableDamping",!1),i(this,"dampingFactor",.05),i(this,"enableZoom",!0),i(this,"zoomSpeed",1),i(this,"enableRotate",!0),i(this,"rotateSpeed",1),i(this,"enablePan",!0),i(this,"panSpeed",1),i(this,"screenSpacePanning",!0),i(this,"keyPanSpeed",7),i(this,"autoRotate",!1),i(this,"autoRotateSpeed",2),i(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),i(this,"mouseButtons",{LEFT:null,MIDDLE:pt.DOLLY,RIGHT:pt.ROTATE}),i(this,"touches",{ONE:Je.ROTATE,TWO:Je.DOLLY_PAN}),i(this,"target0"),i(this,"position0"),i(this,"zoom0"),i(this,"_domElementKeyEvents",null),i(this,"spherical"),i(this,"reset"),i(this,"update"),i(this,"onContextMenu"),i(this,"onPointerDown"),i(this,"onPointerCancel"),i(this,"onMouseWheel"),i(this,"onPointerMove"),i(this,"onPointerUp"),i(this,"onKeyDown"),this.object=e||new ne,this.domElement=r||document.createElement("div"),this.domElement.style.touchAction="none",this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.update=(()=>{const d=new O,b=new Rt().setFromUnitVectors(this.object.up,new O(0,1,0)),z=b.clone().invert(),Y=new O,Ce=new Rt,xe=2*Math.PI;return()=>{const _r=this.object.position;d.copy(_r).sub(this.target),d.applyQuaternion(b),a.setFromVector3(d),this.autoRotate&&n===s.NONE&&D(g()),this.enableDamping?(a.theta+=c.theta*this.dampingFactor,a.phi+=c.phi*this.dampingFactor):(a.theta+=c.theta,a.phi+=c.phi);let ge=this.minAzimuthAngle,Ee=this.maxAzimuthAngle;return isFinite(ge)&&isFinite(Ee)&&(ge<-Math.PI?ge+=xe:ge>Math.PI&&(ge-=xe),Ee<-Math.PI?Ee+=xe:Ee>Math.PI&&(Ee-=xe),ge<=Ee?a.theta=Math.max(ge,Math.min(Ee,a.theta)):a.theta=a.theta>(ge+Ee)/2?Math.max(ge,a.theta):Math.min(Ee,a.theta)),a.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,a.phi)),a.makeSafe(),a.radius*=u,a.radius=Math.max(this.minDistance,Math.min(this.maxDistance,a.radius)),this.enableDamping===!0?this.target.addScaledVector(h,this.dampingFactor):this.target.add(h),d.setFromSpherical(a),d.applyQuaternion(z),_r.copy(this.target).add(d),this.object.lookAt(this.target),this.enableDamping===!0?(c.theta*=1-this.dampingFactor,c.phi*=1-this.dampingFactor,h.multiplyScalar(1-this.dampingFactor)):(c.set(0,0,0),h.set(0,0,0)),u=1,m||Y.distanceToSquared(this.object.position)>o||8*(1-Ce.dot(this.object.quaternion))>o?(this.dispatchEvent({type:"change"}),Y.copy(this.object.position),Ce.copy(this.object.quaternion),m=!1,!0):!1}})();const s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let n=s.NONE;const o=1e-6,a=new qr,c=new qr;let u=1;const h=new O;let m=!1;const f=new B,y=new B,w=new B,v=new B,x=new B,R=new B,S=new B,L=new B,P=new B,T=[],k={},g=()=>2*Math.PI/60/60*this.autoRotateSpeed,V=()=>Math.pow(.95,this.zoomSpeed),D=d=>{c.theta-=d},A=d=>{c.phi-=d},Ar=function(){const d=new O;return function(z,Y){d.setFromMatrixColumn(Y,0),d.multiplyScalar(-z),h.add(d)}}(),Lr=(()=>{const d=new O;return(b,z)=>{this.screenSpacePanning===!0?d.setFromMatrixColumn(z,1):(d.setFromMatrixColumn(z,0),d.crossVectors(this.object.up,d)),d.multiplyScalar(b),h.add(d)}})(),Xe=(()=>{const d=new O;return(b,z)=>{const Y=this.domElement;if(this.object instanceof ne){const Ce=this.object.position;d.copy(Ce).sub(this.target);let xe=d.length();xe*=Math.tan(this.object.fov/2*Math.PI/180),Ar(2*b*xe/Y.clientHeight,this.object.matrix),Lr(2*z*xe/Y.clientHeight,this.object.matrix)}else this.object instanceof He?(Ar(b*(this.object.right-this.object.left)/this.object.zoom/Y.clientWidth,this.object.matrix),Lr(z*(this.object.top-this.object.bottom)/this.object.zoom/Y.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}})(),Jt=d=>{this.object instanceof ne?u/=d:this.object instanceof He?(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*d)),this.object.updateProjectionMatrix(),m=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)},Dr=d=>{this.object instanceof ne?u*=d:this.object instanceof He?(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/d)),this.object.updateProjectionMatrix(),m=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)};function Pr(d){f.set(d.clientX,d.clientY)}function Us(d){S.set(d.clientX,d.clientY)}function Ir(d){v.set(d.clientX,d.clientY)}const zs=d=>{y.set(d.clientX,d.clientY),w.subVectors(y,f).multiplyScalar(this.rotateSpeed);const b=this.domElement;D(2*Math.PI*w.x/b.clientHeight),A(2*Math.PI*w.y/b.clientHeight),f.copy(y),this.update()},Fs=d=>{L.set(d.clientX,d.clientY),P.subVectors(L,S),P.y>0?Jt(V()):P.y<0&&Dr(V()),S.copy(L),this.update()},_s=d=>{x.set(d.clientX,d.clientY),R.subVectors(x,v).multiplyScalar(this.panSpeed),Xe(R.x,R.y),v.copy(x),this.update()},ks=d=>{d.deltaY<0?Dr(V()):d.deltaY>0&&Jt(V()),this.update()},$s=d=>{let b=!1;switch(d.code){case this.keys.UP:Xe(0,this.keyPanSpeed),b=!0;break;case this.keys.BOTTOM:Xe(0,-this.keyPanSpeed),b=!0;break;case this.keys.LEFT:Xe(this.keyPanSpeed,0),b=!0;break;case this.keys.RIGHT:Xe(-this.keyPanSpeed,0),b=!0;break}b&&(d.preventDefault(),this.update())};function jr(){if(T.length===1)f.set(T[0].pageX,T[0].pageY);else{const d=.5*(T[0].pageX+T[1].pageX),b=.5*(T[0].pageY+T[1].pageY);f.set(d,b)}}function Gr(){if(T.length===1)v.set(T[0].pageX,T[0].pageY);else{const d=.5*(T[0].pageX+T[1].pageX),b=.5*(T[0].pageY+T[1].pageY);v.set(d,b)}}function Nr(){const d=T[0].pageX-T[1].pageX,b=T[0].pageY-T[1].pageY,z=Math.sqrt(d*d+b*b);S.set(0,z)}const Ws=()=>{this.enableZoom&&Nr(),this.enablePan&&Gr()},Vs=()=>{this.enableZoom&&Nr(),this.enableRotate&&jr()},Br=d=>{if(T.length==1)y.set(d.pageX,d.pageY);else{const z=er(d),Y=.5*(d.pageX+z.x),Ce=.5*(d.pageY+z.y);y.set(Y,Ce)}w.subVectors(y,f).multiplyScalar(this.rotateSpeed);const b=this.domElement;D(2*Math.PI*w.x/b.clientHeight),A(2*Math.PI*w.y/b.clientHeight),f.copy(y)},Hr=d=>{if(T.length===1)x.set(d.pageX,d.pageY);else{const b=er(d),z=.5*(d.pageX+b.x),Y=.5*(d.pageY+b.y);x.set(z,Y)}R.subVectors(x,v).multiplyScalar(this.panSpeed),Xe(R.x,R.y),v.copy(x)},Ur=d=>{const b=er(d),z=d.pageX-b.x,Y=d.pageY-b.y,Ce=Math.sqrt(z*z+Y*Y);L.set(0,Ce),P.set(0,Math.pow(L.y/S.y,this.zoomSpeed)),Jt(P.y),S.copy(L)},Ys=d=>{this.enableZoom&&Ur(d),this.enablePan&&Hr(d)},Qs=d=>{this.enableZoom&&Ur(d),this.enableRotate&&Br(d)};this.onPointerDown=d=>{this.enabled!==!1&&(T.length===0&&(this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp)),tn(d),d.pointerType==="touch"?Js(d):Xs(d))};let qt=!1;this.onPointerMove=d=>{this.enabled!==!1&&(qt||(this.domElement.setPointerCapture(d.pointerId),qt=!0),d.pointerType==="touch"?qs(d):Ks(d))},this.onPointerUp=d=>{this.enabled!==!1&&(qt=!1,d.pointerType==="touch"?en():Zs(d),zr(d),T.length===0&&(this.domElement.releasePointerCapture(d.pointerId),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)))},this.onPointerCancel=d=>{zr(d)};const Xs=d=>{let b;switch(d.button){case 0:b=this.mouseButtons.LEFT;break;case 1:b=this.mouseButtons.MIDDLE;break;case 2:b=this.mouseButtons.RIGHT;break;default:b=-1}switch(b){case pt.DOLLY:if(this.enableZoom===!1)return;Us(d),n=s.DOLLY;break;case pt.ROTATE:if(d.ctrlKey||d.metaKey||d.shiftKey){if(this.enablePan===!1)return;Ir(d),n=s.PAN}else{if(this.enableRotate===!1)return;Pr(d),n=s.ROTATE}break;case pt.PAN:if(d.ctrlKey||d.metaKey||d.shiftKey){if(this.enableRotate===!1)return;Pr(d),n=s.ROTATE}else{if(this.enablePan===!1)return;Ir(d),n=s.PAN}break;default:n=s.NONE}n!==s.NONE&&this.dispatchEvent({type:"start"})},Ks=d=>{if(this.enabled!==!1)switch(n){case s.ROTATE:if(this.enableRotate===!1)return;zs(d);break;case s.DOLLY:if(this.enableZoom===!1)return;Fs(d);break;case s.PAN:if(this.enablePan===!1)return;_s(d);break}},Zs=d=>{this.dispatchEvent({type:"end"}),n=s.NONE};this.onMouseWheel=d=>{this.enabled===!1||this.enableZoom===!1||n!==s.NONE||(d.preventDefault(),this.dispatchEvent({type:"start"}),ks(d),this.dispatchEvent({type:"end"}))},this.onKeyDown=d=>{this.enabled===!1||this.enablePan===!1||$s(d)};const Js=d=>{switch(Fr(d),T.length){case 1:switch(this.touches.ONE){case Je.ROTATE:if(this.enableRotate===!1)return;jr(),n=s.TOUCH_ROTATE;break;case Je.PAN:if(this.enablePan===!1)return;Gr(),n=s.TOUCH_PAN;break;default:n=s.NONE}break;case 2:switch(this.touches.TWO){case Je.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;Ws(),n=s.TOUCH_DOLLY_PAN;break;case Je.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;Vs(),n=s.TOUCH_DOLLY_ROTATE;break;default:n=s.NONE}break;default:n=s.NONE}n!==s.NONE&&this.dispatchEvent({type:"start"})},qs=d=>{switch(Fr(d),n){case s.TOUCH_ROTATE:if(this.enableRotate===!1)return;Br(d),this.update();break;case s.TOUCH_PAN:if(this.enablePan===!1)return;Hr(d),this.update();break;case s.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;Ys(d),this.update();break;case s.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;Qs(d),this.update();break;default:n=s.NONE}},en=d=>{this.dispatchEvent({type:"end"}),n=s.NONE};this.onContextMenu=d=>{this.enabled!==!1&&d.preventDefault()};function tn(d){T.push(d)}const zr=d=>{delete k[d.pointerId];for(let b=0;b<T.length;b++)if(T[b].pointerId==d.pointerId){T.splice(b,1);return}};function Fr(d){let b=k[d.pointerId];b===void 0&&(b=new B,k[d.pointerId]=b),b.set(d.pageX,d.pageY)}function er(d){const b=d.pointerId===T[0].pointerId?T[1]:T[0];return k[b.pointerId]}this.spherical=a,this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),this.domElement.addEventListener("wheel",this.onMouseWheel,{passive:!1}),this.reset=()=>{this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent({type:"change"}),this.update(),n=s.NONE},this.update()}getPolarAngle(){return this.spherical.phi}getAzimuthalAngle(){return this.spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this.onKeyDown),this._domElementKeyEvents=e}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}setCamera(e){this.object=e}setDom(e){this.dispose(),this.domElement=e,this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),this.domElement.addEventListener("wheel",this.onMouseWheel,{passive:!1})}dispose(){this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("pointercancel",this.onPointerCancel),this.domElement.removeEventListener("wheel",this.onMouseWheel),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp),this._domElementKeyEvents!==null&&this._domElementKeyEvents.removeEventListener("keydown",this.onKeyDown)}}var j;(function(t){t.DEFAULT="default",t.TOP="top",t.BOTTOM="bottom",t.LEFT="left",t.RIGHT="right",t.FRONT="front",t.BACK="back"})(j||(j={}));const io=function(t={}){var e;if(!this.webGLRenderer)return console.error("must install some renderer before BasicViewpoint plugin."),!1;!t.viewpoint&&(t.viewpoint=j.DEFAULT),!t.perspective&&(t.perspective={}),!t.perspective.position&&(t.perspective.position={x:60,y:60,z:60}),!t.perspective.lookAt&&(t.perspective.lookAt={x:0,y:0,z:0}),!t.perspective.up&&(t.perspective.up={x:0,y:1,z:0}),!t.orthograpbic&&(t.orthograpbic={}),!t.orthograpbic.up&&(t.orthograpbic.up={x:0,y:1,z:0});const r=new ne;r.position.set(t.perspective.position.x,t.perspective.position.y,t.perspective.position.z),r.lookAt(t.perspective.lookAt.x,t.perspective.lookAt.y,t.perspective.lookAt.z),r.up.set(t.perspective.up.x,t.perspective.up.y,t.perspective.up.z);const s=t.orthograpbic.distance||1e4,n=new He(-window.innerWidth/8,window.innerWidth/8,-window.innerHeight/8,window.innerHeight/8,0,s);return n.up.set(t.perspective.up.x,t.perspective.up.y,t.perspective.up.z),this.setViewpoint=function(o){return this.dispatchEvent({type:"setViewpoint",viewpoint:o}),this},this.addEventListener("setSize",o=>{const a=o.width,c=o.height,u=a/c;r.aspect=u,r.updateProjectionMatrix(),n.left=-s*u,n.right=s*u,n.top=s,n.bottom=-s,n.zoom=s/c*5,n.updateProjectionMatrix()}),(e=t.orthograpbic.allowRotate)!=null,this.addEventListener("setViewpoint",o=>{const a=o.viewpoint;if(a===j.DEFAULT){this.setCamera(r);return}a===j.TOP?n.position.set(0,s/2,0):a===j.BOTTOM?n.position.set(0,-s/2,0):a===j.RIGHT?n.position.set(s/2,0,0):a===j.LEFT?n.position.set(-s/2,0,0):a===j.FRONT?n.position.set(0,0,s/2):a===j.BACK&&n.position.set(0,0,-s/2),this.setCamera(n)}),this.completeSet.add(()=>{t.viewpoint===j.DEFAULT?this.setCamera(r):this.setCamera(n),this.objectHelperManager&&this.objectHelperManager.addFilteredObject(r,n)}),!0},ao=function(t){return this.orbitControls?(console.warn("this has installed orbitControls plugin."),!1):this.renderManager?(this.orbitControls=new hs(this.camera,this.dom),this.addEventListener("setCamera",e=>{e.options.orbitControls&&this.orbitControls.setCamera(e.camera)}),this.addEventListener("setDom",e=>{this.orbitControls.setDom(e.dom)}),this.renderManager.addEventListener("render",()=>{this.orbitControls.update()}),this.completeSet.add(()=>{this.setViewpoint&&this.addEventListener("setViewpoint",e=>{const r=e.viewpoint;this.orbitControls.target.set(0,0,0),r===j.DEFAULT?this.orbitControls.enableRotate=!0:r===j.TOP?this.orbitControls.enableRotate=!1:r===j.BOTTOM?this.orbitControls.enableRotate=!1:r===j.RIGHT?this.orbitControls.enableRotate=!1:r===j.LEFT?this.orbitControls.enableRotate=!1:r===j.FRONT?this.orbitControls.enableRotate=!1:r===j.BACK&&(this.orbitControls.enableRotate=!1)})}),!0):(console.warn("this must install renderManager before install orbitControls plugin."),!1)};class co{constructor(e){i(this,"REVISION"),i(this,"dom"),i(this,"addPanel"),i(this,"showPanel"),i(this,"begin"),i(this,"end"),i(this,"update"),i(this,"domElement"),i(this,"setMode");const r=Jn();this.REVISION=r.REVISION,this.dom=r.dom,this.domElement=r.domElement,this.begin=r.begin.bind(r),this.end=r.end.bind(r),this.update=r.update.bind(r),this.addPanel=r.addPanel.bind(r),this.showPanel=r.showPanel.bind(r),this.setMode=r.setMode.bind(r);const s=this.domElement;s.style.position="absolute",s.style.top="0",s.style.left="35px",e&&(s.style.top=`${e.top}px`,s.style.left=`${e.left}px`,s.style.right=`${e.right}px`,s.style.bottom=`${e.bottom}px`)}}const lo=function(t){if(this.stats)return console.warn("this has installed stats plugin."),!1;if(!this.renderManager)return console.warn("this must install renderManager before install stats plugin."),!1;const e=new co(t);this.stats=e;const r=()=>{this.stats.update()};return this.setStats=function(s){if(s)this.dom.appendChild(this.stats.domElement),this.renderManager.addEventListener("render",r);else try{this.dom.removeChild(this.stats.domElement),this.renderManager.removeEventListener("render",r)}catch{}return this},!0},ho=function(t={}){if(this.effectComposer)return console.warn("this has installed effect composer plugin."),!1;if(!this.webGLRenderer)return console.error("must install some renderer before this plugin."),!1;let e;if(t.WebGLMultisampleRenderTarget||t.MSAA){const s=this.webGLRenderer,n=s.getPixelRatio(),o=s.getDrawingBufferSize(new B);Number(window.__THREE__)>137?e=new ar(s,new ut(o.width*n,o.height*n,{format:t.format||or,samples:t.samples||4})):e=new ar(s,new Sn(o.width*n,o.height*n,{format:t.format||or}))}else e=new ar(this.webGLRenderer);this.effectComposer=e;let r;return this.scene&&this.camera&&(r=new cr(this.scene,this.camera),e.addPass(r)),this.addEventListener("setCamera",s=>{if(!r&&this.scene){r=new cr(this.scene,s.camera),e.addPass(r);return}else r&&(r.camera=s.camera)}),this.addEventListener("setScene",s=>{if(!r&&this.camera){r=new cr(s.scene,this.camera),e.addPass(r);return}else r&&(r.scene=s.scene)}),this.addEventListener("setSize",s=>{e.setSize(s.width,s.height)}),this.renderManager?(this.renderManager.removeEventListener("render",this.render),this.renderManager.addEventListener("render",s=>{this.effectComposer.render(s.delta)})):this.render=function(){return this.effectComposer.render(),this},!0};class uo extends de{constructor(e){super();i(this,"dom"),i(this,"mouse"),i(this,"canMouseMove"),i(this,"mouseEventTimer"),i(this,"throttleTime"),i(this,"pointerDownHandler"),i(this,"pointerMoveHandler"),i(this,"pointerUpHandler"),i(this,"mouseDownHandler"),i(this,"mouseUpHandler"),i(this,"clickHandler"),i(this,"dblclickHandler"),i(this,"contextmenuHandler"),this.dom=e.dom,this.mouse=new B,this.canMouseMove=!0,this.mouseEventTimer=null,this.throttleTime=e.throttleTime||1e3/60;const r=n=>{const o={mouse:{x:this.mouse.x,y:this.mouse.y}};for(const a in n)o[a]=n[a];return o},s=n=>{this.dispatchEvent(r(n))};this.pointerMoveHandler=n=>{!this.canMouseMove||(this.canMouseMove=!1,this.mouseEventTimer=window.setTimeout(()=>{const o=this.mouse,a=this.dom,c=a.getBoundingClientRect();o.x=(n.clientX-c.left)/a.offsetWidth*2-1,o.y=-((n.clientY-c.top)/a.offsetHeight)*2+1,this.canMouseMove=!0,this.dispatchEvent(r(n))},this.throttleTime))},this.mouseDownHandler=s,this.mouseUpHandler=s,this.pointerDownHandler=s,this.pointerUpHandler=s,this.clickHandler=s,this.dblclickHandler=s,this.contextmenuHandler=s}setDom(e){if(this.dom){const r=this.dom;r.removeEventListener("mousedown",this.mouseDownHandler),r.removeEventListener("mouseup",this.mouseUpHandler),r.removeEventListener("pointerdown",this.pointerDownHandler),r.removeEventListener("pointermove",this.pointerMoveHandler),r.removeEventListener("pointerup",this.pointerUpHandler),r.removeEventListener("click",this.clickHandler),r.removeEventListener("dblclick",this.dblclickHandler),r.removeEventListener("contextmenu",this.contextmenuHandler)}return e.addEventListener("mousedown",this.mouseDownHandler),e.addEventListener("mouseup",this.mouseUpHandler),e.addEventListener("pointerdown",this.pointerDownHandler),e.addEventListener("pointermove",this.pointerMoveHandler),e.addEventListener("pointerup",this.pointerUpHandler),e.addEventListener("click",this.clickHandler),e.addEventListener("dblclick",this.dblclickHandler),e.addEventListener("contextmenu",this.contextmenuHandler),this.dom=e,this}getNormalMouse(){return this.mouse}}const po=function(t){if(this.pointerManager)return console.warn("this has installed pointerManager plugin."),!1;const e=new uo(Object.assign(t||{},{dom:this.dom}));return this.addEventListener("setDom",r=>{e.setDom(r.dom)}),this.pointerManager=e,!0};var ur;(function(t){t.POINTERDOWN="pointerdown",t.POINTERUP="pointerup",t.POINTERMOVE="pointermove",t.POINTERENTER="pointerenter",t.POINTERLEAVE="pointerleave",t.CLICK="click",t.DBLCLICK="dblclick",t.CONTEXTMENU="contextmenu"})(ur||(ur={}));class mo extends de{constructor(e){super();i(this,"raycaster"),i(this,"scene"),i(this,"camera"),i(this,"filter",new Set),i(this,"recursive",!1),i(this,"penetrate",!1),i(this,"propagation",!1),i(this,"delegation",!1),this.raycaster=new Bn,this.camera=e.camera,this.scene=e.scene,e.recursive&&(this.recursive=e.recursive),e.penetrate&&(this.penetrate=e.penetrate)}setScene(e){return this.scene=e,this}setCamera(e){return this.camera=e,this}addFilterObject(e){return this.filter.add(e),this}removeFilterObject(e){return this.filter.delete(e),this}intersectObject(e){this.raycaster.setFromCamera(e,this.camera);const r=this.filter,s=this.scene.children.filter(n=>!r.has(n));return this.raycaster.intersectObjects(s,this.recursive)}use(e){const r=function(c,u){return Object.assign({},c,u)},s=(c,u)=>{const h=this.intersectObject(c.mouse);if(h.length)if(this.penetrate)for(const m of h)m.object.dispatchEvent(r(c,{type:u,intersection:m}));else{const m=h[0];m.object.dispatchEvent(r(c,{type:u,intersection:m}))}this.dispatchEvent(r(c,{type:u,intersections:h}))},n=["pointerdown","pointerup","mousedown","mouseup","pointermove","click","dblclick","contextmenu"];for(const c of n)e.addEventListener(c,u=>{s(u,c)});const o=new Map;let a=null;return e.addEventListener("pointermove",c=>{const u=this.intersectObject(c.mouse);if(this.penetrate){if(!u.length){o.forEach(h=>{h.object.dispatchEvent(r(c,{type:"pointerleave",intersection:h})),h.object.dispatchEvent(r(c,{type:"mouseleave",intersection:h}))}),o.clear();return}for(const h of u)o.has(h.object)?(h.object.dispatchEvent(r(c,{type:"pointermove",intersection:h})),h.object.dispatchEvent(r(c,{type:"mousemove",intersection:h})),o.delete(h.object)):(h.object.dispatchEvent(r(c,{type:"pointerenter",intersection:h})),h.object.dispatchEvent(r(c,{type:"mouseenter",intersection:h})));for(const h of o.values())h.object.dispatchEvent(r(c,{type:"pointerleave",intersection:h})),h.object.dispatchEvent(r(c,{type:"mouseleave",intersection:h}));o.clear();for(const h of u)o.set(h.object,h)}else{if(!u.length){a&&(a.object.dispatchEvent(r(c,{type:"pointerleave",intersection:a})),a.object.dispatchEvent(r(c,{type:"mouseleave",intersection:a})),a=null);return}const h=u[0];if(!a){h.object.dispatchEvent(r(c,{type:"pointerenter",intersection:h})),h.object.dispatchEvent(r(c,{type:"mouseenter",intersection:h})),a=h;return}if(h.object!==a.object){a.object.dispatchEvent(r(c,{type:"pointerleave",intersection:h})),a.object.dispatchEvent(r(c,{type:"mouseleave",intersection:h})),h.object.dispatchEvent(r(c,{type:"pointerenter",intersection:h})),h.object.dispatchEvent(r(c,{type:"mouseenter",intersection:h})),a=h;return}h.object===a.object&&(h.object.dispatchEvent(r(c,{type:"pointermove",intersection:h})),h.object.dispatchEvent(r(c,{type:"mousemove",intersection:h})))}this.dispatchEvent(r(c,{type:"pointermove",intersections:u})),this.dispatchEvent(r(c,{type:"mousemove",intersections:u}))}),this}}const fo=function(t){if(this.eventManager)return console.warn("engine has installed eventManager plugin."),!1;if(!this.pointerManager)return console.error("must install pointerManager before this plugin."),!1;const e=new mo(Object.assign({scene:this.scene,camera:this.camera},t));return e.use(this.pointerManager),this.eventManager=e,this.addEventListener("setCamera",r=>{this.eventManager.setCamera(r.camera)}),this.addEventListener("setScene",r=>{this.eventManager.setScene(r.scene)}),!0};var Pt;(function(t){t.OBJECTCHANGED="objectChanged"})(Pt||(Pt={}));class us extends Hn{constructor(e,r){!e&&(e=new ne),!r&&(r=document.body);super(e,r);i(this,"target"),i(this,"transObjectSet"),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this._onPointerDown=u=>{var h;!this.enabled||!((h=this.object)==null?void 0:h.parent)||(this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(u)),this.pointerDown(this._getPointer(u)))},this.domElement.addEventListener("pointerdown",this._onPointerDown),this.target=new Be,this.transObjectSet=new Set;let s="";const n=this.target,o=this.transObjectSet,a={x:0,y:0,z:0},c=new WeakMap;this.addEventListener("mouseDown",u=>{s=u.target.mode,s==="translate"&&(s="position"),s==="rotate"&&(s="rotation"),a.x=n[s].x,a.y=n[s].y,a.z=n[s].z,o.forEach(h=>{c.set(h,h.matrixAutoUpdate),h.matrixAutoUpdate=!1})}),this.addEventListener("objectChange",u=>{const h=n[s].x-a.x,m=n[s].y-a.y,f=n[s].z-a.z;a.x=n[s].x,a.y=n[s].y,a.z=n[s].z,o.forEach(y=>{y[s].x+=h,y[s].y+=m,y[s].z+=f,y.updateMatrix(),y.updateMatrixWorld()}),this.dispatchEvent({type:Pt.OBJECTCHANGED,transObjectSet:o,mode:s,target:n})}),this.addEventListener("mouseUp",u=>{o.forEach(h=>{h.matrixAutoUpdate=c.get(h),c.delete(h)})})}setDom(e){return this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),e.addEventListener("pointerdown",this._onPointerDown),e.addEventListener("pointermove",this._onPointerHover),e.addEventListener("pointerup",this._onPointerUp),this.domElement=e,this}setCamera(e){return this.camera=e,this}getTarget(){return this.target}getTransObjectSet(){return this.transObjectSet}setAttach(...e){if(this.transObjectSet.clear(),!e.length||!e[0])return this.detach(),this;this.attach(this.target);const r=this.target;if(e.length===1){const a=e[0];return a.matrixWorld.decompose(r.position,r.quaternion,r.scale),r.updateMatrix(),r.updateMatrixWorld(),this.transObjectSet.add(a),this}const s=[],n=[],o=[];return e.forEach(a=>{s.push(a.matrixWorld.elements[12]),n.push(a.matrixWorld.elements[13]),o.push(a.matrixWorld.elements[14])}),r.rotation.set(0,0,0),r.scale.set(0,0,0),r.position.x=(Math.max(...s)-Math.min(...s))/2+Math.min(...s),r.position.y=(Math.max(...n)-Math.min(...n))/2+Math.min(...n),r.position.z=(Math.max(...o)-Math.min(...o))/2+Math.min(...o),r.updateMatrix(),r.updateMatrixWorld(),e.forEach(a=>{this.transObjectSet.add(a)}),this}}const go=function(t){if(this.transformControls)return console.warn("this has installed transformControls plugin."),!1;if(!this.pointerManager)return console.warn("this must install pointerManager before install transformControls plugin."),!1;if(!this.eventManager)return console.warn("this must install eventManager before install transformControls plugin."),!1;const e=new us(this.camera,this.dom);return e.detach(),this.transformControls=e,this.scene.add(this.transformControls),this.scene.add(this.transformControls.target),this.transformControls.addEventListener("mouseDown",()=>{this.transing=!0}),this.setTransformControls=function(r){return r?this.scene.add(this.transformControls):this.scene.remove(this.transformControls),this},this.addEventListener("setCamera",r=>{r.options.transformControls&&e.setCamera(r.camera)}),this.addEventListener("setDom",r=>{e.setDom(r.dom)}),this.addEventListener("setScene",r=>{const s=r.scene;s.add(this.transformControls.target),s.add(this.transformControls)}),this.selectionBox?this.addEventListener("selected",r=>{e.setAttach(...r.objects)}):this.eventManager.addEventListener("click",r=>{if(this.transing){this.transing=!1;return}if(r.button===0){const n=r.intersections.map(o=>o.object)[0]||null;n?e.setAttach(n):e.detach()}}),this.eventManager.addFilterObject(e),this.completeSet.add(()=>{if(this.IS_ENGINESUPPORT){const r=o=>{const a=this.compilerManager.getObjectSymbol(o);return a?this.dataSupportManager.getConfigBySymbol(a):null};let s=null,n;e.addEventListener(Pt.OBJECTCHANGED,o=>{const a=o;a.transObjectSet.forEach(c=>{s=r(c),n=a.mode,s&&(s[n].x=c[n].x,s[n].y=c[n].y,s[n].z=c[n].z)})})}}),!0},Eo=function(t={}){if(this.webGLRenderer)return console.warn("this has installed webglRenderer plugin."),!1;this.webGLRenderer=new Ot(t);const e=this.webGLRenderer.domElement;return e.style.position="absolute",e.style.top="0",e.style.left="0",e.classList.add("vis-webgl"),this.getScreenshot=async function(r={}){const s={width:this.dom.offsetWidth,height:this.dom.offsetHeight};!r.width&&(r.width=this.dom.offsetWidth),!r.height&&(r.height=this.dom.offsetHeight),!r.mine&&(r.mine="image/png");let n=!1;this.renderManager.hasRendering()&&(this.renderManager.stop(),n=!0);let o="";const a=this.webGLRenderer.getContext(),u=a.getParameter(a.MAX_RENDERBUFFER_SIZE)/4;if(r.width>u||r.height>u){const h=[],m=Math.ceil(r.width/u),f=Math.ceil(r.height/u),y=r.width/m,w=r.height/f,v=document.createElement("canvas");v.setAttribute("width",r.width.toString()),v.setAttribute("height",r.height.toString());const x=v.getContext("2d");if(!x)return console.warn("can not support canvas 2d;"),o;this.setSize(y,w);for(let S=0;S<m;S+=1)for(let L=0;L<f;L+=1)h.push({x:y*S,y:w*L});const R=[];h.forEach(S=>{this.camera.setViewOffset(r.width,r.height,S.x,S.y,y,w),this.renderManager.render();const L=this.webGLRenderer.domElement.toDataURL(r.mine);R.push(new Promise((P,T)=>{const k=new Image;k.src=L,k.onload=()=>{x.drawImage(k,S.x,S.y,y,w),P(null)}}))}),this.setSize(s.width,s.height),await Promise.all(R).catch(S=>{console.warn(S)}),o=v.toDataURL(r.mine),this.camera.clearViewOffset()}else this.setSize(r.width,r.height),this.renderManager.render(),o=this.webGLRenderer.domElement.toDataURL(r.mine),this.setSize(s.width,s.height);return n&&this.renderManager.play(),o},this.addEventListener("setDom",r=>{r.dom.appendChild(this.webGLRenderer.domElement)}),this.addEventListener("setSize",r=>{this.webGLRenderer.setSize(r.width,r.height,!0)}),this.addEventListener("dispose",()=>{this.webGLRenderer.dispose()}),this.renderManager?(this.renderManager.removeEventListener("render",this.render),this.renderManager.addEventListener("render",r=>{this.webGLRenderer.render(this.scene,this.camera)})):this.render=function(){return this.webGLRenderer.render(this.scene,this.camera),this},!0},gt=class extends rn{constructor(t){super(t)}load(t,e,r,s){this.path!==void 0&&(t=this.path+t),this.manager.itemStart(t),t=this.manager.resolveURL(t);const n=kr.get(t);if(n!==void 0)return setTimeout(()=>{e&&e(n),this.manager.itemEnd(t)},0),n;const o=document.createElement("video");return o.preload=gt.preload,o.autoplay=gt.autoplay,o.loop=gt.loop,o.muted=gt.muted,o.src=t,o.style.position="fixed",o.style.top="0",o.style.left="0",o.style.zIndex="-1",document.body.appendChild(o),o.oncanplay=()=>{kr.add(t,o),this.manager.itemEnd(t),e&&e(o)},o.onerror=a=>{this.manager.itemEnd(t),s&&s(a)},o}};let Et=gt;i(Et,"autoplay",!0);i(Et,"preload","auto");i(Et,"muted",!0);i(Et,"loop",!0);var Q;(function(t){t.BEFORELOAD="beforeLoad",t.LOADING="loading",t.DETAILLOADING="detailLoading",t.DETAILLOADED="detailLoaded",t.LOADED="loaded"})(Q||(Q={}));class yo extends de{constructor(e){super();i(this,"resourceMap"),i(this,"loaderMap"),i(this,"loadTotal"),i(this,"loadSuccess"),i(this,"loadError"),i(this,"isError"),i(this,"isLoading"),i(this,"isLoaded"),i(this,"loadDetailMap"),i(this,"path",""),this.resourceMap=new Map,this.loadTotal=0,this.loadSuccess=0,this.loadError=0,this.isError=!1,this.isLoading=!1,this.isLoaded=!1,this.loadDetailMap={};const r=new Mn,s=new Et,n=new Wn;n.setDRACOLoader(new Vn),n.setKTX2Loader(new Yn),n.setMeshoptDecoder(Qn),this.loaderMap={jpg:r,png:r,jpeg:r,obj:new Xn,mtl:new Kn,mp4:s,webm:s,ogg:s,hdr:new Zn,gltf:n,glb:n},e&&(this.loaderMap=Object.assign(this.loaderMap,e.loaderExtends))}loaded(){return this.dispatchEvent({type:Q.LOADED,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError,resourceMap:this.resourceMap}),this}checkLoaded(){return this.loadTotal===this.loadSuccess+this.loadError&&(this.isError=!0,this.isLoaded=!0,this.isLoading=!1,this.loaded()),this}setPath(e){return this.path=e,this}setRequestHeader(e){return Object.values(this.loaderMap).forEach(r=>{r.setRequestHeader(e)}),this}setResponseType(e){return Object.values(this.loaderMap).forEach(r=>{r.setResponseType&&r.setResponseType(e)}),this}getLoader(e){return this.loaderMap[e]?this.loaderMap[e]:null}load(e){var r;if(this.reset(),this.isLoading=!0,this.dispatchEvent({type:Q.BEFORELOAD,urlList:[...e]}),e.length<=0)return this.checkLoaded(),console.warn("url list is empty."),this;this.loadTotal+=e.length;const s=this.resourceMap,n=this.loaderMap,o=this.loadDetailMap;for(const a of e){let c,u;typeof a=="string"?(c=a,u=((r=c.split(".").pop())==null?void 0:r.toLocaleLowerCase())||""):(c=a.url,u=a.ext.toLocaleLowerCase());const h={url:c,progress:0,error:!1,message:c};if(o[c]=h,s.has(c)){h.progress=1,this.loadSuccess+=1,this.dispatchEvent({type:Q.DETAILLOADED,detail:h}),this.dispatchEvent({type:Q.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded();continue}if(!u){h.message=`url: ${c} \u5730\u5740\u6709\u8BEF\uFF0C\u65E0\u6CD5\u83B7\u53D6\u6587\u4EF6\u683C\u5F0F\u3002`,console.warn(h.message),h.error=!0,this.isError=!0,this.loadError+=1,this.dispatchEvent({type:Q.DETAILLOADED,detail:h}),this.dispatchEvent({type:Q.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError});continue}const m=n[u];if(!m){h.message=`url: ${c} \u4E0D\u652F\u6301\u6B64\u6587\u4EF6\u683C\u5F0F\u52A0\u8F7D\u3002`,console.warn(h.message),h.error=!0,this.isError=!0,this.loadError+=1,this.dispatchEvent({type:Q.DETAILLOADED,detail:h}),this.dispatchEvent({type:Q.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError});continue}const f=c.replace(/\\/g,"/").split("/"),y=f.pop(),w=this.path+f.join("/")+"/";m.setPath(w).loadAsync(y,v=>{h.progress=Number((v.loaded/v.total).toFixed(2)),this.dispatchEvent({type:Q.DETAILLOADING,detail:h})}).then(v=>{h.progress=1,this.loadSuccess+=1,this.resourceMap.set(c,v),this.dispatchEvent({type:Q.DETAILLOADED,detail:h}),this.dispatchEvent({type:Q.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded()}).catch(v=>{h.error=!0,h.message=JSON.stringify(v),this.loadError+=1,this.dispatchEvent({type:Q.DETAILLOADED,detail:h}),this.dispatchEvent({type:Q.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded()})}return this}reset(){return this.loadTotal=0,this.loadSuccess=0,this.loadError=0,this.isError=!1,this.isLoading=!1,this.isLoaded=!1,this.loadDetailMap={},this}register(e,r){return this.loaderMap[e]=r,this}hasLoaded(e){return this.resourceMap.has(e)}getResource(e){return this.resourceMap.get(e)}getLoadDetailMap(){return this.loadDetailMap}setLoadDetailMap(e){return this.loadDetailMap=e,this}remove(e){}toJSON(){const e=[];return this.resourceMap.forEach((r,s)=>{e.push(s)}),JSON.stringify(e)}exportConfig(){const e=[];return this.resourceMap.forEach((r,s)=>{e.push(s)}),e}dispose(){return this.resourceMap.clear(),this}}const So=function(t){if(this.loaderManager)return console.warn("engine has installed loaderManager plugin."),!1;const e=new yo(t);return this.loaderManager=e,this.loadResources=(r,s)=>{if(this.resourceManager){const n=o=>{s(void 0,o),this.resourceManager.removeEventListener("mapped",n)};try{this.resourceManager.addEventListener("mapped",n)}catch(o){s(o)}}else{const n=o=>{s(void 0,o),this.loaderManager.removeEventListener("loaded",n)};try{this.loaderManager.addEventListener("loaded",n)}catch(o){s(o)}}return this.loaderManager.load(r),this},this.loadResourcesAsync=r=>new Promise((s,n)=>{if(this.resourceManager){const o=a=>{s(a),this.resourceManager.removeEventListener("mapped",o)};try{this.resourceManager.addEventListener("mapped",o)}catch(a){n(a)}}else{const o=a=>{s(a),this.loaderManager.removeEventListener("loaded",o)};try{this.loaderManager.addEventListener("loaded",o)}catch(a){n(a)}}this.loaderManager.load(r)}),!0};var l;(function(t){t.BOXGEOMETRY="BoxGeometry",t.SPHEREGEOMETRY="SphereGeometry",t.LOADGEOMETRY="LoadGeometry",t.PLANEGEOMETRY="PlaneGeometry",t.CIRCLEGEOMETRY="CircleGeometry",t.CONEGEOMETRY="ConeGeometry",t.CYLINDERGEOMETRY="CylinderGeometry",t.DODECAHEDRONGEOMETRY="DodecahedronGeometry",t.TORUSGEOMETRY="TorusGeometry",t.RINGGEOMETRY="RingGeometry",t.EDGESGEOMETRY="EdgesGeometry",t.LINECURVEGEOMETRY="LineCurveGeometry",t.SPLINECURVEGEOMETRY="SplineCurveGeometry",t.CUBICBEZIERCURVEGEOMETRY="CubicBezierCurveGeometry",t.QUADRATICBEZIERCURVEGEOMETRY="QuadraticBezierCurveGeometry",t.CUSTOMGEOMETRY="CustomGeometry",t.LINETUBEGEOMETRY="LineTubeGeometry",t.SPLINETUBEGEOMETRY="SplineTubeGeometry",t.LINESHAPEGEOMETRY="LineShapeGeometry",t.OBJECT3D="Object3D",t.MESH="Mesh",t.LINE="Line",t.POINTS="Points",t.SPRITE="Sprite",t.GROUP="Group",t.CSS3DOBJECT="CSS3DObject",t.CSS3DSPRITE="CSS3DSprite",t.CSS3DPLANE="CSS3DPlane",t.IMAGETEXTURE="ImageTexture",t.CUBETEXTURE="CubeTexture",t.CANVASTEXTURE="CanvasTexture",t.VIDEOTEXTURE="VideoTexture",t.LOADTEXTURE="LoadTexture",t.MESHBASICMATERIAL="MeshBasicMaterial",t.MESHSTANDARDMATERIAL="MeshStandardMaterial",t.MESHPHONGMATERIAL="MeshPhongMaterial",t.SPRITEMATERIAL="SpriteMaterial",t.LINEBASICMATERIAL="LineBasicMaterial",t.POINTSMATERIAL="PointsMaterial",t.SHADERMATERIAL="ShaderMaterial",t.MESHPHYSICALMATERIAL="MeshPhysicalMaterial",t.AMBIENTLIGHT="AmbientLight",t.SPOTLIGHT="SpotLight",t.POINTLIGHT="PointLight",t.DIRECTIONALLIGHT="DirectionalLight",t.HEMISPHERELIGHT="HemisphereLight",t.PERSPECTIVECAMERA="PerspectiveCamera",t.ORTHOGRAPHICCAMERA="OrthographicCamera",t.WEBGLRENDERER="WebGLRenderer",t.CSS3DRENDERER="CSS3DRenderer",t.SCENE="Scene",t.TRNASFORMCONTROLS="TransformControls",t.ORBITCONTROLS="OrbitControls",t.SMAAPASS="SMAAPass",t.UNREALBLOOMPASS="UnrealBloomPass",t.SELECTIVEBLOOMPASS="SelectiveBloomPass",t.SCRIPTANIMATION="ScriptAnimation",t.KEYFRAMEANIMATION="KeyframeAnimation"})(l||(l={}));var p;(function(t){t.OBJECT3D="Object3D",t.CAMERA="camera",t.LIGHT="light",t.GEOMETRY="geometry",t.TEXTURE="texture",t.MATERIAL="material",t.RENDERER="renderer",t.SCENE="scene",t.SPRITE="sprite",t.CONTROLS="controls",t.LINE="line",t.MESH="mesh",t.POINTS="points",t.GROUP="group",t.CSS3D="css3D",t.PASS="pass",t.ANIMATION="animation"})(p||(p={}));var dr;(function(t){t[t.CAMERA=p.CAMERA]="CAMERA",t[t.LIGHT=p.LIGHT]="LIGHT",t[t.SCENE=p.SCENE]="SCENE",t[t.SPRITE=p.SPRITE]="SPRITE",t[t.LINE=p.LINE]="LINE",t[t.MESH=p.MESH]="MESH",t[t.POINTS=p.POINTS]="POINTS",t[t.GROUP=p.GROUP]="GROUP",t[t.CSS3D=p.CSS3D]="CSS3D",t[t.OBJECT3D=p.OBJECT3D]="OBJECT3D"})(dr||(dr={}));l.IMAGETEXTURE+"",p.TEXTURE,l.CUBETEXTURE+"",p.TEXTURE,l.CANVASTEXTURE+"",p.TEXTURE,l.VIDEOTEXTURE+"",p.TEXTURE,l.MESHBASICMATERIAL+"",p.MATERIAL,l.MESHSTANDARDMATERIAL+"",p.MATERIAL,l.MESHPHONGMATERIAL+"",p.MATERIAL,l.SPRITEMATERIAL+"",p.MATERIAL,l.LINEBASICMATERIAL+"",p.MATERIAL,l.POINTSMATERIAL+"",p.MATERIAL,l.SHADERMATERIAL+"",p.MATERIAL,l.AMBIENTLIGHT+"",p.LIGHT,l.SPOTLIGHT+"",p.LIGHT,l.POINTLIGHT+"",p.LIGHT,l.DIRECTIONALLIGHT+"",p.LIGHT,l.BOXGEOMETRY+"",p.GEOMETRY,l.SPHEREGEOMETRY+"",p.GEOMETRY,l.LOADGEOMETRY+"",p.GEOMETRY,l.CUSTOMGEOMETRY+"",p.GEOMETRY,l.PLANEGEOMETRY+"",p.GEOMETRY,l.CIRCLEGEOMETRY+"",p.GEOMETRY,l.CONEGEOMETRY+"",p.GEOMETRY,l.CIRCLEGEOMETRY+"",p.GEOMETRY,l.EDGESGEOMETRY+"",p.GEOMETRY,l.CYLINDERGEOMETRY+"",p.GEOMETRY,l.LINECURVEGEOMETRY+"",p.GEOMETRY,l.SPLINECURVEGEOMETRY+"",p.GEOMETRY,l.CUBICBEZIERCURVEGEOMETRY+"",p.GEOMETRY,l.QUADRATICBEZIERCURVEGEOMETRY+"",p.GEOMETRY,l.LINETUBEGEOMETRY+"",p.GEOMETRY,l.SPLINETUBEGEOMETRY+"",p.GEOMETRY,l.TORUSGEOMETRY+"",p.GEOMETRY,l.RINGGEOMETRY+"",p.GEOMETRY,l.LINESHAPEGEOMETRY+"",p.GEOMETRY,l.SPRITE+"",p.SPRITE,l.LINE+"",p.LINE,l.MESH+"",p.MESH,l.POINTS+"",p.POINTS,l.GROUP+"",p.GROUP,l.CSS3DOBJECT+"",p.CSS3D,l.CSS3DSPRITE+"",p.CSS3D,l.CSS3DPLANE+"",p.CSS3D,l.PERSPECTIVECAMERA+"",p.CAMERA,l.ORTHOGRAPHICCAMERA+"",p.CAMERA,l.WEBGLRENDERER+"",p.RENDERER,l.SCENE+"",p.SCENE,l.TRNASFORMCONTROLS+"",p.CONTROLS,l.ORBITCONTROLS+"",p.CONTROLS,l.SMAAPASS+"",p.PASS,l.UNREALBLOOMPASS+"",p.PASS,l.SCRIPTANIMATION+"",p.ANIMATION,l.KEYFRAMEANIMATION+"",p.ANIMATION;const It=t=>{const e=r=>t.toLocaleLowerCase().includes(r.toLocaleLowerCase());for(const r of Object.values(p))if(e(r))return r;return null},Se=()=>({vid:"",name:"",type:l.OBJECT3D,castShadow:!0,receiveShadow:!0,lookAt:"",visible:!0,matrixAutoUpdate:!0,renderOrder:0,position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},up:{x:0,y:1,z:0},parent:"",children:[],pointerdown:[],pointermove:[],pointerup:[],pointerenter:[],pointerleave:[],click:[],dblclick:[],contextmenu:[]}),jt=function(){return Object.assign(Se(),{type:"Light",color:"rgb(255, 255, 255)",intensity:1})},Mo=function(){return Object.assign(Se(),{type:l.AMBIENTLIGHT,color:"rgb(255, 255, 255)",intensity:1})},bo=function(){return Object.assign(jt(),{type:l.POINTLIGHT,distance:30,decay:.01})},vo=function(){return Object.assign(jt(),{type:l.SPOTLIGHT,distance:30,angle:Math.PI/180*45,penumbra:.01,decay:.01})},Ro=function(){return Object.assign(jt(),{type:l.DIRECTIONALLIGHT,shadow:{mapSize:{width:512,height:512},camera:{near:.5,far:500}}})},wo=function(){return Object.assign(jt(),{type:l.HEMISPHERELIGHT,color:"rgb(255, 255, 255)",groundColor:"rgb(0, 0, 0)"})},X=function(){return{vid:"",type:"Geometry",position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},groups:[]}},To=function(){return Object.assign(X(),{type:l.BOXGEOMETRY,width:5,height:5,depth:5,widthSegments:1,heightSegments:1,depthSegments:1})},Co=function(){return Object.assign(X(),{type:l.SPHEREGEOMETRY,radius:3,widthSegments:32,heightSegments:32,phiStart:0,phiLength:Math.PI*2,thetaStart:0,thetaLength:Math.PI})},xo=function(){return Object.assign(X(),{type:l.PLANEGEOMETRY,width:5,height:5,widthSegments:1,heightSegments:1})},Oo=function(){return Object.assign(X(),{type:l.CIRCLEGEOMETRY,radius:3,segments:8,thetaStart:0,thetaLength:Math.PI*2})},Ao=function(){return Object.assign(X(),{type:l.CONEGEOMETRY,radius:3,height:5,radialSegments:8,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:Math.PI*2})},Lo=function(){return Object.assign(X(),{type:l.TORUSGEOMETRY,radius:3,tube:.4,radialSegments:8,tubularSegments:6,arc:Math.PI*2})},Do=function(){return Object.assign(X(),{type:l.RINGGEOMETRY,innerRadius:2,outerRadius:3,thetaSegments:8,phiSegments:8,thetaStart:0,thetaLength:Math.PI*2})},Po=function(){return Object.assign(X(),{type:l.LOADGEOMETRY,url:""})},Io=function(){return Object.assign(X(),{type:l.CUSTOMGEOMETRY,attribute:{position:[],color:[],index:[],normal:[],uv:[],uv2:[]}})},jo=function(){return Object.assign(X(),{type:l.CYLINDERGEOMETRY,radiusTop:3,radiusBottom:3,height:5,radialSegments:8,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:Math.PI*2})},Go=function(){return Object.assign(X(),{type:"",radius:3,detail:0})},No=function(){return Object.assign(X(),{type:l.LOADGEOMETRY,url:"",thresholdAngle:1})},Gt=function(){return Object.assign(X(),{path:[],divisions:36,space:!0})},Bo=function(){return Object.assign(Gt(),{type:l.LINECURVEGEOMETRY})},Ho=function(){return Object.assign(Gt(),{type:l.SPLINECURVEGEOMETRY})},Uo=function(){return Object.assign(Gt(),{type:l.CUBICBEZIERCURVEGEOMETRY})},zo=function(){return Object.assign(Gt(),{type:l.QUADRATICBEZIERCURVEGEOMETRY})},ds=function(){return Object.assign(X(),{type:"TubeGeometry",path:[],tubularSegments:64,radius:1,radialSegments:8,closed:!1})},Fo=function(){return Object.assign(ds(),{type:l.LINETUBEGEOMETRY})},_o=function(){return Object.assign(ds(),{type:l.SPLINETUBEGEOMETRY})},ko=function(){return Object.assign(X(),{path:[],curveSegments:12})},$o=function(){return Object.assign(ko(),{type:l.LINESHAPEGEOMETRY})},yt=function(){return{vid:"",type:"Texture",name:"",mapping:bn,wrapS:es,wrapT:es,magFilter:At,minFilter:vn,anisotropy:1,format:or,flipY:!0,offset:{x:0,y:0},repeat:{x:1,y:1},rotation:0,center:{x:0,y:0},matrixAutoUpdate:!0,encoding:ts,needsUpdate:!1}},Wo=function(){return Object.assign(yt(),{type:l.IMAGETEXTURE,url:""})},Vo=function(){return Object.assign(yt(),{type:l.VIDEOTEXTURE,url:"",minFilter:At})},Yo=function(){return Object.assign(yt(),{type:l.CUBETEXTURE,cube:{nx:"",ny:"",nz:"",px:"",py:"",pz:""},mapping:Rn,flipY:!1})},Qo=function(){return Object.assign(yt(),{type:l.CANVASTEXTURE,url:"",needsUpdate:!1})},Xo=function(){return Object.assign(yt(),{type:l.LOADTEXTURE,url:""})},_e=function(){return{vid:"",type:"Material",alphaTest:0,colorWrite:!0,depthTest:!0,depthWrite:!0,fog:!0,name:"",needsUpdate:!1,opacity:1,dithering:!1,shadowSide:null,side:wn,toneMapped:!0,transparent:!1,visible:!0,blendDst:Tn,blendDstAlpha:null,blendEquation:Cn,blendEquationAlpha:null,blending:xn,blendSrc:On,blendSrcAlpha:null,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0}},Ko=function(){return Object.assign(_e(),{type:l.MESHBASICMATERIAL,color:"rgb(255, 255, 255)",combine:rs,aoMapIntensity:1,fog:!0,lightMapIntensity:1,reflectivity:1,refractionRatio:.98,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",wireframeLinewidth:1,map:"",envMap:"",alphaMap:"",aoMap:"",lightMap:"",specularMap:""})},ps=function(){return Object.assign(_e(),{type:l.MESHSTANDARDMATERIAL,aoMapIntensity:1,bumpScale:1,color:"rgb(255, 255, 255)",displacementScale:1,displacementBias:0,emissive:"rgb(0, 0, 0)",emissiveIntensity:1,envMapIntensity:1,flatShading:!1,lightMapIntensity:1,metalness:0,normalMapType:ss,refractionRatio:.98,roughness:1,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",roughnessMap:"",normalMap:"",metalnessMap:"",map:"",lightMap:"",envMap:"",emissiveMap:"",displacementMap:"",bumpMap:"",alphaMap:"",aoMap:""})},Zo=function(){return Object.assign(ps(),{type:l.MESHPHYSICALMATERIAL,attenuationColor:"rgb(255, 255, 255)",attenuationDistance:0,clearcoat:0,clearcoatNormalScale:{x:1,y:1},clearcoatRoughness:0,ior:1.5,reflectivity:.5,sheen:0,sheenRoughness:1,sheenColor:"rgb(255, 255, 255)",specularIntensity:0,specularColor:"rgb(255, 255, 255)",thickness:0,transmission:0,clearcoatMap:"",clearcoatNormalMap:"",clearcoatRoughnessMap:"",sheenRoughnessMap:"",sheenColorMap:"",specularIntensityMap:"",specularColorMap:"",thicknessMap:"",transmissionMap:""})},Jo=function(){return Object.assign(_e(),{type:l.MESHPHONGMATERIAL,aoMapIntensity:1,bumpScale:1,color:"rgb(255, 255, 255)",displacementScale:1,displacementBias:0,emissive:"rgb(0, 0, 0)",emissiveIntensity:1,envMapIntensity:1,flatShading:!1,lightMapIntensity:1,normalMapType:ss,refractionRatio:.98,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",specular:"rgb(17, 17, 17)",shininess:30,combine:rs,normalMap:"",map:"",lightMap:"",envMap:"",emissiveMap:"",displacementMap:"",bumpMap:"",alphaMap:"",aoMap:"",specularMap:""})},qo=function(){return Object.assign(_e(),{type:l.SPRITEMATERIAL,color:"rgb(255, 255, 255)",rotation:0,map:"",alphaMap:"",sizeAttenuation:!0})},ei=function(){return Object.assign(_e(),{type:l.LINEBASICMATERIAL,color:"rgb(255, 255, 255)",linecap:"round",linejoin:"round",linewidth:1})},ti=function(){return Object.assign(_e(),{type:l.POINTSMATERIAL,map:"",alphaMap:"",color:"rgb(255, 255, 255)",sizeAttenuation:!0,size:1})},ri=function(){return Object.assign(_e(),{type:l.SHADERMATERIAL,shader:"defaultShader",uniforms:{}})},si=function(){return Object.assign(Se(),{type:l.PERSPECTIVECAMERA,adaptiveWindow:!1,fov:45,aspect:1920/1080,near:5,far:50})},ni=function(){return Object.assign(Se(),{type:l.ORTHOGRAPHICCAMERA,adaptiveWindow:!1,left:-window.innerWidth,right:window.innerWidth,top:window.innerHeight,bottom:-window.innerHeight,near:5,far:50,zoom:1})},ms=function(){return{vid:"",type:"Renderer",size:null}},oi=function(){return Object.assign(ms(),{vid:l.WEBGLRENDERER,type:l.WEBGLRENDERER,clearColor:"rgba(0, 0, 0, 0)",outputEncoding:ts,physicallyCorrectLights:!1,shadowMap:{enabled:!1,autoUpdate:!0,needsUpdate:!1,type:An},toneMapping:Ln,toneMappingExposure:1,pixelRatio:window.devicePixelRatio,adaptiveCamera:!1,viewport:null,scissor:null})},ii=function(){return Object.assign(ms(),{vid:l.CSS3DRENDERER,type:l.CSS3DRENDERER})},ai=function(){return Object.assign(Se(),{vid:l.SCENE,type:l.SCENE,background:"",environment:"",fog:{type:"",color:"rgb(150, 150, 150)",near:1,far:200,density:.003}})},ci=function(){return{vid:l.TRNASFORMCONTROLS,type:l.TRNASFORMCONTROLS,axis:"XYZ",enabled:!0,mode:"translate",snapAllow:!1,rotationSnap:Math.PI/180*10,translationSnap:5,scaleSnap:.1,showX:!0,showY:!0,showZ:!0,size:1,space:"world"}},li=function(){return{vid:l.ORBITCONTROLS,type:l.ORBITCONTROLS,autoRotate:!1,autoRotateSpeed:2,enableDamping:!1,dampingFactor:.05,enabled:!0,enablePan:!0,enableRotate:!0,enableZoom:!0,maxAzimuthAngle:1/0,maxDistance:1/0,maxPolarAngle:Math.PI,maxZoom:1/0,minAzimuthAngle:-1/0,minDistance:0,minPolarAngle:0,minZoom:0,panSpeed:1,rotateSpeed:1,zoomSpeed:1,screenSpacePanning:!0,target:null}},Nt=function(){return Object.assign(Se(),{material:"",geometry:""})},hi=function(){return Object.assign(Nt(),{type:"Sprite",material:"",center:{x:.5,y:.5}})},ui=function(){return Object.assign(Nt(),{type:l.MESH,geometry:"",material:""})},di=function(){return Object.assign(Nt(),{type:l.POINTS,geometry:"",material:""})},pi=function(){return Object.assign(Nt(),{type:l.LINE,geometry:"",material:""})},mi=function(){return Object.assign(Se(),{type:l.GROUP,children:[]})},pr=function(){return{vid:"",type:"Pass"}},fi=function(){return Object.assign(pr(),{type:l.SMAAPASS})},gi=function(){return Object.assign(pr(),{type:l.UNREALBLOOMPASS,strength:1.5,threshold:0,radius:0})},Ei=function(){return Object.assign(pr(),{type:l.SELECTIVEBLOOMPASS,strength:1,threshold:0,radius:0,renderScene:"",renderCamera:"",selectedObjects:[]})},fs=function(){return{vid:"",type:"",name:"",target:"",attribute:"",play:!0}},yi=function(){return Object.assign(fs(),{type:l.SCRIPTANIMATION,script:{name:""}})},Si=function(){return Object.assign(fs(),{type:l.KEYFRAMEANIMATION,script:{name:""}})},mr=function(){return Object.assign(Se(),{type:l.CSS3DOBJECT,element:"",width:50,height:50})},Mi=function(){return Object.assign(mr(),{type:l.CSS3DPLANE})},bi=function(){return Object.assign(mr(),{type:l.CSS3DSPRITE,rotation2D:0})},$={[l.IMAGETEXTURE]:Wo,[l.CUBETEXTURE]:Yo,[l.CANVASTEXTURE]:Qo,[l.VIDEOTEXTURE]:Vo,[l.LOADTEXTURE]:Xo,[l.MESHBASICMATERIAL]:Ko,[l.MESHSTANDARDMATERIAL]:ps,[l.MESHPHONGMATERIAL]:Jo,[l.SPRITEMATERIAL]:qo,[l.LINEBASICMATERIAL]:ei,[l.POINTSMATERIAL]:ti,[l.SHADERMATERIAL]:ri,[l.MESHPHYSICALMATERIAL]:Zo,[l.AMBIENTLIGHT]:Mo,[l.SPOTLIGHT]:vo,[l.POINTLIGHT]:bo,[l.DIRECTIONALLIGHT]:Ro,[l.HEMISPHERELIGHT]:wo,[l.BOXGEOMETRY]:To,[l.SPHEREGEOMETRY]:Co,[l.LOADGEOMETRY]:Po,[l.CUSTOMGEOMETRY]:Io,[l.PLANEGEOMETRY]:xo,[l.CIRCLEGEOMETRY]:Oo,[l.CONEGEOMETRY]:Ao,[l.CYLINDERGEOMETRY]:jo,[l.EDGESGEOMETRY]:No,[l.LINECURVEGEOMETRY]:Bo,[l.SPLINECURVEGEOMETRY]:Ho,[l.CUBICBEZIERCURVEGEOMETRY]:Uo,[l.QUADRATICBEZIERCURVEGEOMETRY]:zo,[l.DODECAHEDRONGEOMETRY]:Go,[l.SPLINETUBEGEOMETRY]:_o,[l.LINETUBEGEOMETRY]:Fo,[l.TORUSGEOMETRY]:Lo,[l.RINGGEOMETRY]:Do,[l.LINESHAPEGEOMETRY]:$o,[l.OBJECT3D]:Se,[l.SPRITE]:hi,[l.LINE]:pi,[l.MESH]:ui,[l.POINTS]:di,[l.GROUP]:mi,[l.CSS3DOBJECT]:mr,[l.CSS3DSPRITE]:bi,[l.CSS3DPLANE]:Mi,[l.PERSPECTIVECAMERA]:si,[l.ORTHOGRAPHICCAMERA]:ni,[l.WEBGLRENDERER]:oi,[l.CSS3DRENDERER]:ii,[l.SCENE]:ai,[l.TRNASFORMCONTROLS]:ci,[l.ORBITCONTROLS]:li,[l.SMAAPASS]:fi,[l.UNREALBLOOMPASS]:gi,[l.SELECTIVEBLOOMPASS]:Ei,[l.SCRIPTANIMATION]:yi,[l.KEYFRAMEANIMATION]:Si};class ke{}class fr extends ke{constructor(){super(...arguments);i(this,"selector",(e,r,s)=>r instanceof HTMLImageElement&&s.get(fr)||null)}parse({url:e,resource:r,configMap:s,resourceMap:n}){const o=$[l.IMAGETEXTURE]();o.url=e,n.set(e,r),s.set(e,o)}}class gr extends ke{constructor(){super(...arguments);i(this,"selector",(e,r,s)=>r instanceof HTMLCanvasElement&&s.get(gr)||null)}parse({url:e,resource:r,configMap:s,resourceMap:n}){const o=$[l.CANVASTEXTURE]();o.url=e,n.set(e,r),s.set(e,o)}}class Er extends ke{constructor(){super(...arguments);i(this,"selector",(e,r,s)=>r instanceof HTMLVideoElement&&s.get(Er)||null)}parse({url:e,resource:r,configMap:s,resourceMap:n}){const o=$[l.VIDEOTEXTURE]();o.url=e,n.set(e,r),s.set(e,o)}}function vi(t,e){return t in e}function K(t,e,r,s){const n=(o,a,c)=>{for(const u in o)if(a[u]!==void 0&&!(c&&c[u])){if(typeof o[u]=="object"&&typeof o[u]!==null){c&&typeof c[u]=="object"&&typeof c[u]!==null?n(o[u],a[u],c[u]):n(o[u],a[u]);continue}a[u]=o[u]}};n(t,e,r),s&&s()}class Bt extends ke{constructor(){super(...arguments);i(this,"selector",(e,r,s)=>r.isObject3D&&s.get(Bt)||null)}parse(e){this.parseObject3D(e)}parseColor(e){return`rgb(${Math.round(255*e.r)}, ${Math.round(255*e.g)}, ${Math.round(255*e.b)})`}attributeEnhance(e){const r={};for(const s in e)s.startsWith("_")?r[s.slice(1)]=e[s]:r[s]=e[s];return r}parseTexture({url:e,resource:r,configMap:s,resourceMap:n}){n.set(e,r);const o=$[l.LOADTEXTURE]();s.set(e,o),o.vid=ft(),o.url=e,K(r,o,{type:!0,vid:!0,url:!0})}parseMaterial({url:e,resource:r,configMap:s,resourceMap:n}){if(n.set(e,r),!$[r.type]){console.warn("can not found support config in vis for this resource",r);return}const o=$[r.type]();s.set(e,o),o.vid=ft(),K(this.attributeEnhance(r),o,{type:!0,vid:!0});for(const a in r)if(!!r[a]){if(r[a].isColor)o[a]=this.parseColor(r[a]);else if(a.toLocaleLowerCase().endsWith("map")&&r[a]){const c=`${e}.${a}`;this.parseTexture({url:c,resource:r[a],configMap:s,resourceMap:n}),o[a]=s.get(c).vid}}}parseGeometry({url:e,resource:r,configMap:s,resourceMap:n}){n.set(e,r),r.computeBoundingBox();const o=r.boundingBox,a=o.getCenter(new O),c=$[l.LOADGEOMETRY]();c.vid=ft(),c.url=e,c.position.x=a.x/(o.max.x-o.min.x)*2,c.position.y=a.y/(o.max.y-o.min.y)*2,c.position.z=a.z/(o.max.z-o.min.z)*2,s.set(e,c)}parseObject3D({url:e,resource:r,configMap:s,resourceMap:n}){if(n.set(e,r),!$[r.type]){console.warn("can not found support config in vis for this resource",r);return}const o=$[r.type]();if(o.vid=ft(),K(r,o,{type:!0,vid:!0,children:!0,geometry:!0,material:!0,parent:!0,lookAt:!0}),o.rotation.x=r.rotation.x,o.rotation.y=r.rotation.y,o.rotation.z=r.rotation.z,s.set(e,o),r.material)if(Array.isArray(r.material))o.material=[],r.material.forEach((a,c,u)=>{const h=`${e}.material.${c}`;this.parseMaterial({url:h,resource:a,configMap:s,resourceMap:n}),o.material.push(s.get(h).vid)});else{const a=`${e}.material`;this.parseMaterial({url:a,resource:r.material,configMap:s,resourceMap:n}),o.material=s.get(a).vid}if(r.geometry){const a=`${e}.geometry`;this.parseGeometry({url:a,resource:r.geometry,configMap:s,resourceMap:n}),o.geometry=s.get(a).vid}r.children&&r.children.length&&r.children.forEach((a,c,u)=>{const h=`${e}.children.${c}`;this.parseObject3D({url:h,resource:a,configMap:s,resourceMap:n}),o.children.push(s.get(h).vid)})}}class yr extends ke{constructor(){super(...arguments);i(this,"selector",(e,r,s)=>r instanceof HTMLElement&&s.get(yr)||null)}parse({url:e,resource:r,configMap:s,resourceMap:n}){const o=$[l.CSS3DPLANE]();o.element=e,n.set(e,r),s.set(e,o)}}class Sr extends ke{constructor(){super(...arguments);i(this,"selector",(e,r,s)=>r instanceof ce&&s.get(Sr)||null)}parse({url:e,resource:r,configMap:s,resourceMap:n}){const o=$[l.LOADTEXTURE]();o.url=e,n.set(e,r),s.set(e,o)}}class Mr extends ke{constructor(){super();i(this,"object3DParser",new Bt),i(this,"selector",(e,r,s)=>r.parser&&r.animations&&r.scene&&r.scenes&&s.get(Mr)||null)}parse({url:e,resource:r,configMap:s,resourceMap:n}){this.object3DParser.parse({url:`${e}.scene`,resource:r.scene,configMap:s,resourceMap:n})}}var gs;(function(t){t.MAPPED="mapped"})(gs||(gs={}));class Ri extends de{constructor(e={}){super();i(this,"structureMap",new Map),i(this,"configMap",new Map),i(this,"resourceMap",new Map),i(this,"paserMap",new Map),this.addParser(new fr).addParser(new gr).addParser(new Er).addParser(new Bt).addParser(new yr).addParser(new Sr).addParser(new Mr);const r=new Map;for(const s in e)r.has(s)&&console.warn(`resourceManager construct params rescource already exist: ${s}, that will be cover.`),r.set(s,e[s]);this.mappingResource(r)}addParser(e){return this.paserMap.has(e.constructor)?this:(this.paserMap.set(e.constructor,e),this)}mappingResource(e,r){const s=this.configMap,n=this.resourceMap,o=[...this.paserMap.values()],a={};for(const[c,u]of e.entries()){if((r==null?void 0:r.parser)&&r.parser[c]){r.parser[c].parse({url:c,resource:u,configMap:s,resourceMap:n});continue}if((r==null?void 0:r.selector)&&r.selector[c]){const m=r.selector[c](c,u,this.paserMap);if(!m){console.warn("resource manager hanlder can not found this resource parser: ",u,r.selector[c]);continue}m.parse({url:c,resource:u,configMap:s,resourceMap:n}),a[c]=this.getResourceConfig(c);continue}let h=null;for(const m of o)if(h=m.selector(c,u,this.paserMap),h)break;if(!h){console.warn("resouce manager can not found some handler to parser this resource:",u);continue}h.parse({url:c,resource:u,configMap:s,resourceMap:n}),a[c]=this.getResourceConfig(c)}return this.dispatchEvent({type:"mapped",structureMap:this.structureMap,configMap:s,resourceMap:n,resourceConfig:a}),this}getResourceConfig(e){const r=this.configMap,s={};return[...r.keys()].filter(n=>n.startsWith(e)).some(n=>{const o=r.get(n);if(!o)console.error(`unknow error: can not found config by url: ${n}`);else{const a=It(o.type);a?(!s[a]&&(s[a]={}),s[a][o.vid]=o):console.error(`unknow error: can not found module by type: ${o.type}`,o)}}),s}hasResource(e){return this.resourceMap.has(e)}remove(e){const r=this.configMap,s=this.resourceMap;return[...r.keys()].filter(n=>n.startsWith(e)).forEach(n=>{r.delete(n);const o=s.get(n);o.dispose&&o.dispose(),s.delete(n)}),this}dispose(){this.resourceMap.forEach((e,r)=>{e.dispose&&e.dispose()}),this.resourceMap.clear(),this.configMap.clear()}}const wi=function(t){if(this.resourceManager)return console.warn("engine has installed resourceManager plugin."),!1;const e=new Ri(t.resources);return this.resourceManager=e,this.loaderManager&&this.loaderManager.addEventListener("loaded",r=>{this.resourceManager.mappingResource(r.resourceMap)}),this.registerResources=r=>{const s=new Map;return Object.keys(r).forEach(n=>{s.set(n,r[n])}),this.resourceManager.mappingResource(s),this},this.addEventListener("dispose",()=>{this.resourceManager.dispose()}),!0},et=(t,e)=>e===1/0?"Infinity":e===-1/0?"-Infinity":e,br=(t,e)=>e==="Infinity"?1/0:e==="-Infinity"?-1/0:e,St=t=>JSON.parse(JSON.stringify(t,et),br);var Ti={stringify:et,parse:br,clone:St},Ql=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",stringify:et,parse:br,clone:St,default:Ti});const re=class extends de{constructor(t){super();i(this,"ignoreAttribute"),this.ignoreAttribute=t||{}}static proxyGetter(t,e,r){return Reflect.get(t,e,r)}static proxySetter(t,e,r,s,n,o){if(typeof e=="symbol")return Reflect.set(t,e,r,s);re.cacheArray(r);let a;if(t[e]===void 0){if(typeof r=="object"&&r!==null&&!re.proxyWeakSet.has(r)&&!n.ignoreAttribute[e]){const c=o.concat([e]);r=n.proxyExtends(r,c)}a=Reflect.set(t,e,r),n.broadcast({operate:"add",path:o.concat([]),key:e,value:r})}else{if(typeof r=="object"&&r!==null&&!re.proxyWeakSet.has(r)&&!n.ignoreAttribute[e]){const c=o.concat([e]);r=n.proxyExtends(r,c)}if(a=Reflect.set(t,e,r),Array.isArray(t)&&e==="length"){const c=t[Symbol.for(re.arraySymobl)],u=c.length-t.length;if(u>0){let h=0,m=0;for(const f of c){if(!t.includes(f)&&(n.broadcast({operate:"delete",path:o.concat([]),key:m.toString(),value:f}),h+=1,h===u))break;m+=1}}return t[Symbol.for(this.arraySymobl)]=t.concat([]),a}n.broadcast({operate:"set",path:o.concat([]),key:e,value:r})}return a}static proxyDeleter(t,e,r,s){const n=t[e],o=Reflect.deleteProperty(t,e);return Array.isArray(t)||typeof e=="symbol"||r.broadcast({operate:"delete",path:s.concat([]),key:e,value:n}),o}proxyExtends(t,e=[]){if(re.proxyWeakSet.has(t)||typeof t!="object")return t;const r={get:re.proxyGetter,set:(n,o,a,c)=>re.proxySetter(n,o,a,c,this,e),deleteProperty:(n,o)=>re.proxyDeleter(n,o,this,e)};if(typeof t=="object"&&t!==null)for(const n in t){const o=e.concat([n]);let a=this.ignoreAttribute,c=!1;for(const u of o.slice(1)){if(a[u]===!0){c=!0;break}a[u]&&(a=a[u])}c||vi(n,t)&&typeof t[n]=="object"&&t[n]!==null&&(re.cacheArray(t[n]),t[n]=this.proxyExtends(t[n],o))}const s=new Proxy(t,r);return re.proxyWeakSet.add(s),s}broadcast({operate:t,path:e,key:r,value:s}){return{__poto__:!0,length:!0}[r]?this:(this.dispatchEvent({type:"broadcast",notice:{operate:t,path:e,key:r,value:s}}),this)}};let Ht=re;i(Ht,"proxyWeakSet",new WeakSet);i(Ht,"arraySymobl","vis.array");i(Ht,"cacheArray",function(t){Array.isArray(t)&&!t[Symbol.for(re.arraySymobl)]&&(t[Symbol.for(re.arraySymobl)]=t.concat([]))});class Ci{constructor(){i(this,"rule"),i(this,"memberSet"),this.rule=function(){},this.memberSet=new Set}apply(e){return this.memberSet.add(e),this}cancel(e){return this.memberSet.delete(e),this}setRule(e){return this.rule=e,this}translate(e){const r=this.rule;return this.memberSet.forEach(s=>{r(e,s)}),this}}class pe{constructor(e,r,s){i(this,"data"),i(this,"broadcast"),i(this,"translater"),this.translater=new Ci().setRule(e),this.broadcast=new Ht(s),this.data=this.broadcast.proxyExtends(r),this.broadcast.addEventListener("broadcast",n=>{this.translater.translate(n.notice)})}getData(){return this.data}setData(e){return this.data=e,this}proxyData(e){return this.data=this.broadcast.proxyExtends(e),this.data}existSymbol(e){return Boolean(this.data[e])}addConfig(e){return this.data[e.vid]=e,this}getConfig(e){return this.data[e]}removeConfig(e){const r=this.data;r[e]!==void 0&&delete r[e]}addCompiler(e){return e.setTarget(this.data),e.compileAll(),this.translater.apply(e),this}toJSON(e=!0){return e?JSON.stringify(this.exportConfig(),et):JSON.stringify(this.data,et)}exportConfig(e=!0){if(e){const r=this.data,s={},n={},o=(a,c,u={})=>{for(const h in a){if(["vid","type"].includes(h)){u[h]=a[h];continue}if(typeof a[h]=="object"&&a[h]!==null){if(Array.isArray(a[h])){if(!a[h].length)continue;u[h]=a[h].map(m=>typeof m=="object"&&m!==null?St(m):m);continue}u[h]={},c[h]?(o(a[h],c[h],u[h]),Object.keys(u[h]).length===0&&delete u[h]):u[h]=St(a[h])}else c[h]!==a[h]&&(u[h]=a[h])}};for(const a of Object.values(r)){if(!n[a.type]){if(!$[a.type]){console.error(`can not font some config with: ${a.type}`);continue}n[a.type]=$[a.type]()}s[a.vid]={},o(a,n[a.type],s[a.vid])}return s}else return St(this.data)}load(e){const r=this.data,s={},n=(o,a)=>{for(const c in a)typeof o[c]=="object"&&o[c]!==null&&typeof a[c]=="object"&&a[c]!==null?n(o[c],a[c]):o[c]===void 0&&(o[c]=a[c])};for(const o in e){const a=e[o];if(!s[a.type]){if(!$[a.type]){console.error(`can not font some config with: ${a.type}`);continue}s[a.type]=$[a.type]()}n(a,s[a.type]),r[o]=a}return this}remove(e){const r=this.data;for(const s in e)r[s]!==void 0&&delete r[s];return this}getModule(){return this.MODULE}}const Me=(t,e,r=qe)=>{const{operate:s,key:n,path:o,value:a}=t;let c=n;const u=[].concat(o);if(o.length&&(c=u.shift()),!r(c)){console.warn(`${e.MODULE} Rule: vid is illeage: ${c}`);return}if(s==="add"&&!u.length){e.add(a);return}if(t.operate==="delete"&&!u.length){e.remove(a);return}if(t.operate==="set"&&!u.length&&n===c){e.cover(a);return}e.compile(c,{operate:s,key:n,path:u,value:a})},xi=function(t,e){Me(t,e)};class Oi extends pe{constructor(e,r){!e&&(e={});super(xi,e,r);i(this,"MODULE",p.TEXTURE)}}const Ai=function(t,e){Me(t,e)};class Li extends pe{constructor(e,r){!e&&(e={});super(Ai,e,r);i(this,"MODULE",p.MATERIAL)}}class tt extends pe{constructor(e,r,s){!r&&(r=Object.create(Object.prototype));super(e,r,s);i(this,"MODULE",p.GROUP)}}const be=function(t,e){t.key!=="parent"&&Me(t,e)},Di=function(t,e){be(t,e)};class Pi extends tt{constructor(e,r){!e&&(e={});super(Di,e,r);i(this,"MODULE",p.LIGHT)}}const Ii=function(t,e){Me(t,e)};class ji extends pe{constructor(e,r){!e&&(e={});super(Ii,e,r);i(this,"MODULE",p.GEOMETRY)}}const Gi=function(t,e){be(t,e)};class Ni extends tt{constructor(e,r){!e&&(e={});super(Gi,e,r);i(this,"MODULE",p.CAMERA)}}const Bi=function(t,e){Me(t,e,r=>qe(r)||[l.WEBGLRENDERER,l.CSS3DRENDERER].includes(r))};class Hi extends pe{constructor(e,r){!e&&(e={});super(Bi,e,r);i(this,"MODULE",p.RENDERER)}}const Ui=function(t,e){Me(t,e,r=>qe(r)||[l.SCENE].includes(r))};class zi extends tt{constructor(e,r){!e&&(e={});super(Ui,e,r);i(this,"MODULE",p.SCENE)}}const Fi=function(t,e){Me(t,e,r=>qe(r)||[l.TRNASFORMCONTROLS,l.ORBITCONTROLS].includes(r))};class _i extends pe{constructor(e,r){!e&&(e={});super(Fi,e,r);i(this,"MODULE",p.CONTROLS)}}class Ut extends pe{constructor(e,r,s){!r&&(r=Object.create(Object.prototype));super(e,r,s);i(this,"MODULE",p.MESH)}}const ki=function(t,e){t.key!=="geometry"&&be(t,e)};class $i extends Ut{constructor(e,r){!e&&(e={});super(ki,e,r);i(this,"MODULE",p.SPRITE)}}const Wi=function(t,e){be(t,e)};class Vi extends Ut{constructor(e,r){!e&&(e={});super(Wi,e,r);i(this,"MODULE",p.LINE)}}const Yi=function(t,e){be(t,e)};class Qi extends Ut{constructor(e,r){!e&&(e={});super(Yi,e,r);i(this,"MODULE",p.MESH)}}const Xi=function(t,e){be(t,e)};class Ki extends Ut{constructor(e,r){!e&&(e={});super(Xi,e,r);i(this,"MODULE",p.POINTS)}}const Zi=function(t,e){be(t,e)};class Ji extends tt{constructor(e,r){!e&&(e={});super(Zi,e,r);i(this,"MODULE",p.GROUP)}}const qi=function(t,e){Me(t,e)};class ea extends pe{constructor(e,r){!e&&(e={});super(qi,e,r);i(this,"MODULE",p.PASS)}}const ta=function(t,e){t.key==="name"&&t.path.length===1||Me(t,e)};class ra extends pe{constructor(e,r){!e&&(e={});super(ta,e,r);i(this,"MODULE",p.ANIMATION)}}const sa=function(t,e){be(t,e)};class na extends tt{constructor(e,r){!e&&(e={});super(sa,e,r);i(this,"MODULE",p.CSS3D)}}const oa=function(t,e){be(t,e)};class ia extends tt{constructor(e,r){!e&&(e={});super(oa,e,r);i(this,"MODULE",p.OBJECT3D)}}class aa{constructor(e){i(this,"object3DDataSupport",new ia),i(this,"cameraDataSupport",new Ni),i(this,"lightDataSupport",new Pi),i(this,"geometryDataSupport",new ji),i(this,"textureDataSupport",new Oi),i(this,"materialDataSupport",new Li),i(this,"rendererDataSupport",new Hi),i(this,"sceneDataSupport",new zi),i(this,"controlsDataSupport",new _i),i(this,"spriteDataSupport",new $i),i(this,"lineDataSupport",new Vi),i(this,"meshDataSupport",new Qi),i(this,"pointsDataSupport",new Ki),i(this,"groupDataSupport",new Ji),i(this,"css3DDataSupport",new na),i(this,"passDataSupport",new ea),i(this,"animationDataSupport",new ra),i(this,"dataSupportMap"),e&&Object.keys(e).forEach(s=>{this[s]!==void 0&&(this[s]=e[s])});const r=new Map;Object.keys(this).forEach(s=>{const n=this[s];n instanceof pe&&r.set(n.MODULE,n)}),this.dataSupportMap=r}getDataSupport(e){return this.dataSupportMap.has(e)?this.dataSupportMap.get(e):(console.warn(`can not found this type in dataSupportManager: ${e}`),null)}getSupportData(e){return this.dataSupportMap.has(e)?this.dataSupportMap.get(e).getData():(console.warn(`can not found this type in dataSupportManager: ${e}`),null)}setSupportData(e,r){return this.dataSupportMap.has(e)?this.dataSupportMap.get(e).setData(r):console.warn(`can not found this type in dataSupportManager: ${e}`),this}getConfigBySymbol(e){const r=this.dataSupportMap.values();for(const s of r){const n=s.getConfig(e);if(n)return n}return null}removeConfigBySymbol(...e){const r=this.dataSupportMap.values();for(const s of e)for(const n of r)if(n.existSymbol(s)){n.removeConfig(s);break}return this}getModuleBySymbol(e){const r=this.dataSupportMap.values();for(const s of r)if(s.existSymbol(e))return s.MODULE;return null}applyConfig(...e){for(const r of e){const s=It(r.type);s?this.dataSupportMap.get(s).addConfig(r):console.warn(`dataSupportManager can not found this config module: ${r.type}`)}return this}reactiveConfig(e){const r=It(e.type);return r?this.dataSupportMap.get(r).addConfig(e).getConfig(e.vid):(console.warn(`dataSupportManager can not found this config module: ${e.type}`),e)}load(e){return this.dataSupportMap.forEach((s,n)=>{e[n]&&s.load(e[n])}),this}remove(e){return this.dataSupportMap.forEach((s,n)=>{e[n]&&s.remove(e[n])}),this}toJSON(e={},r=!0){return JSON.stringify(this.exportConfig(e,r),et)}exportConfig(e={},r=!0){return this.dataSupportMap.forEach((n,o)=>{e[o]=n.exportConfig(r)}),e}}const ca={name:"uvPulseShader",uniforms:{time:{value:0},width:{value:.5},color:{value:{r:1,g:0,b:0}},center:{value:{x:.5,y:.5}}},vertexShader:`
    varying vec2 vUv;

    void main () {

      vUv = uv;

      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }`,fragmentShader:`
    uniform float width;
    uniform float time;
    uniform vec3 color;
    uniform vec2 center;

    varying vec2 vUv;

    void main () {
      // \u6839\u636EuTime\u6C42\u51FA\u767E\u5206\u6BD4
      float deg = mod(degrees(time), 360.0);
      if (deg > 0.0 && deg < 180.0) {
        discard;
      }

      float percent = cos(time);
      float distancePercent = distance(center, vUv);

      // \u4ECE\u5916\u5411\u91CC
      if (distancePercent > 0.5) {
        discard;
      }

      if (distancePercent < percent) {
        discard;
      }

      if (distancePercent - percent > width) {
        discard;
      }

      float opacity =  (width - (distancePercent - percent)) / width;

      // float opacity = distancePercent;
      gl_FragColor = vec4(color, opacity);
    }`},la={name:"fragCoordTestingShader",uniforms:{resolution:{value:{x:1920,y:1080}}},vertexShader:`
  void main () {
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }`,fragmentShader:`
    uniform vec2 resolution;

    void main () {
      vec2 st = gl_FragCoord.xy / resolution;
      gl_FragColor = vec4(st.x,st.y,0.0,1.0);
    }`},ha={name:"colorMixShader",uniforms:{colorA:{value:{r:1,g:0,b:0}},colorB:{value:{r:0,g:1,b:0}},percent:{value:.5}},vertexShader:`
  void main () {
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }`,fragmentShader:`
    uniform vec3 colorA;
    uniform vec3 colorB;
    uniform float percent;

    void main () {
      gl_FragColor = vec4(mix(colorA, colorB, percent), 1.0);
    }`},ua={name:"BloomShader",uniforms:{brightness:{value:.5},extend:{value:5},range:{value:10},specular:{value:.8},specularRange:{value:2},color:{value:{r:1,g:1,b:1}}},vertexShader:`
  uniform float extend;

  varying vec2 vUv;

  void main () {

    vUv = uv;

    vec3 extendPosition = position + normalize(position) * extend;

    gl_Position = projectionMatrix * modelViewMatrix * vec4(extendPosition , 1.0 );
  }`,fragmentShader:`
    uniform vec3 color;
    uniform float brightness;
    uniform float specular;
    uniform float range;
    uniform float specularRange;

    varying vec2 vUv;
    
    void main () {

      gl_FragColor = vec4(color, brightness);
    }`},Le=class{static getShader(t){return Le.library.has(t)?Le.cloneShader(Le.library.get(t)):(console.warn(`con not found shader in shader library: ${t}`),null)}static generateConfig(t){if(!Le.library.has(t))return console.warn(`con not found shader in shader library: ${t}`),{};const e=Le.library.get(t),r={shader:t,uniforms:{}};return e.uniforms&&(r.uniforms=JSON.parse(JSON.stringify(e.uniforms))),r}static cloneShader(t){const e={name:t.name};return t.vertexShader&&(e.vertexShader=t.vertexShader),t.fragmentShader&&(e.fragmentShader=t.fragmentShader),t.uniforms&&(e.uniforms=JSON.parse(JSON.stringify(t.uniforms))),e}};let me=Le;i(me,"library",new Map);i(me,"reigster",function(t){Le.library.has(t.name)&&console.warn(`shader library has exist shader: ${t.name} that will be cover.`),Le.library.set(t.name,t)});const da={name:"defaultShader"};me.reigster(da);me.reigster(ca);me.reigster(la);me.reigster(ha);me.reigster(ua);const se=function(t,e,r=!0,s=!0){if(!$[t])return console.error(`type: ${t} can not be found in configList.`),{vid:"",type:t};const n=(a,c)=>{for(const u in c){if(a[u]===void 0){!r&&(a[u]=c[u]),r&&s&&console.warn(`'${t}' config can not set key: ${u}`);continue}typeof c[u]=="object"&&c[u]!==null&&!Array.isArray(c[u])?(a[u]===null&&(a[u]=_({},c[u])),n(a[u],c[u])):a[u]=c[u]}},o=$[t]();if([l.SHADERMATERIAL].includes(t)){const a=me.generateConfig((e==null?void 0:e.shader)||"defaultShader"),c=r;r=!1,n(o,a),r=c}if([l.SCRIPTANIMATION,l.KEYFRAMEANIMATION].includes(t)&&(r=!1),o.vid===""&&(o.vid=ft()),e&&n(o,e),se.autoInject&&se.injectEngine){const a=se.injectEngine,c=a.reactiveConfig(o);if(se.injectScene&&It(o.type)in dr&&o.type!==l.SCENE){let u=null;typeof se.injectScene=="boolean"?u=a.getObjectConfig(a.scene):typeof se.injectScene=="string"&&(u=a.getConfigBySymbol(se.injectScene)),u?u.children.push(o.vid):console.warn("current engine scene can not found it config",a,a.scene)}return c}return o};se.autoInject=!0;se.injectScene=!1;se.injectEngine=null;const pa=function(t){if(this.dataSupportManager)return console.warn("engine has installed dataSupportManager plugin."),!1;const e=new aa(t);return this.dataSupportManager=e,this.applyConfig=function(...r){return this.dataSupportManager.applyConfig(...r),this},this.reactiveConfig=function(r){return this.dataSupportManager.reactiveConfig(r)},this.getConfigBySymbol=function(r){return this.dataSupportManager.getConfigBySymbol(r)},this.removeConfigBySymbol=function(...r){return this.dataSupportManager.removeConfigBySymbol(...r),this},this.toJSON=function(){if(this.loaderManager){const r={assets:JSON.parse(this.loaderManager.toJSON())};return this.dataSupportManager.toJSON(r)}return this.dataSupportManager.toJSON()},this.exportConfig=function(){let r={};return this.loaderManager&&(r={assets:this.loaderManager.exportConfig()}),this.dataSupportManager.exportConfig(r)},this.completeSet.add(()=>{const r=this.dataSupportManager.getDataSupport(p.RENDERER).getData();r.WebGLRenderer||(r.WebGLRenderer=se(l.WEBGLRENDERER));const s=this.dataSupportManager.getDataSupport(p.CONTROLS).getData();this.transformControls&&(s[l.TRNASFORMCONTROLS]||(s[l.TRNASFORMCONTROLS]=se(l.TRNASFORMCONTROLS))),this.orbitControls&&(s[l.ORBITCONTROLS]||(s[l.ORBITCONTROLS]=se(l.ORBITCONTROLS)))}),!0},fe=class{constructor(){i(this,"target",{}),i(this,"map",new Map),i(this,"weakMap",new WeakMap),i(this,"engine"),i(this,"cacheCompile")}getMap(){return this.map}useEngine(t){return this.engine=t,this}setTarget(t){return this.target=t,this}add(t){if(!fe.processors.has(t.type))return console.warn(`${this.MODULE} compiler can not support this type: ${t.type}`),null;const r=fe.processors.get(t.type).create(t,this.engine);return this.map.set(t.vid,r),this.weakMap.set(r,t.vid),r}remove(t){const e=t.vid;if(!this.map.has(e))return console.warn(`${this.MODULE} compiler can not found this vid object: ${e}.`),this;if(!fe.processors.has(t.type))return console.warn(`${this.MODULE} compiler can not support this type: ${t.type}`),this;const r=this.map.get(e);return fe.processors.get(t.type).dispose(r),this.map.delete(e),this.weakMap.delete(r),this}cover(t){const e=t.vid;return this.map.has(e)?(Promise.resolve().then(()=>{K(t,t,{vid:!0,type:!0})}),this):(console.warn(`${this.MODULE} compiler can not found this vid object: ${e}.`),this)}compile(t,e){const r=this.cacheCompile;let s,n,o;if(r&&r.vid===t)s=r.target,n=r.config,o=r.processor;else{if(!this.map.has(t))return console.warn(`${this.MODULE} compiler set function: can not found object which vid is: '${t}'`),this;if(!this.target[t])return console.warn(`${this.MODULE} compiler set function: can not found config which vid is: '${t}'`),this;if(s=this.map.get(t),n=this.target[t],!fe.processors.has(n.type))return console.warn(`PassCompiler can not support this type: ${n.type}`),this;o=fe.processors.get(n.type),this.cacheCompile={target:s,config:n,processor:o,vid:t}}return o.process(_({config:n,target:s,engine:this.engine,processor:o,compiler:this},e)),this}compileAll(){const t=this.target;for(const e of Object.values(t))this.add(e);return this}dispose(){this.cacheCompile&&(this.cacheCompile=void 0);for(const t of Object.values(this.target)){if(!this.map.has(t.vid)){console.warn(`${this.MODULE} compiler set function: can not found object which vid is: '${t.vid}'`);continue}const e=this.map.get(t.vid);if(!fe.processors.has(t.type)){console.warn(`${this.MODULE}  can not support this type: ${t.type}`);continue}fe.processors.get(t.type).dispose(e)}return this.map.clear(),this.target={},this}getObjectSymbol(t){return this.weakMap.get(t)||null}getObjectBySymbol(t){return this.map.get(t)||null}};let M=fe;i(M,"processors",new Map);i(M,"processor",function(t){fe.processors.set(t.configType,t)});const $e="vis.scriptAni";class ma{constructor(e){i(this,"configType"),i(this,"commands"),i(this,"create"),i(this,"dispose"),this.configType=e.configType,this.commands=e.commands,this.create=e.create,this.dispose=e.dispose}process(e){if(!this.commands||!this.commands[e.operate]){this[e.operate](e);return}let r=this.commands[e.operate];for(const s of[].concat(e.path,e.key))if(!r[s]&&!r.$reg){this[e.operate](e);return}else if(r[s])if(typeof r[s]=="function"){r[s](e);return}else r=r[s];else if(r.$reg){for(const n of r.$reg)if(n.reg.test(s)){n.handler(e);return}}this[e.operate](e)}add(e){let r=e.target;const s=e.path;for(const n of s)if(typeof r[n]!==void 0)r=r[n];else{console.warn("processor can not exec default add operate.",e);return}r[e.key]=e.value}set(e){let r=e.target;const s=e.path;for(const n of s)if(typeof r[n]!==void 0)r=r[n];else{console.warn("processor can not exec default set operate.",e);return}r[e.key]=e.value}delete(e){let r=e.target;const s=e.path;for(const n of s)if(typeof r[n]!==void 0)r=r[n];else{console.warn("processor can not exec default delete operate.",e);return}delete r[e.key]}}const C=t=>new ma(t),zt=function(){},fa={name:"linearTime",multiply:1},ga=function(t,e,r,s){return e[r]===void 0?(console.warn(`object not exist attribute: ${r}`,e),n=>{}):typeof e[r]!="number"?(console.warn("object attribute is not typeof number.",e,r),n=>{}):n=>{e[r]+=n.delta*s.multiply}},Ea={name:"sinWave",wavelength:1,offset:0,amplitude:1,speed:1},ya=function(t,e,r,s){if(e[r]===void 0)return console.warn(`object not exist attribute: ${r}`,e),o=>{};if(typeof e[r]!="number")return console.warn("object attribute is not typeof number.",e,r),o=>{};const n=e[r];return o=>{e[r]=n+s.amplitude*Math.sin(o.total*s.speed/s.wavelength)+s.offset}},ve=class{static generateConfig(t,e){if(!ve.configLibrary.has(t))return console.warn(`event library can not found config by name: ${t}`),{name:""};const r=(n,o)=>{for(const a in o)n[a]!==void 0&&(typeof o[a]=="object"&&o[a]!==null&&!Array.isArray(o[a])?r(n[a],o[a]):n[a]=o[a])},s=JSON.parse(JSON.stringify(ve.configLibrary.get(t)));return r(s,e),s}static generateScript(t,e,r,s){return ve.generatorLibrary.has(s.name)?ve.generatorLibrary.get(s.name)(t,e,r,s):(console.error(`event library can not found generator by name: ${s.name}`),()=>{})}static has(t){return ve.configLibrary.has(t)}};let rt=ve;i(rt,"configLibrary",new Map);i(rt,"generatorLibrary",new Map);i(rt,"register",function(t,e){ve.configLibrary.has(t.name)&&console.warn(`EventLibrary has already exist this event generator: ${t.name}, that will be cover.`),ve.configLibrary.set(t.name,JSON.parse(JSON.stringify(t))),ve.generatorLibrary.set(t.name,e)});rt.register(fa,ga);rt.register(Ea,ya);const Es=function(t,e){let r=e.compilerManager.getObjectBySymbol(t.target);if(!r)return console.warn(`can not found object in enigne: ${t.target}`),()=>{};const s=t.attribute.split(".");s.shift();const n=s.pop();for(const o of s){if(r[o]===void 0)return console.warn(`animaton processor: target object can not found key: ${o}`,r),()=>{};r=r[o]}return rt.generateScript(e,r,n,t.script)};var Sa=C({configType:l.SCRIPTANIMATION,commands:{set:{play({target:t,engine:e,value:r}){r?e.renderManager.addEventListener("render",t):e.renderManager.removeEventListener("render",t)},$reg:[{reg:new RegExp(".*"),handler({config:t,engine:e}){const r=t[Symbol.for($e)];e.renderManager.removeEventListener("render",r);const s=Es(t,e);t[Symbol.for($e)]=s,t.play&&e.renderManager.addEventListener("render",r)}}]}},create(t,e){const r=Es(t,e);return t.play&&e.renderManager.addEventListener("render",r),t[Symbol.for($e)]=r,r},dispose(){}});class Ma extends M{constructor(){super();i(this,"MODULE",p.ANIMATION)}restoreAttribute(e){if(!e.target||!e.attribute)return this;let r=this.engine.getObjectBySymbol(e.target),s=this.engine.getConfigBySymbol(e.target);(!r||!s)&&console.warn("AnimationCompiler: can not found object target or config in engine",e.vid);const n=e.attribute.split(".");n.shift();const o=n.pop();for(const a of n)if(r[a]&&s[a])r=r[a],s=s[a];else return console.warn("AnimationCompiler: object and config attribute are not sync"),this;return r[o]=s[o],this}cover(e){super.cover(e);const r=this.map.get(e.vid);return e[Symbol.for($e)]=r,this}remove(e){return this.engine.removeEventListener("render",e[Symbol.for($e)]),this.restoreAttribute(e),delete e[Symbol.for($e)],super.remove(e),this}compile(e,r){const s=this.target[e];this.restoreAttribute(s),super.compile(e,r);const n=this.map.get(e),o=s[Symbol.for($e)];return this.map.set(s.vid,o),this.weakMap.delete(n),this.weakMap.set(o,e),this}}M.processor(Sa);class De extends M{constructor(){super()}}const ba={name:"openWindow",params:{url:""}},va=function(t,e){return()=>{window.open(e.params.url)}},Ra={name:"visibleObject",params:{target:"",visible:!0,delay:0}},wa=function(t,e){const r=e.params,s=t.getObjectBySymbol(r.target);return s?()=>{setTimeout(()=>{s.visible=r.visible},r.delay)}:(console.warn(`basic event visibleObject: can not found vid object: ${r.target}`),()=>{})},Ta={name:"addClass",params:{target:"",className:"",delay:0}},Ca=function(t,e){const r=e.params,s=[];if(r.target==="all")t.scene.traverse(n=>{n instanceof mt&&s.push(n)});else if(Array.isArray(r.target))r.target.forEach(n=>{const o=t.getObjectBySymbol(n);o?s.push(o):console.warn(`basic event AddClass: can not found vid object: ${r.target}`)});else{const n=t.getObjectBySymbol(r.target);if(!n)return console.warn(`basic event AddClass: can not found vid object: ${r.target}`),()=>{};if(!(n instanceof mt))return console.warn("basic event AddClass: object is not a CSS3DObject."),()=>{};s.push(n)}return s.length?()=>{setTimeout(()=>{s.forEach(n=>{n.element.classList.add(r.className)})},r.delay)}:(console.warn(`basic event AddClass: can not found vid object: ${r.target}`),()=>{})},xa={name:"changeScene",params:{scene:"Scene",delay:0}},Oa=function(t,e){const r=e.params;return()=>{setTimeout(()=>{t.setScene(r.scene)},r.delay)}},Aa={name:"changeCamera",params:{camera:"",delay:0}},La=function(t,e){const r=e.params;return()=>{setTimeout(()=>{t.setCamera(r.camera)},r.delay)}},Da={name:"switchAnimate",params:{target:"",toggle:"auto",delay:0}},Pa=function(t,e){const r=e.params,s=t.getConfigBySymbol(r.target);return s?()=>{setTimeout(()=>{if(r.toggle==="auto"){s.play!=s.play;return}if(r.toggle==="off"){s.play=!1;return}if(r.toggle==="on"){s.play=!0;return}},r.delay)}:(console.warn(`basic event switchAnimate: can not found vid config: ${r.target}`),()=>{})};var Z;(function(t){t.ELN="ELN",t.EQI="EQI",t.EQO="EQO",t.EASING_LINEAR_NONE="EASING_LINEAR_NONE",t.EASING_QUARTIC_IN="EASING_QUARTIC_IN",t.EASING_QUARTIC_OUT="EASING_QUARTIC_OUT",t.EASING_QUARTIC_INOUT="EASING_QUARTIC_INOUT",t.EASING_QUADRATIC_IN="EASING_QUADRATIC_IN",t.EASING_QUADRATIC_OUT="EASING_QUADRATIC_OUT",t.EASING_QUADRATIC_INOUT="EASING_QUADRATIC_INOUT"})(Z||(Z={}));const U={ELN:ue.Linear.None,EQI:ue.Quartic.In,EQO:ue.Quartic.Out,EASING_LINEAR_NONE:ue.Linear.None,EASING_QUARTIC_IN:ue.Quartic.In,EASING_QUARTIC_OUT:ue.Quartic.Out,EASING_QUARTIC_INOUT:ue.Quartic.InOut,EASING_QUADRATIC_IN:ue.Quadratic.In,EASING_QUADRATIC_OUT:ue.Quadratic.Out,EASING_QUADRATIC_INOUT:ue.Quadratic.InOut},Ia={name:"moveTo",params:{target:"",position:{x:0,y:0,z:0},delay:0,duration:1e3,timingFunction:Z.EASING_QUADRATIC_INOUT}},ja=function(t,e){const r=e.params,n=t.compilerManager.getObjectBySymbol(r.target);if(!n)return console.warn(`real time animation moveTO: can not found vid object: ${r.target}`),()=>{};const o=t.renderManager,a=t.dataSupportManager.getConfigBySymbol(r.target);if(!a)return console.warn(`can not found object config: ${r.target}`),()=>{};let c=!1;return()=>{if(c)return;c=!0;const u=new H(n.position).to(r.position).duration(r.duration).delay(r.delay).easing(U[r.timingFunction]).start(),h=m=>{u.update()};o.addEventListener("render",h),u.onComplete(()=>{o.removeEventListener("render",h),a.position.x=r.position.x,a.position.y=r.position.y,a.position.z=r.position.z,c=!1})}},Ga={name:"rotationTo",params:{target:"",rotation:{x:0,y:0,z:0},delay:0,duration:1e3,timingFunction:Z.EASING_QUADRATIC_INOUT}},Na=function(t,e){const r=e.params,n=t.compilerManager.getObjectBySymbol(r.target);if(!n)return console.warn(`real time animation moveTO: can not found vid object: ${r.target}`),()=>{};const o=t.renderManager,a=t.dataSupportManager.getConfigBySymbol(r.target);if(!a)return console.warn(`can not found object config: ${r.target}`),()=>{};let c=!1;return()=>{if(c)return;c=!0;const u=new H(n.rotation).to(r.rotation).duration(r.duration).delay(r.delay).easing(U[r.timingFunction]).start(),h=m=>{u.update()};o.addEventListener("render",h),u.onComplete(()=>{o.removeEventListener("render",h),a.rotation.x=r.rotation.x,a.rotation.y=r.rotation.y,a.rotation.z=r.rotation.z,c=!1})}},Ba={name:"upTo",params:{target:"",up:{x:0,y:1,z:0},delay:0,duration:1e3,timingFunction:Z.EASING_QUADRATIC_INOUT}},Ha=function(t,e){const r=e.params,n=t.compilerManager.getObjectBySymbol(r.target);if(!n)return console.warn(`real time animation upTo: can not found vid object: ${r.target}`),()=>{};const o=t.renderManager,a=t.dataSupportManager.getConfigBySymbol(r.target);if(!a)return console.warn(`can not found object config: ${r.target}`),()=>{};let c=!1;return()=>{if(c)return;c=!0;const u=new H(n.up).to(r.up).duration(r.duration).delay(r.delay).easing(U[r.timingFunction]).start(),h=m=>{u.update()};o.addEventListener("render",h),u.onComplete(()=>{o.removeEventListener("render",h),a.up.x=r.up.x,a.up.y=r.up.y,a.up.z=r.up.z,c=!1})}},Ua={name:"moveFromTo",params:{target:"",from:{x:0,y:0,z:0},to:{x:10,y:10,z:10},delay:0,duration:1e3,timingFunction:Z.EASING_QUADRATIC_INOUT}},za=function(t,e){const r=e.params,n=t.compilerManager.getObjectBySymbol(r.target);if(!n)return console.warn(`real time animation moveTO: can not found vid object: ${r.target}`),()=>{};const o=t.renderManager,a=t.dataSupportManager.getConfigBySymbol(r.target);if(!a)return console.warn(`can not found object config: ${r.target}`),()=>{};let c=!1;return()=>{if(c)return;c=!0,n.position.set(r.from.x,r.from.y,r.from.z),n.updateMatrix(),n.updateMatrixWorld();const u=new H(n.position).to(r.to).duration(r.duration).delay(r.delay).easing(U[r.timingFunction]).start(),h=m=>{u.update()};o.addEventListener("render",h),u.onComplete(()=>{o.removeEventListener("render",h),a.position.x=r.to.x,a.position.y=r.to.y,a.position.z=r.to.z,c=!1})}},Fa={name:"moveSpacing",params:{target:"",spacing:{x:10,y:10,z:10},delay:0,duration:1e3,timingFunction:Z.EASING_QUADRATIC_INOUT}},_a=function(t,e){const r=e.params,s=t.getObjectBySymbol(r.target);if(!s)return console.warn(`can not found vid object: ${r.target}`),()=>{};if(!(s instanceof Be))return console.warn(`object is not instanceof Object3D: ${r.target}`),()=>{};const n=t.renderManager,o=t.getConfigBySymbol(r.target);let a=!1;return()=>{if(a)return;a=!0;const c={x:s.position.x+r.spacing.x,y:s.position.y+r.spacing.y,z:s.position.z+r.spacing.z},u=new H(s.position).to(c).duration(r.duration).delay(r.delay).easing(U[r.timingFunction]).start(),h=m=>{u.update()};n.addEventListener("render",h),u.onComplete(()=>{n.removeEventListener("render",h),o.position.x=c.x,o.position.y=c.y,o.position.z=c.z,a=!1})}},ka={name:"moveToObject",params:{target:"",to:"",offset:{x:0,y:0,z:0},delay:0,duration:1e3,timingFunction:Z.EASING_QUADRATIC_INOUT}},$a=function(t,e){const r=e.params,s=t.compilerManager,n=s.getObjectBySymbol(r.target),o=s.getObjectBySymbol(r.to);if(!n)return console.warn(`real time animation MoveToObject: can not found vid object: ${r.target}`),()=>{};if(!o)return console.warn(`real time animation MoveToObject: can not found vid object: ${r.target}`),()=>{};const a=t.renderManager,c=t.dataSupportManager.getConfigBySymbol(r.target);if(!c)return console.warn(`can not found object config: ${r.target}`),()=>{};let u=!1;return()=>{if(u)return;u=!0;const h={x:o.position.x+r.offset.x,y:o.position.y+r.offset.y,z:o.position.z+r.offset.z},m=new H(n.position).to(h).duration(r.duration).delay(r.delay).easing(U[r.timingFunction]).start(),f=y=>{m.update()};a.addEventListener("render",f),m.onComplete(()=>{a.removeEventListener("render",f),c.position.x=h.x,c.position.y=h.y,c.position.z=h.z,u=!1})}},Wa={name:"vector3To",params:{target:"",attribute:".position",props:{x:"x",y:"y",z:"z"},delay:0,duration:500,to:{},timingFunction:Z.EASING_QUADRATIC_INOUT}},Va=function(t,e){var r,s,n;const o=e.params,a=t.compilerManager.getObjectBySymbol(o.target);if(!a)return console.warn(`real time animation vector3To: can not found vid object: ${o.target}`),()=>{};const c=t.renderManager;let u=t.dataSupportManager.getConfigBySymbol(o.target);if(!u)return console.warn(`real time animation vector3To: can not found object config: ${o.target}`),()=>{};const h=o.attribute.split(".");h.shift();let m=a;for(const v of h){if(m[v]===void 0)return console.error(`real time animation vector3To: object can not support key: ${v}`,a),()=>{};m=m[v],u=u[v]}const f=o.props;if(!(f.x in m)||!(f.y in m)||!(f.z in m))return console.error("real time animation vector3To: object can not support props:",m,f),()=>{};if(!(f.x in u)||!(f.y in u)||!(f.z in u))return console.error("real time animation vector3To: config can not support props:",u,f),()=>{};const y={x:(r=o.to.x)!=null?r:m[f.x],y:(s=o.to.y)!=null?s:m[f.y],z:(n=o.to.z)!=null?n:m[f.z]};let w=!1;return()=>{if(w)return;w=!0;const v=new H(m).to(y).duration(o.duration).delay(o.delay).easing(U[o.timingFunction]).start(),x=R=>{v.update()};c.addEventListener("render",x),v.onComplete(()=>{c.removeEventListener("render",x),u[f.x]=y.x,u[f.y]=y.y,u[f.z]=y.z,w=!1})}},Ya={name:"focusObject",params:{target:"",camera:"",space:"world",offset:{x:0,y:0,z:20},delay:0,duration:1e3,timingFunction:Z.EASING_QUADRATIC_INOUT,back:!0}},Qa=function(t,e){const r=e.params,s=t.getObjectBySymbol(r.target),n=t.orbitControls.target;if(!s)return console.warn(`real time animation focusObject: can not found vid object: ${r.target}`),()=>{};if(!(s instanceof Be))return console.warn(`real time animation focusObject: vid object is not a class of THREE.Object3D: ${r.target}`),()=>{};let o=!1;const a=new ir;return()=>{if(o)return;o=!0;let c=t.camera;r.camera&&(c=t.getObjectBySymbol(r.camera),c||(c=t.camera,console.warn(`real time animation focusObject: can not found camera config: ${r.camera}`)));const u=t.getObjectConfig(c),h=t.orbitControls&&t.orbitControls.object===c;u||console.warn("engine current camera can not found config.");const m=t.renderManager;let f={x:s.matrixWorld.elements[12]+r.offset.x,y:s.matrixWorld.elements[13]+r.offset.y,z:s.matrixWorld.elements[14]+r.offset.z};const y={x:c.position.x,y:c.position.y,z:c.position.z};if(r.space==="local"){const P=new O(r.offset.x,r.offset.y,r.offset.z).applyEuler(a.setFromRotationMatrix(s.matrixWorld));f={x:s.matrixWorld.elements[12]+P.x,y:s.matrixWorld.elements[13]+P.y,z:s.matrixWorld.elements[14]+P.z}}const w=new H(c.position).to(f).duration(r.duration).delay(r.delay).easing(U[r.timingFunction]).start();let v;const x={x:c.up.x,y:c.up.y,z:c.up.z};if(r.space==="local"){const P=new O(0,1,0).applyEuler(a.setFromRotationMatrix(s.matrixWorld));v=new H(c.up).to({x:P.x,y:P.y,z:P.z}).duration(r.duration).delay(r.delay).easing(U[r.timingFunction]).start()}let R;const S={x:n.x,y:n.y,z:n.z};h&&(R=new H(n).to({x:s.matrixWorld.elements[12],y:s.matrixWorld.elements[13],z:s.matrixWorld.elements[14]}).duration(r.duration).delay(r.delay).easing(U[r.timingFunction]).start());let L;h&&r.space==="local"?L=P=>{w.update(),v.update(),R.update()}:h?L=P=>{w.update(),R.update()}:r.space==="local"?L=P=>{w.update(),v.update()}:L=P=>{w.update()},m.addEventListener("render",L),w.onComplete(()=>{if(m.removeEventListener("render",L),u&&(u.position.x=f.x,u.position.y=f.y,u.position.z=f.z),o=!1,r.back){const P=()=>{const T=new H(c.position).to(y).duration(r.duration).delay(r.delay).easing(U[r.timingFunction]).start();let k;r.space==="local"&&(k=new H(c.up).to(x).duration(r.duration).delay(r.delay).easing(U[r.timingFunction]).start());let g;h&&(g=new H(n).to(S).duration(r.duration).delay(r.delay).easing(U[r.timingFunction]).start());const V=D=>{T.update(),k&&k.update(),g&&g.update()};T.onComplete(()=>{m.removeEventListener("render",V)}),m.addEventListener("render",V),document.removeEventListener("dblclick",P)};document.addEventListener("dblclick",P)}})}},Xa={name:"fadeObject",params:{target:"",direction:"out",delay:0,duration:300,timingFunction:Z.EASING_QUADRATIC_INOUT,visible:!0}},Ka=function(t,e){const r=e.params,s=t.getObjectBySymbol(r.target);if(!s)return console.warn(`real time animation fadeObject: can not found vid object: ${r.target}`),()=>{};const n=t.getObjectConfig(s);if(!n.material)return console.warn(`real time animation fadeObject: target can not support fade: ${r.target}`),()=>{};const o=[],a=[],c=Array.isArray(n.material)?[].concat(n.material):[n.material];for(const h of c){const m=t.getObjectBySymbol(h),f=t.getConfigBySymbol(h);if(!(m instanceof ns)){console.error(`real time animation fadeObject: object config material is not instanceof Material: ${h}`);continue}if(!f){console.error(`real time animation fadeObject: object config material can not found config: ${h}`);continue}o.push(m),a.push(f)}let u=!1;return()=>{if(u)return;u=!0;const h=t.renderManager;n.visible=!0,o.forEach((m,f,y)=>{m.visible=!0,m.transparent=!0,m.opacity=r.direction==="in"?0:1,m.needsUpdate=!0;const w=new H(m).to({opacity:r.direction==="in"?1:0}).duration(r.duration).delay(r.delay).easing(U[r.timingFunction]).start(),v=x=>{w.update()};h.addEventListener("render",v),w.onComplete(()=>{h.removeEventListener("render",v),r.direction==="out"&&r.visible?(a[f].visible=!1,n.visible=!1):r.direction==="in"&&r.visible&&(a[f].visible=!0,n.visible=!0),a[f].opacity=r.direction==="in"?1:0,u=!1})})}},Za={name:"showToCamera",params:{target:"",offset:{x:0,y:0,z:-30},delay:0,duration:1e3,timingFunction:Z.EASING_QUADRATIC_INOUT,back:!0}},Ja=function(t,e){const r=e.params,s=t.getObjectBySymbol(r.target),n=t.getConfigBySymbol(r.target),o=t.camera;if(!s)return console.warn(`real time animation showToCamera: can not found vid object: ${r.target}`),()=>{};if(!s)return console.warn(`real time animation showToCamera: can not found vid config: ${r.target}`),()=>{};if(!(s instanceof Be))return console.warn(`real time animation showToCamera: vid object is not a class of THREE.Object3D: ${r.target}`),()=>{};const a=new wt,c=new ir,u=new O;let h=!1;return()=>{if(h)return;h=!0;const m=t.renderManager;u.set(r.offset.x,r.offset.y,r.offset.z).applyEuler(o.rotation),u.set(o.position.x+u.x,o.position.y+u.y,o.position.z+u.z),a.lookAt(o.position,u,o.up),c.setFromRotationMatrix(a);const f={x:s.position.x,y:s.position.y,z:s.position.z},y={x:s.rotation.x,y:s.rotation.y,z:s.rotation.z},w=new H(s.position).to({x:u.x,y:u.y,z:u.z}).duration(r.duration).delay(r.delay).easing(U[r.timingFunction]).start(),v=new H(s.rotation).to({x:c.x,y:c.y,z:c.z}).duration(r.duration).delay(r.delay).easing(U[r.timingFunction]).start(),x=R=>{w.update(),v.update()};m.addEventListener("render",x),w.onComplete(()=>{if(m.removeEventListener("render",x),n.position.x=u.x,n.position.y=u.y,n.position.z=u.z,n.rotation.x=c.x,n.rotation.y=c.y,n.rotation.z=c.z,h=!1,r.back){const R=()=>{const S=new H(s.position).to(f).duration(r.duration).delay(r.delay).easing(U[r.timingFunction]).start(),L=new H(s.rotation).to(y).duration(r.duration).delay(r.delay).easing(U[r.timingFunction]).start(),P=T=>{S.update(),L.update()};S.onComplete(()=>{m.removeEventListener("render",P),n.position.x=f.x,n.position.y=f.y,n.position.z=f.z,n.rotation.x=y.x,n.rotation.y=y.y,n.rotation.z=y.z}),m.addEventListener("render",P),document.removeEventListener("dblclick",R)};document.addEventListener("dblclick",R)}})}},qa={name:"colorChange",params:{target:"",attribute:"color",color:"rgb(255, 255, 255)",delay:0,duration:500,timingFunction:Z.EASING_QUADRATIC_INOUT}},ec=function(t,e){const r=e.params,s=t.getObjectBySymbol(r.target);if(!s)return console.warn(`real time animation ColorChange: can not found vid material: ${r.target}`),()=>{};if(!s[r.attribute]||!(s[r.attribute]instanceof F))return console.warn(`real time animation ColorChange: material attribute is illeage: ${r.attribute}`),()=>{};const n=t.getConfigBySymbol(r.target);if(!n)return console.warn(`real time animation ColorChange: can not found material config: ${r.target}`),()=>{};const o=new F(r.color),a=t.renderManager;let c=!1;return()=>{if(c)return;c=!0;const u=new H(s[r.attribute]).to({r:o.r,g:o.g,b:o.b}).duration(r.duration).delay(r.delay).easing(U[r.timingFunction]).start(),h=m=>{u.update()};a.addEventListener("render",h),u.onComplete(()=>{a.removeEventListener("render",h),n[r.attribute]=r.color,c=!1})}},tc={name:"orbitTargetMove",params:{target:"",offset:{x:0,y:0,z:0},delay:0,duration:1e3,timingFunction:Z.EASING_QUADRATIC_INOUT}},rc=function(t,e){const r=e.params;if(t.compilerManager,!t.orbitControls)return console.warn("real time animation orbitTargetMove: engine can not install orbitControls."),()=>{};const s=t.renderManager;let n=!1;return()=>{if(n)return;n=!0;let o=r.offset;if(r.target){const u=t.getObjectBySymbol(r.target);u?o={x:u.matrixWorld.elements[12]+o.x,y:u.matrixWorld.elements[13]+o.y,z:u.matrixWorld.elements[14]+o.z}:console.warn(`real time animation orbitTargetMove: can not found vid object: ${r.target}`)}const a=new H(t.orbitControls.target).to(o).duration(r.duration).delay(r.delay).easing(U[r.timingFunction]).start(),c=u=>{a.update()};s.addEventListener("render",c),a.onComplete(()=>{s.removeEventListener("render",c),n=!1})}},Re=class{static generateConfig(t,e){if(!Re.configLibrary.has(t))return console.warn(`event library can not found config by name: ${t}`),{name:""};const r=(n,o)=>{for(const a in o)typeof o[a]=="object"&&o[a]!==null&&!Array.isArray(o[a])?r(n[a],o[a]):n[a]=o[a]},s=JSON.parse(JSON.stringify(Re.configLibrary.get(t)));return r(s,e),s}static generateEvent(t,e){return Re.generatorLibrary.has(t.name)?Re.generatorLibrary.get(t.name)(e,t):(console.error(`event library can not found generator by name: ${t.name}`),()=>{})}static has(t){return Re.configLibrary.has(t)}};let N=Re;i(N,"configLibrary",new Map);i(N,"generatorLibrary",new Map);i(N,"register",function(t,e){Re.configLibrary.has(t.name)&&console.warn(`EventLibrary has already exist this event generator: ${t.name}, that will be cover.`),Re.configLibrary.set(t.name,JSON.parse(JSON.stringify(t))),Re.generatorLibrary.set(t.name,e)});N.register(ba,va);N.register(Ra,wa);N.register(Ta,Ca);N.register(xa,Oa);N.register(Aa,La);N.register(Da,Pa);N.register(Ia,ja);N.register(Ga,Na);N.register(Ba,Ha);N.register(Ua,za);N.register(Fa,_a);N.register(ka,$a);N.register(Wa,Va);N.register(Ya,Qa);N.register(Xa,Ka);N.register(Za,Ja);N.register(qa,ec);N.register(tc,rc);const ys=new WeakMap,Ss=function({target:t,config:e,value:r,engine:s}){if(e.vid===r){console.warn("can not set object lookAt itself.");return}let n=ys.get(t);if(n||(n={lookAtTarget:null,updateMatrixWorldFun:null},ys.set(t,n)),!r){if(!n.updateMatrixWorldFun)return;t.updateMatrixWorld=n.updateMatrixWorldFun,n.lookAtTarget=null,n.updateMatrixWorldFun=null;return}const o=s.compilerManager.getObject3D(r);if(!o){console.warn(`lookAt handler can not found this vid mapping object: '${r}'`);return}const a=t.updateMatrixWorld;n.updateMatrixWorldFun=a,n.lookAtTarget=o.position,t.updateMatrixWorld=c=>{a.call(t,c),t.lookAt(n.lookAtTarget)}},Mt="vis.event",we=function({target:t,path:e,value:r,engine:s}){const n=e[0];if(!N.has(r.name)){console.warn(`EventLibrary: can not support this event: ${r.name}`);return}const o=N.generateEvent(r,s),a=Symbol.for(Mt);r[a]=o,t.addEventListener(n,o)},Pe=function({target:t,path:e,value:r}){const s=e[0],n=r[Symbol.for(Mt)];if(!n){console.warn("event remove can not fun found event in config",r);return}t.removeEventListener(s,n),delete r[Symbol.for(Mt)]},Ie=function({target:t,config:e,path:r,engine:s}){const n=r[0],o=e[r[0]][r[1]],a=o[Symbol.for(Mt)];if(!a){console.warn("event remove can not fun found event in config",o);return}t.removeEventListener(n,a);const c=N.generateEvent(o,s);o[Symbol.for(Mt)]=c,t.addEventListener(n,c)},vr=function({target:t,config:e,value:r,engine:s}){const n=s.getConfigBySymbol(r);if(!n){console.warn(` can not foud object config in engine: ${r}`);return}if(n.parent&&n.parent!==e.vid){const a=s.getConfigBySymbol(n.parent);if(!a){console.warn(` can not foud object parent config in engine: ${n.parent}`);return}a.children.splice(a.children.indexOf(r),1)}n.parent=e.vid;const o=s.compilerManager.getObject3D(r);if(!o){console.warn(`can not found this vid in engine: ${r}.`);return}t.add(o)},sc=function({target:t,config:e,value:r,engine:s}){const n=s.compilerManager.getObject3D(r);if(!n){console.warn(`can not found this vid in engine: ${r}.`);return}t.remove(n);const o=s.getConfigBySymbol(r);if(!o){console.warn(`can not found this vid in engine: ${r}.`);return}o.parent=""},le=function(t,e,r,s){return Promise.resolve().then(()=>{!r.lookAt&&Ss({target:t,config:e,engine:s,value:e.lookAt}),e.children.forEach(o=>{vr({target:t,config:e,value:o,engine:s})});for(const o of Object.values(ur))e[o].forEach((a,c)=>{we({target:t,path:[o,c.toString()],value:a,engine:s})})}),K(e,t,_({vid:!0,type:!0,lookAt:!0,parent:!0,children:!0,pointerdown:!0,pointermove:!0,pointerup:!0,pointerenter:!0,pointerleave:!0,click:!0,dblclick:!0,contextmenu:!0},r)),t},J=function(t){t._listener={}},G={add:{pointerdown:we,pointerup:we,pointermove:we,pointerenter:we,pointerleave:we,click:we,dblclick:we,contextmenu:we,children:vr},set:{lookAt:Ss,pointerdown:Ie,pointerup:Ie,pointermove:Ie,pointerenter:Ie,pointerleave:Ie,click:Ie,dblclick:Ie,contextmenu:Ie,parent:zt,children:{$reg:[{reg:new RegExp(".*"),handler:vr}]}},delete:{pointerdown:Pe,pointerup:Pe,pointermove:Pe,pointerenter:Pe,pointerleave:Pe,click:Pe,dblclick:Pe,contextmenu:Pe,children:sc}};C({configType:l.OBJECT3D,commands:G,create(t,e){return le(new Be,t,{},e)},dispose:J});const ie=new WeakMap;var nc=C({configType:l.PERSPECTIVECAMERA,commands:{add:_({scale(){}},G.add),set:Dt(_({scale(){},adaptiveWindow({target:t,value:e,engine:r}){if(e){if(!ie.has(e)){const s=n=>{t.aspect=n.width/n.height,t.updateProjectionMatrix()};ie.set(t,s),r.addEventListener("setSize",s),s({type:"setSize",width:r.dom.offsetWidth,height:r.dom.offsetHeight})}}else{const s=ie.get(t);s&&(r.removeEventListener("setSize",s),ie.delete(t))}}},G.set),{$reg:[{reg:new RegExp("fov|aspect|near|far"),handler({target:t,key:e,value:r}){t[e]=r,t.updateProjectionMatrix()}}]}),delete:_({scale(){}},G.delete)},create(t,e){const r=new ne;if(le(r,t,{scale:!0,adaptiveWindow:!0},e),r.updateProjectionMatrix(),t.adaptiveWindow){const s=n=>{r.aspect=n.width/n.height,r.updateProjectionMatrix()};ie.set(r,s),e.addEventListener("setSize",s),s({type:"setSize",width:e.dom.offsetWidth,height:e.dom.offsetHeight})}return r},dispose(t){ie.delete(t),J(t)}}),oc=C({configType:l.ORTHOGRAPHICCAMERA,commands:{add:_({scale(){}},G.add),set:Dt(_({scale(){},adaptiveWindow({target:t,value:e,engine:r}){if(e){if(!ie.has(e)){const s=n=>{const o=n.width,a=n.height;t.left=-o,t.right=o,t.top=a,t.bottom=-a,t.updateProjectionMatrix()};ie.set(t,s),r.addEventListener("setSize",s),s({type:"setSize",width:r.dom.offsetWidth,height:r.dom.offsetHeight})}}else{const s=ie.get(t);s&&(r.removeEventListener("setSize",s),ie.delete(t))}}},G.set),{$reg:[{reg:new RegExp("left|right|top|bottom|near|far|zoom"),handler({target:t,key:e,value:r}){t[e]=r,t.updateProjectionMatrix()}}]}),delete:_({scale(){}},G.delete)},create(t,e){const r=new He(-50,50,50,-50);if(le(r,t,{scale:!0,adaptiveWindow:!0},e),r.updateProjectionMatrix(),t.adaptiveWindow){const s=n=>{const o=n.width,a=n.height;r.left=-o,r.right=o,r.top=a,r.bottom=-a,r.updateProjectionMatrix()};ie.set(r,s),e.addEventListener("setSize",s),s({type:"setSize",width:e.dom.offsetWidth,height:e.dom.offsetHeight})}return r},dispose(t){ie.delete(t),J(t)}});class ic extends De{constructor(){super();i(this,"MODULE",p.CAMERA)}}M.processor(nc);M.processor(oc);var ac=C({configType:l.ORBITCONTROLS,commands:{set:{target({target:t,config:e,path:r,key:s,value:n}){const o=e.target;if(!e.type){e.target=new O(0,0,0);return}typeof e.target=="string"||(r.length>1?t.target[s]=n:t.target=new O(o.x,o.y,o.z))}}},create(t,e){let r;return e.orbitControls?r=e.orbitControls:(r=new hs,r.setCamera(e.camera),r.setDom(e.dom)),t.target&&(typeof t.target=="string"||(r.target=new O(t.target.x,t.target.y,t.target.z))),K(t,r,{target:!0}),r},dispose(t){t.dispose()}}),cc=C({configType:l.TRNASFORMCONTROLS,commands:{set:{snapAllow({target:t,config:e,value:r}){r?(t.translationSnap=e.translationSnap,t.rotationSnap=e.rotationSnap,t.scaleSnap=e.scaleSnap):(t.translationSnap=null,t.rotationSnap=null,t.scaleSnap=null)},translationSnap({target:t,config:e,value:r}){e.snapAllow&&(t.translationSnap=r)},rotationSnap({target:t,config:e,value:r}){e.snapAllow&&(t.rotationSnap=r)},scaleSnap({target:t,config:e,value:r}){e.snapAllow&&(t.scaleSnap=r)}}},create(t,e){let r;return e.transformControls?r=e.transformControls:(r=new us,r.setCamera(e.camera),e.dom&&r.setDom(e.dom)),t.snapAllow&&(r.translationSnap=t.translationSnap,r.rotationSnap=t.rotationSnap,r.scaleSnap=t.scaleSnap),r},dispose(t){t.dispose()}});class lc extends M{constructor(){super();i(this,"MODULE",p.CONTROLS)}useEngine(e){return e.transformControls&&(this.map.set(l.TRNASFORMCONTROLS,e.transformControls),this.weakMap.set(e.transformControls,l.TRNASFORMCONTROLS)),e.orbitControls&&(this.map.set(l.ORBITCONTROLS,e.orbitControls),this.weakMap.set(e.orbitControls,l.ORBITCONTROLS)),super.useEngine(e)}}M.processor(ac);M.processor(cc);const st=function(t,e){const r=e.resourceManager.resourceMap;if(!r.has(t))return console.warn(`css3D compiler: can not found resource element: ${t}`),document.createElement("div");const s=r.get(t);return s instanceof HTMLElement?s:(console.warn("css3D compiler can not suport render this resource type.",s.constructor,t),document.createElement("div"))};var hc=C({configType:l.CSS3DOBJECT,commands:{add:G.add,set:_({element({target:t,value:e,engine:r}){t.element=st(e,r)}},G.set),delete:G.delete},create(t,e){return le(new mt(st(t.element,e)),t,{element:!0},e)},dispose:J});class uc extends mt{constructor(e=document.createElement("div")){const r=document.createElement("div"),s=50,n=50;r.style.width=`${s}px`,r.style.height=`${n}px`,r.appendChild(e);super(r);i(this,"geometry"),i(this,"_width"),i(this,"_height"),this.geometry=new ae(s,n),this.geometry.computeBoundingBox(),this._width=s,this._height=n}get width(){return this._width}set width(e){this.geometry.dispose(),this.geometry=new ae(e,this._height),this.geometry.computeBoundingBox(),this.element.style.width=`${e}px`,this._width=e}get height(){return this._height}set height(e){this.geometry.dispose(),this.geometry=new ae(this._width,e),this.geometry.computeBoundingBox(),this.element.style.height=`${e}px`,this._height=e}}class dc extends uc{constructor(e=document.createElement("div")){super(e);i(this,"cacheBox",new $r),this.type="CSS3DPlane",this.element.classList.add("vis-css3d","vis-css3d-plane")}raycast(e,r){const s=this.cacheBox.copy(this.geometry.boundingBox);s.applyMatrix4(this.matrixWorld),e.ray.intersectsBox(s)&&r.push({distance:e.ray.origin.distanceTo(this.position),object:this,point:this.position})}}var pc=C({configType:l.CSS3DPLANE,commands:{add:G.add,set:_({element({target:t,value:e,engine:r}){t.element.innerHTML="",t.element.appendChild(st(e,r))}},G.set),delete:G.delete},create(t,e){return le(new dc(st(t.element,e)),t,{element:!0},e)},dispose:J});class mc extends Un{constructor(e=document.createElement("div")){const r=document.createElement("div"),s=50,n=50;r.style.width=`${s}px`,r.style.height=`${n}px`,r.appendChild(e),e.classList.add("vis-css3d","vis-css3d-sprite");super(r);i(this,"geometry"),i(this,"_width"),i(this,"_height"),i(this,"cacheBox",new $r),i(this,"cachePosition",new O),i(this,"cacheQuaternion",new Rt),i(this,"cacheScale",new O),i(this,"cacheMatrix4",new wt),i(this,"rotateMatrix4",new wt),this.geometry=new ae(s,n),this.geometry.computeBoundingBox(),this._width=s,this._height=n,this.type="CSS3DSprite"}get width(){return this._width}set width(e){this.geometry.dispose(),this.geometry=new ae(e,this._height),this.geometry.computeBoundingBox(),this.element.style.width=`${e}px`,this._width=e}get height(){return this._height}set height(e){this.geometry.dispose(),this.geometry=new ae(this._width,e),this.geometry.computeBoundingBox(),this.element.style.height=`${e}px`,this._height=e}raycast(e,r){const s=this.cacheBox.copy(this.geometry.boundingBox);this.matrixWorld.decompose(this.cachePosition,this.cacheQuaternion,this.cacheScale);const n=this.rotateMatrix4.lookAt(this.position,e.camera.position,this.up);this.cacheQuaternion.setFromRotationMatrix(n),this.cacheMatrix4.compose(this.cachePosition,this.cacheQuaternion,this.cacheScale),s.applyMatrix4(this.cacheMatrix4),e.ray.intersectsBox(s)&&r.push({distance:e.ray.origin.distanceTo(this.position),object:this,point:this.position})}}var fc=C({configType:l.CSS3DSPRITE,commands:{add:G.add,set:_({element({target:t,value:e,engine:r}){t.element.innerHTML="",t.element.appendChild(st(e,r))}},G.set),delete:G.delete},create(t,e){return le(new mc(st(t.element,e)),t,{element:!0},e)},dispose:J});class gc extends De{constructor(){super();i(this,"MODULE",p.CSS3D)}}M.processor(pc);M.processor(hc);M.processor(fc);class nt extends te{constructor(e=[],r=36,s=!0){super();i(this,"parameters"),this.type="CurveGeometry",this.parameters={path:e.map(n=>n.clone()),space:s,divisions:r}}}class Ec extends nt{constructor(e=[],r=36,s=!0){super(e,r,s);this.type="QuadraticBezierCurveGeometry";const n=new Ct;if(e.length<3){console.warn("QuadraticBezierCurveGeometry path length at least 3.");return}const o=3+(e.length-3)-(e.length-3)%2;for(let c=1;c<o;c+=2)n.add(new Dn(e[c-1],e[c],e[c+1]));const a=n.curves.reduce((c,u)=>c+=u.arcLengthDivisions,0);if(r>a){const c=Math.ceil((r-a)/n.curves.length);n.curves.forEach(u=>{u.arcLengthDivisions=u.arcLengthDivisions*(c+1),u.updateArcLengths()})}this.setFromPoints(s?n.getSpacedPoints(r):n.getPoints(r))}}class yc extends nt{constructor(e=[],r=36,s=!0){super(e,r,s);this.type="CubicBezierCurveGeometry";const n=new Ct;if(e.length<4){console.warn("CubicBezierCurveGeometry path length at least 4.");return}const o=4+(e.length-4)-(e.length-4)%3;for(let c=2;c<o;c+=3)n.add(new Pn(e[c-2],e[c-1],e[c],e[c+1]));const a=n.curves.reduce((c,u)=>c+=u.arcLengthDivisions,0);if(r>a){const c=Math.ceil((r-a)/n.curves.length);n.curves.forEach(u=>{u.arcLengthDivisions=u.arcLengthDivisions*(c+1),u.updateArcLengths()})}this.setFromPoints(s?n.getSpacedPoints(r):n.getPoints(r))}}class Sc extends nt{constructor(e=[],r=36,s=!0){super(e,r,s);if(this.type="LineCurveGeometry",!e.length){console.warn("LineCurveGeometry path length at least 1.");return}const n=new Ct;for(let a=1;a<e.length;a+=1)n.add(new Wr(e[a-1],e[a]));const o=n.curves.reduce((a,c)=>a+=c.arcLengthDivisions,0);if(r>o){const a=Math.ceil((r-o)/n.curves.length);n.curves.forEach(c=>{c.arcLengthDivisions=c.arcLengthDivisions*(a+1),c.updateArcLengths()})}this.setFromPoints(s?n.getSpacedPoints(r):n.getPoints(r))}}class Mc extends nt{constructor(e=[],r=36,s=!0){super(e,r,s);if(this.type="SplineCurveGeometry",!e.length){console.warn("SplineCurveGeometry path length at least 1.");return}const n=new Vr(e);this.setFromPoints(s?n.getSpacedPoints(r):n.getPoints(r))}}class bc extends Tt{constructor(e=[],r=64,s=1,n=8,o=!1){if(!e.length){console.warn("LineTubeGeometry path length at least 1.");return}const a=new Ct;for(let c=1;c<e.length;c+=1)a.add(new Wr(e[c-1],e[c]));super(a,r,s,n,o);this.type="LineTubeGeometry"}}class vc extends Tt{constructor(e=[],r=64,s=1,n=8,o=!1){if(!e.length){console.warn("SplineTubeGeometry path length at least 1.");return}const a=new Vr(e);super(a,r,s,n,o);this.type="SplineTubeGeometry"}}class Rc extends tr{constructor(e=[new B(0,0)],r=12){const s=new sn,n=e[0];if(n){s.moveTo(n.x,n.y);for(let o=1;o<e.length;o+=1)s.lineTo(e[o].x,e[o].y)}super(s,r);this.type="LineShapeGeometry"}}const wc=function(t,e){!(t instanceof nt)&&!(t instanceof Tt)&&!(t instanceof tr)&&t.center(),t.computeBoundingBox();const r=t.boundingBox,s=e.position,n=e.rotation,o=e.scale,a=new Rt().setFromEuler(new ir(n.x,n.y,n.z,"XYZ"));return t.applyQuaternion(a),t.scale(o.x,o.y,o.z),!(t instanceof nt)&&!(t instanceof Tt)&&!(t instanceof tr)&&t.center(),t.computeBoundingBox(),t.translate((r.max.x-r.min.x)/2*s.x,(r.max.y-r.min.y)/2*s.y,(r.max.z-r.min.z)/2*s.z),t},Rr={reg:new RegExp(".*"),handler({config:t,target:e,processor:r,engine:s}){const n=r.create(t,s);e.copy(n),e.dispatchEvent({type:"update"}),e.uuid=n.uuid,n.dispose()}},Ft={add:{groups({target:t,value:e}){t.addGroup(e.start,e.count,e.materialIndex)},$reg:[Rr]},set:{groups(t){const{path:e,target:r,config:s}=t;if(e[1]!==void 0){r.groups.splice(Number(t.path[1]),1);const n=s.groups[e[1]];r.addGroup(n.start,n.count,n.materialIndex)}else console.warn("geometry processor can not set group",t)},$reg:[Rr]},delete:{groups({target:t,key:e}){t.groups.splice(Number(e),1)},$reg:[Rr]}},_t=function(t,e){t.clearGroups();for(const r of e.groups)t.addGroup(r.start,r.count,r.materialIndex);return wc(t,e)},W=new Map;W.set(l.BOXGEOMETRY,t=>new at(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments));W.set(l.SPHEREGEOMETRY,t=>new Yr(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength));W.set(l.PLANEGEOMETRY,t=>new ae(t.width,t.height,t.widthSegments,t.heightSegments));W.set(l.CIRCLEGEOMETRY,t=>new nn(t.radius,t.segments,t.thetaStart,t.thetaLength));W.set(l.CONEGEOMETRY,t=>new on(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength));W.set(l.CYLINDERGEOMETRY,t=>new an(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength));W.set(l.LINECURVEGEOMETRY,t=>new Sc(t.path.map(e=>new O(e.x,e.y,e.z)),t.divisions,t.space));W.set(l.SPLINECURVEGEOMETRY,t=>new Mc(t.path.map(e=>new O(e.x,e.y,e.z)),t.divisions,t.space));W.set(l.CUBICBEZIERCURVEGEOMETRY,t=>new yc(t.path.map(e=>new O(e.x,e.y,e.z)),t.divisions,t.space));W.set(l.QUADRATICBEZIERCURVEGEOMETRY,t=>new Ec(t.path.map(e=>new O(e.x,e.y,e.z)),t.divisions,t.space));W.set(l.LINETUBEGEOMETRY,t=>new bc(t.path.map(e=>new O(e.x,e.y,e.z)),t.tubularSegments,t.radius,t.radialSegments,t.closed));W.set(l.SPLINETUBEGEOMETRY,t=>new vc(t.path.map(e=>new O(e.x,e.y,e.z)),t.tubularSegments,t.radius,t.radialSegments,t.closed));W.set(l.TORUSGEOMETRY,t=>new cn(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc));W.set(l.RINGGEOMETRY,t=>new ln(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength));W.set(l.LINESHAPEGEOMETRY,t=>new Rc(t.path.map(e=>new B(e.x,e.y)),t.curveSegments));const Tc=function(t){return W.has(t.type)?_t(W.get(t.type)(t),t):(console.error(`parametric geometry can not support this type config: ${t.type}`),new te)},Cc=function(t){t.dispose()},xc=function(t){return C({configType:t,commands:Ft,create:Tc,dispose:Cc})},Oc=[l.BOXGEOMETRY,l.SPHEREGEOMETRY,l.PLANEGEOMETRY,l.CIRCLEGEOMETRY,l.CONEGEOMETRY,l.CYLINDERGEOMETRY,l.LINECURVEGEOMETRY,l.SPLINECURVEGEOMETRY,l.CUBICBEZIERCURVEGEOMETRY,l.QUADRATICBEZIERCURVEGEOMETRY,l.LINETUBEGEOMETRY,l.SPLINETUBEGEOMETRY,l.TORUSGEOMETRY,l.RINGGEOMETRY,l.LINESHAPEGEOMETRY],Ac=Oc.map(t=>xc(t));class Lc extends te{constructor(e){super();i(this,"type","LoadBufferGeometry"),e&&this.copy(e)}}var Dc=C({configType:l.LOADGEOMETRY,commands:Ft,create(t,e){const r=e.resourceManager.resourceMap.get(t.url);return!r&&!(r instanceof te)?(console.error(`engine rescoure can not found url: ${t.url}`),new at(5,5,5)):_t(new Lc(r),t)},dispose(t){t.dispose()}});const Pc=function(t){const e=new te;return t.position.length&&e.setAttribute("position",new he(t.position,3)),t.color.length&&e.setAttribute("color",new he(t.color,3)),t.normal.length&&e.setAttribute("normal",new he(t.normal,3)),t.uv.length&&e.setAttribute("uv",new he(t.uv,2)),t.uv2.length&&e.setAttribute("uv2",new he(t.uv2,2)),t.index.length&&e.setIndex(t.index),e};var Ic=C({configType:l.CUSTOMGEOMETRY,commands:Ft,create(t){return _t(Pc(t.attribute),t)},dispose(t){t.dispose()}}),jc=C({configType:l.EDGESGEOMETRY,commands:Ft,create(t,e){const r=e.compilerManager.getObjectBySymbol(t.url);return!r||!(r instanceof te)?(console.error(`engine rescoure can not found url: ${t.url}`),new Oe(new at(5,5,5))):_t(new Oe(r),t)},dispose(t){t.dispose()}});class Gc extends M{constructor(){super();i(this,"MODULE",p.GEOMETRY)}}Ac.forEach(t=>{M.processor(t)});M.processor(Dc);M.processor(Ic);M.processor(jc);var Nc=C({configType:l.GROUP,commands:G,create(t,e){return le(new hn,t,{},e)},dispose:J});class Bc extends De{constructor(){super();i(this,"MODULE",p.GROUP)}}M.processor(Nc);const Hc=function({target:t,value:e}){t.color.copy(new F(e))},kt=function(t,e,r,s){return t.color.copy(new F(e.color)),le(t,e,_({color:!0,scale:!0,rotation:!0,lookAt:!0},r),s)},$t=Object.assign({},G,{set:{color:Hc,scale:zt,rotation:zt,lookAt:zt}});var Uc=C({configType:l.AMBIENTLIGHT,commands:$t,create(t,e){return kt(new ct,t,{},e)},dispose:J}),zc=C({configType:l.DIRECTIONALLIGHT,commands:$t,create(t,e){return kt(new Qr,t,{},e)},dispose:J}),Fc=C({configType:l.POINTLIGHT,commands:$t,create(t,e){return kt(new Xr,t,{},e)},dispose:J}),_c=C({configType:l.SPOTLIGHT,commands:$t,create(t,e){return kt(new un,t,{},e)},dispose:J});class kc extends De{constructor(){super();i(this,"MODULE",p.LIGHT)}}M.processor(Uc);M.processor(zc);M.processor(Fc);M.processor(_c);class Wt extends De{constructor(){super()}}const Vt=new Ke({fragmentShader:`
  void main () {
    gl_FragColor = vec4(0.5, 0.5, 0.5, 1.0);
  }
  `}),Ms=new at(10,10,10),$c=function({target:t,value:e,engine:r}){const s=r.compilerManager.getGeometry(e);if(!s){console.warn(`can not found geometry by vid in engine: ${e}`),t.geometry=Ms;return}t.geometry=s},wr=function({target:t,config:e,engine:r}){let s;typeof e.material=="string"?s=r.compilerManager.getMaterial(e.material)||Vt:s=e.material.map(n=>r.compilerManager.getMaterial(n)||Vt),t.material=s},Yt=function(t,e,r,s){if(!r.geometry){let n=s.getObjectBySymbol(e.geometry);n instanceof te||(console.warn(`geometry vid in engine is not instance of BufferGeometry: ${e.geometry}`,n),n=Ms),t.geometry.dispose(),t.geometry=n}if(!r.material){let n;typeof e.material=="string"?n=s.compilerManager.getMaterial(e.material)||Vt:n=e.material.map(o=>s.compilerManager.getMaterial(o)||Vt),t.material=n}return le(t,e,_({geometry:!0,material:!0},r),s)},Qt=function(t){J(t)},ot={add:_({material:wr},G.add),set:_({geometry:$c,material:wr},G.set),delete:_({material:wr},G.delete)};var Wc=C({configType:l.LINE,commands:ot,create(t,e){return Yt(new lt,t,{},e)},dispose:Qt});class Vc extends Wt{constructor(){super();i(this,"MODULE",p.LINE)}}M.processor(Wc);const je={reg:new RegExp("transparent|sizeAttenuation"),handler({target:t,key:e,value:r}){t[e]=r,t.needsUpdate=!0}},We={reg:new RegExp("map$","i"),handler({target:t,key:e,value:r,engine:s}){const n=s.compilerManager.getObjectBySymbol(r);n instanceof ce||console.warn(`this url resource is not instance of Texture: ${e}`,r,n),t[e]=n,t.needsUpdate=!0}},q=function({target:t,key:e,value:r}){t[e].copy(new F(r))},Ve=function(t,e,r){const s={};for(const n of Object.keys(e))if(n.toLocaleLowerCase().endsWith("map")&&e[n]){const o=r.compilerManager.getObjectBySymbol(e[n]);if(!(o instanceof ce)){console.warn(`this url resource is not instance of Texture: ${n}`,e[n],o);continue}t[n]=o,s[n]=!0}else t[n]instanceof F&&(t[n]=new F(e[n]),s[n]=!0);return K(e,t,s),t.needsUpdate=!0,t},Ge=function(t){t.dispose()};var bs=C({configType:l.LINEBASICMATERIAL,commands:{set:{color:q,$reg:[We,je]}},create:function(t,e){return Ve(new ht,t,e)},dispose:Ge}),Yc=C({configType:l.MESHBASICMATERIAL,commands:{set:{color:q,$reg:[We,je]}},create:function(t,e){return Ve(new xt,t,e)},dispose:Ge}),Qc=C({configType:l.MESHPHONGMATERIAL,commands:{set:{color:q,emissive:q,specular:q,$reg:[We,je]}},create:function(t,e){return Ve(new dn,t,e)},dispose:Ge}),Xc=C({configType:l.MESHPHYSICALMATERIAL,commands:{set:{color:q,emissive:q,specularColor:q,sheenColor:q,attenuationColor:q,$reg:[We,je]}},create:function(t,e){return Ve(new pn,t,e)},dispose:Ge}),Kc=C({configType:l.MESHSTANDARDMATERIAL,commands:{set:{color:q,emissive:q,$reg:[We,je]}},create:function(t,e){return Ve(new Kr,t,e)},dispose:Ge}),Zc=C({configType:l.POINTSMATERIAL,commands:{set:{color:q,$reg:[We,je]}},create:function(t,e){return Ve(new Ze,t,e)},dispose:Ge}),Jc=C({configType:l.SHADERMATERIAL,commands:{set:{shader({target:t,value:e}){const r=me.getShader(e);(r==null?void 0:r.vertexShader)&&(t.vertexShader=r.vertexShader),(r==null?void 0:r.fragmentShader)&&(t.fragmentShader=r.fragmentShader),(r==null?void 0:r.uniforms)&&(t.uniforms=r.uniforms),(r==null?void 0:r.defines)&&(t.defines=r.defines),t.needsUpdate=!0},$reg:[je]}},create:function(t,e){const r=new Ke,s=me.getShader(t.shader);return(s==null?void 0:s.vertexShader)&&(r.vertexShader=s.vertexShader),(s==null?void 0:s.fragmentShader)&&(r.fragmentShader=s.fragmentShader),(s==null?void 0:s.uniforms)&&(r.uniforms=s.uniforms),(s==null?void 0:s.defines)&&(r.defines=s.defines),K(t,r,{type:!0,shader:!0}),r.needsUpdate=!0,r},dispose:Ge}),qc=C({configType:l.SPRITEMATERIAL,commands:{set:{color:q,$reg:[We,je]}},create:function(t,e){return Ve(new Ae,t,e)},dispose:Ge});class el extends M{constructor(){super();i(this,"MODULE",p.MATERIAL)}}M.processor(Yc);M.processor(Kc);M.processor(Qc);M.processor(bs);M.processor(Zc);M.processor(qc);M.processor(bs);M.processor(Jc);M.processor(Xc);var tl=C({configType:l.MESH,commands:ot,create(t,e){return Yt(new Ue,t,{},e)},dispose:Qt});class rl extends Wt{constructor(){super();i(this,"MODULE",p.MESH)}}M.processor(tl);var sl=C({configType:l.OBJECT3D,commands:G,create(t,e){return le(new Be,t,{},e)},dispose:J});class nl extends De{constructor(){super();i(this,"MODULE",p.OBJECT3D)}}M.processor(sl);var ol=C({configType:l.SMAAPASS,create(t,e){const r=window.devicePixelRatio;return new zn(e.dom?e.dom.offsetWidth*r:window.innerWidth*r,e.dom?e.dom.offsetHeight*r:window.innerWidth*r)},dispose(t){}}),il=C({configType:l.UNREALBLOOMPASS,create(t,e){const r=window.devicePixelRatio;return new Fn(new B(e.dom?e.dom.offsetWidth*r:window.innerWidth*r,e.dom?e.dom.offsetHeight*r:window.innerWidth*r),t.strength,t.radius,t.threshold)},dispose(t){t.dispose()}});const Tr=class extends _n{constructor(t=new B(256,256),e=1,r=0,s=0,n=new oe,o=new ne,a){super();i(this,"resolution"),i(this,"strength"),i(this,"radius"),i(this,"threshold"),i(this,"selectedObjects",[]),i(this,"renderScene"),i(this,"renderCamera"),i(this,"clearColor",new F(0,0,0)),i(this,"renderTargetsHorizontal",[]),i(this,"renderTargetsVertical",[]),i(this,"nMips",5),i(this,"selectRenderTarget"),i(this,"renderTargetBright"),i(this,"highPassUniforms"),i(this,"materialHighPassFilter"),i(this,"separableBlurMaterials",[]),i(this,"compositeMaterial"),i(this,"bloomTintColors"),i(this,"mixMaterial"),i(this,"enabled",!0),i(this,"needsSwap",!1),i(this,"_oldClearColor",new F),i(this,"oldClearAlpha",1),i(this,"basic",new xt),i(this,"fsQuad",new kn),i(this,"materialCache",new Map),i(this,"sceneBackgroundCache",null),i(this,"overrideBackground",new F("black")),i(this,"overrideMeshMaterial",new xt({color:"black"})),i(this,"overrideLineMaterial",new ht({color:"black"})),i(this,"overridePointsMaterial",new Ze({color:"black"})),i(this,"overrideSpriteMaterial",new Ae({color:"black"})),this.resolution=t,this.strength=e,this.radius=r,this.threshold=s,this.renderScene=n,this.renderCamera=o,this.selectedObjects=a;let c=Math.round(this.resolution.x/2),u=Math.round(this.resolution.y/2);this.selectRenderTarget=new ut(c,u),this.selectRenderTarget.texture.name="UnrealBloomPass.selected",this.selectRenderTarget.texture.generateMipmaps=!1,this.renderTargetBright=new ut(c,u),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let y=0;y<this.nMips;y++){const w=new ut(c,u);w.texture.name="UnrealBloomPass.h"+y,w.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(w);const v=new ut(c,u);v.texture.name="UnrealBloomPass.v"+y,v.texture.generateMipmaps=!1,this.renderTargetsVertical.push(v),c=Math.round(c/2),u=Math.round(u/2)}as===void 0&&console.error("THREE.UnrealBloomPass relies on LuminosityHighPassShader");const h=as;this.highPassUniforms=mn.clone(h.uniforms),this.highPassUniforms.luminosityThreshold.value=s,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new Ke({uniforms:this.highPassUniforms,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,defines:{}});const m=[3,5,7,9,11];c=Math.round(this.resolution.x/2),u=Math.round(this.resolution.y/2);for(let y=0;y<this.nMips;y++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(m[y])),this.separableBlurMaterials[y].uniforms.texSize.value=new B(c,u),c=Math.round(c/2),u=Math.round(u/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=e,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;const f=[1,.8,.6,.4,.2];this.compositeMaterial.uniforms.bloomFactors.value=f,this.bloomTintColors=[new O(1,1,1),new O(1,1,1),new O(1,1,1),new O(1,1,1),new O(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,this.mixMaterial=this.getMixMaterial()}dispose(){for(let t=0;t<this.renderTargetsHorizontal.length;t++)this.renderTargetsHorizontal[t].dispose();for(let t=0;t<this.renderTargetsVertical.length;t++)this.renderTargetsVertical[t].dispose();this.renderTargetBright.dispose()}setSize(t,e){let r=Math.round(t/2),s=Math.round(e/2);this.selectRenderTarget.setSize(r,s),this.renderTargetBright.setSize(r,s);for(let n=0;n<this.nMips;n++)this.renderTargetsHorizontal[n].setSize(r,s),this.renderTargetsVertical[n].setSize(r,s),this.separableBlurMaterials[n].uniforms.texSize.value=new B(r,s),r=Math.round(r/2),s=Math.round(s/2)}render(t,e,r,s,n){if(!this.selectedObjects.length){this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=r.texture,t.setRenderTarget(null),t.clear(),this.fsQuad.render(t));return}t.getClearColor(this._oldClearColor),this.oldClearAlpha=t.getClearAlpha();const o=t.autoClear;t.autoClear=!1,t.setClearColor(this.clearColor,0),n&&t.state.buffers.stencil.setTest(!1);const a=new Map;for(const h of this.selectedObjects)a.set(h,!0);const c=this.materialCache;this.renderScene.background&&(this.sceneBackgroundCache=this.renderScene.background,this.renderScene.background=this.overrideBackground),this.renderScene.traverse(h=>{!a.has(h)&&!h.isLight&&h.visible&&(c.set(h,h.material),h instanceof Ue?h.material=this.overrideMeshMaterial:h instanceof lt?h.material=this.overrideLineMaterial:h instanceof ze?h.material=this.overridePointsMaterial:h instanceof Fe&&(h.material=this.overrideSpriteMaterial))}),t.setRenderTarget(this.selectRenderTarget),t.clear(),t.render(this.renderScene,this.renderCamera),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=this.selectRenderTarget.texture,t.setRenderTarget(null),t.clear(),this.fsQuad.render(t)),this.highPassUniforms.tDiffuse.value=this.selectRenderTarget.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,t.setRenderTarget(this.renderTargetBright),t.clear(),this.fsQuad.render(t);let u=this.renderTargetBright;for(let h=0;h<this.nMips;h++)this.fsQuad.material=this.separableBlurMaterials[h],this.separableBlurMaterials[h].uniforms.colorTexture.value=u.texture,this.separableBlurMaterials[h].uniforms.direction.value=Tr.BlurDirectionX,t.setRenderTarget(this.renderTargetsHorizontal[h]),t.clear(),this.fsQuad.render(t),this.separableBlurMaterials[h].uniforms.colorTexture.value=this.renderTargetsHorizontal[h].texture,this.separableBlurMaterials[h].uniforms.direction.value=Tr.BlurDirectionY,t.setRenderTarget(this.renderTargetsVertical[h]),t.clear(),this.fsQuad.render(t),u=this.renderTargetsVertical[h];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,t.setRenderTarget(this.renderTargetsHorizontal[0]),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.mixMaterial,this.mixMaterial.uniforms.bloom.value=this.renderTargetsHorizontal[0].texture,this.mixMaterial.uniforms.origin.value=r.texture,n&&t.state.buffers.stencil.setTest(!0),this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(r),this.fsQuad.render(t)),t.setClearColor(this._oldClearColor,this.oldClearAlpha),t.autoClear=o;for(const h of c.entries())h[0].material=h[1];c.clear(),this.sceneBackgroundCache&&(this.renderScene.background=this.sceneBackgroundCache,this.sceneBackgroundCache=null)}getMixMaterial(){return new Ke({blending:fn,depthTest:!1,depthWrite:!1,transparent:!0,uniforms:{bloom:{value:null},origin:{value:null}},vertexShader:`
    
        varying vec2 vUv;
    
        void main() {
    
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
    
        }`,fragmentShader:`
        uniform sampler2D bloom;
        uniform sampler2D origin;
    
        varying vec2 vUv;
    
        void main() {
          vec3 bloomColor = texture2D(bloom, vUv).rgb;
          vec3 originColor = texture2D(origin, vUv).rgb;
          gl_FragColor = vec4(originColor + bloomColor, 1.0);
        }`})}getSeperableBlurMaterial(t){return new Ke({defines:{KERNEL_RADIUS:t,SIGMA:t},uniforms:{colorTexture:{value:null},texSize:{value:new B(.5,.5)},direction:{value:new B(.5,.5)}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 texSize;
				uniform vec2 direction;

				float gaussianPdf(in float x, in float sigma) {
					return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;
				}
				void main() {
					vec2 invSize = 1.0 / texSize;
					float fSigma = float(SIGMA);
					float weightSum = gaussianPdf(0.0, fSigma);
					vec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;
					for( int i = 1; i < KERNEL_RADIUS; i ++ ) {
						float x = float(i);
						float w = gaussianPdf(x, fSigma);
						vec2 uvOffset = direction * invSize * x;
						vec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;
						vec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;
						diffuseSum += (sample1 + sample2) * w;
						weightSum += 2.0 * w;
					}
					gl_FragColor = vec4(diffuseSum/weightSum, 1.0);
				}`})}getCompositeMaterial(t){return new Ke({defines:{NUM_MIPS:t},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;
				uniform sampler2D blurTexture1;
				uniform sampler2D blurTexture2;
				uniform sampler2D blurTexture3;
				uniform sampler2D blurTexture4;
				uniform sampler2D blurTexture5;
				uniform float bloomStrength;
				uniform float bloomRadius;
				uniform float bloomFactors[NUM_MIPS];
				uniform vec3 bloomTintColors[NUM_MIPS];

				float lerpBloomFactor(const in float factor) {
					float mirrorFactor = 1.2 - factor;
					return mix(factor, mirrorFactor, bloomRadius);
				}

				void main() {
					gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +
						lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +
						lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +
						lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +
						lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );
				}`})}};let Cr=Tr;i(Cr,"BlurDirectionX",new B(1,0));i(Cr,"BlurDirectionY",new B(0,1));var al=C({configType:l.SELECTIVEBLOOMPASS,commands:{add:{selectedObjects({target:t,engine:e,value:r}){const s=e.compilerManager.getObject3D(r);s?t.selectedObjects.push(s):console.warn(`selectiveBloomPassProcessor: can not found vid in engine: ${r}`)}},set:{renderScene({target:t,engine:e,value:r}){const s=e.compilerManager.getObject3D(r);s instanceof oe&&(t.renderScene=s)},renderCamera({target:t,engine:e,value:r}){const s=e.compilerManager.getObject3D(r);s instanceof Zr&&(t.renderCamera=s)},selectedObjects({target:t,config:e,engine:r}){const s=e.selectedObjects.map(n=>{const o=r.compilerManager.getObject3D(n);if(o)return o;console.warn(`selectiveBloomPassProcessor: can not found vid in engine: ${n}`)}).filter(n=>n);t.selectedObjects=s}},delete:{selectedObjects({target:t,engine:e,value:r}){const s=e.compilerManager.getObject3D(r);s?t.selectedObjects.includes(s)&&t.selectedObjects.splice(t.selectedObjects.indexOf(s),1):console.warn(`selectiveBloomPassProcessor: can not found vid in engine: ${r}`)}}},create(t,e){const r=[];for(const o of t.selectedObjects){const a=e.compilerManager.getObject3D(o);a&&r.push(a)}const s=window.devicePixelRatio;return new Cr(new B(e.dom?e.dom.offsetWidth*s:window.innerWidth*s,e.dom?e.dom.offsetHeight*s:window.innerWidth*s),t.strength,t.radius,t.threshold,t.renderScene&&e.compilerManager.getObject3D(t.renderScene)||void 0,t.renderCamera&&e.compilerManager.getObject3D(t.renderCamera)||void 0,r)},dispose(t){t.dispose()}});class cl extends M{constructor(){super();i(this,"MODULE",p.PASS),i(this,"composer")}useEngine(e){return super.useEngine(e),e.effectComposer?(this.composer=e.effectComposer,this):(console.warn("engine need install effectComposer plugin that can use pass compiler."),this)}add(e){const r=super.add(e);return r&&this.composer.addPass(r),r}remove(e){if(!this.map.has(e.vid))return console.warn(`PassCompiler can not found this vid pass: ${e.vid}.`),this;const r=this.map.get(e.vid);return this.composer.removePass(r),super.remove(e),this}}M.processor(ol);M.processor(il);M.processor(al);var ll=C({configType:l.POINTS,commands:ot,create(t,e){return Yt(new ze,t,{},e)},dispose:Qt});class hl extends Wt{constructor(){super();i(this,"MODULE",p.POINTS)}}M.processor(ll);var ul=C({configType:l.WEBGLRENDERER,commands:{set:{size({target:t,config:e}){e.size?t.setSize(e.size.x,e.size.y):t.setSize(t.domElement.offsetWidth,t.domElement.offsetHeight)},clearColor({target:t,value:e}){const r=Number(e.slice(0,-1).split(",").pop().trim());t.setClearColor(e,r),t.clear()},viewport({target:t,config:e}){const r=e.viewport;if(r)t.setViewport(r.x,r.y,r.width,r.height);else{const s=t.domElement;t.setViewport(0,0,s.offsetWidth,s.offsetHeight)}},scissor({target:t,config:e}){const r=e.scissor;if(r)t.setScissorTest(!0),t.setScissor(r.x,r.y,r.width,r.height);else{t.setScissorTest(!1);const s=t.domElement;t.setScissor(0,0,s.offsetWidth,s.offsetHeight)}},pixelRatio({target:t,value:e}){t.setPixelRatio(e),t.clear()}}},create(t,e){let r;if(e.webGLRenderer?r=e.webGLRenderer:r=new Ot,t.size&&r.setSize(t.size.x,t.size.y),t.clearColor){const s=Number(t.clearColor.slice(0,-1).split(",").pop().trim());r.setClearColor(t.clearColor,s)}if(t.viewport){const s=t.viewport;r.setViewport(s.x,s.y,s.width,s.height)}if(t.scissor){const s=t.scissor;r.setScissorTest(!0),r.setScissor(s.x,s.y,s.width,s.height)}return t.pixelRatio&&r.setPixelRatio(t.pixelRatio),K(t,r,{size:!0,clearColor:!0,viewport:!0,scissor:!0,pixelRatio:!0}),r},dispose(t){t.clear(),t.dispose()}}),dl=C({configType:l.CSS3DRENDERER,commands:{set:{size({target:t,config:e}){e.size?t.setSize(e.size.x,e.size.y):t.setSize(t.domElement.offsetWidth,t.domElement.offsetHeight)}}},create(t,e){let r;return e.css3DRenderer?r=e.css3DRenderer:r=new cs,t.size&&r.setSize(t.size.x,t.size.y),K(t,r,{size:!0}),r},dispose(t){}});class pl extends M{constructor(){super();i(this,"MODULE",p.RENDERER)}useEngine(e){return e.webGLRenderer&&this.map.set(l.WEBGLRENDERER,e.webGLRenderer),e.css3DRenderer&&this.map.set(l.CSS3DRENDERER,e.css3DRenderer),super.useEngine(e)}}M.processor(ul);M.processor(dl);const vs=function(t,e,r){if(!e){t.background=null;return}if(qe(e)){const s=r.compilerManager.getTexture(e);s?t.background=s:console.warn(`engine can not found this vid texture : '${e}'`)}else t.background=new F(e)},Rs=function(t,e,r){if(!e){t.environment=null;return}if(qe(e)){const s=r.compilerManager.getTexture(e);s?t.environment=s:console.warn(`engine can not found this vid texture : '${e}'`)}else console.warn(`scene environment is illeage: ${e}`)};var ml=C({configType:l.SCENE,commands:{add:G.add,set:Dt(_({},G.set),{lookAt(){},fog({target:t,config:e,key:r,value:s}){const n=e.fog;n.type?n.type==="Fog"?!t.fog||!(t.fog instanceof rr)?t.fog=new rr(n.color,n.near,n.far):r==="color"?t.fog.color.copy(new F(n.color)):t.fog[r]&&(t.fog[r]=s):n.type==="FogExp2"&&(!t.fog||!(t.fog instanceof sr)?t.fog=new sr(n.color,n.density):r==="color"?t.fog.color.copy(new F(n.color)):t.fog[r]&&(t.fog[r]=s)):t.fog=null},background({target:t,value:e,engine:r}){vs(t,e,r)},environment({target:t,value:e,engine:r}){Rs(t,e,r)}}),delete:G.delete},create(t,e){const r=new oe;if(vs(r,t.background,e),Rs(r,t.environment,e),t.fog.type){const s=t.fog;s.type==="Fog"?r.fog=new rr(s.color,s.near,s.far):s.type==="FogExp2"?r.fog=new sr(s.color,s.density):console.warn(`scene processor can not support this type fog:'${t.type}'`)}return le(r,t,{lookAt:!0,background:!0,environment:!0,fog:!0},e)},dispose:J});class fl extends De{constructor(){super();i(this,"MODULE",p.SCENE)}}M.processor(ml);const ws=new Ae({color:"rgb(123, 123, 123)"});var gl=C({configType:l.SPRITE,commands:{add:ot.add,set:Dt(_({lookAt(){}},ot.set),{material({target:t,engine:e,value:r}){const s=e.compilerManager.getMaterial(r);s&&s instanceof Ae?t.material=s:t.material=ws}}),delete:ot.add},create(t,e){const r=new Fe,s=e.compilerManager.getMaterial(t.material);return s&&s instanceof Ae?r.material=s:r.material=ws,Yt(r,t,{geometry:!0,material:!0,lookAt:!0},e)},dispose:Qt});class El extends Wt{constructor(){super();i(this,"MODULE",p.SPRITE)}}M.processor(gl);class yl extends ce{constructor(e,r,s,n,o,a,c,u,h,m){super(e,r,s,n,o,a,c,u,h,m)}}const Xt={reg:new RegExp("wrapS|wrapT|format|encoding|anisotropy|magFilter|minFilter|mapping"),handler({target:t,key:e,value:r}){t[e]=r,t.needsUpdate=!0}};var Sl=C({configType:l.IMAGETEXTURE,commands:{set:{url({target:t,value:e,engine:r}){t.image=r.compilerManager.textureCompiler.getResource(e,HTMLImageElement),t.needsUpdate=!0},$reg:[Xt]}},create(t,e){const r=new yl;return t.url&&(r.image=e.compilerManager.textureCompiler.getResource(t.url,HTMLImageElement)),K(t,r,{type:!0,url:!0}),r.needsUpdate=!0,r},dispose(t){t.dispose()}}),Ml=C({configType:l.CANVASTEXTURE,commands:{set:{url({target:t,value:e,engine:r}){t.image=r.compilerManager.textureCompiler.getResource(e,HTMLCanvasElement),t.needsUpdate=!0},$reg:[Xt]}},create(t,e){const r=new dt(e.compilerManager.textureCompiler.getResource(t.url,HTMLCanvasElement));return K(t,r,{type:!0,url:!0}),r.needsUpdate=!0,r},dispose(t){t.dispose()}});const Ye=[HTMLImageElement,HTMLVideoElement,HTMLCanvasElement],it=function({target:t,index:e,value:r,engine:s}){t.images[e]=s.compilerManager.textureCompiler.getResource(r,Ye),t.needsUpdate=!0};var bl=C({configType:l.CUBETEXTURE,commands:{set:{cube:{px({target:t,value:e,engine:r}){it({target:t,value:e,engine:r,index:0})},nx({target:t,value:e,engine:r}){it({target:t,value:e,engine:r,index:1})},py({target:t,value:e,engine:r}){it({target:t,value:e,engine:r,index:2})},ny({target:t,value:e,engine:r}){it({target:t,value:e,engine:r,index:3})},pz({target:t,value:e,engine:r}){it({target:t,value:e,engine:r,index:4})},nz({target:t,value:e,engine:r}){it({target:t,value:e,engine:r,index:5})}}}},create(t,e){const r=new gn,s=t.cube,n=e.compilerManager.textureCompiler,o=[n.getResource(s.px,Ye),n.getResource(s.nx,Ye),n.getResource(s.py,Ye),n.getResource(s.ny,Ye),n.getResource(s.pz,Ye),n.getResource(s.nz,Ye)];return r.image=o,K(t,r,{type:!0,cube:!0}),r.needsUpdate=!0,r},dispose(t){t.dispose()}});class vl extends ce{constructor(e,r,s,n,o,a,c,u,h){super(e,r,s,n,o,a,c,u,h);i(this,"isVideoTexture",!0),this.format=c!==void 0?c:En,this.minFilter=a!==void 0?a:At,this.magFilter=o!==void 0?o:At,this.generateMipmaps=!1}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image,r="requestVideoFrameCallback"in e;r?this.needsUpdate=!0:r===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}var Rl=C({configType:l.VIDEOTEXTURE,commands:{set:{url({target:t,value:e,engine:r}){t.image=r.compilerManager.textureCompiler.getResource(e,HTMLVideoElement),t.needsUpdate=!0},$reg:[Xt]}},create(t,e){const r=new vl(document.createElement("video"));return t.url&&(r.image=e.compilerManager.textureCompiler.getResource(t.url,HTMLVideoElement)),K(t,r,{type:!0,url:!0}),r.needsUpdate=!0,r},dispose(t){t.dispose()}});class bt{constructor(e){i(this,"canvas"),this.canvas=document.createElement("canvas");const r=window.devicePixelRatio;this.canvas.width=((e==null?void 0:e.width)||512)*r,this.canvas.height=((e==null?void 0:e.height)||512)*r,this.canvas.style.backgroundColor=(e==null?void 0:e.bgColor)||"rgb(255, 255, 255)";const s=this.canvas.getContext("2d");s&&s.scale(window.devicePixelRatio,window.devicePixelRatio)}get(){return this.canvas}getDom(){return this.canvas}clear(e=0,r=0,s,n){!s&&(s=this.canvas.width),!n&&(n=this.canvas.height);const o=this.canvas.getContext("2d");return o?(o.clearRect(e,r,s,n),this):(console.warn("you browser can not support canvas 2d"),this)}draw(e){const r=this.canvas.getContext("2d");return r?(e(r),this):(console.warn("you browser can not support canvas 2d"),this)}preview(e){const r=this.canvas;return r.style.position="fixed",r.style.top=(e==null?void 0:e.top)||"5%",r.style.left=(e==null?void 0:e.left)||"5%",r.style.right=(e==null?void 0:e.right)||"unset",r.style.bottom=(e==null?void 0:e.bottom)||"unset",(e==null?void 0:e.scale)&&(r.style.transform=`scale(${e.scale})`),document.body.appendChild(this.canvas),this}}class Ts extends ce{constructor(e){super();Object.keys(e).forEach(r=>{this[r]=e[r]}),this.copy(e)}}var wl=C({configType:l.LOADTEXTURE,commands:{set:{url({}){},$reg:[Xt]}},create(t,e){let r;const s=e.compilerManager.textureCompiler.getResource(t.url,ce);if(s instanceof ce)r=new Ts(s);else{const n=new ce(s);r=new Ts(n)}return K(t,r,{type:!0,url:!0}),r.needsUpdate=!0,r},dispose(t){t.dispose()}});const Kt=class extends M{constructor(){super();i(this,"MODULE",p.TEXTURE)}getResource(t,e){const r=this.engine.resourceManager.resourceMap;if(!r.has(t))return console.warn(`engine resourceManager can not found this url: ${t}`),Kt.replaceImage;const s=r.get(t);if(Array.isArray(e)){for(const n of e)if(s instanceof n)return s;return console.warn(`this url mapping resource is not a texture image class: ${t}`,s),Kt.replaceImage}else return s instanceof e?s:(console.warn(`this url mapping resource is not a texture image class: ${t}`,s),Kt.replaceImage)}};let Cs=Kt;i(Cs,"replaceImage",new bt({width:512,height:512}).draw(t=>{t.translate(256,256),t.font="72px",t.fillStyle="white",t.fillText("\u6682\u65E0\u56FE\u7247",0,0)}).getDom());M.processor(Sl);M.processor(Ml);M.processor(bl);M.processor(Rl);M.processor(wl);class Tl{constructor(e){i(this,"object3DCompiler",new nl),i(this,"cameraCompiler",new ic),i(this,"lightCompiler",new kc),i(this,"geometryCompiler",new Gc),i(this,"textureCompiler",new Cs),i(this,"materialCompiler",new el),i(this,"rendererCompiler",new pl),i(this,"sceneCompiler",new fl),i(this,"controlsCompiler",new lc),i(this,"spriteCompiler",new El),i(this,"lineCompiler",new Vc),i(this,"meshCompiler",new rl),i(this,"pointsCompiler",new hl),i(this,"groupCompiler",new Bc),i(this,"css3DCompiler",new gc),i(this,"passCompiler",new cl),i(this,"animationCompiler",new Ma),i(this,"compilerMap"),e&&Object.keys(e).forEach(s=>{this[s]=e[s]});const r=new Map;Object.keys(this).forEach(s=>{const n=this[s];n instanceof M&&r.set(n.MODULE,n)}),this.compilerMap=r}support(e){this.compilerMap.forEach(s=>{s.useEngine(e)});const r=e.dataSupportManager;return r.textureDataSupport.addCompiler(this.textureCompiler),r.materialDataSupport.addCompiler(this.materialCompiler),r.geometryDataSupport.addCompiler(this.geometryCompiler),r.rendererDataSupport.addCompiler(this.rendererCompiler),r.controlsDataSupport.addCompiler(this.controlsCompiler),r.passDataSupport.addCompiler(this.passCompiler),r.object3DDataSupport.addCompiler(this.object3DCompiler),r.cameraDataSupport.addCompiler(this.cameraCompiler),r.lightDataSupport.addCompiler(this.lightCompiler),r.spriteDataSupport.addCompiler(this.spriteCompiler),r.lineDataSupport.addCompiler(this.lineCompiler),r.meshDataSupport.addCompiler(this.meshCompiler),r.pointsDataSupport.addCompiler(this.pointsCompiler),r.css3DDataSupport.addCompiler(this.css3DCompiler),r.groupDataSupport.addCompiler(this.groupCompiler),r.sceneDataSupport.addCompiler(this.sceneCompiler),r.animationDataSupport.addCompiler(this.animationCompiler),this}getObjectSymbol(e){for(const r of this.compilerMap.values()){const s=r.getObjectSymbol(e);if(s)return s}return null}getObjectBySymbol(e){for(const r of this.compilerMap.values()){const s=r.getObjectBySymbol(e);if(s)return s}return null}getObject3D(e){for(const r of this.compilerMap.values())if(r instanceof De&&r.map.has(e))return r.map.get(e);return null}getGeometry(e){return this.geometryCompiler.map.get(e)||null}getMaterial(e){return this.materialCompiler.map.get(e)||null}getTexture(e){return this.textureCompiler.map.get(e)||null}dispose(){for(const e of this.compilerMap.values())e.dispose();return this.compilerMap.clear(),this}}const Cl=function(t){if(this.compilerManager)return console.warn("engine has installed compilerManager plugin."),!1;if(!this.dataSupportManager)return console.warn("must install dataSupportManager before compilerManager plugin."),!1;if(!this.renderManager)return console.warn("must install renderManager before compilerManager plugin."),!1;const e=new Tl;return this.compilerManager=e,this.getObjectSymbol=function(r){return this.compilerManager.getObjectSymbol(r)},this.getObjectBySymbol=function(r){return this.compilerManager.getObjectBySymbol(r)},this.addEventListener("dispose",()=>{this.compilerManager.dispose()}),this.completeSet.add(()=>{this.compilerManager.support(this)}),!0};class xl extends de{constructor(){super();i(this,"map",new Map)}generateSymbol(e){return Array.isArray(e)?e.join(" + "):e.shortcutKey.join(" + ")}watch(e){return e?Lt.watch(void 0,e):Lt.watch(),this}register(e){const r=this.generateSymbol(e);return this.map.has(r)?(console.warn(`KeyboardManager: shortcutKey already exist: ${r}. desp: ${this.map.get(r).desp}`),this):(Lt.bind(r,e.keydown||null,e.keyup),this.map.set(r,e),this)}update(e){const r=this.generateSymbol(e);return this.map.has(r)?(this.cancel(e.shortcutKey),this.register(e),this):(console.warn("KeyboardManager: shortcutKey unregister then exec register function"),this.register(e),this)}cancel(e){const r=this.generateSymbol(e);if(this.map.has(r)){const s=this.map.get(r);Lt.unbind(r,s.keydown||null,s.keyup),this.map.delete(r)}return this}checkRepeat(e){const r=this.generateSymbol(e);return this.map.has(r)}getDocs(){const e=[];return this.map.forEach(r=>{e.push({shortcutKey:[].concat(r.shortcutKey),desp:r.desp})}),e}}const Ol=function(t){if(this.keyboardManager)return console.warn("engine has installed keyboardManager plugin."),!1;const e=new xl;return this.keyboardManager=e,this.completeSet.add(()=>{if(this.transformControls){let r;this.IS_ENGINESUPPORT?(r=this.dataSupportManager.controlsDataSupport.getData()[l.TRNASFORMCONTROLS],e.register({shortcutKey:["shift"],desp:"\u53D8\u6362\u63A7\u5236\u5668\u9501\u5B9A\u6B65\u5E45",keyup:s=>{s==null||s.preventDefault(),r.snapAllow=!1},keydown:s=>{s==null||s.preventDefault(),s==null||s.preventRepeat(),r.snapAllow=!0}})):(r=this.transformControls,e.register({shortcutKey:["shift"],desp:"\u53D8\u6362\u63A7\u5236\u5668\u9501\u5B9A\u6B65\u5E45",keyup:s=>{s==null||s.preventDefault(),r.translationSnap=null,r.rotationSnap=null,r.scaleSnap=null},keydown:s=>{s==null||s.preventDefault(),s==null||s.preventRepeat(),r.translationSnap=5,r.rotationSnap=Math.PI/180*10,r.scaleSnap=.1}})),e.register({shortcutKey:["r"],desp:"\u53D8\u6362\u63A7\u5236\u5668\u6A21\u5F0F\uFF1A\u65CB\u8F6C",keyup:s=>{s==null||s.preventDefault(),r.mode="rotate"}}).register({shortcutKey:["t"],desp:"\u53D8\u6362\u63A7\u5236\u5668\u6A21\u5F0F\uFF1A\u79FB\u52A8",keyup:s=>{s==null||s.preventDefault(),r.mode="translate"}}).register({shortcutKey:["e"],desp:"\u53D8\u6362\u63A7\u5236\u5668\u6A21\u5F0F\uFF1A\u7F29\u653E",keyup:s=>{s==null||s.preventDefault(),r.mode="scale"}}).register({shortcutKey:["x"],desp:"\u53D8\u6362\u63A7\u5236\u5668\u5207\u6362\u8F74\uFF1Ax",keyup:s=>{s==null||s.preventDefault(),r.showX=!r.showX}}).register({shortcutKey:["y"],desp:"\u53D8\u6362\u63A7\u5236\u5668\u5207\u6362\u8F74\uFF1Ay",keyup:s=>{s==null||s.preventDefault(),!(s==null?void 0:s.ctrlKey)&&(r.showY=!r.showY)}}).register({shortcutKey:["z"],desp:"\u53D8\u6362\u63A7\u5236\u5668\u5207\u6362\u8F74\uFF1Az",keyup:s=>{s==null||s.preventDefault(),!(s==null?void 0:s.ctrlKey)&&(r.showZ=!r.showZ)}}).register({shortcutKey:["space"],desp:"\u53D8\u6362\u63A7\u5236\u5668\u5207\u6362\u53D8\u6362\u7A7A\u95F4",keyup:s=>{s==null||s.preventDefault(),r.space=r.space==="local"?"world":"local"}})}}),!0},Al=function(t={}){if(!this.scene)return console.error("must install some scene plugin before BasicViewpoint plugin."),!1;const e=new In(t.length||500);return e.matrixAutoUpdate=!1,e.raycast=()=>{},this.scene.add(e),this.setAxesHelper=function(r){return r.show?this.scene.add(e):this.scene.remove(e),this},this.addEventListener("setScene",r=>{r.scene.add(e)}),!0},Ll=function(t={}){if(!this.scene)return console.error("must install some scene before BasicViewpoint plugin."),!1;const e=new jn(t.range||500,t.spacing||50,t.axesColor||"rgb(130, 130, 130)",t.cellColor||"rgb(70, 70, 70)");if(t.opacity!==1){const r=e.material;r.transparent=!0,r.opacity=t.opacity||.5,r.needsUpdate=!0}return e.matrixAutoUpdate=!1,e.raycast=()=>{},this.scene.add(e),this.setGridHelper=function(r){return r.show?this.scene.add(e):this.scene.remove(e),this},this.addEventListener("setScene",r=>{r.scene.add(e)}),this.completeSet.add(()=>{this.setViewpoint&&this.addEventListener("setViewpoint",r=>{const s=r.viewpoint;s===j.DEFAULT||s===j.TOP||s===j.BOTTOM?e.rotation.set(0,0,0):s===j.RIGHT||s===j.LEFT?e.rotation.set(0,0,Math.PI/2):(s===j.FRONT||s===j.BACK)&&e.rotation.set(Math.PI/2,0,0),e.updateMatrix(),e.updateMatrixWorld()})}),!0};var ee;(function(t){t.GEOMETRY="geometry",t.MATERIAL="material",t.LIGHT="light",t.ENV="env"})(ee||(ee={}));const Dl=function(t={}){if(!this.webGLRenderer)return console.error("must install some renderer before DisplayModel plugin."),!1;if(!this.scene)return console.error("must install some scene before DisplayModel plugin."),!1;!t.overrideColor&&(t.overrideColor="rgb(250, 250, 250)"),!t.defaultAmbientLightSetting&&(t.defaultAmbientLightSetting={}),!t.defaultAmbientLightSetting.color&&(t.defaultAmbientLightSetting.color="rgb(255, 255, 255)"),!t.defaultAmbientLightSetting.intensity&&(t.defaultAmbientLightSetting.intensity=.5);const e=new ct(t.defaultAmbientLightSetting.color,t.defaultAmbientLightSetting.intensity);e.matrixAutoUpdate=!1,!t.defaultDirectionalLightSetting&&(t.defaultDirectionalLightSetting={}),!t.defaultDirectionalLightSetting.color&&(t.defaultDirectionalLightSetting.color="rgb(255, 255, 255)"),!t.defaultDirectionalLightSetting.intensity&&(t.defaultDirectionalLightSetting.intensity=.5),!t.defaultDirectionalLightSetting.position&&(t.defaultDirectionalLightSetting.position={x:-100,y:100,z:100});const r=new Qr(t.defaultDirectionalLightSetting.color,t.defaultDirectionalLightSetting.intensity);r.castShadow=!1,r.position.set(t.defaultDirectionalLightSetting.position.x,t.defaultDirectionalLightSetting.position.y,t.defaultDirectionalLightSetting.position.z),r.updateMatrix(),r.updateMatrixWorld(),r.matrixAutoUpdate=!1,!t.mode&&(t.mode=ee.ENV),this.displayMode=t.mode;const s=new Gn({color:t.overrideColor}),n=new ht({color:t.overrideColor}),o=new Ze({color:t.overrideColor,size:5,sizeAttenuation:!1}),a=new Ae({color:t.overrideColor}),c=new WeakMap,u=new Set,h=new Set,m=new Set,f=new Set,y=new Set;let w,v;const x={Object3D:!0,Group:!0};this.scene.addEventListener("afterAdd",g=>{const V=this.displayMode,D=g.objects;for(const A of D)if(!x[A.type])if(A instanceof Ue&&A.type==="Mesh")h.add(A),V===ee.GEOMETRY&&(c.set(A,A.material),A.material=s);else if(A instanceof lt&&A.type.includes("Line"))m.add(A),V===ee.GEOMETRY&&(c.set(A,A.material),A.material=n);else if(A instanceof os&&A.type.includes("Light")){if(A===e||A===r)continue;u.has(A)||u.add(A),V!==ee.ENV&&V!==ee.LIGHT&&this.scene.remove(A)}else A instanceof ze&&A.type==="Points"?(f.add(A),V===ee.GEOMETRY&&(c.set(A,A.material),A.material=o)):A instanceof Fe&&A.type==="Sprite"&&(y.add(A),V===ee.GEOMETRY&&(c.set(A,A.material),A.material=a))}),this.scene.addEventListener("afterRemove",g=>{const V=g.objects;for(const D of V)if(!x[D.type])if(D instanceof Ue&&D.type==="Mesh")h.delete(D),c.has(D)&&c.delete(D);else if(D instanceof lt&&D.type.includes("Line"))m.delete(D),c.has(D)&&c.delete(D);else if(D instanceof os&&D.type.includes("Light")){if(D===e||D===r)continue;u.delete(D)}else D instanceof ze&&D.type==="Points"?(f.delete(D),c.has(D)&&c.delete(D)):D instanceof Fe&&D.type==="Sprite"&&(y.delete(D),c.has(D)&&c.delete(D))});const R=()=>{for(const g of h)g.material!==s&&(c.set(g,g.material),g.material=s);for(const g of m)g.material!==n&&(c.set(g,g.material),g.material=n);for(const g of f)g.material!==o&&(c.set(g,g.material),g.material=o);for(const g of y)g.material!==a&&(c.set(g,g.material),g.material=a)},S=()=>{h.forEach(g=>{c.has(g)&&(g.material=c.get(g),c.delete(g))}),m.forEach(g=>{c.has(g)&&(g.material=c.get(g),c.delete(g))}),f.forEach(g=>{c.has(g)&&(g.material=c.get(g),c.delete(g))}),y.forEach(g=>{c.has(g)&&(g.material=c.get(g),c.delete(g))})},L=()=>{u.forEach(g=>{g.visible=!1}),this.scene.add(e),this.scene.add(r)},P=()=>{u.forEach(g=>{g.visible=!0}),this.scene.remove(e),this.scene.remove(r)},T=()=>{this.scene.background instanceof ce&&(w=this.scene.background,this.scene.background=null),this.scene.environment instanceof ce&&(v=this.scene.environment,this.scene.environment=null)},k=()=>{w&&(this.scene.background=w,w=void 0),v&&(this.scene.environment=v,v=void 0)};return this.setDisplayMode=function(g){return this.displayMode=g||ee.ENV,g===ee.GEOMETRY?(R(),T(),L()):g===ee.MATERIAL?(S(),T(),L()):g===ee.LIGHT?(S(),T(),P()):g===ee.ENV?(S(),k(),P()):console.warn(`displayMode plugin can not set this mode: ${g}`),this},this.completeSet.add(()=>{this.objectHelperManager&&this.objectHelperManager.addFilteredObject(r)}),!0},Ne=()=>new ht({color:"rgb(255, 255, 255)"});class xs extends ye{constructor(e){super();i(this,"shape"),i(this,"target"),i(this,"type","CameraHelper"),i(this,"cachaData");const r=new te,s=[0,0,0,-1,1,-1,0,0,0,-1,1,1,0,0,0,-1,-1,-1,0,0,0,-1,-1,1,-1,-1,1,-1,-1,-1,-1,-1,-1,-1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,-1,1,0,0,0,0,1,1,0,0,0,0,1,-1,0,0,0,0,-1,-1,0,0,0,0,-1,1,0,1,1,0,1,-1,0,1,-1,0,-1,-1,0,-1,-1,0,-1,1,0,-1,1,0,1,1,0,-1,1,2,-1,1,0,1,-1,2,1,-1,0,-1,-1,2,-1,-1,0,1,1,2,1,1,2,1,1,2,-1,1,2,-1,1,2,-1,-1,2,-1,-1,2,1,-1,2,1,-1,2,1,1];r.setAttribute("position",new he(s,3)),r.rotateY(-90*Math.PI/180),r.computeBoundingBox();const n=new yn(e);n.matrix=new wt,n.matrixAutoUpdate=!0,n.raycast=()=>{},this.add(n),this.shape=n,this.geometry=r,this.material=Ne(),this.target=e,this.matrixAutoUpdate=!1,this.matrix=e.matrix,e instanceof ne?this.cachaData={fov:e.fov,aspect:e.aspect,near:e.near,far:e.far}:e instanceof He?this.cachaData={left:e.left,right:e.right,top:e.top,bottom:e.bottom,near:e.near,far:e.far}:this.cachaData={},this.onBeforeRender=()=>{let o=!1;const a=this.cachaData;Object.keys(a).forEach(c=>{a[c]!==e[c]&&(a[c]=e[c],o=!0)}),o&&this.shape.update()}}raycast(e,r){const s=this.matrixWorld,n=this.geometry.boundingBox.clone();if(n.applyMatrix4(s),e.ray.intersectsBox(n)){const o=this.target;r.push({distance:e.ray.origin.distanceTo(o.position),object:o,point:o.position})}}}class Pl extends ye{constructor(e){super();i(this,"sphere"),i(this,"target"),i(this,"shape"),i(this,"type","VisDirectionalLightHelper"),i(this,"cacheColor"),i(this,"cacheVector3"),this.geometry=new te;const r=[-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,0,0,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,-.707,0,-.707,.707,0,.707,.707,0,-.707,-.707,0,.707];this.geometry.setAttribute("position",new he(r,3)),this.material=Ne(),this.geometry.boundingSphere;const s=new F().copy(e.color).multiplyScalar(e.intensity),n=new ae(20,20);n.dispose();const o=new ye(new Oe(n),new ht({color:s}));o.raycast=()=>{},this.shape=o,this.target=e,this.sphere=new nr(new O(0,0,0),1),this.cacheColor=e.color.getHex(),this.cacheVector3=new O,this.add(this.shape),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.onBeforeRender=()=>{const a=this.target,c=this.shape;a.color.getHex()!==this.cacheColor&&(c.material.color.copy(a.color).multiplyScalar(a.intensity),this.cacheColor=a.color.getHex()),c.lookAt(a.target.position)}}raycast(e,r){const s=this.target,n=s.matrixWorld,o=this.sphere;o.set(this.cacheVector3.set(0,0,0),1),o.applyMatrix4(n),e.ray.intersectsSphere(o)&&r.push({distance:e.ray.origin.distanceTo(s.position),object:s,point:s.position})}}class Il extends ye{constructor(e){super();i(this,"sphere"),i(this,"target"),i(this,"shape"),i(this,"type","VisPointLightHelper"),i(this,"cacheColor"),i(this,"cacheDistance"),i(this,"cacheVector3"),this.geometry=new te;const r=[-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,0,0,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,-.707,0,-.707,.707,0,.707,.707,0,-.707,-.707,0,.707];this.geometry.setAttribute("position",new he(r,3)),this.material=Ne(),this.geometry.boundingSphere;const s=new F().copy(e.color).multiplyScalar(e.intensity),n=new Ue(new Jr(e.distance,0),new xt({color:s,wireframe:!0}));n.raycast=()=>{},n.matrixAutoUpdate=!1,this.shape=n,this.target=e,this.sphere=new nr(new O(0,0,0),1),this.cacheColor=e.color.getHex(),this.cacheDistance=e.distance,this.cacheVector3=new O,this.add(this.shape),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.onBeforeRender=()=>{const o=this.target,a=this.shape;o.distance!==this.cacheDistance&&(a.geometry.dispose(),a.geometry=new Jr(o.distance,0),this.cacheDistance=o.distance),o.color.getHex()!==this.cacheColor&&(a.material.color.copy(o.color).multiplyScalar(o.intensity),this.cacheColor=o.color.getHex())}}raycast(e,r){const s=this.target,n=s.matrixWorld,o=this.sphere;o.set(this.cacheVector3.set(0,0,0),1),o.applyMatrix4(n),e.ray.intersectsSphere(o)&&r.push({distance:e.ray.origin.distanceTo(s.position),object:s,point:s.position})}}class jl extends ye{constructor(e){super();i(this,"sphere"),i(this,"target"),i(this,"shape"),i(this,"type","VisSpotLightHelper"),i(this,"cacheVector3"),i(this,"cacheColor"),i(this,"cacheAngle"),i(this,"cacheDistance"),this.geometry=new te;const r=[-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,0,0,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,-.707,0,-.707,.707,0,.707,.707,0,-.707,-.707,0,.707];this.geometry.setAttribute("position",new he(r,3)),this.material=Ne(),this.geometry.boundingSphere;const s=new te,n=[0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let h=0,m=1,f=32;h<f;h++,m++){const y=h/f*Math.PI*2,w=m/f*Math.PI*2;n.push(Math.cos(y),Math.sin(y),1,Math.cos(w),Math.sin(w),1)}s.setAttribute("position",new he(n,3));const o=Ne(),a=new ye(s,o);a.material.color.copy(e.color).multiplyScalar(e.intensity);const c=e.distance?e.distance:1e3,u=c*Math.tan(e.angle);a.scale.set(u,u,c),a.raycast=()=>{},this.add(a),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.target=e,this.shape=a,this.sphere=new nr(new O(0,0,0),1),this.cacheColor=e.color.getHex(),this.cacheDistance=e.distance,this.cacheAngle=e.angle,this.cacheVector3=new O,this.onBeforeRender=()=>{const h=this.target,m=this.shape;let f=!1;if(h.distance!==this.cacheDistance&&(this.cacheDistance=h.distance,m.scale.z=h.distance,f=!0),h.angle!==this.cacheAngle&&(this.cacheAngle=h.angle,f=!0),f){const y=h.distance*Math.tan(h.angle);m.scale.set(y,y,h.distance)}h.color.getHex()!==this.cacheColor&&(m.material.color.copy(h.color).multiplyScalar(h.intensity),this.cacheColor=h.color.getHex()),m.lookAt(h.target.position)}}raycast(e,r){const s=this.target,n=s.matrixWorld,o=this.sphere;o.set(this.cacheVector3.set(0,0,0),1),o.applyMatrix4(n),e.ray.intersectsSphere(o)&&r.push({distance:e.ray.origin.distanceTo(s.position),object:s,point:s.position})}}class Gl extends ye{constructor(e){super();i(this,"target"),i(this,"type","VisCSS3DHelper");const s=e.element.getBoundingClientRect(),n=s.width,o=s.height;this.geometry=new Oe(new ae(n,o)),this.geometry.computeBoundingBox(),this.material=Ne(),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.target=e}raycast(e,r){const s=this.target,n=s.matrixWorld,o=this.geometry.boundingBox.clone();o.applyMatrix4(n),e.ray.intersectsBox(o)&&r.push({distance:e.ray.origin.distanceTo(s.position),object:s,point:s.position})}}class Os extends ye{constructor(e){super();i(this,"target"),i(this,"type","VisCSS3DPlaneHelper"),i(this,"observer"),this.geometry=new Oe(new ae(e.width,e.height)),this.geometry.computeBoundingBox(),this.material=Ne(),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.matrixWorldNeedsUpdate=!1,this.matrixWorld=e.matrixWorld,this.target=e;const r=new MutationObserver(()=>{this.geometry.dispose(),this.geometry=new Oe(new ae(e.width,e.height)),this.geometry.computeBoundingBox()});r.observe(e.element,{attributeFilter:["style"]}),this.observer=r}dispose(){this.observer.disconnect()}}const As=class extends Fe{constructor(t){super();i(this,"target"),i(this,"type","VisGroupHelper"),this.target=t,this.geometry.computeBoundingBox(),this.material=new Ae({map:As.colorTexture}),this.material.depthTest=!1,this.material.depthWrite=!1,this.scale.set(5,5,5);const e=this.updateMatrixWorld.bind(this);this.updateMatrixWorld=r=>{const s=this.position,n=this.target.position;s.x=n.x,s.y=n.y,s.z=n.z,e(r)}}raycast(t,e){const r=this.matrixWorld,s=this.geometry.boundingBox.clone();if(s.applyMatrix4(r),t.ray.intersectsBox(s)){const n=this.target;e.push({distance:t.ray.origin.distanceTo(n.position),object:n,point:n.position})}}};let Ls=As;i(Ls,"colorTexture",new dt(new bt({width:512,height:512}).draw(t=>{t.beginPath(),t.fillStyle="rgba(0, 0, 0, 0)",t.fillRect(0,0,512,512),t.closePath(),t.translate(256,200),t.beginPath(),t.fillStyle="yellow",t.fillRect(-200,0,400,200),t.closePath(),t.beginPath(),t.fillStyle="yellow",t.fillRect(-200,-70,200,70),t.closePath()}).get()));const Ds=class extends ze{constructor(t){super();i(this,"target"),i(this,"cachaGeometryUUid"),i(this,"type","VisLineHelper"),this.target=t,this.geometry.dispose(),this.geometry.copy(t.geometry),this.cachaGeometryUUid=t.geometry.uuid,this.material=new Ze({color:"rgb(255, 255, 255)",alphaMap:Ds.alphaTexture,transparent:!0,size:5,sizeAttenuation:!1}),this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.matrix=t.matrix,this.matrixWorld=t.matrixWorld,this.renderOrder=-1,this.raycast=()=>{},this.onBeforeRender=()=>{const e=this.target;e.geometry.uuid!==this.cachaGeometryUUid&&(this.geometry.dispose(),this.geometry=e.geometry.clone(),this.cachaGeometryUUid=e.geometry.uuid)}}};let Ps=Ds;i(Ps,"alphaTexture",new dt(new bt({width:512,height:512,bgColor:"rgb(0, 0, 0)"}).draw(t=>{t.beginPath(),t.fillStyle="rgb(255, 255, 255)",t.arc(256,256,200,0,Math.PI*2),t.fill(),t.closePath()}).getDom()));class Nl extends ye{constructor(e){super();i(this,"target"),i(this,"type","VisMeshHelper"),i(this,"cachaGeometryUUid");const r=1;this.target=e,this.geometry=new Oe(e.geometry,r),this.cachaGeometryUUid=e.geometry.uuid,this.material=Ne(),this.raycast=()=>{},this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.matrix=e.matrix,this.matrixWorld=e.matrixWorld,this.onBeforeRender=()=>{const s=this.target;s.geometry.uuid!==this.cachaGeometryUUid&&(this.geometry.dispose(),this.geometry=new Oe(s.geometry,r),this.cachaGeometryUUid=s.geometry.uuid)}}}const Is=class extends ze{constructor(t){super();i(this,"target"),i(this,"type","VisPointsHelper"),this.target=t,this.geometry.dispose(),this.geometry.copy(t.geometry),this.material.dispose(),this.material=new Ze({color:"rgb(255, 255, 255)",alphaMap:Is.alphaTexture,transparent:!0});const e=Array.isArray(t.material)?t.material[0]:t.material;e instanceof Ze&&(this.material.size=e.size,this.material.sizeAttenuation=e.sizeAttenuation),this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.matrix=t.matrix,this.matrixWorld=t.matrixWorld,this.raycast=()=>{}}};let js=Is;i(js,"alphaTexture",new dt(new bt({width:512,height:512,bgColor:"rgb(0, 0, 0)"}).draw(t=>{t.beginPath(),t.strokeStyle="rgb(255, 255, 255)",t.lineWidth=4,t.strokeRect(0,0,512,512),t.closePath()}).get()));const Gs=class extends Fe{constructor(t){super();i(this,"target"),i(this,"type","VisSpriteHelper"),this.target=t,this.material.dispose(),this.material=new Ae({color:"rgb(255, 255, 255)",alphaMap:Gs.alphaTexture,transparent:!0,depthWrite:!1}),this.matrixAutoUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.matrix=t.matrix,this.matrixWorld=t.matrixWorld,this.raycast=()=>{}}};let Ns=Gs;i(Ns,"alphaTexture",new dt(new bt({width:512,height:512,bgColor:"rgb(0, 0, 0)"}).draw(t=>{t.beginPath(),t.strokeStyle="rgb(255, 255, 255)",t.lineWidth=4,t.strokeRect(0,0,512,512),t.closePath()}).get()));class Bl extends de{constructor(e={}){super();i(this,"helperGenerator",{[l.POINTLIGHT]:Il,[l.SPOTLIGHT]:jl,[l.DIRECTIONALLIGHT]:Pl,[l.PERSPECTIVECAMERA]:xs,[l.ORTHOGRAPHICCAMERA]:xs,[l.MESH]:Nl,[l.GROUP]:Ls,[l.SPRITE]:Ns,[l.POINTS]:js,[l.LINE]:Ps,[l.CSS3DOBJECT]:Gl,[l.CSS3DPLANE]:Os,[l.CSS3DSPRITE]:Os}),i(this,"helperFilter",{AmbientLight:!0,Object3D:!0,TransformControls:!0,Scene:!0}),i(this,"objectFilter",new Set),i(this,"objectHelperMap",new Map),e.helperGenerator&&(this.helperGenerator=Object.assign(this.helperGenerator,e.helperGenerator)),e.helperFilter&&(this.helperFilter=Object.assign(this.helperFilter,e.helperFilter)),e.objectFilter&&(this.objectFilter=new Set(e.objectFilter.concat(Array.from(this.objectFilter))))}addFilteredObject(...e){for(const r of e)this.objectFilter.add(r);return this}addObjectHelper(e){if(this.objectFilter.has(e)||this.objectHelperMap.has(e)||this.helperFilter[e.type]||e.type.toLocaleLowerCase().includes("helper"))return null;if(!this.helperGenerator[e.type])return console.warn(`object helper can not support this type object: '${e.type}'`),null;const r=new this.helperGenerator[e.type](e);return this.objectHelperMap.set(e,r),r}disposeObjectHelper(e){if(this.objectFilter.has(e)||this.helperFilter[e.type]||e.type.toLocaleLowerCase().includes("helper"))return null;if(!this.objectHelperMap.has(e))return console.warn("object helper manager can not found this object`s helper: ",e),null;const r=this.objectHelperMap.get(e);return r.geometry&&r.geometry.dispose(),r.material&&(r.material instanceof ns?r.material.dispose():r.material.forEach(s=>{s.dispose()})),this.objectHelperMap.delete(e),r}}const Hl=function(t={}){if(!this.scene)return console.error("must install some scene plugin before ObjectHelper plugin."),!1;t.interact===void 0&&(t.interact=!0),t.interact&&(this.eventManager||(console.warn("must install eventManager plugin that can use interact function."),t.interact=!1));const e=new Bl,r=new Map,s=new Map,n=new Map,o=e.objectHelperMap;this.objectHelperManager=e,!t.activeColor&&(t.activeColor="rgb(230, 20, 240)"),!t.hoverColor&&(t.hoverColor="rgb(255, 158, 240)"),!t.defaultColor&&(t.defaultColor="rgb(255, 255, 255)"),!t.selectedColor&&(t.selectedColor=t.activeColor);const a=new F(t.defaultColor).getHex(),c=new F(t.activeColor).getHex(),u=new F(t.hoverColor).getHex(),h=new F(t.selectedColor).getHex(),m=new WeakSet,f=x=>{const R=x.objects;for(const S of R){const L=e.addObjectHelper(S);if(!!L&&(L.material.color.setHex(a),this.scene.add(L),t.interact)){const P=()=>{var g;((g=this.transformControls)==null?void 0:g.dragging)||this.selectionBox&&this.selectionBox.has(S)||L.material.color.setHex(u)},T=()=>{var g;((g=this.transformControls)==null?void 0:g.dragging)||this.selectionBox&&this.selectionBox.has(S)||L.material.color.setHex(a)},k=()=>{var g;((g=this.transformControls)==null?void 0:g.dragging)||this.selectionBox&&this.selectionBox.has(S)||L.material.color.setHex(c)};S.addEventListener("pointerenter",P),S.addEventListener("pointerleave",T),S.addEventListener("click",k),r.set(S,P),s.set(S,T),n.set(S,k)}}},y=x=>{const R=x.objects;for(const S of R){const L=e.disposeObjectHelper(S);!L||(this.scene.remove(L),t.interact&&(S.removeEventListener("pointerenter",r.get(S)),S.removeEventListener("pointerleave",s.get(S)),S.removeEventListener("click",n.get(S)),r.delete(S),s.delete(S),n.delete(S)))}},w=x=>{m.has(x)||(x.traverse(R=>{const S=e.addObjectHelper(R);S&&x.add(S)}),m.add(x))};this.scene.addEventListener("afterAdd",f),this.scene.addEventListener("afterRemove",y),this.setObjectHelper=function(x){return x.show?this.scene.traverse(R=>{o.has(R)&&this.scene.add(o.get(R))}):this.scene.traverse(R=>{o.has(R)&&this.scene.remove(o.get(R))}),this},this.addEventListener("setScene",x=>{const R=x.scene;!m.has(R)&&w(R),R.hasEventListener("afterAdd",f)||R.addEventListener("afterAdd",f),R.hasEventListener("afterRemove",y)||R.addEventListener("afterRemove",y)});const v=new Set;return this.completeSet.add(()=>{this.selectionBox&&this.addEventListener("selected",x=>{v.forEach(R=>{R.material.color.setHex(a)}),v.clear();for(const R of x.objects)if(o.has(R)){const S=o.get(R);S.material.color.setHex(h),v.add(S)}})}),!0},Ul=function(t={}){if(this.selectionBox)return console.warn("engine has installed selection plugin."),!1;if(!this.eventManager)return console.warn("must install eventManager plugin before Selection plugin."),!1;this.selectionBox=new Set;const e=()=>{const r=[];this.IS_ENGINESUPPORT&&this.selectionBox.forEach(s=>{const n=this.compilerManager.getObjectSymbol(s);n?r.push(n):console.warn("selection plugin can not font vid in compilerManager.",s)}),this.dispatchEvent({type:"selected",objects:[...this.selectionBox],objectSymbols:r})};return this.setSelectionBox=function(r){this.selectionBox.clear();for(const s of r.objects)this.selectionBox.add(s);return e(),this},this.eventManager.addEventListener("click",r=>{var s,n,o;if(this.transing){this.transing=!1;return}const a=r.intersections;if(r.ctrlKey||this.selectionBox.clear(),this.eventManager.penetrate)for(const c of a){if(r.ctrlKey&&((s=this.selectionBox)==null?void 0:s.has(c.object))){this.selectionBox.delete(c.object);continue}this.selectionBox.add(c.object)}else if(a.length){const c=a[0].object;if(r.ctrlKey&&((n=this.selectionBox)==null?void 0:n.has(c))){this.selectionBox.delete(c);return}(o=this.selectionBox)==null||o.add(c)}e()}),!0},zl=function(t={}){if(this.css3DRenderer)return console.warn("this has installed css3DRenderer plugin."),!1;this.css3DRenderer=new cs;const e=this.css3DRenderer.domElement;if(e.classList.add("vis-css3D"),e.style.position="absolute",e.style.top="0",e.style.left="0",this.addEventListener("setDom",r=>{r.dom.appendChild(this.css3DRenderer.domElement)}),this.addEventListener("setSize",r=>{this.css3DRenderer.setSize(r.width,r.height)}),this.addEventListener("setScene",r=>{r.oldScene.traverse(n=>{n instanceof mt&&(n.element.style.display="none")})}),this.renderManager)this.renderManager.removeEventListener("render",this.render),this.renderManager.addEventListener("render",r=>{this.css3DRenderer.render(this.scene,this.camera)});else if(this.webGLRenderer){const r=this.render.bind(this);this.render=function(){return r(),this.webGLRenderer.render(this.scene,this.camera),this}}else this.render=function(){return this.webGLRenderer.render(this.scene,this.camera),this};return!0};var E;(function(t){t.WEBGLRENDERER="WebGLRenderer",t.CSS3DRENDERER="CSS3DRenderer",t.SCENE="Scene",t.MODELINGSCENE="ModelingScene",t.RENDERMANAGER="RenderManager",t.ORBITCONTROLS="OrbitControls",t.STATS="Stats",t.EFFECTCOMPOSER="EffectComposer",t.POINTERMANAGER="PointerManager",t.EVENTMANAGER="EventManager",t.TRANSFORMCONTROLS="TransformControls",t.LOADERMANAGER="LoaderManager",t.RESOURCEMANAGER="ResourceManager",t.DATASUPPORTMANAGER="DataSupportManager",t.COMPILERMANAGER="CompilerManager",t.KEYBOARDMANAGER="KeyboardManager",t.AXESHELPER="AxesHelper",t.GRIDHELPER="GridHelper",t.VIEWPOINT="Viewpoint",t.DISPLAYMODE="DisplayMode",t.OBJECTHELPER="ObjectHelper",t.SELECTION="Selection"})(E||(E={}));const Qe=class extends de{constructor(){super();i(this,"completeSet"),i(this,"camera",new ne),i(this,"scene",new oe),i(this,"IS_ENGINESUPPORT",!1),i(this,"dom"),i(this,"webGLRenderer"),i(this,"css3DRenderer"),i(this,"orbitControls"),i(this,"transformControls"),i(this,"effectComposer"),i(this,"renderManager"),i(this,"pointerManager"),i(this,"eventManager"),i(this,"loaderManager"),i(this,"resourceManager"),i(this,"dataSupportManager"),i(this,"compilerManager"),i(this,"keyboardManager"),i(this,"objectHelperManager"),i(this,"transing"),i(this,"stats"),i(this,"displayMode"),i(this,"selectionBox"),i(this,"getScreenshot"),i(this,"setStats"),i(this,"setTransformControls"),i(this,"setViewpoint"),i(this,"setDisplayMode"),i(this,"setAxesHelper"),i(this,"setGridHelper"),i(this,"setObjectHelper"),i(this,"setSelectionBox"),i(this,"loadResources"),i(this,"loadResourcesAsync"),i(this,"registerResources"),i(this,"toJSON"),i(this,"exportConfig"),i(this,"applyConfig"),i(this,"reactiveConfig"),i(this,"getConfigBySymbol"),i(this,"removeConfigBySymbol"),i(this,"getObjectSymbol"),i(this,"getObjectBySymbol"),i(this,"play"),i(this,"stop"),i(this,"render"),this.completeSet=new Set,this.render=function(){return console.warn("can not install some plugin"),this},this.camera.position.set(50,50,50),this.addEventListener("setSize",t=>{this.camera.aspect=t.width/t.height,this.camera.updateProjectionMatrix()})}optimizeMemory(){Object.keys(this).forEach(t=>{this[t]===void 0&&delete this[t]})}install(t,e){return Qe.pluginHandler.has(t)?Qe.pluginHandler.get(t).call(this,e):console.error(`engine can not support ${t} plugin.`),this}complete(){return this.completeSet.forEach(t=>{t(this)}),this.completeSet.clear(),this}dispose(){return this.dispatchEvent({type:"dispose"}),this}setDom(t){return this.dom=t,this.dispatchEvent({type:"setDom",dom:t}),this}setSize(t,e){var r,s;return t&&t<=0||e&&e<=0?(console.warn(`you must be input width and height bigger then zero, width: ${t}, height: ${e}`),this):(!t&&(t=((r=this.dom)==null?void 0:r.offsetWidth)||window.innerWidth),!e&&(e=((s=this.dom)==null?void 0:s.offsetHeight)||window.innerHeight),this.dispatchEvent({type:"setSize",width:t,height:e}),this)}setCamera(t,e){if(typeof t=="object"&&t instanceof Zr)this.camera=t,this.dispatchEvent({type:"setCamera",camera:t,options:Object.assign({orbitControls:!0,transformControls:!0},e||{})});else if(this.IS_ENGINESUPPORT){const r=this.compilerManager.getObjectBySymbol(t);r?(this.camera=r,this.dispatchEvent({type:"setCamera",camera:r,options:Object.assign({orbitControls:!0,transformControls:!0},e||{})})):console.warn(`can not found camera in compilerManager: ${t}`)}else console.warn("engine is not a Engine support but use symbol to found camera.");return this}setScene(t){if(typeof t=="object"&&t instanceof oe)this.dispatchEvent({type:"setScene",scene:t,oldScene:this.scene}),this.scene=t;else if(this.IS_ENGINESUPPORT){const e=this.compilerManager.getObjectBySymbol(t);e?(this.dispatchEvent({type:"setScene",scene:e,oldScene:this.scene}),this.scene=e):console.warn(`can not found scene in compilerManager: ${t}`)}else console.warn("engine is not a Engine support but use symbol to found scene.");return this}};let I=Qe;i(I,"pluginHandler",new Map);i(I,"register",function(t,e){return Qe.pluginHandler&&Qe.pluginHandler.set(t,e),Qe});i(I,"dispose",function(){Qe.pluginHandler=void 0});I.register(E.WEBGLRENDERER,Eo);I.register(E.CSS3DRENDERER,zl);I.register(E.EFFECTCOMPOSER,ho);I.register(E.RENDERMANAGER,oo);I.register(E.POINTERMANAGER,po);I.register(E.EVENTMANAGER,fo);I.register(E.LOADERMANAGER,So);I.register(E.RESOURCEMANAGER,wi);I.register(E.DATASUPPORTMANAGER,pa);I.register(E.COMPILERMANAGER,Cl);I.register(E.KEYBOARDMANAGER,Ol);I.register(E.ORBITCONTROLS,ao);I.register(E.TRANSFORMCONTROLS,go);I.register(E.AXESHELPER,Al);I.register(E.GRIDHELPER,Ll);I.register(E.OBJECTHELPER,Hl);I.register(E.DISPLAYMODE,Dl);I.register(E.VIEWPOINT,io);I.register(E.STATS,lo);I.register(E.SELECTION,Ul);class Xl extends I{constructor(){super();this.install(E.WEBGLRENDERER,{antialias:!0,alpha:!0}).install(E.RENDERMANAGER).install(E.EFFECTCOMPOSER,{WebGLMultisampleRenderTarget:!0}).install(E.ORBITCONTROLS).install(E.POINTERMANAGER).install(E.EVENTMANAGER).complete()}}class Kl extends I{constructor(){super();this.install(E.RENDERMANAGER).install(E.WEBGLRENDERER,{antialias:!0,alpha:!0}).install(E.POINTERMANAGER).install(E.EVENTMANAGER).install(E.EFFECTCOMPOSER,{WebGLMultisampleRenderTarget:!0}).install(E.SELECTION).install(E.AXESHELPER).install(E.GRIDHELPER).install(E.OBJECTHELPER).install(E.VIEWPOINT).install(E.DISPLAYMODE).install(E.STATS).install(E.ORBITCONTROLS).install(E.KEYBOARDMANAGER).install(E.TRANSFORMCONTROLS).complete()}}const xr=new Xr("rgb(255, 255, 255)",.5,200,1);xr.position.set(-30,5,20);xr.castShadow=!0;const Zt=new Ue(new at(80,2,80),new Kr({color:"rgb(255, 255, 255)"}));Zt.position.set(0,-11,0);Zt.receiveShadow=!0;Zt.castShadow=!0;const Te=class{constructor(t){i(this,"material"),i(this,"dom"),i(this,"renderer"),i(this,"scene"),i(this,"camera"),i(this,"object");const e=new Ot({antialias:!0,preserveDrawingBuffer:!0});e.setPixelRatio(window.devicePixelRatio),e.setClearColor("rgb(150, 150, 150)"),e.shadowMap.enabled=!0,e.shadowMap.type=is;const r=new oe,s=new ne(45,window.innerWidth/window.innerHeight,1,500);s.position.set(0,0,35),s.up.x=0,s.up.y=1,s.up.z=0,s.lookAt(new O(0,0,0)),r.add(Te.ambientLight),r.add(Te.pointLight),r.add(Te.plane),this.scene=r,this.renderer=e,this.camera=s,this.object=new Be,(t==null?void 0:t.material)&&this.setMaterial(t.material),(t==null?void 0:t.dom)&&this.setDom(t.dom)}setMaterial(t){if(this.scene.remove(this.object),this.material=t,t.type.includes("Mesh"))this.object=new Ue(Te.geometry,t);else if(t.type.includes("Line"))this.object=new lt(Te.geometry,t);else if(t.type.includes("Ponits"))this.object=new ze(Te.geometry,t);else if(t.type.includes("Sprite"))this.object=new Fe(t);else return console.warn(`material displayer can not support this type material: '${t.type}'`),this;return this.object.castShadow=!0,this.object.receiveShadow=!0,this.scene.add(this.object),this}setDom(t){return this.dom=t,this.setSize(),t.appendChild(this.renderer.domElement),this}setSize(t,e){if(t&&e)this.camera.aspect=t/e,this.camera.updateProjectionMatrix(),this.renderer.setSize(t,e,!0);else{if(!this.dom)return console.warn("material displayer must set dom before setSize with empty parameters"),this;const r=this.dom;this.camera.aspect=r.offsetWidth/r.offsetHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(r.offsetWidth,r.offsetHeight,!0)}return this}render(){this.renderer.render(this.scene,this.camera)}getDataURL(t){return this.renderer.domElement.toDataURL(t||"image/png")}dispose(){this.renderer.dispose()}};let vt=Te;i(vt,"ambientLight",new ct("rgb(255, 255, 255)",.7));i(vt,"pointLight",xr);i(vt,"geometry",new Yr(10,12,12));i(vt,"plane",Zt);i(vt,"dispose",()=>{Te.geometry.dispose(),Te.plane.geometry.dispose()});const Bs=class{constructor(t){i(this,"dom"),i(this,"texture"),i(this,"renderer"),i(this,"scene"),i(this,"camera");const e=new Ot({antialias:!0,preserveDrawingBuffer:!0});e.setPixelRatio(window.devicePixelRatio),e.setClearColor("rgb(150, 150, 150)"),e.shadowMap.enabled=!0,e.shadowMap.type=is;const r=new oe,s=new ne(45,window.innerWidth/window.innerHeight,1,500);s.position.set(0,0,35),s.up.x=0,s.up.y=1,s.up.z=0,s.lookAt(new O(0,0,0)),r.add(Bs.ambientLight),this.scene=r,this.renderer=e,this.camera=s,(t==null?void 0:t.texture)&&this.setTexture(t.texture),(t==null?void 0:t.dom)&&this.setDom(t.dom)}setTexture(t){return this.scene.background=t,this}setDom(t){return this.dom=t,this.setSize(),t.appendChild(this.renderer.domElement),this}setSize(t,e){if(t&&e)this.camera.aspect=t/e,this.camera.updateProjectionMatrix(),this.renderer.setSize(t,e,!0);else{if(!this.dom)return console.warn("texture displayer must set dom before setSize with empty parameters"),this;const r=this.dom;this.camera.aspect=r.offsetWidth/r.offsetHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(r.offsetWidth,r.offsetHeight,!0)}return this}render(){this.renderer.render(this.scene,this.camera)}getDataURL(t){return this.renderer.domElement.toDataURL(t||"image/png")}dispose(){this.renderer.dispose()}};let Fl=Bs;i(Fl,"ambientLight",new ct("rgb(255, 255, 255)",1));class Hs extends I{constructor(e={},r={}){super();i(this,"IS_ENGINESUPPORT",!0),this.install(E.LOADERMANAGER).install(E.RESOURCEMANAGER,{resources:r}).install(E.POINTERMANAGER).install(E.EVENTMANAGER).install(E.RENDERMANAGER).install(E.DATASUPPORTMANAGER,e).install(E.COMPILERMANAGER)}loadLifeCycle(e){const r=this.dataSupportManager;e.texture&&r.load({texture:e.texture}),e.material&&r.load({material:e.material}),delete e.texture,delete e.material,r.load(e)}removeLifeCycle(e){const r=this.dataSupportManager,s=e[p.TEXTURE]||{},n=e[p.MATERIAL]||{},o=e.assets||[];delete e.texture,delete e.material,delete e.assets,r.remove(e),r.remove({[p.MATERIAL]:n}),r.remove({[p.TEXTURE]:s});const a=this.resourceManager,c=this.loaderManager;o.forEach(u=>{a.remove(u),c.remove(u)})}loadConfig(e,r){const s=this.renderManager.hasRendering();if(s&&this.renderManager.stop(),e.assets&&e.assets.length){const n=o=>{delete e.assets,this.loadLifeCycle(e),this.resourceManager.removeEventListener("mapped",n),r&&r(o),s?this.renderManager.play():this.renderManager.render()};this.resourceManager.addEventListener("mapped",n),this.loaderManager.reset().load(e.assets)}else this.loadLifeCycle(e),r&&r(),s?this.renderManager.play():this.renderManager.render();return this}loadConfigAsync(e){return new Promise((r,s)=>{const n=this.renderManager.hasRendering();if(n&&this.renderManager.stop(),e.assets&&e.assets.length){const o=a=>{delete e.assets,this.loadLifeCycle(e),this.resourceManager.removeEventListener("mapped",o),n?this.renderManager.play():this.renderManager.render(),r(a)};this.resourceManager.addEventListener("mapped",o),this.loaderManager.reset().load(e.assets)}else this.loadLifeCycle(e),n?this.renderManager.play():this.renderManager.render(),r(void 0)})}removeConfig(e){this.removeLifeCycle(e)}getObjectConfig(e){const r=this.getObjectSymbol(e);return r?this.getConfigBySymbol(r):null}}class Zl extends Hs{constructor(e){super(e);i(this,"IS_ENGINESUPPORT",!0),this.install(E.WEBGLRENDERER,{antialias:!0,alpha:!0}).install(E.EFFECTCOMPOSER,{WebGLMultisampleRenderTarget:!0}).install(E.SELECTION).install(E.AXESHELPER).install(E.GRIDHELPER).install(E.OBJECTHELPER).install(E.VIEWPOINT).install(E.DISPLAYMODE).install(E.STATS).install(E.ORBITCONTROLS).install(E.KEYBOARDMANAGER).install(E.TRANSFORMCONTROLS).complete()}}class Jl extends Hs{constructor(e){super(e);this.install(E.WEBGLRENDERER,{antialias:!0,alpha:!0}).install(E.EFFECTCOMPOSER,{WebGLMultisampleRenderTarget:!0}).install(E.ORBITCONTROLS).complete()}}class _l{constructor(e){i(this,"visible",!0),e.visible&&(this.visible=e.visible)}}class ql extends _l{constructor(e){super(e);i(this,"source"),i(this,"target"),i(this,"mode"),i(this,"cacheSourceMatrix"),i(this,"cacheTargetMatrix"),i(this,"cacheSoruceGeometryUuid"),i(this,"cacheTargetGeometryUuid"),i(this,"originalGeometry"),i(this,"modifiedGeometry"),this.source=e.source,this.target=e.target,this.mode=e.mode||"subtract",this.cacheSourceMatrix=this.source.matrix.clone(),this.cacheTargetMatrix=this.target.matrix.clone(),this.cacheSoruceGeometryUuid=this.source.geometry.uuid,this.cacheTargetGeometryUuid=this.target.geometry.uuid,this.originalGeometry=this.source.geometry,this.modifiedGeometry=new te,this.modify(),this.source.geometry=this.modifiedGeometry}async modify(){const e=this.source,r={geometry:this.originalGeometry,matrix:this.source.matrix},s=lr.fromMesh(r),n=lr.fromMesh(this.target),o=lr.toGeometry(s[this.mode](n),e.matrix);this.modifiedGeometry.copy(o),this.modifiedGeometry.uuid=o.uuid}render(){if(this.visible){if(!this.cacheSourceMatrix.equals(this.source.matrix)){this.modify(),this.cacheSourceMatrix.copy(this.source.matrix);return}if(!this.cacheTargetMatrix.equals(this.target.matrix)){this.modify(),this.cacheTargetMatrix.copy(this.target.matrix);return}if(this.originalGeometry.uuid!==this.cacheSoruceGeometryUuid){this.modify(),this.cacheSoruceGeometryUuid=this.originalGeometry.uuid;return}if(this.target.geometry.uuid!==this.cacheTargetGeometryUuid){this.modify(),this.cacheTargetGeometryUuid=this.target.geometry.uuid;return}}else this.modifiedGeometry.copy(this.originalGeometry)}apply(){this.originalGeometry.copy(this.modifiedGeometry),this.originalGeometry.uuid=this.modifiedGeometry.uuid,this.source.geometry=this.originalGeometry}dispose(){this.source.geometry=this.originalGeometry,this.modifiedGeometry.dispose()}}class eh{next(){console.warn(`this action can not set next function: ${this.constructor.name}`)}prev(){console.warn(`this action can not set prev function: ${this.constructor.name}`)}}class th{constructor(e){i(this,"actionList",[]),i(this,"index",-1),i(this,"step",50),this.step=e||50}do(e){this.actionList[this.index][e]()}apply(e,r=!1){const s=this.actionList;this.index===s.length-1&&s.length>=this.step?(s.shift(),this.index=this.actionList.length-1):this.index!==-1?s.splice(this.index+1,s.length-1):this.index===-1&&(this.actionList=[]),this.actionList.push(e),r?this.redo():this.index+=1}redo(){if(this.index+=1,this.index>this.actionList.length-1){this.index=this.actionList.length-1;return}this.do("next")}undo(){this.index<0||(this.do("prev"),this.index-=1)}clear(){this.actionList=[]}}const kl="0.2.3";window.__THREE__||console.error("vis-three dependent on three.js module, pleace run 'npm i three' first.");window.__VIS__?console.warn("Duplicate vis-three frames are introduced"):window.__VIS__=kl;oe.prototype.add=function(...t){if(!arguments.length)return this;if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.add(arguments[r]);return this}const e=t[0];if(e===this)return console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this;if(e&&e.isObject3D){if(e.parent!==null){const r=this.children.indexOf(e);r!==-1&&(e.parent=null,this.children.splice(r,1),e.dispatchEvent({type:"removed"}))}e.parent=this,this.children.push(e),e.dispatchEvent({type:"added"})}else console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t);return this};const $l=oe.prototype.add,Wl=oe.prototype.remove;oe.prototype.add=function(...t){return $l.call(this,...t),this.dispatchEvent({type:"afterAdd",objects:t}),this};oe.prototype.remove=function(...t){return Wl.call(this,...t),this.dispatchEvent({type:"afterRemove",objects:t}),this};const Or=new $n(new He(-256,256,256,-256));Or.autoUpdate=!1;Or.needsUpdate=!1;ct.prototype.shadow=Or;export{eh as A,ql as B,bt as C,Jl as D,N as E,Ls as G,th as H,Ql as J,xl as K,Pi as L,Zl as M,Ht as P,Ri as R,Cr as S,Oi as T,Et as V,Kl as a,p as b,yo as c,vt as d,Fl as e,Xl as f,se as g,I as h,l as i,xs as j,Pl as k,Il as l,jl as m,rt as n,ee as o,j as p};
