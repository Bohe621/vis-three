var u=Object.defineProperty;var h=(r,i,e)=>i in r?u(r,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[i]=e;var s=(r,i,e)=>(h(r,typeof i!="symbol"?i+"":i,e),e);import{e as p,t as v,a as c}from"./index.4424140c.js";import{m as E,V as l,Z as H}from"./three.c9232d79.js";class M extends p{constructor(e){super();s(this,"dom");s(this,"mouse");s(this,"canMouseMove");s(this,"mouseEventTimer");s(this,"throttleTime");s(this,"pointerDownHandler");s(this,"pointerMoveHandler");s(this,"pointerUpHandler");s(this,"mouseDownHandler");s(this,"mouseUpHandler");s(this,"clickHandler");s(this,"dblclickHandler");s(this,"contextmenuHandler");this.dom=e.dom,this.mouse=new E,this.canMouseMove=!0,this.mouseEventTimer=null,this.throttleTime=e.throttleTime||1e3/60;const t=o=>{const a={mouse:{x:this.mouse.x,y:this.mouse.y}};for(const d in o)a[d]=o[d];return a},n=o=>{this.dispatchEvent(t(o))};this.pointerMoveHandler=o=>{!this.canMouseMove||(this.canMouseMove=!1,this.mouseEventTimer=window.setTimeout(()=>{const a=this.mouse,d=this.dom,m=d.getBoundingClientRect();a.x=(o.clientX-m.left)/d.offsetWidth*2-1,a.y=-((o.clientY-m.top)/d.offsetHeight)*2+1,this.canMouseMove=!0,this.dispatchEvent(t(o))},this.throttleTime))},this.mouseDownHandler=n,this.mouseUpHandler=n,this.pointerDownHandler=n,this.pointerUpHandler=n,this.clickHandler=n,this.dblclickHandler=n,this.contextmenuHandler=n}setDom(e){if(this.dom){const t=this.dom;t.removeEventListener("mousedown",this.mouseDownHandler),t.removeEventListener("mouseup",this.mouseUpHandler),t.removeEventListener("pointerdown",this.pointerDownHandler),t.removeEventListener("pointermove",this.pointerMoveHandler),t.removeEventListener("pointerup",this.pointerUpHandler),t.removeEventListener("click",this.clickHandler),t.removeEventListener("dblclick",this.dblclickHandler),t.removeEventListener("contextmenu",this.contextmenuHandler)}return e.addEventListener("mousedown",this.mouseDownHandler),e.addEventListener("mouseup",this.mouseUpHandler),e.addEventListener("pointerdown",this.pointerDownHandler),e.addEventListener("pointermove",this.pointerMoveHandler),e.addEventListener("pointerup",this.pointerUpHandler),e.addEventListener("click",this.clickHandler),e.addEventListener("dblclick",this.dblclickHandler),e.addEventListener("contextmenu",this.contextmenuHandler),this.dom=e,this}getNormalMouse(){return this.mouse}getWorldPosition(e,t,n){const o=new l(this.mouse.x,this.mouse.y,1);return!n&&(n=new l),o.unproject(e),o.sub(e.position).normalize(),n.copy(e.position).add(o.multiplyScalar(t)),n}intersectPlane(e,t,n){!n&&(n=new l);const o=new l(this.mouse.x,this.mouse.y,1);return o.unproject(e),o.sub(e.position).normalize(),new H(e.position,o).intersectPlane(t,n)}}const w="@vis-three/pointer-manager-plugin",L=v(w),D=function(r){let i;return{name:L,install(e){const t=new M(Object.assign(r||{},{dom:e.dom}));i=n=>{t.setDom(n.dom)},e.addEventListener(c.SETDOM,i),e.pointerManager=t},dispose(e){e.removeEventListener(c.SETDOM,i),i=void 0}}};export{D as P,L as a};
