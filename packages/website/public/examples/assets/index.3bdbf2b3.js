var pr=Object.defineProperty;var dr=(r,e,t)=>e in r?pr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var u=(r,e,t)=>(dr(r,typeof e!="symbol"?e+"":e,t),t);import{s as T,i as ot,g as De,h as Se,j as fr,d as hr,k as mr,l as gr,m as Tt,L as Er,S as yr,n as Sr,Q as Mr,o as Rr,p as br,q as Cr,r as Tr,I as Or,V as vr,u as Ot,e as kt,a as Lr,E as wr}from"./index.5dcba3b7.js";import{L as zt,a as Ar}from"./index.b3dc15a2.js";import{P as xr}from"./index.d5b9dbb2.js";import{a as Ir,E as Dr}from"./index.688a05f5.js";import{R as Pr}from"./index.1b4ee7e6.js";import{d as Vt,$ as Gr,c as Ur,C as vt,a0 as jr,R as Nr,a1 as Yt,a2 as Xt,a3 as Jt,a4 as Hr,a5 as Br,a6 as $r,a7 as kr,a8 as zr,a9 as Vr,aa as Yr,O as Wt,u as Xr,g as Jr,n as Lt,S as wt,Q as Wr,ab as Zr,B as He,ac as _r,w as Qr,ad as qr,ae as Kr,af as Fr,V as _,ag as en,ah as tn,m as rn,k as Be,x as fe,ai as At,I as P,A as nn,aj as on,P as sn,ak as an,i as cn,h as un,y as Zt,L as ln,T as me,al as pn,am as dn,an as fn,ao as hn,a as mn,ap as gn,aq as Pe,M as En,b as yn,ar as qe,as as Ke,v as Sn,at as Mn,au as Rn,av as bn,aw as Cn}from"./three.057c7ef5.js";import{_ as st,a as Ge,b as Ue,c as $e}from"./G6.7751b749.js";import{C as Tn}from"./TextureDisplayer.0e66dd70.js";const L=class{constructor(){u(this,"target",{});u(this,"map",new Map);u(this,"weakMap",new WeakMap);u(this,"engine");u(this,"cacheCompile")}getMap(){return this.map}useEngine(e){return this.engine=e,this}setTarget(e){return this.target=e,this}add(e){if(!L.processors.has(e.type))return console.warn(`${this.MODULE} compiler can not support this type: ${e.type}`),null;const n=L.processors.get(e.type).create(e,this.engine);return this.map.set(e.vid,n),this.weakMap.set(n,e.vid),n}remove(e){const t=e.vid;if(!this.map.has(t))return console.warn(`${this.MODULE} compiler can not found this vid object: ${t}.`),this;if(!L.processors.has(e.type))return console.warn(`${this.MODULE} compiler can not support this type: ${e.type}`),this;const n=this.map.get(t);return L.processors.get(e.type).dispose(n),this.map.delete(t),this.weakMap.delete(n),this}cover(e){const t=e.vid;return this.map.has(t)?(Promise.resolve().then(()=>{T(e,e,{vid:!0,type:!0})}),this):(console.warn(`${this.MODULE} compiler can not found this vid object: ${t}.`),this)}compile(e,t){const n=this.cacheCompile;let o,s,a;if(n&&n.vid===e)o=n.target,s=n.config,a=n.processor;else{if(!this.map.has(e))return console.warn(`${this.MODULE} compiler set function: can not found object which vid is: '${e}'`),this;if(!this.target[e])return console.warn(`${this.MODULE} compiler set function: can not found config which vid is: '${e}'`),this;if(o=this.map.get(e),s=this.target[e],!L.processors.has(s.type))return console.warn(`PassCompiler can not support this type: ${s.type}`),this;a=L.processors.get(s.type),this.cacheCompile={target:o,config:s,processor:a,vid:e}}return a.process({config:s,target:o,engine:this.engine,processor:a,compiler:this,...t}),this}compileAll(){const e=this.target;for(const t of Object.values(e))this.add(t);return this}dispose(){this.cacheCompile&&(this.cacheCompile=void 0);for(const e of Object.values(this.target)){if(!this.map.has(e.vid)){console.warn(`${this.MODULE} compiler set function: can not found object which vid is: '${e.vid}'`);continue}const t=this.map.get(e.vid);if(!L.processors.has(e.type)){console.warn(`${this.MODULE}  can not support this type: ${e.type}`);continue}L.processors.get(e.type).dispose(t)}return this.map.clear(),this.target={},this}getObjectSymbol(e){return this.weakMap.get(e)||null}getObjectBySymbol(e){return this.map.get(e)||null}};let d=L;u(d,"processors",new Map),u(d,"processor",function(e){L.processors.set(e.configType,e)});function H(r){return typeof r=="function"}function _t(r){var e=function(n){Error.call(n),n.stack=new Error().stack},t=r(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var Fe=_t(function(r){return function(t){r(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(n,o){return o+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function at(r,e){if(r){var t=r.indexOf(e);0<=t&&r.splice(t,1)}}var ke=function(){function r(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return r.prototype.unsubscribe=function(){var e,t,n,o,s;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var c=st(a),l=c.next();!l.done;l=c.next()){var f=l.value;f.remove(this)}}catch(v){e={error:v}}finally{try{l&&!l.done&&(t=c.return)&&t.call(c)}finally{if(e)throw e.error}}else a.remove(this);var g=this.initialTeardown;if(H(g))try{g()}catch(v){s=v instanceof Fe?v.errors:[v]}var A=this._finalizers;if(A){this._finalizers=null;try{for(var Ce=st(A),de=Ce.next();!de.done;de=Ce.next()){var lr=de.value;try{xt(lr)}catch(v){s=s!=null?s:[],v instanceof Fe?s=Ge(Ge([],Ue(s)),Ue(v.errors)):s.push(v)}}}catch(v){n={error:v}}finally{try{de&&!de.done&&(o=Ce.return)&&o.call(Ce)}finally{if(n)throw n.error}}}if(s)throw new Fe(s)}},r.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)xt(e);else{if(e instanceof r){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},r.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},r.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},r.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&at(t,e)},r.prototype.remove=function(e){var t=this._finalizers;t&&at(t,e),e instanceof r&&e._removeParent(this)},r.EMPTY=function(){var e=new r;return e.closed=!0,e}(),r}(),Qt=ke.EMPTY;function qt(r){return r instanceof ke||r&&"closed"in r&&H(r.remove)&&H(r.add)&&H(r.unsubscribe)}function xt(r){H(r)?r():r.unsubscribe()}var pt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},it={setTimeout:function(r,e){for(var t=[],n=2;n<arguments.length;n++)t[n-2]=arguments[n];var o=it.delegate;return o!=null&&o.setTimeout?o.setTimeout.apply(o,Ge([r,e],Ue(t))):setTimeout.apply(void 0,Ge([r,e],Ue(t)))},clearTimeout:function(r){var e=it.delegate;return((e==null?void 0:e.clearTimeout)||clearTimeout)(r)},delegate:void 0};function On(r){it.setTimeout(function(){throw r})}function It(){}var Te=null;function we(r){if(pt.useDeprecatedSynchronousErrorHandling){var e=!Te;if(e&&(Te={errorThrown:!1,error:null}),r(),e){var t=Te,n=t.errorThrown,o=t.error;if(Te=null,n)throw o}}else r()}var Kt=function(r){$e(e,r);function e(t){var n=r.call(this)||this;return n.isStopped=!1,t?(n.destination=t,qt(t)&&t.add(n)):n.destination=An,n}return e.create=function(t,n,o){return new ct(t,n,o)},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,r.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(ke),vn=Function.prototype.bind;function et(r,e){return vn.call(r,e)}var Ln=function(){function r(e){this.partialObserver=e}return r.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(n){Oe(n)}},r.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(n){Oe(n)}else Oe(e)},r.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){Oe(t)}},r}(),ct=function(r){$e(e,r);function e(t,n,o){var s=r.call(this)||this,a;if(H(t)||!t)a={next:t!=null?t:void 0,error:n!=null?n:void 0,complete:o!=null?o:void 0};else{var c;s&&pt.useDeprecatedNextContext?(c=Object.create(t),c.unsubscribe=function(){return s.unsubscribe()},a={next:t.next&&et(t.next,c),error:t.error&&et(t.error,c),complete:t.complete&&et(t.complete,c)}):a=t}return s.destination=new Ln(a),s}return e}(Kt);function Oe(r){On(r)}function wn(r){throw r}var An={closed:!0,next:It,error:wn,complete:It},xn=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function In(r){return r}function Dn(r){return r.length===0?In:r.length===1?r[0]:function(t){return r.reduce(function(n,o){return o(n)},t)}}var Dt=function(){function r(e){e&&(this._subscribe=e)}return r.prototype.lift=function(e){var t=new r;return t.source=this,t.operator=e,t},r.prototype.subscribe=function(e,t,n){var o=this,s=Gn(e)?e:new ct(e,t,n);return we(function(){var a=o,c=a.operator,l=a.source;s.add(c?c.call(s,l):l?o._subscribe(s):o._trySubscribe(s))}),s},r.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},r.prototype.forEach=function(e,t){var n=this;return t=Pt(t),new t(function(o,s){var a=new ct({next:function(c){try{e(c)}catch(l){s(l),a.unsubscribe()}},error:s,complete:o});n.subscribe(a)})},r.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},r.prototype[xn]=function(){return this},r.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Dn(e)(this)},r.prototype.toPromise=function(e){var t=this;return e=Pt(e),new e(function(n,o){var s;t.subscribe(function(a){return s=a},function(a){return o(a)},function(){return n(s)})})},r.create=function(e){return new r(e)},r}();function Pt(r){var e;return(e=r!=null?r:pt.Promise)!==null&&e!==void 0?e:Promise}function Pn(r){return r&&H(r.next)&&H(r.error)&&H(r.complete)}function Gn(r){return r&&r instanceof Kt||Pn(r)&&qt(r)}var Un=_t(function(r){return function(){r(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),dt=function(r){$e(e,r);function e(){var t=r.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var n=new Gt(this,this);return n.operator=t,n},e.prototype._throwIfClosed=function(){if(this.closed)throw new Un},e.prototype.next=function(t){var n=this;we(function(){var o,s;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var a=st(n.currentObservers),c=a.next();!c.done;c=a.next()){var l=c.value;l.next(t)}}catch(f){o={error:f}}finally{try{c&&!c.done&&(s=a.return)&&s.call(a)}finally{if(o)throw o.error}}}})},e.prototype.error=function(t){var n=this;we(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=t;for(var o=n.observers;o.length;)o.shift().error(t)}})},e.prototype.complete=function(){var t=this;we(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var n=t.observers;n.length;)n.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),r.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var n=this,o=this,s=o.hasError,a=o.isStopped,c=o.observers;return s||a?Qt:(this.currentObservers=null,c.push(t),new ke(function(){n.currentObservers=null,at(c,t)}))},e.prototype._checkFinalizedStatuses=function(t){var n=this,o=n.hasError,s=n.thrownError,a=n.isStopped;o?t.error(s):a&&t.complete()},e.prototype.asObservable=function(){var t=new Dt;return t.source=this,t},e.create=function(t,n){return new Gt(t,n)},e}(Dt),Gt=function(r){$e(e,r);function e(t,n){var o=r.call(this)||this;return o.destination=t,o.source=n,o}return e.prototype.next=function(t){var n,o;(o=(n=this.destination)===null||n===void 0?void 0:n.next)===null||o===void 0||o.call(n,t)},e.prototype.error=function(t){var n,o;(o=(n=this.destination)===null||n===void 0?void 0:n.error)===null||o===void 0||o.call(n,t)},e.prototype.complete=function(){var t,n;(n=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||n===void 0||n.call(t)},e.prototype._subscribe=function(t){var n,o;return(o=(n=this.source)===null||n===void 0?void 0:n.subscribe(t))!==null&&o!==void 0?o:Qt},e}(dt);const Ft=new WeakMap,ut=function(r){Array.isArray(r)&&Ft.set(r,r.concat([]))},jn=function(r){return Ft.get(r)},je=new WeakMap,Nn=function(r,e,t,n,o){const s=Reflect.get(r,e,t);return typeof e!="symbol"&&!n.isIgnore(o)&&(o=Se(o,e),n.next({operate:"get",path:o,key:e,value:r[e]})),s},Hn=function(r,e,t,n,o,s){if(typeof e=="symbol"||o.isIgnore(s))return Reflect.set(r,e,t,n);if(s=Se(s,e),ot(t)&&!je.has(t)&&(t=ft(o,t,s)),r[e]===void 0){De(t)&&ut(t);const c=Reflect.set(r,e,t);return o.next({operate:"add",path:s,key:e,value:t}),c}const a=Reflect.set(r,e,t);if(De(r)&&e==="length"){const c=jn(r);if(!c)return console.error("array value is not be cached:",r),a;const l=c.length-r.length;if(l>0){let f=0,g=0;s=s.slice(0,-e.length);for(const A of c)if(!r.includes(A)&&(o.next({operate:"delete",path:s+g,key:g.toString(),value:A}),f+=1,g+=1,f===l))break}return ut(r),a}return o.next({operate:"set",path:s,key:e,value:t}),a},Bn=function(r,e,t,n){if(typeof e=="symbol"||t.isIgnore(n))return Reflect.deleteProperty(r,e);n=Se(n,e);const o=r[e],s=Reflect.deleteProperty(r,e);return De(r)||t.next({operate:"delete",path:n,key:e,value:o}),s},ft=function(r,e,t=""){if(typeof e!="object"||je.has(e)||r.isIgnore(t))return e;const n={get:(s,a,c)=>Nn(s,a,c,r,t),set:(s,a,c,l)=>Hn(s,a,c,l,r,t),deleteProperty:(s,a)=>Bn(s,a,r,t)};if(ot(e))for(const s in e){const a=Se(t,s);r.isIgnore(a)||ot(e[s])&&(De(e[s])&&ut(e[s]),e[s]=ft(r,e[s],a))}const o=new Proxy(e,n);return je.set(o,r),o};class $n extends dt{constructor(t,n){super();u(this,"ignore",{});u(this,"raw");this.raw=t,n&&(this.ignore=n)}isIgnore(t){let n=this.ignore;for(const o of t.split(".")){if(n[o]===void 0)return!1;if(typeof n[o]=="boolean"&&n[o])return!0;n=n[o]}return!1}setIgnore(t){this.ignore=t}mergeIgnore(t){this.ignore=Object.assign(this.ignore,t)}}const kn=function(r,e){const t=new $n(r,e);return ft(t,r)},zn=function(r){return je.get(r)},Vn=function(r,e,t){return Reflect.get(r,e,t)},Yn=function(r,e,t,n,o){if(typeof e=="symbol")return Reflect.set(r,e,t,n);if(r[e]===void 0){const s=Reflect.set(r,e,t);return o.add(t),o.next({operate:"add",path:e,key:e,value:t}),s}else{const s=Reflect.set(r,e,t);return o.remove(t.vid),o.add(t),o.next({operate:"set",path:e,key:e,value:t}),s}},Xn=function(r,e,t){if(typeof e=="symbol")return Reflect.deleteProperty(r,e);const n=r[e],o=Reflect.deleteProperty(r,e);return t.next({operate:"delete",path:e,key:e,value:n}),t.remove(n.vid),o},Ct=class extends dt{constructor(){super();u(this,"container");u(this,"subscriptions",new Map);this.container=new Proxy(Ct.generator(),{get:Vn,set:(t,n,o,s)=>Yn(t,n,o,s,this),deleteProperty:(t,n)=>Xn(t,n,this)})}add(t){const n=zn(t);if(!n){console.error("DataContainer: this config can not Obasrvable",t);return}this.subscriptions.set(n.raw.vid,n.subscribe(o=>{o.operate!=="get"&&this.next({operate:o.operate,path:Se(n.raw.vid,o.path),key:o.key,value:o.value})}))}remove(t){this.subscriptions.delete(t)}};let Ae=Ct;u(Ae,"generator",()=>({}));class Jn{constructor(){u(this,"rule",()=>{});u(this,"members",[])}apply(e){return this.members.includes(e)||this.members.push(e),this}cancel(e){return this.members.includes(e)&&this.members.splice(this.members.indexOf(e),1),this}setRule(e){return this.rule=e,this}translate(e){const t=this.rule;for(const n of this.members)t(e,n);return this}}var i;(function(r){r.BOXGEOMETRY="BoxGeometry",r.SPHEREGEOMETRY="SphereGeometry",r.LOADGEOMETRY="LoadGeometry",r.PLANEGEOMETRY="PlaneGeometry",r.CIRCLEGEOMETRY="CircleGeometry",r.CONEGEOMETRY="ConeGeometry",r.CYLINDERGEOMETRY="CylinderGeometry",r.DODECAHEDRONGEOMETRY="DodecahedronGeometry",r.TORUSGEOMETRY="TorusGeometry",r.RINGGEOMETRY="RingGeometry",r.EDGESGEOMETRY="EdgesGeometry",r.LINECURVEGEOMETRY="LineCurveGeometry",r.SPLINECURVEGEOMETRY="SplineCurveGeometry",r.CUBICBEZIERCURVEGEOMETRY="CubicBezierCurveGeometry",r.QUADRATICBEZIERCURVEGEOMETRY="QuadraticBezierCurveGeometry",r.CUSTOMGEOMETRY="CustomGeometry",r.LINETUBEGEOMETRY="LineTubeGeometry",r.SPLINETUBEGEOMETRY="SplineTubeGeometry",r.LINESHAPEGEOMETRY="LineShapeGeometry",r.OBJECT3D="Object3D",r.MESH="Mesh",r.LINE="Line",r.POINTS="Points",r.SPRITE="Sprite",r.GROUP="Group",r.CSS3DOBJECT="CSS3DObject",r.CSS3DSPRITE="CSS3DSprite",r.CSS3DPLANE="CSS3DPlane",r.CSS2DPLANE="CSS2DPlane",r.IMAGETEXTURE="ImageTexture",r.CUBETEXTURE="CubeTexture",r.CANVASTEXTURE="CanvasTexture",r.VIDEOTEXTURE="VideoTexture",r.LOADTEXTURE="LoadTexture",r.MESHBASICMATERIAL="MeshBasicMaterial",r.MESHSTANDARDMATERIAL="MeshStandardMaterial",r.MESHPHONGMATERIAL="MeshPhongMaterial",r.SPRITEMATERIAL="SpriteMaterial",r.LINEBASICMATERIAL="LineBasicMaterial",r.POINTSMATERIAL="PointsMaterial",r.SHADERMATERIAL="ShaderMaterial",r.MESHPHYSICALMATERIAL="MeshPhysicalMaterial",r.AMBIENTLIGHT="AmbientLight",r.SPOTLIGHT="SpotLight",r.POINTLIGHT="PointLight",r.DIRECTIONALLIGHT="DirectionalLight",r.HEMISPHERELIGHT="HemisphereLight",r.RECTAREALIGHT="RectAreaLight",r.PERSPECTIVECAMERA="PerspectiveCamera",r.ORTHOGRAPHICCAMERA="OrthographicCamera",r.WEBGLRENDERER="WebGLRenderer",r.CSS3DRENDERER="CSS3DRenderer",r.SCENE="Scene",r.TRNASFORMCONTROLS="TransformControls",r.ORBITCONTROLS="OrbitControls",r.SCRIPTANIMATION="ScriptAnimation",r.KEYFRAMEANIMATION="KeyframeAnimation"})(i||(i={}));const U=()=>({vid:"",name:"",type:i.OBJECT3D,castShadow:!0,receiveShadow:!0,lookAt:"",visible:!0,matrixAutoUpdate:!0,renderOrder:0,position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},up:{x:0,y:1,z:0},parent:"",children:[],pointerdown:[],pointermove:[],pointerup:[],pointerenter:[],pointerleave:[],click:[],dblclick:[],contextmenu:[]}),Me=function(){return Object.assign(U(),{type:"Light",color:"rgb(255, 255, 255)",intensity:1})},Wn=function(){return Object.assign(U(),{type:i.AMBIENTLIGHT,color:"rgb(255, 255, 255)",intensity:1})},Zn=function(){return Object.assign(Me(),{type:i.POINTLIGHT,distance:30,decay:.01})},_n=function(){return Object.assign(Me(),{type:i.SPOTLIGHT,distance:30,angle:Math.PI/180*45,penumbra:.01,decay:.01})},Qn=function(){return Object.assign(Me(),{type:i.DIRECTIONALLIGHT,shadow:{mapSize:{width:512,height:512},camera:{near:.5,far:500}}})},qn=function(){return Object.assign(Me(),{type:i.HEMISPHERELIGHT,color:"rgb(255, 255, 255)",groundColor:"rgb(0, 0, 0)"})},Kn=function(){return Object.assign(Me(),{type:i.RECTAREALIGHT,width:10,height:10})},R=function(){return{vid:"",type:"Geometry",position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},groups:[]}},Fn=function(){return Object.assign(R(),{type:i.BOXGEOMETRY,width:5,height:5,depth:5,widthSegments:1,heightSegments:1,depthSegments:1})},eo=function(){return Object.assign(R(),{type:i.SPHEREGEOMETRY,radius:3,widthSegments:32,heightSegments:32,phiStart:0,phiLength:Math.PI*2,thetaStart:0,thetaLength:Math.PI})},to=function(){return Object.assign(R(),{type:i.PLANEGEOMETRY,width:5,height:5,widthSegments:1,heightSegments:1})},ro=function(){return Object.assign(R(),{type:i.CIRCLEGEOMETRY,radius:3,segments:8,thetaStart:0,thetaLength:Math.PI*2})},no=function(){return Object.assign(R(),{type:i.CONEGEOMETRY,radius:3,height:5,radialSegments:8,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:Math.PI*2})},oo=function(){return Object.assign(R(),{type:i.TORUSGEOMETRY,radius:3,tube:.4,radialSegments:8,tubularSegments:6,arc:Math.PI*2})},so=function(){return Object.assign(R(),{type:i.RINGGEOMETRY,innerRadius:2,outerRadius:3,thetaSegments:8,phiSegments:8,thetaStart:0,thetaLength:Math.PI*2})},ao=function(){return Object.assign(R(),{type:i.LOADGEOMETRY,url:""})},io=function(){return Object.assign(R(),{type:i.CUSTOMGEOMETRY,attribute:{position:[],color:[],index:[],normal:[],uv:[],uv2:[]}})},co=function(){return Object.assign(R(),{type:i.CYLINDERGEOMETRY,radiusTop:3,radiusBottom:3,height:5,radialSegments:8,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:Math.PI*2})},uo=function(){return Object.assign(R(),{type:"",radius:3,detail:0})},lo=function(){return Object.assign(R(),{type:i.LOADGEOMETRY,url:"",thresholdAngle:1})},ze=function(){return Object.assign(R(),{path:[],divisions:36,space:!0})},po=function(){return Object.assign(ze(),{type:i.LINECURVEGEOMETRY})},fo=function(){return Object.assign(ze(),{type:i.SPLINECURVEGEOMETRY})},ho=function(){return Object.assign(ze(),{type:i.CUBICBEZIERCURVEGEOMETRY})},mo=function(){return Object.assign(ze(),{type:i.QUADRATICBEZIERCURVEGEOMETRY})},er=function(){return Object.assign(R(),{type:"TubeGeometry",path:[],tubularSegments:64,radius:1,radialSegments:8,closed:!1})},go=function(){return Object.assign(er(),{type:i.LINETUBEGEOMETRY})},Eo=function(){return Object.assign(er(),{type:i.SPLINETUBEGEOMETRY})},yo=function(){return Object.assign(R(),{path:[],curveSegments:12})},So=function(){return Object.assign(yo(),{type:i.LINESHAPEGEOMETRY})},Re=function(){return{vid:"",type:"Texture",name:"",mapping:Ur,wrapS:vt,wrapT:vt,magFilter:Vt,minFilter:jr,anisotropy:1,format:Nr,flipY:!0,offset:{x:0,y:0},repeat:{x:1,y:1},rotation:0,center:{x:0,y:0},matrixAutoUpdate:!0,encoding:Yt,needsUpdate:!1}},Mo=function(){return Object.assign(Re(),{type:i.IMAGETEXTURE,url:""})},Ro=function(){return Object.assign(Re(),{type:i.VIDEOTEXTURE,url:"",minFilter:Vt})},bo=function(){return Object.assign(Re(),{type:i.CUBETEXTURE,cube:{nx:"",ny:"",nz:"",px:"",py:"",pz:""},mapping:Gr,flipY:!1})},Co=function(){return Object.assign(Re(),{type:i.CANVASTEXTURE,url:"",needsUpdate:!1})},To=function(){return Object.assign(Re(),{type:i.LOADTEXTURE,url:""})},Q=function(){return{vid:"",type:"Material",alphaTest:0,colorWrite:!0,depthTest:!0,depthWrite:!0,fog:!0,name:"",needsUpdate:!1,opacity:1,dithering:!1,shadowSide:null,side:Hr,toneMapped:!0,transparent:!1,visible:!0,blendDst:Br,blendDstAlpha:null,blendEquation:$r,blendEquationAlpha:null,blending:kr,blendSrc:zr,blendSrcAlpha:null,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0}},Oo=function(){return Object.assign(Q(),{type:i.MESHBASICMATERIAL,color:"rgb(255, 255, 255)",combine:Xt,aoMapIntensity:1,fog:!0,lightMapIntensity:1,reflectivity:1,refractionRatio:.98,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",wireframeLinewidth:1,map:"",envMap:"",alphaMap:"",aoMap:"",lightMap:"",specularMap:""})},tr=function(){return Object.assign(Q(),{type:i.MESHSTANDARDMATERIAL,aoMapIntensity:1,bumpScale:1,color:"rgb(255, 255, 255)",displacementScale:1,displacementBias:0,emissive:"rgb(0, 0, 0)",emissiveIntensity:1,envMapIntensity:1,flatShading:!1,lightMapIntensity:1,metalness:0,normalMapType:Jt,refractionRatio:.98,roughness:1,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",roughnessMap:"",normalMap:"",metalnessMap:"",map:"",lightMap:"",envMap:"",emissiveMap:"",displacementMap:"",bumpMap:"",alphaMap:"",aoMap:""})},vo=function(){return Object.assign(tr(),{type:i.MESHPHYSICALMATERIAL,attenuationColor:"rgb(255, 255, 255)",attenuationDistance:0,clearcoat:0,clearcoatNormalScale:{x:1,y:1},clearcoatRoughness:0,ior:1.5,reflectivity:.5,sheen:0,sheenRoughness:1,sheenColor:"rgb(255, 255, 255)",specularIntensity:0,specularColor:"rgb(255, 255, 255)",thickness:0,transmission:0,clearcoatMap:"",clearcoatNormalMap:"",clearcoatRoughnessMap:"",sheenRoughnessMap:"",sheenColorMap:"",specularIntensityMap:"",specularColorMap:"",thicknessMap:"",transmissionMap:""})},Lo=function(){return Object.assign(Q(),{type:i.MESHPHONGMATERIAL,aoMapIntensity:1,bumpScale:1,color:"rgb(255, 255, 255)",displacementScale:1,displacementBias:0,emissive:"rgb(0, 0, 0)",emissiveIntensity:1,envMapIntensity:1,flatShading:!1,lightMapIntensity:1,normalMapType:Jt,refractionRatio:.98,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",specular:"rgb(17, 17, 17)",shininess:30,combine:Xt,normalMap:"",map:"",lightMap:"",envMap:"",emissiveMap:"",displacementMap:"",bumpMap:"",alphaMap:"",aoMap:"",specularMap:""})},wo=function(){return Object.assign(Q(),{type:i.SPRITEMATERIAL,color:"rgb(255, 255, 255)",rotation:0,map:"",alphaMap:"",sizeAttenuation:!0})},Ao=function(){return Object.assign(Q(),{type:i.LINEBASICMATERIAL,color:"rgb(255, 255, 255)",linecap:"round",linejoin:"round",linewidth:1})},xo=function(){return Object.assign(Q(),{type:i.POINTSMATERIAL,map:"",alphaMap:"",color:"rgb(255, 255, 255)",sizeAttenuation:!0,size:1})},Io=function(){return Object.assign(Q(),{type:i.SHADERMATERIAL,shader:"defaultShader",uniforms:{}})},Do=function(){return Object.assign(U(),{type:i.PERSPECTIVECAMERA,adaptiveWindow:!1,fov:45,aspect:1920/1080,near:5,far:50})},Po=function(){return Object.assign(U(),{type:i.ORTHOGRAPHICCAMERA,adaptiveWindow:!1,left:-window.innerWidth,right:window.innerWidth,top:window.innerHeight,bottom:-window.innerHeight,near:5,far:50,zoom:1})};var p;(function(r){r.OBJECT3D="object3D",r.CAMERA="camera",r.LIGHT="light",r.GEOMETRY="geometry",r.TEXTURE="texture",r.MATERIAL="material",r.RENDERER="renderer",r.SCENE="scene",r.SPRITE="sprite",r.CONTROLS="controls",r.LINE="line",r.MESH="mesh",r.POINTS="points",r.GROUP="group",r.CSS3D="css3D",r.CSS2D="css2D",r.PASS="pass",r.ANIMATION="animation"})(p||(p={}));const Go={[p.CAMERA]:!0,[p.LIGHT]:!0,[p.SCENE]:!0,[p.SPRITE]:!0,[p.LINE]:!0,[p.MESH]:!0,[p.POINTS]:!0,[p.GROUP]:!0,[p.CSS3D]:!0,[p.CSS2D]:!0,[p.OBJECT3D]:!0},G=function(r){return`DEFUALT-${r}`},ht=r=>{const e=t=>r.toLocaleLowerCase().includes(t.toLocaleLowerCase());for(const t of Object.values(p))if(e(t))return t;return null},Uo=r=>Go[r],jo=r=>{const e=ht(r);return e?Uo(e):!1},rr=function(){return{vid:"",type:"Renderer",size:null}},No=function(){return Object.assign(rr(),{vid:G(i.WEBGLRENDERER),type:i.WEBGLRENDERER,clearColor:"rgba(0, 0, 0, 0)",outputEncoding:Yt,physicallyCorrectLights:!1,shadowMap:{enabled:!1,autoUpdate:!0,needsUpdate:!1,type:Vr},toneMapping:Yr,toneMappingExposure:1,pixelRatio:window.devicePixelRatio,adaptiveCamera:!1,viewport:null,scissor:null})},Ho=function(){return Object.assign(rr(),{vid:G(i.CSS3DRENDERER),type:i.CSS3DRENDERER})},Bo=function(){return Object.assign(U(),{vid:G(i.SCENE),type:i.SCENE,background:"",environment:"",fog:{type:"",color:"rgb(150, 150, 150)",near:1,far:200,density:.003}})},$o=function(){return{vid:G(i.TRNASFORMCONTROLS),type:i.TRNASFORMCONTROLS,axis:"XYZ",enabled:!0,mode:"translate",snapAllow:!1,rotationSnap:Math.PI/180*10,translationSnap:5,scaleSnap:.1,showX:!0,showY:!0,showZ:!0,size:1,space:"world"}},ko=function(){return{vid:G(i.ORBITCONTROLS),type:i.ORBITCONTROLS,autoRotate:!1,autoRotateSpeed:2,enableDamping:!1,dampingFactor:.05,enabled:!0,enablePan:!0,enableRotate:!0,enableZoom:!0,maxAzimuthAngle:1/0,maxDistance:1/0,maxPolarAngle:Math.PI,maxZoom:1/0,minAzimuthAngle:-1/0,minDistance:0,minPolarAngle:0,minZoom:0,panSpeed:1,rotateSpeed:1,zoomSpeed:1,screenSpacePanning:!0,target:null}},Ve=function(){return Object.assign(U(),{material:"",geometry:""})},zo=function(){return Object.assign(Ve(),{type:"Sprite",material:"",center:{x:.5,y:.5}})},Vo=function(){return Object.assign(Ve(),{type:i.MESH,geometry:"",material:""})},Yo=function(){return Object.assign(Ve(),{type:i.POINTS,geometry:"",material:""})},Xo=function(){return Object.assign(Ve(),{type:i.LINE,geometry:"",material:""})},Jo=function(){return Object.assign(U(),{type:i.GROUP,children:[]})},nr=function(){return{vid:"",type:"",name:"",target:"",attribute:"",play:!0}},Wo=function(){return Object.assign(nr(),{type:i.SCRIPTANIMATION,script:{name:""}})},Zo=function(){return Object.assign(nr(),{type:i.KEYFRAMEANIMATION,script:{name:""}})},mt=function(){return Object.assign(U(),{type:i.CSS3DOBJECT,element:"",width:50,height:50})},_o=function(){return Object.assign(mt(),{type:i.CSS3DPLANE})},Qo=function(){return Object.assign(mt(),{type:i.CSS3DSPRITE,rotation2D:0})},qo=function(){return Object.assign(U(),{type:i.CSS3DOBJECT,element:"",width:50,height:50})},Ko=function(){return Object.assign(qo(),{type:i.CSS2DPLANE})},y={[i.IMAGETEXTURE]:Mo,[i.CUBETEXTURE]:bo,[i.CANVASTEXTURE]:Co,[i.VIDEOTEXTURE]:Ro,[i.LOADTEXTURE]:To,[i.MESHBASICMATERIAL]:Oo,[i.MESHSTANDARDMATERIAL]:tr,[i.MESHPHONGMATERIAL]:Lo,[i.SPRITEMATERIAL]:wo,[i.LINEBASICMATERIAL]:Ao,[i.POINTSMATERIAL]:xo,[i.SHADERMATERIAL]:Io,[i.MESHPHYSICALMATERIAL]:vo,[i.AMBIENTLIGHT]:Wn,[i.SPOTLIGHT]:_n,[i.POINTLIGHT]:Zn,[i.DIRECTIONALLIGHT]:Qn,[i.HEMISPHERELIGHT]:qn,[i.RECTAREALIGHT]:Kn,[i.BOXGEOMETRY]:Fn,[i.SPHEREGEOMETRY]:eo,[i.LOADGEOMETRY]:ao,[i.CUSTOMGEOMETRY]:io,[i.PLANEGEOMETRY]:to,[i.CIRCLEGEOMETRY]:ro,[i.CONEGEOMETRY]:no,[i.CYLINDERGEOMETRY]:co,[i.EDGESGEOMETRY]:lo,[i.LINECURVEGEOMETRY]:po,[i.SPLINECURVEGEOMETRY]:fo,[i.CUBICBEZIERCURVEGEOMETRY]:ho,[i.QUADRATICBEZIERCURVEGEOMETRY]:mo,[i.DODECAHEDRONGEOMETRY]:uo,[i.SPLINETUBEGEOMETRY]:Eo,[i.LINETUBEGEOMETRY]:go,[i.TORUSGEOMETRY]:oo,[i.RINGGEOMETRY]:so,[i.LINESHAPEGEOMETRY]:So,[i.OBJECT3D]:U,[i.SPRITE]:zo,[i.LINE]:Xo,[i.MESH]:Vo,[i.POINTS]:Yo,[i.GROUP]:Jo,[i.CSS3DOBJECT]:mt,[i.CSS3DSPRITE]:Qo,[i.CSS3DPLANE]:_o,[i.CSS2DPLANE]:Ko,[i.PERSPECTIVECAMERA]:Do,[i.ORTHOGRAPHICCAMERA]:Po,[i.WEBGLRENDERER]:No,[i.CSS3DRENDERER]:Ho,[i.SCENE]:Bo,[i.TRNASFORMCONTROLS]:$o,[i.ORBITCONTROLS]:ko,[i.SCRIPTANIMATION]:Wo,[i.KEYFRAMEANIMATION]:Zo},Ne=(r,e)=>e===1/0?"Infinity":e===-1/0?"-Infinity":e,Fo=(r,e)=>e==="Infinity"?1/0:e==="-Infinity"?-1/0:e,tt=r=>JSON.parse(JSON.stringify(r,Ne),Fo);var ve,es=new Uint8Array(16);function ts(){if(!ve&&(ve=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!ve))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ve(es)}var rs=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Y(r){return typeof r=="string"&&rs.test(r)}var E=[];for(var rt=0;rt<256;++rt)E.push((rt+256).toString(16).substr(1));function ns(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(E[r[e+0]]+E[r[e+1]]+E[r[e+2]]+E[r[e+3]]+"-"+E[r[e+4]]+E[r[e+5]]+"-"+E[r[e+6]]+E[r[e+7]]+"-"+E[r[e+8]]+E[r[e+9]]+"-"+E[r[e+10]]+E[r[e+11]]+E[r[e+12]]+E[r[e+13]]+E[r[e+14]]+E[r[e+15]]).toLowerCase();if(!Y(t))throw TypeError("Stringified UUID is invalid");return t}function he(r,e,t){r=r||{};var n=r.random||(r.rng||ts)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){t=t||0;for(var o=0;o<16;++o)e[t+o]=n[o];return e}return ns(n)}class os{constructor(){u(this,"list",[]);u(this,"timer");u(this,"time",0)}exec(e){e(!1)||(this.list.includes(e)||this.list.push(e),this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{for(const t of this.list)t(!0);this.list=[]},this.time))}append(e){this.list.length&&!this.list.includes(e)?this.list.push(e):this.exec(e)}nextTick(e){setTimeout(()=>{e()},this.time)}}const q=new os,D=function(r,e,t={strict:!0,warn:!0}){if(!y[r])return console.error(`type: ${r} can not be found in configList.`),{vid:"",type:r};const n=(a,c)=>{for(const l in c){if(a[l]===void 0){!t.strict&&(a[l]=c[l]),t.strict&&t.warn&&console.warn(`'${r}' config can not set key: ${l}`);continue}typeof c[l]=="object"&&c[l]!==null&&!Array.isArray(c[l])?(a[l]===null&&(a[l]={...c[l]}),n(a[l],c[l])):a[l]=c[l]}};let o=y[r]();[i.SCRIPTANIMATION,i.KEYFRAMEANIMATION].includes(r)&&(t.strict=!1),o.vid===""&&(o.vid=he()),e&&n(o,e),t.handler&&(o=t.handler(o));const s=kn(o);if(D.autoInject&&D.injectEngine){const a=D.injectEngine;if(a.applyConfig(s),D.injectScene&&jo(o.type)&&o.type!==i.SCENE){let c=null;typeof D.injectScene=="boolean"?c=a.getObjectConfig(a.scene):typeof D.injectScene=="string"&&(c=a.getConfigBySymbol(D.injectScene)),c?c.children.push(o.vid):console.warn("current engine scene can not found it config",a,a.scene)}return s}return s};D.autoInject=!0;D.injectScene=!1;D.injectEngine=null;class B{constructor(e,t=[]){u(this,"dataContainer",new Ae);u(this,"translater");this.translater=new Jn().setRule(e),this.dataContainer.subscribe(n=>{this.translater.translate(n)});for(const n of t)this.addConfig(n)}getData(){return this.dataContainer.container}existSymbol(e){return Boolean(this.dataContainer.container[e])}addConfig(e){return this.dataContainer.container[e.vid]=e,this}getConfig(e){return this.dataContainer.container[e]}removeConfig(e){const t=this.dataContainer.container;t[e]!==void 0&&delete t[e]}addCompiler(e){return e.setTarget(this.dataContainer.container),e.compileAll(),this.translater.apply(e),this}toJSON(e=!0){return e?JSON.stringify(this.exportConfig(),Ne):JSON.stringify(Object.values(this.dataContainer.container),Ne)}exportConfig(e=!0){if(e){const t=this.dataContainer.container,n=[],o={},s=(a,c,l={})=>{for(const f in a){if(["vid","type"].includes(f)){l[f]=a[f];continue}if(typeof a[f]=="object"&&a[f]!==null){if(Array.isArray(a[f])){if(!a[f].length)continue;l[f]=a[f].map(g=>typeof g=="object"&&g!==null?tt(g):g);continue}l[f]={},c[f]?(s(a[f],c[f],l[f]),Object.keys(l[f]).length===0&&delete l[f]):l[f]=tt(a[f])}else c[f]!==a[f]&&(l[f]=a[f])}};for(const a of Object.values(t)){if(!o[a.type]){if(!y[a.type]){console.error(`can not font some config with: ${a.type}`);continue}o[a.type]=y[a.type]()}const c={};s(a,o[a.type],c),n.push(c)}return n}else return Object.values(tt(this.dataContainer.container))}load(e){const t=this.dataContainer.container,n={},o=(s,a)=>{for(const c in a)typeof s[c]=="object"&&s[c]!==null&&typeof a[c]=="object"&&a[c]!==null?o(s[c],a[c]):s[c]===void 0&&(s[c]=a[c])};for(const s of e){if(!n[s.type]){if(!y[s.type]){console.error(`can not font some config with: ${s.type}`);continue}n[s.type]=y[s.type]()}o(s,n[s.type]),t[s.vid]=s}return this}remove(e){const t=this.dataContainer.container;for(const n of e)t[n.vid]!==void 0&&delete t[n.vid];return this}getModule(){return this.MODULE}}class ss{constructor(e){u(this,"configType");u(this,"commands");u(this,"create");u(this,"dispose");this.configType=e.configType,this.commands=e.commands,this.create=e.create,this.dispose=e.dispose}process(e){if(!this.commands||!this.commands[e.operate]){this[e.operate](e);return}let t=this.commands[e.operate];for(const n of[].concat(e.path,e.key))if(!t[n]&&!t.$reg){this[e.operate](e);return}else if(t[n])if(typeof t[n]=="function"){t[n](e);return}else t=t[n];else if(t.$reg){for(const o of t.$reg)if(o.reg.test(n)){o.handler(e);return}}this[e.operate](e)}add(e){let t=e.target;const n=e.path;for(const o of n)if(typeof t[o]!==void 0)t=t[o];else{console.warn("processor can not exec default add operate.",e);return}t[e.key]=e.value}set(e){let t=e.target;const n=e.path;for(const o of n)if(typeof t[o]!==void 0)t=t[o];else{console.warn("processor can not exec default set operate.",e);return}t[e.key]=e.value}delete(e){let t=e.target;const n=e.path;for(const o of n)if(typeof t[o]!==void 0)t=t[o];else{console.warn("processor can not exec default delete operate.",e);return}delete t[e.key]}}const h=r=>new ss(r),xe=function(){},K=(r,e,t=Y)=>{const{operate:n,key:o,path:s,value:a}=r;let c=o;const l=s.split(".");if(s.length&&(c=l.shift(),l.pop()),!t(c)){console.warn(`${e.MODULE} Rule: vid is illeage: ${c}`);return}if(n==="add"&&!l.length){e.add(a);return}if(r.operate==="delete"&&!l.length){e.remove(a);return}if(r.operate==="set"&&!l.length&&o===c){e.cover(a);return}e.compile(c,{operate:n,key:o,path:l,value:a})},Z="vis.scriptAni",x=class{static generateConfig(e,t){if(!x.configLibrary.has(e))return console.warn(`event library can not found config by name: ${e}`),{name:""};const n=(s,a)=>{for(const c in a)s[c]!==void 0&&(typeof a[c]=="object"&&a[c]!==null&&!Array.isArray(a[c])?n(s[c],a[c]):s[c]=a[c])},o=JSON.parse(JSON.stringify(x.configLibrary.get(e)));return n(o,t),o}static generateScript(e,t,n,o){return x.generatorLibrary.has(o.name)?x.generatorLibrary.get(o.name)(e,t,n,o):(console.error(`event library can not found generator by name: ${o.name}`),()=>{})}static has(e){return x.configLibrary.has(e)}};let oe=x;u(oe,"configLibrary",new Map),u(oe,"generatorLibrary",new Map),u(oe,"register",function(e,t){x.configLibrary.has(e.name)&&console.warn(`EventLibrary has already exist this event generator: ${e.name}, that will be cover.`),x.configLibrary.set(e.name,JSON.parse(JSON.stringify(e))),x.generatorLibrary.set(e.name,t)});const Ut=function(r,e){let t=e.compilerManager.getObjectBySymbol(r.target);if(!t)return console.warn(`can not found object in enigne: ${r.target}`),()=>{};const n=r.attribute.split(".");n.shift();const o=n.pop();for(const s of n){if(t[s]===void 0)return console.warn(`animaton processor: target object can not found key: ${s}`,t),()=>{};t=t[s]}return oe.generateScript(e,t,o,r.script)};var as=h({configType:i.SCRIPTANIMATION,commands:{set:{play({target:r,engine:e,value:t}){t?e.renderManager.addEventListener("render",r):e.renderManager.removeEventListener("render",r)},$reg:[{reg:new RegExp(".*"),handler({config:r,engine:e}){const t=r[Symbol.for(Z)];e.renderManager.removeEventListener("render",t);const n=Ut(r,e);r[Symbol.for(Z)]=n,r.play&&e.renderManager.addEventListener("render",t)}}]}},create(r,e){const t=Ut(r,e);return r.play&&e.renderManager.addEventListener("render",t),r[Symbol.for(Z)]=t,t},dispose(){}});class is extends d{constructor(){super();u(this,"MODULE",p.ANIMATION)}restoreAttribute(t){if(!t.target||!t.attribute)return this;let n=this.engine.getObjectBySymbol(t.target),o=this.engine.getConfigBySymbol(t.target);(!n||!o)&&console.warn("AnimationCompiler: can not found object target or config in engine",t.vid);const s=t.attribute.split(".");s.shift();const a=s.pop();for(const c of s)if(n[c]&&o[c])n=n[c],o=o[c];else return console.warn("AnimationCompiler: object and config attribute are not sync"),this;return n[a]=o[a],this}cover(t){super.cover(t);const n=this.map.get(t.vid);return t[Symbol.for(Z)]=n,this}remove(t){return this.engine.removeEventListener("render",t[Symbol.for(Z)]),this.restoreAttribute(t),delete t[Symbol.for(Z)],super.remove(t),this}compile(t,n){const o=this.target[t];this.restoreAttribute(o),super.compile(t,n);const s=this.map.get(t),a=o[Symbol.for(Z)];return this.map.set(o.vid,a),this.weakMap.delete(s),this.weakMap.set(a,t),this}}d.processor(as);const cs=function(r,e){r.key==="name"&&r.path.length===1||K(r,e)};class us extends B{constructor(t=[]){super(cs,t);u(this,"MODULE",p.ANIMATION)}}class $ extends d{constructor(){super()}}const I=class{static generateConfig(e,t){if(!I.configLibrary.has(e))return console.warn(`event library can not found config by name: ${e}`),{name:""};const n=(s,a)=>{for(const c in a)typeof a[c]=="object"&&a[c]!==null&&!Array.isArray(a[c])?n(s[c],a[c]):s[c]=a[c]},o=JSON.parse(JSON.stringify(I.configLibrary.get(e)));return n(o,t),o}static generateEvent(e,t){return I.generatorLibrary.has(e.name)?I.generatorLibrary.get(e.name)(t,e):(console.error(`event library can not found generator by name: ${e.name}`),()=>{})}static has(e){return I.configLibrary.has(e)}};let V=I;u(V,"configLibrary",new Map),u(V,"generatorLibrary",new Map),u(V,"register",function(e,t){I.configLibrary.has(e.name)&&console.warn(`EventGeneratorManager has already exist this event generator: ${e.name}, that will be cover.`),I.configLibrary.set(e.name,JSON.parse(JSON.stringify(e))),I.generatorLibrary.set(e.name,t)});const jt=new WeakMap,or=function({target:r,config:e,value:t,engine:n}){if(e.vid===t){console.warn("can not set object lookAt itself.");return}let o=jt.get(r);if(o||(o={lookAtTarget:null,updateMatrixWorldFun:null},jt.set(r,o)),!t){if(!o.updateMatrixWorldFun)return;r.updateMatrixWorld=o.updateMatrixWorldFun,o.lookAtTarget=null,o.updateMatrixWorldFun=null;return}q.exec(s=>{const a=n.compilerManager.getObject3D(t);if(!a)return s&&console.warn(`lookAt handler can not found this vid mapping object: '${t}'`),!1;const c=r.updateMatrixWorld;return o.updateMatrixWorldFun=c,o.lookAtTarget=a.position,r.updateMatrixWorld=l=>{c.call(r,l),r.lookAt(o.lookAtTarget)},!0})},ye="vis.event",j=function({target:r,path:e,value:t,engine:n}){const o=e[0];if(!V.has(t.name)){console.warn(`EventGeneratorManager: can not support this event: ${t.name}`);return}const s=V.generateEvent(t,n),a=Symbol.for(ye);t[a]=s,r.addEventListener(o,s)},k=function({target:r,path:e,value:t}){const n=e[0],o=t[Symbol.for(ye)];if(!o){console.warn("event remove can not fun found event in config",t);return}r.removeEventListener(n,o),delete t[Symbol.for(ye)]},z=function({target:r,config:e,path:t,engine:n}){if(t.length<2)return;const o=t[0],s=e[t[0]][t[1]],a=s[Symbol.for(ye)];if(!a){console.warn("event remove can not fun found event in config",s);return}r.removeEventListener(o,a);const c=V.generateEvent(s,n);s[Symbol.for(ye)]=c,r.addEventListener(o,c)},lt=function({target:r,config:e,value:t,engine:n}){q.exec(o=>{const s=n.getConfigBySymbol(t);if(!s)return o&&console.warn(` can not foud object config in engine: ${t}`),!1;if(s.parent&&s.parent!==e.vid){const c=n.getConfigBySymbol(s.parent);if(!c)return o&&console.warn(` can not foud object parent config in engine: ${s.parent}`),!1;c.children.splice(c.children.indexOf(t),1)}s.parent=e.vid;const a=n.compilerManager.getObject3D(t);return a?(r.add(a),!0):(o&&console.warn(`can not found this vid in engine: ${t}.`),!1)})},ls=function({target:r,config:e,value:t,engine:n}){const o=n.compilerManager.getObject3D(t);if(!o){console.warn(`can not found this vid in engine: ${t}.`);return}r.remove(o);const s=n.getConfigBySymbol(t);if(!s){console.warn(`can not found this vid in engine: ${t}.`);return}s.parent=""},O=function(r,e,t,n){Promise.resolve(),!t.lookAt&&or({target:r,config:e,engine:n,value:e.lookAt}),e.children.forEach(o=>{lt({target:r,config:e,value:o,engine:n})});for(const o of Object.values(Ir))q.nextTick(()=>(e[o].forEach((s,a)=>{j({target:r,path:[o,a.toString()],value:s,engine:n})}),!0));return T(e,r,{vid:!0,type:!0,lookAt:!0,parent:!0,children:!0,pointerdown:!0,pointermove:!0,pointerup:!0,pointerenter:!0,pointerleave:!0,click:!0,dblclick:!0,contextmenu:!0,...t}),r},M=function(r){r._listener={}},m={add:{pointerdown:j,pointerup:j,pointermove:j,pointerenter:j,pointerleave:j,click:j,dblclick:j,contextmenu:j,children:lt},set:{lookAt:or,pointerdown:z,pointerup:z,pointermove:z,pointerenter:z,pointerleave:z,click:z,dblclick:z,contextmenu:z,parent:xe,children:{$reg:[{reg:new RegExp(".*"),handler:lt}]}},delete:{pointerdown:k,pointerup:k,pointermove:k,pointerenter:k,pointerleave:k,click:k,dblclick:k,contextmenu:k,children:ls}};h({configType:i.OBJECT3D,commands:m,create(r,e){return O(new Wt,r,{},e)},dispose:M});const C=new WeakMap;var ps=h({configType:i.PERSPECTIVECAMERA,commands:{add:{scale(){},...m.add},set:{scale(){},adaptiveWindow({target:r,value:e,engine:t}){if(e){if(!C.has(e)){const n=o=>{r.aspect=o.width/o.height,r.updateProjectionMatrix()};C.set(r,n),t.addEventListener("setSize",n),n({type:"setSize",width:t.dom.offsetWidth,height:t.dom.offsetHeight})}}else{const n=C.get(r);n&&(t.removeEventListener("setSize",n),C.delete(r))}},...m.set,$reg:[{reg:new RegExp("fov|aspect|near|far"),handler({target:r,key:e,value:t}){r[e]=t,r.updateProjectionMatrix()}}]},delete:{scale(){},...m.delete}},create(r,e){const t=new Xr;if(O(t,r,{scale:!0,adaptiveWindow:!0},e),t.updateProjectionMatrix(),r.adaptiveWindow){const n=o=>{t.aspect=o.width/o.height,t.updateProjectionMatrix()};C.set(t,n),e.addEventListener("setSize",n),n({type:"setSize",width:e.dom.offsetWidth,height:e.dom.offsetHeight})}return t},dispose(r){C.delete(r),M(r)}}),ds=h({configType:i.ORTHOGRAPHICCAMERA,commands:{add:{scale(){},...m.add},set:{scale(){},adaptiveWindow({target:r,value:e,engine:t}){if(e){if(!C.has(e)){const n=o=>{const s=o.width,a=o.height;r.left=-s,r.right=s,r.top=a,r.bottom=-a,r.updateProjectionMatrix()};C.set(r,n),t.addEventListener("setSize",n),n({type:"setSize",width:t.dom.offsetWidth,height:t.dom.offsetHeight})}}else{const n=C.get(r);n&&(t.removeEventListener("setSize",n),C.delete(r))}},...m.set,$reg:[{reg:new RegExp("left|right|top|bottom|near|far|zoom"),handler({target:r,key:e,value:t}){r[e]=t,r.updateProjectionMatrix()}}]},delete:{scale(){},...m.delete}},create(r,e){const t=new Jr(-50,50,50,-50);if(O(t,r,{scale:!0,adaptiveWindow:!0},e),t.updateProjectionMatrix(),r.adaptiveWindow){const n=o=>{const s=o.width,a=o.height;t.left=-s,t.right=s,t.top=a,t.bottom=-a,t.updateProjectionMatrix()};C.set(t,n),e.addEventListener("setSize",n),n({type:"setSize",width:e.dom.offsetWidth,height:e.dom.offsetHeight})}return t},dispose(r){C.delete(r),M(r)}});class fs extends ${constructor(){super();u(this,"MODULE",p.CAMERA)}}d.processor(ps);d.processor(ds);class F extends B{constructor(t,n=[]){super(t,n);u(this,"MODULE",p.GROUP)}}const w=function(r,e,t=Y){r.key!=="parent"&&K(r,e,t)},hs=function(r,e){w(r,e)};class ms extends F{constructor(t=[]){super(hs,t);u(this,"MODULE",p.CAMERA)}}class gs extends d{constructor(){super();u(this,"MODULE",p.CONTROLS)}}const Es=[G(i.TRNASFORMCONTROLS),G(i.ORBITCONTROLS)],ys=function(r,e){K(r,e,t=>Y(t)||Es.includes(t))};class Ss extends B{constructor(t=[]){super(ys,t);u(this,"MODULE",p.CONTROLS)}}const Nt=function(r,e){const t=e.resourceManager.resourceMap;if(!t.has(r))return console.warn(`css2D compiler: can not found resource element: ${r}`),document.createElement("div");const n=t.get(r);return n instanceof HTMLElement?n:(console.warn("css2D compiler can not suport render this resource type.",n.constructor,r),document.createElement("div"))};var Ms=h({configType:i.CSS2DPLANE,commands:{add:m.add,set:{element({target:r,value:e,engine:t}){r.element.innerHTML="",r.element.appendChild(Nt(e,t))},...m.set},delete:m.delete},create(r,e){return O(new fr(Nt(r.element,e)),r,{element:!0},e)},dispose:M});class Rs extends ${constructor(){super();u(this,"MODULE",p.CSS2D)}}d.processor(Ms);const bs=function(r,e){w(r,e)};class Cs extends F{constructor(t=[]){super(bs,t);u(this,"MODULE",p.CSS2D)}}const ce=function(r,e){const t=e.resourceManager.resourceMap;if(!t.has(r))return console.warn(`css3D compiler: can not found resource element: ${r}`),document.createElement("div");const n=t.get(r);return n instanceof HTMLElement?n:(console.warn("css3D compiler can not suport render this resource type.",n.constructor,r),document.createElement("div"))};var Ts=h({configType:i.CSS3DOBJECT,commands:{add:m.add,set:{element({target:r,value:e,engine:t}){r.element=ce(e,t)},...m.set},delete:m.delete},create(r,e){return O(new hr(ce(r.element,e)),r,{element:!0},e)},dispose:M}),Os=h({configType:i.CSS3DPLANE,commands:{add:m.add,set:{element({target:r,value:e,engine:t}){r.element.innerHTML="",r.element.appendChild(ce(e,t))},...m.set},delete:m.delete},create(r,e){return O(new mr(ce(r.element,e)),r,{element:!0},e)},dispose:M}),vs=h({configType:i.CSS3DSPRITE,commands:{add:m.add,set:{element({target:r,value:e,engine:t}){r.element.innerHTML="",r.element.appendChild(ce(e,t))},...m.set},delete:m.delete},create(r,e){return O(new gr(ce(r.element,e)),r,{element:!0},e)},dispose:M});class Ls extends ${constructor(){super();u(this,"MODULE",p.CSS3D)}}d.processor(Os);d.processor(Ts);d.processor(vs);const ws=function(r,e){w(r,e)};class As extends F{constructor(t=[]){super(ws,t);u(this,"MODULE",p.CSS3D)}}const xs=function(r,e){!(r instanceof Tt)&&!(r instanceof Lt)&&!(r instanceof wt)&&r.center(),r.computeBoundingBox();const t=r.boundingBox,n=e.position,o=e.rotation,s=e.scale,a=new Wr().setFromEuler(new Zr(o.x,o.y,o.z,"XYZ"));return r.applyQuaternion(a),r.scale(s.x,s.y,s.z),!(r instanceof Tt)&&!(r instanceof Lt)&&!(r instanceof wt)&&r.center(),r.computeBoundingBox(),r.translate((t.max.x-t.min.x)/2*n.x,(t.max.y-t.min.y)/2*n.y,(t.max.z-t.min.z)/2*n.z),r},nt={reg:new RegExp(".*"),handler({config:r,target:e,processor:t,engine:n}){const o=t.create(r,n);e.copy(o),e.dispatchEvent({type:"update"}),e.uuid=o.uuid,o.dispose()}},Ye={add:{groups({target:r,value:e}){r.addGroup(e.start,e.count,e.materialIndex)},$reg:[nt]},set:{groups(r){const{path:e,target:t,config:n}=r;if(e[1]!==void 0){t.groups.splice(Number(r.path[1]),1);const o=n.groups[e[1]];t.addGroup(o.start,o.count,o.materialIndex)}else console.warn("geometry processor can not set group",r)},$reg:[nt]},delete:{groups({target:r,key:e}){r.groups.splice(Number(e),1)},$reg:[nt]}},Xe=function(r,e){r.clearGroups();for(const t of e.groups)r.addGroup(t.start,t.count,t.materialIndex);return xs(r,e)},S=new Map;S.set(i.BOXGEOMETRY,r=>new He(r.width,r.height,r.depth,r.widthSegments,r.heightSegments,r.depthSegments));S.set(i.SPHEREGEOMETRY,r=>new _r(r.radius,r.widthSegments,r.heightSegments,r.phiStart,r.phiLength,r.thetaStart,r.thetaLength));S.set(i.PLANEGEOMETRY,r=>new Qr(r.width,r.height,r.widthSegments,r.heightSegments));S.set(i.CIRCLEGEOMETRY,r=>new qr(r.radius,r.segments,r.thetaStart,r.thetaLength));S.set(i.CONEGEOMETRY,r=>new Kr(r.radius,r.height,r.radialSegments,r.heightSegments,r.openEnded,r.thetaStart,r.thetaLength));S.set(i.CYLINDERGEOMETRY,r=>new Fr(r.radiusTop,r.radiusBottom,r.height,r.radialSegments,r.heightSegments,r.openEnded,r.thetaStart,r.thetaLength));S.set(i.LINECURVEGEOMETRY,r=>new Er(r.path.map(e=>new _(e.x,e.y,e.z)),r.divisions,r.space));S.set(i.SPLINECURVEGEOMETRY,r=>new yr(r.path.map(e=>new _(e.x,e.y,e.z)),r.divisions,r.space));S.set(i.CUBICBEZIERCURVEGEOMETRY,r=>new Sr(r.path.map(e=>new _(e.x,e.y,e.z)),r.divisions,r.space));S.set(i.QUADRATICBEZIERCURVEGEOMETRY,r=>new Mr(r.path.map(e=>new _(e.x,e.y,e.z)),r.divisions,r.space));S.set(i.LINETUBEGEOMETRY,r=>new Rr(r.path.map(e=>new _(e.x,e.y,e.z)),r.tubularSegments,r.radius,r.radialSegments,r.closed));S.set(i.SPLINETUBEGEOMETRY,r=>new br(r.path.map(e=>new _(e.x,e.y,e.z)),r.tubularSegments,r.radius,r.radialSegments,r.closed));S.set(i.TORUSGEOMETRY,r=>new en(r.radius,r.tube,r.radialSegments,r.tubularSegments,r.arc));S.set(i.RINGGEOMETRY,r=>new tn(r.innerRadius,r.outerRadius,r.thetaSegments,r.phiSegments,r.thetaStart,r.thetaLength));S.set(i.LINESHAPEGEOMETRY,r=>new Cr(r.path.map(e=>new rn(e.x,e.y)),r.curveSegments));const Is=function(r){return S.has(r.type)?Xe(S.get(r.type)(r),r):(console.error(`parametric geometry can not support this type config: ${r.type}`),new Be)},Ds=function(r){r.dispose()},Ps=function(r){return h({configType:r,commands:Ye,create:Is,dispose:Ds})},Gs=[i.BOXGEOMETRY,i.SPHEREGEOMETRY,i.PLANEGEOMETRY,i.CIRCLEGEOMETRY,i.CONEGEOMETRY,i.CYLINDERGEOMETRY,i.LINECURVEGEOMETRY,i.SPLINECURVEGEOMETRY,i.CUBICBEZIERCURVEGEOMETRY,i.QUADRATICBEZIERCURVEGEOMETRY,i.LINETUBEGEOMETRY,i.SPLINETUBEGEOMETRY,i.TORUSGEOMETRY,i.RINGGEOMETRY,i.LINESHAPEGEOMETRY],Us=Gs.map(r=>Ps(r));var js=h({configType:i.LOADGEOMETRY,commands:Ye,create(r,e){const t=e.resourceManager.resourceMap.get(r.url);return!t&&!(t instanceof Be)?(console.error(`engine rescoure can not found url: ${r.url}`),new He(5,5,5)):Xe(new Tr(t),r)},dispose(r){r.dispose()}});const Ns=function(r){const e=new Be;return r.position.length&&e.setAttribute("position",new fe(r.position,3)),r.color.length&&e.setAttribute("color",new fe(r.color,3)),r.normal.length&&e.setAttribute("normal",new fe(r.normal,3)),r.uv.length&&e.setAttribute("uv",new fe(r.uv,2)),r.uv2.length&&e.setAttribute("uv2",new fe(r.uv2,2)),r.index.length&&e.setIndex(r.index),e};var Hs=h({configType:i.CUSTOMGEOMETRY,commands:Ye,create(r){return Xe(Ns(r.attribute),r)},dispose(r){r.dispose()}}),Bs=h({configType:i.EDGESGEOMETRY,commands:Ye,create(r,e){const t=e.compilerManager.getObjectBySymbol(r.url);return!t||!(t instanceof Be)?(console.error(`engine rescoure can not found url: ${r.url}`),new At(new He(5,5,5))):Xe(new At(t),r)},dispose(r){r.dispose()}});class $s extends d{constructor(){super();u(this,"MODULE",p.GEOMETRY)}}Us.forEach(r=>{d.processor(r)});d.processor(js);d.processor(Hs);d.processor(Bs);const ks=function(r,e){K(r,e)};class zs extends B{constructor(t=[]){super(ks,t);u(this,"MODULE",p.GEOMETRY)}}const Vs=function({target:r,value:e}){r.color.copy(new P(e))},le=function(r,e,t,n){return r.color.copy(new P(e.color)),O(r,e,{color:!0,scale:!0,rotation:!0,lookAt:!0,...t},n)},pe=Object.assign({},m,{set:{color:Vs,scale:xe,rotation:xe,lookAt:xe}});var Ys=h({configType:i.AMBIENTLIGHT,commands:pe,create(r,e){return le(new nn,r,{},e)},dispose:M}),Xs=h({configType:i.DIRECTIONALLIGHT,commands:pe,create(r,e){return le(new on,r,{},e)},dispose:M}),Js=h({configType:i.POINTLIGHT,commands:pe,create(r,e){return le(new sn,r,{},e)},dispose:M}),Ws=h({configType:i.SPOTLIGHT,commands:pe,create(r,e){return le(new an,r,{},e)},dispose:M}),Zs=h({configType:i.HEMISPHERELIGHT,commands:{set:{...pe.set,groundColor:function({target:r,value:e}){r.groundColor.copy(new P(e))}}},create(r,e){const t=new cn;return t.groundColor.copy(new P(r.groundColor)),le(t,r,{groundColor:!0},e)},dispose:M}),_s=h({configType:i.RECTAREALIGHT,commands:pe,create(r,e){return le(new un,r,{},e)},dispose:M});class Qs extends ${constructor(){super();u(this,"MODULE",p.LIGHT)}}d.processor(Ys);d.processor(Xs);d.processor(Js);d.processor(Ws);d.processor(Zs);d.processor(_s);const qs=function(r,e){w(r,e)};class Ks extends F{constructor(t=[]){super(qs,t);u(this,"MODULE",p.LIGHT)}}class Je extends ${constructor(){super();u(this,"MODULE",p.MESH)}}const Le=new Zt({fragmentShader:`
  void main () {
    gl_FragColor = vec4(0.5, 0.5, 0.5, 1.0);
  }
  `}),Fs=new He(10,10,10),sr=function({target:r,value:e,engine:t}){q.exec(n=>{const o=t.compilerManager.getGeometry(e);return o?(r.geometry=o,!0):(n&&console.warn(`can not found geometry by vid in engine: ${e}`),r.geometry=Fs,!1)})},Ie=function({target:r,config:e,engine:t}){q.exec(n=>{let o;return typeof e.material=="string"?o=t.compilerManager.getMaterial(e.material)||Le:o=e.material.map(s=>t.compilerManager.getMaterial(s)||Le),r.material=o,!(Array.isArray(o)&&o.length&&o[0]===Le||o===Le)})},We=function(r,e,t,n){return t.geometry||(r.geometry.dispose(),sr({target:r,value:e.geometry,engine:n})),t.material||Ie({target:r,config:e,engine:n}),O(r,e,{geometry:!0,material:!0,...t},n)},Ze=function(r){M(r)},ie={add:{material:Ie,...m.add},set:{geometry:sr,material:Ie,...m.set},delete:{material:Ie,...m.delete}};var ea=h({configType:i.LINE,commands:ie,create(r,e){return We(new ln,r,{},e)},dispose:Ze});class ta extends Je{constructor(){super();u(this,"MODULE",p.LINE)}}d.processor(ea);class _e extends B{constructor(t,n=[]){super(t,n);u(this,"MODULE",p.MESH)}}const ra=function(r,e){w(r,e)};class na extends _e{constructor(t=[]){super(ra,t);u(this,"MODULE",p.LINE)}}const X={reg:new RegExp("transparent|sizeAttenuation"),handler({target:r,key:e,value:t}){r[e]=t,r.needsUpdate=!0}},ar=function({target:r,key:e,value:t,engine:n}){q.exec(o=>{const s=n.compilerManager.getObjectBySymbol(t);return s instanceof me?(r[e]=s,r.needsUpdate=!0,!0):(o&&console.warn(`this url resource is not instance of Texture: ${e}`,t,s),r[e]=null,!1)})},ee={reg:new RegExp("map$","i"),handler:ar},b=function({target:r,key:e,value:t}){r[e].copy(new P(t))},te=function(r,e,t){const n={};for(const o of Object.keys(e))o.toLocaleLowerCase().endsWith("map")&&e[o]?(ar({target:r,key:o,value:e[o],engine:t}),n[o]=!0):r[o]instanceof P&&(r[o]=new P(e[o]),n[o]=!0);return T(e,r,n),r.needsUpdate=!0,r},J=function(r){r.dispose()};var ir=h({configType:i.LINEBASICMATERIAL,commands:{set:{color:b,$reg:[ee,X]}},create:function(r,e){return te(new pn,r,e)},dispose:J}),oa=h({configType:i.MESHBASICMATERIAL,commands:{set:{color:b,$reg:[ee,X]}},create:function(r,e){return te(new dn,r,e)},dispose:J}),sa=h({configType:i.MESHPHONGMATERIAL,commands:{set:{color:b,emissive:b,specular:b,$reg:[ee,X]}},create:function(r,e){return te(new fn,r,e)},dispose:J}),aa=h({configType:i.MESHPHYSICALMATERIAL,commands:{set:{color:b,emissive:b,specularColor:b,sheenColor:b,attenuationColor:b,$reg:[ee,X]}},create:function(r,e){return te(new hn,r,e)},dispose:J}),ia=h({configType:i.MESHSTANDARDMATERIAL,commands:{set:{color:b,emissive:b,$reg:[ee,X]}},create:function(r,e){return te(new mn,r,e)},dispose:J}),ca=h({configType:i.POINTSMATERIAL,commands:{set:{color:b,$reg:[ee,X]}},create:function(r,e){return te(new gn,r,e)},dispose:J});const N=class{static getShader(e){return N.library.has(e)?N.cloneShader(N.library.get(e)):(console.warn(`con not found shader in shader library: ${e}`),null)}static generateConfig(e){if(!N.library.has(e))return console.warn(`con not found shader in shader library: ${e}`),{};const t=N.library.get(e),n={shader:e,uniforms:{}};return t.uniforms&&(n.uniforms=JSON.parse(JSON.stringify(t.uniforms))),n}static cloneShader(e){const t={name:e.name};return e.vertexShader&&(t.vertexShader=e.vertexShader),e.fragmentShader&&(t.fragmentShader=e.fragmentShader),e.uniforms&&(t.uniforms=JSON.parse(JSON.stringify(e.uniforms))),t}};let se=N;u(se,"library",new Map),u(se,"reigster",function(e){N.library.has(e.name)&&console.warn(`shader library has exist shader: ${e.name} that will be cover.`),N.library.set(e.name,e)});var ua=h({configType:i.SHADERMATERIAL,commands:{set:{shader({target:r,value:e}){const t=se.getShader(e);t!=null&&t.vertexShader&&(r.vertexShader=t.vertexShader),t!=null&&t.fragmentShader&&(r.fragmentShader=t.fragmentShader),t!=null&&t.uniforms&&(r.uniforms=t.uniforms),t!=null&&t.defines&&(r.defines=t.defines),r.needsUpdate=!0},$reg:[X]}},create:function(r,e){const t=new Zt,n=se.getShader(r.shader);return n!=null&&n.vertexShader&&(t.vertexShader=n.vertexShader),n!=null&&n.fragmentShader&&(t.fragmentShader=n.fragmentShader),n!=null&&n.uniforms&&(t.uniforms=n.uniforms),n!=null&&n.defines&&(t.defines=n.defines),T(r,t,{type:!0,shader:!0}),t.needsUpdate=!0,t},dispose:J}),la=h({configType:i.SPRITEMATERIAL,commands:{set:{color:b,$reg:[ee,X]}},create:function(r,e){return te(new Pe,r,e)},dispose:J});class pa extends d{constructor(){super();u(this,"MODULE",p.MATERIAL)}}d.processor(oa);d.processor(ia);d.processor(sa);d.processor(ir);d.processor(ca);d.processor(la);d.processor(ir);d.processor(ua);d.processor(aa);const da=function(r,e){K(r,e)};class fa extends B{constructor(t=[]){super(da,t);u(this,"MODULE",p.MATERIAL)}}var ha=h({configType:i.MESH,commands:ie,create(r,e){return We(new En,r,{},e)},dispose:Ze});class ma extends Je{constructor(){super();u(this,"MODULE",p.MESH)}}d.processor(ha);const ga=function(r,e){w(r,e)};class Ea extends _e{constructor(t=[]){super(ga,t);u(this,"MODULE",p.MESH)}}var ya=h({configType:i.OBJECT3D,commands:m,create(r,e){return O(new Wt,r,{},e)},dispose:M});class Sa extends ${constructor(){super();u(this,"MODULE",p.OBJECT3D)}}d.processor(ya);const Ma=function(r,e){w(r,e)};class Ra extends F{constructor(t=[]){super(Ma,t);u(this,"MODULE",p.OBJECT3D)}}var ba=h({configType:i.POINTS,commands:ie,create(r,e){return We(new yn,r,{},e)},dispose:Ze});class Ca extends Je{constructor(){super();u(this,"MODULE",p.POINTS)}}d.processor(ba);const Ta=function(r,e){w(r,e)};class Oa extends _e{constructor(t=[]){super(Ta,t);u(this,"MODULE",p.POINTS)}}class va extends d{constructor(){super();u(this,"MODULE",p.RENDERER)}}const La=[G(i.WEBGLRENDERER),G(i.CSS3DRENDERER)],wa=function(r,e){K(r,e,t=>Y(t)||La.includes(t))};class Aa extends B{constructor(t=[]){super(wa,t);u(this,"MODULE",p.RENDERER)}}const Ht=function(r,e,t){if(!e){r.background=null;return}if(Y(e)){const n=t.compilerManager.getTexture(e);n?r.background=n:console.warn(`engine can not found this vid texture : '${e}'`)}else r.background=new P(e)},Bt=function(r,e,t){if(!e){r.environment=null;return}if(Y(e)){const n=t.compilerManager.getTexture(e);n?r.environment=n:console.warn(`engine can not found this vid texture : '${e}'`)}else console.warn(`scene environment is illeage: ${e}`)};var xa=h({configType:i.SCENE,commands:{add:m.add,set:{...m.set,lookAt(){},fog({target:r,config:e,key:t,value:n}){const o=e.fog;o.type?o.type==="Fog"?!r.fog||!(r.fog instanceof qe)?r.fog=new qe(o.color,o.near,o.far):t==="color"?r.fog.color.copy(new P(o.color)):r.fog[t]&&(r.fog[t]=n):o.type==="FogExp2"&&(!r.fog||!(r.fog instanceof Ke)?r.fog=new Ke(o.color,o.density):t==="color"?r.fog.color.copy(new P(o.color)):r.fog[t]&&(r.fog[t]=n)):r.fog=null},background({target:r,value:e,engine:t}){Ht(r,e,t)},environment({target:r,value:e,engine:t}){Bt(r,e,t)}},delete:m.delete},create(r,e){const t=new Sn;if(Ht(t,r.background,e),Bt(t,r.environment,e),r.fog.type){const n=r.fog;n.type==="Fog"?t.fog=new qe(n.color,n.near,n.far):n.type==="FogExp2"?t.fog=new Ke(n.color,n.density):console.warn(`scene processor can not support this type fog:'${r.type}'`)}return O(t,r,{lookAt:!0,background:!0,environment:!0,fog:!0},e)},dispose:M});class Ia extends ${constructor(){super();u(this,"MODULE",p.SCENE)}}d.processor(xa);const Da=function(r,e){w(r,e,t=>Y(t)||[G(i.SCENE)].includes(t))};class Pa extends F{constructor(t=[]){super(Da,t);u(this,"MODULE",p.SCENE)}}const $t=new Pe({color:"rgb(123, 123, 123)"});var Ga=h({configType:i.SPRITE,commands:{add:ie.add,set:{lookAt(){},...ie.set,material({target:r,engine:e,value:t}){const n=e.compilerManager.getMaterial(t);n&&n instanceof Pe?r.material=n:r.material=$t}},delete:ie.add},create(r,e){const t=new Mn,n=e.compilerManager.getMaterial(r.material);return n&&n instanceof Pe?t.material=n:t.material=$t,We(t,r,{geometry:!0,material:!0,lookAt:!0},e)},dispose:Ze});class Ua extends Je{constructor(){super();u(this,"MODULE",p.SPRITE)}}d.processor(Ga);const ja=function(r,e){r.key!=="geometry"&&w(r,e)};class Na extends _e{constructor(t=[]){super(ja,t);u(this,"MODULE",p.SPRITE)}}const Qe={reg:new RegExp("wrapS|wrapT|format|encoding|anisotropy|magFilter|minFilter|mapping"),handler({target:r,key:e,value:t}){r[e]=t,r.needsUpdate=!0}},ue=function({target:r,value:e,engine:t}){q.exec(n=>(r.image=t.compilerManager.getCompiler(p.TEXTURE).getResource(e,[HTMLImageElement,HTMLVideoElement,HTMLCanvasElement]),r.needsUpdate=!0,r.images!==ge.replaceImage))};var Ha=h({configType:i.IMAGETEXTURE,commands:{set:{url:ue,$reg:[Qe]}},create(r,e){const t=new Or;return r.url&&ue({target:t,value:r.url,engine:e}),T(r,t,{type:!0,url:!0}),t.needsUpdate=!0,t},dispose(r){r.dispose()}}),Ba=h({configType:i.CANVASTEXTURE,commands:{set:{url:ue,$reg:[Qe]}},create(r,e){const t=new Rn(e.compilerManager.getCompiler(p.TEXTURE).getResource(r.url,HTMLCanvasElement));return ue({target:t,value:r.url,engine:e}),T(r,t,{type:!0,url:!0}),t.needsUpdate=!0,t},dispose(r){r.dispose()}});const W=[HTMLImageElement,HTMLVideoElement,HTMLCanvasElement],ne=function({target:r,index:e,value:t,engine:n}){r.images[e]=n.compilerManager.textureCompiler.getResource(t,W),r.needsUpdate=!0};var $a=h({configType:i.CUBETEXTURE,commands:{set:{cube:{px({target:r,value:e,engine:t}){ne({target:r,value:e,engine:t,index:0})},nx({target:r,value:e,engine:t}){ne({target:r,value:e,engine:t,index:1})},py({target:r,value:e,engine:t}){ne({target:r,value:e,engine:t,index:2})},ny({target:r,value:e,engine:t}){ne({target:r,value:e,engine:t,index:3})},pz({target:r,value:e,engine:t}){ne({target:r,value:e,engine:t,index:4})},nz({target:r,value:e,engine:t}){ne({target:r,value:e,engine:t,index:5})}}}},create(r,e){const t=new bn,n=r.cube,o=e.compilerManager.getCompiler(p.TEXTURE),s=[o.getResource(n.px,W),o.getResource(n.nx,W),o.getResource(n.py,W),o.getResource(n.ny,W),o.getResource(n.pz,W),o.getResource(n.nz,W)];return t.image=s,T(r,t,{type:!0,cube:!0}),t.needsUpdate=!0,t},dispose(r){r.dispose()}}),ka=h({configType:i.VIDEOTEXTURE,commands:{set:{url:ue,$reg:[Qe]}},create(r,e){const t=new vr(document.createElement("video"));return r.url&&ue({target:t,value:r.url,engine:e}),T(r,t,{type:!0,url:!0}),t.needsUpdate=!0,t},dispose(r){r.dispose()}}),za=h({configType:i.LOADTEXTURE,commands:{set:{url({}){},$reg:[Qe]}},create(r,e){let t;const n=e.compilerManager.getCompiler(p.TEXTURE).getResource(r.url,me);if(n instanceof me)t=new Ot(n);else{const o=new me(n);t=new Ot(o)}return T(r,t,{type:!0,url:!0}),t.needsUpdate=!0,t},dispose(r){r.dispose()}});const Ee=class extends d{constructor(){super();u(this,"MODULE",p.TEXTURE)}getResource(t,n){const o=this.engine.resourceManager.resourceMap;if(!o.has(t))return console.warn(`engine resourceManager can not found this url: ${t}`),Ee.replaceImage;const s=o.get(t);if(Array.isArray(n)){for(const a of n)if(s instanceof a)return s;return console.warn(`this url mapping resource is not a texture image class: ${t}`,s),Ee.replaceImage}else return s instanceof n?s:(console.warn(`this url mapping resource is not a texture image class: ${t}`,s),Ee.replaceImage)}};let ge=Ee;u(ge,"replaceImage",new Tn({width:512,height:512}).draw(t=>{t.translate(256,256),t.font="72px",t.fillStyle="white",t.fillText("\u6682\u65E0\u56FE\u7247",0,0)}).getDom());d.processor(Ha);d.processor(Ba);d.processor($a);d.processor(ka);d.processor(za);const Va=function(r,e){K(r,e)};class Ya extends B{constructor(t=[]){super(Va,t);u(this,"MODULE",p.TEXTURE)}}var Xa=h({configType:i.GROUP,commands:m,create(r,e){return O(new Cn,r,{},e)},dispose:M});class Ja extends ${constructor(){super();u(this,"MODULE",p.GROUP)}}d.processor(Xa);const Wa=function(r,e){w(r,e)};class Za extends F{constructor(t=[]){super(Wa,t);u(this,"MODULE",p.GROUP)}}class _a{constructor(e){u(this,"dataSupportMap",new Map);[new Ra,new ms,new Ks,new zs,new Ya,new fa,new Aa,new Pa,new Ss,new Na,new na,new Ea,new Oa,new Za,new As,new Cs,new us].forEach(t=>{this.dataSupportMap.set(t.MODULE,t)}),e&&Object.keys(e).forEach(t=>{this[t]!==void 0&&(this[t]=e[t])}),Object.keys(this).forEach(t=>{const n=this[t];n instanceof B&&this.dataSupportMap.set(n.MODULE,n)})}extend(e){this.dataSupportMap.has(e.MODULE)&&console.warn("dataSupport manager has exist this compiler, that will cover",e),this.dataSupportMap.set(e.MODULE,e)}getDataSupport(e){return this.dataSupportMap.has(e)?this.dataSupportMap.get(e):(console.warn(`can not found this type in dataSupportManager: ${e}`),null)}getConfigBySymbol(e){const t=this.dataSupportMap.values();for(const n of t){const o=n.getConfig(e);if(o)return o}return null}removeConfigBySymbol(...e){const t=this.dataSupportMap.values();for(const n of e)for(const o of t)if(o.existSymbol(n)){o.removeConfig(n);break}return this}getModuleBySymbol(e){const t=this.dataSupportMap.values();for(const n of t)if(n.existSymbol(e))return n.MODULE;return null}applyConfig(...e){for(const t of e){const n=ht(t.type);n?this.dataSupportMap.get(n).addConfig(t):console.warn(`dataSupportManager can not found this config module: ${t.type}`)}return this}load(e){return this.dataSupportMap.forEach((n,o)=>{e[o]&&n.load(e[o])}),this}remove(e){return this.dataSupportMap.forEach((n,o)=>{e[o]&&n.remove(e[o])}),this}toJSON(e={},t=!0){return JSON.stringify(this.exportConfig(e,t),Ne)}exportConfig(e={},t=!0){return this.dataSupportMap.forEach((o,s)=>{e[s]=o.exportConfig(t)}),e}}const gt="DataSupportManagerPlugin",Qa=function(r){return{name:gt,install(e){const t=new _a(r);e.dataSupportManager=t,e.applyConfig=function(...n){return t.applyConfig(...n),e},e.getConfigBySymbol=function(n){return t.getConfigBySymbol(n)},e.removeConfigBySymbol=function(...n){return t.removeConfigBySymbol(...n),e},e.toJSON=function(){return t.toJSON()},e.exportConfig=function(){return t.exportConfig()}},dispose(e){delete e.dataSupportManager,delete e.applyConfig,delete e.getConfigBySymbol,delete e.removeConfigBySymbol,delete e.toJSON,delete e.exportConfig}}};class re{}class be extends re{constructor(){super(...arguments);u(this,"selector",(t,n,o)=>n.isObject3D&&o.get(be)||null)}parse(t){this.parseObject3D(t)}parseColor(t){return`rgb(${Math.round(255*t.r)}, ${Math.round(255*t.g)}, ${Math.round(255*t.b)})`}attributeEnhance(t){const n={};for(const o in t)o.startsWith("_")?n[o.slice(1)]=t[o]:n[o]=t[o];return n}parseTexture({url:t,resource:n,configMap:o,resourceMap:s}){s.set(t,n);const a=y[i.LOADTEXTURE]();o.set(t,a),a.vid=he(),a.url=t,T(n,a,{type:!0,vid:!0,url:!0})}parseMaterial({url:t,resource:n,configMap:o,resourceMap:s}){if(s.set(t,n),!y[n.type]){console.warn("can not found support config in vis for this resource",n);return}const a=y[n.type]();o.set(t,a),a.vid=he(),T(this.attributeEnhance(n),a,{type:!0,vid:!0});for(const c in n)if(!!n[c]){if(n[c].isColor)a[c]=this.parseColor(n[c]);else if(c.toLocaleLowerCase().endsWith("map")&&n[c]){const l=`${t}.${c}`;this.parseTexture({url:l,resource:n[c],configMap:o,resourceMap:s}),a[c]=o.get(l).vid}}}parseGeometry({url:t,resource:n,configMap:o,resourceMap:s}){s.set(t,n),n.computeBoundingBox();const a=n.boundingBox,c=a.getCenter(new _),l=y[i.LOADGEOMETRY]();l.vid=he(),l.url=t,l.position.x=c.x/(a.max.x-a.min.x)*2,l.position.y=c.y/(a.max.y-a.min.y)*2,l.position.z=c.z/(a.max.z-a.min.z)*2,o.set(t,l)}parseObject3D({url:t,resource:n,configMap:o,resourceMap:s}){if(s.set(t,n),!y[n.type]){console.warn("can not found support config in vis for this resource",n);return}const a=y[n.type]();if(a.vid=he(),T(n,a,{type:!0,vid:!0,children:!0,geometry:!0,material:!0,parent:!0,lookAt:!0}),a.rotation.x=n.rotation.x,a.rotation.y=n.rotation.y,a.rotation.z=n.rotation.z,o.set(t,a),n.material)if(Array.isArray(n.material))a.material=[],n.material.forEach((c,l,f)=>{const g=`${t}.material.${l}`;this.parseMaterial({url:g,resource:c,configMap:o,resourceMap:s}),a.material.push(o.get(g).vid)});else{const c=`${t}.material`;this.parseMaterial({url:c,resource:n.material,configMap:o,resourceMap:s}),a.material=o.get(c).vid}if(n.geometry){const c=`${t}.geometry`;this.parseGeometry({url:c,resource:n.geometry,configMap:o,resourceMap:s}),a.geometry=o.get(c).vid}n.children&&n.children.length&&n.children.forEach((c,l,f)=>{const g=`${t}.children.${l}`;this.parseObject3D({url:g,resource:c,configMap:o,resourceMap:s}),a.children.push(o.get(g).vid)})}}const qa=new be;class Ka extends be{constructor(){super()}}class Et extends re{constructor(){super();u(this,"object3DParser",qa);u(this,"selector",(t,n,o)=>n.parser&&n.animations&&n.scene&&n.scenes&&o.get(Et)||null)}parse({url:t,resource:n,configMap:o,resourceMap:s}){this.object3DParser.parse({url:`${t}.scene`,resource:n.scene,configMap:o,resourceMap:s})}}class yt extends re{constructor(){super(...arguments);u(this,"selector",(t,n,o)=>n instanceof HTMLCanvasElement&&o.get(yt)||null)}parse({url:t,resource:n,configMap:o,resourceMap:s}){const a=y[i.CANVASTEXTURE]();a.url=t,s.set(t,n),o.set(t,a)}}class St extends re{constructor(){super(...arguments);u(this,"selector",(t,n,o)=>n instanceof HTMLElement&&o.get(St)||null)}parse({url:t,resource:n,configMap:o,resourceMap:s}){const a=y[i.CSS3DPLANE]();a.element=t,s.set(t,n),o.set(t,a)}}class Mt extends re{constructor(){super(...arguments);u(this,"selector",(t,n,o)=>n instanceof HTMLImageElement&&o.get(Mt)||null)}parse({url:t,resource:n,configMap:o,resourceMap:s}){const a=y[i.IMAGETEXTURE]();a.url=t,s.set(t,n),o.set(t,a)}}class Rt extends re{constructor(){super(...arguments);u(this,"selector",(t,n,o)=>n instanceof HTMLVideoElement&&o.get(Rt)||null)}parse({url:t,resource:n,configMap:o,resourceMap:s}){const a=y[i.VIDEOTEXTURE]();a.url=t,s.set(t,n),o.set(t,a)}}class bt extends re{constructor(){super(...arguments);u(this,"selector",(t,n,o)=>n instanceof me&&o.get(bt)||null)}parse({url:t,resource:n,configMap:o,resourceMap:s}){const a=y[i.LOADTEXTURE]();a.url=t,s.set(t,n),o.set(t,a)}}var ae;(function(r){r.MAPPED="mapped"})(ae||(ae={}));class Fa extends kt{constructor(t={}){super();u(this,"configMap",new Map);u(this,"resourceMap",new Map);u(this,"paserMap",new Map);this.addParser(new Mt).addParser(new yt).addParser(new Rt).addParser(new be).addParser(new St).addParser(new bt).addParser(new Et).addParser(new Ka);const n=new Map;for(const o in t)n.has(o)&&console.warn(`resourceManager construct params rescource already exist: ${o}, that will be cover.`),n.set(o,t[o]);this.mappingResource(n)}addParser(t){return this.paserMap.has(t.constructor)?this:(this.paserMap.set(t.constructor,t),this)}mappingResource(t,n){const o=this.configMap,s=this.resourceMap,a=[...this.paserMap.values()],c={};for(const[l,f]of t.entries()){if((n==null?void 0:n.parser)&&n.parser[l]){n.parser[l].parse({url:l,resource:f,configMap:o,resourceMap:s});continue}if((n==null?void 0:n.selector)&&n.selector[l]){const A=n.selector[l](l,f,this.paserMap);if(!A){console.warn("resource manager hanlder can not found this resource parser: ",f,n.selector[l]);continue}A.parse({url:l,resource:f,configMap:o,resourceMap:s}),c[l]=this.getResourceConfig(l);continue}let g=null;for(const A of a)if(g=A.selector(l,f,this.paserMap),g)break;if(!g){console.warn("resouce manager can not found some handler to parser this resource:",f);continue}g.parse({url:l,resource:f,configMap:o,resourceMap:s}),c[l]=this.getResourceConfig(l)}return this.dispatchEvent({type:"mapped",configMap:o,resourceMap:s,resourceConfig:c}),this}getResourceConfig(t){const n=this.configMap,o={};return[...n.keys()].filter(s=>s.startsWith(t)).forEach(s=>{const a=n.get(s);if(!a)console.error(`unknow error: can not found config by url: ${s}`);else{const c=ht(a.type);c?(!o[c]&&(o[c]=[]),o[c].push(a)):console.error(`unknow error: can not found module by type: ${a.type}`,a)}}),o}hasResource(t){return this.resourceMap.has(t)}remove(t){const n=this.configMap,o=this.resourceMap;return[...n.keys()].filter(s=>s.startsWith(t)).forEach(s=>{n.delete(s);const a=o.get(s);a.dispose&&a.dispose(),o.delete(s)}),this}dispose(){this.resourceMap.forEach((t,n)=>{t.dispose&&t.dispose()}),this.resourceMap.clear(),this.configMap.clear()}}const cr="ResourceManagerPlugin",ei=function(r){return{name:cr,install(e){const t=new Fa(r.resources);e.resourceManager=t,e.registerResources=n=>{const o=new Map;return Object.keys(n).forEach(s=>{o.set(s,n[s])}),t.mappingResource(o),e}},dispose(e){e.addEventListener(Lr.DISPOSE,()=>{e.resourceManager.dispose()})}}},ti="LoaderDataSupportStrategy",ri=function(){let r,e;return{name:ti,condition:[gt,zt],exec(t){r=t.toJSON,t.toJSON=function(){const n={assets:JSON.parse(t.loaderManager.toJSON())};return t.dataSupportManager.toJSON(n)},e=t.exportConfig,t.exportConfig=function(){let n={};return n={assets:t.loaderManager.exportConfig()},t.dataSupportManager.exportConfig(n)}},rollback(t){t.toJSON=r,t.exportConfig=e}}},ni="LoaderMappingStrategy",oi=function(){let r,e;return{name:ni,condition:[cr,zt],exec(t){r=t.loadResources,t.loadResources=(n,o)=>{const s=a=>{o(void 0,a),t.resourceManager.removeEventListener(ae.MAPPED,s)};try{t.resourceManager.addEventListener(ae.MAPPED,s)}catch(a){o(a)}return t.loaderManager.load(n),t},e=t.loadResourcesAsync,t.loadResourcesAsync=n=>new Promise((o,s)=>{const a=c=>{o(c),t.resourceManager.removeEventListener(ae.MAPPED,a)};try{t.resourceManager.addEventListener(ae.MAPPED,a)}catch(c){s(c)}t.loaderManager.load(n)})},rollback(t){t.loadResources=r,t.loadResourcesAsync=e}}};class si extends kt{constructor(t){super();u(this,"compilerMap",new Map);[new Sa,new fs,new Qs,new $s,new ge,new pa,new va,new Ia,new gs,new Ua,new ta,new ma,new Ca,new Ja,new Ls,new Rs,new is].forEach(n=>{this.compilerMap.set(n.MODULE,n)}),t&&Object.keys(t).forEach(n=>{this.compilerMap.set(t[n].MODULE,t[n])})}extend(t){this.compilerMap.has(t.MODULE)&&console.warn("compiler manager has exist this compiler, that will cover",t),this.compilerMap.set(t.MODULE,t)}getCompiler(t){return this.compilerMap.has(t)?this.compilerMap.get(t):(console.warn(`can not found this type in compiler manager: ${t}`),null)}getObjectSymbol(t){for(const n of this.compilerMap.values()){const o=n.getObjectSymbol(t);if(o)return o}return null}getObjectBySymbol(t){for(const n of this.compilerMap.values()){const o=n.getObjectBySymbol(t);if(o)return o}return null}getObject3D(t){for(const n of this.compilerMap.values())if(n instanceof $&&n.map.has(t))return n.map.get(t);return null}getMaterial(t){return this.compilerMap.get(p.MATERIAL).map.get(t)}getTexture(t){return this.compilerMap.get(p.TEXTURE).map.get(t)}getGeometry(t){return this.compilerMap.get(p.GEOMETRY).map.get(t)}dispose(){for(const t of this.compilerMap.values())t.dispose();return this.compilerMap.clear(),this}}const ur="CompilerManagerPlugin",ai=function(r){return{name:ur,install(e){const t=new si(r);e.compilerManager=t,e.getObjectSymbol=function(n){return t.getObjectSymbol(n)},e.getObjectBySymbol=function(n){return t.getObjectBySymbol(n)}},dispose(e){e.compilerManager.dispose(),delete e.compilerManager,delete e.getObjectSymbol,delete e.getObjectBySymbol}}},ii="CompilerSupportStrategy",ci=function(){return{name:ii,condition:[ur,gt],exec(r){r.compilerManager.compilerMap.forEach((e,t)=>{var n;e.useEngine(r),(n=r.dataSupportManager.dataSupportMap.get(t))==null||n.addCompiler(e)})},rollback(){}}};class yi extends wr{constructor(e={},t={}){super(),this.install(Ar()).install(xr()).install(Dr()).install(Pr()).install(ei({resources:t})).install(Qa(e)).install(ai()),this.exec(ri()).exec(oi()).exec(ci())}loadLifeCycle(e){const t=this.dataSupportManager;e.texture&&t.load({texture:e.texture}),e.material&&t.load({material:e.material}),delete e.texture,delete e.material,t.load(e)}removeLifeCycle(e){const t=this.dataSupportManager,n=e[p.TEXTURE]||[],o=e[p.MATERIAL]||[],s=e.assets||[];delete e.texture,delete e.material,delete e.assets,t.remove(e),t.remove({[p.MATERIAL]:o}),t.remove({[p.TEXTURE]:n});const a=this.resourceManager,c=this.loaderManager;s.forEach(l=>{a.remove(l),c.remove(l)})}loadConfig(e,t){const n=this.renderManager.hasRendering();if(n&&this.renderManager.stop(),e.assets&&e.assets.length){const o=s=>{delete e.assets,this.loadLifeCycle(e),this.resourceManager.removeEventListener("mapped",o),t&&t(s),n?this.renderManager.play():this.renderManager.render()};this.resourceManager.addEventListener("mapped",o),this.loaderManager.reset().load(e.assets)}else this.loadLifeCycle(e),t&&t(),n?this.renderManager.play():this.renderManager.render();return this}loadConfigAsync(e){return new Promise((t,n)=>{const o=this.renderManager.hasRendering();if(o&&this.renderManager.stop(),e.assets&&e.assets.length){const s=a=>{delete e.assets,this.loadLifeCycle(e),this.resourceManager.removeEventListener("mapped",s),o?this.renderManager.play():this.renderManager.render(),t(a)};this.resourceManager.addEventListener("mapped",s),this.loaderManager.reset().load(e.assets)}else this.loadLifeCycle(e),o?this.renderManager.play():this.renderManager.render(),t(void 0)})}removeConfig(e){this.removeLifeCycle(e)}getObjectConfig(e){const t=this.getObjectSymbol(e);return t?this.getConfigBySymbol(t):null}setCameraBySymbol(e){const t=this.compilerManager.getCompiler(p.CAMERA);return t.map.has(e)?this.setCamera(t.map.get(e)):console.warn("can not found camera",e),this}setSceneBySymbol(e){const t=this.compilerManager.getCompiler(p.SCENE);return t.map.has(e)?this.setScene(t.map.get(e)):console.warn("can not found scene",e),this}}export{d as C,B as D,yi as E,p as M,K as R,i as a,ur as b,gt as c,h as d,y as e,D as g,G as u};
