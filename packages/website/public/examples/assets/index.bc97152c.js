var De=Object.defineProperty;var Ae=(d,n,i)=>n in d?De(d,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):d[n]=i;var o=(d,n,i)=>(Ae(d,typeof n!="symbol"?n+"":n,i),i);import{t as Ne,a as j}from"./index.a2f5d06c.js";import{h as y,i as S,T as v,c as U,Q as ae,j as re,V as u,O as Z}from"./three.a7f96461.js";const Re="@vis-three/orbit-controls-plugin";class je{constructor(){o(this,"listeners",new Map)}addEventListener(n,i){const r=this.listeners;r.has(n)||r.set(n,[]);const s=r.get(n);s.includes(i)||s.push(i)}hasEventListener(n,i){const r=this.listeners;return r.has(n)?r.get(n).includes(i):!1}removeEventListener(n,i){const r=this.listeners;if(!r.has(n)||!r.get(n).includes(i))return;const s=r.get(n);s.splice(s.indexOf(i),1)}dispatchEvent(n){var s;const i=n.type,r=this.listeners;if(r.has(i))try{(s=r.get(i))==null||s.forEach(a=>{a.call(this,n)})}catch(a){console.error(a)}}once(n,i){const r=function(s){i.call(this,s),this.removeEventListener(n,r)};this.addEventListener(n,r)}emit(n,i={}){var s;const r=this.listeners;if(r.has(n))try{(s=r.get(n))==null||s.forEach(a=>{a.call(this,i)})}catch(a){console.error(a)}}on(n,i){this.addEventListener(n,i)}has(n,i){return this.hasEventListener(n,i)}off(n,i){if(i)this.removeEventListener(n,i);else{const r=this.listeners;if(!r.has(n))return;r.delete(n)}}eventCount(n){return this.listeners.has(n)?this.listeners.get(n).length:0}popLatestEvent(n){!this.listeners.has(n)||this.listeners.get(n).pop()}clear(){this.listeners.clear()}useful(){return Boolean([...this.listeners.keys()].length)}}class ve extends je{constructor(i,r){super();o(this,"object");o(this,"domElement");o(this,"enabled",!0);o(this,"target",new y);o(this,"minDistance",0);o(this,"maxDistance",1/0);o(this,"minZoom",0);o(this,"maxZoom",1/0);o(this,"minPolarAngle",0);o(this,"maxPolarAngle",Math.PI);o(this,"minAzimuthAngle",-1/0);o(this,"maxAzimuthAngle",1/0);o(this,"enableDamping",!1);o(this,"dampingFactor",.05);o(this,"enableZoom",!0);o(this,"zoomSpeed",1);o(this,"enableRotate",!0);o(this,"rotateSpeed",1);o(this,"enablePan",!0);o(this,"panSpeed",1);o(this,"screenSpacePanning",!0);o(this,"keyPanSpeed",7);o(this,"autoRotate",!1);o(this,"autoRotateSpeed",2);o(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"});o(this,"mouseButtons",{LEFT:null,MIDDLE:S.DOLLY,RIGHT:S.ROTATE});o(this,"touches",{ONE:v.ROTATE,TWO:v.DOLLY_PAN});o(this,"target0");o(this,"position0");o(this,"zoom0");o(this,"_domElementKeyEvents",null);o(this,"spherical");o(this,"reset");o(this,"update");o(this,"onContextMenu");o(this,"onPointerDown");o(this,"onPointerCancel");o(this,"onMouseWheel");o(this,"onPointerMove");o(this,"onPointerUp");o(this,"onKeyDown");this.object=i||new U,this.domElement=r||document.createElement("div"),this.domElement.style.touchAction="none",this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.update=(()=>{const e=new y,t=new ae().setFromUnitVectors(this.object.up,new y(0,1,0)),c=t.clone().invert(),p=new y,b=new ae,g=2*Math.PI;return()=>{const ie=this.object.position;e.copy(ie).sub(this.target),e.applyQuaternion(t),l.setFromVector3(e),this.autoRotate&&a===s.NONE&&_(he()),this.enableDamping?(l.theta+=m.theta*this.dampingFactor,l.phi+=m.phi*this.dampingFactor):(l.theta+=m.theta,l.phi+=m.phi);let f=this.minAzimuthAngle,E=this.maxAzimuthAngle;return isFinite(f)&&isFinite(E)&&(f<-Math.PI?f+=g:f>Math.PI&&(f-=g),E<-Math.PI?E+=g:E>Math.PI&&(E-=g),f<=E?l.theta=Math.max(f,Math.min(E,l.theta)):l.theta=l.theta>(f+E)/2?Math.max(f,l.theta):Math.min(E,l.theta)),l.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,l.phi)),l.makeSafe(),l.radius*=C,l.radius=Math.max(this.minDistance,Math.min(this.maxDistance,l.radius)),this.enableDamping===!0?this.target.addScaledVector(L,this.dampingFactor):this.target.add(L),e.setFromSpherical(l),e.applyQuaternion(c),ie.copy(this.target).add(e),this.object.lookAt(this.target),this.enableDamping===!0?(m.theta*=1-this.dampingFactor,m.phi*=1-this.dampingFactor,L.multiplyScalar(1-this.dampingFactor)):(m.set(0,0,0),L.set(0,0,0)),C=1,k||p.distanceToSquared(this.object.position)>X||8*(1-b.dot(this.object.quaternion))>X?(this.dispatchEvent({type:"change"}),p.copy(this.object.position),b.copy(this.object.quaternion),k=!1,!0):!1}})();const s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let a=s.NONE;const X=1e-6,l=new re,m=new re;let C=1;const L=new y;let k=!1;const P=new u,T=new u,w=new u,O=new u,M=new u,D=new u,A=new u,N=new u,x=new u,h=[],I={},he=()=>2*Math.PI/60/60*this.autoRotateSpeed,Y=()=>Math.pow(.95,this.zoomSpeed),_=e=>{m.theta-=e},K=e=>{m.phi-=e},V=function(){const e=new y;return function(c,p){e.setFromMatrixColumn(p,0),e.multiplyScalar(-c),L.add(e)}}(),W=(()=>{const e=new y;return(t,c)=>{this.screenSpacePanning===!0?e.setFromMatrixColumn(c,1):(e.setFromMatrixColumn(c,0),e.crossVectors(this.object.up,e)),e.multiplyScalar(t),L.add(e)}})(),R=(()=>{const e=new y;return(t,c)=>{const p=this.domElement;if(this.object instanceof U){const b=this.object.position;e.copy(b).sub(this.target);let g=e.length();g*=Math.tan(this.object.fov/2*Math.PI/180),V(2*t*g/p.clientHeight,this.object.matrix),W(2*c*g/p.clientHeight,this.object.matrix)}else this.object instanceof Z?(V(t*(this.object.right-this.object.left)/this.object.zoom/p.clientWidth,this.object.matrix),W(c*(this.object.top-this.object.bottom)/this.object.zoom/p.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}})(),z=e=>{this.object instanceof U?C/=e:this.object instanceof Z?(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*e)),this.object.updateProjectionMatrix(),k=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)},G=e=>{this.object instanceof U?C*=e:this.object instanceof Z?(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/e)),this.object.updateProjectionMatrix(),k=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)};function B(e){P.set(e.clientX,e.clientY)}function le(e){A.set(e.clientX,e.clientY)}function q(e){O.set(e.clientX,e.clientY)}const ce=e=>{T.set(e.clientX,e.clientY),w.subVectors(T,P).multiplyScalar(this.rotateSpeed);const t=this.domElement;_(2*Math.PI*w.x/t.clientHeight),K(2*Math.PI*w.y/t.clientHeight),P.copy(T),this.update()},pe=e=>{N.set(e.clientX,e.clientY),x.subVectors(N,A),x.y>0?z(Y()):x.y<0&&G(Y()),A.copy(N),this.update()},de=e=>{M.set(e.clientX,e.clientY),D.subVectors(M,O).multiplyScalar(this.panSpeed),R(D.x,D.y),O.copy(M),this.update()},ue=e=>{e.deltaY<0?G(Y()):e.deltaY>0&&z(Y()),this.update()},me=e=>{let t=!1;switch(e.code){case this.keys.UP:R(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:R(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:R(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:R(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())};function Q(){if(h.length===1)P.set(h[0].pageX,h[0].pageY);else{const e=.5*(h[0].pageX+h[1].pageX),t=.5*(h[0].pageY+h[1].pageY);P.set(e,t)}}function J(){if(h.length===1)O.set(h[0].pageX,h[0].pageY);else{const e=.5*(h[0].pageX+h[1].pageX),t=.5*(h[0].pageY+h[1].pageY);O.set(e,t)}}function $(){const e=h[0].pageX-h[1].pageX,t=h[0].pageY-h[1].pageY,c=Math.sqrt(e*e+t*t);A.set(0,c)}const fe=()=>{this.enableZoom&&$(),this.enablePan&&J()},Ee=()=>{this.enableZoom&&$(),this.enableRotate&&Q()},ee=e=>{if(h.length==1)T.set(e.pageX,e.pageY);else{const c=F(e),p=.5*(e.pageX+c.x),b=.5*(e.pageY+c.y);T.set(p,b)}w.subVectors(T,P).multiplyScalar(this.rotateSpeed);const t=this.domElement;_(2*Math.PI*w.x/t.clientHeight),K(2*Math.PI*w.y/t.clientHeight),P.copy(T)},te=e=>{if(h.length===1)M.set(e.pageX,e.pageY);else{const t=F(e),c=.5*(e.pageX+t.x),p=.5*(e.pageY+t.y);M.set(c,p)}D.subVectors(M,O).multiplyScalar(this.panSpeed),R(D.x,D.y),O.copy(M)},se=e=>{const t=F(e),c=e.pageX-t.x,p=e.pageY-t.y,b=Math.sqrt(c*c+p*p);N.set(0,b),x.set(0,Math.pow(N.y/A.y,this.zoomSpeed)),z(x.y),A.copy(N)},be=e=>{this.enableZoom&&se(e),this.enablePan&&te(e)},ge=e=>{this.enableZoom&&se(e),this.enableRotate&&ee(e)};this.onPointerDown=e=>{this.enabled!==!1&&(h.length===0&&(this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp)),we(e),e.pointerType==="touch"?Oe(e):ye(e))};let H=!1;this.onPointerMove=e=>{this.enabled!==!1&&(H||(this.domElement.setPointerCapture(e.pointerId),H=!0),e.pointerType==="touch"?Me(e):Pe(e))},this.onPointerUp=e=>{this.enabled!==!1&&(H=!1,e.pointerType==="touch"?Le():Te(),ne(e),h.length===0&&(this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)))},this.onPointerCancel=e=>{ne(e)};const ye=e=>{let t;switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=-1}switch(t){case S.DOLLY:if(this.enableZoom===!1)return;le(e),a=s.DOLLY;break;case S.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(this.enablePan===!1)return;q(e),a=s.PAN}else{if(this.enableRotate===!1)return;B(e),a=s.ROTATE}break;case S.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(this.enableRotate===!1)return;B(e),a=s.ROTATE}else{if(this.enablePan===!1)return;q(e),a=s.PAN}break;default:a=s.NONE}a!==s.NONE&&this.dispatchEvent({type:"start"})},Pe=e=>{if(this.enabled!==!1)switch(a){case s.ROTATE:if(this.enableRotate===!1)return;ce(e);break;case s.DOLLY:if(this.enableZoom===!1)return;pe(e);break;case s.PAN:if(this.enablePan===!1)return;de(e);break}},Te=e=>{this.dispatchEvent({type:"end"}),a=s.NONE};this.onMouseWheel=e=>{this.enabled===!1||this.enableZoom===!1||a!==s.NONE||(e.preventDefault(),this.dispatchEvent({type:"start"}),ue(e),this.dispatchEvent({type:"end"}))},this.onKeyDown=e=>{this.enabled===!1||this.enablePan===!1||me(e)};const Oe=e=>{switch(oe(e),h.length){case 1:switch(this.touches.ONE){case v.ROTATE:if(this.enableRotate===!1)return;Q(),a=s.TOUCH_ROTATE;break;case v.PAN:if(this.enablePan===!1)return;J(),a=s.TOUCH_PAN;break;default:a=s.NONE}break;case 2:switch(this.touches.TWO){case v.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;fe(),a=s.TOUCH_DOLLY_PAN;break;case v.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;Ee(),a=s.TOUCH_DOLLY_ROTATE;break;default:a=s.NONE}break;default:a=s.NONE}a!==s.NONE&&this.dispatchEvent({type:"start"})},Me=e=>{switch(oe(e),a){case s.TOUCH_ROTATE:if(this.enableRotate===!1)return;ee(e),this.update();break;case s.TOUCH_PAN:if(this.enablePan===!1)return;te(e),this.update();break;case s.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;be(e),this.update();break;case s.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;ge(e),this.update();break;default:a=s.NONE}},Le=e=>{this.dispatchEvent({type:"end"}),a=s.NONE};this.onContextMenu=e=>{this.enabled!==!1&&e.preventDefault()};function we(e){h.push(e)}const ne=e=>{delete I[e.pointerId];for(let t=0;t<h.length;t++)if(h[t].pointerId==e.pointerId){h.splice(t,1);return}};function oe(e){let t=I[e.pointerId];t===void 0&&(t=new u,I[e.pointerId]=t),t.set(e.pageX,e.pageY)}function F(e){const t=e.pointerId===h[0].pointerId?h[1]:h[0];return I[t.pointerId]}this.spherical=l,this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),this.domElement.addEventListener("wheel",this.onMouseWheel,{passive:!1}),this.reset=()=>{this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent({type:"change"}),this.update(),a=s.NONE},this.update()}getPolarAngle(){return this.spherical.phi}getAzimuthalAngle(){return this.spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(i){i.addEventListener("keydown",this.onKeyDown),this._domElementKeyEvents=i}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}setCamera(i){this.object=i}setDom(i){this.dispose(),this.domElement=i,this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),this.domElement.addEventListener("wheel",this.onMouseWheel,{passive:!1})}dispose(){this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("pointercancel",this.onPointerCancel),this.domElement.removeEventListener("wheel",this.onMouseWheel),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp),this._domElementKeyEvents!==null&&this._domElementKeyEvents.removeEventListener("keydown",this.onKeyDown)}}const xe=Ne(Re),Ie=function(){let d,n,i;return{name:xe,install(r){const s=new ve(r.camera,r.dom);r.orbitControls=s,d=a=>{s.setDom(a.dom)},r.addEventListener(j.SETDOM,d),n=a=>{a.options.orbitControls&&s.setCamera(a.camera)},r.addEventListener(j.SETCAMERA,n),i=()=>{s.update()},r.addEventListener(j.RENDER,i)},dispose(r){r.removeEventListener(j.SETDOM,d),r.removeEventListener(j.SETCAMERA,n),r.removeEventListener(j.RENDER,i)}}};export{Ie as O,xe as a};
