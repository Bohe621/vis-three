var b=Object.defineProperty;var j=(o,c,t)=>c in o?b(o,c,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[c]=t;var i=(o,c,t)=>(j(o,typeof c!="symbol"?c+"":c,t),t);import{e as v,t as E,a as h}from"./index.4a26448f.js";import{m as H,Z as y}from"./three.073ebd5b.js";class L extends v{constructor(t){super();i(this,"dom");i(this,"mouse");i(this,"canMouseMove");i(this,"mouseEventTimer");i(this,"throttleTime");i(this,"pointerDownHandler");i(this,"pointerMoveHandler");i(this,"pointerUpHandler");i(this,"mouseDownHandler");i(this,"mouseUpHandler");i(this,"clickHandler");i(this,"dblclickHandler");i(this,"contextmenuHandler");this.dom=t.dom,this.mouse=new H,this.canMouseMove=!0,this.mouseEventTimer=null,this.throttleTime=t.throttleTime||1e3/60;const e=d=>{const p={mouse:{x:this.mouse.x,y:this.mouse.y}};for(const r in d)p[r]=d[r];return p},a=d=>{this.dispatchEvent(e(d))};this.pointerMoveHandler=d=>{!this.canMouseMove||(this.canMouseMove=!1,this.mouseEventTimer=window.setTimeout(()=>{const p=this.mouse,r=this.dom,s=r.getBoundingClientRect();p.x=(d.clientX-s.left)/r.offsetWidth*2-1,p.y=-((d.clientY-s.top)/r.offsetHeight)*2+1,this.canMouseMove=!0,this.dispatchEvent(e(d))},this.throttleTime))},this.mouseDownHandler=a,this.mouseUpHandler=a,this.pointerDownHandler=a,this.pointerUpHandler=a,this.clickHandler=a,this.dblclickHandler=a,this.contextmenuHandler=a}setDom(t){if(this.dom){const e=this.dom;e.removeEventListener("mousedown",this.mouseDownHandler),e.removeEventListener("mouseup",this.mouseUpHandler),e.removeEventListener("pointerdown",this.pointerDownHandler),e.removeEventListener("pointermove",this.pointerMoveHandler),e.removeEventListener("pointerup",this.pointerUpHandler),e.removeEventListener("click",this.clickHandler),e.removeEventListener("dblclick",this.dblclickHandler),e.removeEventListener("contextmenu",this.contextmenuHandler)}return t.addEventListener("mousedown",this.mouseDownHandler),t.addEventListener("mouseup",this.mouseUpHandler),t.addEventListener("pointerdown",this.pointerDownHandler),t.addEventListener("pointermove",this.pointerMoveHandler),t.addEventListener("pointerup",this.pointerUpHandler),t.addEventListener("click",this.clickHandler),t.addEventListener("dblclick",this.dblclickHandler),t.addEventListener("contextmenu",this.contextmenuHandler),this.dom=t,this}getNormalMouse(){return this.mouse}}const M="@vis-three/pointer-manager-plugin",f=E(M),D=function(o){let c;return{name:f,install(t){const e=new L(Object.assign(o||{},{dom:t.dom}));c=a=>{e.setDom(a.dom)},t.addEventListener(h.SETDOM,c),t.pointerManager=e},dispose(t){t.removeEventListener(h.SETDOM,c),c=void 0}}};var m;(function(o){o.POINTERDOWN="pointerdown",o.POINTERUP="pointerup",o.POINTERMOVE="pointermove",o.POINTERENTER="pointerenter",o.POINTERLEAVE="pointerleave",o.CLICK="click",o.DBLCLICK="dblclick",o.CONTEXTMENU="contextmenu"})(m||(m={}));class g extends v{constructor(t){super();i(this,"raycaster");i(this,"scene");i(this,"camera");i(this,"filter",new Set);i(this,"recursive",!1);i(this,"penetrate",!1);i(this,"propagation",!1);i(this,"delegation",!1);this.raycaster=new y,this.camera=t.camera,this.scene=t.scene,t.recursive&&(this.recursive=t.recursive),t.penetrate&&(this.penetrate=t.penetrate)}setScene(t){return this.scene=t,this}setCamera(t){return this.camera=t,this}addFilterObject(t){return this.filter.add(t),this}removeFilterObject(t){return this.filter.delete(t),this}intersectObject(t){this.raycaster.setFromCamera(t,this.camera);const e=this.filter,a=this.scene.children.filter(d=>!e.has(d));return this.raycaster.intersectObjects(a,this.recursive)}use(t){const e=function(s,l){return Object.assign({},s,l)},a=(s,l)=>{const n=this.intersectObject(s.mouse);if(n.length)if(this.penetrate)for(const u of n)u.object.dispatchEvent(e(s,{type:l,intersection:u}));else{const u=n[0];u.object.dispatchEvent(e(s,{type:l,intersection:u}))}this.dispatchEvent(e(s,{type:l,intersections:n}))},d=["pointerdown","pointerup","mousedown","mouseup","pointermove","click","dblclick","contextmenu"];for(const s of d)t.addEventListener(s,l=>{a(l,s)});const p=new Map;let r=null;return t.addEventListener("pointermove",s=>{const l=this.intersectObject(s.mouse);if(this.penetrate){if(!l.length){p.forEach(n=>{n.object.dispatchEvent(e(s,{type:"pointerleave",intersection:n})),n.object.dispatchEvent(e(s,{type:"mouseleave",intersection:n}))}),p.clear();return}for(const n of l)p.has(n.object)?(n.object.dispatchEvent(e(s,{type:"pointermove",intersection:n})),n.object.dispatchEvent(e(s,{type:"mousemove",intersection:n})),p.delete(n.object)):(n.object.dispatchEvent(e(s,{type:"pointerenter",intersection:n})),n.object.dispatchEvent(e(s,{type:"mouseenter",intersection:n})));for(const n of p.values())n.object.dispatchEvent(e(s,{type:"pointerleave",intersection:n})),n.object.dispatchEvent(e(s,{type:"mouseleave",intersection:n}));p.clear();for(const n of l)p.set(n.object,n)}else{if(!l.length){r&&(r.object.dispatchEvent(e(s,{type:"pointerleave",intersection:r})),r.object.dispatchEvent(e(s,{type:"mouseleave",intersection:r})),r=null);return}const n=l[0];if(!r){n.object.dispatchEvent(e(s,{type:"pointerenter",intersection:n})),n.object.dispatchEvent(e(s,{type:"mouseenter",intersection:n})),r=n;return}if(n.object!==r.object){r.object.dispatchEvent(e(s,{type:"pointerleave",intersection:n})),r.object.dispatchEvent(e(s,{type:"mouseleave",intersection:n})),n.object.dispatchEvent(e(s,{type:"pointerenter",intersection:n})),n.object.dispatchEvent(e(s,{type:"mouseenter",intersection:n})),r=n;return}n.object===r.object&&(n.object.dispatchEvent(e(s,{type:"pointermove",intersection:n})),n.object.dispatchEvent(e(s,{type:"mousemove",intersection:n})))}this.dispatchEvent(e(s,{type:"pointermove",intersections:l})),this.dispatchEvent(e(s,{type:"mousemove",intersections:l}))}),this}}const w="@vis-three/event-manager-plugin",O=E(w),C=function(o){let c,t;return{name:O,deps:f,install(e){const a=new g(Object.assign({scene:e.scene,camera:e.camera},o));a.use(e.pointerManager),e.eventManager=a,c=d=>{e.eventManager.setCamera(d.camera)},t=d=>{e.eventManager.setScene(d.scene)},e.addEventListener(h.SETCAMERA,c),e.addEventListener(h.SETSCENE,t)},dispose(e){e.removeEventListener(h.SETCAMERA,c),e.removeEventListener(h.SETSCENE,t),c=void 0,t=void 0}}};export{C as E,D as P,m as a,O as b};
